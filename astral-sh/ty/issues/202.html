<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disjointness of complements - astral-sh/ty #202</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Disjointness of complements</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/202">#202</a>
        opened by <a href="https://github.com/sharkdp">@sharkdp</a>
        on 2025-02-10 20:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sharkdp">@sharkdp</a></div>
            <div class="timeline-body">Description
<p>The complement <code>~T</code> of a type is disjoint from the type <code>T</code> itself. In fact, it is disjoint from all subtypes of <code>S &lt;: T</code>.</p>
<p>It is rather straightforward to implement this. The problem I am facing is that this leads to new property test failures, because it breaks the symmetry of the is-disjoint-from relation when done naively.</p>
<p>The reason for that are pairs like <code>T &amp; Any</code> and <code>~T</code>. In one direction, if we check if <code>T &amp; Any</code> is disjoint from <code>~T</code>, we start by checking if any positive element of the intersection <code>T &amp; Any</code> is disjoint from <code>~T</code>. And since <code>T</code> is disjoint from <code>~T</code> according to this new check, we return <code>true</code>, as we should.</p>
<p>But when we check if <code>~T</code> is disjoint from <code>T &amp; Any</code>, we have no positive elements in the left-hand side intersection. The only remaining check is therefore the new check which tries if <code>T &amp; Any</code> is a subtype of <code>T</code>. This is not the case, because <code>T &amp; Any</code> is not fully-static. But if feels like this &quot;is-subtype-of&quot; relation in the check could be replaced by a subtyping-relation on gradual types that would check if <em>all</em> materializations of <code>S</code> are subtypes of all materializations of <code>T</code> (which is different from the consistent-subtype relation on gradual types).</p>
<hr>
<p>For context, this came up when trying to write the following test that intends to demonstrate that <code>AlwaysTruthy</code>/<code>AlwaysFalys</code> are disjoint from <code>AmbiguousTruthiness</code></p>
<pre><code>type Truthy = Not[AlwaysFalsy]
type Falsy = Not[AlwaysTruthy]

type AmbiguousTruthiness = Intersection[Truthy, Falsy]

static_assert(is_disjoint_from(AlwaysTruthy, AmbiguousTruthiness))
static_assert(is_disjoint_from(AlwaysFalsy, AmbiguousTruthiness))
</code></pre>
<p><img src="https://github.com/user-attachments/assets/55f4c7b2-86d3-4aac-847d-65ac009ebafe" alt="image"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-02-10 20:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned <a href="https://github.com/sharkdp">@sharkdp</a> by <a href="https://github.com/sharkdp">@sharkdp</a> on 2025-04-28 08:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;[red-knot] Disjointness of complements&quot; to &quot;Disjointness of complements&quot; by <a href="https://github.com/MichaReiser">@MichaReiser</a> on 2025-05-07 15:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">set-theoretic types</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-11 07:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">type properties</span> added by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2025-05-11 07:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;Z post-stable&quot; by <a href="https://github.com/carljm">@carljm</a> on 2025-11-13 16:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;Z post-stable&quot; by <a href="https://github.com/carljm">@carljm</a> on 2025-11-18 16:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:24:16 UTC
    </footer>
</body>
</html>
