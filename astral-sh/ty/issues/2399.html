<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>imprecise inference for types.new_class() with `bases` - astral-sh/ty #2399</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>imprecise inference for types.new_class() with <code>bases</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/astral-sh/ty/issues/2399">#2399</a>
        opened by <a href="https://github.com/bcmills">@bcmills</a>
        on 2026-01-08 16:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/bcmills">@bcmills</a> on 2026-01-08 16:18</div>
            <div class="timeline-body"><h3>Summary</h3>
<p>https://play.ty.dev/c84dda0b-ff7b-4570-9baa-42cee056d0fd:</p>
<pre><code class="language-py">from typing import Type
from types import new_class

class Foo:
    pass

def use_new_class() -&gt; Type[Foo]:
    return new_class(
        &quot;NewFoo&quot;,
        bases=(Foo,),
    )
</code></pre>
<p><code>ty</code> reports:</p>
<pre><code>Return type does not match returned value: expected `type[Foo]`, found `type` (invalid-return-type) [Ln 8, Col 12]
</code></pre>
<p>I think that's erroneous: because <code>Foo</code> is in the <code>bases</code> passed to <code>new_class</code>, the returned class <em>is</em> a subclass of <code>Foo</code>, so the actual return type is <code>Type[Foo]</code>, not <em>just</em> <code>type</code>.</p>
<h3>Version</h3>
<p>ty 0.0.9</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "imprecise inference for types.new_class" to "imprecise inference for types.new_class() with `bases`" by @bcmills on 2026-01-08 16:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-08 16:25</div>
            <div class="timeline-body"><p>Thanks! Wow, I had no idea other type checkers supported this, but apparently it's supported by <a href="https://mypy-play.net/?mypy=latest&amp;python=3.12&amp;gist=a247ede022eddf79343d76a23aa49f4e">mypy</a>, <a href="https://pyright-play.net/?pyrightVersion=1.1.405&amp;pythonVersion=3.13&amp;reportUnreachable=true&amp;code=GYJw9gtgBALgngBwJYDsDmUkQWEMoAqiApgFCiSwkDOm2u%2BKxA7gPoDGANgIbXWmkuvWgDEwYAFykoMqAmECAJsWBQArtWKsmbIXwAUASigBaAHyESAbTFgAulNlQQxGGpAooOjjwPSnsgBEAHIstoEANP4BUABGvMTUALz6thGGUU6GpEA">pyright</a> and <a href="https://pyrefly.org/sandbox/?project=N4IgZglgNgpgziAXKOBDAdgEwEYHsAeAdAA4CeS4ATrgLYAEALqcROgOZ0Q3G6UN0AVZjAA66MNXpNi8Tt1790MAO4B9AMZRUcOGLGbtcOgDFcuRGLpW6xQ3qwwwdAK5wYqpWoM6AFAEo6AFoAPkFhAG1TXABdC3RrOkoYBmdKeM8NLV9LBOsREAA5FSj8gBoc3LpsbXgAXh8o0r9y%2BOs-MRBSkGcGaDgSckQQAGI6AFVeqAgmOjBndHVe3HRddDFMR1neGlQGD2cabBhKH3xETnQGAJC6OAZKOISklLTZ-IKDo4e6YHwAX3yHS6ZCSYCgpEIDFoUAoowACqRQeDbhgcAQ6OplpA2KldhBloQxKMAMowGB0AAWDAYxDgiAA9PSQY5wYReGx6TB0PTMLh1HB6ZjxBAcZQ8ct6VtKHRUAA3VDQVDYWAYrEi3FLeK4Yia-piMgMCnLQKy45wfHxWp0fIAZkIAEYAEyA9AgP5dVCLCCm4zQGAUNBYPBEMhuoA">pyrefly</a>.</p>
<p>@charliermarsh, maybe one for you after https://github.com/astral-sh/ruff/pull/22291 lands? It looks like <code>types.new_class()</code> is basically exactly the same as three-argument <code>type()</code>, with the sole exception that you can also provide keywords to the class definition (including <code>metaclass=</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jelle-openai">@jelle-openai</a> on 2026-01-08 17:31</div>
            <div class="timeline-body"><p>I don't think other type checkers meaningfully support it; if you add a <code>reveal_type()</code> in mypy or pyright, it just outputs <code>type</code>. I think the difference is that for mypy and pyright <code>type</code> is <code>type[Any]</code> and for ty it's <code>type[object]</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AlexWaygood">@AlexWaygood</a> on 2026-01-08 20:16</div>
            <div class="timeline-body"><blockquote>
<p>I don't think other type checkers meaningfully support it; if you add a <code>reveal_type()</code> in mypy or pyright, it just outputs <code>type</code>. I think the difference is that for mypy and pyright <code>type</code> is <code>type[Any]</code> and for ty it's <code>type[object]</code>?</p>
</blockquote>
<p>Ah, good catch. Still, I don't see a strong reason why we <em>shouldn't</em> add support for this, given that the machinery we're adding in https://github.com/astral-sh/ruff/pull/22291 is pretty generalised.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "Stable" by @carljm on 2026-01-08 23:48</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 11:42:06 UTC
    </footer>
</body>
</html>
