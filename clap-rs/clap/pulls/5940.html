<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>feat: added an map api for pathCompleter - clap-rs/clap #5940</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>feat: added an map api for pathCompleter</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/clap-rs/clap/pull/5940">#5940</a>
        opened by <a href="https://github.com/Gmin2">@Gmin2</a>
        on 2025-03-07 12:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/Gmin2">@Gmin2</a> on 2025-03-07 12:26</div>
            <div class="timeline-body"><p>A <code>map</code> API to <code>PathCompleter</code> and added its test, the <code>map</code> method  allows customization of completion candidates after filtering, enabling use cases like highlighting directories, labeling etc</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2025-03-07 15:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_complete/src/engine/custom.rs</code>:260 on 2025-03-07 15:09</div>
            <div class="timeline-body"><p>Can you put this below <code>filter</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2025-03-07 15:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_complete/tests/testsuite/engine.rs</code>:1196 on 2025-03-07 15:10</div>
            <div class="timeline-body"><p>Please split this PR into two commits</p>
<ol>
<li>Adds the test, showing the current behavior (passes)</li>
<li>Adds the feature and updates the test to use it, showing how this feature changes behavior</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2025-03-07 15:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_complete/tests/testsuite/engine.rs</code>:1226 on 2025-03-07 15:12</div>
            <div class="timeline-body"><p>Please demonstrate this feature when there is a user-provided directory <code>filter</code> <em>and</em> a <code>map</code> is used.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2025-03-07 15:13</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_complete/tests/testsuite/engine.rs</code>:1226 on 2025-03-07 15:13</div>
            <div class="timeline-body"><p>And/or <code>PathCompleter::file</code> is being used with <code>map</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2025-03-10 16:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_complete/tests/testsuite/engine.rs</code>:1 on 2025-03-10 16:37</div>
            <div class="timeline-body"><p>Please update this commit to be <code>test</code>, not <code>feat</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_complete/tests/testsuite/engine.rs</code>:1220 on 2025-03-10 16:37</div>
            <div class="timeline-body"><p>Why are there <code>current_dir</code> shenanigans rather than using the <code>current_dir</code> parameter to <code>complete!</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2025-03-10 16:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2025-03-10 16:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_complete/tests/testsuite/engine.rs</code>:1196 on 2025-03-10 16:43</div>
            <div class="timeline-body"><p>The intention of the split commits was for this test to overwrite the <code>suggest_value_path_without_mapper</code>, showing the change in behavior.  Only  the call to <code>map</code> and output should change in this commit.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gmin2">@Gmin2</a> on <code>clap_complete/tests/testsuite/engine.rs</code>:1220 on 2025-03-12 07:09</div>
            <div class="timeline-body"><p>have used the <code>current_dir</code> parameter</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gmin2">@Gmin2</a> reviewed on 2025-03-12 07:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gmin2">@Gmin2</a> reviewed on 2025-03-12 07:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gmin2">@Gmin2</a> on <code>clap_complete/tests/testsuite/engine.rs</code>:1196 on 2025-03-12 07:10</div>
            <div class="timeline-body"><p>done in <a href="https://github.com/clap-rs/clap/pull/5940/commits/8bb3c50d030cc162218eb925a8117dfde546afeb#diff-4cbc893158b1d959a7f425d8a5a17bee8be9e37e878636288b7c284ba73222c0R1219">this</a> and added an additional test mentioned <a href="https://github.com/clap-rs/clap/pull/5940#discussion_r1985241252">here</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2025-03-12 14:50</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_complete/tests/testsuite/engine.rs</code>:1196 on 2025-03-12 14:50</div>
            <div class="timeline-body"><p>All test additions should be done in the first commit</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2025-03-12 14:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_complete/tests/testsuite/engine.rs</code>:1217 on 2025-03-12 14:52</div>
            <div class="timeline-body"><p>If you ran clippy on this, it would complain about the use of <code>map_or</code>.  CI isn't catching it because we aren't running it on unstable features from non-default packages.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2025-03-12 14:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_complete/tests/testsuite/engine.rs</code>:1220 on 2025-03-12 14:53</div>
            <div class="timeline-body"><ol>
<li>These two are filtering under different conditions</li>
<li>Logically, it feels odd that we're mapping on something that was filtered out.  We shouldn't have to re-<code>filter</code> inside the <code>map</code>.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_complete/tests/testsuite/engine.rs</code>:1225 on 2025-03-12 14:53</div>
            <div class="timeline-body"><p>Why this this being done?  display order should be taken care of</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2025-03-12 14:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gmin2">@Gmin2</a> reviewed on 2025-03-12 16:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gmin2">@Gmin2</a> on <code>clap_complete/tests/testsuite/engine.rs</code>:1225 on 2025-03-12 16:33</div>
            <div class="timeline-body"><p>the <code>display_order</code> in the else branch ensures that <code>c_dir</code> comes first, if i dont include <code>display_order()</code> in the else branch it does not sort it properly</p>
<pre><code>---- expected: tests/testsuite/engine.rs:1232:9
++++ actual:   In-memory
   1      - c_dir/      Addable cargo package
   2      - d_dir/∅
        1 + .
        2 + d_dir/
        3 + c_dir/      Addable cargo package∅
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gmin2">@Gmin2</a> reviewed on 2025-03-12 16:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gmin2">@Gmin2</a> on <code>clap_complete/tests/testsuite/engine.rs</code>:1220 on 2025-03-12 16:36</div>
            <div class="timeline-body"><p>hmm... so i am thinking of filtering first if its a directory and then the mapping if it contains <code>c_dir</code>
thats seem correct right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2025-03-12 16:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_complete/tests/testsuite/engine.rs</code>:1225 on 2025-03-12 16:37</div>
            <div class="timeline-body"><p>If we filtered out <code>d_dir</code>, then it should be last.  If it isn't, something else is going on and should be investigated and fixed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2025-03-12 16:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_complete/tests/testsuite/engine.rs</code>:1220 on 2025-03-12 16:38</div>
            <div class="timeline-body"><p><code>map</code> should only applied to content that matched <code>filter</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gmin2">@Gmin2</a> reviewed on 2025-03-12 16:38</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/Gmin2">@Gmin2</a> on <code>clap_complete/tests/testsuite/engine.rs</code>:1196 on 2025-03-12 16:38</div>
            <div class="timeline-body"><p>So @epage, i should do that same as i did for <code>suggest_value_path_with_mapper</code> (in the first commit showing the behaviour without mapper and then showing the behaviour with mapper right ?)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_complete/tests/testsuite/engine.rs</code>:1196 on 2025-03-12 16:56</div>
            <div class="timeline-body"><p>Yes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2025-03-12 16:56</div>
            <div class="timeline-body"></div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:36:28 UTC
    </footer>
</body>
</html>
