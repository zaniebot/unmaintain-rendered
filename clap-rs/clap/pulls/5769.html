<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>feat(mangen): Support flatten_help - clap-rs/clap #5769</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>feat(mangen): Support flatten_help</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/clap-rs/clap/pull/5769">#5769</a>
        opened by <a href="https://github.com/aparcar">@aparcar</a>
        on 2024-10-07 09:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Pull request opened by <a href="https://github.com/aparcar">@aparcar</a> on 2024-10-07 09:11</div>
            <div class="timeline-body"><p>The <code>flatten_help</code> argument combines all subcommands on a single page. Until now this wasn't supported for <code>mangen</code>. With this command the sections <code>SYNOPSIS</code> as well as <code>(SUB)COMMANDS</code> are changed to imitate the style of <code>git stash --help</code>.</p>
<p>I reached out via discussions and it looks like this doesn't work just yet https://github.com/clap-rs/clap/discussions/5761</p>
<p>This is not necessarily the most beautiful implementation due to my limited knowledge of both <code>clap</code> and Rust itself.</p>
<p>I implemented this for a project I'm working on and the results look quite okay:</p>
<p><img src="https://github.com/user-attachments/assets/30930387-c975-41fd-ac0e-36d735e3af95" alt="image" /></p>
<p>Not using <code>man.render()</code> but call each command manually feels a bit awkward but does work just fine, see example here https://github.com/rosenpass/rosenpass/pull/434/files#diff-352422e105afd3138a54ea14e33af782243398f1d768d271655729dd4bcb99d2R18</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-07 13:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/src/lib.rs</code>:224 on 2024-10-07 13:40</div>
            <div class="timeline-body"><p>Please add a test for this in https://github.com/clap-rs/clap/blob/master/clap_mangen/tests/testsuite/roff.rs</p>
<p>As mentioned in our contrib documentation, please split this into two commits</p>
<ol>
<li>A commit that adds the test using <code>flatten_help</code> that passes, showing the current behavior</li>
<li>A commit that adds support for <code>flatten_help</code> and updates the test snapshot to show the new behavior</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-07 13:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/src/lib.rs</code>:228 on 2024-10-07 13:43</div>
            <div class="timeline-body"><p>There are times when you should sow the usage for the current command</p>
<p>See https://github.com/clap-rs/clap/blob/d2874a50cf594ace49a9dfa644e734f83491a403/clap_builder/src/output/usage.rs#L107-L113</p>
<p>In general, I'd recommend checking how we use flatten_help to change output</p>
<ul>
<li>https://github.com/clap-rs/clap/blob/master/clap_builder/src/output/help_template.rs</li>
<li>https://github.com/clap-rs/clap/blob/master/clap_builder/src/output/usage.rs</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-07 13:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/src/lib.rs</code>:1 on 2024-10-07 13:44</div>
            <div class="timeline-body"><p>Please document in the PR description any style differences between <code>--help</code> and man's handling of <code>flatten_help</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aparcar">@aparcar</a> on <code>clap_mangen/src/lib.rs</code>:224 on 2024-10-16 15:10</div>
            <div class="timeline-body"><p>Done</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aparcar">@aparcar</a> reviewed on 2024-10-16 15:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aparcar">@aparcar</a> reviewed on 2024-10-16 15:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aparcar">@aparcar</a> on <code>clap_mangen/src/lib.rs</code>:228 on 2024-10-16 15:10</div>
            <div class="timeline-body"><p>I tried to adopt the style</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aparcar">@aparcar</a> reviewed on 2024-10-16 15:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aparcar">@aparcar</a> on <code>clap_mangen/src/render.rs</code>:99 on 2024-10-16 15:19</div>
            <div class="timeline-body"><p>I'm quite sure you don't love this way of implementing it, do you have a cleaner idea?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aparcar">@aparcar</a> reviewed on 2024-10-16 16:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aparcar">@aparcar</a> on <code>clap_mangen/src/lib.rs</code>:1 on 2024-10-16 16:08</div>
            <div class="timeline-body"><p>Before documenting it I want to make sure that the <code>flatten_help</code> implementation for <code>--help</code> isn't incomplete. In the picture below are subcommand details printed directly after the options without another section title, is that intended?</p>
<img width="754" alt="image" src="https://github.com/user-attachments/assets/d1412005-3587-47d6-ad42-c8b7e1f7766c">

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/src/lib.rs</code>:1 on 2024-10-16 22:37</div>
            <div class="timeline-body"><blockquote>
<p>In the picture below are subcommand details printed directly after the options without another section title, is that intended?</p>
</blockquote>
<p>Yes, that is intentional as we don't really have a good way of rendering sub-headers at this time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-16 22:37</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-16 22:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/tests/testsuite/roff.rs</code>:129 on 2024-10-16 22:39</div>
            <div class="timeline-body"><p>Please use <code>flatten_help.roff</code> in this commit.  That way we can see how <code>flatten_help.roff</code> itself changes between commits.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/src/render.rs</code>:87 on 2024-10-16 22:44</div>
            <div class="timeline-body"><p>Why are we manually building this, rather than using <code>subcommand.get_bin_name().unwrap_or_else(|| cmd.get_name());</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-16 22:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-16 22:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/src/render.rs</code>:93 on 2024-10-16 22:45</div>
            <div class="timeline-body"><p><code>to_string</code> can lead to sloppy code. Please instead use <code>to_owned</code> or whatever the appropriate conversion is</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-16 22:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/src/render.rs</code>:87 on 2024-10-16 22:45</div>
            <div class="timeline-body"><p>With that change, do we even need a <code>name</code> parameter?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-16 22:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/src/lib.rs</code>:228 on 2024-10-16 22:47</div>
            <div class="timeline-body"><p>I am  not seeing a call to <code>is_subcommand_required_set</code> or <code>is_args_conflicts_with_subcommands_set</code> to handle this</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-16 22:48</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/src/render.rs</code>:111 on 2024-10-16 22:48</div>
            <div class="timeline-body"><p>Seems like we should be consistent between <code>flatten</code> or not on whether the last entry has a <code>br</code> after it.  Since we don't have one today, it appears, it seems like we shouldn't in this.  If we wanted to add it, that would be a separate commit</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-16 22:52</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/src/render.rs</code>:32 on 2024-10-16 22:52</div>
            <div class="timeline-body"><p>For consistency, shouldn't this be called <code>usage</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-16 22:53</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/src/render.rs</code>:32 on 2024-10-16 22:53</div>
            <div class="timeline-body"><p>Please split out the commits for</p>
<ul>
<li>Splitting this function out</li>
<li>Moving this function below <code>synopsis</code> (also, I'm assuming it doesn't need to be <code>pub(crate)</code>)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-16 22:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/src/render.rs</code>:99 on 2024-10-16 22:55</div>
            <div class="timeline-body"><p>where possible, we should match how our regular usage renderer does things</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aparcar">@aparcar</a> reviewed on 2024-10-17 13:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aparcar">@aparcar</a> on <code>clap_mangen/src/render.rs</code>:32 on 2024-10-17 13:00</div>
            <div class="timeline-body"><p>Done</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aparcar">@aparcar</a> reviewed on 2024-10-17 13:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aparcar">@aparcar</a> on <code>clap_mangen/src/render.rs</code>:32 on 2024-10-17 13:00</div>
            <div class="timeline-body"><p>Done</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aparcar">@aparcar</a> reviewed on 2024-10-17 13:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aparcar">@aparcar</a> on <code>clap_mangen/src/render.rs</code>:111 on 2024-10-17 13:00</div>
            <div class="timeline-body"><p>Fixed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aparcar">@aparcar</a> on <code>clap_mangen/src/render.rs</code>:93 on 2024-10-17 13:00</div>
            <div class="timeline-body"><p>Fixed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aparcar">@aparcar</a> reviewed on 2024-10-17 13:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aparcar">@aparcar</a> on <code>clap_mangen/src/render.rs</code>:87 on 2024-10-17 13:01</div>
            <div class="timeline-body"><p>Cleaned up</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aparcar">@aparcar</a> reviewed on 2024-10-17 13:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aparcar">@aparcar</a> reviewed on 2024-10-17 13:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aparcar">@aparcar</a> on <code>clap_mangen/tests/testsuite/roff.rs</code>:129 on 2024-10-17 13:01</div>
            <div class="timeline-body"><p>Fixed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aparcar">@aparcar</a> reviewed on 2024-10-17 13:14</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aparcar">@aparcar</a> on <code>clap_mangen/src/render.rs</code>:99 on 2024-10-17 13:14</div>
            <div class="timeline-body"><p>I changed the style to be less invasive, what do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aparcar">@aparcar</a> reviewed on 2024-10-18 09:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aparcar">@aparcar</a> on <code>clap_mangen/src/lib.rs</code>:228 on 2024-10-18 09:31</div>
            <div class="timeline-body"><p>Added</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aparcar">@aparcar</a> reviewed on 2024-10-21 12:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aparcar">@aparcar</a> on <code>clap_mangen/src/lib.rs</code>:1 on 2024-10-21 12:46</div>
            <div class="timeline-body"><p>I tried to make a nice comparison but I'm a bit confused with the following issue. To allow <code>--help</code> on the <code>man.rs</code> example, I made the following change:</p>
<pre><code class="language-diff">diff --git a/clap_mangen/examples/man.rs b/clap_mangen/examples/man.rs
index e42c5b16..8b8e8a82 100644
--- a/clap_mangen/examples/man.rs
+++ b/clap_mangen/examples/man.rs
@@ -32,7 +32,11 @@ And a few newlines.&quot;,
             Command::new(&quot;test&quot;)
                 .about(&quot;does testing things&quot;)
                 .arg(arg!(-l --list &quot;Lists test values&quot;)),
-        );
+        )
+        .flatten_help(true);
+
+    let _ = cmd.get_matches();
+    Ok(())
 
-    Man::new(cmd).render(&amp;mut io::stdout())
+    // Man::new(cmd).render(&amp;mut io::stdout())
 }
</code></pre>
<p>I now see a help output which could be compared to generated Man output, however arguments and specifically styling is entirely missing. I compared it to the <code>git.rs</code> example but couldn't find an obvious change that would drop styling and subcommand printing. Am I missing something here?</p>
<img width="634" alt="image" src="https://github.com/user-attachments/assets/52428ee3-567b-4d31-abdc-268666e9c7b9">

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aparcar">@aparcar</a> reviewed on 2024-10-21 12:51</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aparcar">@aparcar</a> on <code>clap_mangen/src/lib.rs</code>:1 on 2024-10-21 12:51</div>
            <div class="timeline-body"><p>Sorry for the noise, turns out I have to enable a bunch of extra clap features...</p>
<pre><code class="language-diff"> [dependencies]
 roff = &quot;0.2.1&quot;
-clap = { path = &quot;../&quot;, version = &quot;4.0.0&quot;, default-features = false, features = [&quot;std&quot;, &quot;env&quot;] }
+clap = { path = &quot;../&quot;, version = &quot;4.0.0&quot;, default-features = false, features = [
+    &quot;std&quot;,
+    &quot;env&quot;,
+    &quot;help&quot;,
+    &quot;usage&quot;,
+    &quot;color&quot;,
+] }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aparcar">@aparcar</a> reviewed on 2024-10-21 13:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aparcar">@aparcar</a> on <code>clap_mangen/src/lib.rs</code>:1 on 2024-10-21 13:30</div>
            <div class="timeline-body"><p>Added to commit message, also please see https://github.com/clap-rs/clap/pull/5769#issuecomment-2426691534</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/src/render.rs</code>:68 on 2024-10-22 18:08</div>
            <div class="timeline-body"><p>something is off about this commit</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-22 18:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-22 18:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/src/lib.rs</code>:1 on 2024-10-22 18:09</div>
            <div class="timeline-body"><blockquote>
<p>Differences between flattened <code>--help</code> and the flattened man:</p>
<ul>
<li><code>--help</code> prints the description at the very beginning while Man uses a
section called DESCRIPTION below the USAGE.</li>
<li><code>--help</code> prints placeholder <code>[OPTIONS]</code> while Man prints all options</li>
<li><code>--help</code> prints positional options (aka arguments) in its own section
called arguments while Man prints them at the end of OPTIONS.</li>
<li><code>--help</code> prints subcommands as their own section after the options
section while Man uses an extra section called SUBCOMMANDS</li>
<li><code>--help</code> prints <code>after_long_help</code> at the very end while Man uses the
section EXTRA which comes before the sections VERSION and AUTHORS</li>
</ul>
</blockquote>
<p>Most of these differences sound unrelated to flattening</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-22 18:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/tests/testsuite/roff.rs</code>:151 on 2024-10-22 18:10</div>
            <div class="timeline-body"><p>Please add these in the test commit</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-22 18:12</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/tests/snapshots/flatten_help.roff</code>:29 on 2024-10-22 18:12</div>
            <div class="timeline-body"><p>Hmm, this surprised me at first but I guess this is what git does for <code>git help stash</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-22 18:15</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/tests/testsuite/roff.rs</code>:118 on 2024-10-22 18:15</div>
            <div class="timeline-body"><p>We should probably cover more cases that <code>help</code> covers, see https://github.com/clap-rs/clap/blob/61f5ee514f8f60ed8f04c6494bdf36c19e7a8126/tests/builder/help.rs#L3280-L3971</p>
<p>e.g.</p>
<ul>
<li>we don't need to cover short vs long</li>
<li>we should cover recursion</li>
</ul>
<p>It'd be a big help to reuse the same commands as those tests so we can easily compare the help output vs man output</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/src/render.rs</code>:69 on 2024-10-22 18:20</div>
            <div class="timeline-body"><p>The way this is structured doesn't make the intent clear, e.g.</p>
<pre><code class="language-suggestion">    let flatten = cmd.is_flatten_help_set();
    let mut first = true;

    if !cmd.is_subcommand_required_set() || cmd.is_args_conflicts_with_subcommands_set() {
        let mut line = usage(cmd, cmd.get_bin_name().unwrap_or_else(|| cmd.get_name()));
        if cmd.has_subcommands() &amp;&amp; !flatten {
            let (lhs, rhs) = subcommand_markers(cmd);
            line.push(roman(lhs));
            line.push(italic(
                cmd.get_subcommand_value_name()
                    .unwrap_or_else(|| subcommand_heading(cmd))
                    .to_lowercase(),
            ));
            line.push(roman(rhs));
        }
        roff.text(line);

        first = false;
    }

    if flatten {
        let mut ord_v = Vec::new();
        for subcommand in cmd.get_subcommands() {
            ord_v.push((
                subcommand.get_display_order(),
                subcommand.get_bin_name().unwrap_or_else(|| cmd.get_name()),
                subcommand,
            ));
        }
        ord_v.sort_by(|a, b| (a.0, &amp;a.1).cmp(&amp;(b.0, &amp;b.1)));
        for (_, name, cmd) in ord_v {
            if !first {
                roff.control(&quot;br&quot;, []);
            } else {
                first = false;
            }
            roff.text(usage(cmd, name));
        }
    }
}
</code></pre>
<ul>
<li>groups <code>ord_v</code> declaration with where its used, making the intent for where its relevant clearr</li>
<li>groups the flatten blocks together to make it clear that they are coupled</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-22 18:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-22 18:22</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/src/render.rs</code>:87 on 2024-10-22 18:22</div>
            <div class="timeline-body"><p>This is not addressed.  We are still passing in the <code>name</code> and still using <code>get_name</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aparcar">@aparcar</a> reviewed on 2024-10-23 09:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aparcar">@aparcar</a> on <code>clap_mangen/src/render.rs</code>:68 on 2024-10-23 09:17</div>
            <div class="timeline-body"><p>It's marked as outdated, I don't see this anymore.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aparcar">@aparcar</a> reviewed on 2024-10-23 09:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aparcar">@aparcar</a> on <code>clap_mangen/tests/snapshots/flatten_help.roff</code>:29 on 2024-10-23 09:17</div>
            <div class="timeline-body"><p>So nothing to do for me here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aparcar">@aparcar</a> on <code>clap_mangen/src/render.rs</code>:69 on 2024-10-23 09:20</div>
            <div class="timeline-body"><p>Applied</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aparcar">@aparcar</a> reviewed on 2024-10-23 09:20</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aparcar">@aparcar</a> reviewed on 2024-10-23 09:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aparcar">@aparcar</a> on <code>clap_mangen/src/render.rs</code>:87 on 2024-10-23 09:32</div>
            <div class="timeline-body"><p>This change no longer exists, it's marked outdated</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aparcar">@aparcar</a> reviewed on 2024-10-23 09:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aparcar">@aparcar</a> on <code>clap_mangen/tests/testsuite/roff.rs</code>:151 on 2024-10-23 09:33</div>
            <div class="timeline-body"><p>Done</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aparcar">@aparcar</a> on <code>clap_mangen/tests/testsuite/roff.rs</code>:118 on 2024-10-23 10:19</div>
            <div class="timeline-body"><p>I added all relevant tests from <code>help.rs</code> and at least the recursive stuff isn't working right now. Is the recursive stuff strictly required for this PR to move forward?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aparcar">@aparcar</a> reviewed on 2024-10-23 10:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-23 21:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/tests/testsuite/roff.rs</code>:342 on 2024-10-23 21:16</div>
            <div class="timeline-body"><p>Please add these tests like the other ones, in a commit before the feature work</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-23 21:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/tests/testsuite/roff.rs</code>:144 on 2024-10-23 21:16</div>
            <div class="timeline-body"><p>Are these tests still needed with the addition of the <code>--help</code> tests?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-23 21:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/src/render.rs</code>:68 on 2024-10-23 21:17</div>
            <div class="timeline-body"><p>I'm still seeing it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-23 21:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/src/render.rs</code>:87 on 2024-10-23 21:19</div>
            <div class="timeline-body"><p>Whether the lines this originally applied to are there or not, the problem is still there.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-23 21:21</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/src/render.rs</code>:93 on 2024-10-23 21:21</div>
            <div class="timeline-body"><p>There are other <code>to_string</code> calls but I believe they are needed as they should be stripping ANSI escape codes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2024-10-23 21:23</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/tests/testsuite/roff.rs</code>:118 on 2024-10-23 21:23</div>
            <div class="timeline-body"><p>The recursive behavior is part of the definition of <code>flatten_help</code>.  We could possibly split it out but we'd need to be tracking it somehow.  Its likely best to go ahead and do that as it might affect the design in important ways</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/aparcar">@aparcar</a> reviewed on 2025-02-10 19:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/aparcar">@aparcar</a> on <code>clap_mangen/src/render.rs</code>:68 on 2025-02-10 19:55</div>
            <div class="timeline-body"><p>Should be fixed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2025-07-10 15:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/src/render.rs</code>:58 on 2025-07-10 15:39</div>
            <div class="timeline-body"><p>This isn't recursive but should be (same with <code>flat_subcommands</code>)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2025-07-10 15:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>clap_mangen/tests/testsuite/roff.rs</code>:118 on 2025-07-10 15:39</div>
            <div class="timeline-body"><p>Split out the recursion conversation to https://github.com/clap-rs/clap/pull/5769/commits/11d560f1f74a7ce3b91cfad6417f302b7d3ff187#r2198095292</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> requested changes on 2025-07-10 15:41</div>
            <div class="timeline-body"><p>See https://github.com/clap-rs/clap/pull/5769#issuecomment-3057982003</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:09 UTC
    </footer>
</body>
</html>
