```yaml
number: 5998
title: "feat(clap-complete/unstable-dynamic): add '~' to HOME dir completion support"
type: pull_request
state: closed
author: eatradish
labels: []
assignees: []
base: master
head: home-dir-symbol
created_at: 2025-05-10T15:35:18Z
updated_at: 2025-08-26T19:46:33Z
url: https://github.com/clap-rs/clap/pull/5998
synced_at: 2026-01-10T01:57:50Z
```

# feat(clap-complete/unstable-dynamic): add '~' to HOME dir completion support

---

_Pull request opened by @eatradish on 2025-05-10 15:35_

if input starts with '~' will complete to `/home/USER`

<!--
Thanks for helping out!

Please link the appropriate issue from your PR.

If you don't have an issue, we'd recommend starting with one first so the PR can focus on the
implementation (unless its an obvious bug or documentation fix that will have
little conversation).
-->


---

_@epage reviewed on 2025-05-11 00:40_

---

_Review comment by @epage on `clap_complete/src/engine/custom.rs`:283 on 2025-05-11 00:40_

This is marked as unix-only but the dep is always added

However, should we support this on Windows?

---

_@epage reviewed on 2025-05-11 00:41_

---

_Review comment by @epage on `clap_complete/src/engine/custom.rs`:283 on 2025-05-11 00:41_

Technically, there are other variants of `~` expansion.  Should we support that?

---

_@epage reviewed on 2025-05-11 00:41_

---

_Review comment by @epage on `clap_complete/src/engine/custom.rs`:298 on 2025-05-11 00:41_

Why are we changing this to be more restrictive?

---

_@epage reviewed on 2025-05-11 00:42_

---

_Review comment by @epage on `clap_complete/src/engine/custom.rs`:280 on 2025-05-11 00:42_

We shouldn't be doing this

---

_@epage reviewed on 2025-05-11 00:43_

---

_Review comment by @epage on `clap_complete/Cargo.toml`:43 on 2025-05-11 00:43_

With `std::env::home_dir` being undeprecated, we should be using this through a polyfll.  I'll need to go create one before this can move forward.

---

_@epage reviewed on 2025-05-11 00:43_

---

_Review comment by @epage on `clap_complete/Cargo.toml`:43 on 2025-05-11 00:43_

(if it wasn't for that, I'd be hesitant to add this out of question of whether the extra dep is worth it)

---

_@eatradish reviewed on 2025-05-11 03:38_

---

_Review comment by @eatradish on `clap_complete/src/engine/custom.rs`:298 on 2025-05-11 03:38_

There doesn't seem to be a way for me to get `&OsStr` directly from `String`, maybe I should? (The reason for the change to String is that the `replace_range` method is only available for `String`)

```rust
let mut new_current = OsString::new();
new_current.write_str(&current).ok();

let mut candidates = complete_path(&new_current, current_dir, filter);
```

---

_@eatradish reviewed on 2025-05-11 03:41_

---

_Review comment by @eatradish on `clap_complete/src/engine/custom.rs`:283 on 2025-05-11 03:41_

 I'm not sure if this feature should be supported on Windows, as it does not seem to be used on Windows.

---

_@eatradish reviewed on 2025-05-11 03:44_

---

_Review comment by @eatradish on `clap_complete/src/engine/custom.rs`:280 on 2025-05-11 03:44_

Maybe I should have used  `let mut current = current.to_string_lossy().to_string();` ?

---

_@eatradish reviewed on 2025-05-11 03:47_

---

_Review comment by @eatradish on `clap_complete/src/engine/custom.rs`:283 on 2025-05-11 03:47_

I'm not sure about what they are, can you explain?

---

_@eatradish reviewed on 2025-05-11 03:57_

---

_Review comment by @eatradish on `clap_complete/Cargo.toml`:43 on 2025-05-11 03:57_

Perhaps we could copy that function from std? https://github.com/rust-lang/rust/blob/2682b88c526d493edeb2d3f2df358f44db69b73f/library/std/src/sys/unix/os.rs#L595

---
