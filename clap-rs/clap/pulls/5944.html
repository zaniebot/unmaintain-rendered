<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>chore(deps): Switch humantime to jiff - clap-rs/clap #5944</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>chore(deps): Switch humantime to jiff</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/clap-rs/clap/pull/5944">#5944</a>
        opened by <a href="https://github.com/oherrala">@oherrala</a>
        on 2025-03-08 15:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/oherrala">@oherrala</a></div>
            <div class="timeline-body"><p><a href="https://crates.io/crates/humantime"><code>humantime</code></a> crate seems to be unmaintained and <a href="https://crates.io/crates/jiff"><code>jiff</code></a> is provides same functionality. According to crates.io's stats clap is the most downloaded user of <code>humantime</code>.</p>
<p>Since <code>humantime</code> crate is only used in one example code this shouldn't cause any bigger change to project.</p>
<p>This is alternative to #5943 as proposed by @epage in https://github.com/clap-rs/clap/pull/5943#issuecomment-2708354291.</p>
<p>Ref. https://github.com/rustsec/advisory-db/pull/2249</p>
<!--
Thanks for helping out!

Please link the appropriate issue from your PR.

If you don't have an issue, we'd recommend starting with one first so the PR can focus on the
implementation (unless its an obvious bug or documentation fix that will have
little conversation).
-->

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>examples/typed-derive.rs</code>:22 on 2025-03-08 16:31</div>
            <div class="timeline-body"><p>I've not checked, does this get the human-format parsing or does that require further opt-in? And is there an unsigned option?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/epage">@epage</a> on <code>examples/typed-derive.rs</code>:22 on 2025-03-08 16:40</div>
            <div class="timeline-body"><p>I've not checked, does this get the human-format parsing or does that require further opt-in?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a> reviewed on 2025-03-08 16:40</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/oherrala">@oherrala</a> reviewed on 2025-03-08 17:00</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/oherrala">@oherrala</a> on <code>examples/typed-derive.rs</code>:22 on 2025-03-08 17:00</div>
            <div class="timeline-body"><p>It seems to work:</p>
<pre><code class="language-console">% cargo -q run --example typed-derive --features derive -- --sleep &quot;2 hours 42 minutes 5 seconds&quot; 
Args { optimization: None, include: None, bind: None, sleep: Some(2h 42m 5s), defines: [], port: 22, log_level: Info }
</code></pre>
<p>AFAIK I can't find unsigned <code>Duration</code>. But there's <a href="https://docs.rs/jiff/latest/jiff/struct.Span.html"><code>Span</code></a> which seems more complex type. The differences between <code>SignedDuration</code> and <code>Span</code> can be found here: https://docs.rs/jiff/latest/jiff/struct.SignedDuration.html#when-should-i-use-signedduration-versus-span</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>examples/typed-derive.rs</code>:22 on 2025-03-08 17:57</div>
            <div class="timeline-body"><p>For parsing (via <code>FromStr</code> or <code>serde::Deserialize</code>), both <code>jiff::SignedDuration</code> and <code>jiff::Span</code> will automatically handle both the &quot;friendly&quot; format and the ISO 8601 duration format: https://docs.rs/jiff/latest/jiff/struct.SignedDuration.html#parsing-and-printing</p>
<p>For <em>printing</em>, it defaults to ISO 8601 for interoperability reasons, but you can use <code>{:#}</code> to get the &quot;alternate&quot;, which is the friendly format.</p>
<p>For <em>serialization</em>, it also defaults to ISO 8601 for interopability reasons, but you can use the <a href="https://docs.rs/jiff/latest/jiff/fmt/serde/duration/friendly/compact/fn.optional.html"><code>jiff::fmt::serde::duration::friendly::compact::optional</code></a> Serde helper to opt into the friendly format.</p>
<p>The main <em>behavioral</em> change here is that <code>humantime</code> will happily parse something like <code>1month</code> into a <code>std::time::Duration</code> by giving it a fixed value of <code>30.44</code> days. Jiff will reject such things for <code>SignedDuration</code>. If you want to support that, you have to use <code>Span</code>, <a href="https://docs.rs/jiff/latest/jiff/_documentation/changelog/index.html#0116-2024-12-26">which I believe would also &quot;just work&quot; here</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2025-03-08 17:57</div>
            <div class="timeline-body"></div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:49:45 UTC
    </footer>
</body>
</html>
