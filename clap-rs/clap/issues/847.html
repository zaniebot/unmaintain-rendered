<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Respect TERM=dumb and emit no colour escape codes - clap-rs/clap #847</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Respect TERM=dumb and emit no colour escape codes</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/847">#847</a>
        opened by <a href="https://github.com/andreastt">@andreastt</a>
        on 2017-02-09 16:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/andreastt">@andreastt</a> on 2017-02-09 16:55</div>
            <div class="timeline-body"><p>Certain shells are not particularly happy with colour escape codes. To make them happy, clap should respect <code>TERM=dumb</code> and refrain from emitting colour escape codes.</p>
<h3>Rust Version</h3>
<p>rustc 1.15.0 (10893a9a3 2017-01-19)</p>
<h3>Affected Version of clap</h3>
<pre><code>% grep clap Cargo.toml
clap = &quot;2.19.0&quot;</code></pre>
<h3>Expected Behavior Summary</h3>
<p>For a program using clap to respect <code>TERM=dumb</code> and emit no colour escape codes.</p>
<h3>Actual Behavior Summary</h3>
<p>Program using clap emits colour escape codes as shown in https://github.com/BurntSushi/ripgrep/issues/353.</p>
<h3>Steps to Reproduce the issue</h3>
<p>Compile any program using clap as a dependency and use an unrecognised flag:</p>
<pre><code>% rg --color never -asd
�[1;31merror:�[0m Found argument '�[33m-d�[0m' which wasn't expected, or isn't valid in this context

USAGE:
    
    rg [OPTIONS] &lt;pattern&gt; [&lt;path&gt; ...]
    rg [OPTIONS] [-e PATTERN | -f FILE ]... [&lt;path&gt; ...]
    rg [OPTIONS] --files [&lt;path&gt; ...]
    rg [OPTIONS] --type-list

For more information try �[32m--help�[0m
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../BurntSushi/ripgrep/issues/353.html">BurntSushi/ripgrep#353</a> on 2017-02-09 16:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-02-09 17:43</div>
            <div class="timeline-body"><p>Thanks!</p>
<p>Relates to #836</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: errors</span> added by @kbknapp on 2017-02-09 17:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: intermediate</span> added by @kbknapp on 2017-02-09 17:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P3: want to have</span> added by @kbknapp on 2017-02-09 17:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: enhancement</span> added by @kbknapp on 2017-02-09 17:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: refactor</span> added by @kbknapp on 2017-02-09 17:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @kbknapp on 2017-02-09 17:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "2.21.0" by @kbknapp on 2017-02-12 16:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x blocker</span> added by @kbknapp on 2017-05-09 18:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> removed by @kbknapp on 2017-05-09 18:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nateozem">@nateozem</a> on 2017-05-15 05:21</div>
            <div class="timeline-body"><p>I wonder if someone can reference <code>TERM=dumb</code> is standardize across applications. Is there any documentation that explains how it should behave?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-05-15 10:49</div>
            <div class="timeline-body"><p>@nateozem This is the best I could find: https://linux.die.net/man/7/term --- TL;DR the <code>TERM=dumb</code> convention is quite old. The behavior today is to treat <code>TERM=dumb</code> as &quot;don't emit escape sequences because the terminal being used won't know how to use them.&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nateozem">@nateozem</a> on 2017-05-16 02:22</div>
            <div class="timeline-body"><p>@BurntSushi, interesting.
Seem like the behavior would depend on each individual machine. In most probability, everyone has the same capability for <code>dumb</code>, but there can be an instance where someone can change how the terminal type behaves by using the <code>tic</code> command.
On my system, I can do this to check the definition: <code>$ infocmp -L dumb</code></p>
<pre><code>$ infocmp -L dumb
#       Reconstructed via infocmp from file: /usr/share/terminfo/64/dumb
dumb|80-column dumb tty,
		auto_right_margin,
		columns#80,
		bell=^G, carriage_return=^M, cursor_down=^J,
		scroll_forward=^J,</code></pre>
<p>My expectation of moving forward is by calling &quot;curses interfaces to terminfo database&quot; (<code>$ man curs_terminfo(3X)</code>). What do you guys think?</p>
<p>When I discover anything more, I'll report back.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-05-16 02:28</div>
            <div class="timeline-body"><p>@nateozem Consulting terminfo is certainly one path. It's a complex one, but it's valid. On the other hand, just respecting <code>TERM=dumb</code> will solve a good number of problems. Perhaps not all of them, but some of them. :-)</p>
<p>An example of a popular piece of software that generally gets colors correct is GNU grep, but they don't consult terminfo at all. This sacrifices compatibility on some very obscure terminal environments, but standard ANSI escapes pretty much work everywhere. (And GNU grep supports <code>TERM=dumb</code> explicitly.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nateozem">@nateozem</a> on 2017-05-16 02:43</div>
            <div class="timeline-body"><p>We could do almost the same thing as they have done</p>
<p>http://git.savannah.gnu.org/cgit/grep.git/tree/lib/colorize-posix.c:</p>
<pre><code>/* Return non-zero if we should highlight matches in output to file
   descriptor FD.  */
int
should_colorize (void)
{
  char const *t = getenv (&quot;TERM&quot;);
  return t &amp;&amp; strcmp (t, &quot;dumb&quot;) != 0;
}</code></pre>
<p>It's very simple. Think this would work for us?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "2.21.0" by @kbknapp on 2018-02-02 01:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v3-alpha1" by @kbknapp on 2018-02-02 01:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by @kbknapp on 2018-02-05 15:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x blocker</span> removed by @kbknapp on 2018-02-05 15:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "v3-alpha.1" by @kbknapp on 2018-07-22 01:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v3-beta.1" by @kbknapp on 2018-07-22 01:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "v3-beta.1" by @pksunkara on 2020-02-01 07:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v3.0" by @pksunkara on 2020-02-01 07:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @pksunkara by @pksunkara on 2020-04-11 14:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-11 17:15</div>
            <div class="timeline-body"><p>Fixed by #963</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @pksunkara on 2020-04-11 17:15</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:31 UTC
    </footer>
</body>
</html>
