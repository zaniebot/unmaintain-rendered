<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate shell completions as part of the build process to assist cross compilation - clap-rs/clap #5562</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Generate shell completions as part of the build process to assist cross compilation</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/5562">#5562</a>
        opened by <a href="https://github.com/Flowdalic">@Flowdalic</a>
        on 2024-07-02 09:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Flowdalic">@Flowdalic</a> on 2024-07-02 09:31</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>4.5.8</p>
<h3>Describe your use case</h3>
<p>Gentoo currently improves on Rust cross-compilation. However many Rust packages in Gentoo generate the shell completions files by invoking the resulting binary, which will then output the shell completion (files). Unfortunately, this approach does not work when cross-compiling, since the resulting binary will be a binary of a different architecture than the build host.</p>
<p>See also https://www.mail-archive.com/gentoo-dev@lists.gentoo.org/msg99709.html</p>
<h3>Describe the solution you'd like</h3>
<p>The shell completion files should be an output of <code>cargo build</code> and not of the final binary.</p>
<h3>Alternatives, if applicable</h3>
<p><em>No response</em></p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @Flowdalic on 2024-07-02 09:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-07-05 16:02</div>
            <div class="timeline-body"><p>Not to sure what is expected of clap.  We <a href="https://docs.rs/clap_complete/latest/clap_complete/">document both workflows</a> and a reason to generate completions as part of the program (rather than <code>cargo build</code>) is so that the completions can be generated on-demand, rather than statically, so that they &quot;auto-update&quot; with the program (for non-distro use cases).  In fact, I'm going to be encouraging that workflow with the new completion system (#3166) as there is a tighter coupling between the completions and the users program.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-completion</span> added by @epage on 2024-07-05 16:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Flowdalic">@Flowdalic</a> on 2024-07-06 08:41</div>
            <div class="timeline-body"><blockquote>
<p>Not to sure what is expected of clap. We <a href="https://docs.rs/clap_complete/latest/clap_complete/">document both workflows</a></p>
</blockquote>
<p>I wasn't aware that clap is already able to generate the completions as part of the build. Thanks for pointing this out!</p>
<blockquote>
<p>In fact, I'm going to be encouraging that workflow</p>
</blockquote>
<p>Feel free to encourage it. But with my package-maintainer hat on, there is no need for that if the application is installed via means of the Linux distribution. Because then, the completions are installed system wide via the package manager of the used Linux distribution and updated as soon as the package is updated. So, please keep the <code>generate_to</code> functionality, as it is relevant when packaging the application.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2024-07-06 11:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5668.html">clap-rs/clap#5668</a> on 2024-08-12 15:15</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:09 UTC
    </footer>
</body>
</html>
