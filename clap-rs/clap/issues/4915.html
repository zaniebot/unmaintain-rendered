<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Printing help breaks REPL-like loop - clap-rs/clap #4915</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Printing help breaks REPL-like loop</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/4915">#4915</a>
        opened by <a href="https://github.com/dominicmeyer">@dominicmeyer</a>
        on 2023-05-18 14:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dominicmeyer">@dominicmeyer</a></div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Rust Version</h3>
<p>1.66.1</p>
<h3>Clap Version</h3>
<p>4.2.4</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">#[derive(Parser)]
#[command(multicall = true)]
pub struct ConfigCommand {
    #[command(subcomman)]
    pub cmd: Option&lt;ConfigSubCommand&gt;
}

#[derive(Subcommand)]
pub enum ConfigSubCommand {
    Quit, ...
}

fn main() {
    loop {
        let cmd = ConfigCommand::parse_from(vec![&quot;help&quot;]);

        match cmd {
            Quit =&gt; break, ...
        }
    }
}
</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<p>cargo run</p>
<h3>Actual Behaviour</h3>
<p>When running this, help gets printed as expected, but afterwards the loop exits.</p>
<h3>Expected Behaviour</h3>
<p>I expected help to print and afterwards start over again, until quit gets triggered.</p>
<h3>Additional Context</h3>
<p>Of course the code above will never hit quit, it's just the minimal way to replicate the problem. In my real application the user is giving the input and with any other command than help everything functions as expected. This loop is ment to be something like a REPL.</p>
<h3>Debug Output</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @dominicmeyer on 2023-05-18 14:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-05-18 14:33</div>
            <div class="timeline-body"><p><code>parse_from</code> will call <code>std::process:exit</code> on error.  What you want is <code>try_parse_from</code></p>
<p>See also https://docs.rs/clap/latest/clap/_derive/_cookbook/repl/index.html (though we don't yet have a derive version for this yet, all of the repl principles are the same)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2023-05-18 14:33</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:49:05 UTC
    </footer>
</body>
</html>
