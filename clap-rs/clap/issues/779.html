<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Replace colons with newlines in crate_authors!() - clap-rs/clap #779</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Replace colons with newlines in crate_authors!()</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/779">#779</a>
        opened by <a href="https://github.com/nabijaczleweli">@nabijaczleweli</a>
        on 2016-12-18 12:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/nabijaczleweli">@nabijaczleweli</a> on 2016-12-18 12:02</div>
            <div class="timeline-body"><p>Since <code>cargo</code>'s <code>$CARGO_PKG_AUTHORS</code> is <code>:</code>-separated (<a href="http://doc.crates.io/environment-variables.html">source</a>), it'd be nice to replace all colons with newlines in the macro making it much more end-user-friendly, e.g. this:</p>
<pre><code>p:\Rust\http&gt;target\debug\http -h
http 0.1.0
thecoshman &lt;thecoshman@gmail.com&gt;:nabijaczleweli &lt;nabijaczleweli@gmail.com&gt;
Host These Things Please - a basic HTTP server for hosting a folder fast and simply
</code></pre>
<p>Would turn into this:</p>
<pre><code>p:\Rust\http&gt;target\debug\http -h
http 0.1.0
thecoshman &lt;thecoshman@gmail.com&gt;
nabijaczleweli &lt;nabijaczleweli@gmail.com&gt;
Host These Things Please - a basic HTTP server for hosting a folder fast and simply
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nabijaczleweli">@nabijaczleweli</a> on 2016-12-18 12:24</div>
            <div class="timeline-body"><p>With some more magic and macro hand-parsing the implementation landed on my fork (see above-referenced commit). Is it quite alright as is for a PR or...?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-12-18 20:32</div>
            <div class="timeline-body"><p>I'm good with the idea üëç</p>
<p>What I would do is keep the <code>crate_authors!</code> macro the same, for backwards compatibility, but also add a macro arm of <code>crate_authors!</code> to allowing specifying a &quot;replacement&quot; character in case people want to use something like <code>\n\t</code>, etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-12-18 20:38</div>
            <div class="timeline-body"><p>I.e. adding:</p>
<pre><code class="language-rust">#[macro_export]
macro_rules! crate_authors {
    ($sep:expr) =&gt; {{
        use std::ops::Deref;
        use std::sync::{ONCE_INIT, Once};

        #[allow(missing_copy_implementations)]
        #[allow(non_camel_case_types)]
        #[allow(dead_code)]
        struct CARGO_AUTHORS {__private_field: ()}
        static CARGO_AUTHORS: CARGO_AUTHORS = CARGO_AUTHORS {__private_field: ()};

        impl Deref for CARGO_AUTHORS {
            type Target = String;

            #[allow(unsafe_code)]
            fn deref&lt;'a&gt;(&amp;'a self) -&gt; &amp;'a String {
                unsafe {
                    static mut LAZY: (*const String, Once) = (0 as *const String, ONCE_INIT);

                    let r = &amp;mut LAZY.0;
                    LAZY.1.call_once(|| {
                        *r = Box::into_raw(Box::new(env!(&quot;CARGO_PKG_AUTHORS&quot;).replace(':', $sep)));
                    });
                    &amp;*LAZY.0
                }
            }
        }

        &amp;CARGO_AUTHORS[..]
    }};
    () =&gt; {
        env!(&quot;CARGO_PKG_AUTHORS&quot;)
    };
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: macros</span> added by @kbknapp on 2016-12-18 20:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: intermediate</span> added by @kbknapp on 2016-12-18 20:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> added by @kbknapp on 2016-12-18 20:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: enhancement</span> added by @kbknapp on 2016-12-18 20:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @kbknapp on 2016-12-18 20:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nabijaczleweli">@nabijaczleweli</a> on 2016-12-18 20:43</div>
            <div class="timeline-body"><p>Well, the interface does stay backwards-compatible, just the result doesn't.
Plus, it'd be nice for everyone to be able to benefit from this w/o any changes to usercode, don't you think?</p>
<p>So, including your suggestion, the best compat/feature compromise seems to me like:</p>
<pre><code class="language-rust">#[macro_export]
macro_rules! crate_authors {
    ($sep:expr) =&gt; {{ /* magic */ }};
    () =&gt; {
        crate_authors!(&quot;\n&quot;)
    };
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-12-18 20:50</div>
            <div class="timeline-body"><blockquote>
<p>Plus, it'd be nice for everyone to be able to benefit from this w/o any changes to usercode, don't you think?</p>
</blockquote>
<p>Totally agree, but what I don't want to happen is people be relying on that colon (not sure why they would...??) with no way to get it back short of calling the <code>env</code> function themselves or be handling it in their own way. And I think in this particular case, adding, <code>crate_authors!(&quot;\n&quot;)</code> seems pretty minor and easy :wink:</p>
<p>So for the time being at least, I'd prefer to use the compromise since we can always pull that part out later and are left with only the enhancement if we deem that worth it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/780.html">clap-rs/clap#780</a> on 2016-12-18 20:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @homu on 2016-12-19 00:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:06 UTC
    </footer>
</body>
</html>
