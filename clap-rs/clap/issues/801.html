<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App::write_help does not yield the full help message - clap-rs/clap #801</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>App::write_help does not yield the full help message</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/801">#801</a>
        opened by <a href="https://github.com/phrohdoh">@phrohdoh</a>
        on 2017-01-02 19:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/phrohdoh">@phrohdoh</a> on 2017-01-02 19:38</div>
            <div class="timeline-body"><h3>Rust Version</h3>
<ul>
<li><code>rustc 1.16.0-nightly (4ecc85beb 2016-12-28)</code></li>
</ul>
<h3>Affected Version of clap</h3>
<ul>
<li><code>2.19.3</code></li>
</ul>
<h3>Expected Behavior Summary</h3>
<p>Outputs should be exactly the same.</p>
<h3>Actual Behavior Summary</h3>
<p>FLAGS section is missing.
<code>help</code> subcommand is missing.</p>
<h3>Steps to Reproduce the issue</h3>
<pre><code>tmba:sentinel-cli thill $ ./target/debug/sentinel-cli # uses results of `App::write_help`
sentinel-cli 0.1.0
Taryn Hill &lt;taryn@phrohdoh.com&gt;
CLI for Sentinel -- git hooks that guard you from yourself

USAGE:
    sentinel-cli [SUBCOMMAND]

SUBCOMMANDS:
    init    Initialize a new Sentinel project in the given directory
</code></pre>
<pre><code>tmba:sentinel-cli thill $ ./target/debug/sentinel-cli --help # displays generated help string
sentinel-cli 0.1.0
Taryn Hill &lt;taryn@phrohdoh.com&gt;
CLI for Sentinel -- git hooks that guard you from yourself

USAGE:
    sentinel-cli [SUBCOMMAND]

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

SUBCOMMANDS:
    help    Prints this message or the help of the given subcommand(s)
    init    Initialize a new Sentinel project in the given directory
</code></pre>
<h3>Sample Code</h3>
<pre><code class="language-rust">    let mut help_bytes: Vec&lt;u8&gt; = Vec::new();
    let app = App::new(&quot;sentinel-cli&quot;)
        .version(&quot;0.1.0&quot;)
        .author(&quot;Taryn Hill &lt;taryn@phrohdoh.com&gt;&quot;)
        .about(&quot;CLI for Sentinel -- git hooks that guard you from yourself&quot;)
        .subcommand(SubCommand::with_name(&quot;init&quot;)
            .about(&quot;Initialize a new Sentinel project in the given directory&quot;)
            .version(&quot;0.1.0&quot;)
            .author(&quot;Taryn Hill &lt;taryn@phrohdoh.com&gt;&quot;)
            .arg(Arg::with_name(&quot;PATH&quot;)
                .value_name(&quot;PATH&quot;)
                .index(1)));
    app.write_help(&amp;mut help_bytes).expect(&quot;Failed to capture help message&quot;);
    let matches = app.get_matches();

    let res: Result&lt;(), SentinelCliError&gt; = match matches.subcommand() {
        (&quot;init&quot;, Some(args)) =&gt; init_project(args),
        (cmd, _) if cmd.is_empty() =&gt; {
            let help_string = String::from_utf8(help_bytes).expect(&quot;Help message was invalid UTF8&quot;);
            println!(&quot;{}&quot;, help_string);
            Ok(())
        },
        (cmd, _) =&gt; Err(SentinelCliError::UnrecognizedCommand(cmd.into())),
    };
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-02 19:54</div>
            <div class="timeline-body"><p>Thanks for taking the time to file this! This is something I've been aware of and was originally somewhat by design as <code>write_help</code> was originally private. <code>clap</code> generates <code>--help</code> and <code>--version</code> lazily and not until one of the <code>get_matches_*</code> methods is called to prevent something like:</p>
<pre><code class="language-rust">let app = App::new(&quot;foo&quot;);
app.write_help(&amp;mut help).unwrap(); // if --help and --version are generated here
let m = app
    .arg(Arg::with_name(&quot;help&quot;)
        .long(&quot;--help&quot;)) // error here for two args having the long `--help`
    .get_matches();
</code></pre>
<p>I.e. modifying the help message after writing it. Although I do think this is a super niche case.</p>
<p>Since you're not the first person to note this, I think it may be time I just change that and cause <code>--help</code> and <code>--version</code> to be generated earlier if required.</p>
<hr />
<p>If you're trying to print the help message when no subcommand is received use <a href="https://docs.rs/clap/2.19.3/clap/enum.AppSettings.html#variant.SubcommandRequiredElseHelp"><code>AppSettings::SubcomamndRequiredElseHelp</code></a> :wink:</p>
<p>edit: fixed link</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> added by @kbknapp on 2017-01-02 19:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: help message</span> added by @kbknapp on 2017-01-02 21:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: intermediate</span> added by @kbknapp on 2017-01-02 21:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> added by @kbknapp on 2017-01-02 21:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: enhancement</span> added by @kbknapp on 2017-01-02 21:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @kbknapp on 2017-01-02 21:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "2.20.0" by @kbknapp on 2017-01-02 21:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @kbknapp on 2017-01-02 21:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: enhancement</span> removed by @kbknapp on 2017-01-02 21:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> removed by @kbknapp on 2017-01-02 21:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @homu on 2017-01-03 06:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/808.html">clap-rs/clap#808</a> on 2017-01-05 16:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-05 16:27</div>
            <div class="timeline-body"><p>I need to re-open and revert the commit that fixed this until the discussion in #808 is complete. Sadly 2.20.0 won't have this fix, but it's still possible for v2.21.0 :wink:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @kbknapp on 2017-01-05 16:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "2.20.0" by @kbknapp on 2017-01-05 16:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E: breaking change</span> added by @kbknapp on 2017-02-12 16:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v3-alpha1" by @kbknapp on 2018-02-02 01:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-02-02 01:56</div>
            <div class="timeline-body"><p>Closed in v3-master</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2018-02-02 01:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:24 UTC
    </footer>
</body>
</html>
