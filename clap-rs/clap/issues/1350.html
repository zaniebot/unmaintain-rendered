<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How to manually print help for subcommands? - clap-rs/clap #1350</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>How to manually print help for subcommands?</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/1350">#1350</a>
        opened by <a href="https://github.com/ehuss">@ehuss</a>
        on 2018-09-28 16:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ehuss">@ehuss</a> on 2018-09-28 16:24</div>
            <div class="timeline-body"><!--
Please use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`
-->

<h3>Affected Version of clap</h3>
<p>clap 2.32.0</p>
<h3>Bug or Feature Request Summary</h3>
<p>Is there a way to manually print the help output for subcommands?</p>
<p>Calling <code>print_help</code> on the base App only prints help for the base app.  Calling it on a subcommand App object means the help will be incomplete (doesn't include base app options, the command name is wrong, etc.).</p>
<p>To give more context, I am experimenting with having the <code>--help</code> option print the short help, and <code>--help --verbose</code> print long help.  I was going down the route of manually adding a &quot;help&quot; arg (and subcommand), but was unable to figure out a way to print the help for subcommands.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../rust-lang/cargo/issues/6104.html">rust-lang/cargo#6104</a> on 2018-10-04 00:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/xoac">@xoac</a> on 2019-02-19 12:58</div>
            <div class="timeline-body"><p>I have similar problem. I use <code>app read</code> sub-command and <code>read</code> is sub-command that do nothing it's just should print help that you can use <code>app read sub1</code> or <code>app read sub2</code> etc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ehuss">@ehuss</a> on 2019-02-19 14:46</div>
            <div class="timeline-body"><p>@xoac I think you can use <a href="https://docs.rs/clap/2.32.0/clap/enum.AppSettings.html#variant.SubcommandRequiredElseHelp">SubcommandRequiredElseHelp</a> on your <code>read</code> subcommand to accomplish that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2019-08-01 18:52</div>
            <div class="timeline-body"><p>I also have a use case for this: I have a subcommand (<code>subcmd</code>) that can either read its arguments from the command line via positional arguments (<code>app subcmd arg1 arg2 arg3</code>) or read the arguments from a file, if no positional arguments are given: (<code>other_command | app subcmd</code>).</p>
<p>If <code>app subcmd</code> is called without any arguments and <code>STDIN</code> is attached to a TTY (i.e. nothing is piped into the command), I want to show the help message of <code>subcmd</code>, because it is unlikely that the user wants to input the arguments via the keyboard.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: help message</span> added by @CreepySkeleton on 2020-02-02 04:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: subcommands</span> added by @CreepySkeleton on 2020-02-02 04:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> added by @CreepySkeleton on 2020-02-02 04:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by @CreepySkeleton on 2020-02-02 04:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by @CreepySkeleton on 2020-02-02 04:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../mike-engel/jwt-cli/issues/50.html">mike-engel/jwt-cli#50</a> on 2020-02-02 12:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/monoclex">@monoclex</a> on 2020-10-10 19:38</div>
            <div class="timeline-body"><p>I also have a usecase - I'd like to create an app which, upon running a command with <code>--help</code> (such as <code>myprogram do thing --help</code>) would provide information about what would happen when it &quot;does thing&quot; (sort of like a --dry-run argument)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-10-10 19:41</div>
            <div class="timeline-body"><p>@SirJosh3917 I don't think your use case fits here. And it is actually achievable with the current master by using the app setting <code>DisableHelpFlags</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/monoclex">@monoclex</a> on 2020-10-10 19:54</div>
            <div class="timeline-body"><p>@pksunkara In a scenario where my app can't provide any information (i.e. the user runs <code>myprogram --help</code>), I'd like to print to the user the help that would clap would normally print, which is where this issue would solve that - by allowing me to print the current help. Sorry if my use-case was unclear, and thank you for pointing me towards the desired app setting!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-10-10 20:16</div>
            <div class="timeline-body"><p>I still don't understand it. Can you please create a discussion with mock details and expected behavior?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/monoclex">@monoclex</a> on 2020-10-11 00:27</div>
            <div class="timeline-body"><p>Here's a mockup of some pseudo program:</p>
<pre><code>&gt; program install package
Installing &quot;package&quot; v 1.0.0...
Complete!

&gt; program install another-package --help
(i) help requested | program install another-package
- installation location: `./here` from environment variable INSTALL_LOCATION
- found &quot;another-package&quot; at version &quot;1.2.3&quot;

&gt; program install --help
(i) help requested | program install
- installation location: `./here` from environment variable INSTALL_LOCATION
- required argument &quot;&lt;package&gt;&quot; missing. printing command usage:
program-install
install a dependency with program

USAGE:
    program install &lt;package&gt;

FLAGS:
    -h, --help        Gets help

ARGS:
    &lt;package&gt; - the package

&gt; program install
error: required argument &lt;package&gt; not specified
program-install
install a dependency with program

USAGE:
    program install &lt;package&gt;

FLAGS:
    -h, --help        Gets help

ARGS:
    &lt;package&gt; - the package

&gt; program
(i) downloading all dependencies...
done!

&gt; program
/!\ no dependency.list exists, make sure one exists if you're trying to download dependencies! displaying help:
program
does things

USAGE:
    program [subcommand] ...

ARGS:
    -h, --help      does help

SUBCOMMANDS:
    install         installs
</code></pre>
<p>As you can see, the situation for when help is displayed varies wildly. Ideally, given an <code>&amp;App</code> or <code>&amp;SubCommand</code>, to turn that into a <code>&amp;str</code> that can then be used by users of the clap library to do what they wish with. For my specific usecase, it would be nice if there was an easy way to check if <code>--help</code> was supplied for a given <code>ArgMatches</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-10-11 06:53</div>
            <div class="timeline-body"><p>@SirJosh3917 Here you can just print the help of the subcommand using <code>print_help</code> unlike what the original request is asking about.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> removed by @pksunkara on 2021-08-13 10:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/104.html">epage/clapng#104</a> on 2021-12-06 17:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: subcommands</span> removed by @epage on 2021-12-08 20:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> removed by @epage on 2021-12-08 21:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @epage on 2021-12-08 21:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> removed by @epage on 2021-12-09 18:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> added by @epage on 2021-12-09 18:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> removed by @epage on 2021-12-09 18:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-mentor</span> added by @epage on 2021-12-09 18:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-mentor</span> removed by @epage on 2022-01-07 13:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> added by @epage on 2022-01-07 13:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-01-07 13:49</div>
            <div class="timeline-body"><p>I think the main question I have on this is what the API would look like.  Printing the help for a subcommand usually requires context from the parent <code>App</code>.  So it seems like the API would need to be <code>App::print_help(&amp;mut self, subcommands: impl Iterator&lt;Item=&amp;str&gt;) -&gt; std::io::Result&lt;()&gt;</code>.  <strong>This would require manually building up the list of nested subcommands.  Does that work?</strong></p>
<p>If we were willing to keep <code>App</code> around during <code>ArgMatches</code> (so far that has intentionally been avoided to allow apps to keep total memory usage down assuming apps keep their <code>ArgMatches</code> around through their lifetime) we could attach to it a proxy object that could handle it for us, so you could just ask the appropriate <code>ArgMatches</code> for your subcommand and it would give you what you want.</p>
<p>Whatever our approach, we should keep in mind help, usage, and error <code>App</code> functions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-05-04 21:45</div>
            <div class="timeline-body"><p>The following tests prints the help of a subcommand</p>
<pre><code class="language-rust">#[test]
fn multicall_render_help() {
    static EXPECTED: &amp;str = &quot;\
foo-bar 1.0.0
USAGE:
    foo bar [value]
ARGS:
    &lt;value&gt;    
OPTIONS:
    -h, --help       Print help information
    -V, --version    Print version information
&quot;;
    let mut cmd = Command::new(&quot;repl&quot;)
        .version(&quot;1.0.0&quot;)
        .propagate_version(true)
        .multicall(true)
        .subcommand(Command::new(&quot;foo&quot;).subcommand(Command::new(&quot;bar&quot;).arg(Arg::new(&quot;value&quot;))));
    cmd.build();
    let subcmd = cmd.find_subcommand_mut(&quot;foo&quot;).unwrap();
    let subcmd = subcmd.find_subcommand_mut(&quot;bar&quot;).unwrap();

    let mut buf = Vec::new();
    subcmd.write_help(&amp;mut buf).unwrap();
    utils::assert_eq(EXPECTED, String::from_utf8(buf).unwrap());
}
</code></pre>
<p>Key elenents</p>
<ul>
<li>Call <code>cmd.build()</code></li>
<li>Recurse into the intended subcommand with <code>find_subcommand_mut</code></li>
<li>Call <code>write_help</code> or <code>print_help</code> on the discovered subcommand</li>
</ul>
<p>Is that sufficient for this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> removed by @epage on 2022-05-04 21:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-author</span> added by @epage on 2022-05-04 21:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-06-02 14:31</div>
            <div class="timeline-body"><p>Without further feedback, I'm going to assume the given answer is sufficient for this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2022-06-02 14:31</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:07 UTC
    </footer>
</body>
</html>
