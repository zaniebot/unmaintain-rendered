<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add blank line between items in long help - clap-rs/clap #1642</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add blank line between items in long help</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1642">#1642</a>
        opened by <a href="https://github.com/casey">@casey</a>
        on 2020-01-23 22:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/casey">@casey</a> on 2020-01-23 22:35</div>
            <div class="timeline-body"><p>Currently, items in a long help message sometimes have a blank line between them, and sometimes run together. Compare this output from clap:</p>
<pre><code>FLAGS:
    -h, --help
            Print help message

    -u, --unstable
            Enable unstable features. To avoid premature stabilization and excessive version churn,
            unstable features are unavailable unless this flag is set. Unstable features are not
            bound by semantic versioning stability guarantees, and may be changed or removed at any
            time.
    -V, --version
            Print version number
</code></pre>
<p>With this output from <code>man man</code>:</p>
<pre><code>       -B     Specify  which  browser  to  use  on  HTML files.  This option overrides the
              BROWSER environment variable. By default, man uses /usr/bin/less-is,

       -H     Specify a command that renders HTML files as text.   This  option  overrides
              the HTMLPAGER environment variable. By default, man uses /bin/cat,

       -S  section_list
              List  is  a  colon separated list of manual sections to search.  This option
              overrides the MANSECT environment variable.
</code></pre>
<p>It might be easier to visually parse if the items in a long help message were always separated by a blank line.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-01-23 22:40</div>
            <div class="timeline-body"><p>Not sure about the default behavior, but sounds like we can make a global setting for it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../TeXitoi/structopt/issues/344.html">TeXitoi/structopt#344</a> on 2020-01-26 20:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/casey">@casey</a> on 2020-01-30 09:30</div>
            <div class="timeline-body"><p>Hmm, I just thought that, regardless of the default, it should probably be consistent, so if <code>AppSettings::BlankLinesBetweenItems</code> (just making up a name) isn't passed, then there should be no blank lines between items. I think the current behavior depends on if <code>long_help</code> is passed or not. Items with <code>long_help</code> in my help message don't have blank lines after them, and items without <code>long_help</code> have blank lines.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-02-01 19:21</div>
            <div class="timeline-body"><p>I don't think there should be a setting for this. Blank line between flags and options should exist since it's a standard.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: help message</span> added by @pksunkara on 2020-02-01 19:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by @pksunkara on 2020-02-01 19:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @pksunkara on 2020-02-01 19:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @pksunkara on 2020-02-01 19:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: enhancement</span> added by @pksunkara on 2020-02-01 19:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by @pksunkara on 2020-02-01 19:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @pksunkara on 2020-02-01 19:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-02 02:45</div>
            <div class="timeline-body"><p>For <code>--help</code> - maybe, but what if all of your descriptions are short and fit in one line?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-02-02 06:11</div>
            <div class="timeline-body"><p>Hmm.. Doing <code>enquirer select --help</code> or <code>enquirer select -h</code> is giving the same thing because the long help messages are just one line.</p>
<pre><code>enquirer-select 0.3.0
Prompt that allows the user to select from a list of options

USAGE:
    enquirer select [FLAGS] [OPTIONS] --message &lt;message&gt; [items]...

FLAGS:
    -h, --help     Prints help information
    -p, --paged    Enables paging. Uses your terminal size

OPTIONS:
    -m, --message &lt;message&gt;      Message for the prompt
    -s, --selected &lt;selected&gt;    Specify number of the item that will be selected by default

ARGS:
    &lt;items&gt;...    Items that can be selected
</code></pre>
<p>Maybe this is occurring when long help messages are multi line only. Wonder what happens with a mix of them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-02 06:16</div>
            <div class="timeline-body"><p>I propose:</p>
<ul>
<li>For one-line helps only - no blank line by default</li>
<li>If at least one of help messages doesn't fit in one line - blank lines between all options just to be consistent</li>
<li><code>AppSetting::AlwaysBlankLIne</code> and <code>AppSetting::NeverBlankLine</code> (I suck at naming things) so developers are able to manually chose the style they want</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-03-07 15:59</div>
            <div class="timeline-body"><p><code>AppSetting::AlwaysBlankLine</code> and <code>AppSetting::NeverBlankLine</code> does not seemed to play well with one-line helps only - no blank line by default.</p>
<p>Shouldn't there be 3 options? I think I propose an additional <code>AppSetting::AutoBlankLine</code>, where it blank lines only if it does not fit, for the one-line helps only. <code>AppSetting::AlwaysBlankLine</code> should always blank line even thought it fits and <code>AppSetting::NeverBlankLine</code> to never blank lines like how it is currently.</p>
<p>As well, how should we define one-line helps? Is it according to the terminal width? Is it according to 80 characters width? Or according to <code>$MANWIDTH</code> (I set this)?</p>
<p>It may looks bad too if the terminal is very wide and one-line helps without blank lines that is too long may hard readability (looking at <code>youtube-dl</code> help).</p>
<p>Having it too short without blank lines is bad too (looking at <code>aria2c</code> help) especially when the short and long option takes so many characters.</p>
<p><code>you-get</code> help is probably what we want here, it even aligns the description across groups (flags / options).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-03-07 16:51</div>
            <div class="timeline-body"><p>I agree regarding the auto.</p>
<p>I think we are checking terminal width somewhere in the code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-03-14 15:26</div>
            <div class="timeline-body"><p>@pickfire If you want something easy to pick up, this issue should be good to go ðŸ˜„</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-03-16 01:30</div>
            <div class="timeline-body"><p>@pksunkara Yes, this issue seemed easy but the discussion is not complete so I am thinking to take it later once things become clearer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-03-17 21:29</div>
            <div class="timeline-body"><p>@pickfire I believe both @pksunkara and I agree on the design you described in a comment above. Regarding to aligning to the terminal's width - let's just start working on it and see what tools we have available at our disposal.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1790.html">clap-rs/clap#1790</a> on 2020-04-10 01:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-05-01 16:59</div>
            <div class="timeline-body"><pre><code class="language-rust">    struct Flags: u64 {
        const BLANK_LINE_ALWAYS              = 1 &lt;&lt; 42;
        const BLANK_LINE_AUTO                = 1 &lt;&lt; 43;
</code></pre>
<p>Can we only keep two flag since we can use just two flags to represent 3 of the real flags which can save up some bits for the future? Similar this can be applied to <code>COLOR_ALWAYS</code>, <code>COLOR_AUTO</code>, <code>COLOR_NEVER</code> as well.</p>
<p>@CreepySkeleton I planned to change it to <code>BlankLineAlways</code>, <code>BlankLineAuto</code> and <code>BlankLineNever</code> since that can make these in the documentation side by side and easier to discover.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-05-01 18:05</div>
            <div class="timeline-body"><blockquote>
<p>I planned to change it to BlankLineAlways, BlankLineAuto and BlankLineNever since that can make these in the documentation side by side and easier to discover.</p>
</blockquote>
<p>That would be cool.</p>
<p>Regarding to concrete representation, I truly believe that the decision here should not be based on &quot;let's save a few bits/bytes&quot; considerations. This bitfield is not part of public API, if we decide that <code>u64</code> is not enough at some point, we can simply bump it to <code>u128</code>. <em>128 bits ought to be enough for anybody</em>.</p>
<p>I kind of don't know what would be the best solution here. The problem here is: bits are wery suitable for representing binary yes/no values, but the setting in question has three values, yes/no/detect. Bitflags don't really <em>fit</em>. Maybe a separate enum? @kbknapp @pksunkara any ideas?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2020-05-01 19:26</div>
            <div class="timeline-body"><p>Perhaps I'm under-thinking it, but I don't think this should be consumer configurable. These rules seem pretty simple and rely on already implemented rules of just determining if multi-line help should be displayed or not:</p>
<ul>
<li>If clap decides something should have a multi-line help, it should insert a blank line directly following the message.</li>
<li>If at least one argument in a heading is determined to need mult-line help, all arguments in that heading should have mult-line help (and thus a blank line inserted directly after)</li>
</ul>
<p>The issue described by @casey seems to only appear if the <code>long_help</code> is over 120 chars, otherwise it doesn't seem to appear and all seems to work (blank lines are where they should be).</p>
<p>So I think this is actually a bug.</p>
<p>While testing for this I found what I would <em>maybe</em> deem a bug when the <code>wrap_help</code> is not enabled (will post a new issue an link here momentarily).</p>
<p>Edit: See the last example of #1891 to see the bug from this issue in action. Make the <code>long_help</code> less than 120 chars, and this issue goes away.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1891.html">clap-rs/clap#1891</a> on 2020-05-01 19:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-05-02 02:41</div>
            <div class="timeline-body"><blockquote>
<p>I kind of don't know what would be the best solution here. The problem here is: bits are wery suitable for representing binary yes/no values, but the setting in question has three values, yes/no/detect. Bitflags don't really fit. Maybe a separate enum? @kbknapp @pksunkara any ideas?</p>
</blockquote>
<p>That three values could be fitted into two bytes since only one of of the three can be used, so it is either the following options:</p>
<ul>
<li><code>10</code> auto</li>
<li><code>01</code> always</li>
<li><code>00</code> never</li>
</ul>
<p>And also, we can just read 2 bytes, of course it is already in memory but I don't see why we do that since it is not possible to have auto but with the other flag set.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: enhancement</span> removed by @pksunkara on 2020-05-02 06:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @pksunkara on 2020-05-02 06:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-05-02 06:24</div>
            <div class="timeline-body"><p>Since this is now a bug and not an enhancement, we don't need the flags at all.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-05-02 08:02</div>
            <div class="timeline-body"><p>@pksunkara Err, so what should I do here? Anything that I can help with?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-05-02 11:31</div>
            <div class="timeline-body"><p>Try to fix the bug? In the test case of first comment of this issue, there should always be an empty line.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-05-16 04:20</div>
            <div class="timeline-body"><p>@casey Can we see the source code for the output? Are you perhaps using <code>long_help</code>?</p>
<pre><code class="language-rust">        Arg::new(&quot;arg&quot;)
            .long_help(&quot;help help help help&quot;)
</code></pre>
<p>Or do you do it?</p>
<pre><code class="language-rust">        Arg::new(&quot;arg&quot;)
            .long_help(&quot;help help help help
&quot;)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/casey">@casey</a> on 2020-05-16 04:57</div>
            <div class="timeline-body"><p>I no longer use <code>long_help</code>, but I think this is the last version of my code which had separate <code>help</code> and <code>long_help</code>: https://github.com/casey/intermodal/commit/4fffa777b4af5afee208cfffb7d6de5b4972aaf6</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-05-16 13:53</div>
            <div class="timeline-body"><p>I believe the issue is related to <code>long_help</code>. I cannot seemed to reproduce this, is this still reproducible?</p>
<pre><code class="language-rust">fn blank_lines_between_long_help() {
    let app = App::new(&quot;myapp&quot;).arg(Arg::new(&quot;unstable&quot;).short('u').about(
        &quot;Enable unstable features. To avoid premature stabilization and
excessive version churn, unstable features are unavailable unless this flag is
set. Unstable features are not bound by semantic versioning stability
guarantees, and may be changed or removed at any time.&quot;,
    ));
    assert!(utils::compare_output(
        app,
        &quot;myapp --help&quot;,
        ISSUE_1642_LONG_HELP,
        false
    ));
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mkantor">@mkantor</a> on 2020-08-11 20:05</div>
            <div class="timeline-body"><p>Any updates on this issue?</p>
<p>@pickfire it sounded like you were working on it, but the discussion here trailed off and I can't find any related pull requests so I'm assuming it's up for grabs? @pksunkara / @kbknapp / @CreepySkeleton is the consensus still that this is a bug and that a fix without a setting would be acceptable?</p>
<hr />
<p>BTW, the <a href="https://docs.rs/clap/2.33.2/clap/struct.Arg.html#method.long_help"><code>long_help</code> doc</a> is currently incorrect; it describes the behavior as if this issue were fixed.</p>
<p>It says the output for the example code looks like this:</p>
<pre><code>FLAGS:
   --config
        The config file used by the myprog must be in JSON format
        with only valid keys and may not contain other nonsense
        that cannot be read by this program. Obviously I'm going on
        and on, so I'll stop now.

-h, --help
        Prints help information

-V, --version
        Prints version information
</code></pre>
<p>But if you try that exact code with clap 2.33.2, what you actually see is this:</p>
<pre><code>FLAGS:
        --config     
            The config file used by the myprog must be in JSON format
            with only valid keys and may not contain other nonsense
            that cannot be read by this program. Obviously I'm going on
            and on, so I'll stop now.
    -h, --help       
            Prints help information

    -V, --version    
            Prints version information
</code></pre>
<p>(Without an empty line before <code>-h, --help</code>.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../mkantor/clap/pulls/1.html">mkantor/clap#1</a> on 2020-08-11 22:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-08-11 22:57</div>
            <div class="timeline-body"><p>@mkantor Go ahead and work on the issue. Yes, it's still a bug. Regarding the long_help doc, please check master instead of v2.33 on docs.rs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2058.html">clap-rs/clap#2058</a> on 2020-08-11 23:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mkantor">@mkantor</a> on 2020-08-11 23:05</div>
            <div class="timeline-body"><p>Bam! #2058</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @bors[bot] on 2020-08-12 00:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-08-12 04:38</div>
            <div class="timeline-body"><p>@mkantor I was working on it but I couldn't reproduce it so I stopped working on it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../TeXitoi/structopt/issues/471.html">TeXitoi/structopt#471</a> on 2021-03-25 11:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:34:05 UTC
    </footer>
</body>
</html>
