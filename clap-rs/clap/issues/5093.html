<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow customizing styling of `[default]`, `[possible values]`, `[env]` in arg description - clap-rs/clap #5093</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow customizing styling of `[default]`, `[possible values]`, `[env]` in arg description</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/5093">#5093</a>
        opened by <a href="https://github.com/epage">@epage</a>
        on 2023-08-28 14:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/epage">@epage</a> on 2023-08-28 14:40</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>4.3.3</p>
<h3>Describe your use case</h3>
<p>From https://github.com/clap-rs/clap/issues/3234#issuecomment-1523123649</p>
<blockquote>
<p>I cannot find the style to use to change the appearance of the default and possible values. They always appear white. Is that not currently supported?</p>
<img alt="Screenshot 2023-04-26 at 1 51 01 PM" width="973" src="https://user-images.githubusercontent.com/16580576/234539329-81d4ab72-858c-4991-82db-8cfe02cb740e.png">

<p>I understand that this might not be directly related to this issue, so I can open a new one if that's more appropriate.</p>
</blockquote>
<h3>Describe the solution you'd like</h3>
<p>Allow styling to either help it stand out from the rest of the description</p>
<h3>Alternatives, if applicable</h3>
<p><em>No response</em></p>
<h3>Additional Context</h3>
<p>From https://github.com/clap-rs/clap/issues/3234#issuecomment-1531541590</p>
<blockquote>
<p>Besides naming the styling element for defaults, possible values, and env variables, I'm curious on how people think we should style it.</p>
<p>Some options I thought of:</p>
<pre><code>* `{spec}[default: true]{reset}` (all styled the same)

* `{spec}[default: {literal}true{reset}{spec}]{reset}` (outer-styled, value stuled)

* `[{spec}default:{reset} {literal}true{reset}]` (key-styled, values-styled)</code></pre>
</blockquote>
<p>So long as we only use new style definitions, it is not a major or minor breaking change according to our support policy.  See https://github.com/clap-rs/clap/blob/master/CONTRIBUTING.md#compatibility-expectations</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @epage on 2023-08-28 14:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-help</span> added by @epage on 2023-08-28 14:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> added by @epage on 2023-08-28 14:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3234.html">clap-rs/clap#3234</a> on 2023-08-28 14:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GilShoshan94">@GilShoshan94</a> on 2024-04-25 22:58</div>
            <div class="timeline-body"><p>Hi, we can also add <code>[aliases]</code> and <code>[short aliases]</code> as well, there are at the same place in the code.</p>
<p>I am in favor for:</p>
<blockquote>
<p><code>{spec}[default: {literal}true{reset}{spec}]{reset}</code> (outer-styled, value styled)</p>
</blockquote>
<p>The reason is the stay consistent with how <code>placeholder</code> style is applied (not just the key but the delimiters <code>[]</code> and <code>&lt;&gt;</code> are styled as well).</p>
<p>For that, we would need to add one more field to the struct <code>Styles</code>, that we would name <code>spec</code>.</p>
<p>I looked into the code and found that the modification should occures in <code>clap_builder/src/builder/styling.rs</code> (for <code>Styles</code>) and in <code>clap_builder/src/output/help_template.rs</code> to apply the style. (correct me if I'm wrong please)</p>
<p>I am ready to work on this and to submit a PR but I have to admit that I am a bit confused about the mixed used of <code>StyledStr</code> and simple <code>&amp;str</code>. Overall I see how styles are applied with <code>render()</code> and <code>render_reset()</code>. I just want to make sure how to write the code in the way that styles are not applied if <code>clap::ColorChoice</code> is set to <code>Never</code>.</p>
<p>@epage Can you guide me on this precise point please ? And also, is there another place where I need to edit code ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-04-26 00:26</div>
            <div class="timeline-body"><blockquote>
<p>I just want to make sure how to write the code in the way that styles are not applied if clap::ColorChoice is set to Never.</p>
</blockquote>
<p>You don't need to worry about it.  The styling design that clap uses follows the idea of decoupling the presentation from the medium its being rendered to.  We style everything with colors as needed.  When we output, instead of <code>std::io::stdout</code>, we use <code>anstream::stdout</code> which takes our ANSI escape codes and renders them as needed.  For the user, if they are choosing not to use <code>anstream</code>, <code>StyledStr</code> lets them control the styling by offering the different ways of doing <code>Display</code>.</p>
<blockquote>
<p>The reason is the stay consistent with how placeholder style is applied (not just the key but the delimiters [] and &lt;&gt; are styled as well).</p>
</blockquote>
<p>While I understand the principle, I think we also need to keep in mind how all of this will look.  When I was styling Cargo's output, I had considered using <code>{literal}</code> in more places (e.g. <code>Arg::help</code>) but i was worried that it was going to be too distracting from the primary focus of the output.  I will say this is likely more important in <code>-h</code> than in <code>--help</code> (with truly long form help).  I think for myself, I would render the <code>[]</code> content in a single style.  If terminals consistently rendered italics in a reasonable way, I'd likely use that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GilShoshan94">@GilShoshan94</a> on 2024-04-28 12:54</div>
            <div class="timeline-body"><p>Hi @epage,</p>
<p>I started to work on it. I add a <code>spec</code> field to the <code>Styles</code> struct.
After reading you, I decide to simply try several styling and to let you decide what do you like the most:</p>
<p>A) <code>{spec}[default: true]{reset}</code>
<img src="https://github.com/clap-rs/clap/assets/29143941/881e3992-82d5-43cf-8298-6568c2353b04" alt="image" /></p>
<p>B) <code>[{spec}default: true{reset}]</code>
<img src="https://github.com/clap-rs/clap/assets/29143941/ecc4eace-8ce1-46ac-a17c-adb06fbdad5d" alt="image" /></p>
<p>C) <code>[{spec}default{reset}: true]</code>
<img src="https://github.com/clap-rs/clap/assets/29143941/7367294d-afdf-4131-b635-6c5bb4e4dadb" alt="image" /></p>
<p>D) <code>{spec}[default:{reset} {literal}true{reset}{spec}]{reset}</code>
<img src="https://github.com/clap-rs/clap/assets/29143941/3c35ae97-8a8b-42b1-a854-b3cad9ecbf67" alt="image" /></p>
<p>E) <code>[{spec}default{reset}: {literal}true{reset}]</code>
<img src="https://github.com/clap-rs/clap/assets/29143941/aa13e62e-5518-49e8-955d-4bb6977fc931" alt="image" /></p>
<hr />
<p>In the samples above, I used this style:</p>
<pre><code class="language-rust">fn get_cli_styles() -&gt; Styles {
    use clap::builder::styling::AnsiColor;
    Styles::styled()
        .header(AnsiColor::Green.on_default().bold())
        .usage(AnsiColor::Green.on_default().bold())
        .literal(AnsiColor::Cyan.on_default().bold())
        .placeholder(AnsiColor::Cyan.on_default())
        .error(AnsiColor::Red.on_default().bold())
        .valid(AnsiColor::Green.on_default().bold())
        .invalid(AnsiColor::Yellow.on_default().bold())
        .spec(AnsiColor::Green.on_default())
}
</code></pre>
<p>Personall, I think I prefer C) and E).</p>
<p>Also, while working on it, I can easily make the styling even more customizable by allowing the user to specify a style for each &quot;spec&quot;, I mean for <code>default</code>, <code>env</code>, <code>possible values</code>, ....
I would still leave a <code>.spec(...)</code> method to set them all at once, but the user could do something like this:</p>
<pre><code class="language-rust">fn get_cli_styles() -&gt; Styles {
    use clap::builder::styling::AnsiColor;
    Styles::styled()
        .header(AnsiColor::Green.on_default().bold())
        .usage(AnsiColor::Green.on_default().bold())
        .literal(AnsiColor::Cyan.on_default().bold())
        .placeholder(AnsiColor::Cyan.on_default())
        .error(AnsiColor::Red.on_default().bold())
        .valid(AnsiColor::Green.on_default().bold())
        .invalid(AnsiColor::Yellow.on_default().bold())
        .spec(AnsiColor::Green.on_default()) // set fallback style for `[env], [default], [possible values], [aliases] and [short aliases]`
        .env(AnsiColor::Magenta.on_default() // set style just for `env` keyword.
}
</code></pre>
<p>I can do this but it feels a bit too much maybe ?</p>
<hr />
<ol>
<li>Can you please let me know which styling do you prefer me to do for the PR ? (I will complete with the long help too accordingly)</li>
<li>Should I add more customization or keep it more simple and less flexible with only one field &quot;spec&quot; ?</li>
<li>(Does &quot;spec&quot; for the styling field name makes sense ? or do you have a better name for this ?)</li>
<li>For the &quot;Default terminal styling&quot; method on <code>Styles</code> (<code>styled()</code>) which default style do you want ? italic effect simply ?</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-04-29 15:38</div>
            <div class="timeline-body"><blockquote>
<p>Can you please let me know which styling do you prefer me to do for the PR ? (I will complete with the long help too accordingly)</p>
</blockquote>
<p><code>[]</code> are part of it and should be colored with the type of spec, leading to (A) and (D).</p>
<p>That still leaves us trying to balance</p>
<ul>
<li>People who want these to stand out</li>
<li>People who don't want noise</li>
</ul>
<p>If we do (D) with <code>{literal}</code>, there isn't much choice.  If we do (A), then it could be harder to parse.</p>
<p>Maybe one way to balance this is to have</p>
<ul>
<li><code>inline_spec</code></li>
<li><code>inline_spec_value</code> (defaults to <code>inline_spec</code>)</li>
</ul>
<blockquote>
<p>Should I add more customization or keep it more simple and less flexible with only one field &quot;spec&quot; ?</p>
</blockquote>
<p>Let's keep it simple for the first release and see where to go.  This works towards our balancing of functionality, best practices, binary size, and compile times.  The best practices is referring to the fact that we shouldn't be encouraging people to make their output a rainbow.  imo we need strong use cases to show why more specific styling is needed.</p>
<blockquote>
<p>(Does &quot;spec&quot; for the styling field name makes sense ? or do you have a better name for this ?)</p>
</blockquote>
<p>I think prefixing with &quot;inline&quot; helps distinguish this from our possible-values output for <code>--help</code></p>
<p>As for <code>spec</code>, that name doesn't work too well but I've not come up with a better one.</p>
<p>For brainstorming</p>
<ul>
<li>Annotation</li>
<li>Context</li>
<li>Auto</li>
</ul>
<blockquote>
<p>For the &quot;Default terminal styling&quot; method on Styles (styled()) which default style do you want ? italic effect simply ?</p>
</blockquote>
<p>Looking at our <a href="https://github.com/clap-rs/clap/blob/master/CONTRIBUTING.md#compatibility-expectations">compatibility expectations</a>, we probably need to start with a default style.  I'm mixed about whether changing that style would constitute a minor or a major release.  At the moment, I'm leaning towards major.</p>
<p>If/when we get to that point, italic would be a bad default for us to use because it is aliased to Invert in a lot of terminals which stands out glaringly.   I somewhat favor &quot;dimmed&quot; but I know some people who say that is unreadable on their terminal.  Likely, we'd stick with default unless we decide to add colors into our default styling.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GilShoshan94">@GilShoshan94</a> on 2024-05-02 22:39</div>
            <div class="timeline-body"><p>Hi @epage,</p>
<p>I implemented according to your feedback, it passed the <code>cargo test</code>, but it doesn't mean too much since it's about styling (except that nothing is fundamentally broken).</p>
<p>I went with <code>inline_context</code> and <code>inline_context_value</code> for the setting name.
The default is simple unstyled as you requested.</p>
<p>I just have one problem with the styling of &quot;Possible Values:&quot; (for enumerated values / multiple choices):
For regular <code>help</code> (<code>-h</code>): It's ok, I styled like the others inline contexts case.
But for the <code>long_help</code> (<code>--help</code>), currently the enumerated values are already styled with the <code>literal</code> style (<a href="https://github.com/clap-rs/clap/blob/d681a81dd7f4d7ff71f2e65be26d8f90783f7b40/clap_builder/src/output/help_template.rs#L714">see here in code</a>)</p>
<p>For now I left it as it is probabling at least a minor release.
It feels a bit incosistent now, and I think I should change the style to <code>inline_context_value</code>.</p>
<p>I am waiting for your feedback, in the meantimes I will do my PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5482.html">clap-rs/clap#5482</a> on 2024-05-02 22:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GilShoshan94">@GilShoshan94</a> on 2024-05-02 23:47</div>
            <div class="timeline-body"><p>(It set the <code>literal</code> to cyan, <code>inline_context</code> to a dimmed yellow and <code>inline_context_value</code> to yellow to showcase)</p>
<p>1.) Here is the <code>long help</code> in my current PR (<code>literal</code> style is applied to the values for enumerated values):
<img src="https://github.com/clap-rs/clap/assets/29143941/670401ff-8533-4fd4-8893-8d5a6274790b" alt="image" /></p>
<p>2.) And here is the <code>long help</code> with the fix to apply  <code>inline_context_value</code> instead of <code>literal</code>:
<img src="https://github.com/clap-rs/clap/assets/29143941/b2643797-7caa-411e-8c9a-bcc66d497cd6" alt="image" /></p>
<p>The both have the same short <code>help</code>:
<img src="https://github.com/clap-rs/clap/assets/29143941/70613bfa-dae2-4051-a5c1-2afb2836d16a" alt="image" /></p>
<p>Personally I found both 1.) and 2.) good.
It's more when we look at it in relation to the short help that 1.) feels inconsistent suddenly...</p>
<ol start="3">
<li>There is a third solution if you want, we keep 1.) (<code>literal</code> style for the enum vals) but we also apply <code>literal</code> style as well on the enum vals in the short help (instead of <code>inline_context_value</code>), but only for enumarated values. I like this less honestly.</li>
</ol>
<p>My preference would be the 2.)</p>
<p>Let me know what you prefer please.
Have a nice day.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GilShoshan94">@GilShoshan94</a> on 2024-05-21 11:52</div>
            <div class="timeline-body"><p>Hi @epage,</p>
<p>Hope you are doing well.
I opened a PR #5482 and it was passing all the checks.
Now I need to update it because in the meantime I got 56 commits behind.</p>
<p>I just need an answer from you to my previous question to update or not the PR and it will be ready .</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-05-21 15:35</div>
            <div class="timeline-body"><p>As a heads up, I'm behind on a lot of my PRs and Issues.  It may take a while before I can get back to this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/crowlKats">@crowlKats</a> on 2024-08-08 12:09</div>
            <div class="timeline-body"><p>as a note, Deno would be interested in having this; is there anything we can help out with to push this forward?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-08-08 13:55</div>
            <div class="timeline-body"><p>Still very far behind.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/6057.html">clap-rs/clap#6057</a> on 2025-07-01 20:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/6056.html">clap-rs/clap#6056</a> on 2025-07-01 21:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2025-07-09 22:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> removed by @pksunkara on 2025-07-19 17:38</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:09 UTC
    </footer>
</body>
</html>
