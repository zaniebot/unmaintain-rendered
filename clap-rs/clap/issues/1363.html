<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature request: better build info tools (which features, codegen a binary was compiled with) - clap-rs/clap #1363</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Feature request: better build info tools (which features, codegen a binary was compiled with)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1363">#1363</a>
        opened by <a href="https://github.com/jonathanstrong">@jonathanstrong</a>
        on 2018-10-18 01:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jonathanstrong">@jonathanstrong</a></div>
            <div class="timeline-body">

Rust Version
<p>rustc 1.31.0-nightly (bef62ccdd 2018-10-16)</p>
Affected Version of clap
<p>2.32.0</p>
Bug or Feature Request Summary
<p>I often find myself checking which version of a binary I compiled, between versions, crate features and codegen options. I wrote some code below which I am using via the <code>App::about</code> method to provide build info for my clap-generated <code>-h</code> printout. (Like <code>vim --version</code>, but much less info).</p>
<pre><code>pub fn build_info() -&gt; String {
    let indent = &quot;    &quot;;
    format!(&quot;\r\n\
        BUILD:\r\n\
        {}{}\r\n\r\n\
        CODEGEN:\r\n\
        {}{}&quot;,
        indent, features().join(&quot; &quot;),
        indent, codegen().join(&quot; &quot;))
}

fn codegen() -&gt; Vec&lt;&amp;&#x27;static str&gt; {
    let mut flags = Vec::new();
    macro_rules! check_cpu {
        ($($target:expr),*) =&gt; {{
            $(
                #[cfg(target_feature = $target)]
                flags.push($target);
            )*
        }}
    }

    check_cpu!(&quot;aes&quot;, &quot;avx&quot;, &quot;avx2&quot;, &quot;avx512bw&quot;, &quot;avx512cd&quot;, &quot;avx512dq&quot;, &quot;avx512f&quot;, &quot;avx512vl&quot;, &quot;bmi1&quot;,
               &quot;bmi2&quot;, &quot;fma&quot;, &quot;fxsr&quot;, &quot;lzcnt&quot;, &quot;mmx&quot;, &quot;pclmulqdq&quot;, &quot;popcnt&quot;, &quot;rdrand&quot;, &quot;rdseed&quot;, &quot;sse&quot;,
               &quot;sse2&quot;, &quot;sse3&quot;, &quot;sse4.1&quot;, &quot;sse4.2&quot;, &quot;ssse3&quot;, &quot;xsave&quot;, &quot;xsavec&quot;, &quot;xsaveopt&quot;, &quot;xsaves&quot;);

    flags.sort_unstable();
    flags.dedup();
    flags
}

fn features() -&gt; Vec&lt;&amp;&#x27;static str&gt; {
    macro_rules! feat_list {
        ($($feat:expr),*) =&gt; {
            vec![
                $(
                    #[cfg(feature = $feat)]
                    $feat,
                )*
            ]
        }
    }

    let mut flags = feat_list!(&quot;feat-one&quot;, &quot;feat-two&quot;);

    #[cfg(debug_assertions)]
    flags.push(&quot;debug_assertions&quot;);

    flags.sort_unstable();
    flags.dedup();
    flags
}

// ...

fn main()
    let build_info = mylib::build_info();
    let args: ArgMatches = App::new(&quot;my-binary&quot;)
        .version(crate_version!())
        .about(build_info.as_str())
        // ...
</code></pre>
<p>This is ok, but unfortunately it needs to be manually maintained as new features are added, etc. It occurred to me that perhaps clap would be a good fit for this kind of functionality, and I didn&#x27;t see anything in the docs about providing build info. Have you considered adding tools for tracking features, codegen options, etc.?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: help message</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-01 15:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: intermediate</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-01 15:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-01 15:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: enhancement</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-01 15:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-01 15:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-01 15:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;3.1&quot; by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-01 15:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> removed by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-08-13 10:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>epage/clapng#106</a> on 2021-12-06 17:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> removed by <a href="https://github.com/epage">@epage</a> on 2021-12-08 21:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-09 19:11</div>
            <div class="timeline-body"><p>This also has overlap with</p>
<ul>
<li>https://github.com/sharkdp/bugreport</li>
<li>https://github.com/rust-cli/human-panic</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;3.1&quot; by <a href="https://github.com/epage">@epage</a> on 2021-12-09 19:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: medium</span> removed by <a href="https://github.com/epage">@epage</a> on 2021-12-09 19:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-help-wanted</span> removed by <a href="https://github.com/epage">@epage</a> on 2021-12-09 19:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> added by <a href="https://github.com/epage">@epage</a> on 2021-12-09 19:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-02-03 14:35</div>
            <div class="timeline-body"><p>https://crates.io/crates/shadow-rs seems to also fill a similar role</p>
<ul>
<li>https://github.com/baoyachi/shadow-rs/issues/69</li>
<li>https://github.com/baoyachi/shadow-rs/issues/70</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>baoyachi/shadow-rs#69</a> on 2022-02-03 14:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/epage">@epage</a> on 2022-02-03 14:45</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:57:16 UTC
    </footer>
</body>
</html>
