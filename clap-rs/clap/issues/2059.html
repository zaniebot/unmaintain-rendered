<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Default alphabetical sorting of options in help message appears to be broken - clap-rs/clap #2059</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Default alphabetical sorting of options in help message appears to be broken</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/2059">#2059</a>
        opened by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a>
        on 2020-08-12 13:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/CreepySkeleton">@CreepySkeleton</a></div>
            <div class="timeline-body"><h3>Make sure you completed the following tasks</h3>
<ul>
<li>[x] Searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[x] Searched the closes issues</li>
</ul>
<h3>Code</h3>
<pre><code class="language-rust">use std::net::SocketAddr;
use std::net::IpAddr;
use std::path::PathBuf;
use clap::{Clap, AppSettings};

#[derive(Clap, Debug)]
#[clap(
    name = &quot;Pod, the open-source backend for Memri project.&quot;,
    // the bug is present even without this option, but it makes it easier to spot
    setting = AppSettings::UnifiedHelpMessage,
)]
pub struct CLIOptions {
    /// Port to listen to.
    #[clap(short, long, default_value = &quot;3030&quot;)]
    port: i16,

    /// File to read https public certificate from.
    #[clap(
        short = 'c',
        long,
        default_value = &quot;./data/certs/pod.crt&quot;,
        name = &quot;CERTIFICATE_FILE&quot;
    )]
    https_pub_crt: String,

    /// File to read https private key from.
    #[clap(
        short = 'k',
        long,
        default_value = &quot;./data/certs/pod.key&quot;,
        name = &quot;KEY_FILE&quot;
    )]
    https_priv_key: String,

    /// Set the callback address for services launched from within Pod.
    /// This should be the Pod-s address as seen by external services.
    /// During development, it defaults to &quot;https://pod_pod_1:3030&quot; if Pod is inside docker,
    /// or &quot;https://localhost:3030&quot; on Linux,
    /// or &quot;https://host.docker.internal:3030&quot; on other operating systems.
    #[clap(short = 's', long, name = &quot;ADDRESS&quot;)]
    services_callback_address: Option&lt;SocketAddr&gt;,

    /// Do not use https when starting the server, instead run on http://127.0.0.1.
    /// Running on loopback interface (127.0.0.1) means that only apps
    /// from within the same computer will be able to access Pod.
    /// This option might be used during development as an alternative to self-signed certificates.
    #[clap(short = 't', long)]
    non_tls: bool,

    /// Unsafe version of --non-tls. Do not use https when starting the server,
    /// instead run on http on the provided network interface.
    /// WARNING: This is heavily discouraged as an intermediary
    /// (even your router on a local network)
    /// could spoof the traffic sent to the server and do a MiTM attack.
    /// Please consider running Pod on a non-public network (--non-tls),
    /// or use Pod with https encryption.
    #[clap(short, long)]
    insecure_non_tls: Option&lt;IpAddr&gt;,

    /// Comma-separated list of Pod owners (hex-encoded hashes of public keys).
    /// Only those owners are allowed to call Pod endpoints.
    /// Each Pod owner has its own database and files directory,
    /// the owners do not intersect data-wise.
    ///
    /// A magic value of &quot;ANY&quot; will allow any owner to connect to the Pod.
    ///
    /// Can be specified multiple times.
    #[clap(short = 'o', long, required = true, multiple = true)]
    owner: Vec&lt;String&gt;,

    /// Validate a schema file, and exit.
    /// This allows testing whether a given schema is suitable for use in Pod,
    /// see README.md#schema for details.
    /// Note that running project tests or starting the Pod will also automatically validate
    /// the schema in `res/autogenerated_database_schema.json`.
    #[clap(short = 'v', long, name = &quot;SCHEMA_FILE&quot;, parse(from_os_str))]
    validate_schema: Option&lt;PathBuf&gt;,
}

fn main() {
    CLIOptions::parse_from(&amp;[&quot;a&quot;, &quot;--help&quot;]);
}
</code></pre>
<h3>Steps to reproduce the issue</h3>
<ol>
<li><code>cargo run</code></li>
</ol>
<h3>Version</h3>
<ul>
<li><strong>Rust</strong>: <code>1.45.0</code></li>
<li><strong>Clap</strong>: <code>master</code></li>
</ul>
<h3>Actual Behavior Summary</h3>
<p>Options in help message are sorted in a weird way I don't recognize:</p>
<pre><code>Pod, the open-source backend for Memri project. 

USAGE:
    a [OPTIONS] --owner &lt;owner&gt;...

OPTIONS:
    -s, --services-callback-address &lt;ADDRESS&gt;
            Set the callback address for services launched from within Pod. This should be the Pod-s
            address as seen by external services. During development, it defaults to
            &quot;https://pod_pod_1:3030&quot; if Pod is inside docker, or &quot;https://localhost:3030&quot; on Linux,
            or &quot;https://host.docker.internal:3030&quot; on other operating systems
    -c, --https-pub-crt &lt;CERTIFICATE_FILE&gt;
            File to read https public certificate from [default: ./data/certs/pod.crt]

    -k, --https-priv-key &lt;KEY_FILE&gt;
            File to read https private key from [default: ./data/certs/pod.key]

    -v, --validate-schema &lt;SCHEMA_FILE&gt;
            Validate a schema file, and exit. This allows testing whether a given schema is suitable
            for use in Pod, see README.md#schema for details. Note that running project tests or
            starting the Pod will also automatically validate the schema in
            `res/autogenerated_database_schema.json`
    -h, --help                                   
            Prints help information

    -i, --insecure-non-tls &lt;insecure-non-tls&gt;
            Unsafe version of --non-tls. Do not use https when starting the server, instead run on
            http on the provided network interface. WARNING: This is heavily discouraged as an
            intermediary (even your router on a local network) could spoof the traffic sent to the
            server and do a MiTM attack. Please consider running Pod on a non-public network (--non-
            tls), or use Pod with https encryption
    -t, --non-tls
            Do not use https when starting the server, instead run on http://127.0.0.1. Running on
            loopback interface (127.0.0.1) means that only apps from within the same computer will
            be able to access Pod. This option might be used during development as an alternative to
            self-signed certificates
    -o, --owner &lt;owner&gt;...
            Comma-separated list of Pod owners (hex-encoded hashes of public keys). Only those
            owners are allowed to call Pod endpoints. Each Pod owner has its own database and files
            directory, the owners do not intersect data-wise.
            
            A magic value of &quot;ANY&quot; will allow any owner to connect to the Pod.
            
            Can be specified multiple times.
    -p, --port &lt;port&gt;                            
            Port to listen to [default: 3030]

    -V, --version                                
            Prints version information
</code></pre>
<h3>Expected Behavior Summary</h3>
<p>Options must be sorted in alphabetical order, as specified in documentation.</p>
<h3>Additional context</h3>
<p>Originally reported in https://github.com/TeXitoi/structopt/issues/421</p>
<p>The problem still persists in master.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @CreepySkeleton on 2020-08-12 13:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> added by @CreepySkeleton on 2020-08-12 13:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: args</span> added by @CreepySkeleton on 2020-08-12 13:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: help message</span> added by @CreepySkeleton on 2020-08-12 13:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: options</span> added by @CreepySkeleton on 2020-08-12 13:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: flags</span> added by @CreepySkeleton on 2020-08-12 13:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @CreepySkeleton on 2020-08-12 13:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2166.html">clap-rs/clap#2166</a> on 2020-10-10 16:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @bors[bot] on 2020-10-10 19:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../djeedai/weldr/pulls/19.html">djeedai/weldr#19</a> on 2020-12-06 20:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4728.html">clap-rs/clap#4728</a> on 2023-02-24 11:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:47:44 UTC
    </footer>
</body>
</html>
