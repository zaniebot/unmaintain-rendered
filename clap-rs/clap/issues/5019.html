<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`derive(Parser)` fails when using type alias - clap-rs/clap #5019</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>derive(Parser)</code> fails when using type alias</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/5019">#5019</a>
        opened by <a href="https://github.com/mamekoro">@mamekoro</a>
        on 2023-07-19 11:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mamekoro">@mamekoro</a></div>
            <div class="timeline-body">Please complete the following tasks
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
Rust Version
<p>rustc 1.71.0 (8ede3aae2 2023-07-12)</p>
Clap Version
<p>4.3.16</p>
Minimal reproducible code
<pre><code>/*
[dependencies]
clap = { version = &quot;4.3.16&quot;, features = [&quot;derive&quot;] }
*/

use clap::Parser;

pub type MountOpt = Vec&lt;String&gt;;

#[derive(Clone, Debug, Parser)]
pub struct Args {
    #[arg(long, value_name = &quot;mount&quot;)]
    pub mount: Option&lt;MountOpt&gt;,
}

fn main() {
    println!(&quot;{:?}&quot;, Args::parse());
}
</code></pre>
Steps to reproduce the bug with the above code
<p><code>cargo build</code></p>
Actual Behaviour
<pre><code>error[E0599]: the method `value_parser` exists for reference `&amp;&amp;&amp;&amp;&amp;&amp;_AutoValueParser&lt;Vec&lt;String&gt;&gt;`, but its trait bounds were not satisfied
    --&gt; src/main.rs:12:5
     |
12   |     #[arg(long, value_name = &quot;mount&quot;)]
     |     ^ method cannot be called on `&amp;&amp;&amp;&amp;&amp;&amp;_AutoValueParser&lt;Vec&lt;String&gt;&gt;` due to unsatisfied trait bounds
     |
    ::: &lt;HOME&gt;/.cargo/registry/src/index.crates.io-6f17d22bba15001f/clap_builder-4.3.16/src/builder/value_parser.rs:2274:1
     |
2274 | pub struct _AutoValueParser&lt;T&gt;(std::marker::PhantomData&lt;T&gt;);
     | ------------------------------ doesn&#x27;t satisfy `_: _ValueParserViaParse`
     |
    ::: &lt;HOME&gt;/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/alloc/src/vec/mod.rs:396:1
     |
396  | pub struct Vec&lt;T, #[unstable(feature = &quot;allocator_api&quot;, issue = &quot;32838&quot;)] A: Allocator = Global...
     | ------------------------------------------------------------------------------------------------
     | |
     | doesn&#x27;t satisfy `Vec&lt;std::string::String&gt;: From&lt;&amp;&#x27;s str&gt;`
     | doesn&#x27;t satisfy `Vec&lt;std::string::String&gt;: From&lt;OsString&gt;`
     | doesn&#x27;t satisfy `Vec&lt;std::string::String&gt;: FromStr`
     | doesn&#x27;t satisfy `Vec&lt;std::string::String&gt;: ValueEnum`
     | doesn&#x27;t satisfy `Vec&lt;std::string::String&gt;: ValueParserFactory`
     | doesn&#x27;t satisfy `_: From&lt;&amp;OsStr&gt;`
     | doesn&#x27;t satisfy `_: From&lt;String&gt;`
     |
     = note: the following trait bounds were not satisfied:
             `Vec&lt;std::string::String&gt;: ValueEnum`
             which is required by `&amp;&amp;&amp;&amp;&amp;_AutoValueParser&lt;Vec&lt;std::string::String&gt;&gt;: clap::builder::via_prelude::_ValueParserViaValueEnum`
             `Vec&lt;std::string::String&gt;: ValueParserFactory`
             which is required by `&amp;&amp;&amp;&amp;&amp;&amp;_AutoValueParser&lt;Vec&lt;std::string::String&gt;&gt;: clap::builder::via_prelude::_ValueParserViaFactory`
             `Vec&lt;std::string::String&gt;: From&lt;OsString&gt;`
             which is required by `&amp;&amp;&amp;&amp;_AutoValueParser&lt;Vec&lt;std::string::String&gt;&gt;: clap::builder::via_prelude::_ValueParserViaFromOsString`
             `Vec&lt;std::string::String&gt;: From&lt;&amp;&#x27;s std::ffi::OsStr&gt;`
             which is required by `&amp;&amp;&amp;_AutoValueParser&lt;Vec&lt;std::string::String&gt;&gt;: clap::builder::via_prelude::_ValueParserViaFromOsStr`
             `Vec&lt;std::string::String&gt;: From&lt;std::string::String&gt;`
             which is required by `&amp;&amp;_AutoValueParser&lt;Vec&lt;std::string::String&gt;&gt;: clap::builder::via_prelude::_ValueParserViaFromString`
             `Vec&lt;std::string::String&gt;: From&lt;&amp;&#x27;s str&gt;`
             which is required by `&amp;_AutoValueParser&lt;Vec&lt;std::string::String&gt;&gt;: clap::builder::via_prelude::_ValueParserViaFromStr`
             `Vec&lt;std::string::String&gt;: FromStr`
             which is required by `_AutoValueParser&lt;Vec&lt;std::string::String&gt;&gt;: clap::builder::via_prelude::_ValueParserViaParse`
     = note: this error originates in the macro `clap::value_parser` (in Nightly builds, run with -Z macro-backtrace for more info)

For more information about this error, try `rustc --explain E0599`.
error: could not compile `test-clap` (bin &quot;test-clap&quot;) due to 2 previous errors
</code></pre>
Expected Behaviour
<p>Compilation should success.</p>
Additional Context
<p>I was writing a program to communicate with a Docker server, using Docker CLI (written in Go) as a reference.
I decided to declare type aliases to make the types in my code and Docker CLI similar, and I faced this problem.</p>
Debug Output
<p>The same as &quot;Actual Behaviour&quot; above. (checked with the <code>diff</code> command.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by <a href="https://github.com/mamekoro">@mamekoro</a> on 2023-07-19 11:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-07-19 13:50</div>
            <div class="timeline-body"><p>This is actually expected behavior and is a <a href="https://docs.rs/clap/latest/clap/_derive/index.html#arg-types">documented</a> way to disable the derive from inferring behavior from the type.</p>
<p>Closing in favor of #4626 which is discussing how to improve this</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/epage">@epage</a> on 2023-07-19 13:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-derive</span> added by <a href="https://github.com/epage">@epage</a> on 2023-07-19 13:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:59:50 UTC
    </footer>
</body>
</html>
