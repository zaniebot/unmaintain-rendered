<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Can't use named arguments if they have index - clap-rs/clap #1330</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Can't use named arguments if they have index</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/1330">#1330</a>
        opened by <a href="https://github.com/Amomum">@Amomum</a>
        on 2018-08-17 13:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Amomum">@Amomum</a> on 2018-08-17 13:34</div>
            <div class="timeline-body"><!--
Please use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`
-->

<h3>Rust Version</h3>
<p>rustc 1.28.0</p>
<h3>Affected Version of clap</h3>
<p>clap 2.32.0</p>
<h3>Bug or Feature Request Summary</h3>
<p>When I create an argument with a name and give it explicit index, it can only be used by index; its name is not parsed correctly.</p>
<h3>Expected Behavior Summary</h3>
<p>I'm not sure if it's a bug, it may be an intenional design decision.
So I would be glad to see one of two behaviours:</p>
<p>If it's a bug: I can give argument name and index simultaneously and it will work both ways - if no name is given - argument is parsed by it's index</p>
<p>If it's an intentional behaviour: I would like to see a more clear error when I try to use index and argument name (i.e. short() or long() with index()) simultaneously. A panic maybe?</p>
<h3>Actual Behavior Summary</h3>
<pre><code>error: Found argument '--htm' which wasn't expected, or isn't valid in this context
</code></pre>
<h3>Steps to Reproduce the issue</h3>
<p>Create argument with short or long name and index. Call app with named argument.</p>
<h3>Sample Code or Link to Sample Code</h3>
<pre><code>let args = App::new( env!(&quot;CARGO_PKG_NAME&quot;) )
        .arg( Arg::with_name(&quot;htm file&quot;)
            .long(&quot;htm&quot;)
            .index(1)
            .required(true)
            .takes_value(true);
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-02 07:33</div>
            <div class="timeline-body"><p>From the doc:</p>
<blockquote>
<p>Specifies the index of a <strong>positional</strong> argument</p>
</blockquote>
<p>Index should not be used for short/long options.</p>
<p>I'm leaving this open as a reminder to check and tidy up the doc.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: docs</span> added by @CreepySkeleton on 2020-02-02 07:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @CreepySkeleton on 2020-02-02 07:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @CreepySkeleton on 2020-02-02 07:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @CreepySkeleton on 2020-02-02 07:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by @CreepySkeleton on 2020-02-02 07:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @CreepySkeleton on 2020-02-02 07:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: asserts</span> added by @pksunkara on 2020-04-12 10:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-12 10:19</div>
            <div class="timeline-body"><p>We should create an assert also.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">:money_with_wings: $10</span> added by @pksunkara on 2020-08-14 13:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">:money_with_wings: $10</span> removed by @pksunkara on 2020-08-14 14:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> removed by @pksunkara on 2020-08-14 14:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> removed by @pksunkara on 2020-08-14 14:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">:money_with_wings: $5</span> added by @pksunkara on 2020-08-14 14:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by @pksunkara on 2020-08-14 14:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P3: want to have</span> added by @pksunkara on 2020-08-14 14:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-08-14 15:05</div>
            <div class="timeline-body"><p>This issue now has bounty of <strong>$5</strong>. More info <a href="https://github.com/clap-rs/clap/wiki/Issue-Bounties">here</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/liamdawson">@liamdawson</a> on 2020-08-15 00:25</div>
            <div class="timeline-body"><p>As a counterpoint, <code>virsh</code> from libvirt allows positional parameters to be defined as flags instead. As in:</p>
<pre><code>virsh vol-list --pool=images
virsh vol-list images
</code></pre>
<p>behave the same way. Similarly, the following are identical in behaviour:</p>
<pre><code>virsh vol-create-as images guest 20G
virsh vol-create-as --pool=images --name=guest --capacity=20G
virsh vol-create-as --name=guest --pool=images 20G
</code></pre>
<p>I'm not suggesting clap needs this functionality, but there is a precedent for positional arguments being supported as flags.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-08-15 00:34</div>
            <div class="timeline-body"><p>You can still do that here. But you have to actually define two args for this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.0" by @pksunkara on 2020-10-12 08:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @pksunkara on 2020-10-12 08:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CastilloDel">@CastilloDel</a> on 2020-10-18 12:09</div>
            <div class="timeline-body"><p>I would be interested in solving this. I've looking at the code and I've thought of two solutions:</p>
<ul>
<li>Introduce assertions in the index, long and short methods from the Arg class(and other methods if needed)</li>
<li>Add a function to the App class that gets called before _do_parse and that iterates over the Args looking for incongruities like this one.</li>
</ul>
<p>The first one seems simpler to me and it makes more sense to me. If an Arg is inconsistent it should be the Arg itself that catches that.
The second one is more general and could also be used to catch other errors. Also, there could be a special clap::parse::Error variant for this, if that seems more elegant than a panic or an assertion.</p>
<p>I would like some guidance on which way should I take :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-10-18 12:15</div>
            <div class="timeline-body"><p>We already have a place for it, https://github.com/clap-rs/clap/blob/1519ec81f79ad6f0ff1c94bf6a9af1c84e1a943f/src/build/arg/mod.rs#L4346</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CastilloDel">@CastilloDel</a> on 2020-10-18 12:43</div>
            <div class="timeline-body"><p>I thought this should work outside the debug config. Glad I asked, ty!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2177.html">clap-rs/clap#2177</a> on 2020-10-18 18:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @bors[bot] on 2020-10-18 22:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:32 UTC
    </footer>
</body>
</html>
