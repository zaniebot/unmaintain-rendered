<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Derive doesn't use crate name - clap-rs/clap #2282</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Derive doesn&#x27;t use crate name</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/2282">#2282</a>
        opened by <a href="https://github.com/kotovalexarian">@kotovalexarian</a>
        on 2021-01-01 04:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kotovalexarian">@kotovalexarian</a></div>
            <div class="timeline-body"><p>By <code>derive</code>ing <code>Clap</code>, the <code>about</code>, <code>author</code> and <code>version</code> options can be automatically extracted from crate&#x27;s <code>Cargo.toml</code>, but this doesn&#x27;t work for <code>name</code>, so I have to specify it manually:</p>
<pre><code>use clap::{Clap};

const CRATE_NAME: &amp;str = env!(&quot;CARGO_PKG_NAME&quot;);

#[derive(Clap)]
#[clap(about, author, name = CRATE_NAME, version)]
struct Options {}
</code></pre>
<p>Creation of <code>clap::App</code> doesn&#x27;t have such limitation: there are macros <a href="https://github.com/clap-rs/clap/blob/master/src/macros.rs#L169-L209"><code>clap::app_from_crate</code></a> and <a href="https://github.com/clap-rs/clap/blob/master/src/macros.rs#L148-L167"><code>clap::crate_name</code></a>.</p>
<pre><code>#[macro_use]
extern crate clap;

fn main() {
    let app = app_from_crate!();
}
</code></pre>
<pre><code>#[macro_use]
extern crate clap;

fn main() {
    let app = clap::App::new(crate_name!());
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by <a href="https://github.com/kotovalexarian">@kotovalexarian</a> on 2021-01-01 04:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-01-01 05:05</div>
            <div class="timeline-body"><p>Yeah, because name is default to the name of the struct/enum. One thing we can do is use the <code>crate_name()</code> if only <code>name</code> is written but without any value so that users don&#x27;t have to do <code>env!</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: derive macros</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-01-01 05:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;3.0&quot; by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-01-01 05:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">:money_with_wings: $5</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-01-01 05:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#2283</a> on 2021-01-01 09:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-01-01 13:58</div>
            <div class="timeline-body"><blockquote>
<p>By deriveing Clap, the about, author and version options can be automatically extracted from crate&#x27;s Cargo.toml, but this doesn&#x27;t work for name</p>
</blockquote>
<p>I am sorry but I misunderstood your question. What do you mean it doesn&#x27;t work for <code>name</code>? We always use <code>CARGO_PKG_NAME</code> if you don&#x27;t set <code>name</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kotovalexarian">@kotovalexarian</a> on 2021-01-02 09:27</div>
            <div class="timeline-body"><blockquote>
<p>We always use <code>CARGO_PKG_NAME</code> if you don&#x27;t set <code>name</code>.</p>
</blockquote>
<p>Really? It isn&#x27;t obvious. So I can skip <code>about</code>, <code>author</code>, <code>version</code> and <code>name</code> at all?</p>
<p><strong>UPD:</strong> No, I only can skip <code>name</code>. This API is inconsistent.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-01-02 09:41</div>
            <div class="timeline-body"><p>It&#x27;s not inconsistent. <code>name</code> of a <code>clap::App</code> is required but the others are not. That is what the API represents.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-01-02 09:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kotovalexarian">@kotovalexarian</a> on 2021-01-02 13:20</div>
            <div class="timeline-body"><blockquote>
<p>It&#x27;s not inconsistent. <code>name</code> of a <code>clap::App</code> is required but the others are not. That is what the API represents.</p>
</blockquote>
<p>These are two different APIs. The <code>clap::App</code> API is ok, because required option is a parameter of constructor, while optional parameters are specified with builder methods. But <code>derive(Clap)</code> API has single way to specify options and this way is inconsistent.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-01-02 13:25</div>
            <div class="timeline-body"><p>Derive clap&#x27;s API should and will be always in sync with normal api. Especially this situation is something that was a complete mess in structopt and if you check the corresponding implementation prs you can see that this is the best solution since name is required.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kotovalexarian">@kotovalexarian</a> on 2021-01-02 14:25</div>
            <div class="timeline-body"><p>Why not just allow to explicitly specify <code>name</code> without value? For now this wouldn&#x27;t compile. This is not useful, but removes inconsistency.</p>
<pre><code>use clap::{Clap};

#[derive(Clap)]
#[clap(about, author, name, version)]
struct Options {}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-01-02 14:27</div>
            <div class="timeline-body"><p>I have already answered that because name is always default. As I said, please read the original discussion. We had considered this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Locked by <a href="https://github.com/clap-rs">@clap-rs</a> on 2021-01-02 14:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:57:59 UTC
    </footer>
</body>
</html>
