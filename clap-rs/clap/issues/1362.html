<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>is_present returns false for arguments in the environment that do not take a value - clap-rs/clap #1362</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>is_present returns false for arguments in the environment that do not take a value</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1362">#1362</a>
        opened by <a href="https://github.com/Gisleburt">@Gisleburt</a>
        on 2018-10-17 10:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Gisleburt">@Gisleburt</a></div>
            <div class="timeline-body"><h3>Rust Version</h3>
<pre><code>rustc 1.29.0 (aa3ca1994 2018-09-11)
</code></pre>
<h3>Affected Version of clap</h3>
<pre><code>2.32.0
</code></pre>
<h3>Bug or Feature Request Summary</h3>
<p>Bug</p>
<h3>Expected Behavior Summary</h3>
<p>According to the documentation for <code>env</code></p>
<blockquote>
<p>If the user does not use this argument at runtime <code>[ArgMatches::is_present]</code> will return <code>true</code> if the variable is present in the environment</p>
</blockquote>
<h3>Actual Behavior Summary</h3>
<p><code>is_present</code> still returns false if the arg does not take a value</p>
<h3>Steps to Reproduce the issue</h3>
<p>Give an <code>Arg</code> an env value, make it not required and take no value.</p>
<p>eg:</p>
<pre><code>args:
- test:
    long: test
    env: TEST
    takes_value: false
    required: false
</code></pre>
<p>Note: changine to &quot;takes_value&quot; to true, works, however it then isn't quite appropriate for the command line. In our specific case we have an arguement for <code>-y</code> which from the environment we want to enable with a variable called <code>RECKLESS_MODE</code> which we just set to <code>&quot;true&quot;</code>.</p>
<h3>Sample Code or Link to Sample Code</h3>
<p>https://github.com/Gisleburt/clap-env-bug</p>
<h3>Debug output</h3>
<details>
<summary> Debug Output </summary>
<pre>
<code>

<p>DEBUG:clap:Parser::propagate_settings: self=clap_bug, g_settings=AppFlags(
(empty)
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:ArgMatcher::process_arg_overrides:None;
DEBUG:clap:Parser::remove_overrides:[];
DEBUG:clap:Validator::validate;
DEBUG:clap:Parser::add_defaults;
DEBUG:clap:Validator::validate_blacklist;
DEBUG:clap:Validator::validate_required: required=[];
DEBUG:clap:Validator::validate_matched_args;
DEBUG:clap:usage::create_usage_with_title;
DEBUG:clap:usage::create_usage_no_title;
DEBUG:clap:usage::get_required_usage_from: reqs=[], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:usage::needs_flags_tag;
DEBUG:clap:usage::needs_flags_tag:iter: f=test;
DEBUG:clap:Parser::groups_for_arg: name=test
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:usage::needs_flags_tag:iter: [FLAGS] required
DEBUG:clap:usage::create_help_usage: usage=clap-bug [FLAGS]
DEBUG:clap:ArgMatcher::get_global_values: global_arg_vec=[]
not present</p>
</code>
</pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gisleburt">@Gisleburt</a> on 2018-10-17 11:00</div>
            <div class="timeline-body"><p>I should say we have a workaround, we can set <code>-y</code> where we're running it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-01 15:47</div>
            <div class="timeline-body"><p><code>env</code> does not work with <code>takes_value(false)</code>, this code is ill-formed. Actually, there's no way to do it now, see https://github.com/clap-rs/clap/issues/1476. The issue you outlined is because of that one.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @CreepySkeleton on 2020-02-01 15:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: duplicate</span> added by @pksunkara on 2020-02-01 19:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:47:13 UTC
    </footer>
</body>
</html>
