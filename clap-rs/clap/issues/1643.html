<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Core Dump and 100% CPU Usage With Mutally `requires()` Args in Clap 3 ( with example ) - clap-rs/clap #1643</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Core Dump and 100% CPU Usage With Mutally <code>requires()</code> Args in Clap 3 ( with example )</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1643">#1643</a>
        opened by <a href="https://github.com/zicklag">@zicklag</a>
        on 2020-01-24 01:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zicklag">@zicklag</a></div>
            <div class="timeline-body"><!--
Please use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`
-->

<h3>Rust Version</h3>
<ul>
<li>rustc 1.40.0 (73528e339 2019-12-16)</li>
<li>rustc 1.42.0-nightly (0a58f5864 2020-01-02)</li>
</ul>
<h3>Affected Version of clap</h3>
<ul>
<li><code>clap = { git = &quot;https://github.com/clap-rs/clap.git&quot;, rev=&quot;f3683a9&quot;, features = [&quot;wrap_help&quot;] }</code></li>
</ul>
<blockquote>
<p><strong>Note:</strong> This does <strong>not</strong> occur in the latest version of Clap 2.</p>
</blockquote>
<h3>Expected Behavior Summary</h3>
<p>In the example below, the <code>-r</code> and the <code>-u</code> argument should be required if either of them are provided.</p>
<h3>Actual Behavior Summary</h3>
<p>When I provide one of either <code>-r</code>, <code>-u</code>, or both the app will freeze, taking up 100% of the CPU core it is running on while continually taking up memory until it crashes because of a failure to allocate memory.</p>
<h3>Steps to Reproduce the issue</h3>
<p>Run the code below.</p>
<h3>Sample Code or Link to Sample Code</h3>
<pre><code class="language-rust">use clap::*;

fn main() {
    let app = App::new(&quot;test&quot;)
        .arg(Arg::with_name(&quot;relation_id&quot;)
                .help(&quot;The relation id to get the data from&quot;)
                .long(&quot;relation-id&quot;)
                .short(&quot;r&quot;)
                .takes_value(true)
                .requires(&quot;remote_unit_name&quot;))
            .arg(Arg::with_name(&quot;remote_unit_name&quot;)
                .help(&quot;The name of the remote unit to get data from&quot;)
                .long(&quot;remote-unit&quot;)
                .short(&quot;u&quot;)
                .takes_value(true)
                .requires(&quot;relation_id&quot;));
                
    app.get_matches_from(&quot;test -u hello&quot;.split(&quot; &quot;));
}
</code></pre>
<h3>Debug output</h3>
<details>
<summary> Debug Output </summary>
<pre>
<code>

<p>DEBUG:clap:App::_do_parse;
DEBUG:clap:App::_build;
DEBUG:clap:App::_derive_display_order:test
DEBUG:clap:App::_create_help_and_version;
DEBUG:clap:App::_create_help_and_version: Building --help
DEBUG:clap:App::_create_help_and_version: Building --version
DEBUG:clap:App::_arg_debug_asserts:relation_id
DEBUG:clap:App::_arg_debug_asserts:remote_unit_name
DEBUG:clap:App::_arg_debug_asserts:help
DEBUG:clap:App::_arg_debug_asserts:version
DEBUG:clap:App::_app_debug_asserts;
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::_build;
DEBUG:clap:Parser::_verify_positionals;
DEBUG:clap:Parser::get_matches_with: Begin parsing '&quot;-u&quot;' ([45, 117])
DEBUG:clap:Parser::is_new_arg:&quot;-u&quot;:NotFound
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: - found
DEBUG:clap:Parser::is_new_arg: starts_new_arg=true
DEBUG:clap:Parser::possible_subcommand: arg=&quot;-u&quot;
DEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None
DEBUG:clap:Parser::parse_short_arg: full_arg=&quot;-u&quot;
DEBUG:clap:Parser::parse_short_arg:iter:u
DEBUG:clap:Parser::parse_short_arg:iter:u: Found valid opt or flag
DEBUG:clap:Parser::parse_short_arg:iter:u: p[0]=[], p[1]=[]
DEBUG:clap:Parser::parse_opt; opt=remote_unit_name, val=None
DEBUG:clap:Parser::parse_opt; opt.settings=ArgFlags(TAKES_VAL | DELIM_NOT_SET)
DEBUG:clap:Parser::parse_opt; Checking for val...None
DEBUG:clap:ArgMatcher::inc_occurrence_of: arg=6752898689102734025
DEBUG:clap:ArgMatcher::inc_occurrence_of: first instance
DEBUG:clap:Parser::groups_for_arg: name=6752898689102734025
DEBUG:clap:Parser::parse_opt: More arg vals required...
DEBUG:clap:Parser:get_matches_with: After parse_short_arg Opt(6752898689102734025)
DEBUG:clap:Parser::get_matches_with: Begin parsing '&quot;test&quot;' ([116, 101, 115, 116])
DEBUG:clap:Parser::is_new_arg:&quot;test&quot;:Opt(6752898689102734025)
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: probably value
DEBUG:clap:Parser::is_new_arg: starts_new_arg=false
DEBUG:clap:Parser::add_val_to_arg; arg=remote_unit_name, val=&quot;test&quot;
DEBUG:clap:Parser::add_val_to_arg; trailing_vals=false, DontDelimTrailingVals=false
DEBUG:clap:Parser::add_single_val_to_arg;
DEBUG:clap:Parser::add_single_val_to_arg: adding val...&quot;test&quot;
DEBUG:clap:Parser::groups_for_arg: name=6752898689102734025
DEBUG:clap:ArgMatcher::needs_more_vals: o=remote_unit_name
DEBUG:clap:Parser::remove_overrides;
DEBUG:clap:Parser::remove_overrides:iter:6752898689102734025;
DEBUG:clap:Validator::validate;
DEBUG:clap:Parser::add_defaults;
DEBUG:clap:Parser::add_defaults:iter:relation_id: doesn't have conditional defaults
DEBUG:clap:Parser::add_defaults:iter:relation_id: doesn't have default vals
DEBUG:clap:Parser::add_defaults:iter:remote_unit_name: doesn't have conditional defaults
DEBUG:clap:Parser::add_defaults:iter:remote_unit_name: doesn't have default vals
DEBUG:clap:Validator::validate_conflicts;
DEBUG:clap:Validator::validate_conflicts_with_everything;
DEBUG:clap:Validator::validate_conflicts_with_everything:iter:6752898689102734025;
DEBUG:clap:Validator::gather_conflicts;
DEBUG:clap:Validator::gather_conflicts:iter:6752898689102734025;
DEBUG:clap:Parser::groups_for_arg: name=6752898689102734025
DEBUG:clap:Validator::validate_required: required=ChildGraph([]);
DEBUG:clap:Validator::gather_requirements;
DEBUG:clap:Validator::gather_requirements:iter:6752898689102734025;
memory allocation of 2147483648 bytes failedAborted (core dumped)</p>
</code>
</pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @CreepySkeleton on 2020-02-01 10:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v3.0.0-alpha.3" by @CreepySkeleton on 2020-02-01 10:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @CreepySkeleton by @CreepySkeleton on 2020-02-12 15:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/1718.html">clap-rs/clap#1718</a> on 2020-03-03 19:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @bors[bot] on 2020-03-04 13:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.0.0-beta.2" by @pksunkara on 2020-04-07 13:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @pksunkara on 2020-04-07 13:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:47:28 UTC
    </footer>
</body>
</html>
