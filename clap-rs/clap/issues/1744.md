```yaml
number: 1744
title: Improve error message when subcommand is supplied after --
type: issue
state: closed
author: seppo0010
labels:
  - C-enhancement
assignees: []
created_at: 2020-03-13T14:35:36Z
updated_at: 2021-01-02T02:11:34Z
url: https://github.com/clap-rs/clap/issues/1744
synced_at: 2026-01-10T01:57:43Z
```

# Improve error message when subcommand is supplied after --

---

_Issue opened by @seppo0010 on 2020-03-13 14:35_

<!--
Please use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`
-->

### Rust Version

```
$ rustc -V
rustc 1.41.0 (5e1a79984 2020-01-27)
```

### Code

The code comes directly from the readme

```rust
// (Full example with detailed comments in examples/01a_quick_example.rs)
//
// This example demonstrates clap's "builder pattern" method of creating arguments
// which the most flexible, but also most verbose.
extern crate clap;
use clap::{Arg, App, SubCommand};

fn main() {
    let matches = App::new("My Super Program")
                          .version("1.0")
                          .author("Kevin K. <kbknapp@gmail.com>")
                          .about("Does awesome things")
                          .arg(Arg::with_name("config")
                               .short('c')
                               .long("config")
                               .value_name("FILE")
                               .help("Sets a custom config file")
                               .takes_value(true))
                          .arg(Arg::with_name("INPUT")
                               .help("Sets the input file to use")
                               .required(true)
                               .index(1))
                          .arg(Arg::with_name("v")
                               .short('v')
                               .multiple(true)
                               .help("Sets the level of verbosity"))
                          .subcommand(SubCommand::with_name("test")
                                      .about("controls testing features")
                                      .version("1.3")
                                      .author("Someone E. <someone_else@other.com>")
                                      .arg(Arg::with_name("debug")
                                          .short('d')
                                          .help("print debug information verbosely")))
                          .get_matches();

    // Same as above examples...
}
```
### Steps to reproduce the issue

```
$ cargo build
(...)
$ ./target/debug/clap-test input test
Value for config: default.conf
Using input file: input
No verbose info
Printing normally...
$ ./target/debug/clap-test input -- test
error: The subcommand 'test' wasn't recognized
	Did you mean 'test'?

If you believe you received this message in error, try re-running with 'clap-test -- test'

USAGE:
    clap-test [FLAGS] [OPTIONS] <INPUT> [SUBCOMMAND]

For more information try --help
```

### Affected Version of `clap*`

2.33.0

### Actual Behavior Summary

When using `--` the subcommand is not rightly executed, but the error message does show it as "did you mean" producing a confusing statement.

### Expected Behavior Summary

In this example `--`  should be ignored and the subcommand should be executed.


---

_Label `T: bug` added by @seppo0010 on 2020-03-13 14:35_

---

_Comment by @CreepySkeleton on 2020-03-13 15:53_

I would say that subcommand **must** go before the `--`. Everything after the `--` is considered "raw" arguments in a sense they are _values_ but not _options_ (`--foo`) or _subcommands_.

The "did you mean" part is fixed in `master`, courtesy of https://github.com/clap-rs/clap/pull/1727, so run it with the latest master and you'll see
```
$ cargo run -- input -- test
    Finished dev [unoptimized + debuginfo] target(s) in 0.12s
     Running `target\debug\probe.exe input -- test`
error: Found argument 'test' which wasn't expected, or isn't valid in this context
If you tried to supply `test` as a PATTERN use `-- test`

USAGE:
    probe.exe [OPTIONS] <INPUT> [SUBCOMMAND]

For more information try --help
error: process didn't exit successfully: `target\debug\probe.exe input -- test` (exit code: 2)
```

A few thoughts:
*  We need to get rid of `If you tried to supply 'test' as a PATTERN use '-- test'`. It's not helpful, and I don't really know what it means.
* We need to check the erroneous arg (the `test`) against known set of subcommands and show a helpful suggestion:
  ```
  $ cargo run -- input -- test
    Finished dev [unoptimized + debuginfo] target(s) in 0.12s
     Running `target\debug\probe.exe input -- test`
  error: Found argument 'test' which wasn't expected, or isn't valid in this context

  Hint: there is the 'test' subcommand, but subcommands must go before the '--'. Try 'probe.exe test input'

  USAGE:
    probe.exe [OPTIONS] <INPUT> [SUBCOMMAND]

  For more information try --help
  error: process didn't exit successfully: `target\debug\probe.exe input -- test` (exit code: 2)
```  

---

_Label `T: bug` removed by @CreepySkeleton on 2020-03-13 15:53_

---

_Label `C: errors` added by @CreepySkeleton on 2020-03-13 15:53_

---

_Label `P4: nice to have` added by @CreepySkeleton on 2020-03-13 15:53_

---

_Label `T: enhancement` added by @CreepySkeleton on 2020-03-13 15:53_

---

_Label `W: 3.x` added by @CreepySkeleton on 2020-03-13 15:53_

---

_Added to milestone `3.1` by @CreepySkeleton on 2020-03-13 15:53_

---

_Renamed from "Double hyphen confusing clap " to "Improve error message when subcommand is suppied after --" by @CreepySkeleton on 2020-03-13 15:57_

---

_Renamed from "Improve error message when subcommand is suppied after --" to "Improve error message when subcommand is supplied after --" by @CreepySkeleton on 2020-03-13 15:57_

---

_Referenced in [denoland/deno#6790](../../denoland/deno/issues/6790.md) on 2020-07-18 13:29_

---

_Referenced in [clap-rs/clap#1943](../../clap-rs/clap/issues/1943.md) on 2020-10-06 01:09_

---

_Referenced in [clap-rs/clap#2154](../../clap-rs/clap/pulls/2154.md) on 2020-10-06 12:08_

---

_Referenced in [clap-rs/clap#2157](../../clap-rs/clap/pulls/2157.md) on 2020-10-08 02:42_

---

_Closed by @bors[bot] on 2020-10-09 17:21_

---

_Comment by @ghosty141 on 2021-01-01 19:03_

>     * We need to get rid of `If you tried to supply 'test' as a PATTERN use '-- test'`. It's not helpful, and I don't really know what it means.

@CreepySkeleton Is there any way to opt out of this currently? I really dislike the way that clap outputs quite a lot of text if I just give it a wrong argument. 

---

_Comment by @pksunkara on 2021-01-02 02:11_

Not right now but it is in the long term future plan to reduce the binary size.

---
