<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Default template is incompatible with help2man - clap-rs/clap #1432</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Default template is incompatible with help2man</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1432">#1432</a>
        opened by <a href="https://github.com/ssokolow">@ssokolow</a>
        on 2019-03-18 22:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ssokolow">@ssokolow</a> on 2019-03-18 22:41</div>
            <div class="timeline-body"><h3>Rust Version</h3>
<pre><code>rustc 1.32.0 (9fda7c223 2019-01-16)</code></pre>
<h3>Affected Version of clap</h3>
<p>2.32.0</p>
<h3>Bug or Feature Request Summary</h3>
<p>The lack of a blank line between the <code>&lt;name&gt; &lt;version&gt;</code> line in the <code>--help</code> output and the description block causes <code>help2man</code> to mistake the <code>&lt;name&gt; &lt;version&gt;</code> line for a word-wrapped first line of the <code>about</code> or <code>long_about</code> string.</p>
<h3>Expected Behavior Summary</h3>
<p>With the example from the README, this is what I get If I add <code>\n</code> to the end of the <code>version</code> string and the beginning of the <code>about</code> string, I get this:</p>
<pre><code>MY(1)                            User Commands                           MY(1)

NAME
       My - manual page for My Super Program 1.0

DESCRIPTION
       My Super Program 1.0

       Kevin K. &lt;kbknapp@gmail.com&gt;

       Does awesome things

   USAGE:
              clap-test [FLAGS] [OPTIONS] &lt;INPUT&gt; [SUBCOMMAND]

   FLAGS:
       -h, --help
              Prints help information

       -v     Sets the level of verbosity

       -V, --version
              Prints version information

   OPTIONS:
       -c, --config &lt;FILE&gt;
              Sets a custom config file

   ARGS:
       &lt;INPUT&gt;
              Sets the input file to use

   SUBCOMMANDS:
       help   Prints this message or the help of the given subcommand(s)

       test   controls testing features

My Super Program 1.0              March 2019                             MY(1)
</code></pre>
<p>Ignore the oddity involving &quot;My&quot;. <code>help2man</code> assumes that the first word in that line will be the command's name and the rest will be the version string, and that's both easy to accomplish and the default for anyone using StructOpt.</p>
<p>(The ideal solution would be to produce an <code>AUTHORS</code> section in the help2man output, but <code>help2man</code> is designed by people who probably would see author names in <code>--help</code> as unthinkably egotistical, so there's no provision for extracting such a section automatically.)</p>
<h3>Actual Behavior Summary</h3>
<p>This is <code>help2man</code>'s output as rendered by <code>man</code>:</p>
<pre><code>MY(1)                            User Commands                           MY(1)

NAME
       My - manual page for My Super Program 1.0

DESCRIPTION
       My Super Program 1.0 Kevin K. &lt;kbknapp@gmail.com&gt; Does awesome things

   USAGE:
              clap-test [FLAGS] [OPTIONS] &lt;INPUT&gt; [SUBCOMMAND]

   FLAGS:
       -h, --help
              Prints help information

       -v     Sets the level of verbosity

       -V, --version
              Prints version information

   OPTIONS:
       -c, --config &lt;FILE&gt;
              Sets a custom config file

   ARGS:
       &lt;INPUT&gt;
              Sets the input file to use

   SUBCOMMANDS:
       help   Prints this message or the help of the given subcommand(s)

       test   controls testing features

My Super Program 1.0              March 2019                             MY(1)
</code></pre>
<h3>Steps to Reproduce the issue</h3>
<ol>
<li>Install <a href="https://www.gnu.org/software/help2man/"><code>help2man</code></a> (it's in most Linux distro repositories, which makes that part easy)</li>
<li>Choose any Clap-based command which doesn't render a blank line between the <code>about</code> or <code>long_about</code> text and the stuff above it.</li>
<li>Run <code>help2man -N 'cargo run --' &gt; test.man; man -l test.man</code></li>
</ol>
<h3>Sample Code or Link to Sample Code</h3>
<p>The code from the README which begins with <code>// (Full example with detailed comments in examples/01b_quick_example.rs)</code></p>
<h3>Debug output</h3>
<p>As this appears to be a case of &quot;operating as designed, but the design is flawed&quot;, I'll produce debug output on request.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1317.html">clap-rs/clap#1317</a> on 2019-03-19 00:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1433.html">clap-rs/clap#1433</a> on 2019-03-19 00:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../TeXitoi/structopt/issues/172.html">TeXitoi/structopt#172</a> on 2019-03-19 00:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../TeXitoi/structopt/issues/173.html">TeXitoi/structopt#173</a> on 2019-06-26 10:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-01 14:44</div>
            <div class="timeline-body"><p>But should it be?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">not-sure</span> added by @CreepySkeleton on 2020-02-01 14:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Dylan-DPC-zz">@Dylan-DPC-zz</a> on 2020-02-01 14:46</div>
            <div class="timeline-body"><p>This might be resolved now. Not sure</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ssokolow">@ssokolow</a> on 2020-02-01 16:33</div>
            <div class="timeline-body"><p>@CreepySkeleton I think it makes sense for the default output template to follow a formatting convention so common among Linux commands that a tool was written which assumes it.</p>
<p>@Dylan-DPC It's easy to check. Run <code>help2man</code> (available from pretty much any distro repository) on a clap program with the default template and then run <code>man -l &lt;FILENAME&gt;</code> on the resulting file to check whether the <code>DESCRIPTION</code> section is messed up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-02-01 18:51</div>
            <div class="timeline-body"><p>I agree with @ssokolow. But we might also have an option to just not display version and author when <code>--help</code> is printed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> added by @pksunkara on 2020-02-01 18:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cc: CreepySkeleton</span> removed by @CreepySkeleton on 2020-02-06 10:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: enhancement</span> added by @CreepySkeleton on 2020-02-06 10:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by @CreepySkeleton on 2020-02-06 10:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @CreepySkeleton on 2020-02-06 10:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-06 10:04</div>
            <div class="timeline-body"><p>I'm triaging it for 3.0 because if we won't get to it by then, we won't get to it at all.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> removed by @pksunkara on 2020-04-01 18:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: help message</span> added by @pksunkara on 2020-04-23 07:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-02-22 16:12</div>
            <div class="timeline-body"><p>@logansquirel You can try this one next ðŸ˜„. Really appreciate the contributions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> removed by @pksunkara on 2021-02-22 16:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by @pksunkara on 2021-02-22 16:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/logansquirel">@logansquirel</a> on 2021-02-24 20:07</div>
            <div class="timeline-body"><p>I need some help for this issue !</p>
<p>After reading all the discussion and related issues/pull requests, I do not know what I should implement.</p>
<p>I spent some time on this issue.
I can confirm this issue is still not resolved and the behavior described in original post is still the same with version 3.0.0-beta.2.</p>
<p>I tried to dive into help2man documentation/source code to understand how does it work but I won't be able to understand it deeply.</p>
<p>These are some ideas on top of my head:</p>
<ul>
<li><p>I change the default template to add two new line to obtain the same layout as original post.</p>
</li>
<li><p>I provide two different templates, the old one and with the new template incorporating the two new lines only applying to --help flag (the one used by help2man). Not sure this one is viable cause it will introduce differences (breaking changes) by default between -h and --help flags.</p>
</li>
<li><p>Completely remove author from the help output.</p>
</li>
<li><p>I try to contact help2man authors to understand the parsing process and see if we can obtain a format more suited to help2man parsing.</p>
</li>
<li><p>We close this issue and decide to not conform to an external tool parsing process. This path reduce maintainability cost because the help template won't be dependent to another tool. Help2man is a &quot;simple&quot; tool providing first generation of man page but nothing will replace the full writing of a well formatted man page by a programmer/author.</p>
</li>
</ul>
<p>I'm opened to other ideas, I just want to know clap authors opinion on this issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ssokolow">@ssokolow</a> on 2021-02-25 02:20</div>
            <div class="timeline-body"><p>Bear in mind that the fact that help2man <em>exists</em> speaks to the existence of a formatting convention widespread enough to make it practical.</p>
<p>Even if clap doesn't choose to explicitly support help2man, aligning itself with an established formatting convention should be considered.</p>
<p>(I'm assuming it's the GNU convention... just like <code>--long</code> and using <code>--</code> to mean &quot;end of options&quot; rather than letting <code>-</code> take on a double meaning are both GNU conventions that everyone of any consequence have adopted.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/logansquirel">@logansquirel</a> on 2021-02-25 03:31</div>
            <div class="timeline-body"><blockquote>
<p>Bear in mind that the fact that help2man <em>exists</em> speaks to the existence of a formatting convention widespread enough to make it practical.</p>
<p>Even if clap doesn't choose to explicitly support help2man, aligning itself with an established formatting convention should be considered.</p>
<p>(I'm assuming it's the GNU convention... just like <code>--long</code> and using <code>--</code> to mean &quot;end of options&quot; rather than letting <code>-</code> take on a double meaning are both GNU conventions that everyone of any consequence have adopted.)</p>
</blockquote>
<p>I concur with this !</p>
<p>In this case we have to find the convention clap should use.</p>
<p>Then I have to find the established convention. The best description I found is directly in man-pages: <a href="https://man.archlinux.org/man/core/man-pages/man-pages.7.en">man-pages</a>
In this page, the convention states that authors is highly discouraged. Removing authors seems to be the path to follow.</p>
<p>@ssokolow If you have other ressources on this convention, can you point me to these ? Did you find how help2man parsed help output ? Is there some convention/well written consensus for help flag output too ?</p>
<p>Thanks !</p>
<p>Relevant links:</p>
<ul>
<li>help text format <a href="https://stackoverflow.com/questions/9725675/is-there-a-standard-format-for-command-line-shell-help-text">question</a></li>
<li>GNU details on --version / --help flags: <a href="https://www.gnu.org/prep/standards/standards.html#Command_002dLine-Interfaces">command line interfaces</a></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-02-25 09:59</div>
            <div class="timeline-body"><p>I think we agreed on doing &quot;I add \n to the end of the version string and the beginning of the about string&quot; and that should fix this issue. Don't need to write any new tests either since many existing tests will be testing this anyway.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ssokolow">@ssokolow</a> on 2021-02-25 12:04</div>
            <div class="timeline-body"><p>@logansquirel I haven't had time to dig deeper, so all I have on hand is:</p>
<ol>
<li>The <a href="https://www.gnu.org/software/help2man/#g_t_002d_002dhelp-recommendations"><code>--help</code> Recommendations</a> section of the help2man manual.</li>
<li>The knowledge that help2man employs a Markdown-like heuristic for un-wrapping hard-wrapped lines. (That's what clap is currently running afoul of.)</li>
</ol>
<p>Barring finding something more definitive for GNU conventions, I'd see how well <a href="http://docopt.org/">docopt</a> aligns with help2man heuristics since, if they get along, that'd give you a spec people are familiar with from other contexts.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2369.html">clap-rs/clap#2369</a> on 2021-02-27 08:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @pksunkara on 2021-02-27 17:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3096.html">clap-rs/clap#3096</a> on 2021-12-09 01:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:57 UTC
    </footer>
</body>
</html>
