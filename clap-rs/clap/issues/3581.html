<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reuse USAGE from clap in generated man pages - clap-rs/clap #3581</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Reuse USAGE from clap in generated man pages</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/clap-rs/clap/issues/3581">#3581</a>
        opened by <a href="https://github.com/ducaale">@ducaale</a>
        on 2022-03-26 17:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ducaale">@ducaale</a> on 2022-03-26 17:34</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>3.1.0</p>
<h3>Describe your use case</h3>
<p>N/A</p>
<h3>Describe the solution you'd like</h3>
<p>I would like <code>clap_manpage</code> to render the synopsis section similar to how it done in <code>--help</code>.</p>
<p>For reference, this how it looks in <code>xh --help</code></p>
<pre><code>USAGE:
    xh [OPTIONS] &lt;[METHOD] URL&gt; [--] [REQUEST_ITEM]...
</code></pre>
<p>And this how the synopsis is rendered in the generated manpage</p>
<pre><code>SYNOPSIS
       xh  [--help]  [-V|--version]  [-j|--json]  [-f|--form] [-m|--multipart] [--raw] [--pretty] [-s|--style] [--re‐
       sponse-charset] [--response-mime] [-p|--print] [-h|--headers] [-b|--body]  [-v|--verbose]  [--all]  [-P|--his‐
       tory-print]  [-q|--quiet]  [-S|--stream]  [-o|--output]  [-d|--download]  [-c|--continue]  [--session] [--ses‐
       sion-read-only]  [-A|--auth-type]  [-a|--auth]  [--bearer]   [--ignore-netrc]   [--offline]   [--check-status]
       [-F|--follow]  [--max-redirects] [--timeout] [--proxy] [--verify] [--cert] [--cert-key] [--ssl] [--native-tls]
       [--default-scheme]  [--https]  [--http-version]   [-I|--ignore-stdin]   [--curl]   [--curl-long]   [--no-help]
       [--no-version]  [--no-json]  [--no-form]  [--no-multipart]  [--no-raw]  [--no-pretty]  [--no-style]  [--no-re‐
       sponse-charset]  [--no-response-mime]  [--no-print]  [--no-headers]  [--no-body]   [--no-verbose]   [--no-all]
       [--no-history-print]  [--no-quiet]  [--no-stream] [--no-output] [--no-download] [--no-continue] [--no-session]
       [--no-session-read-only]  [--no-auth-type]  [--no-auth]   [--no-bearer]   [--no-ignore-netrc]   [--no-offline]
       [--no-check-status]  [--no-follow]  [--no-max-redirects] [--no-timeout] [--no-proxy] [--no-verify] [--no-cert]
       [--no-cert-key] [--no-ssl] [--no-native-tls] [--no-default-scheme] [--no-https] [--no-http-version]  [--no-ig‐
       nore-stdin] [--no-curl] [--no-curl-long] &lt;raw-method-or-url&gt; [raw-rest-args]
</code></pre>
<h3>Alternatives, if applicable</h3>
<p>Fortunately, <code>clap_mangen</code> is flexible enough when it comes to overriding sections or adding new ones</p>
<pre><code class="language-rust">let man = clap_mangen::Man::new(app);
let mut buf = Vec::new();
man.render_title(&amp;mut buf).unwrap();

roff::Roff::new()
    .control(&quot;SH&quot;, [&quot;NAME&quot;])
    .text([roff::roman(
        &quot;xh - Friendly and fast tool for sending HTTP requests&quot;,
    )])
    .control(&quot;SH&quot;, [&quot;SYNOPSIS&quot;])
    .text([roff::roman(
        &quot;xh [OPTIONS] &lt;[METHOD] URL&gt; [--] [REQUEST_ITEM]...&quot;,
    )])
    .to_writer(&amp;mut buf)
    .unwrap();
</code></pre>
<h3>Additional Context</h3>
<p>N/A</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @ducaale on 2022-03-26 17:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-03-26 18:01</div>
            <div class="timeline-body"><p>This was discussed in https://github.com/clap-rs/clap/pull/3174#discussion_r768903702</p>
<p>epage:</p>
<blockquote>
<p>Hmm, looks like this is generating a usage. Ideally we would use our regular usage generator (and respect the users usage when they call override_usage).</p>
</blockquote>
<p>@sondr3</p>
<blockquote>
<p>If we were to use something like this we'd need to have it be more modular, the render_usage() methods output is not really usable in a manpage as is since there is no formatting and it is missing all the options.</p>
</blockquote>
<p>epage:</p>
<blockquote>
<p><code>DontCollapseArgsInUsage</code> helps some but not all the way.</p>
<p>Is it recommended to not collapse anything for man pages? Seems like that could get overly verbose</p>
<p>Looks like we are italicizing the name but nothing else. On the other hand, there is a lot of relevant logic in our usage generator, like more thorough detection of required arguments, etc. I'm mixed on which way to go.</p>
</blockquote>
<p>@sondr3</p>
<blockquote>
<p>'m not sure what the preference is, <code>git</code> does some line splitting while <code>fd</code> squashes all short options together (<code>fd [-HIEsiaLp0hV] [-d depth]</code> and only shows the short name for options.</p>
</blockquote>
<p>epage:</p>
<blockquote>
<p>I guess we can stick to git's precedence for now and see how the feedback turns out</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> added by @epage on 2022-03-26 18:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-man</span> added by @epage on 2022-03-26 18:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ducaale">@ducaale</a> on 2022-03-26 18:09</div>
            <div class="timeline-body"><p>Should hidden options be visible in the synopsis section or is that a bug that needs fixing?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-03-26 18:17</div>
            <div class="timeline-body"><p>That is a bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-03-26 18:22</div>
            <div class="timeline-body"><p>btw we might be able to reuse usage formatting in the future.  Usage formatting also has a way to force certain arguments to show up without being required.  This could offer users a way to customize things (when we make usage generation public).</p>
<p>So back to reusing it.  Clap has some extensibility limitations around formatting.  Users can't provide custom-formatted strings and can't theme clap.  We've just not wanted to expose an entire formatting API in clap.  If there was another formatting API we could reuse that is fully stable, then we could.</p>
<p>We have that, ANSI escape codes.</p>
<p>My idea: We could have usage generation output ansi escape codes and parse it and turn it into ROFF</p>
<p>Building blocks:</p>
<ul>
<li>Experiment with <a href="https://crates.io/crates/fwdansi">fwdansi</a> or my own version of it and switch clap to that, allowing end-users to provide any formatting they want</li>
<li>Split out the escape parsing code for reuse</li>
<li>Another client of the escape parsing code would be a ROFF generator.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3605.html">clap-rs/clap#3605</a> on 2022-04-02 23:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:34:57 UTC
    </footer>
</body>
</html>
