<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deprecation warnings and changed `-h` output after `cargo update` with Clap version fixed to &quot;3.0.7&quot; in my `cargo.toml`   - clap-rs/clap #3525</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Deprecation warnings and changed `-h` output after `cargo update` with Clap version fixed to &quot;3.0.7&quot; in my `cargo.toml`  </h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/3525">#3525</a>
        opened by <a href="https://github.com/asishallab">@asishallab</a>
        on 2022-03-01 23:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/asishallab">@asishallab</a> on 2022-03-01 23:44</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.59.0 (9d1b2106e 2022-02-23)</p>
<h3>Clap Version</h3>
<p>3.0.7</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">use clap::{App, Arg};

fn main() {
    let matches = App::new(&quot;prot-scriber&quot;)
        .version(&quot;version 0.1.0&quot;)
        .arg(
            Arg::new(&quot;seq-sim-table&quot;)
            .required(true)
            .short('s')
            .takes_value(true)
            .long(&quot;seq-sim-table&quot;)
            .multiple_occurrences(true)
            .help(&quot;File in which to find sequence similarity search results in tabular format (SSST). Use e.g. Blast or Diamond to produce them. Required columns are: 'qacc sacc stitle' (Blast) or 'qseqid sseqid stitle' (Diamond). (See section '2. prot-scriber input preparation' for more details.) If the required columns, or more, appear in different order than shown here you must use the --header (-e) argument. If any of the input SSSTs uses a different field-separator than the '&lt;TAB&gt;' character, you must provide the --field-separator (-p) argument. You can provide multiple SSSTs, simply by repeating the -s argument, e.g. '-s queries_vs_swissprot_diamond_out.txt -s queries_vs_trembl_diamond_out.txt'. Providing multiple --seq-sim-table (-s) arguments might imply the order in which you give other arguments like --header (-e) and --field-separator (-p). See there for more details.&quot;),
        );

    // do nothing
}
</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<ol>
<li>Use a cargo,toml with clap version 3.0.7</li>
<li>Compile and see deprecation warnings</li>
<li>Use -h and --help to see differences in output</li>
<li>Please see comments below for why 2. and 3. are unexpected after a <code>cargo update</code> on March 1st</li>
</ol>
<p>OS Ubuntu 20.04</p>
<h3>Actual Behaviour</h3>
<p>The output of <code>-h</code> and <code>--help</code> is no longer identical.
Also I get deprecation warnings upon <code>cargo build</code></p>
<h3>Expected Behaviour</h3>
<p>No deprecation warnings appeared previous to a <code>cargo update</code></p>
<p>The output of <code>-h</code> and <code>--help</code> was identical.</p>
<p>Please note that I did <em>not</em> change the version of Clap in the respective dependencies section in my <code>Cargo.toml</code>.
It was <code>3.0.7</code> before and after the <code>cargo update</code> command.</p>
<h3>Additional Context</h3>
<p>Disclaimer: I am new to Rust.</p>
<p>I have a command line interface project written in Rust. Previous to today I used Clap version <code>3.0.7</code>. Today I did a <code>cargo update</code> and suddenly when compiling my project I got the deprecation warnings. Additionally the output generated by <code>-h</code> differed from that generated by <code>--help</code>. I had to introduce <code>long_help</code> and write new, shorter <code>help</code> messages.</p>
<p>What I do not understand is, why the version fixed changes its behavior? Should that not have resulted in a new version of Clap. In my understanding this is the very reason why in software development semantic versioning is used and why in <code>Cargo.toml</code> the version is fixed, so no unexpected behavior can suddenly arise.</p>
<p>Or did I misunderstand something here (see Disclaimer above)?</p>
<p>Help would be much appreciated!</p>
<h3>Debug Output</h3>
<p>None</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @asishallab on 2022-03-01 23:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-03-02 00:39</div>
            <div class="timeline-body"><blockquote>
<p>Use a cargo,toml with clap version 3.0.7
...
What I do not understand is, why the version fixed changes its behavior? Should that not have resulted in a new version of Clap. In my understanding this is the very reason why in software development semantic versioning is used and why in Cargo.toml the version is fixed, so no unexpected behavior can suddenly arise.</p>
</blockquote>
<p>A dependency like</p>
<pre><code>clap = &quot;3.0.7&quot;
</code></pre>
<p>is shorthand for</p>
<pre><code>clap = &quot;^3.0.7&quot;
</code></pre>
<p>which is shorthand for</p>
<pre><code>clap = &quot;&gt;=3.0.7,&lt;4.0&quot;
</code></pre>
<p>Or in other words, you are telling cargo to pick <strong>a</strong> version that is semver compatible with 3.0 that is at least 3.0.7.  Cargo records the exact version in a different file, the <code>Cargo.lock</code> file.  When you run <code>cargo update</code>, you are telling cargo to re-evaluate that dependency version range, picking the highest compatible version.  This led to you upgrading to clap 3.10+.</p>
<blockquote>
<p>Compile and see deprecation warnings</p>
</blockquote>
<p>The deprecation warnings are just saying that in clap 4.0, some parts of the API will be going away (clap 4.0 is still several months away) and is telling you what they are replaced with.</p>
<p>Deprecations are allowed in a minor release (going from 3.0.x to 3.1.0).  <a href="https://semver.org/#spec-item-7">Item 7</a> says:</p>
<blockquote>
<p>Minor version Y (x.Y.z | x &gt; 0) MUST be incremented if new, backwards compatible functionality is introduced to the public API. <strong>It MUST be incremented if any public API functionality is marked as deprecated.</strong> It MAY be incremented if substantial new functionality or improvements are introduced within the private code. It MAY include patch level changes. Patch version MUST be reset to 0 when minor version is incremented.</p>
</blockquote>
<p>(emphasis mine)</p>
<blockquote>
<p>Use -h and --help to see differences in output</p>
</blockquote>
<p>Textual output is a fuzzy area for backwards compatibility.  We take the stance that some things can change freely while if its generally expected for you to design your application around certain behavior, we won't change it.</p>
<p>However, we have no known changes to <code>-h</code> vs <code>--help</code> output between 3.0.7 and now.  Could you post the help output before and after?  If you commit your <code>Cargo.lock</code> in git (which you generally should), you should be able to go back to the old commits and copy the output to here.  If you didn't commit your <code>Cargo.lock</code>, you can put <code>clap = &quot;=3.0.7&quot;</code> in your <code>Cargo.toml</code> file to revert back to the old behavior (using <code>=</code> should generally be avoided as it can cause cases where cargo can't find a usable version).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/asishallab">@asishallab</a> on 2022-03-08 16:56</div>
            <div class="timeline-body"><p>Thank you very much @epage for your insights. In the end my disclaimer of being a Rust newby was well placed.
So, this is <em>not</em> a bug. The problem was my usage of the crate.</p>
<p>I will close the issue now. Thanks again!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @asishallab on 2022-03-08 16:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:34:56 UTC
    </footer>
</body>
</html>
