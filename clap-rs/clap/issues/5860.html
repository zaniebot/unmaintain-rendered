<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`ArgMathces::args_present` behaviour with `ArgAction::SetTrue` - clap-rs/clap #5860</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>ArgMathces::args_present</code> behaviour with <code>ArgAction::SetTrue</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/5860">#5860</a>
        opened by <a href="https://github.com/Vaider7">@Vaider7</a>
        on 2024-12-25 17:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Vaider7">@Vaider7</a> on 2024-12-25 17:09</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.85.0-nightly</p>
<h3>Clap Version</h3>
<p>4.5.23</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">fn main() {
    let cli = Command::new(&quot;myapp&quot;).arg(
        Arg::new(&quot;show&quot;)
            .short('s')
            .long(&quot;show&quot;)
            .action(ArgAction::SetTrue),
    );
    let matches = cli.get_matches_from([&quot;myapp&quot;]);
    assert!(!matches.args_present());
}
</code></pre>
<p>This code panic with message</p>
<pre><code>assertion failed: !matches.args_present()
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
<p>No args were provided, but <code>args_present()</code> returns true, which I think counterintuitive</p>
<h3>Steps to reproduce the bug with the above code</h3>
<p>cargo run</p>
<h3>Actual Behaviour</h3>
<p><code>matches.args_present()</code> returns true</p>
<h3>Expected Behaviour</h3>
<p><code>matches.args_present()</code> returns false if no arguments were provided despite <code>Arg::new(&quot;show&quot;).action(ArgAction::SetTrue)</code></p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
<h3>Debug Output</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @Vaider7 on 2024-12-25 17:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-12-25 18:11</div>
            <div class="timeline-body"><p>The documentation says &quot;present on command line&quot; but the behavior is if any ids are present, like <code>contains_id</code>
https://github.com/clap-rs/clap/blob/master/clap_builder%2Fsrc%2Fparser%2Fmatches%2Farg_matches.rs#L578</p>
<p>With <code>SetTrue</code>, <code>false</code> is a default which makes it so it contains the id.</p>
<p>The <code>value_source</code> is the def√≠nitive way to know.</p>
<p>The question is whether we should change the docs or the behavior.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Vaider7">@Vaider7</a> on 2024-12-25 19:38</div>
            <div class="timeline-body"><p>Well, personally, I think it's very important to be able to check whether some args were provided via command line or not. If we change the docs, the behavior of <code>args_present</code> remains the same. And if so, <code>args_present</code> is not useful for any CLI setup, which uses <code>action(ArgAction::SetTrue)</code>, because it will always return <code>true</code> regardless of whether args were provided or not. So my personal suggestion is that <code>args_present</code> should return presence of arguments despite any <code>Command</code> setup.</p>
<p>I'm not very familiar with clap yet, so I'm sorry if I'm saying nonsense things</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-02-05 22:01</div>
            <div class="timeline-body"><p>In #3382, we added <code>args_present()</code> as a mirror to <code>is_present(id)</code>.</p>
<p>In clap 3, flag's only set a value when passed in.  With #3786, the new <code>SetTrue</code> and <code>SetFalse</code> actions started setting defaults.   In these cases, we could no longer conflate &quot;present in the structure&quot; with &quot;present on the command line&quot;.</p>
<p>In #3814, we renamed <code>is_present(id)</code> to <code>contains_id(id)</code> to better fit with the new actions.</p>
<p>We also have the <a href="https://docs.rs/clap/latest/clap/builder/enum.ArgPredicate.html#variant.IsPresent"><code>IsPresent</code></a> predicate which does check the <code>ValueSource</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Vaider7">@Vaider7</a> on 2025-02-07 12:22</div>
            <div class="timeline-body"><p>I see, thank you for the explanation.</p>
<p>But I still deeply convinced that checking if &quot;any arg presented on the command line&quot; is important feature (at least for my purposes). <a href="https://docs.rs/clap/latest/clap/builder/enum.ArgPredicate.html#variant.IsPresent"><code>IsPresent</code></a> can be used for only one concrete arg, and if there was similar functionality for <code>ArgMathces</code>, that would be great and very useful</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-02-07 16:41</div>
            <div class="timeline-body"><p>Note that wasn't necessarily a comment about what should be done for this issue but notes I took as I researched how we got here and how the term &quot;present&quot; is used.  This is important background for understanding where to go from here.</p>
<p>For instance</p>
<ul>
<li>The original intent was to communicate if arguments are present on the command-line which we are no longer upholding</li>
<li>The term &quot;present&quot; in the name matches that original intent</li>
<li>We've been in this situation for 2.5 years and no one has noticed until now</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Vaider7">@Vaider7</a> on 2025-02-07 18:37</div>
            <div class="timeline-body"><p>I think for my initial purpose to check whether any argument was provided on the command line or not the next code can be used:</p>
<pre><code class="language-rust">// no args provided
if std::env::args() == 1 {
    // do some stuff ...
}
</code></pre>
<p>But the current doc of <code>args_presnt()</code> states:</p>
<ul>
<li><code>Check if any args were present on the command line</code></li>
</ul>
<p>And I find it confusing, because it's not true it we use <code>Arg::new(&quot;somearg&quot;).action(ArgAction::SetTrue)</code></p>
<p>So my suggestion is just change its documentation. For checking presence of arguments on the command line the above simple code can be used</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-02-10 15:35</div>
            <div class="timeline-body"><blockquote>
<p>I think for my initial purpose to check whether any argument was provided on the command line or not the next code can be used:</p>
<p>// no args provided
if std::env::args() == 1 {
// do some stuff ...
}</p>
<p>...</p>
<p>So my suggestion is just change its documentation. For checking presence of arguments on the command line the above simple code can be used</p>
</blockquote>
<p>That works for the root command but not any subcommands.</p>
<p>If we changed the documentation, we'd need to also deprecate and make a new name available because <code>present</code> has a specific meaning in clap.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-02-11 19:13</div>
            <div class="timeline-body"><p>Doing a quick browse on <a href="https://github.com/search?q=args_present+language%3ARust&amp;type=code&amp;l=Rust">github</a></p>
<ul>
<li>kou: <a href="https://github.com/reinacchi/kou/blob/b00c3e700f453448a15a55c4b861b60c3d7293f7/src/commands.rs#L106">intended as documented</a> <strong>with flags</strong>, subject to this issue</li>
<li>simple-ftp-client: <a href="https://github.com/wiresock/simple-ftp-client/blob/237da6d151f2fdf393862bcab113df9c9be74a86/src/main.rs#L289">intended as documented</a> <strong>with flags</strong>, subject to this issue</li>
<li>~~erdtree: <a href="https://github.com/fawni/erdtree/blob/9905785526bb42bc870a61d052b2d3739361b306/src/render/context/mod.rs#L136">intended as documented</a> <strong>with flags</strong>, subject to this issue~~ (out of date fork)</li>
<li>solana-did-method: <a href="https://github.com/hashblock/solana-did-method/blob/d84a6bf713839212d6acb9a2da91caa08cf3d082/soldid/src/clparse.rs#L139">unsure</a></li>
<li>Chads-Advent-of-Code: <a href="https://github.com/ChadRogers0010/Chads-Advent-of-Code/blob/9b13ebdda2aa9fbe52f29352258b49719b05da3d/rust-cli/src/main/main.rs#L16">unsure</a></li>
<li>zk-avail-da/da-sender: <a href="https://github.com/lambdaclass/zk-avail-da/blob/697776aa7c01e36e35d9e9cc8d206bd39ebe793f/da-sender/src/main.rs#L32">unsure</a></li>
<li>kmerutils: <a href="https://github.com/jean-pierreBoth/kmerutils/blob/f04e9eafbeb28842221eada821fba2cb454e567a/src/bin/parsefastq.rs#L178">assumes subcommands are checked</a> (shouldn't this be broken?</li>
<li>my_rust: <a href="https://github.com/nestorwheelock/my_rust/blob/748dc07258699ac6ab9a8dd064a4b2e6d02ca2e1/src/main.rs#L174">intended as documented</a> and with what is intended to be a flag but a bug is in the code otherwise they'd run into this issue</li>
<li>Rust-CLI/unique: <a href="https://github.com/uninumber/Rust-CLI/blob/acb9a7c90a3c8a6c5c4e8f36e6eb41f29a3bce0b/uniq/src/uniq.rs#L44">intention is unclear</a></li>
<li>kaivm: <a href="https://github.com/agallardol/kaivm/blob/61f6e02edda3fca71422ac13a0fd163bd1d23628/src/command_handlers/env.rs#L17">intended as documented</a> but no flags used</li>
<li>beancount-language: <a href="https://github.com/polarmutex/beancount-language-server/blob/2582df1b303600f742e079c686064ce30ca49341/crates/lsp/src/main.rs#L18">intended as documented</a>, with a flag, but in a way that this issue doesn't change behavior</li>
<li>BlinkSync: <a href="https://github.com/Vernoxvernax/BlinkSync/blob/913a39a5f04995ecc1527b050052fb022df3a045/src/main.rs#L170">intended as documented, I think?</a> but the shirt-circuit is dead because of required arguments</li>
<li>lotr: <a href="https://github.com/TomaTechnology/lotr/blob/0e8a6609a0d6a2583e55314f122c4c3aa9e51958/src/main.rs#L374">intended as documented</a> with no flags</li>
<li>MovieChaptersPLS: <a href="https://github.com/Vernoxvernax/MovieChaptersPLS/blob/7701fef47ce124a024880a4b2c83183d269dd630/src/main.rs#L86">intent unclear</a>, used with flags and will panic if false but some arguments are required making it so the panic shouldn't be hit</li>
<li>bat: on <code>cache</code> subcommand, <a href="https://github.com/sharkdp/bat/blob/94d3dc254edb2e3364dd11af0acd0c70e7648a30/src/bin/bat/main.rs#L371">intended as documented</a> but its dead code because <a href="https://github.com/sharkdp/bat/blob/94d3dc254edb2e3364dd11af0acd0c70e7648a30/src/bin/bat/clap_app.rs#L680-L684">some arguments are required</a></li>
<li>rosu-tracker: <a href="https://github.com/Chiffario/rosu-tracker/blob/9b6c241bdd010624425681b4d0c316c14257c0c1/src/main.rs#L65">intended as documented</a> but no flags</li>
<li>nisq: <a href="https://github.com/NoHaxito/nisq/blob/f00d0e4a6ec3124b84a8fa298d80cf8f206361bd/src/main.rs#L28">intended as documented</a>, no flags</li>
<li>cim: <a href="https://github.com/feraxhp/cim/blob/4f011846aac5f0771f7d26a5426b2502acc05f18/src/main.rs#L23">intended as documented</a>, no flags</li>
<li>mdbook-embeddify: <strong><a href="https://github.com/MR-Addict/mdbook-embedify/blob/449cac73cdcbe8b55fd957bc4b0e34ec62dbee37/src/cli.rs#L24">unclear intent</a></strong>, maybe thinking it includes subcommands, like <code>args_required_else_help</code>?</li>
<li>cxl-fabric-amanger: <a href="https://github.com/computexpresslink/cxl-fabric-manager/blob/cff5d531079ee682129b89d9e0f966d4c74a6f53/fm_cli/src/multi_headed_device.rs#L37">dead code</a></li>
<li>qpass: <a href="https://github.com/mdmmn378/qpass/blob/74b88f639c54bd004362178f407e3f5f6cc4ecdc/src/main.rs#L59">intended as documented</a>, I think?  No flags</li>
<li>kvs: <a href="https://github.com/jporwal05/kvs/blob/f1f7b03e1c01fafde875cd9467e6ca53e7ba937c/src/bin/kvs.rs#L12">intended as documented</a>, no flags</li>
<li>RustLeetCode!Q: <a href="https://github.com/egehandogan35/RustLeetCodeQ/blob/88de7084a383ccb087cf534db69e4ee2b8537dfe/src/fileHash.rs#L24">unsure</a> but its redundant</li>
<li>wordle_yvaniak: <a href="https://github.com/Yvaniak/wordle_yvaniak/blob/843f26074fa482b6230fcc6f5f7d751421ff2852/src/config.rs#L54">unsure</a> but redundant</li>
<li>grp: <a href="https://github.com/feraxhp/grp/blob/9bba86c8d9b3fffb4742adfcd49e177ee9e1510c/src/main.rs#L50">intended as documented</a> but redundant</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5908.html">clap-rs/clap#5908</a> on 2025-02-11 19:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2025-02-11 19:39</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:32:08 UTC
    </footer>
</body>
</html>
