<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use Serde to parse YAML input - clap-rs/clap #853</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Use Serde to parse YAML input</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/853">#853</a>
        opened by <a href="https://github.com/dtolnay">@dtolnay</a>
        on 2017-02-16 05:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dtolnay">@dtolnay</a></div>
            <div class="timeline-body"><p>The errors from <code>clap</code> when my YAML isn&#x27;t perfect are far less helpful than they could be. This makes it difficult to iterate on a YAML input.</p>
<p>Using Serde to read the YAML, errors would be able to provide the line, column, and property path at which the error occurs.</p>
Steps to reproduce the issue
<ul>
<li>Introduce a typo in examples/17_yaml.yml (some example below)</li>
<li>cargo run --features yaml --example 17_yaml</li>
</ul>
<hr>

<pre><code>diff --git a/examples/17_yaml.yml b/examples/17_yaml.yml
index 4e55891..7226619 100644
--- a/examples/17_yaml.yml
+++ b/examples/17_yaml.yml
@@ -28,7 +28,7 @@ args:
     - flag:
         help: demo flag argument
         short: F
-        multiple: true
+        multiple: tru
         global: true
         # Conflicts, mutual overrides, and requirements can all be defined as a
         # list, where the key is the name of the other argument
</code></pre>
Actual clap error
<blockquote>
<p>failed to convert YAML String(&quot;tru&quot;) value to a string</p>
</blockquote>
<p>(this seems like a bug)</p>
Serde-style error
<blockquote>
<p>args[2].flag.multiple: invalid type: string &quot;tru&quot;, expected a boolean at line 31 column 19</p>
</blockquote>
<hr>
<pre><code>diff --git a/examples/17_yaml.yml b/examples/17_yaml.yml
index 4e55891..5b6ee43 100644
--- a/examples/17_yaml.yml
+++ b/examples/17_yaml.yml
@@ -9,7 +9,7 @@ settings:
 
 # All Args must be defined in the &#x27;args:&#x27; list where the name of the arg, is the
 # key to a Hash object
-args:
+arguments:
     # The name of this argument, is &#x27;opt&#x27; which will be used to access the value
     # later in your Rust code
     - opt:
</code></pre>
Current clap error
<ul>
<li>None, silently ignores everything I wrote</li>
</ul>
Serde-style error
<blockquote>
<p>unknown field `arguments`, expected one of `name`, `version`, `about`, `author`, `settings`, `args`, `subcommands`, `groups` at line 12 column 1</p>
</blockquote>
<hr>
<pre><code>diff --git a/examples/17_yaml.yml b/examples/17_yaml.yml
index 4e55891..a1fc412 100644
--- a/examples/17_yaml.yml
+++ b/examples/17_yaml.yml
@@ -67,7 +67,7 @@ args:
 subcommands:
     # The nae of this subcommand will be &#x27;subcmd&#x27; which can be accessed in your
     # Rust code later
-    - subcmd:
+    subcmd:
         about: demos subcommands from yaml
         version: &quot;0.1&quot;
         author: Kevin K. &lt;kbknapp@gmail.com&gt;
</code></pre>
Current clap error
<ul>
<li>None, silently ignores my subcommand</li>
</ul>
Serde-style error
<blockquote>
<p>subcommands: invalid type: map, expected a list of subcommands at line 70 column 5</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-02-16 14:40</div>
            <div class="timeline-body"><p>Thanks for the detailed write up! I&#x27;m 100% for this if it can be made in a backwards compatible way, if not 3.x shouldn&#x27;t be too far on the horizon and would accept a PR to the <code>3x-dev</code> branch.</p>
<p>I&#x27;ll mark this as &quot;help wanted&quot; simply because my bandwidth is limited right now with work and would be more than willing to take a look at a PR on the matter. Once I knock out a few more issues and my bandwidth opens back up, I&#x27;ll take a swing at implementing this if it hasn&#x27;t been done already :wink:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: yaml parser</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-02-16 14:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: intermediate</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-02-16 14:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P3: want to have</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-02-16 14:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: enhancement</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-02-16 14:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;serde&quot; by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-03-27 02:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x blocker</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-05-09 18:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#1037</a> on 2017-08-22 04:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;serde&quot; by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-02-02 01:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;v3-alpha1&quot; by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-02-02 01:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-02-05 15:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x blocker</span> removed by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-02-05 15:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-07-22 01:14</div>
            <div class="timeline-body"><p>Blocker: <a href="https://github.com/dtolnay/serde-yaml/issues/94">dtolnay/serde-yaml#94</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;v3-alpha.1&quot; by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-07-22 01:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: blocking on external</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-07-22 01:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> removed by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-07-22 01:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#1630</a> on 2020-01-10 15:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-07-20 17:26</div>
            <div class="timeline-body"><p>https://github.com/clap-rs/clap/issues/1041 would help with the lifetime blocker</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#918</a> on 2021-07-20 17:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>epage/clapng#70</a> on 2021-12-06 16:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-08 20:01</div>
            <div class="timeline-body"><p>We have decided to deprecate the YAML API.  For more details, see <a href="https://github.com/clap-rs/clap/issues/3087">clap-rs/clap#3087</a>.  If there is interest in a YAML API, it will likely be broken out into a <code>clap_yaml</code> and developed independent from the core of clap.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/epage">@epage</a> on 2021-12-08 20:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:56:46 UTC
    </footer>
</body>
</html>
