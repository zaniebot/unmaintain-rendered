<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Can't specify multiple vector elements using env vars - clap-rs/clap #4999</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Can't specify multiple vector elements using env vars</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/clap-rs/clap/issues/4999">#4999</a>
        opened by <a href="https://github.com/johananl">@johananl</a>
        on 2023-07-07 11:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/johananl">@johananl</a> on 2023-07-07 11:36</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.70.0 (90c541806 2023-05-31)</p>
<h3>Clap Version</h3>
<p>4.3.11</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">use clap::Parser;

#[derive(Parser)]
struct Cli {
    #[arg(short, env)]
    foo: Vec&lt;i32&gt;,
}

fn main() {
    let cli = Cli::parse();
    println!(&quot;{:?}&quot;, cli.foo);
}

</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<pre><code>cargo run -- -f 1 -f 2
</code></pre>
<p>Output: <code>[1, 2]</code></p>
<pre><code>FOO=1 cargo run
</code></pre>
<p>Output: <code>[1]</code></p>
<pre><code>FOO=&quot;1 2&quot; cargo run
</code></pre>
<p>Output: <code>error: invalid value '1 2' for '-f &lt;FOO&gt;': invalid digit found in string</code></p>
<pre><code>FOO=&quot;1,2&quot; cargo run
</code></pre>
<p>Output: <code>error: invalid value '1,2' for '-f &lt;FOO&gt;': invalid digit found in string</code></p>
<pre><code>FOO=&quot;1, 2&quot; cargo run
</code></pre>
<p>Output: <code>error: invalid value '1, 2' for '-f &lt;FOO&gt;': invalid digit found in string</code></p>
<pre><code>FOO=&quot;[1, 2]&quot; cargo run
</code></pre>
<p>Output: <code>error: invalid value '[1, 2]' for '-f &lt;FOO&gt;': invalid digit found in string</code></p>
<h3>Actual Behaviour</h3>
<p>When using <code>env</code> on a vector field, multiple values can be passed by specifying the argument multiple times on the CLI, however the same can't be done when using env vars (because the OS doesn't support specifying the same env var twice).</p>
<h3>Expected Behaviour</h3>
<p>I think it makes sense to have consistency between CLI args and env vars when using the <code>env</code> option even when the field is a vector. If that's not possible, the user should probably know about the expected behavior or limitation.</p>
<p>Potential solutions I can think of:</p>
<ol>
<li>Parse env var values when using <code>env</code> on vector fields and split the string into vector elements. Something like <code>FOO=&quot;[1, 2]&quot;</code> can likely be used.</li>
<li>Document the fact that when using <code>env</code> on vector fields, only one value can be specified.</li>
<li>Disallow <code>env</code> on vector fields.</li>
</ol>
<h3>Additional Context</h3>
<p><em>No response</em></p>
<h3>Debug Output</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @johananl on 2023-07-07 11:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Can't specify multiple vector element using env vars" to "Can't specify multiple vector elements using env vars" by @johananl on 2023-07-07 13:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-07-07 14:01</div>
            <div class="timeline-body"><p>You can use <a href="https://docs.rs/clap/latest/clap/struct.Arg.html#method.value_delimiter">value_delimiter</a> to split the env variable though that also means that CLI values will also be split</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5000.html">clap-rs/clap#5000</a> on 2023-07-07 14:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/johananl">@johananl</a> on 2023-07-10 09:11</div>
            <div class="timeline-body"><p>Thanks @epage. I wonder if there is a way to reconcile the behavior of CLI args and env vars for vector values, as well as whether it would make sense to do so. The problem of course isn't in clap itself, it's the fact that at the OS level it's meaningless to specify the same env var twice.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:34 UTC
    </footer>
</body>
</html>
