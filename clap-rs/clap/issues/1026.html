<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Distinguish between multiple sets of values for a multiple, min_values arg - clap-rs/clap #1026</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Distinguish between multiple sets of values for a multiple, min_values arg</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1026">#1026</a>
        opened by <a href="https://github.com/soumya92">@soumya92</a>
        on 2017-08-14 04:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/soumya92">@soumya92</a></div>
            <div class="timeline-body"><h3>Rust Version</h3>
<p>rustc 1.19.0 (0ade33941 2017-07-17)</p>
<h3>Affected Version of clap</h3>
<p>clap 2.25.0</p>
<h3>Expected Behavior Summary</h3>
<p>It would be nice to be able to distinguish between <code>-a A B C D E</code> and <code>-a A B -a C D E</code>, where <code>-a</code> is an arg with <code>min_values(2)</code> and <code>multiple(true)</code>.</p>
<p>From <a href="https://kbknapp.github.io/clap-rs/clap/struct.Arg.html#method.min_values"><code>clap::Arg::min_values</code></a></p>
<blockquote>
<p>NOTE: This does not implicitly set Arg::multiple(true). This is because -o val -o val is multiple occurrences but a single value and -o val1 val2 is a single occurence with multiple values.</p>
</blockquote>
<p>This seems to imply that such a distinction is already possible. But the test <a href="https://github.com/kbknapp/clap-rs/blob/446ec981d14a6a5d9cce16f478c4b8c0ad10a0bf/tests/multiple_values.rs#L209">option_min_exact</a> demonstrates exactly the opposite behaviour.</p>
<p>A toy example of where this might be useful is a backup program. It might allow users to backup files to multiple &quot;targets&quot;, for example, with common settings specified once. An invocation might look like:</p>
<p><code>backup -s server -u user -target target1 file1 file2 file3 -target target2 file4 file5 file6 file7 -target target3 file8</code></p>
<p>Currently there seems to be no way to determine that <code>target1</code>, <code>target2</code>, and <code>target3</code> appeared immediately after <code>-target</code>. All we know is that there are three targets (<a href="https://kbknapp.github.io/clap-rs/clap/struct.ArgMatches.html#method.occurrences_of"><code>occurrences_of(&quot;target&quot;)</code></a>), but <a href="https://kbknapp.github.io/clap-rs/clap/struct.ArgMatches.html#method.values_of"><code>values_of(&quot;target&quot;)</code></a> will just iterate over <code>target1 file1 file2 file3 target2 file4 file5 file6 file7 target3 file8</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-10-04 03:23</div>
            <div class="timeline-body"><p>hmm, perhaps adding a new setting that allows grouping values? So when iterating these values it'd be:</p>
<p><code>[&quot;arget1 file1 file2 file3&quot;, &quot;target2 file4 file5 file6 file7&quot;, &quot;target3 file8&quot;]</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> added by @kbknapp on 2017-10-04 03:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/soumya92">@soumya92</a> on 2017-10-04 05:36</div>
            <div class="timeline-body"><p>I like the idea of adding an option to enable grouping.</p>
<p><code>[[&quot;target1&quot;, &quot;file1&quot;, &quot;file2&quot;, &quot;file3&quot;], [&quot;target2&quot;, &quot;file4&quot;, &quot;file5&quot;, &quot;file6&quot;, &quot;file7&quot;], [&quot;target3&quot;, &quot;file8&quot;]]</code> would be perfect, just because that would require less processing on the app side. Otherwise the app authors would have to shell split the strings to get individual arguments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-10-04 15:08</div>
            <div class="timeline-body"><p>I don't think we could do a <code>Vec&lt;Vec&lt;&amp;str&gt;&gt;</code> in a non-breaking way just do to the signature of <code>ArgMatches::values_of</code>, however <em>in user code</em> one could do:</p>
<pre><code class="language-rust">// values are: [&quot;arget1 file1 file2 file3&quot;, &quot;target2 file4 file5 file6 file7&quot;, &quot;target3 file8&quot;]
let vals: Vec&lt;Vec&lt;_&gt;&gt; = m.values_of(&quot;arg&quot;).map(|v| v.split(&quot; &quot;).collect()).collect();
// Now: [[&quot;arget1&quot;, &quot;file1&quot;,  &quot;file2&quot;, file3&quot;], [&quot;target2&quot;, &quot;file4&quot;, &quot;file5&quot;, &quot;file6&quot;, &quot;file7&quot;], [&quot;target3&quot;, &quot;file8&quot;]]
</code></pre>
<p>Granted, I just typed that off the top of my head, so some tweaks may  be required to make it compile</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/soumya92">@soumya92</a> on 2017-10-04 17:58</div>
            <div class="timeline-body"><p>I assumed you were talking about adding ArgMatches::grouped_values_of or something similar.
Splitting on &quot; &quot; is not ideal because it will then prevent user code from being able to handle arguments that themselves contain spaces, since that information will be lost. Or it will require some weird form of escaping to distinguish between spaces used to join arguments and spaces already present in the arguments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-10-04 19:15</div>
            <div class="timeline-body"><p>Splitting on &quot; &quot; is just an example, and would be determined by the user. My point being, I don't think adding a <code>ArgMatches::grouped_values_of</code> would be easy because of the internal structure of matched values.</p>
<p>This isn't to say it's not possible, just that it'd be kind of a hacky solution (from the implementation point of view).</p>
<p>Personally I'd be more inclined to change the CLI slightly instead of using a single option for two purposes (targets <em>and</em> data).</p>
<p>I'll leave this open on the issue tracker for reference once I get a few more of the issues knocked out. This might also be easier to implement on the 3.x branch where the code is cleaner.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> added by @kbknapp on 2018-07-22 02:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: intermediate</span> added by @kbknapp on 2018-07-22 02:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: matches</span> added by @kbknapp on 2018-07-22 02:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: settings</span> added by @kbknapp on 2018-07-22 02:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by @kbknapp on 2018-07-22 02:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> removed by @kbknapp on 2018-07-22 02:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1374.html">clap-rs/clap#1374</a> on 2018-11-08 00:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tmccombs">@tmccombs</a> on 2019-09-19 07:34</div>
            <div class="timeline-body"><p>I have a use case where I want an argument that can take either two or three arguments. Specifically, it must have a timeout (in seconds) and a command to run on the timeout and possibly another command to run when another event happens after the timeout. (and this can be provided multiple times)</p>
<p>I'm not necessarily opposed to using a different scheme for the options, but I'm not sure of a good way to do that without making the interface awkward. Solutions I have considered:</p>
<ol>
<li>Using a delimeter: since the arguments are shell commands, the arguments could contain basically any character, besides having to split the argument myself, I would have to implement some kind of escape mechanism.</li>
<li>Use separate options for the first and second commands, but the option for the second command must appear immediately after the first option. However, it isn't clear to me how to implement this constraint with clap. I would probably need to do something with the indices of the arguments, which seems fairly complicated and brittle.</li>
<li>Use a separate option for the second command that also requires a timeout that means &quot;run this command if we got an event after the timeout triggered&quot;. This would be straightforward to implement, but IMO a confusing interface for the user.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JMLX42">@JMLX42</a> on 2020-02-25 10:27</div>
            <div class="timeline-body"><p>I have the following use case: I need to support &quot;localized&quot; string values on the command line.</p>
<p>A <code>LocalizedString</code> can either be:</p>
<ul>
<li>a single not-localized <code>String</code> value</li>
<li>a set of (language tag, localized string) values in a <code>Map</code></li>
</ul>
<pre><code class="language-rust">pub enum LocalizedString {
    String(String),
    Map(Map&lt;String, String&gt;),
}
</code></pre>
<p>so the following are possible:</p>
<pre><code class="language-bash">$ cli --label my-not-localized-label
</code></pre>
<pre><code class="language-bash">$ cli --label 'fr_FR:défaut' 'en_US:defect'
</code></pre>
<p>It works fine. The problem arise when I want to set <code>multiple: true</code> to describe a collection of <code>LocalizedString</code>. This does not work as expected:</p>
<pre><code class="language-bash">$ cli --option 'fr_FR:mon option 1' 'en_US:my option 1' \
    --option 'fr_FR:mon option 2' 'en_US:my option 2'
</code></pre>
<p>The goal would be to end up with this:</p>
<pre><code class="language-json">[
  {
    &quot;fr_FR&quot;: &quot;mon option 1&quot;,
    &quot;en_US&quot;: &quot;my option 1&quot;,
  },
  {
    &quot;fr_FR&quot;: &quot;mon option 2&quot;,
    &quot;en_US&quot;: &quot;my option 2&quot;,
  }
]
</code></pre>
<p>Instead, the <code>option</code> match using <code>clap</code> will be a single <code>Vec</code> containing:</p>
<pre><code class="language-json">[
  &quot;fr_FR:mon option 1&quot;,
  &quot;en_US:my option 1&quot;,
  &quot;fr_FR:mon option 2&quot;,
  &quot;en_US:my option 2&quot;
]
</code></pre>
<p>And IMHO it's then pretty much impossible to handle validation and proper handling.</p>
<p>I would expect to be able to declare that multiple occurrences of a specific option would be differentiable after the match.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @pksunkara on 2020-04-09 07:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> removed by @pksunkara on 2020-04-12 22:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P1: urgent</span> added by @pksunkara on 2020-04-12 22:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1772.html">clap-rs/clap#1772</a> on 2020-04-12 22:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sharkdp">@sharkdp</a> on 2020-04-13 17:11</div>
            <div class="timeline-body"><p>In <a href="https://github.com/sharkdp/fd"><code>fd</code></a>, we also have a use case for this: We have a <code>--exec</code>/<code>-x</code> option that takes a &quot;command&quot; in the form of multiple values, such that users do not have to add quotes and we do not have to shell-split it:</p>
<pre><code class="language-bash">fd … --exec sed -i -e 's/foo/bar/g'

            \_____________________/

          four values passed to `--exec`
</code></pre>
<p>We would now like to <a href="https://github.com/sharkdp/fd/issues/406">allow users to execute several commands</a>:</p>
<pre><code class="language-bash">fd … --exec echo &quot;Replacing foo with bar in {}&quot; \
     --exec sed -i -e 's/foo/bar/g'
</code></pre>
<p>However, with the limitation described in this ticket, I don't see a way to split these six values into two groups (of two and four values).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../sharkdp/fd/issues/406.html">sharkdp/fd#406</a> on 2020-04-13 17:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-13 17:53</div>
            <div class="timeline-body"><p>We will be definitely fixing this before 3.0 is out. This is one of the highest priority issue IMO.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1828.html">clap-rs/clap#1828</a> on 2020-04-15 22:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JMLX42">@JMLX42</a> on 2020-06-09 09:58</div>
            <div class="timeline-body"><p>@pksunkara any update on this? Thanks 3000!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-06-09 10:35</div>
            <div class="timeline-body"><p>Nothing yet. Still working on some other stuff first.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-06-09 11:13</div>
            <div class="timeline-body"><p>I'm working on it, but I'm as well working on other stuff concurrently  (clap book, sane global args representation, sane default values, some groups bugs) so don't expect it to be dealt with soon.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2297.html">clap-rs/clap#2297</a> on 2021-01-17 14:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @pksunkara on 2021-02-07 15:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2924.html">clap-rs/clap#2924</a> on 2021-10-23 14:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/148.html">epage/clapng#148</a> on 2021-12-06 19:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/229.html">epage/clapng#229</a> on 2021-12-06 22:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:46:58 UTC
    </footer>
</body>
</html>
