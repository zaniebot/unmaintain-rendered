<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>When taking in an input file as &quot;tes.txt&quot; or &quot;test.txt&quot;, clap tries to treat it as a subcommand and it fails - clap-rs/clap #2001</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>When taking in an input file as &quot;tes.txt&quot; or &quot;test.txt&quot;, clap tries to treat it as a subcommand and it fails</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/2001">#2001</a>
        opened by <a href="https://github.com/embeddedpenguin">@embeddedpenguin</a>
        on 2020-07-05 16:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/embeddedpenguin">@embeddedpenguin</a></div>
            <div class="timeline-body">Code
<pre><code>// You code goes here. Please try to write a complete program,
// including `fn main() { ... }`
extern crate clap;
use clap::{Arg, App, SubCommand};

fn main()
{
	let matches = App::new(&quot;Igloo&quot;)
		.version(&quot;0.0.1&quot;)
		.author(&quot;Penguin &lt;&gt;&quot;)
		.about(&quot;Stuff&quot;)
		.arg(Arg::with_name(&quot;config&quot;)
			 .short(&quot;c&quot;)
			 .long(&quot;config&quot;)
			 .value_name(&quot;FILE&quot;)
			 .help(&quot;Sets a custom config file&quot;)
			 .takes_value(true))
		.arg(Arg::with_name(&quot;INPUT&quot;)
			 .help(&quot;Sets the input file to use&quot;)
			 .required(true)
			 .index(1))
		.arg(Arg::with_name(&quot;v&quot;)
			 .short(&quot;v&quot;)
			 .multiple(true)
			 .help(&quot;Sets the level of verbosity&quot;))
		.subcommand(SubCommand::with_name(&quot;test&quot;)
					.about(&quot;Controls testing features&quot;)
					.version(&quot;1.3&quot;)
					.author(&quot;Name &lt;&gt;&quot;)
					.arg(Arg::with_name(&quot;debug&quot;)
						 .long(&quot;debug&quot;)
						 .short(&quot;d&quot;)
						 .help(&quot;print debug information verbosely&quot;)))
		.get_matches();

	// gets a value for config if supplied by a user, or defaults to &quot;default.conf&quot;
	let config = matches.value_of(&quot;config&quot;).unwrap_or(&quot;default.conf&quot;);
	println!(&quot;Value for config: {}&quot;, config);

	// vary the output based on how many times the user used the &quot;verbose&quot; flag
	// i.e. &#x27;myprog -v -v -v&#x27; or &#x27;myprog -vvv&#x27; vs &#x27;myprog -v&#x27;
	match matches.occurrences_of(&quot;v&quot;)
	{
		0 =&gt; println!(&quot;No verbose info&quot;),
		1 =&gt; println!(&quot;Some verbose info&quot;),
		2 =&gt; println!(&quot;Tons of verbose info&quot;),
		3 | _ =&gt; println!(&quot;Don&#x27;t be crazy&quot;),
	}

	// You can handle information about subcommands by requesting their matches by name
	// (as below), requesting just the name used, or both at the same time
	if let Some(matches) = matches.subcommand_matches(&quot;test&quot;)
	{
		if matches.is_present(&quot;debug&quot;)
		{
			println!(&quot;Printing debug info...&quot;);
		}
		else
		{
			println!(&quot;printing normally...&quot;);
		}
	}
}
</code></pre>
Steps to reproduce the issue
<ol>
<li>build as normal with <code>cargo build</code></li>
<li>run with <code>./target/release/&lt;bin&gt; &lt;subcommand name here&gt;.txt</code></li>
<li>PROFIT $$$$$</li>
</ol>
Version
<ul>
<li><strong>Rust</strong>: rustc 1.44.1 (c7087fe00 2020-06-17)</li>
<li><strong>Clap</strong>: &quot;~2.33.1&quot;</li>
</ul>
Actual Behavior Summary
<p>I&#x27;m following the example from this video: https://www.youtube.com/watch?v=7z9L6NOjbqM&amp;list=PLza5oFLQGTl2Z5T8g1pRkIynR3E0_pc7U</p>
<p>I am using the name &quot;test.txt&quot; as my input file and running it with the following command:
<code>./target/release/&lt;bin&gt; test.txt</code></p>
<p>I get the following output:</p>
<pre><code>./target/release/igloo test.txt
error: The subcommand &#x27;test.txt&#x27; wasn&#x27;t recognized
	Did you mean &#x27;test&#x27;?

If you believe you received this message in error, try re-running with &#x27;igloo -- test.txt&#x27;

USAGE:
    igloo [FLAGS] [OPTIONS] &lt;INPUT&gt; [SUBCOMMAND]

For more information try --help
</code></pre>
Expected Behavior Summary
<p>It shouldn&#x27;t be looking for a command if it is a file, right? So why is it trying to autocorrect a required input to a subcommand? Does this mean I can&#x27;t make any subcommands that might be related to the file names that a user might input?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by <a href="https://github.com/embeddedpenguin">@embeddedpenguin</a> on 2020-07-05 16:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-07-05 16:44</div>
            <div class="timeline-body"><p>Yeah, this is a bug, but it appears to be fixed in master:</p>
<pre><code>use clap::{Arg, App};

fn main()
{
    let matches = App::new(&quot;Igloo&quot;)
        .version(&quot;0.0.1&quot;)
        .author(&quot;Penguin &lt;&gt;&quot;)
        .about(&quot;Stuff&quot;)
        .arg(Arg::new(&quot;config&quot;)
             .short(&#x27;c&#x27;)
             .long(&quot;config&quot;)
             .value_name(&quot;FILE&quot;)
             .about(&quot;Sets a custom config file&quot;)
             .takes_value(true))
        .arg(Arg::new(&quot;INPUT&quot;)
             .about(&quot;Sets the input file to use&quot;)
             .required(true)
             .index(1))
        .arg(Arg::new(&quot;v&quot;)
             .short(&#x27;v&#x27;)
             .multiple(true)
             .about(&quot;Sets the level of verbosity&quot;))
        .subcommand(App::new(&quot;test&quot;)
                    .about(&quot;Controls testing features&quot;)
                    .version(&quot;1.3&quot;)
                    .author(&quot;Name &lt;&gt;&quot;)
                    .arg(Arg::new(&quot;debug&quot;)
                         .long(&quot;debug&quot;)
                         .short(&#x27;d&#x27;)
                         .about(&quot;print debug information verbosely&quot;)))
        .get_matches();

    println!(&quot;{:#?}&quot;, matches);
}
</code></pre>
<pre><code>[Running: cargo run --message-format=json -- test.txt]
   Compiling probe v0.2.0 (D:\workspace\probe)
    Finished dev [unoptimized + debuginfo] target(s) in 1.79s
     Running `target\debug\probe.exe test.txt`
ArgMatches {
    args: {
        INPUT: MatchedArg {
            occurs: 1,
            ty: CommandLine,
            indices: [
                1,
            ],
            vals: [
                &quot;test.txt&quot;,
            ],
        },
    },
    subcommand: None,
}
</code></pre>
<p>We don&#x27;t really work on <code>clap 2</code> anymore (unless it&#x27;s a security vulnerability), so I guess you&#x27;re going to have to wait for <code>3.0</code> to be released. Sorry.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-07-05 16:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/embeddedpenguin">@embeddedpenguin</a> on 2020-07-05 16:49</div>
            <div class="timeline-body"><p>I&#x27;m perfectly fine with using the version 3 even if its in beta. I&#x27;m just new to rust and didn&#x27;t know if beta meant not working. Thanks for the quick response!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-07-05 16:57</div>
            <div class="timeline-body"><p>&quot;Beta&quot; means &quot;you&#x27;re outside of normal semver guarantees and we still hold the right to break public API until proper <code>3.0.0</code> is released&quot;. It&#x27;s also documented poorly.</p>
<p>But otherwise, it works, mostly fine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>getsentry/sentry-cli#686</a> on 2020-07-10 10:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:57:49 UTC
    </footer>
</body>
</html>
