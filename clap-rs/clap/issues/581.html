<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Using a binary name with an underscore leads to panic on completion generation - clap-rs/clap #581</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Using a binary name with an underscore leads to panic on completion generation</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/581">#581</a>
        opened by <a href="https://github.com/ruabmbua">@ruabmbua</a>
        on 2016-07-14 15:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ruabmbua">@ruabmbua</a></div>
            <div class="timeline-body"><p>I tried to upgrade clap-rs on my command line utility and include the new awesome bash completion generation in my build.rs file. I followed the recommendation to how do things in the docs, but my build.rs files panics at execution.</p>
<p><a href="https://gist.github.com/ruabmbua/9dfea00a9781d61897ab92e644c57746">Error backtrace</a></p>
<p>I think the error is sub command related becaue of this line of code, where the nasty unwrap lies: <a href="https://github.com/kbknapp/clap-rs/blob/master/src/completions.rs#L154">Bad Code</a></p>
<p>The code used for clap::App generation looks like this: <a href="https://gist.github.com/ruabmbua/d3cf1cad6ece0fc07dfda43b5c2d6562">The Code</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Unwrap panics on completions generation&quot; to &quot;Unwrap panic on completions generation&quot; by <a href="https://github.com/ruabmbua">@ruabmbua</a> on 2016-07-14 15:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/guiniol">@guiniol</a> on 2016-07-21 20:12</div>
            <div class="timeline-body"><p>Hello,</p>
<p>I think I have the same error, but I&#x27;m using the standard way of declaring subcommands and args.
I tried removing the subcommands and in that case it works. I&#x27;m pretty new to Rust and it&#x27;s my first time using clap, so I may be doing some things wrong.</p>
<p>For a small test case, see https://github.com/guiniol/dnsmole . It doesn&#x27;t do anything except handle subcommands and args for now. Trying to run <code>dnsmole serve target</code> gives the same <code>thread &#x27;&lt;main&gt;&#x27; panicked at &#x27;called</code>Option::unwrap()<code>on a</code>None<code>value&#x27;, src/libcore/option.rs:325</code></p>
<p>Cheers,</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ruabmbua">@ruabmbua</a> on 2016-07-21 20:14</div>
            <div class="timeline-body"><p>I do not use subcommands at all, but it still crashes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/guiniol">@guiniol</a> on 2016-07-23 15:29</div>
            <div class="timeline-body"><p>So. I did a bit more testing and the problem seems to positional arguments in subcommands
We should maybe close this one and open a new issue.
EDIT: opened #592</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-07-23 17:30</div>
            <div class="timeline-body"><p>Thanks for filing this! I&#x27;m going through all the issues and PRs that accumulated while I was traveling. I should be able to get to this shortly. I&#x27;ll post back with any questions or findings :wink:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/kbknapp">@kbknapp</a> by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-07-23 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-07-23 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-07-23 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: subcommands</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-07-23 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-07-23 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: completion gen</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-07-23 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P1: urgent</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-08-20 21:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> removed by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-08-20 21:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;2.10.1&quot; by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-08-20 22:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-08-20 22:32</div>
            <div class="timeline-body"><p>@ruabmbua I&#x27;m finally back from all my travels. Can you give me some more details on this error? I&#x27;m not quite clear on what code is making it panic.
Could you give a static-reference to the line of code that you think is causing the error? Press &#x27;y&#x27; on the github page, then link to the line.</p>
<p>If we can&#x27;t figure it out that way, you can compile clap with the <code>debug</code> feature which will spit out all kinds of debugging info that can be helpful. Just change your <code>Cargo.toml</code> to</p>
<pre><code>[dependencies]
clap = {version = &quot;2.10.0&quot;, features = [&quot;debug&quot;] }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;2.10.1&quot; by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-08-20 22:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ruabmbua">@ruabmbua</a> on 2016-08-21 05:25</div>
            <div class="timeline-body"><p>@kbknapp sadly I am going on a travel for a week starting today ^^. I already noticed, that my line markings in the github links are wrong, but you could try finding the line by checking out the HEAD from the issues creation date.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-08-21 19:54</div>
            <div class="timeline-body"><p>Ah ok, I see now. I&#x27;ll do some testing and see what I can find.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;2.10.5&quot; by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-08-26 15:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;2.10.5&quot; by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-08-27 23:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lukaspustina">@lukaspustina</a> on 2016-11-08 10:31</div>
            <div class="timeline-body"><p>Just pinging: Any updates on this issue? I&#x27;m observing the same for &#x27;bash&#x27; and &#x27;zsh&#x27; in clap 2.18.0.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-11-08 20:31</div>
            <div class="timeline-body"><p>@lukaspustina can you give me a minimal example that&#x27;s causing the panic?</p>
<p>Also, if you compile clap with the <code>debug</code> cargo feature it&#x27;ll spit out tons of data you could paste into a gist or here that&#x27;ll help track down the issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lukaspustina">@lukaspustina</a> on 2016-11-09 08:07</div>
            <div class="timeline-body"><p>@kbknapp sorry, I should have presented more information. I&#x27;ll be quite busy today, but might be able to prepare what you&#x27;re asking for tmr. Meanwhile, if you&#x27;re interested, I created a branch of my project in which the problem occurs; cf. https://github.com/lukaspustina/bosun_emitter/tree/shell_completions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-11-09 15:28</div>
            <div class="timeline-body"><p>Thanks, I&#x27;ll try to do the testing tonight after work on that branch. Once I check the <code>debug</code> output, I should be able to  see where the problem lies and won&#x27;t need the minimal test case :wink:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lukaspustina">@lukaspustina</a> on 2016-11-09 16:01</div>
            <div class="timeline-body"><p>Alright. Please let me know, if I can be of any assistance.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-11-10 01:09</div>
            <div class="timeline-body"><p>@ruabmbua @lukaspustina</p>
<p>I found the issue. This is caused by having a binary name that includes an underscore (<code>_</code>). The reasoning behind this is the bash completions use the underscore character to handle subcommands.</p>
<p>The quick fix is to use a binary name that doesn&#x27;t include an underscore. I&#x27;ll work on a solution to work around this in clap but it may be complicated. At the very least, this should be documented in the completion documentations.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Unwrap panic on completions generation&quot; to &quot;Using a binary name with an underscore leads to panic on completion generation&quot; by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-11-10 01:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lukaspustina">@lukaspustina</a> on 2016-11-15 10:45</div>
            <div class="timeline-body"><p>Hi @kbknapp,</p>
<p>thanks for looking into the issue and finding the reason. Unfortunately, renaming the binary is not an option since we use it in a many scripts. But I&#x27;m patient and wait until you&#x27;ll find time to fix the underlying problems.</p>
<p>Thanks again.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ruabmbua">@ruabmbua</a> on 2016-11-15 11:02</div>
            <div class="timeline-body"><p>@kbknapp thanks for looking into it.</p>
<p>Now I can use auto completion too :-).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#754</a> on 2016-11-20 19:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;2.20.2&quot; by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-30 04:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;2.20.3&quot; by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-02-03 16:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;2.20.2&quot; by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-02-03 16:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#841</a> on 2017-02-03 16:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-02-03 18:43</div>
            <div class="timeline-body"><p>@lukaspustina once #843 merges I&#x27;ll put out v2.20.3 on crates.io at which point completion works even with underscores in the names. Apologies for the wait!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lukaspustina">@lukaspustina</a> on 2017-02-03 18:44</div>
            <div class="timeline-body"><p>@kbknapp Don&#x27;t you worry. I&#x27;m happy you found time to fix this :)
Please ping me once the crate is updates. TIA.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-02-03 22:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:56:30 UTC
    </footer>
</body>
</html>
