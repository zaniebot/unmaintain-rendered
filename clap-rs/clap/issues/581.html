<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Using a binary name with an underscore leads to panic on completion generation - clap-rs/clap #581</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Using a binary name with an underscore leads to panic on completion generation</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/581">#581</a>
        opened by <a href="https://github.com/ruabmbua">@ruabmbua</a>
        on 2016-07-14 15:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ruabmbua">@ruabmbua</a> on 2016-07-14 15:07</div>
            <div class="timeline-body"><p>I tried to upgrade clap-rs on my command line utility and include the new awesome bash completion generation in my build.rs file. I followed the recommendation to how do things in the docs, but my build.rs files panics at execution.</p>
<p><a href="https://gist.github.com/ruabmbua/9dfea00a9781d61897ab92e644c57746">Error backtrace</a></p>
<p>I think the error is sub command related becaue of this line of code, where the nasty unwrap lies: <a href="https://github.com/kbknapp/clap-rs/blob/master/src/completions.rs#L154">Bad Code</a></p>
<p>The code used for clap::App generation looks like this: <a href="https://gist.github.com/ruabmbua/d3cf1cad6ece0fc07dfda43b5c2d6562">The Code</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Unwrap panics on completions generation" to "Unwrap panic on completions generation" by @ruabmbua on 2016-07-14 15:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/guiniol">@guiniol</a> on 2016-07-21 20:12</div>
            <div class="timeline-body"><p>Hello,</p>
<p>I think I have the same error, but I'm using the standard way of declaring subcommands and args.
I tried removing the subcommands and in that case it works. I'm pretty new to Rust and it's my first time using clap, so I may be doing some things wrong.</p>
<p>For a small test case, see https://github.com/guiniol/dnsmole . It doesn't do anything except handle subcommands and args for now. Trying to run <code>dnsmole serve target</code> gives the same <code>thread '&lt;main&gt;' panicked at 'called</code>Option::unwrap()<code>on a</code>None<code>value', src/libcore/option.rs:325</code></p>
<p>Cheers,</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ruabmbua">@ruabmbua</a> on 2016-07-21 20:14</div>
            <div class="timeline-body"><p>I do not use subcommands at all, but it still crashes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/guiniol">@guiniol</a> on 2016-07-23 15:29</div>
            <div class="timeline-body"><p>So. I did a bit more testing and the problem seems to positional arguments in subcommands
We should maybe close this one and open a new issue.
EDIT: opened #592</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-07-23 17:30</div>
            <div class="timeline-body"><p>Thanks for filing this! I'm going through all the issues and PRs that accumulated while I was traveling. I should be able to get to this shortly. I'll post back with any questions or findings :wink:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @kbknapp by @kbknapp on 2016-07-23 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @kbknapp on 2016-07-23 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> added by @kbknapp on 2016-07-23 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: subcommands</span> added by @kbknapp on 2016-07-23 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @kbknapp on 2016-07-23 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: completion gen</span> added by @kbknapp on 2016-07-23 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P1: urgent</span> added by @kbknapp on 2016-08-20 21:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> removed by @kbknapp on 2016-08-20 21:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "2.10.1" by @kbknapp on 2016-08-20 22:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-08-20 22:32</div>
            <div class="timeline-body"><p>@ruabmbua I'm finally back from all my travels. Can you give me some more details on this error? I'm not quite clear on what code is making it panic.
Could you give a static-reference to the line of code that you think is causing the error? Press 'y' on the github page, then link to the line.</p>
<p>If we can't figure it out that way, you can compile clap with the <code>debug</code> feature which will spit out all kinds of debugging info that can be helpful. Just change your <code>Cargo.toml</code> to</p>
<pre><code class="language-toml">[dependencies]
clap = {version = &quot;2.10.0&quot;, features = [&quot;debug&quot;] }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "2.10.1" by @kbknapp on 2016-08-20 22:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ruabmbua">@ruabmbua</a> on 2016-08-21 05:25</div>
            <div class="timeline-body"><p>@kbknapp sadly I am going on a travel for a week starting today ^^. I already noticed, that my line markings in the github links are wrong, but you could try finding the line by checking out the HEAD from the issues creation date.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-08-21 19:54</div>
            <div class="timeline-body"><p>Ah ok, I see now. I'll do some testing and see what I can find.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "2.10.5" by @kbknapp on 2016-08-26 15:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "2.10.5" by @kbknapp on 2016-08-27 23:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lukaspustina">@lukaspustina</a> on 2016-11-08 10:31</div>
            <div class="timeline-body"><p>Just pinging: Any updates on this issue? I'm observing the same for 'bash' and 'zsh' in clap 2.18.0.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-11-08 20:31</div>
            <div class="timeline-body"><p>@lukaspustina can you give me a minimal example that's causing the panic?</p>
<p>Also, if you compile clap with the <code>debug</code> cargo feature it'll spit out tons of data you could paste into a gist or here that'll help track down the issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lukaspustina">@lukaspustina</a> on 2016-11-09 08:07</div>
            <div class="timeline-body"><p>@kbknapp sorry, I should have presented more information. I'll be quite busy today, but might be able to prepare what you're asking for tmr. Meanwhile, if you're interested, I created a branch of my project in which the problem occurs; cf. https://github.com/lukaspustina/bosun_emitter/tree/shell_completions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-11-09 15:28</div>
            <div class="timeline-body"><p>Thanks, I'll try to do the testing tonight after work on that branch. Once I check the <code>debug</code> output, I should be able to  see where the problem lies and won't need the minimal test case :wink:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lukaspustina">@lukaspustina</a> on 2016-11-09 16:01</div>
            <div class="timeline-body"><p>Alright. Please let me know, if I can be of any assistance.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-11-10 01:09</div>
            <div class="timeline-body"><p>@ruabmbua @lukaspustina</p>
<p>I found the issue. This is caused by having a binary name that includes an underscore (<code>_</code>). The reasoning behind this is the bash completions use the underscore character to handle subcommands.</p>
<p>The quick fix is to use a binary name that doesn't include an underscore. I'll work on a solution to work around this in clap but it may be complicated. At the very least, this should be documented in the completion documentations.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Unwrap panic on completions generation" to "Using a binary name with an underscore leads to panic on completion generation" by @kbknapp on 2016-11-10 01:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lukaspustina">@lukaspustina</a> on 2016-11-15 10:45</div>
            <div class="timeline-body"><p>Hi @kbknapp,</p>
<p>thanks for looking into the issue and finding the reason. Unfortunately, renaming the binary is not an option since we use it in a many scripts. But I'm patient and wait until you'll find time to fix the underlying problems.</p>
<p>Thanks again.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ruabmbua">@ruabmbua</a> on 2016-11-15 11:02</div>
            <div class="timeline-body"><p>@kbknapp thanks for looking into it.</p>
<p>Now I can use auto completion too :-).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/754.html">clap-rs/clap#754</a> on 2016-11-20 19:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "2.20.2" by @kbknapp on 2017-01-30 04:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "2.20.3" by @kbknapp on 2017-02-03 16:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "2.20.2" by @kbknapp on 2017-02-03 16:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/841.html">clap-rs/clap#841</a> on 2017-02-03 16:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-02-03 18:43</div>
            <div class="timeline-body"><p>@lukaspustina once #843 merges I'll put out v2.20.3 on crates.io at which point completion works even with underscores in the names. Apologies for the wait!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lukaspustina">@lukaspustina</a> on 2017-02-03 18:44</div>
            <div class="timeline-body"><p>@kbknapp Don't you worry. I'm happy you found time to fix this :)
Please ping me once the crate is updates. TIA.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2017-02-03 22:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:18 UTC
    </footer>
</body>
</html>
