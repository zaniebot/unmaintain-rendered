```yaml
number: 3280
title: Derive should only show help when argc==1 rather than missing subcommand
type: issue
state: closed
author: epage
labels:
  - C-bug
  - E-easy
  - A-derive
assignees: []
created_at: 2022-01-11T17:58:26Z
updated_at: 2022-07-22T17:52:06Z
url: https://github.com/clap-rs/clap/issues/3280
synced_at: 2026-01-10T01:57:46Z
```

# Derive should only show help when argc==1 rather than missing subcommand

---

_Issue opened by @epage on 2022-01-11 17:58_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the existing issues

### Rust Version

rustc 1.57.0 (f1edd0429 2021-11-29)

### Clap Version

v3.0.6

### Minimal reproducible code

```rust
use clap::{AppSettings, Parser, Subcommand};

#[derive(Parser)]
#[clap(author, version, about, long_about = None)]
#[clap(global_setting(AppSettings::PropagateVersion))]
#[clap(global_setting(AppSettings::UseLongFormatForHelpSubcommand))]
struct Cli {
    #[clap(short, long, parse(from_occurrences), global = true)]
    verbose: usize,

    #[clap(subcommand)]
    command: Commands,
}

#[derive(Subcommand)]
enum Commands {
    /// Adds files to myapp
    Add { name: Option<String> },
}

fn main() {
    let cli = Cli::parse();

    // You can check for the existence of subcommands, and if found use their
    // matches just as you would the top level app
    match &cli.command {
        Commands::Add { name } => {
            println!("'myapp add' was used, name is: {:?}", name)
        }
    }
}

```


### Steps to reproduce the bug with the above code

```console
$ cargo run -- -v
```

### Actual Behaviour

```console
$ cargo run -- -v
   Compiling test-clap v0.1.0 (/home/epage/src/personal/test-clap)
    Finished dev [unoptimized + debuginfo] target(s) in 0.70s
     Running `target/debug/test-clap -v`
test-clap 0.1.0
Me
From Cargo.toml

USAGE:
    test-clap [OPTIONS] <SUBCOMMAND>

OPTIONS:
    -h, --help       Print help information
    -v, --verbose    
    -V, --version    Print version information

SUBCOMMANDS:
    add     Adds files to myapp
    help    Print this message or the help of the given subcommand(s)

```

### Expected Behaviour

```console
$ cargo run -- -v
   Compiling test-clap v0.1.0 (/home/epage/src/personal/test-clap)
    Finished dev [unoptimized + debuginfo] target(s) in 0.67s
     Running `target/debug/test-clap -v`
error: 'test-clap' requires a subcommand, but one was not provided

USAGE:
    test-clap [OPTIONS] <SUBCOMMAND>

For more information try --help
```

### Additional Context

To reproduce the desired behavior:
```rust
#[clap(setting(AppSettings::SubcommandRequired))]
#[clap(setting(AppSettings::ArgRequiredElseHelp))]
#[clap(unset_setting(AppSettings::SubcommandRequiredElseHelp))]
```

This was inspired by a conversation in #2513 

In my mind, showing of help should be reserved for when the user has taken no action but `SubcommandRequired` allows the user to pass some arguments.  In those cases, we should be showing a more specific error message than a long, generic message that takes the user some work to figure out what the next steps are.

### Debug Output

_No response_

---

_Label `C-bug` added by @epage on 2022-01-11 17:58_

---

_Label `S-waiting-on-decision` added by @epage on 2022-01-11 17:58_

---

_Label `A-builder` added by @epage on 2022-01-11 17:58_

---

_Label `A-derive` added by @epage on 2022-01-11 17:58_

---

_Comment by @epage on 2022-01-11 17:59_

I do not think this dramatically breaks user expectations that this would be considered a breaking change and can happen anytime,

---

_Comment by @epage on 2022-01-11 18:01_

Personally, I think we should deprecate and remove `SubcommandRequiredElseHelp` in favor of `SubcommandRequired | ArgRequiredElseHelp` (resolving this issue doesn't need to be blocked on a decision about this but we will then need to create a separate issue).  The behavior seems too close to justify having both.  We are working to find ways to simplify clap to reduce API overhead (didn't know you could get this better behavior and actually thought this was what I was getting) and code bloat from too much built-in customization.

29ca7b2f74376ca0cdb9d8ee3bfa99f7640cc404 and #133 don't include details as to why we have both.

---

_Label `S-waiting-on-decision` removed by @epage on 2022-01-11 18:01_

---

_Label `A-builder` removed by @epage on 2022-01-11 18:01_

---

_Label `E-easy` added by @epage on 2022-01-11 18:01_

---

_Comment by @epage on 2022-01-11 18:02_

I guess a question for 4.0 is if we should stop including `ArgRequiredElseHelp` by default and require users to opt-in.  I'm mixed on that.

---

_Referenced in [clap-rs/clap#2513](../../clap-rs/clap/issues/2513.md) on 2022-01-11 18:07_

---

_Referenced in [clap-rs/clap#2717](../../clap-rs/clap/issues/2717.md) on 2022-02-10 19:08_

---

_Comment by @epage on 2022-02-11 17:57_

Experimented with this recently.  `SubcommandRequired` has higher precedence than `ArgRequiredElseHelp`.  We'd need to swap these.

---

_Referenced in [clap-rs/clap#3455](../../clap-rs/clap/pulls/3455.md) on 2022-02-11 21:19_

---

_Referenced in [clap-rs/clap#3456](../../clap-rs/clap/pulls/3456.md) on 2022-02-11 21:33_

---

_Referenced in [SeaQL/sea-orm#664](../../SeaQL/sea-orm/issues/664.md) on 2022-04-09 22:42_

---

_Added to milestone `3.x` by @epage on 2022-05-09 20:59_

---

_Referenced in [clap-rs/clap#3721](../../clap-rs/clap/issues/3721.md) on 2022-05-12 08:58_

---

_Removed from milestone `3.x` by @epage on 2022-06-08 16:02_

---

_Added to milestone `4.0` by @epage on 2022-06-08 16:02_

---

_Referenced in [clap-rs/clap#3822](../../clap-rs/clap/issues/3822.md) on 2022-06-14 12:52_

---

_Referenced in [clap-rs/clap#3969](../../clap-rs/clap/pulls/3969.md) on 2022-07-22 17:23_

---

_Closed by @epage on 2022-07-22 17:52_

---

_Referenced in [clap-rs/clap#6001](../../clap-rs/clap/issues/6001.md) on 2025-05-12 09:53_

---
