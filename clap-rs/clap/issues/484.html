<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collect all arguments after -- - clap-rs/clap #484</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Collect all arguments after --</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/484">#484</a>
        opened by <a href="https://github.com/jimmycuadra">@jimmycuadra</a>
        on 2016-04-12 21:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jimmycuadra">@jimmycuadra</a></div>
            <div class="timeline-body"><p>I have a program that wraps another one, and I'd like the ability to use the common <code>--</code> syntax as a separator that means &quot;anything that appears after this should be passed through as raw input&quot; so that I can treat all the extra trailing arguments as raw input for the underlying program. If I have a program invoked like this:</p>
<pre><code class="language-bash">example --my-opt some-value --some-flag -- baz --blah
</code></pre>
<p>I'd like to be able to do this in Rust code:</p>
<pre><code class="language-rust">let matches = clap_app.get_matches();

assert_eq!(matches.extra_args(), &amp;[&quot;baz&quot;, &quot;--blah&quot;]);
</code></pre>
<p>I can work around this right now by using <code>AppSettings::TrailingVarArg</code>, but that requires that the &quot;extra&quot; captured arguments are given a name which will show up in the help output by default. Even if I hide the argument from help, it won't adhere to the <code>--</code> pattern. It'd be nice to be able to use the <code>--</code> pattern without configuring it manually with various Clap settings.</p>
<p>Edit: It looks like Clap does respect <code>--</code> at least in terms of using it to disambiguate trailing arguments from things it should try to parse itself. If I use <code>AppSettings::TrailingVarArg</code> with the example command above, but remove the <code>--</code>, it tries to parse <code>--blah</code> as an option to the Clap app.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-04-17 23:04</div>
            <div class="timeline-body"><p>@jimmycuadra First, sorry for the long wait, I've been out of the loop for the past week!</p>
<p>The <code>TrailingVarArg</code> requires a positional argument be defined so that it can be the one to store all the &quot;non parsed&quot; args, and shows up in the help text unless hidden (like you mention).</p>
<p>Assuming you don't have any other optional positional arguments with a lower index, <code>TrailingVarArg</code> should also work <em>without</em> <code>--</code>, in which case all trailing arguments <code>baz --blah</code> are stored as values of whatever your last positional argument. This is the purpose of <code>TrailingVarArg</code> to get the same effect as <code>--</code> but without having to actually use <code>--</code>.</p>
<p>The only thing <code>--</code> does, is it says, stop parsing all remaining arguments, and store them in the next positional argument. The <code>TrailingVarArg</code> simply says, if you come to the last postional argument, keep parsing all remaining values <em>as if</em> <code>--</code> was passed.</p>
<p>If your example only works with <code>--</code>, make sure you don't have a lower index optional positional argument than the &quot;var arg&quot;. If you have the original source, I can take a look at it and see if there's anything causing that.</p>
<hr />
<p>Another option is to use subcommands and the <a href="http://kbknapp.github.io/clap-rs/clap/enum.AppSettings.html#examples-11"><code>AllowExternalSubcommands</code></a> variant if you don't know the name of the wrapped binary at compile time. This has the &quot;downside&quot; of using a subcommand instead of <code>--</code> to separate the arguments. Also, subcommand could be anything, so you could just use the wrapped binary name for simplicity. But point being, it doesn't need to be known at compile time.</p>
<pre><code>$ myprog --foo bar rm -rf baz
</code></pre>
<p>Where <code>--foo bar</code> is parsed by clap and <code>rm -rf baz</code> isn't. The upside to this, is because it's a subcommand, you still have full control of when that external binary gets called (i.e. after you do whatever you need with the arguments passed <em>before</em> the subcommand). Also, this &quot;external&quot; subcommand is hidden from the help text because it doesn't have a name.</p>
<hr />
<p>As for creating something like <code>ArgMatches::extra_args()</code> I'm not against that, but would also caveat that <code>TrailingVarArg</code> and/or <code>--</code> already have the same effect provided the positional arguments are defined.</p>
<p>I have, however, been toying with ideas on how to best do something like <code>ArgMatches::raw_args()</code> which would be the whole she-bang <code>--foo bar rm -rf baz</code> in the example above. Although it would require you manually skip all up until <code>--</code> (i.e. if <code>rm</code> were replaced by <code>--</code> in the above example), this may be an easy addition. The main reason I haven't done this yet, is it's already possible for someone to use <code>std::env::args()</code> so I'm not sure how much benefit it would actually be here.</p>
<p>Edit: Added link to <code>AllowExternalSubcommand</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> added by @kbknapp on 2016-04-17 23:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: args</span> added by @kbknapp on 2016-04-17 23:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: parsing</span> added by @kbknapp on 2016-04-17 23:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @kbknapp on 2016-04-17 23:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-08-26 15:50</div>
            <div class="timeline-body"><p>@jimmycuadra Is this still open, or are there other questions?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jimmycuadra">@jimmycuadra</a> on 2016-08-26 21:47</div>
            <div class="timeline-body"><p>We can close it. I achieved what I wanted with <code>AppSettings::TrailingVarArg</code> + an indexed argument that takes multiple values and has its docs hidden from the help output. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @jimmycuadra on 2016-08-26 21:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chrisxue815">@chrisxue815</a> on 2016-12-23 00:31</div>
            <div class="timeline-body"><p>Example:</p>
<pre><code class="language-rust">let options = App::new(&quot;Trailing args example&quot;)
    .setting(AppSettings::TrailingVarArg)
    .arg(Arg::with_name(&quot;output&quot;)
        .long(&quot;output&quot;)
        .takes_value(true)
    )
    .arg(Arg::with_name(&quot;inputs&quot;)
        .multiple(true)
    )
    .get_matches();

let filenames: Vec&lt;&amp;str&gt; = options.values_of(&quot;inputs&quot;).unwrap().collect();
println!(&quot;{}&quot;, filenames.join(&quot; &quot;));
</code></pre>
<p>Running <code>example --output output input1 input2</code> gives us <code>input1 input2</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/987.html">clap-rs/clap#987</a> on 2017-06-11 18:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tadman">@tadman</a> on 2020-08-05 00:25</div>
            <div class="timeline-body"><p>This also works with the generator: <code>#[clap(multiple=true)]</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-08-05 08:49</div>
            <div class="timeline-body"><p><code>multiple</code> will fail on <code>--help</code> or unknown options. You'd be better with <code>raw = true</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../ereborstudios/smaug/issues/14.html">ereborstudios/smaug#14</a> on 2021-01-23 15:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../tikv/tikv/pulls/10837.html">tikv/tikv#10837</a> on 2021-09-22 07:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:46:33 UTC
    </footer>
</body>
</html>
