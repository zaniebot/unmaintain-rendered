<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>optional `takes_value` - clap-rs/clap #367</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>optional <code>takes_value</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/367">#367</a>
        opened by <a href="https://github.com/lipanski">@lipanski</a>
        on 2015-12-20 20:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lipanski">@lipanski</a></div>
            <div class="timeline-body"><p>hello!</p>
<p>is there a way to make <code>takes_value</code> optional? if you think it's fairly easy and you'd like to include this as a feature, I could look into that myself.</p>
<p>in my little script I imagined the following syntax:</p>
<pre><code class="language-sh"># enforce a value for key
command --key something

# user is prompted to select a value for key (via its index) from a longer list of possible values
command --key

# assume a default value for key
command
</code></pre>
<p>I know about the <code>empty_vals</code> flag but I was just wondering if there would be a way to not pass the empty string every time.</p>
<p>thanks! :cake:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2015-12-22 18:33</div>
            <div class="timeline-body"><p>@lipanski Thanks for suggesting this! I think this isn't a bad idea with a few changes to your proposal.</p>
<ol>
<li>I'd be ok implementing allowing options to use 0 or more values (via <code>Arg::min_values</code>), although one it would have to be caveated that it could lead to poor CLI design if you're not careful. i.e. if you have an option which allows 0 values, and you have positional values the following could lead to confusing errors for the user</li>
</ol>
<pre><code>$ program --option pos
  is pos a value for --option, or a positional value?
$ program --option -- pos
  now pos is clearly a positional argument, but users may not think to use --
</code></pre>
<ol>
<li>If the user simply provides the option without a value <code>--key</code> I don't believe it should be a function of <code>clap</code> to ask for a value, that should be more on the consumer of library. Because those requirements could be incredibly different from program to program. And this should be trivial to do, i.e. check if a value was provided or not</li>
</ol>
<pre><code>if matches.value_of(&quot;key&quot;).is_none() { 
    // ask for a value or assume default
}
</code></pre>
<ol>
<li>Leaving the option off entirely and defaulting to some sane value can already be accomplished</li>
</ol>
<pre><code>let key = matches.value_of(&quot;key&quot;).unwrap_or(&quot;default_key&quot;);
</code></pre>
<p>So I'll place it on the map to add 0 or more values, because this does seem to be something people ask about from time to time. Thanks again for taking the time to file this! :+1:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by @kbknapp on 2015-12-22 18:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> added by @kbknapp on 2015-12-22 18:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: args</span> added by @kbknapp on 2015-12-22 18:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by @kbknapp on 2015-12-22 18:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: parsing</span> added by @kbknapp on 2015-12-22 18:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 1.x</span> added by @kbknapp on 2015-12-22 18:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">M: mentored</span> added by @kbknapp on 2015-12-22 18:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "1.6.0" by @kbknapp on 2015-12-22 18:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lipanski">@lipanski</a> on 2015-12-23 14:14</div>
            <div class="timeline-body"><blockquote>
<p>if you have an option which allows 0 values, and you have positional values the following could lead to confusing errors for the user</p>
</blockquote>
<p>didn't really think about that :\ would positional arguments take precedence over key arguments in that case?</p>
<blockquote>
<p>If the user simply provides the option without a value --key I don't believe it should be a function of clap to ask for a value, that should be more on the consumer of library.</p>
</blockquote>
<p>I totally agree - that was just an example / my own use case.</p>
<blockquote>
<p>Leaving the option off entirely and defaulting to some sane value can already be accomplished</p>
</blockquote>
<p>Under which conditions would this evaluate to None / the default? Given:</p>
<pre><code>Arg::with_name(&quot;hello&quot;).long(&quot;hello&quot;).takes_value(true)

# The argument '--hello &lt;hello&gt;' requires a value but none was supplied
cargo run -- command --hello

# Works, but matches.value_of(&quot;hello&quot;) produces Some(&quot;&quot;)
cargo run -- command --hello &quot;&quot;
</code></pre>
<p>And given:</p>
<pre><code>Arg::with_name(&quot;hello&quot;).long(&quot;hello&quot;).takes_value(false)

# Found argument 'something', but command wasn't expecting any
cargo run -- command --hello &quot;something&quot;
</code></pre>
<p>thanks for your quick reply and for considering this!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2015-12-24 16:35</div>
            <div class="timeline-body"><p>Ah ok, you're talking about with required arguments having default values. That in particular isn't possible yet, and I have mixed feelings on if it'd be a good idea or not.</p>
<p>I would say it'd probably be better idea to to <strong>not</strong> make the argument required if you want it to have a default value. Because if the user leaves it off, it uses the default value, but if the user uses it, it still has a value. So there's not really a circumstance where it <em>doesn't</em> have a value (making the requirement piece less needed).</p>
<blockquote>
<p>didn't really think about that :\ would positional arguments take precedence over key arguments in that case?</p>
</blockquote>
<p>The way <code>clap</code> works now, if you specify something takes a value, it looks for the next argument unless that next argument starts with a <code>-</code> character. So <code>clap</code> has no way of knowing whether the argument provided after an option is either a positional argument, or the value for an option.</p>
<p>What would happen in that case is the positional argument would end up being stored as a value to that option. This can be mitigated by designing the CLI so that there either are no positional arguments, or all options take <em>at least</em> one value (even if it's empty). This is why I'm ok with implementing this feature, because the default will still be 1 or more values, but if the consumer of the library knows that they either have no positional values, or isn't concerned about the possible confusion, they can opt out by specifying a <code>min_values</code> of <code>0</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v2.0" by @kbknapp on 2016-01-23 15:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "1.6.0" by @kbknapp on 2016-01-23 15:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-01-26 08:22</div>
            <div class="timeline-body"><p>Closed with #386</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2016-01-26 08:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lipanski">@lipanski</a> on 2016-01-26 08:56</div>
            <div class="timeline-body"><p>:dancer: thx</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/418.html">clap-rs/clap#418</a> on 2016-02-05 19:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:46:29 UTC
    </footer>
</body>
</html>
