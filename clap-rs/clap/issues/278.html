<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow final argument to be a command - clap-rs/clap #278</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow final argument to be a command</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/278">#278</a>
        opened by <a href="https://github.com/Diggsey">@Diggsey</a>
        on 2015-09-24 17:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Diggsey">@Diggsey</a> on 2015-09-24 17:26</div>
            <div class="timeline-body"><p>AFAICT, it's not possible to define a CLI such as the following:
<code>myprogram &lt;arg&gt; &lt;command&gt;</code></p>
<p>Here, <code>command</code> may include any number of arguments or flags, which clap should not attempt to interpret.</p>
<p>The first argument which does not begin with <code>-</code>, when all positional arguments have already been encountered, indicates the start of the command, and all subsequent arguments will be passed-through unchanged.</p>
<p>Alternatively, if <code>--</code> occurred previously, and all positional arguments have already been encountered, then the next argument, regardless of whether it starts with <code>-</code>, indicates the start of the command.</p>
<p>eg.
<code>myprogram a -t b</code> - Error, <code>-t</code> is not recognised
<code>myprogram -- a -t b</code> - Valid, command is <code>-t b</code>
<code>myprogram a</code> - Error: no command present (if command is a required arg)
<code>myprogram a b -t</code> - Valid, command is <code>b -t</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sru">@sru</a> on 2015-09-25 01:14</div>
            <div class="timeline-body"><p>@Diggsey is it possible to pass the command as one argument? i.e. using double quotes</p>
<p>Currently, Clap cannot allow the final argument to have the rest of argument to pass off as one argument.</p>
<p>We could also expose the arguments the are left over as extra.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Diggsey">@Diggsey</a> on 2015-09-25 01:20</div>
            <div class="timeline-body"><blockquote>
<p>Is it possible to pass the command as one argument? i.e. using double quotes</p>
</blockquote>
<p>No, that would make escaping too painful, and I'm trying to mirror an existing CLI.</p>
<blockquote>
<p>Currently, Clap cannot allow the final argument to have the rest of argument to pass off as one argument.</p>
</blockquote>
<p>That's why I opened the issue... Or do you mean it can't add support for that for some reason? I had a brief look at the parsing code and it didn't seem particularly problematic to add support for this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sru">@sru</a> on 2015-09-25 01:39</div>
            <div class="timeline-body"><p>I see. No, I think it should be easy to add support for this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2015-09-25 23:32</div>
            <div class="timeline-body"><p>This is already somewhat possible with <code>--</code>.</p>
<p>Example:</p>
<pre><code class="language-rust">let m = App::new(&quot;test&quot;).arg_from_usage(&quot;&lt;cmd&gt;... 'some cmd'&quot;).get_matches();
if let Some(v) = m.values_of(&quot;cmd&quot;) {
    for cmd in v {
        println!(&quot;{}&quot;, cmd);
    }
}
</code></pre>
<p>Then running</p>
<pre><code>$ test -- some -a -t cmd this that --long=this --testing
some
-a
-t
cmd
this
that
--long=this
--testing
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2015-09-29 00:47</div>
            <div class="timeline-body"><p>@Diggsey is the current <code>--</code> enough for your usage? If so, we can close this issue.</p>
<p>I am hesitant to add special case rules for this problem set which I would imagine is a rare case. Reason being, there may be cases when a user typos more positional than expected, and to have it automatically start parsing as a command could have very undesirable results.</p>
<p>I'm not saying we wouldn't add it, but that we'd need to discuss the implementation before-hand.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> added by @kbknapp on 2015-09-29 00:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: maybe</span> added by @kbknapp on 2015-09-29 00:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by @kbknapp on 2015-09-29 00:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: parsing</span> added by @kbknapp on 2015-09-29 00:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 1.x</span> added by @kbknapp on 2015-09-29 00:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Diggsey">@Diggsey</a> on 2015-09-29 01:00</div>
            <div class="timeline-body"><blockquote>
<p>is the current -- enough for your usage? If so, we can close this issue.</p>
</blockquote>
<p>Not really - for the moment I've worked around it by detecting that case and intercepting it before I invoke clap.</p>
<blockquote>
<p>there may be cases when a user typos more positional than expected, and to have it automatically start parsing as a command could have very undesirable results.</p>
</blockquote>
<p>Presumably it would be opt-in: it would only start parsing as a command if the current subcommand expected to take a command as input.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2015-09-29 01:27</div>
            <div class="timeline-body"><blockquote>
<p>Presumably it would be opt-in: it would only start parsing as a command if the current subcommand expected to take a command as input.</p>
</blockquote>
<p>I'm OK with it being an opt-in setting. I'll set this for the 1.4.4 release, since it may take a little more time to implement.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by @kbknapp on 2015-09-29 01:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> added by @kbknapp on 2015-09-29 01:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> removed by @kbknapp on 2015-09-29 01:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: maybe</span> removed by @kbknapp on 2015-09-29 01:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "1.4.4" by @kbknapp on 2015-09-29 01:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/298.html">clap-rs/clap#298</a> on 2015-10-01 16:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2015-10-01 18:26</div>
            <div class="timeline-body"><p>Here's the implementation that #301 contains:</p>
<p>Using the <code>AppSettings::TrailingVarArg</code> setting enables:</p>
<ul>
<li>Final positional argument &quot;eats&quot; all other arguments without the need for <code>--</code></li>
</ul>
<pre><code class="language-rust">extern crate clap;

use clap::{App, AppSettings};

fn main() {
    let m = App::new(&quot;test&quot;)
        .setting(AppSettings::TrailingVarArg)
        .args_from_usage(
         &quot;[arg1]         'some arg'
          [CMD]...       'arguments to pass to the CMD'&quot;)
        .get_matches();
    for a in m.values_of(&quot;CMD&quot;).unwrap() {
        println!(&quot;{}&quot;, a);
    }
}
</code></pre>
<p>Running with:</p>
<pre><code>$ test some_arg cmd -H 20 --long value
cmd
-H
20
--long
value
</code></pre>
<p>The initial <code>arg1</code> is just to show that it works even with other positional args defined.</p>
<p>@Diggsey @matklad</p>
<p><strong>IF THIS DOES NOT SOLVE THIS ISSUE</strong>: let me know so that we can fix before the merge. One caveat, is I don't want to special case too heavily if there are things that can be done in downstream code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/301.html">clap-rs/clap#301</a> on 2015-10-01 18:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Diggsey">@Diggsey</a> on 2015-10-01 18:35</div>
            <div class="timeline-body"><p>@kbknapp Wow that looks perfect, thanks. Feel free to close this when those changes get merged in.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2015-10-01 18:36</div>
            <div class="timeline-body"><p>@Diggsey will do, let us know if you have any issues :wink:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2015-10-01 18:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/558.html">clap-rs/clap#558</a> on 2016-07-01 16:15</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:06 UTC
    </footer>
</body>
</html>
