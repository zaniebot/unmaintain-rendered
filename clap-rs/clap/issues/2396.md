```yaml
number: 2396
title: Custom value hint
type: issue
state: closed
author: tailhook
labels: []
assignees: []
created_at: 2021-03-09T15:10:02Z
updated_at: 2021-09-06T23:25:38Z
url: https://github.com/clap-rs/clap/issues/2396
synced_at: 2026-01-10T01:57:44Z
```

# Custom value hint

---

_Issue opened by @tailhook on 2021-03-09 15:10_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the existing issues

### Describe your use case

Let's imagine I have a `make`-like utility. And I want:
```
make <tab>
```
To complete to commands listed in the `Makefile` in the current directory. Most current shells can handle this, but I don't think there is a way to generate completions for that by clap.

### Describe the solution you'd like

I propose something like this:
```
    Arg::new("target")
        .about("target to execute")
        .takes_value(true)
        .value_hint(ValueHint::RunCommand(["--list-targets"]))
```
This means that shell runs `$binname --list-targets` to fetch the names of the targets for completion.

The complication is that some shells (namely zsh) may use a description in completion data but others can't so there are two options:
1. Add `--shell=zsh` for command (this is nice if command has subcommands: `mymake list-targets --shell=zsh` but is weird if `mymake --list-targets --shell=zsh`, because basically `--shell=` will be accepted but not used in any invocation)
2. Standardize the output format and adapt it to specific shell by our shell function (i.e. stripping descriptions in bash)

### Alternatives, if applicable

Alternative solution is to have `ValueHint::ShellFunction("_my_make_targets")` and manually append function `_my_make_targets` to the generated file. This is more flexible, but is harder to use since the shell function will have to be implemented for every shell manually.

----

What do you think?

---

_Label `T: new feature` added by @tailhook on 2021-03-09 15:10_

---

_Comment by @pksunkara on 2021-03-09 16:56_

Duplicate of #1232 

I assume you saw that issue when searching? Why did you decide to create a new one?

---

_Closed by @pksunkara on 2021-03-09 16:56_

---

_Label `T: new feature` removed by @pksunkara on 2021-03-09 16:57_

---

_Label `R: duplicate` added by @pksunkara on 2021-03-09 16:57_

---

_Comment by @tailhook on 2021-03-10 15:07_

> Duplicate of #1232
> 
> I assume you saw that issue when searching? Why did you decide to create a new one?

No I didn't see that. Sorry.

---

_Comment by @chisui on 2021-09-06 22:04_

#1232 seems to be about delegating completion to clap itself. By extending `ValueHint` you would enable the completion script to call any other program. It also doesn't have to handle the completion itself but simply enumerate possible values. Would it be possible to reopen this issue @pksunkara?

---

_Comment by @pksunkara on 2021-09-06 23:25_

Since the design for #1232 is not yet done and the thing being requested here is so close what's being discussed in that issue, they might actually end up being the same.

---

_Referenced in [clap-rs/clap#5449](../../clap-rs/clap/issues/5449.md) on 2024-04-09 03:39_

---
