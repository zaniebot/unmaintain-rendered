<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Should `derive` be in the default feature list? - clap-rs/clap #2443</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Should <code>derive</code> be in the default feature list?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/2443">#2443</a>
        opened by <a href="https://github.com/pksunkara">@pksunkara</a>
        on 2021-04-17 09:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/pksunkara">@pksunkara</a></div>
            <div class="timeline-body"><p>It&#x27;s currently in it. But I am thinking of changing it to not be in it.</p>
<p>@BurntSushi I would like your opinion on this. What do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;3.0&quot; by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-04-17 09:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-04-17 10:39</div>
            <div class="timeline-body"><p>Depending on how it impacts compile times, I would probably disable it every time. With that said, I kind of already expect to disable clap features when I use it, so I don&#x27;t really see this as that big of a deal personally. The other mitigating factor is that clap tends to show up a direct dependency of a CLI tool and nowhere else, so if you disable default features, it&#x27;s highly likely that they&#x27;ll actually be disabled. (Unlike other dependencies that might appear in multiple places. If a feature gets enabled anywhere, it&#x27;s enabled everywhere.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-04-17 10:47</div>
            <div class="timeline-body"><p>Yeah, I completely agree. I am just trying to decide which default is better and how many users (cli developers) want that default.</p>
<ol>
<li><p>Keep the <code>derive</code> in default features list:</p>
<ol>
<li><p>Users want to use it:</p>
<pre><code>clap = &quot;3.0.0&quot;
</code></pre>
</li>
<li><p>Users want to disable it:</p>
<pre><code>clap = { version = &quot;3.0.0&quot;, features = [&quot;std&quot;, &quot;cargo&quot;], default-features = false }
</code></pre>
</li>
</ol>
</li>
<li><p>Don&#x27;t use <code>derive</code> in default features list:</p>
<ol>
<li><p>Users want to use it:</p>
<pre><code>clap = { version = &quot;3.0.0&quot;, features = [&quot;derive&quot;] }
</code></pre>
</li>
<li><p>Users want to disable it:</p>
<pre><code>clap = &quot;3.0.0&quot;
</code></pre>
</li>
</ol>
</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-04-17 11:11</div>
            <div class="timeline-body"><p>My sense is that a lot of people like the derive functionality, so it might make sense to use it by default. But... If that&#x27;s wrong and most folks aren&#x27;t using it, then I think that&#x27;s going to add a pretty big compilation hit for no reason. So I don&#x27;t really know what the right answer is unfortunately.</p>
<p>You could follow serde&#x27;s lead here, which requires opting into the derive functionality.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: derive macros</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-04-25 15:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2021-04-26 23:51</div>
            <div class="timeline-body"><p>Yeah I don&#x27;t have a good answer for this one either. I can see it both ways. I hear a lot of people that love the derive functionality, but I also hear a lot of people that are very sensitive to compile times and code bloat. I think the longer I use Rust I personally fall in the camp of preferring opt-in vs opt-out, however those feelings aren&#x27;t super strong.</p>
<p>I think if we make it the default, there should be some prominent verbiage that it can be disabled for faster compile times at the expense more verbose code. Likewise, if we go the other way making it opt-in there should be some prominent verbiage showing that it can be enabled for less verbose code at the expense of compile times.</p>
<p>Perhaps a good case study would be to look at other prominent crates with derive functionality and see what their defaults are. I believe most of them are <em>off</em> by default (i.e. opt-in) which fits with Rust&#x27;s ideals. Some that come to mind are <code>serde</code>, and <code>tokio</code> (not for <code>derive</code> specifically, but the aggressive cargo features that are all pretty much opt-in).</p>
<p>Another angle that might give insight is to look at the dependency or download statistics of <code>clap</code> 2.x and <code>structopt</code> (or other <code>derive</code> based arg parsers). I would not be surprised to find that those using <code>derive</code> based parsers are in the minority, but also more vocal about their support as it&#x27;s a decently novel paradigm in strong and statically typed languages.</p>
<p>Having said all that, I think it would make most sense to me to make it opt-in for 3.x, as we gather more data and use cases/work out any issues. Then re-address should we get to a future breaking change, or obtain enough data that heavily swings it the other direction.</p>
<p>Just my 2 cents, I&#x27;d welcome other arguments for or against.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-05-20 22:30</div>
            <div class="timeline-body"><p>Thanks to both of you for your opinions. I am more of a purist which is why I was leaning towards making <code>derive</code> opt-in.</p>
<p>But one thing I observed is that an example program is easier to understand with <code>derive</code> compared to the traditional API based example. Therefore, I have decided to leave the <code>derive</code> in default features list.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-05-20 22:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:58:04 UTC
    </footer>
</body>
</html>
