<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature request: YAML as compile-time only dependency - clap-rs/clap #1416</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Feature request: YAML as compile-time only dependency</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1416">#1416</a>
        opened by <a href="https://github.com/devinrsmith">@devinrsmith</a>
        on 2019-02-17 14:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/devinrsmith">@devinrsmith</a></div>
            <div class="timeline-body"><p>I think that the YAML dependency could be a compile-time only dependency. That would be the best of both world IMO - keep the source neat and tidy, no need for runtime parsing of the parser, and no runtime YAML dependency!</p>
<p><a href="https://doc.rust-lang.org/cargo/reference/build-scripts.html">build-scripts</a>
<a href="https://rust-lang-nursery.github.io/rust-cookbook/development_tools/build_tools.html">code generation / build-dependencies</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Kage-Yami">@Kage-Yami</a> on 2020-01-04 12:48</div>
            <div class="timeline-body"><p>I was also thinking along these lines, but after reading <a href="https://doc.rust-lang.org/cargo/reference/specifying-dependencies.html#build-dependencies">Specifying Dependencies -&gt; Build dependencies</a>, don&#x27;t they only apply to <code>build.rs</code> (and in fact specifically <em>don&#x27;t</em> apply to the app itself)? If so, then I don&#x27;t see how this would work, as I would think the CLI definition needs to happen <em>in the app</em>, rather than a build script...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-01-05 05:10</div>
            <div class="timeline-body"><p>@Kage-Yami is right here, <code>dev-depandencies</code> are exposed only to the build script, the app has no access to them. This is not doable, at least not with current API.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">not-sure</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-01 15:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-06 09:17</div>
            <div class="timeline-body"><p>We can actually make a proc-macro that parses <code>.yaml</code> and expands to resulting <code>clap::App</code>, no runtime cost involved!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cc: CreepySkeleton</span> removed by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-06 09:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: macros</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-06 09:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: yaml parser</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-06 09:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: hard</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-06 09:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-06 09:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-06 09:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-06 09:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;3.1&quot; by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-02-06 09:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-02-13 07:40</div>
            <div class="timeline-body"><p>The main concern with a proc-macro that parser <code>.yaml</code> is custom spans. For example, let&#x27;s assume we have a proc-macro <code>load_yaml</code> that builds an App out of yml file. And if the yml file has an error, we should emit a <code>proc-macro-error</code> pointing to the issue which is difficult without us being able to build custom spans (since we won&#x27;t be tokenizing yml file directly but instead reading the file from fs).</p>
<p>Can we use serde to change something about how we can load the yml during compile time?</p>
<p><strong>NOTE</strong>: I looked at the related code, and it looks like current yaml <strong>is</strong> a run time dependency because it&#x27;s loading yaml from the <code>yml</code> static string (expanded by <code>include_str!</code>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-13 08:39</div>
            <div class="timeline-body"><p>We can&#x27;t exactly <em>point</em> there indeed, just because files included via <code>include*!</code> or non-rs files don&#x27;t really have span info attached to them. What we can do is to print line/column the error was encountered at, and I think it should be &quot;good enough&quot;. <code>serde</code> would grant us this info out of box.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-02-13 09:04</div>
            <div class="timeline-body"><p>Yeah, but can we create a span with the line, column info? That would make the error reporting easy</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-13 09:20</div>
            <div class="timeline-body"><p>We can&#x27;t <em>create</em> a span with a custom line/column info since the only ways are <code>call_site</code>, <code>def_site</code>, <code>mixed_site</code>. We can&#x27;t <em>set</em> this info on already existing span because there&#x27;s no such API, even unstable.</p>
<p>Could you explain what you expect from such API? The error cannot be rendered for files that are not part of a crate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-02-13 20:52</div>
            <div class="timeline-body"><blockquote>
<p>We can&#x27;t set this info on already existing span because there&#x27;s no such API, even unstable.</p>
</blockquote>
<p>I wanted to make up Span. For files that can not be token streams, but we still want to parse, I wanted to make up Span when I get error and let <code>compile_error!</code> or <code>Diagnostic</code> API take care of printing it for me.</p>
<p>So, I looked into it and proc_macro2 stores the source map locally and thus we can&#x27;t fool it by making up <code>Span</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-02-29 01:13</div>
            <div class="timeline-body"><p>Is <code>const</code> able to help to compile this during compile time? https://github.com/rust-lang/rfcs/blob/master/text/0246-const-vs-static.md</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-29 04:40</div>
            <div class="timeline-body"><p>@pickfire Nope, since yaml loader is not <code>const</code> at all. We need a proper procedural macro for that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> removed by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-08-13 10:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>epage/clapng#113</a> on 2021-12-06 18:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-08 20:00</div>
            <div class="timeline-body"><p>See <a href="https://github.com/clap-rs/clap/issues/3087">clap-rs/clap#3087</a>.  I expect any effort in this direction would be in an independent crate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/epage">@epage</a> on 2021-12-08 20:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:57:20 UTC
    </footer>
</body>
</html>
