<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Usage line is wrong in case of errors when using default values - clap-rs/clap #774</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Usage line is wrong in case of errors when using default values</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/774">#774</a>
        opened by <a href="https://github.com/dotdash">@dotdash</a>
        on 2016-12-12 16:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dotdash">@dotdash</a> on 2016-12-12 16:53</div>
            <div class="timeline-body"><h3>Affected Version of clap</h3>
<p>2.19.2</p>
<h3>Expected Behavior Summary</h3>
<p>The <code>USAGE</code> output is always the same, regardless of whether the user supplies <code>--help</code> or makes a usage error.</p>
<h3>Actual Behavior Summary</h3>
<p>Usage with <code>--help</code>:</p>
<pre><code>USAGE:
    render &lt;CONFIG&gt; [ARGS]

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

ARGS:
    &lt;CONFIG&gt;    the configuration file
    &lt;WIDTH&gt;     texture width [default: 512]
    &lt;HEIGHT&gt;    texture height [default: 512]
</code></pre>
<p>Usage with a bad input:</p>
<pre><code>error: The following required arguments were not provided:
    &lt;CONFIG&gt;

USAGE:
    render &lt;CONFIG&gt; &lt;WIDTH&gt; &lt;HEIGHT&gt;

For more information try --help
</code></pre>
<p>Note how <code>&lt;WIDTH&gt;</code> and <code>&lt;HEIGHT&gt;</code> are shown as required arguments.</p>
<h3>Steps to Reproduce the issue</h3>
<p>Call the executable created from the code below once with <code>--help</code> and once without any arguments.</p>
<h3>Sample Code or Link to Sample Code</h3>
<pre><code class="language-rust">extern crate clap;
use clap::{Arg, App};

fn main() {
    let matches = App::new(&quot;My  app&quot;)
        .version(&quot;0.1&quot;)
        .author(&quot;Me &lt;me@ma.il&gt;&quot;)
        .about(&quot;Does stuff&quot;)
        .arg(Arg::with_name(&quot;config&quot;)
             .value_name(&quot;CONFIG&quot;)
             .help(&quot;the configuration file&quot;)
             .required(true)
             .takes_value(true)
             .index(1))
        .arg(Arg::with_name(&quot;width&quot;)
             .value_name(&quot;WIDTH&quot;)
             .help(&quot;texture width&quot;)
             .takes_value(true)
             .default_value(&quot;512&quot;)
             .index(2))
        .arg(Arg::with_name(&quot;height&quot;)
             .value_name(&quot;HEIGHT&quot;)
             .help(&quot;texture height&quot;)
             .takes_value(true)
             .default_value(&quot;512&quot;)
             .index(3))
        .get_matches();
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-12-18 20:19</div>
            <div class="timeline-body"><p>@dotdash apologies for the long time in answering this, I've been out of town for work.</p>
<p>In that usage line <code>&lt;width&gt;</code> and <code>&lt;height&gt;</code> are not shown as required arguments, they're shown as <em>used</em> arguments (a default is considered used). When <code>clap</code> detects an argument was used (required or not) it will inject those arguments into the usage string of errors. It's a manner of saying, &quot;It seems like you were trying to do this... X ... but here's how you can correct it.&quot;</p>
<p>I agree this could be improved by not displaying arguments which only contain the default value. I can keep this on the issue tracker, but there are a few more pressing issues to fix first ;)</p>
<p>There's also the case of it'd be nice to inject the actual value the users used for those args (non-defaults only). I should be able to start knocking this out after the new year.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: errors</span> added by @kbknapp on 2016-12-18 20:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: intermediate</span> added by @kbknapp on 2016-12-18 20:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> added by @kbknapp on 2016-12-18 20:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: enhancement</span> added by @kbknapp on 2016-12-18 20:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @kbknapp on 2016-12-18 20:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "2.20.0" by @kbknapp on 2016-12-27 04:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @homu on 2017-01-03 01:19</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:31 UTC
    </footer>
</body>
</html>
