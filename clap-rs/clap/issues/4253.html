<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>range method not found in `_AnonymousValueParser(usize)` - clap-rs/clap #4253</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>range method not found in `_AnonymousValueParser(usize)`</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/clap-rs/clap/issues/4253">#4253</a>
        opened by <a href="https://github.com/pkolaczk">@pkolaczk</a>
        on 2022-09-24 08:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/pkolaczk">@pkolaczk</a> on 2022-09-24 08:40</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.64.0 (a55dd71d5 2022-09-19)</p>
<h3>Clap Version</h3>
<p>4.0.0-rc2</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">#[derive(clap::Parser, Debug, Default)]
#[command(disable_version_flag = true)]
struct MyApp {
    #[arg(value_parser = clap::value_parser!(usize).range(1..))]
    pub foo: Option&lt;usize&gt;
}

fn main() {
}
</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<p>cargo check</p>
<h3>Actual Behaviour</h3>
<pre><code>error[E0599]: no method named `range` found for struct `_AnonymousValueParser` in the current scope
 --&gt; src/test.rs:4:53
  |
4 |     #[arg(value_parser = clap::value_parser!(usize).range(1..))]
  |                                                     ^^^^^ method not found in `_AnonymousValueParser`

</code></pre>
<h3>Expected Behaviour</h3>
<p>Should compile fine</p>
<h3>Additional Context</h3>
<p>If I replace the <code>usize</code> type in value_parser! with <code>u64</code>, then it compiles fine, however I'm not sure if this is correct, because that's a different type than the type used in the field.</p>
<h3>Debug Output</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @pkolaczk on 2022-09-24 08:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/anshulrgoyal">@anshulrgoyal</a> on 2022-09-24 21:37</div>
            <div class="timeline-body"><p>@pkolaczk <code>clap::value_parser!</code> returns <code>RangedU64ValueParser</code> for <code>u64</code> therefore range function is available, but usize returns <code>_AnonymousValueParser</code> hence the compilation error.</p>
<p>If there is an implementation for <code>usize</code> then it will work.</p>
<pre><code class="language-rust">impl ValueParserFactory for usize {
    type Parser = RangedU64ValueParser&lt;usize&gt;;
    fn value_parser() -&gt; Self::Parser {
        RangedU64ValueParser::&lt;usize&gt;::new()
    }
}


</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pkolaczk">@pkolaczk</a> on 2022-09-25 10:35</div>
            <div class="timeline-body"><p>Such implementation can be added only by <code>clap</code>. I cannot add it by myself, because of foreign-crate restriction.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/anshulrgoyal">@anshulrgoyal</a> on 2022-09-25 13:49</div>
            <div class="timeline-body"><p>@pkolaczk I was suggesting adding the implementation in clap only. I don't know the reason it is not already present.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-09-26 15:49</div>
            <div class="timeline-body"><p>I wish I could more generically implement this...</p>
<p>clap does use <code>try_into</code> to go from <code>u64</code> to <code>T</code> (<code>usize</code> in this case).  My main question is if converting from u64 to usize is &quot;good enough&quot; or if we should have usize-native value parser.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> added by @epage on 2022-09-26 15:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-builder</span> added by @epage on 2022-09-26 15:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-09-28 16:22</div>
            <div class="timeline-body"><p>btw #3895 and #4034 are related PRs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "range method not found in _AnonymousValueParser" to "range method not found in `_AnonymousValueParser(usize)`" by @epage on 2022-09-28 16:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../paritytech/polkadot/pulls/6100.html">paritytech/polkadot#6100</a> on 2022-10-06 15:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:08 UTC
    </footer>
</body>
</html>
