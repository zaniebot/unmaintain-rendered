<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`help help` is colorized with DisableColoredHelp - clap-rs/clap #3298</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>help help</code> is colorized with DisableColoredHelp</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/3298">#3298</a>
        opened by <a href="https://github.com/ehuss">@ehuss</a>
        on 2022-01-16 19:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ehuss">@ehuss</a></div>
            <div class="timeline-body">Please complete the following tasks
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
Rust Version
<p>rustc 1.60.0-nightly (ec4bcaac4 2022-01-15)</p>
Clap Version
<p>3.0.7</p>
Minimal reproducible code
<pre><code>use clap::{App, AppSettings};

fn main() {
    let _matches = App::new(&quot;myapp&quot;)
        .global_setting(AppSettings::DisableColoredHelp)
        .subcommand(App::new(&quot;foo&quot;))
        .get_matches();
}
</code></pre>
Steps to reproduce the bug with the above code
<p><code>cargo run -- help help</code></p>
Actual Behaviour
<p>The help output is colored.</p>
<img alt="image" src="https://user-images.githubusercontent.com/43198/149674792-4f7fcb74-fe34-4aa5-906a-c51a690b6fe0.png">

<p>versus other help output:</p>
<img alt="image" src="https://user-images.githubusercontent.com/43198/149674811-6bc3b86b-0f58-4dce-b47f-4ae30b16777f.png">

Expected Behaviour
<p>The help output should not be colored due to <code>DisableColoredHelp</code>.</p>
Additional Context
<p>The priority of this is the lowest of the low.  Just noticed it and thought I&#x27;d report it.</p>
Debug Output
<pre><code>[            clap::build::app] 	App::_do_parse
[            clap::build::app] 	App::_build
[            clap::build::app] 	App::_propagate:myapp
[            clap::build::app] 	App::_check_help_and_version
[            clap::build::app] 	App::_check_help_and_version: Removing generated version
[            clap::build::app] 	App::_check_help_and_version: Building help subcommand
[            clap::build::app] 	App::_propagate_global_args:myapp
[            clap::build::app] 	App::_derive_display_order:myapp
[            clap::build::app] 	App::_derive_display_order:foo
[            clap::build::app] 	App::_derive_display_order:help
[clap::build::app::debug_asserts] 	App::_debug_asserts
[clap::build::arg::debug_asserts] 	Arg::_debug_asserts:help
[clap::build::app::debug_asserts] 	App::_verify_positionals
[         clap::parse::parser] 	Parser::get_matches_with
[         clap::parse::parser] 	Parser::_build
[         clap::parse::parser] 	Parser::get_matches_with: Begin parsing &#x27;RawOsStr(&quot;help&quot;)&#x27; ([104, 101, 108, 112])
[         clap::parse::parser] 	Parser::get_matches_with: Positional counter...1
[         clap::parse::parser] 	Parser::get_matches_with: Low index multiples...false
[         clap::parse::parser] 	Parser::possible_subcommand: arg=RawOsStr(&quot;help&quot;)
[         clap::parse::parser] 	Parser::get_matches_with: sc=Some(&quot;help&quot;)
[         clap::parse::parser] 	Parser::parse_help_subcommand
[            clap::build::app] 	App::_build
[            clap::build::app] 	App::_propagate:help
[            clap::build::app] 	App::_check_help_and_version
[            clap::build::app] 	App::_check_help_and_version: Removing generated help
[            clap::build::app] 	App::_check_help_and_version: Removing generated version
[            clap::build::app] 	App::_propagate_global_args:help
[            clap::build::app] 	App::_derive_display_order:help
[clap::build::app::debug_asserts] 	App::_debug_asserts
[clap::build::arg::debug_asserts] 	Arg::_debug_asserts:subcommand
[clap::build::app::debug_asserts] 	App::_verify_positionals
[         clap::parse::parser] 	Parser::help_err: use_long=false
[            clap::build::app] 	App::color: Color setting...
[            clap::build::app] 	Auto
[          clap::output::help] 	Help::new
[          clap::output::help] 	Help::write_help
[          clap::output::help] 	should_show_arg: use_long=false, arg=subcommand
[          clap::output::help] 	Help::write_templated_help
[          clap::output::help] 	Help::write_before_help
[          clap::output::help] 	Help::write_bin_name
[         clap::output::usage] 	Usage::create_usage_no_title
[         clap::output::usage] 	Usage::create_help_usage; incl_reqs=true
[         clap::output::usage] 	Usage::get_required_usage_from: incls=[], matcher=false, incl_last=false
[         clap::output::usage] 	Usage::get_required_usage_from: unrolled_reqs={}
[         clap::output::usage] 	Usage::get_required_usage_from: ret_val=[]
[         clap::output::usage] 	Usage::needs_options_tag
[         clap::output::usage] 	Usage::needs_options_tag: [OPTIONS] not required
[         clap::output::usage] 	Usage::get_args_tag; incl_reqs = true
[         clap::output::usage] 	Usage::get_args_tag:iter:subcommand
[            clap::build::app] 	App::groups_for_arg: id=subcommand
[         clap::output::usage] 	Usage::get_args_tag:iter: 1 Args not required or hidden
[            clap::build::app] 	App::groups_for_arg: id=subcommand
[         clap::output::usage] 	Usage::get_args_tag:iter: Exactly one, returning &#x27;subcommand&#x27;
[            clap::build::arg] 	Arg::name_no_brackets:subcommand
[            clap::build::arg] 	Arg::name_no_brackets: val_names=[
    &quot;SUBCOMMAND&quot;,
]
[         clap::output::usage] 	Usage::create_help_usage: usage=foo help [SUBCOMMAND]...
[          clap::output::help] 	Help::write_all_args
[          clap::output::help] 	should_show_arg: use_long=false, arg=subcommand
[          clap::output::help] 	Help::write_args_unsorted
[          clap::output::help] 	should_show_arg: use_long=false, arg=subcommand
[          clap::output::help] 	should_show_arg: use_long=false, arg=subcommand
[          clap::output::help] 	Help::spec_vals: a=&lt;SUBCOMMAND&gt;...
[          clap::output::help] 	Help::spec_vals: a=&lt;SUBCOMMAND&gt;...
[          clap::output::help] 	Help::short
[          clap::output::help] 	Help::long
[          clap::output::help] 	Help::val: arg=subcommand
[          clap::output::help] 	Help::val: Has switch...
[          clap::output::help] 	No, and not next_line
[          clap::output::help] 	Help::help
[          clap::output::help] 	Help::help: Next Line...false
[          clap::output::help] 	Help::help: Too long...
[          clap::output::help] 	No
[          clap::output::help] 	Help::write_after_help
foo-help
Print this message or the help of the given subcommand(s)

USAGE:
    foo help [SUBCOMMAND]...

ARGS:
    &lt;SUBCOMMAND&gt;...    The subcommand whose help message to display
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by <a href="https://github.com/ehuss">@ehuss</a> on 2022-01-16 19:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-01-17 14:22</div>
            <div class="timeline-body"><p>Looks like we propagate the global settings before creating the <code>help</code> subcommand`.  The main question I have is whether its safe to swap the order (if the help and version logic needs some of the work being done in the previous step).  I&#x27;ll probably make a more immediate change of propagating settings just for the help subcommand.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#3305</a> on 2022-01-17 15:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/epage">@epage</a> on 2022-01-17 15:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-01-17 15:38</div>
            <div class="timeline-body"><p>v3.0.8 is now released with the fix for this</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:58:44 UTC
    </footer>
</body>
</html>
