<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Provide subcommand for completions - clap-rs/clap #5947</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Provide subcommand for completions</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/5947">#5947</a>
        opened by <a href="https://github.com/titaniumtraveler">@titaniumtraveler</a>
        on 2025-03-12 21:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/titaniumtraveler">@titaniumtraveler</a> on 2025-03-12 21:44</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[x] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[x] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>master</p>
<h3>Describe your use case</h3>
<p>There is currently no standard for how the user can generate completions and how they are to be installed.</p>
<h3>Describe the solution you'd like</h3>
<p>I propose for <code>clap_complete</code> to provide a subcommand that can be easily integrated into existing CLIs that generates the completions either to <code>stdout</code>, or, if enabled, to the shell and OS/environment appropriate file:</p>
<pre><code class="language-rust">#[derive(Args)]
pub struct Completions {
    /// The shell to generate the completions for
    shell: Shell,
    
    /// Location to write the completions to
    #[arg(long)]
    save: Option&lt;Option&lt;SaveLocation&gt;&gt;,

   // ... maybe some additional field to set for which command to generate the
   // completions for like it is being done for `
}

impl Completions {
    pub fn run(...) {
       // ... Generate the completions
    }
}
</code></pre>
<p>The save location is an enum and defaults to writing to the users completions directory.
i.e. when calling <code>&lt;cli&gt; completions bash --save</code> on linux that should write to <code>~/.local/share/bash-completion/completions/&lt;cli&gt;</code>. (Creating directories as needed)</p>
<p>When setting it <code>--save root</code> that should be something <code>/usr/local/share/bash-completion/completions/&lt;cli&gt;</code>.</p>
<hr />
<p>One <em>big</em> part of this whole thing is of cause actually researching for all supported shells from which paths they load completions from, but in my opinion collecting that knowledge in <code>clap_complete</code> instead of people having to figure that out themselves would be immensely beneficial.</p>
<h3>Alternatives, if applicable</h3>
<p><em>No response</em></p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @titaniumtraveler on 2025-03-12 21:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-completion</span> added by @epage on 2025-03-13 14:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-03-13 14:18</div>
            <div class="timeline-body"><p>We had #810.  We originally resolved that for the new, native completion system but then pivoted to controlling it through environment variables.  See #5671 for the context on that switch.  It would still be good to allow applications with an existing subcommand to continue to do so and we should explore that but that is a little different than this issue.</p>
<p>With the solution provided in #5671, I'm not seeing a reason to keep this open.  If there is a reason that doesn't work, let us know and we can re-evaluate!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2025-03-13 14:18</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:35:44 UTC
    </footer>
</body>
</html>
