<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom sorting of arguments in help message - clap-rs/clap #6140</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Custom sorting of arguments in help message</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/clap-rs/clap/issues/6140">#6140</a>
        opened by <a href="https://github.com/thomas-zahner">@thomas-zahner</a>
        on 2025-09-25 13:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/thomas-zahner">@thomas-zahner</a> on 2025-09-25 13:04</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[x] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[x] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>master</p>
<h3>Describe your use case</h3>
<p>By using <a href="https://docs.rs/clap/latest/clap/struct.Command.html#method.next_display_order"><code>next_display_order</code></a> I've managed to get clap sort arguments alphabetically in the <code>--help</code> message. However, I don't like the sorting behaviour of clap. I would like to sort my arguments by the long argument names first.</p>
<p>Currently my help message looks like:</p>
<pre><code>  -V, --version
          Print version

  -X, --method &lt;METHOD&gt;
          Request method

          [default: get]
</code></pre>
<p>But I want <code>--method</code> to be before <code>--version</code>. This aligns with the other programs such as cURL. (see <code>curl --help</code> or <code>man curl</code>)</p>
<p>Sorting is done by the following code in help_template.rs:</p>
<pre><code class="language-rust">fn option_sort_key(arg: &amp;Arg) -&gt; (usize, String) {
    // Formatting key like this to ensure that:
    // 1. Argument has long flags are printed just after short flags.
    // 2. For two args both have short flags like `-c` and `-C`, the
    //    `-C` arg is printed just after the `-c` arg
    // 3. For args without short or long flag, print them at last(sorted
    //    by arg name).
    // Example order: -a, -b, -B, -s, --select-file, --select-folder, -x

    let key = if let Some(x) = arg.get_short() {
        let mut s = x.to_ascii_lowercase().to_string();
        s.push(if x.is_ascii_lowercase() { '0' } else { '1' });
        s
    } else if let Some(x) = arg.get_long() {
        x.to_string()
    } else {
        let mut s = '{'.to_string();
        s.push_str(arg.get_id().as_str());
        s
    };
    (arg.get_display_order(), key)
}
</code></pre>
<p>I would like to swap the first <code>if let</code> with the second one for my use case.</p>
<h3>Describe the solution you'd like</h3>
<p>If possible I would like to simply swap the two <code>if let</code> statements as mentioned above. Would you accept this change? Or do you think this is an unnecessary opinionated breaking change?</p>
<h3>Alternatives, if applicable</h3>
<p>If you think this would be too opinionated and break the behaviour of too many users, can we make the sorting behaviour configurable, by somehow providing a sorting function to clap? This way <code>option_sort_key</code> would only be used if the user provided none.</p>
<h3>Additional Context</h3>
<p>This if for <a href="https://github.com/lycheeverse/lychee/">lychee-bin</a> where I want to sort the help message for better usability and align the output more closely to cURL's help message. See: https://github.com/lycheeverse/lychee/pull/1858</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @thomas-zahner on 2025-09-25 13:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-triage</span> added by @thomas-zahner on 2025-09-25 13:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-09-25 16:15</div>
            <div class="timeline-body"><p>The paths forward for this are either</p>
<ul>
<li>Change our sort order</li>
<li>Workaround it with <code>display_order</code></li>
<li>Wait for help generation to be broken out to allow easier customization without costs (#2913, #2914, see also #3476)</li>
</ul>
<p>With clap, we try to balance</p>
<ul>
<li>Binary size</li>
<li>Build times</li>
<li>Usability</li>
<li>Flexibility</li>
</ul>
<p>The more customization we add, the larger our binary size and build times.  A single function / bool won't make a difference but its the general approach we take to these questions that can mean whether we add 1 or 30.</p>
<p>For usability, a problem we've found is there are diminishing returns for more customization.  The larger our API, the harder it is for people to find what they are looking for, the less of clap they use.  So adding a piece of help customization to the main API negatively affects all users.</p>
<p>As we provide a way to customize this, that means this is a lower priority.</p>
<p>As for what the default sort order should be, It's hard to say.  It would be good for someone to dig into the history of our current sort order to identify what went into the decisions that were made.  It would also be good to do a survey of various tools to see if there is a pattern to them to see what we can learn.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> added by @epage on 2025-09-25 16:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-triage</span> removed by @epage on 2025-09-25 16:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-help</span> added by @epage on 2025-09-25 16:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thomas-zahner">@thomas-zahner</a> on 2025-09-26 07:49</div>
            <div class="timeline-body"><p>Thanks for the swift reply. I definitely understand your concerns and I agree that additional customization affects users negatively. I dug through the man pages (the help messages might differ for some programs, but that's probably rare) of various well known commands and came to the conclusion that the current behaviour by clap seems to be more common.</p>
<h2>Programs which order by short and long flags (as clap currently does)</h2>
<pre><code>cat
ls
mv
touch
ln
top
grep
df
du
nano
</code></pre>
<h2>ordered by long flags (the behaviour I personally prefer)</h2>
<pre><code>curl
rg
tail
</code></pre>
<h2>unordered (manual ordering)</h2>
<p>This is not directly relevant to this issue, but still interesting to see that this is so common.</p>
<pre><code>man 
fd
echo
wget
tree
cargo
rustc
chmod
chown
cp
rm
kill
uname
free
lscpu
ip
ss
hexdump
sed
gawk
diff
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:36:27 UTC
    </footer>
</body>
</html>
