```yaml
number: 4999
title: "Can't specify multiple vector elements using env vars"
type: issue
state: open
author: johananl
labels:
  - C-bug
assignees: []
created_at: 2023-07-07T11:36:06Z
updated_at: 2023-07-10T09:11:10Z
url: https://github.com/clap-rs/clap/issues/4999
synced_at: 2026-01-10T01:57:48Z
```

# Can't specify multiple vector elements using env vars

---

_Issue opened by @johananl on 2023-07-07 11:36_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Rust Version

rustc 1.70.0 (90c541806 2023-05-31)

### Clap Version

4.3.11

### Minimal reproducible code

```rust
use clap::Parser;

#[derive(Parser)]
struct Cli {
    #[arg(short, env)]
    foo: Vec<i32>,
}

fn main() {
    let cli = Cli::parse();
    println!("{:?}", cli.foo);
}

```

### Steps to reproduce the bug with the above code

```
cargo run -- -f 1 -f 2
```

Output: `[1, 2]`

```
FOO=1 cargo run
```

Output: `[1]`

```
FOO="1 2" cargo run
```

Output: `error: invalid value '1 2' for '-f <FOO>': invalid digit found in string`

```
FOO="1,2" cargo run
```

Output: `error: invalid value '1,2' for '-f <FOO>': invalid digit found in string`

```
FOO="1, 2" cargo run
```

Output: `error: invalid value '1, 2' for '-f <FOO>': invalid digit found in string`


```
FOO="[1, 2]" cargo run
```

Output: `error: invalid value '[1, 2]' for '-f <FOO>': invalid digit found in string`

### Actual Behaviour

When using `env` on a vector field, multiple values can be passed by specifying the argument multiple times on the CLI, however the same can't be done when using env vars (because the OS doesn't support specifying the same env var twice).

### Expected Behaviour

I think it makes sense to have consistency between CLI args and env vars when using the `env` option even when the field is a vector. If that's not possible, the user should probably know about the expected behavior or limitation.

Potential solutions I can think of:

1. Parse env var values when using `env` on vector fields and split the string into vector elements. Something like `FOO="[1, 2]"` can likely be used.
2. Document the fact that when using `env` on vector fields, only one value can be specified.
3. Disallow `env` on vector fields.

### Additional Context

_No response_

### Debug Output

_No response_

---

_Label `C-bug` added by @johananl on 2023-07-07 11:36_

---

_Renamed from "Can't specify multiple vector element using env vars" to "Can't specify multiple vector elements using env vars" by @johananl on 2023-07-07 13:22_

---

_Comment by @epage on 2023-07-07 14:01_

You can use [value_delimiter](https://docs.rs/clap/latest/clap/struct.Arg.html#method.value_delimiter) to split the env variable though that also means that CLI values will also be split

---

_Referenced in [clap-rs/clap#5000](../../clap-rs/clap/pulls/5000.md) on 2023-07-07 14:08_

---

_Comment by @johananl on 2023-07-10 09:11_

Thanks @epage. I wonder if there is a way to reconcile the behavior of CLI args and env vars for vector values, as well as whether it would make sense to do so. The problem of course isn't in clap itself, it's the fact that at the OS level it's meaningless to specify the same env var twice.

---
