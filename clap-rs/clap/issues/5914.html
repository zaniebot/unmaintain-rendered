<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Set clap's `ColorChoice` using an argument - clap-rs/clap #5914</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Set clap's `ColorChoice` using an argument</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/clap-rs/clap/issues/5914">#5914</a>
        opened by <a href="https://github.com/acuteenvy">@acuteenvy</a>
        on 2025-02-18 14:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/acuteenvy">@acuteenvy</a> on 2025-02-18 14:45</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[x] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[x] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>4.5.30</p>
<h3>Describe your use case</h3>
<p>A lot of command-line programs support a <code>--color</code> argument to control colored output. There is no way, however, to control the color of clap-generated help and error messages using such an option.</p>
<h3>Describe the solution you'd like</h3>
<pre><code class="language-rust">use clap::{ColorChoice, Parser};

#[derive(Parser)]
//#[command(color = ???)]
struct Cli {
    // Somehow make clap use this value, so that if a user runs 'myprogram --color never --help'
    // for example, clap will display the help without colors.
    #[arg(long, value_name = &quot;WHEN&quot;, default_value_t = ColorChoice::default())]
    color: ColorChoice,
}

fn main() {
    let _cli = Cli::parse();
}
</code></pre>
<h3>Alternatives, if applicable</h3>
<p><em>No response</em></p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @acuteenvy on 2025-02-18 14:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-02-18 16:43</div>
            <div class="timeline-body"><p>This gets into a weird chicken and egg problem</p>
<pre><code class="language-console">$ foo --color=never --hel
</code></pre>
<p>Could parse <code>--color</code> and have it affect the error</p>
<pre><code class="language-console">$ foo --hel --color=never
</code></pre>
<p>would hit the error before we parse <code>--color=never</code>.  Parsing of a CLI is context-sensitive.  We could have a heuristic to try to guess the intent but it would just be that.</p>
<p>That is leaving aside the challenges we've had with built-in vs custom <code>--help</code> and then trying to extend that to <code>--color</code>.  Probably the worst example I can think of is ripgrep (independent of whether it uses clap today) is it supports <code>none</code>, <code>never</code>, <code>always</code>, and <code>ansi</code></p>
<p>I know at least Cargo is tracking this in rust-lang/cargo#9012</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/acuteenvy">@acuteenvy</a> on 2025-02-18 18:10</div>
            <div class="timeline-body"><p>So, when <code>--color</code> is the first argument, it would be possible to apply it to errors and <code>--help</code>, right? That's a lot better than not having it affect clap at all.</p>
<p>Would it be possible for clap to support this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-02-18 18:18</div>
            <div class="timeline-body"><p>I'm not sure it is better as the inconsistency in behavior may surprise people.  There is also the problem that <code>--help</code> is an error when encountered and so <code>--help --color=never</code> would be ignored.  This <em>could</em> change but that is cascading to be a lot bigger of a change and still doesn't resolve the other problems (like knowing about the flag in the first place).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/acuteenvy">@acuteenvy</a> on 2025-02-18 18:30</div>
            <div class="timeline-body"><p>Alright, thanks for the quick answers. Should I close this issue, or is it something you'd like to reconsider in a future clap release?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-02-18 18:37</div>
            <div class="timeline-body"><p>Unsure.  Might be good to be open for a bit to raise visibility or any other thoughts or input.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2025-05-30 12:27</div>
            <div class="timeline-body"><p>FWIW, all the scenarios (writing to file, <code>NO_COLOR=1</code> etc..) where we don't want color for error messages are automatically taken care of by clap. The error and help message don't have colors then.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:35:43 UTC
    </footer>
</body>
</html>
