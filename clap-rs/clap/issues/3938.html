<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prevent specifying global args multiple times - clap-rs/clap #3938</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Prevent specifying global args multiple times</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/clap-rs/clap/issues/3938">#3938</a>
        opened by <a href="https://github.com/cd-work">@cd-work</a>
        on 2022-07-15 16:11
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cd-work">@cd-work</a></div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>3.2.8</p>
<h3>Describe your use case</h3>
<p>When making an argument global with <code>Arg::global(true)</code>, it will be available to both the parent and child subcommand. To me this implies that this option is a single flag that can be modified from anywhere.</p>
<p>However when specifying the global twice (e.g. <code>cmd --global x subcmd --global y</code>), the parent's assignment of the variable will be discarded in favor of the subcommand's. While this definitely is a possible way to handle this edgecase, I think this command invocation indicates that the user is doing something wrong and it would be better if clap could tell the user that what he's doing doesn't make any sense.</p>
<p>In my specific scenario, I have a command which defaults to one of it subcommands, so <code>cmd --flag x</code> is the same as <code>cmd list --flag x</code>, while there's also other subcommands like <code>cmd foo --flag x</code>. One flag is shared between all subcommands (which I've tried making global), while some others are only available to <code>cmd</code> and <code>cmd list</code>. This would solve the issue of having an option that can be specified twice for that one shared flag, but I'd still need another solution preventing people from using the other <code>cmd list</code>-specific flags which can also be used with just <code>cmd</code> when another subcommand like <code>cmd foo</code> is used. So it's possible that this feature request is just a band-aid rather than solving the root issue.</p>
<h3>Describe the solution you'd like</h3>
<p>Emit an error when specifying the same global argument multiple times.</p>
<h3>Alternatives, if applicable</h3>
<p><em>No response</em></p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @cd-work on 2022-07-15 16:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cd-work">@cd-work</a> on 2022-07-15 17:51</div>
            <div class="timeline-body"><blockquote>
<p>I'd still need another solution preventing people from using the other cmd list-specific flags which can also be used with just cmd when another subcommand like cmd foo is used. So it's possible that this feature request is just a band-aid rather than solving the root issue.</p>
</blockquote>
<p>I've found the <code>args_conflicts_with_subcommands</code> option, so I guess that solves my root issue in a more general way. Though the error is rather... unfortunate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">M-breaking-change</span> added by @epage on 2022-07-16 02:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-07-16 02:08</div>
            <div class="timeline-body"><p>Just reading the description,</p>
<ul>
<li>I would expect global arguments to be merged or overwritten based on their <code>Action</code> (granted, due to the current structure, we might not be able to handle this cleanly when custom actions are implemented).</li>
<li>Changing this would likely be considered a breaking change</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-parsing</span> added by @epage on 2022-11-08 04:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> added by @epage on 2022-11-08 04:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1570.html">clap-rs/clap#1570</a> on 2022-11-08 05:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5588.html">clap-rs/clap#5588</a> on 2024-07-19 16:06</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:48:41 UTC
    </footer>
</body>
</html>
