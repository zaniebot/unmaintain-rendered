<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Positional argument and subcommands interfere with each other - clap-rs/clap #2459</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Positional argument and subcommands interfere with each other</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/2459">#2459</a>
        opened by <a href="https://github.com/htejun">@htejun</a>
        on 2021-04-30 10:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/htejun">@htejun</a></div>
            <div class="timeline-body">

Rust Version
<p>rustc 1.51.0 (2fd73fabe 2021-03-23)</p>
Affected Version of clap
<p>2.33.3</p>
Expected Behavior Summary
<p>Given the following source code:</p>
<pre><code>fn main() {
    clap::App::new(&quot;test&quot;)
        .args_from_usage(&quot;&lt;REQUIRED_POSITIONAL&gt; &#x27;required positional argument&#x27;&quot;)
        .subcommand(clap::SubCommand::with_name(&quot;test&quot;).about(&quot;test subcommand&quot;))
        .get_matches();
}
</code></pre>
<p>All of the following three invocations should parse successfully:</p>
<pre><code>test-clap out test
test-clap test.out test
test-clap test test
</code></pre>
Actual Behavior Summary
<p>The last two fail.</p>
<pre><code>$ target/debug/test-clap out test
$ target/debug/test-clap test.out test
error: The subcommand &#x27;test.out&#x27; wasn&#x27;t recognized
        Did you mean &#x27;test&#x27;?

If you believe you received this message in error, try re-running with &#x27;test-clap -- test.out&#x27;

USAGE:
    test-clap &lt;REQUIRED_POSITIONAL&gt; [SUBCOMMAND]

For more information try --help
$ target/debug/test-clap test test
error: Found argument &#x27;test&#x27; which wasn&#x27;t expected, or isn&#x27;t valid in this context

USAGE:
    test-clap &lt;REQUIRED_POSITIONAL&gt; test

For more information try --help
</code></pre>
Steps to Reproduce the issue
<p>Build the program from expected behavior summary and run the program with the commands from expected behavior summary.</p>
Sample Code or Link to Sample Code
<pre><code>fn main() {
    clap::App::new(&quot;test&quot;)
        .args_from_usage(&quot;&lt;REQUIRED_POSITIONAL&gt; &#x27;required positional argument&#x27;&quot;)
        .subcommand(clap::SubCommand::with_name(&quot;test&quot;).about(&quot;test subcommand&quot;))
        .get_matches();
}
</code></pre>
Debug output

 Debug Output 
<pre>
<code>
$ target/debug/test-clap test.out test
DEBUG:clap:UsageParser::from_usage;
DEBUG:clap:UsageParser::new: usage=&quot; \&#x27;required positional argument\&#x27;&quot;
DEBUG:clap:UsageParser::parse;
DEBUG:clap:UsageParser::parse:iter: pos=0;
DEBUG:clap:UsageParser::stop_at;
DEBUG:clap:UsageParser::name;
DEBUG:clap:UsageParser::stop_at;
DEBUG:clap:UsageParser::name: setting name...REQUIRED_POSITIONAL
DEBUG:clap:UsageParser::name: explicit name set...
DEBUG:clap:UsageParser::parse:iter: pos=20;
DEBUG:clap:UsageParser::stop_at;
DEBUG:clap:UsageParser::help;
DEBUG:clap:UsageParser::stop_at;
DEBUG:clap:UsageParser::help: setting help...required positional argument
DEBUG:clap:UsageParser::parse:iter: pos=52;
DEBUG:clap:UsageParser::stop_at;
DEBUG:clap:UsageParser::parse: vals...None
DEBUG:clap:Parser::add_subcommand: term_w=None, name=test
DEBUG:clap:Parser::propagate_settings: self=test, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: sc=test, settings=AppFlags(
    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO,
), g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: self=test, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:Parser::create_help_and_version: Building help
DEBUG:clap:Parser::get_matches_with: Begin parsing &#x27;&quot;test.out&quot;&#x27; ([116, 101, 115, 116, 46, 111, 117, 116])
DEBUG:clap:Parser::is_new_arg:&quot;test.out&quot;:NotFound
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: probably value
DEBUG:clap:Parser::is_new_arg: starts_new_arg=false
DEBUG:clap:Parser::possible_subcommand: arg=&quot;test.out&quot;
DEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None
DEBUG:clap:usage::create_usage_with_title;
DEBUG:clap:usage::create_usage_no_title;
DEBUG:clap:usage::get_required_usage_from: reqs=[&quot;REQUIRED_POSITIONAL&quot;], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=[&quot;REQUIRED_POSITIONAL&quot;]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:usage::needs_flags_tag;
DEBUG:clap:usage::needs_flags_tag:iter: f=hclap_help;
DEBUG:clap:usage::needs_flags_tag:iter: f=vclap_version;
DEBUG:clap:usage::needs_flags_tag: [FLAGS] not required
DEBUG:clap:usage::create_help_usage: usage=test-clap  [SUBCOMMAND]
DEBUG:clap:Parser::color;
DEBUG:clap:Parser::color: Color setting...Auto
DEBUG:clap:is_a_tty: stderr=true
DEBUG:clap:Colorizer::error;
DEBUG:clap:Colorizer::warning;
DEBUG:clap:Colorizer::good;
DEBUG:clap:Colorizer::good;
DEBUG:clap:Colorizer::good;
error: The subcommand &#x27;test.out&#x27; wasn&#x27;t recognized
        Did you mean &#x27;test&#x27;?

<p>If you believe you received this message in error, try re-running with &#x27;test-clap -- test.out&#x27;</p>
<p>USAGE:
test-clap &lt;REQUIRED_POSITIONAL&gt; [SUBCOMMAND]</p>
<p>For more information try --help
$ target/debug/test-clap test test
DEBUG:clap:UsageParser::from_usage;
DEBUG:clap:UsageParser::new: usage=&quot;&lt;REQUIRED_POSITIONAL&gt; &#x27;required positional argument&#x27;&quot;
DEBUG:clap:UsageParser::parse;
DEBUG:clap:UsageParser::parse:iter: pos=0;
DEBUG:clap:UsageParser::stop_at;
DEBUG:clap:UsageParser::name;
DEBUG:clap:UsageParser::stop_at;
DEBUG:clap:UsageParser::name: setting name...REQUIRED_POSITIONAL
DEBUG:clap:UsageParser::name: explicit name set...
DEBUG:clap:UsageParser::parse:iter: pos=20;
DEBUG:clap:UsageParser::stop_at;
DEBUG:clap:UsageParser::help;
DEBUG:clap:UsageParser::stop_at;
DEBUG:clap:UsageParser::help: setting help...required positional argument
DEBUG:clap:UsageParser::parse:iter: pos=52;
DEBUG:clap:UsageParser::stop_at;
DEBUG:clap:UsageParser::parse: vals...None
DEBUG:clap:Parser::add_subcommand: term_w=None, name=test
DEBUG:clap:Parser::propagate_settings: self=test, g_settings=AppFlags(
(empty),
)
DEBUG:clap:Parser::propagate_settings: sc=test, settings=AppFlags(
NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO,
), g_settings=AppFlags(
(empty),
)
DEBUG:clap:Parser::propagate_settings: self=test, g_settings=AppFlags(
(empty),
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:Parser::create_help_and_version: Building help
DEBUG:clap:Parser::get_matches_with: Begin parsing &#x27;&quot;test&quot;&#x27; ([116, 101, 115, 116])
DEBUG:clap:Parser::is_new_arg:&quot;test&quot;:NotFound
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: probably value
DEBUG:clap:Parser::is_new_arg: starts_new_arg=false
DEBUG:clap:Parser::possible_subcommand: arg=&quot;test&quot;
DEBUG:clap:Parser::get_matches_with: possible_sc=true, sc=Some(&quot;test&quot;)
DEBUG:clap:Parser::parse_subcommand;
DEBUG:clap:usage::get_required_usage_from: reqs=[&quot;REQUIRED_POSITIONAL&quot;], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=[&quot;REQUIRED_POSITIONAL&quot;]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:Parser::parse_subcommand: About to parse sc=test
DEBUG:clap:Parser::parse_subcommand: sc settings=AppFlags(
NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO,
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:Parser::get_matches_with: Begin parsing &#x27;&quot;test&quot;&#x27; ([116, 101, 115, 116])
DEBUG:clap:Parser::is_new_arg:&quot;test&quot;:NotFound
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: probably value
DEBUG:clap:Parser::is_new_arg: starts_new_arg=false
DEBUG:clap:Parser::possible_subcommand: arg=&quot;test&quot;
DEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None
DEBUG:clap:Parser::get_matches_with: Positional counter...1
DEBUG:clap:Parser::get_matches_with: Low index multiples...false
DEBUG:clap:usage::create_usage_with_title;
DEBUG:clap:usage::create_usage_no_title;
DEBUG:clap:usage::get_required_usage_from: reqs=[], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:usage::needs_flags_tag;
DEBUG:clap:usage::needs_flags_tag:iter: f=hclap_help;
DEBUG:clap:usage::needs_flags_tag:iter: f=vclap_version;
DEBUG:clap:usage::needs_flags_tag: [FLAGS] not required
DEBUG:clap:usage::create_help_usage: usage=test-clap &lt;REQUIRED_POSITIONAL&gt; test
DEBUG:clap:Parser::color;
DEBUG:clap:Parser::color: Color setting...Auto
DEBUG:clap:is_a_tty: stderr=true
DEBUG:clap:Colorizer::error;
DEBUG:clap:Colorizer::warning;
DEBUG:clap:Colorizer::good;
error: Found argument &#x27;test&#x27; which wasn&#x27;t expected, or isn&#x27;t valid in this context</p>
<p>USAGE:
test-clap &lt;REQUIRED_POSITIONAL&gt; test</p>
<p>For more information try --help
</code>
</pre></p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Positional argument and subcommands interferes with each other&quot; to &quot;Positional argument and subcommands interfere with each other&quot; by <a href="https://github.com/htejun">@htejun</a> on 2021-04-30 10:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-04-30 11:10</div>
            <div class="timeline-body"><p>Fixed on master.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-04-30 11:10</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:58:06 UTC
    </footer>
</body>
</html>
