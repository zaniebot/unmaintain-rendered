<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request: an env-variable-only version of clap::Parser::parse() that doesn't interact with env::args - clap-rs/clap #3741</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Request: an env-variable-only version of clap::Parser::parse() that doesn't interact with env::args</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/3741">#3741</a>
        opened by <a href="https://github.com/wimax-grapl">@wimax-grapl</a>
        on 2022-05-21 19:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/wimax-grapl">@wimax-grapl</a> on 2022-05-21 19:46</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>2.34.0</p>
<h3>Describe your use case</h3>
<p>Hi folks!</p>
<p>We are.... well, if we're being honest, we're probably misusing Clap.</p>
<p>We use it to define a hierarchical config for our program, but we never inject arguments by command line flag, just by environment variable.
That is to say, all of our Derives look like</p>
<pre><code>#[derive(clap::Parser, Debug)]
pub struct ClientCertConfig {
    #[clap(env)]
    pub public_certificate_pem: Option&lt;String&gt;,
    #[clap(env)]
    pub some_other_thing: u64,
}
</code></pre>
<p>I've encountered two situations where using Clap this way has been painful:</p>
<ol>
<li>When you start including default values into the mix, Clap understandably starts complaining about the ordering of your arguments from a CLI point of view. However, for our use cases, this doesn't really matter and just adds extra complexity. <strong>The workaround we ended up using was adding clap(env, long) to every field to avoid any ordering complexity.</strong></li>
<li>I have a test case that calls ::parse() to grab values from environment variables. I also try passing <code>--nocapture</code> to the test binary. <a href="https://github.com/rust-lang/cargo/issues/8916">This is a known issue. </a></li>
</ol>
<h3>Describe the solution you'd like</h3>
<p>it'd be really nice if there were a batteries-included <code>Parser::parse_from_env()</code> or something. It can throw as many errors as it wants if your struct doesn't strictly have <code>env</code> fields.</p>
<h3>Alternatives, if applicable</h3>
<p>It's possible we should just switch to something like <a href="https://github.com/mehcode/config-rs/">config-rs</a>.</p>
<h3>Additional Context</h3>
<ul>
<li></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @wimax-grapl on 2022-05-21 19:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wimax-grapl">@wimax-grapl</a> on 2022-05-21 20:18</div>
            <div class="timeline-body"><p>(note: at least for the #2 case, <code>.parse_from(some_empty_iter)</code> seems to do the trick.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../grapl-security/grapl/pulls/1737.html">grapl-security/grapl#1737</a> on 2022-05-21 20:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-05-21 23:59</div>
            <div class="timeline-body"><p>Yes, I would recommend <code>.parse_from</code>.  Depending on what you are doing, you may also want to set <a href="https://docs.rs/clap/latest/clap/struct.App.html#method.no_binary_name"><code>#[clap(no_binary_name = true)]</code></a> as that will let you just do <code>parse_from([])</code> and not need to accept any arguments.</p>
<p>For the fact that clap is focused on command-line argument parsing rather than environment reading and that we at least provide those building blocks I'm going to close this.  We do not want to set the precedence that we are a general environment reader and all of the API requests that may come with that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2022-05-21 23:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-wont-fix</span> added by @epage on 2022-05-22 00:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wimax-grapl">@wimax-grapl</a> on 2022-05-23 17:00</div>
            <div class="timeline-body"><p>Thanks for the followup / workarounds!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:35:00 UTC
    </footer>
</body>
</html>
