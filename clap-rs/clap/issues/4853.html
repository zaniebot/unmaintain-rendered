<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>clap suggests hidden subcommands in &quot;similar subcommand&quot; error hints - clap-rs/clap #4853</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>clap suggests hidden subcommands in &quot;similar subcommand&quot; error hints</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/clap-rs/clap/issues/4853">#4853</a>
        opened by <a href="https://github.com/yshui">@yshui</a>
        on 2023-04-21 13:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/yshui">@yshui</a> on 2023-04-21 13:48</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Rust Version</h3>
<p>irrelevant</p>
<h3>Clap Version</h3>
<p>master</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">fn main() {
    clap::Command::new(&quot;app&quot;)
        .subcommand(clap::Command::new(&quot;subcommand&quot;).hide(true))
        .get_matches();
}
</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<p>cargo run -- su</p>
<h3>Actual Behaviour</h3>
<pre><code>error: unrecognized subcommand 'su'

  tip: a similar subcommand exists: 'subcommand'
</code></pre>
<h3>Expected Behaviour</h3>
<p>nothing is suggested.</p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
<h3>Debug Output</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @yshui on 2023-04-21 13:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/yshui">@yshui</a> on 2023-04-21 13:48</div>
            <div class="timeline-body"><p>Fix in #4852</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-04-21 14:09</div>
            <div class="timeline-body"><p>Can you give your use case as to why you expect hidden subcommands to be not suggested?</p>
<p>The exact semantics of <code>hide</code> come up from time to time.  For example, we suggest hidden subcommands and arguments in completions (#1335).  In the new completion system, the proposal is to not suggest completing hidden items by default but to instead complete them if it looks like the user is intending to use the hidden item (#3951).</p>
<p>This latter case sounds similar to suggestions in errors which runs counter to this issue / #4852 which is why this merits further discussion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/yshui">@yshui</a> on 2023-04-21 14:21</div>
            <div class="timeline-body"><p>so the tool I am working on has commands that is not intended to be run manually, at all. they are only intended to be invoked internally by the tool itself.</p>
<p>i am ok with only suggesting them when the user <em>do</em> intend to use them, but i don't see how you can reliably detect user intentions.</p>
<p>i found this to be a problem because clap suggested things like <code>__subcommand</code> when i typed <code>sub</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-decision</span> added by @epage on 2023-04-21 14:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-help</span> added by @epage on 2023-04-21 14:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/yshui">@yshui</a> on 2023-04-21 14:26</div>
            <div class="timeline-body"><p>maybe there can be two levels of hidden-ness? like, hidden and <em>hidden</em> hidden</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/weihanglo">@weihanglo</a> on 2023-08-17 22:21</div>
            <div class="timeline-body"><p>With <a href="https://github.com/clap-rs/clap/pull/5075">https://github.com/clap-rs/clap/pull/5075</a>, we have <a href="https://docs.rs/clap/latest/clap/builder/struct.UnknownArgumentValueParser.html"><code>UnknownArgumentValueParser</code></a> to guide users to use the correct flag. If clap provides a way to stop typo-suggesting a flag, it would be perfect!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../rust-lang/cargo/issues/11702.html">rust-lang/cargo#11702</a> on 2023-08-22 20:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5097.html">clap-rs/clap#5097</a> on 2023-08-28 17:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Carreau">@Carreau</a> on 2023-08-28 17:52</div>
            <div class="timeline-body"><p>I was curious and tried to find a way to do so in #5097.</p>
<p>It adds <code>.didyoumean(false)</code> that filter out arguments from the suggestion logic. In combination with <code>.hide(...)</code> I think that would create what @weihanglo wants and we can extends for subcommands for @yshui.</p>
<p>Anyway just a suggestion instead of fighting for wether or not <code>hide(...)</code> should suggest or not.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-08-28 18:53</div>
            <div class="timeline-body"><blockquote>
<p>I think that would create what @weihanglo wants</p>
</blockquote>
<p>There was more discussion in rust-lang/cargo#11702 and it is unclear what we want the behavior to be in that case.</p>
<blockquote>
<p>Anyway just a suggestion instead of fighting for wether or not hide(...) should suggest or not.</p>
</blockquote>
<p>Except this shifts the discussion to whether this part of the API pulls enough weight to justify itself.  We've been focusing recently on shrinking clap, in binary size, in compile time, and in API size.  The bigger the API is, the harder it is to find anything, making it less likely people will use any of the features in the API, lowering the value gained by having each piece of the API.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "clap suggests hidden subcommands" to "clap suggests hidden subcommands in errors" by @epage on 2024-01-15 22:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "clap suggests hidden subcommands in errors" to "clap suggests hidden subcommands in "similar subcommand" error hints" by @epage on 2024-04-23 20:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5471.html">clap-rs/clap#5471</a> on 2024-04-23 20:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../jj-vcs/jj/issues/5335.html">jj-vcs/jj#5335</a> on 2025-01-10 20:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:09 UTC
    </footer>
</body>
</html>
