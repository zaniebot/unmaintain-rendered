<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clap v3 ColoredHelp by default - clap-rs/clap #2055</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Clap v3 ColoredHelp by default</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/2055">#2055</a>
        opened by <a href="https://github.com/pickfire">@pickfire</a>
        on 2020-08-09 15:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/pickfire">@pickfire</a> on 2020-08-09 15:17</div>
            <div class="timeline-body"><h3>Make sure you completed the following tasks</h3>
<ul>
<li>[x] Searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[x] Searched the closed issues</li>
</ul>
<h3>Describe your use case</h3>
<p>Use <code>ColoredHelp</code> for <code>AppSettings</code> by default if <code>color</code> feature is present, optionally available for opt-out. Quite a few crates is not aware of this feature and was surprised that there is colored help setting, this would prove useful for those enabled <code>color</code> feature which is being enabled by default.</p>
<h3>Describe the solution you'd like</h3>
<p>Change <code>ColoredHelp</code> to <code>NoColoredHelp</code> for opt-out, by default colored help is enabled.</p>
<h3>Alternatives, if applicable</h3>
<p>Not in my mind.</p>
<h3>Additional context</h3>
<p>I made a few pull requests to other applications using clap, they were all surprised that there is a feature to have colored help. Only ripgrep that I know explicitly opt out for colored help since they use another crate for coloring and does not want to pull in an additional dependency, not sure if that's true in clap v3.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by @pickfire on 2020-08-09 15:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-08-10 00:07</div>
            <div class="timeline-body"><p>Nope. Color Help should be opt-in since features are additive.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @pksunkara on 2020-08-10 00:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-08-10 07:27</div>
            <div class="timeline-body"><p>@pksunkara Features are additive but it defaults to &quot;colors&quot; being enabled. I think colored help should be enabled if the feature is enabled and disabled if feature is disabled. Enabling the feature &quot;colors&quot; but not enabling colored help is not helping feature discover-ability.</p>
<p>IIRC @CreepySkeleton commented on this, I think he agrees or maybe I got the wrong idea. https://github.com/clap-rs/clap/pull/1976#issuecomment-671062293</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-08-10 08:00</div>
            <div class="timeline-body"><p>Let me rephrase. CLIs by default are not colored. And then the user should specifically given an option to color it. Lots of people don't like colors. Making it opt-in is a good compromise.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-08-10 15:57</div>
            <div class="timeline-body"><p>Guys, I think you've all been missing the main point of my comment: the coloring is already gated behind <code>ColorAlways/ColorAuto/ColorNever</code>. <code>ColoredHelp</code> is redundant. It reminds me of the infamous joke about Windows Explorer popups:</p>
<ul>
<li>&quot;Are you sure you want to delete the folder?&quot;</li>
<li>&quot;All contents will be deleted, please confirm&quot;.</li>
<li>&quot;The folder itself will be removed, too. Click yes to proceed.&quot;</li>
<li>&quot;The folder will be removed Permanently. You will not be able to restore it. Continue?&quot;</li>
<li>&quot;Didn't you change you mind? Press yes to proceed.&quot;</li>
<li>&quot;Please fill the Directory Removal Confirmation Form and send it to us signed in blood of your firstborn&quot;...</li>
</ul>
<p>I don't think we need it at all.</p>
<p>Except, the colors are <code>Auto</code> by default, but I do think it's fine. I assume that there are more people who like color than who dislike it, so &quot;on by default but you can opt out (either by disabling the feature or by using the Never setting)&quot; is a better compromise.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-08-11 00:41</div>
            <div class="timeline-body"><blockquote>
<p><code>ColoredHelp</code> is redundant</p>
</blockquote>
<p>No it is not. There are 3 controls for colored help message.</p>
<ol>
<li>Feature in cargo.toml</li>
<li><code>ColorAuto/ColorNever</code></li>
<li><code>ColoredHelp</code> setting.</li>
</ol>
<p>By mix-matching these the user (cli developer here) can customise what they want.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-08-21 04:17</div>
            <div class="timeline-body"><p>Reenergizing the topic!</p>
<blockquote>
<p>By mix-matching these the user (cli developer here) can customise what they want.</p>
</blockquote>
<p>Sure. But I don't see where <code>ColoredHelp</code> comes into play.</p>
<hr />
<p>The possible scenarios:</p>
<ol>
<li>You don't want colors for any of your apps.</li>
<li>You want colors for some of your applications (or subcommands), but don't want for others.</li>
<li>You want colors for the all apps/subcommands.</li>
</ol>
<p>Let's imagine we don't have <code>ColoredHelp</code>.</p>
<ol>
<li>You can just off the <code>color</code> feature.</li>
<li>You can set <code>ColorNever</code> for the latter, the former will have colors by default.</li>
<li>You do nothing and enjoy clap because colors are <code>Auto</code> by default.</li>
</ol>
<p>And what is the current situation?</p>
<ol>
<li>You sit and relax - colors are off by default. Whether the <code>Cargo.toml</code> feature is on or off matters not (WTF?).</li>
<li>You can set <code>ColoredHelp</code> for the former, the latter have no colors by default.</li>
<li>You can set <code>ColoredHelp</code> for all of your apps.</li>
</ol>
<p><em>Important note: <code>ColorAuto/ColorNever</code> are useless in this model. The cargo.toml feature is only useful for trimming unused code - it has no effect on coloring behavior because it's already orchestrated by other mechanisms.</em></p>
<hr />
<p>I think the second system is kinda fucked up (probably because of legacy; you've just got used to taking it for normal) and the first is much better.</p>
<p>@pksunkara Counter arguments?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-08-25 04:41</div>
            <div class="timeline-body"><p>How about the derive support for colors? It could still be somewhat related so I just discuss it here. From <code>cargo-expand</code></p>
<pre><code class="language-rust">#[derive(StructOpt, Debug)]
#[structopt(rename_all = &quot;kebab-case&quot;)]
pub struct Args {
    /// Coloring: auto, always, never
    #[structopt(long, value_name = &quot;WHEN&quot;)]
    pub color: Option&lt;Coloring&gt;,
}

#[derive(Debug, Clone, Copy)]
pub enum Coloring {
    Auto,
    Always,
    Never,
}

impl FromStr for Coloring {
    type Err = String;

    fn from_str(name: &amp;str) -&gt; Result&lt;Self, Self::Err&gt; {
        match name {
            &quot;auto&quot; =&gt; Ok(Coloring::Auto),
            &quot;always&quot; =&gt; Ok(Coloring::Always),
            &quot;never&quot; =&gt; Ok(Coloring::Never),
            other =&gt; Err(format!(
                &quot;must be auto, always, or never, but found `{}`&quot;,
                other,
            )),
        }
    }
}

impl Display for Coloring {
    fn fmt(&amp;self, formatter: &amp;mut fmt::Formatter) -&gt; fmt::Result {
        let name = match self {
            Coloring::Auto =&gt; &quot;auto&quot;,
            Coloring::Always =&gt; &quot;always&quot;,
            Coloring::Never =&gt; &quot;never&quot;,
        };
        formatter.write_str(name)
    }
}
</code></pre>
<p>Do we want the users to write their own settings for stuff available in <code>clap</code>?</p>
<p>https://github.com/dtolnay/cargo-expand/blob/9ee9cd3fc4d2e8a472f113894a09979ae8fc3358/src/opts.rs#L89-L91</p>
<p>https://github.com/dtolnay/cargo-expand/blob/9ee9cd3fc4d2e8a472f113894a09979ae8fc3358/src/opts.rs#L122-L154</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-08-27 08:28</div>
            <div class="timeline-body"><p>You are missing the scenario where the users wants colors for error messages but no colors for help message. This is why we have 3 controls.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-08-27 10:49</div>
            <div class="timeline-body"><blockquote>
<p>You are missing the scenario where the users wants colors for error messages but no colors for help message</p>
</blockquote>
<p>Does... anybody do that, really? I mean, intentionally, not because they forgot to enable <code>ColoredHelp</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-08-27 10:53</div>
            <div class="timeline-body"><p>This is actually the reason why I'm so insistent on this issue:</p>
<blockquote>
<p>I made a few pull requests to other applications using clap, they were all surprised that there is a feature to have colored help.</p>
</blockquote>
<p>The current system is too easy to misuse.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-08-27 12:23</div>
            <div class="timeline-body"><blockquote>
<p>Does... anybody do that, really? I mean, intentionally, not because they forgot to enable <code>ColoredHelp</code>.</p>
</blockquote>
<p>Yes, I do this in one the CLI tools I develop and use, https://github.com/termapps/enquirer.</p>
<p>Regarding making <code>ColoredHelp</code> default switched on, as I said before, I think colors in error but not in help messages is a sensible default</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-08-27 16:34</div>
            <div class="timeline-body"><p>I have an idea for a middle ground between normal users and more advanced users.</p>
<ul>
<li><code>Color(Auto|Always|Never)</code> covers all colors, including help and errors which I think is what most people wanted</li>
<li><code>ColoredError(Auto|Always|Never)</code> covers only error message but not help which @pksunkara wanted</li>
<li><code>ColoredHelp(Auto|Always|Never)</code> covers only help message but not error which is the current default @CreepySkeleton and me does not want</li>
</ul>
<p>Going even further, I think it may be better to have <code>ColorAuto</code> by default if <code>color</code> feature is used, I don't think people would want color being disabled by default when having the feature enabled so here we have an opt-out approach on <code>ColorAuto</code> based on feature.</p>
<p>Different scenarios and steps required which improves the current process for people wanting colors (3 steps)</p>
<ul>
<li>I want colors by default<ol>
<li>add <code>color</code> to features (I think this is the default already)</li>
</ol>
</li>
<li>I want color only for help by default<ol>
<li>add <code>color</code> to features (I think this is the default already)</li>
<li>configure <code>ColoredErrorNever</code></li>
</ol>
</li>
<li>I want color only for error by default<ol>
<li>add <code>color</code> to features (I think this is the default already)</li>
<li>configure <code>ColoredHelpNever</code></li>
</ol>
</li>
<li>I don't want color<ol>
<li>remove <code>color</code> from features</li>
</ol>
</li>
</ul>
<p>To ease understanding on these, we could mention that <code>ColorAuto</code> is on by default on an opt-out basis. Internally, we only keep <code>ColoredHelp</code> and <code>ColoredError</code>. I personally think this is the sensible default given that 3 out of 3 pull requests I sent to enable colored help were merged and having the owner not knowing this feature.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-08-27 17:11</div>
            <div class="timeline-body"><blockquote>
<p>I think it may be better to have ColorAuto by default if color feature is used</p>
</blockquote>
<p>It already works like that.</p>
<p>And damn, you just converted 3 control flags which can be used together into 9 flags which are exclusive. That's not a good user experience. Let's not go into a tangent and focus on the discussion here.</p>
<p>I think what @CreepySkeleton is proposing is that we convert <code>ColoredHelp</code> setting to <code>DisableColoredHelp</code> setting. I am okay with that, but I think help not being colored is a sensible default and am thus reluctant.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../oppiliappan/eva/pulls/44.html">oppiliappan/eva#44</a> on 2020-11-05 02:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-11-05 02:37</div>
            <div class="timeline-body"><blockquote>
<p>And damn, you just converted 3 control flags which can be used together into 9 flags which are exclusive. That's not a good user experience. Let's not go into a tangent and focus on the discussion here.</p>
</blockquote>
<p>No, it is not exclusive. The reason I split into 3 different settings is that <code>Color</code> is the general default for the other 2, so setting that is like enabling color globally. <code>ColoredError</code> and <code>ColoredHelp</code> is the specific color option, if user override this it will override the <code>Color</code>.</p>
<p>Essentially two paths are checked</p>
<ul>
<li><code>Color</code> -&gt; <code>ColoredError</code></li>
<li><code>Color</code> -&gt; <code>ColoredHelp</code></li>
</ul>
<p>However, internally we could represent them using only 2 states, two <code>bool</code> is enough. The reason there is multiple options available (I know it is not so good) but we allow the users to have a single change to tweak the behavior to what they wanted. We could just put up a table for them, I do think a table is not so good and wonder if there is a more intuitive way.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2845.html">clap-rs/clap#2845</a> on 2021-10-17 19:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:07 UTC
    </footer>
</body>
</html>
