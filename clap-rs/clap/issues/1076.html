<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parser panics using global args and calling `get_matches_from_safe_borrow()` repeatedly - clap-rs/clap #1076</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Parser panics using global args and calling `get_matches_from_safe_borrow()` repeatedly</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/1076">#1076</a>
        opened by <a href="https://github.com/tomprogrammer">@tomprogrammer</a>
        on 2017-10-24 11:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/tomprogrammer">@tomprogrammer</a> on 2017-10-24 11:00</div>
            <div class="timeline-body"><h3>Rust Version</h3>
<p>rustc 1.21.0 (3b72af97e 2017-10-09)</p>
<h3>Affected Version of clap</h3>
<p>v2.26.2</p>
<h3>Expected Behavior Summary</h3>
<p>A global argument (<code>Arg::with_name(&quot;vm name&quot;).global(true)</code>) should be usable when calling <code>get_matches_from_safe_borrow()</code> multiple times on the same <code>App</code>.</p>
<h3>Actual Behavior Summary</h3>
<p>The second time clap parses some input it panics and reports &quot;Non-unique argument name: vm name is already in use&quot;. (See debug output)</p>
<p>Due to <code>AppSetting::NoBinaryName</code> and <code>get_matches_from_safe_borrow()</code> available I concluded it would be safe to reuse an <code>App</code> instance parsing many input lines. Except for the global arguments other features work well in my REPL-style cli application.</p>
<p>Alternatively I could clone the <code>App</code> and reset it before parsing another line of input. Do you consider reusing the <code>App</code> instance an API misuse and suggest to use <code>clone()</code> and reset, or is this an actual bug that should be fixed?</p>
<h3>Steps to Reproduce the issue</h3>
<ul>
<li>Clone https://github.com/tomprogrammer/clap-global-issue</li>
<li>Run <code>cargo run -- help</code></li>
<li>Type <code>help</code> into the REPL</li>
<li>The error occurs</li>
</ul>
<h3>Sample Code or Link to Sample Code</h3>
<p>https://github.com/tomprogrammer/clap-global-issue</p>
<h3>Debug output</h3>
<p>https://gist.github.com/tomprogrammer/4063db64a246b3d2d4bf472cec94fbda</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-10-24 12:02</div>
            <div class="timeline-body"><p>Would you mind testing this against the the current master branch? I just merged #1075 which deals with global args quite heavily and would like to know if that solves the issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tomprogrammer">@tomprogrammer</a> on 2017-10-24 12:48</div>
            <div class="timeline-body"><p>I updated the demonstration repository to use the current master branch. Unfortunately the PR doesn't fix this issue. I also updated the debug log in the gist linked above.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-10-24 12:54</div>
            <div class="timeline-body"><p>:+1:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-10-24 15:40</div>
            <div class="timeline-body"><p>I have this fixed in a local branch, I'll upload and put in the PR once I get home today.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2017-10-24 18:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tomprogrammer">@tomprogrammer</a> on 2017-10-24 19:13</div>
            <div class="timeline-body"><p>Thanks for the fast fix and this convenient and powerful crate!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1356.html">clap-rs/clap#1356</a> on 2018-11-10 02:00</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:32 UTC
    </footer>
</body>
</html>
