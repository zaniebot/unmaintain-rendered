<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create own error message in clap's style - clap-rs/clap #2035</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Create own error message in clap's style</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/2035">#2035</a>
        opened by <a href="https://github.com/LoganDark">@LoganDark</a>
        on 2020-07-25 11:40
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/LoganDark">@LoganDark</a> on 2020-07-25 11:40</div>
            <div class="timeline-body"><h3>Make sure you completed the following tasks</h3>
<ul>
<li>[x] Searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[x] Searched the closed issues</li>
</ul>
<h3>Describe your use case</h3>
<p><code>clap</code> emits its own error messages. They look quite nice, they have color, all that good stuff. Maybe I want to take advantage of this feature - perhaps instead of using <code>panic!</code>, or manually emitting a message to stderr and then exiting, I want to emit an error message that matches the ones <code>clap</code> gives.</p>
<p>The main reason for this is <strong>consistency</strong>. When your error message looks different from <code>clap</code>'s, it kind of feels weird to the end user. I've never encountered a utility that has different error messages when parsing arguments than when running the program itself, and it would be weird to make the developer try to <em>mimic <code>clap</code></em> instead of offering them an API for it.</p>
<h3>Describe the solution you'd like</h3>
<p>My use case specifically would benefit from a <code>panic!</code>-like solution that emits an error message of my own choosing and then exits. However, that's a very minimal solution and there are better ones, see below.</p>
<h3>Alternatives, if applicable</h3>
<p>(package names might not be 100% accurate as I'm using file paths)</p>
<p>Really any way to format error messages in the same style as <code>clap</code> would be nice. For example, you could just make <code>clap::output::fmt::Colorizer</code> public. Although, if you do that, you should make <code>clap::parse::errors::start_error</code> public too.</p>
<p>Making these things public would benefit consumers of your API as they'd be able to format their error messages and color their messages the same way as <code>clap</code> does, allowing the application to look more consistent. They could even use the <code>Colorizer</code> for general output.</p>
<p>However, since these things are implementation details at the moment it's possible that yet another solution could be implemented instead, more well-suited to consumers of <code>clap</code>'s API. I could come up with many such solutions, but I think it should be up to the maintainers of <code>clap</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by @LoganDark on 2020-07-25 11:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-07-25 20:43</div>
            <div class="timeline-body"><p>You can create a custom error with <code>Error::with_description</code> (I think better rename it to <code>custom</code>). It doesn't cover coloring though.</p>
<p>I like the proposal, but I think I would wait until after we're done with the refactorings and stuff.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: colorizing</span> added by @CreepySkeleton on 2020-07-25 20:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: errors</span> added by @CreepySkeleton on 2020-07-25 20:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: other</span> added by @CreepySkeleton on 2020-07-25 20:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: postponed</span> added by @CreepySkeleton on 2020-07-25 20:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @CreepySkeleton on 2020-07-25 20:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LoganDark">@LoganDark</a> on 2020-07-25 20:45</div>
            <div class="timeline-body"><blockquote>
<p>I think I would wait until after we're done with the refactorings and stuff.</p>
</blockquote>
<p>That is a reasonable goal, but you are in the process of refactoring, why not make this change while you can? Major version 3 still isn't fully released, so you have more freedom. Once the version 3 API is stabilized, you can't make any more breaking changes (like renaming that method for example).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-07-25 20:55</div>
            <div class="timeline-body"><p>Because it's not yet decided what the colorizer will look like. Once we're settled on that, we can make it public and document.</p>
<p>If you have any alternative solutions, I'm all ears.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2196.html">clap-rs/clap#2196</a> on 2020-10-31 21:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: postponed</span> removed by @pksunkara on 2021-05-26 11:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-11-29 14:37</div>
            <div class="timeline-body"><p>In clap3, we now have a <a href="https://docs.rs/clap/3.0.0-beta.5/clap/struct.App.html#method.error"><code>App::error()</code></a> (added in #2890) which provides the full clap-style error message, including the usage, recommendation for help, and <code>WaitOnError</code> support (#2967), unlike <code>with_description</code>.  It does not provide a smart usage (adapting to your specific command or to your place in a subcommand hierarchy) and it doesn't expose the coloring API to end users (the clap boiler plate does get colored though).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/medwards">@medwards</a> on 2021-12-03 15:22</div>
            <div class="timeline-body"><p>Thanks @epage that works quite nicely for my case at least (not OP).</p>
<p>Small paper-cut for future users: youhave to pre-construct the error or clone their app because once <code>get_matches</code> is called it consumes the entire <code>App</code>.</p>
<pre><code class="language-rust">    let mut app = clap::App::new(&quot;app&quot;)
        .subcommand(
            clap::App::new(&quot;run&quot;)
                .about(&quot;a silly subcommand but makes my app look nice&quot;)
                .arg(clap::Arg::new(&quot;COMMAND&quot;).required(true)),
        );  
    let subcommand_error = app.error(
        clap::ErrorKind::MissingSubcommand,
        &quot;Missing subcommand which wasn't expected. Did you mean 'run'?&quot;,
    );  
    let matches = app.get_matches();
    if let Some(subcommand) = matches.subcommand_matches(&quot;run&quot;) {
        subcommand.value_of(&quot;COMMAND&quot;).expect(&quot;command was not provided&quot;);
    } else {
        subcommand_error.exit();
    } 
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/160.html">epage/clapng#160</a> on 2021-12-06 20:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/168.html">epage/clapng#168</a> on 2021-12-06 20:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-08 20:19</div>
            <div class="timeline-body"><p>I'm going to go ahead and close this out, assuming <code>App::error</code> is sufficient.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2021-12-08 20:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-12-09 00:53</div>
            <div class="timeline-body"><blockquote>
<p>It does not provide a smart usage (adapting to your specific command or to your place in a subcommand hierarchy) and it doesn't expose the coloring API to end users (the clap boiler plate does get colored though).</p>
</blockquote>
<p>Do we want to keep this open to address those 2 issues? Or you want to create new issues to track them?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-09 00:58</div>
            <div class="timeline-body"><p>I'd recommend users opening the issues in response to their usage of <code>App::error</code> so we are collecting more real world use cases and not just us extrapolating what all is needed and making our backlog too big to handle.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:07 UTC
    </footer>
</body>
</html>
