<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clap panics on broken pipe - clap-rs/clap #2659</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Clap panics on broken pipe</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/2659">#2659</a>
        opened by <a href="https://github.com/epage">@epage</a>
        on 2021-08-02 20:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/epage">@epage</a> on 2021-08-02 20:18</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.53.0 (53cb7b09b 2021-06-17)</p>
<h3>Clap Version</h3>
<p>3.0.0-beta.2</p>
<h3>Minimal reproducible code</h3>
<p>Any clap command</p>
<h3>Steps to reproduce the bug with the above code</h3>
<p>Run a clap command with <code>--help | less</code> and quit before it finishes</p>
<h3>Actual Behaviour</h3>
<p>Panics</p>
<h3>Expected Behaviour</h3>
<p>Ignores the broken pipe or passes up a broken pipe error code</p>
<h3>Additional Context</h3>
<p>This was inspired by ripgrep which has to <a href="https://github.com/BurntSushi/ripgrep/blob/9f924ee187d4c62aa6ebe4903d0cfc6507a5adb5/crates/core/args.rs#L1839">re-implement error printing</a> to handle broken pipes correctly.  The window for having a broken pipe is relatively small but its another source of things not quite behaving as we want for user applications.</p>
<p>In clap2, <a href="https://github.com/clap-rs/clap/blob/v2-master/src/errors.rs#L395"><code>Error::exit</code> would swallow the broken pipe on error but paniced on success</a>.</p>
<p>In clap3, we now <a href="https://github.com/clap-rs/clap/blob/master/src/parse/errors.rs#L479">panic on both</a>.</p>
<h3>Debug Output</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @epage on 2021-08-02 20:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../artichoke/artichoke/issues/1301.html">artichoke/artichoke#1301</a> on 2021-08-05 04:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-08-09 01:40</div>
            <div class="timeline-body"><p>@epage With your initial estimation, would fixing this require breaking changes? If no, I would prefer to leave it for after 3.0</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: errors</span> added by @pksunkara on 2021-08-09 01:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">:money_with_wings: $5</span> added by @pksunkara on 2021-08-09 01:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by @pksunkara on 2021-08-09 01:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-08-09 13:43</div>
            <div class="timeline-body"><p>If we were changing exit codes, its murky whether to claim it a breaking change but panic to proper exit, it wouldn't be a breaking change.</p>
<p>There is, however, a regression from v2, so unsure how you want to prioritize that</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-08-09 13:44</div>
            <div class="timeline-body"><p>(though i still think that regression is minor)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-08-09 16:41</div>
            <div class="timeline-body"><p>I think that's okay. Leaving this for after 3.0</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @pksunkara on 2021-08-13 19:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2716.html">clap-rs/clap#2716</a> on 2021-08-18 15:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @pksunkara on 2021-08-18 16:51</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:08 UTC
    </footer>
</body>
</html>
