<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>clap_complete: zsh completion doesn't add conflicts for group - clap-rs/clap #3910</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>clap_complete: zsh completion doesn't add conflicts for group</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/clap-rs/clap/issues/3910">#3910</a>
        opened by <a href="https://github.com/tmccombs">@tmccombs</a>
        on 2022-07-12 07:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/tmccombs">@tmccombs</a> on 2022-07-12 07:59</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.62.0 (a8314ef7d 2022-06-27)</p>
<h3>Clap Version</h3>
<p>3.2.6</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">use clap::*;
use clap_complete::{generate, shell};

fn main() {
    let mut app = Command::new(&quot;test&quot;)
        .group(ArgGroup::new(&quot;gr&quot;).args(&amp;[&quot;a&quot;, &quot;b&quot;]).conflicts_with(&quot;c&quot;))
        .arg(Arg::new(&quot;a&quot;).short('a'))
        .arg(Arg::new(&quot;b&quot;).short('b'))
        .arg(Arg::new(&quot;c&quot;).short('c'))
        .arg(&amp;c);
    app.build();
        
   generate(shell::Zsh, &amp;mut app, app.get_name(), &amp;mut std::io::stdout());
}
</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<p>Run code</p>
<h3>Actual Behaviour</h3>
<p>The zsh completions generated don't account for the conflict between the group and option c.</p>
<h3>Expected Behaviour</h3>
<p>The zsh completions should specify that the options in the group conflict with option c.</p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
<h3>Debug Output</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @tmccombs on 2022-07-12 07:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-completion</span> added by @epage on 2022-07-13 14:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-easy</span> added by @epage on 2022-07-13 14:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kazuminn">@kazuminn</a> on 2024-05-04 14:46</div>
            <div class="timeline-body"><p>Is this problem still unsolved?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../Yamato-Security/hayabusa/pulls/1340.html">Yamato-Security/hayabusa#1340</a> on 2024-05-04 14:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-05-04 16:26</div>
            <div class="timeline-body"><p>With this being open, likely yes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kazuminn">@kazuminn</a> on 2024-05-05 13:50</div>
            <div class="timeline-body"><p>@epage Thanks for your replay.
Could you fix this issue or tell me that how to fix this issue.
Then I can write and contribute some code of the clap_complete.
Do you have an idea of fixing?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-05-06 03:16</div>
            <div class="timeline-body"><p>I am  not a zsh user and do not know its completion system to be able to say how to do this.  I assume tmccombs verified that it supports conflicts but I'm not even sure.  If it doesn't, then this is more likely to just be rejected.</p>
<p>We are looking at changing our completion system which would make it easier to implement these rich features and do it once for all shells.  See #3166.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tmccombs">@tmccombs</a> on 2024-05-06 03:46</div>
            <div class="timeline-body"><p>zsh does support conflicts.</p>
<p>You can see an example of how it is done in the <code>fd</code> zsh completions (which are currently manually maintained), such as <a href="https://github.com/sharkdp/fd/blob/master/contrib/completion/_fd#L91">here</a> where we declare that <code>--list-details</code>  conflicts with the <code>abs-path</code>, <code>null-sep</code>, <code>max-results</code>, and  <code>exec-cmds</code> groups.</p>
<p>Basically, when calling <code>_arguments</code> you put a list of conflicting options or option groups in parenthesis before the name of the option.</p>
<p>From <a href="https://man.archlinux.org/man/zshcompsys.1">zshcompsys(1)</a>:</p>
<blockquote>
<p>Each of the forms above may be preceded by a list in parentheses of option names and argument numbers.  If the given option is on the command line, the options  and  arguments  indicated  in  parentheses  will not be offered.  For example, ‘(-two -three 1)-one:...' completes the option ‘-one'; if this appears on the command line, the options -two and   -three and the first ordinary argument will not be completed after it.
...
Options can be grouped to simplify exclusion lists. A group is introduced with ‘+' followed by a name for the group in the subsequent word. Whole groups can then be referenced in an exclusion list or a group name can be used to disambiguate between two forms of the same option.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kazuminn">@kazuminn</a> on 2024-05-06 06:07</div>
            <div class="timeline-body"><p>I have a panic with OSS hayabusa.</p>
<p>https://github.com/Yamato-Security/hayabusa/pull/1340</p>
<pre><code>thread 'main' panicked at .cargo/registry/src/index.crates.io-6f17d22bba15001f/clap_builder-4.5.2/src/builder/command.rs:3702:21:
Command::get_arg_conflicts_with: The passed arg conflicts with an arg unknown to the cmd
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:34 UTC
    </footer>
</body>
</html>
