<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Layering env, args, and config - clap-rs/clap #3113</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Layering env, args, and config</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/clap-rs/clap/issues/3113">#3113</a>
        opened by <a href="https://github.com/epage">@epage</a>
        on 2021-12-09 16:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/epage">@epage</a> on 2021-12-09 16:10</div>
            <div class="timeline-body"><p>Maintainer's note</p>
<ul>
<li>https://github.com/clap-rs/clap/discussions/2763</li>
<li>#748</li>
</ul>
<hr />
<p><a href="https://github.com/synek317"><img src="https://avatars.githubusercontent.com/u/1183738?v=4" align="left" width="96" height="96" hspace="10"></img></a> <strong>Issue by <a href="https://github.com/synek317">synek317</a></strong>
<em>Monday Feb 19, 2018 at 10:02 GMT</em>
<em>Originally opened as https://github.com/TeXitoi/structopt/issues/72</em></p>
<hr />
<p>There is great <a href="https://github.com/mehcode/config-rs">config-rs</a>  crate that provides hierarchical configuration and deserialization into struct. I think it would be great if clap / structopt could handle feature like this. With this, one can handle app configuration that can be provided in multiple config files and/or command line all in one place and with single structure.</p>
<p>I suggest to add <code>from_opts_and_config</code> function that would accept <code>Config</code> instance (from config-rs) that would provide defaults when argument is not passed in command line.</p>
<p>I think that it is a best way because only structopt has full knowledge if and what arguments has been passed and which are mandatory and what should be default value if arg is not passed. Config crate requires that all values are defined, otherwise deserialization returns <code>Err</code>.</p>
<p>Of course config-rs dependency should be configurable with features.</p>
<p>If you think it is a good idea, I could prepare some implementation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-09 16:10</div>
            <div class="timeline-body"><p><a href="https://github.com/TeXitoi"><img src="https://avatars.githubusercontent.com/u/5787066?v=4" align="left" width="48" height="48" hspace="10"></img></a> <strong>Comment by <a href="https://github.com/TeXitoi">TeXitoi</a></strong>
<em>Monday Feb 19, 2018 at 13:40 GMT</em></p>
<hr />
<p>You might be interested in https://github.com/TeXitoi/structopt/issues/32</p>
<p>StructOpt is just a wrapper above clap. Looking at your proposition, it seems better to include this functionality directly in clap. But you may have some arguments to do it in structopt.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-09 16:10</div>
            <div class="timeline-body"><p><a href="https://github.com/synek317"><img src="https://avatars.githubusercontent.com/u/1183738?v=4" align="left" width="48" height="48" hspace="10"></img></a> <strong>Comment by <a href="https://github.com/synek317">synek317</a></strong>
<em>Monday Feb 19, 2018 at 13:46 GMT</em></p>
<hr />
<p>I have done a sketch implementation and it is very simple to use config-rs in StructOpt. However, that is not really a great argument.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-09 16:10</div>
            <div class="timeline-body"><p><a href="https://github.com/TeXitoi"><img src="https://avatars.githubusercontent.com/u/5787066?v=4" align="left" width="48" height="48" hspace="10"></img></a> <strong>Comment by <a href="https://github.com/TeXitoi">TeXitoi</a></strong>
<em>Monday Feb 19, 2018 at 13:59 GMT</em></p>
<hr />
<p>You can point to a branch, and I'll look a it to seen what is your idea.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-09 16:10</div>
            <div class="timeline-body"><p><a href="https://github.com/TeXitoi"><img src="https://avatars.githubusercontent.com/u/5787066?v=4" align="left" width="48" height="48" hspace="10"></img></a> <strong>Comment by <a href="https://github.com/TeXitoi">TeXitoi</a></strong>
<em>Wednesday Feb 21, 2018 at 14:53 GMT</em></p>
<hr />
<p>@synek317 ping</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-09 16:10</div>
            <div class="timeline-body"><p><a href="https://github.com/synek317"><img src="https://avatars.githubusercontent.com/u/1183738?v=4" align="left" width="48" height="48" hspace="10"></img></a> <strong>Comment by <a href="https://github.com/synek317">synek317</a></strong>
<em>Friday Feb 23, 2018 at 16:42 GMT</em></p>
<hr />
<p>After some tries I think that there is a better way to solve this. Clap has 'default_value' attrs. If it could be 'default_value_fn' then merging config from file(s) with command line args could be done by 3rd party lib.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-09 16:10</div>
            <div class="timeline-body"><p><a href="https://github.com/synek317"><img src="https://avatars.githubusercontent.com/u/1183738?v=4" align="left" width="48" height="48" hspace="10"></img></a> <strong>Comment by <a href="https://github.com/synek317">synek317</a></strong>
<em>Monday Mar 05, 2018 at 04:50 GMT</em></p>
<hr />
<p>@TeXitoi Could you please take a look at my solution sketch at https://www.reddit.com/r/rust/comments/81tp16/wip_platformconfig_multisource_configuration_for/ ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3124.html">clap-rs/clap#3124</a> on 2021-12-09 16:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Feature-gated config-rs handling" to "Config layering" by @epage on 2021-12-09 16:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @epage on 2021-12-09 16:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-09 16:35</div>
            <div class="timeline-body"><p>See also https://github.com/clap-rs/clap/discussions/2763</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Config layering" to "Layering env, args, and config" by @epage on 2021-12-10 19:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-parsing</span> added by @epage on 2021-12-13 22:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> added by @epage on 2021-12-13 22:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/748.html">clap-rs/clap#748</a> on 2021-12-14 15:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../mintlayer/mintlayer-core/pulls/277.html">mintlayer/mintlayer-core#277</a> on 2022-07-14 20:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5099.html">clap-rs/clap#5099</a> on 2023-08-29 00:15</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:08 UTC
    </footer>
</body>
</html>
