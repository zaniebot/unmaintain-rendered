<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No default_value_os for reliably specifying filesystem paths as default arguments - clap-rs/clap #849</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>No default_value_os for reliably specifying filesystem paths as default arguments</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/849">#849</a>
        opened by <a href="https://github.com/ssokolow">@ssokolow</a>
        on 2017-02-12 00:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ssokolow">@ssokolow</a> on 2017-02-12 00:43</div>
            <div class="timeline-body"><h3>Affected Version of clap</h3>
<p>2.20.3</p>
<h3>Expected Behavior Summary</h3>
<p>Functions like <code>validator_os</code> and <code>value_of_os</code> should be complemented with a <code>default_value_os</code>.</p>
<h3>Actual Behavior Summary</h3>
<p>Only <code>default_value</code> and its variants are provided... which means that it's not possible to specify all valid paths as default values.</p>
<h3>Sample Code or Link to Sample Code</h3>
<pre><code class="language-rust">// env::current_dir is fallible and default_value can't take a callback for lazy eval, so
// resort to &quot;.&quot; but future-proof it in case of esoteric platforms.
// (Not perfect, but to_string_lossy() is necessary without a `default_value_os`)
let lazy_currdir = &amp;Component::CurDir.as_os_str().to_string_lossy();

let matches = App::new(env!(&quot;CARGO_PKG_NAME&quot;))
    .version(crate_version!())
    // .about(&quot;Description text here&quot;)
    // TODO: Add args to control slog logging level
    .arg(arg::with_name(&quot;inpath&quot;)
        .help(&quot;file(s) to use as input&quot;)
        .multiple(true)
        .empty_values(false)
        .default_value(lazy_currdir)
        // .validator_os(validators::path_readable)
        .required(true))
    .get_matches();
</code></pre>
<p>(It's an excerpt from the &quot;new project&quot; boilerplate I'm putting together)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-02-12 14:55</div>
            <div class="timeline-body"><p>While I agree there <em>could</em> be a <code>default_value_os</code> and I'm not opposed to adding it, do you actually need to add a path with invalid UTF-8? I know it's possible, but that doesn't mean it's practical. I'm asking for my own curiosity :wink:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: args</span> added by @kbknapp on 2017-02-12 14:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by @kbknapp on 2017-02-12 14:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> added by @kbknapp on 2017-02-12 14:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by @kbknapp on 2017-02-12 14:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @kbknapp on 2017-02-12 14:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "2.21.0" by @kbknapp on 2017-02-12 14:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ssokolow">@ssokolow</a> on 2017-02-12 18:38</div>
            <div class="timeline-body"><p>At the moment, it's more a matter of wanting correctness in how I glue the &quot;get me the current directory&quot; APIs to clap and wanting the APIs I deal with to be complete.</p>
<p>However, there is actually a set of situations where I expect this to be a problem. Some of the projects I have on hold (currently partially prototyped in old Python code using <code>optparse</code>) embed a shell in a way where default values can get very dynamic... and I intend to use them on folders where round-tripping through different distros over the years has not been kind.</p>
<p>(ie. Folders full of files with Japanese filenames names so <a href="https://en.wikipedia.org/wiki/Mojibake">mojibake</a>'d that they're not even valid UTF-8)</p>
<p>As-is, to play it safe in those projects, I'll be setting a dummy default value (probably <code>\0</code>) and then reinventing defaulting using <code>match</code> if I don't have <code>default_value_os</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @homu on 2017-02-21 04:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ssokolow">@ssokolow</a> on 2017-04-06 22:01</div>
            <div class="timeline-body"><p>I finally got around to looking at this and it seems you implemented <code>default_value_if_os</code> and <code>default_value_ifs_os</code> but, despite the commit message saying it should be there, you neglected to implement <code>default_value_os</code>.</p>
<p>I can't find any evidence of it in the diff and here are the search results from locally-built docs for clap 2.23.1:
<img src="https://cloud.githubusercontent.com/assets/46915/24777353/f7c35a76-1af2-11e7-9edc-738e08d8b7f4.png" alt="2017-04-06-180023_956x248_scrot" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-04-06 22:07</div>
            <div class="timeline-body"><p>Oh wow!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @kbknapp on 2017-04-06 22:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-04-06 22:08</div>
            <div class="timeline-body"><p>Thanks for letting me know, I'll get this added shortly!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/941.html">clap-rs/clap#941</a> on 2017-04-24 19:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @homu on 2017-05-05 00:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:31 UTC
    </footer>
</body>
</html>
