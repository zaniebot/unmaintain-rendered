<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`min_values` when using Parser not respected - clap-rs/clap #3259</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`min_values` when using Parser not respected</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/3259">#3259</a>
        opened by <a href="https://github.com/jarrodsfarrell">@jarrodsfarrell</a>
        on 2022-01-05 00:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jarrodsfarrell">@jarrodsfarrell</a> on 2022-01-05 00:07</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.57.0 (f1edd0429 2021-11-29)</p>
<h3>Clap Version</h3>
<p>3.0.4</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-toml">[dependencies.clap]
version = &quot;3.0.1&quot;
features = [&quot;derive&quot;]
</code></pre>
<pre><code class="language-rust">use clap::{App, Parser};

#[derive(Parser, Debug)]
struct Args {
    #[clap(short, min_values = 1)]
    test: Vec&lt;String&gt;,
}
fn main() {
    let args = Args::parse();
    println!(&quot;{:#?}&quot;, args);
}
</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<p><em>No arguments</em></p>
<h3>Actual Behaviour</h3>
<p>App executes, no error.</p>
<h3>Expected Behaviour</h3>
<p>An error should occur since there are not enough values for <code>--test</code></p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
<h3>Debug Output</h3>
<pre><code>    Finished dev [unoptimized + debuginfo] target(s) in 0.02s
     Running `target/debug/clap-test`
[            clap::build::app]  App::_do_parse
[            clap::build::app]  App::_build
[            clap::build::app]  App::_propagate:clap-test
[            clap::build::app]  App::_check_help_and_version
[            clap::build::app]  App::_check_help_and_version: Removing generated version
[            clap::build::app]  App::_propagate_global_args:clap-test
[            clap::build::app]  App::_derive_display_order:clap-test
[clap::build::app::debug_asserts]       App::_debug_asserts
[clap::build::arg::debug_asserts]       Arg::_debug_asserts:help
[clap::build::arg::debug_asserts]       Arg::_debug_asserts:test
[         clap::parse::parser]  Parser::get_matches_with
[         clap::parse::parser]  Parser::_build
[         clap::parse::parser]  Parser::_verify_positionals
[      clap::parse::validator]  Validator::validate
[         clap::parse::parser]  Parser::add_defaults
[         clap::parse::parser]  Parser::add_defaults:iter:test:
[         clap::parse::parser]  Parser::add_value: doesn't have conditional defaults
[         clap::parse::parser]  Parser::add_value:iter:test: doesn't have default vals
[         clap::parse::parser]  Parser::add_value:iter:test: doesn't have default missing vals
[      clap::parse::validator]  Validator::validate_conflicts
[      clap::parse::validator]  Validator::validate_exclusive
[      clap::parse::validator]  Validator::validate_required: required=ChildGraph([])
[      clap::parse::validator]  Validator::gather_requirements
[      clap::parse::validator]  Validator::validate_required_unless
[      clap::parse::validator]  Validator::validate_matched_args
[    clap::parse::arg_matcher]  ArgMatcher::get_global_values: global_arg_vec=[help]
Args {
    test: [],
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @jarrodsfarrell on 2022-01-05 00:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jarrodsfarrell">@jarrodsfarrell</a> on 2022-01-05 00:11</div>
            <div class="timeline-body"><p><code>max_values</code> seems to be okay.</p>
<pre><code class="language-rs">use clap::Parser;

#[derive(Parser, Debug)]
struct Args {
    #[clap(short, max_values = 2)]
    test: Vec&lt;String&gt;,
}
fn main() {
    let args = Args::parse();
    println!(&quot;{:#?}&quot;, args);
}
</code></pre>
<p><code>cargo run -- -t too -t many -t bees</code></p>
<pre><code>[...]
error: The value 'bees' was provided to '-t &lt;TEST&gt;...' but it wasn't expecting any more values
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jarrodsfarrell">@jarrodsfarrell</a> on 2022-01-05 00:17</div>
            <div class="timeline-body"><p>Turns out to make it work <em>correctly</em> is having a <code>required = true</code> as well. So <code>min_value</code> needs to inherently be required as well.</p>
<pre><code class="language-rs">use clap::Parser;

#[derive(Parser, Debug)]
struct Args {
    #[clap(short, min_values = 2, required = true)]
    test: Vec&lt;String&gt;,
}
fn main() {
    let args = Args::parse();
    println!(&quot;{:#?}&quot;, args);
}
</code></pre>
<p><code>.. -t need</code> Errors correctly
<code>.. -t need -t bees</code> Program runs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jarrodsfarrell">@jarrodsfarrell</a> on 2022-01-05 01:21</div>
            <div class="timeline-body"><p>Actually this might be of design; I can figure a reason why someone would need to not require an arg's <code>Vec&lt;T&gt;</code> to contain values when not given but when it <em>is</em> given then it must have <code>X</code> values of some kind.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-01-05 01:24</div>
            <div class="timeline-body"><p>Currently, we only do min/max value checks against present arguments.</p>
<p>I think keeping it that way makes sense but a caveat should be added to the documentation.</p>
<p><code>min_values</code> does imply <code>multiple_values</code> and they are assumed to be used together.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-docs</span> added by @epage on 2022-01-05 01:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-easy</span> added by @epage on 2022-01-05 01:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AndreasBackx">@AndreasBackx</a> on 2022-05-14 01:28</div>
            <div class="timeline-body"><p>@epage What about making <code>min_values(1)</code> implicitly specify <code>required(true)</code> and <code>min_values(0)</code> implicitly specify <code>required(false)</code> with a note in the documentation so these human errors are prevented without hopefully a trip to the documentation?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-05-14 02:39</div>
            <div class="timeline-body"><p>Any changes along those lines would be a breaking change which won't happen until 4.0 at least but I am hoping to change a lot about how validation works in 4.0 between https://github.com/clap-rs/clap/issues/2688 and https://github.com/clap-rs/clap/discussions/3476.  I expect the only value count function that will exist will be for the number of values per occurrence and everything else will be handled through plugins, whether included with clap or written by end users.  My hope is we'll be at a point where those plugins can opt arguments into being required or not, so that type of implication can be done.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3728.html">clap-rs/clap#3728</a> on 2022-05-14 17:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2022-05-16 13:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:08 UTC
    </footer>
</body>
</html>
