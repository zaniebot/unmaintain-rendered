```yaml
number: 3422
title: Create a dedicated documentation section on StructOpt migration
type: issue
state: closed
author: nyurik
labels:
  - C-enhancement
assignees: []
created_at: 2022-02-08T20:34:09Z
updated_at: 2024-01-22T14:50:08Z
url: https://github.com/clap-rs/clap/issues/3422
synced_at: 2026-01-10T01:57:47Z
```

# Create a dedicated documentation section on StructOpt migration

---

_Issue opened by @nyurik on 2022-02-08 20:34_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Clap Version

3.0.14

### Describe your use case

Clap has great documentation, but for those migrating from structopt it might be a bit challenging to find all the relevant bits between FAQ, Release notes, and other sources.  I have looked at them, including discussions, and they tend to have many unrelated v2->v3 and other details. Release notes tend to get burred over time, especially when not linked directly. Structopt users will always have an unchanged version of structopt (as it is no longer updated) that needs to be migrated. Thanks!

### Describe the solution you'd like

Please add a dedicated structopt section to the documentation page that succinctly gives minimum required steps to migrate latest structopt usage to clap v3 (or whatever the latest would be).

### Alternatives, if applicable

_No response_

### Additional Context

_No response_

---

_Label `C-enhancement` added by @nyurik on 2022-02-08 20:34_

---

_Comment by @epage on 2022-02-08 21:17_

Leaving aside the release notes being buried over time, what were you finding lacking in our [migration guide](https://github.com/clap-rs/clap/blob/master/CHANGELOG.md#migrating)?
- You mentioned v2->v3 migration but that is necessary because you have to do them together

---

_Comment by @nyurik on 2022-02-08 21:59_

@epage I understand that clap migrated v2->v3 and as part of that migration introduced structopt-like functionality (yay!!). My point is that many users who use structopt would not be aware of this migration due to never using clap directly.  I just did a (small) migration, and would have found the following information useful. This is by no means complete guide, but I have had to research some of them in several places, so might be useful to others, perhaps as a two column table.

# StructOpt Migration Guide
* In `Cargo.toml`, replace `structopt = "0.3.26"` dependency with `clap = { version = "3.0.14", features = ["derive"] }`
* Replace `use structopt::StructOpt;` with `use clap::Parser as StructOpt;`, or replace all `#[derive(StructOpt)]` usages with `#[derive(Parser)]`
* [Optional] Replace `#[structopt(...)]` with `#[clap(...)]`  (TBD: I have no idea why both still work, and if its intentional)
* Replace `Opt::from_args()` with `Opt::parse()`, where `Opt` is the top level options struct.
* Remove `arg_enum! { enum { ... } }` wrapper, replacing it with `#[derive(ArgEnum)] enum { ... }`. At the enum usage in a struct, remove `possible_values` and `case_insensitive` `structopt` params, and use `#[clap(arg_enum)]` instead.

---

_Comment by @epage on 2022-02-08 23:23_

> My point is that many users who use structopt would not be aware of this migration due to never using clap directly.

Yes, aside from the question on where it should live or how to discover it, I was trying to understand what you found lacking in our existing migration guide because you alluded to several problems with it.

>  (TBD: I have no idea why both still work, and if its intentional)

We tried to favor deprecations over hard breaking changes:
- `StructOpt` is an alias for `Parser`
- - `#[structopt]` maps to `#[clap]`
- `Parser` also includes `from_args`.
- `arg_enum!` still exists


---

_Referenced in [TeXitoi/structopt#524](../../TeXitoi/structopt/pulls/524.md) on 2022-02-08 23:35_

---

_Comment by @epage on 2022-02-08 23:41_

I have added a link to our migration guide to our FAQ and have opened a PR to add a link from structopt's README.

---

_Comment by @nyurik on 2022-02-09 00:19_

> > My point is that many users who use structopt would not be aware of this migration due to never using clap directly.
> 
> Yes, aside from the question on where it should live or how to discover it, I was trying to understand what you found lacking in our existing migration guide because you alluded to several problems with it.

I think my biggest concern with it is that it is in the release notes vs readme, and so it won't be maintained as an ongoing documentation in a single location. Clap will certainly change with time, but people may decided to migrate from their existing well-working StructOpts at any time, possibly in some future when release notes won't be as up to date.

> 
> > (TBD: I have no idea why both still work, and if its intentional)
> 
> We tried to favor deprecations over hard breaking changes:
> 
> * `StructOpt` is an alias for `Parser`
> * * `#[structopt]` maps to `#[clap]`
> * `Parser` also includes `from_args`.
> * `arg_enum!` still exists

My IDE shows deprecations as crossed-out, so I changed them right away and thought it would be a good idea to include them in the migration guide. I think migration should be done towards the non-deprecated features so as not to revisit them again soon.

Once again, thanks for all the hard work, absolutely love the project, just trying to help newcomers get started quicker :)

---

_Comment by @epage on 2022-02-09 00:37_

> I think my biggest concern with it is that it is in the release notes vs readme, and so it won't be maintained as an ongoing documentation in a single location. Clap will certainly change with time, but people may decided to migrate from their existing well-working StructOpts at any time, possibly in some future when release notes won't be as up to date.

I was thinking about this and I think it shouldn't be a living document.  As we diverge further from clap2, the worse it will be both for the user and for us to document.  We also then have to decide at what point in the long tail we cut people off and stop updating it.  Instead, I think its best for people to migrate to clap v3 first and then to any future version.

> My IDE shows deprecations as crossed-out, so I changed them right away and thought it would be a good idea to include them in the migration guide. I think migration should be done towards the non-deprecated features so as not to revisit them again soon.

It was a very intentional choice to leave deprecations to the end and more as a foot note.  There are a lot of subtle behavior changes and we wanted the user to focus on those and not all of the mechanical changes.

---

_Comment by @epage on 2022-02-09 15:29_

As we have a dedicated migration guide, written to accomplish specific goals, and it is now more discoverable, I'm going to go ahead and close this.

---

_Closed by @epage on 2022-02-09 15:29_

---

_Comment by @dmitris on 2023-01-30 13:16_

to note the "structopt migration guide" link on https://docs.rs/clap/4.1.4/clap/_faq/index.html#how-does-clap-compare-to-structopt pointing to https://docs.rs/clap/4.1.4/clap/CHANGELOG.md#migrate-structopt is bad/stale ("The requested resource does not exist").  Do you know the current location, by any chance? /cc @epage 

---

_Comment by @epage on 2023-01-30 13:43_

See https://github.com/clap-rs/clap/blob/v3-master/CHANGELOG.md#migrating

Looks like we link to it from structopt's [pinned issue](https://github.com/TeXitoi/structopt/issues/525) and the [README](https://github.com/TeXitoi/structopt) but not [docs.rs](https://docs.rs/structopt/latest/structopt/).  That would be a worthwhile improvement.

---

_Comment by @Croug on 2024-01-04 18:59_

I wanted to mention that https://docs.rs/clap/latest/clap/_faq/index.html#how-does-clap-compare-to-structopt still gives bad resource when trying to click on the link to the migration guide, I believe this should be resolved as the faq is always in the first couple links when trying to find information around migrating from structopt to clap derive.

---

_Comment by @epage on 2024-01-04 19:12_

... wow they clearly said the link was bad and I somehow overlooked that.  The link should be fixed in 4.4.13

---

_Comment by @Croug on 2024-01-04 19:14_

Happens to the best of us ðŸ˜‚, thanks for the quick response!

---

_Comment by @RReverser on 2024-01-22 00:12_

FWIW the "Documentation parity" link on https://docs.rs/clap/latest/clap/_faq/index.html#how-does-clap-compare-to-structopt is still broken.

---

_Comment by @epage on 2024-01-22 14:50_

Missed that one.  Not as needed anymore, so I removed it.

---
