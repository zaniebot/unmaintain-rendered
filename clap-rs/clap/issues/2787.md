```yaml
number: 2787
title: Missing trailing newline on error with disabled help flag and subcommand
type: issue
state: closed
author: jonathanmorley
labels:
  - C-bug
  - A-help
  - ":money_with_wings: $5"
assignees: []
created_at: 2021-09-24T16:14:18Z
updated_at: 2021-12-13T20:15:25Z
url: https://github.com/clap-rs/clap/issues/2787
synced_at: 2026-01-10T01:57:45Z
```

# Missing trailing newline on error with disabled help flag and subcommand

---

_Issue opened by @jonathanmorley on 2021-09-24 16:14_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the existing issues

### Rust Version

1.54.0

### Clap Version

master

### Minimal reproducible code

```rust
fn main() {
    let app = App::new("foo")
        .subcommand(App::new("sub"))
        .setting(AppSettings::DisableHelpFlag)
        .setting(AppSettings::DisableHelpSubcommand);
}
```


### Steps to reproduce the bug with the above code

cargo run -- help

### Actual Behaviour

The help message does not contain a trailing newline

### Expected Behaviour

The help message should contain a trailing newline

### Additional Context

https://github.com/clap-rs/clap/pull/2786/files#r715734272

### Debug Output

_No response_

---

_Label `T: bug` added by @jonathanmorley on 2021-09-24 16:14_

---

_Referenced in [clap-rs/clap#2786](../../clap-rs/clap/pulls/2786.md) on 2021-09-24 16:14_

---

_Label `:money_with_wings: $5` added by @pksunkara on 2021-09-24 19:18_

---

_Label `C: help message` added by @pksunkara on 2021-09-24 19:18_

---

_Label `D: easy` added by @pksunkara on 2021-09-24 19:18_

---

_Referenced in [epage/clapng#208](../../epage/clapng/issues/208.md) on 2021-12-06 22:13_

---

_Renamed from "Missing trailing newline on help with disabled flag and subcommand" to "Missing trailing newline on error with disabled flag and subcommand" by @epage on 2021-12-13 18:17_

---

_Renamed from "Missing trailing newline on error with disabled flag and subcommand" to "Missing trailing newline on error with disabled help flag and subcommand" by @epage on 2021-12-13 18:18_

---

_Comment by @epage on 2021-12-13 18:30_

The problem is in `src/parser/error.rs`.  Instead of the code focusing only on leading or trailing newlines for each section, it mixes them.  `usage` and `try_help` use leading newlines **but** `try_help` also uses a trailing newline, if its used.

As a short term solution, we could add an `else` clause in `try_help` that adds a trailing newline.  Ideally, we'd better organize this so it was more predictable of what happens.

---

_Referenced in [clap-rs/clap#3168](../../clap-rs/clap/pulls/3168.md) on 2021-12-13 19:20_

---

_Closed by @epage on 2021-12-13 20:15_

---
