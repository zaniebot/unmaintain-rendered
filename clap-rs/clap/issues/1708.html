<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confusingly bad error message when an option with mutiple values is followed by a subcommand with it's own values - clap-rs/clap #1708</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Confusingly bad error message when an option with mutiple values is followed by a subcommand with it&#x27;s own values</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1708">#1708</a>
        opened by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a>
        on 2020-02-29 09:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/CreepySkeleton">@CreepySkeleton</a></div>
            <div class="timeline-body">

Rust Version
<p><code>1.41.0</code></p>
Affected Version of <code>clap*</code>
<p><code>master</code></p>
Code
<pre><code>use clap::Clap;

#[derive(Clap, Debug)]
struct Opts {
    #[clap(subcommand)]
    sub: Subcommands,

    #[clap(long, required = true)]
    files: Vec&lt;String&gt;,
}

#[derive(Clap, Debug)]
enum Subcommands {
    Foo {
        #[clap(long)]
        option_for_subcommand: bool
    }
}

fn main() {
    let opt = Opts::parse();
    println!(&quot;{:#?}&quot;, opt);
}
</code></pre>
Steps to reproduce
<p><code>cargo run -- --files file1 file2 foo --option-for-subcommand</code></p>
Actual Behavior Summary
<pre><code>error: Found argument &#x27;--option-for-subcommand&#x27; which wasn&#x27;t expected, or isn&#x27;t valid in this context
If you tried to supply `--option-for-subcommand` as a PATTERN use `-- --option-for-subcommand`

USAGE:
    lucid.exe --files &lt;files&gt;... &lt;SUBCOMMAND&gt;

For more information try --help
error: process didn&#x27;t exit successfully: `target\debug\lucid.exe --files file1 file2 subcommand --option-for-subcommand` (exit code: 2)
</code></pre>
Expected Behavior Summary
<p>Something like</p>
<pre><code>error: Found argument &#x27;--option-for-subcommand&#x27; which wasn&#x27;t expected, or isn&#x27;t valid in this context

Hint: an option taking multiple values (--files) is seemingly followed by a subcommand (foo) 
which is not allowed. CLI parser is confused and doesn&#x27;t know where the values end 
and where the subcommand starts.

USAGE:
    lucid.exe --files &lt;files&gt;... &lt;SUBCOMMAND&gt;

For more information try --help
error: process didn&#x27;t exit successfully: `target\debug\lucid.exe --files file1 file2 subcommand --option-for-subcommand` (exit code: 2)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-29 09:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: help message</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-29 09:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: options</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-29 09:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: subcommands</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-29 09:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#1721</a> on 2020-03-04 16:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#1722</a> on 2020-03-04 17:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>TeXitoi/structopt#367</a> on 2020-03-31 12:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;3.1&quot; by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-09 08:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ldm0">@ldm0</a> on 2020-12-08 15:17</div>
            <div class="timeline-body"><p>Current:</p>
<pre><code>error: Found argument &#x27;--option-for-subcommand&#x27; which wasn&#x27;t expected, or isn&#x27;t valid in this context

        If you tried to supply `--option-for-subcommand` as a value rather than a flag, use `-- --option-for-subcommand`

USAGE:
    rust_test.exe --files &lt;files&gt;... &lt;SUBCOMMAND&gt;

For more information try --help
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ldm0">@ldm0</a> on 2021-08-29 12:07</div>
            <div class="timeline-body"><p>The main reason is that the subcommand is treated as a value. <a href="https://docs.rs/clap/3.0.0-beta.4/clap/enum.AppSettings.html#variant.SubcommandPrecedenceOverArg"><code>AppSettings::SubcommandPrecedenceOverArg</code></a> solves the problem. But it&#x27;s enabled by the developer rather than user. I don&#x27;t think the doing the hinting is reasonable.</p>
<pre><code>use clap::Clap;
use clap::AppSettings;

#[derive(Clap, Debug)]
#[clap(setting=AppSettings::SubcommandPrecedenceOverArg)]
struct Opts {
    #[clap(subcommand)]
    sub: Subcommands,

    #[clap(long, required = true)]
    files: Vec&lt;String&gt;,
}

#[derive(Clap, Debug)]
enum Subcommands {
    Foo {
        #[clap(long)]
        option_for_subcommand: bool
    }
}

fn main() {
    let opt = Opts::parse();
    println!(&quot;{:#?}&quot;, opt);
}

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ldm0">@ldm0</a> on 2021-09-02 13:39</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:57:39 UTC
    </footer>
</body>
</html>
