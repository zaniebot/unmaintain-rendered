```yaml
number: 4274
title: Derive API broken in 4.0.0
type: issue
state: closed
author: rusty-snake
labels:
  - C-bug
assignees: []
created_at: 2022-09-28T19:19:56Z
updated_at: 2022-09-28T19:53:37Z
url: https://github.com/clap-rs/clap/issues/4274
synced_at: 2026-01-10T01:57:47Z
```

# Derive API broken in 4.0.0

---

_Issue opened by @rusty-snake on 2022-09-28 19:19_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Rust Version

rustc 1.64.0 (a55dd71d5 2022-09-19)

### Clap Version

4.0.0

### Minimal reproducible code

Just copy the official example from https://docs.rs/clap/latest/clap/#example:

```rust
use clap::Parser;

/// Simple program to greet a person
#[derive(Parser, Debug)]
#[clap(author, version, about, long_about = None)]
struct Args {
   /// Name of the person to greet
   #[clap(short, long, value_parser)]
   name: String,

   /// Number of times to greet
   #[clap(short, long, value_parser, default_value_t = 1)]
   count: u8,
}

fn main() {
   let args = Args::parse();

   for _ in 0..args.count {
       println!("Hello {}!", args.name)
   }
}
```


### Steps to reproduce the bug with the above code

- `cargo new clap40test`
- copy code into `src/main.rs`
- `cargo add clap -F derive`
- `cargo check`

### Actual Behaviour

```
error: Unknown `#[clap(author)]` attribute (`#[command(author)] exists)
 --> src/main.rs:5:8
  |
5 | #[clap(author, version, about, long_about = None)]
  |        ^^^^^^

error: could not compile `clap40test` due to previous error
```

If I remove `author`, it claims about `version`. And if I remove `version`, it complains about `about` and so on.

### Expected Behaviour

- Official example compiles
- Derive API works

### Additional Context

_No response_

### Debug Output

```
error: Unknown `#[clap(version)]` attribute (`#[command(version)] exists)
 --> src/main.rs:5:8
  |
5 | #[clap(version, about, long_about = None)]
  |        ^^^^^^^

error: could not compile `clap40test` due to previous error
```

---

_Label `C-bug` added by @rusty-snake on 2022-09-28 19:19_

---

_Referenced in [clap-rs/clap#4276](../../clap-rs/clap/pulls/4276.md) on 2022-09-28 19:30_

---

_Comment by @epage on 2022-09-28 19:31_

First, docs.rs hasn't built clap v4 yet so the documentation you linked to is for clap v3.

Second, yes, it is broken.  `clap` attribute is being deprecated and I updated all of the tests to the new attributes without verifying that we still supported `clap`.  This is being fixed in #4276

---

_Closed by @epage on 2022-09-28 19:45_

---

_Comment by @epage on 2022-09-28 19:53_

4.0.1 is now out

---
