<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use serde to serialize-deserialize configs, including yaml - clap-rs/clap #1630</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Use serde to serialize-deserialize configs, including yaml</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1630">#1630</a>
        opened by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a>
        on 2020-01-10 15:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/CreepySkeleton">@CreepySkeleton</a></div>
            <div class="timeline-body"><h3>Summary</h3>
<p>Implement <code>serde::Serialize/Deserialize</code> for <code>clap::App</code> so it could be deserialized not only from a YAML file, but from any other format.</p>
<h3>Motivation</h3>
<p>Currently, yaml supports deserializing only from YAML via <code>App::from_yaml</code>. This restricts users to only the one blessed format, while the layout of <code>clap::App</code> is pretty simple on it's own and can be expressed in many config formats, such as <a href="https://www.json.org/json-en.html">JSON</a>, <a href="https://github.com/toml-lang/toml">TOML</a>, <a href="https://en.wikipedia.org/wiki/Property_list"><code>.plist</code></a> to name a few.</p>
<p>Supporting only the chosen one format is kind of inane nowadays, when we have <code>serde</code>, which   handles the differences between formats in a generic way.</p>
<p>Not to mention a number of <a href="https://github.com/clap-rs/clap/issues/552#issuecomment-572862739">&quot;YAML is too WTF-full format for config files&quot;</a> considerations. Some users (myself included) would happily move to TOML if it was supported out-of-box.</p>
<h3>User experience</h3>
<p>As for users of <code>clap</code> who only interested in YAML, nothing would change. From &quot;user experience&quot; side, there's no actual difference between</p>
<pre><code class="language-rust">let yml = load_yaml!(&quot;file.yml&quot;);
let app = App::from_yaml(&amp;yml);
</code></pre>
<p>and</p>
<pre><code class="language-rust">let config = std::fs::File::open(&quot;file.yml&quot;).expect(&quot;No file.yaml!&quot;);
let app: App = serde_yaml::from_reader(config).unwrap();
</code></pre>
<p>But users interested on other formats, like TOML, JSON, you name it, could really make use of this feature.</p>
<h3>Implementation</h3>
<p>I gave a quick look-over to <code>App</code> and <code>Arg</code> layout and I'm fairly certain that <code>Serialize</code> and <code>Deserialize</code> can be simply <code>derive</code>d.</p>
<h3>Related issues</h3>
<p>#918: Serializing to / deserializing from JSON. @kbknapp agreed this feature would be pretty useful.</p>
<p>#853: use serde_yaml since it provides much more useful error messages.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jonericcook">@jonericcook</a> on 2020-01-18 06:43</div>
            <div class="timeline-body"><p>Would this feature allow for the following behavior?</p>
<p>./examplecli helpdump --json helpdump.json</p>
<p>and/or</p>
<p>./examplecli helpdump --stdout</p>
<p>The helpdump.json and stdout would contain all the information about how to use examplecli, essentially the --help for each command and subcommand with all the descriptions and arg type input.</p>
<p>The reason I ask because I have a handful of rust binaries that use clap and i would like to be able to call, for example, the helpdump command to get a json object that tells me how to interact with the binary so I can programmatically use the binary from another language.</p>
<p>I guess in a nut shell i'm asking for a rust program that uses clap to be able to output a .json file and/or a json string to stdout that describes how to use it so that it (the rust program) can be used by another program just by ingesting the .json/json string.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1337.html">clap-rs/clap#1337</a> on 2020-02-03 11:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: enhancement</span> added by @CreepySkeleton on 2020-02-06 07:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> added by @CreepySkeleton on 2020-02-06 07:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by @CreepySkeleton on 2020-02-06 07:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> removed by @pksunkara on 2020-04-01 18:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-04-11 15:46</div>
            <div class="timeline-body"><p>Maybe we could also merge configuration with the commands, with the configuration in file overwritten by the configuration specified by command arguments?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2447.html">clap-rs/clap#2447</a> on 2021-04-20 15:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/throwaway1037">@throwaway1037</a> on 2021-04-20 17:18</div>
            <div class="timeline-body"><p>I think RON should be supported.</p>
<p>Also, I think DSL support should only cost compile time and be baked into the binary, with no cost at runtime since it's essentially a declarative specification of the command-line arguments for the program. The alternative is reading the file at runtime, and then having to distribute it with the program, which is slower and uses more storage space. I don't know which is the current behaviour.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> removed by @pksunkara on 2021-05-26 10:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/918.html">clap-rs/clap#918</a> on 2021-07-20 17:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/131.html">epage/clapng#131</a> on 2021-12-06 18:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-09 16:13</div>
            <div class="timeline-body"><p>We have decided to deprecate the YAML API.  For more details, see https://github.com/clap-rs/clap/issues/3087.  If there is interest in a YAML API, it will likely be broken out into a <code>clap_yaml</code> and developed independent from the core of clap.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2021-12-09 16:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-wont-fix</span> added by @epage on 2022-01-11 18:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:47:27 UTC
    </footer>
</body>
</html>
