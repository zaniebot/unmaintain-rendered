<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Limit number of occurrences for flag arguments - clap-rs/clap #2520</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Limit number of occurrences for flag arguments</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/2520">#2520</a>
        opened by <a href="https://github.com/reynoldsbd">@reynoldsbd</a>
        on 2021-06-03 15:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/reynoldsbd">@reynoldsbd</a> on 2021-06-03 15:43</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
<h3>Describe your use case</h3>
<p>My application includes a <code>-v</code> flag to control logging verbosity. The user can specify multiple occurrences of the flag, in which case verbosity increases.</p>
<pre><code class="language-rust">let args = App::new(&quot;foo&quot;)
    .arg(
        Arg::with_name(&quot;verbosity&quot;)
            .short(&quot;v&quot;)
            .multiple(true)
    )
    .get_matches();

let log_builder = env_logger::Builder::new();
match args.occurrences_of(&quot;verbosity&quot;) {
    0 =&gt; { log_builder.parse_default_env(); },
    1 =&gt; { log_builder.filter_level(LevelFilter::Info); },
    2 =&gt; { log_builder.filter_level(LevelFilter::Debug); },
    _ =&gt; { log_builder.filter_level(LevelFilter::Trace); },
}
</code></pre>
<p>As written, the user can specify an arbitrary number of <code>-v</code> occurrences, but any occurrences after the third have no effect. However, I am feeling a bit pedantic in this case and would like to prevent the user from specifying more than 3 <code>-v</code>'s.</p>
<h3>Describe the solution you'd like</h3>
<p>It'd be awesome if there were something like <code>Arg::max_occurrences</code> which could be used to specify the maximum number of occurrences.</p>
<pre><code class="language-rust">Arg::with_name(&quot;verbosity&quot;)
    .short(&quot;v&quot;)
    .multiple(true)
    .max_occurrences(3);
</code></pre>
<h3>Alternatives, if applicable</h3>
<p>I can approximate the desired behavior quite closely as follows:</p>
<pre><code class="language-rust">match args.occurrences_of(&quot;verbosity&quot;) {
    0 =&gt; { log_builder.parse_default_env(); },
    1 =&gt; { log_builder.filter_level(LevelFilter::Info); },
    2 =&gt; { log_builder.filter_level(LevelFilter::Debug); },
    3 =&gt; { log_builder.filter_level(LevelFilter::Trace); },
    _ =&gt; {
        eprintln!(&quot;Error: Argument -v specified more than 3 times\n&quot;);
        eprintln!(&quot;{}&quot;, args.usage());
        std::process::exit(1);
    },
}
</code></pre>
<h3>Additional Context</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by @reynoldsbd on 2021-06-03 15:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">:money_with_wings: $10</span> added by @pksunkara on 2021-06-03 19:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: args</span> added by @pksunkara on 2021-06-03 19:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: parsing</span> added by @pksunkara on 2021-06-03 19:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: medium</span> added by @pksunkara on 2021-06-03 19:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/veritem">@veritem</a> on 2021-06-05 21:48</div>
            <div class="timeline-body"><p>@reynoldsbd did you try using</p>
<pre><code class="language-rust">Arg::with_name(&quot;verbosity&quot;)
    .short(&quot;v&quot;)
    .multiple(true)
    .max_values(3);
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/reynoldsbd">@reynoldsbd</a> on 2021-06-08 15:03</div>
            <div class="timeline-body"><p>I did try that. <code>max_values(true)</code> seems to implicitly set <code>takes_value(true)</code>, resulting in my argument being treated as an option rather than a flag.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2543.html">clap-rs/clap#2543</a> on 2021-06-17 00:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @pksunkara on 2021-06-17 18:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:08 UTC
    </footer>
</body>
</html>
