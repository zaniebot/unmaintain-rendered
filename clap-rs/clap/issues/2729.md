```yaml
number: 2729
title: "clap_generate fish: ArgEnum completions not working on toplevel command"
type: issue
state: closed
author: ModProg
labels:
  - C-bug
  - A-completion
  - E-easy
assignees: []
created_at: 2021-08-20T00:44:05Z
updated_at: 2024-08-10T00:39:25Z
url: https://github.com/clap-rs/clap/issues/2729
synced_at: 2026-01-10T01:57:45Z
```

# clap_generate fish: ArgEnum completions not working on toplevel command

---

_Issue opened by @ModProg on 2021-08-20 00:44_

### Rust Version

rustc 1.54.0 (a178d0322 2021-07-26)

### Clap Version

master

### Minimal reproducible code

```rust
use clap::{ArgEnum, Clap, IntoApp};
use clap_generate::generators;

fn main() {
    clap_generate::generate::<generators::Fish, _>(
        &mut App::into_app(),
        "clap-issue",
        &mut std::io::stdout(),
    );
}

#[derive(Clap)]
struct App {
    #[clap(arg_enum)]
    arg: A,
}


#[derive(ArgEnum)]
enum A {
    A,
    B,
}
```


### Steps to reproduce the bug with the above code

`cargo run`

### Actual Behaviour

```sh
complete -c clap-issue -s h -l help -d 'Print help information'
complete -c clap-issue -s V -l version -d 'Print version information'
```

### Expected Behaviour

```sh
complete -c clap-issue -s h -l help -d 'Print help information'
complete -c clap-issue -s V -l version -d 'Print version information'
complete -c clap-issue -r -f -a "a b"
```

### Additional Context

_No response_

### Debug Output

_No response_

---

_Label `T: bug` added by @ModProg on 2021-08-20 00:44_

---

_Comment by @ModProg on 2021-08-20 14:03_

I'll investigate if this also applies to other shells


---

_Comment by @ModProg on 2021-08-20 21:47_

Works in zsh so is only a fish issue

---

_Comment by @epage on 2021-08-23 14:28_

Thanks for reporting this!

---

_Label `C: generator` added by @pksunkara on 2021-08-31 10:53_

---

_Referenced in [clap-rs/clap#3022](../../clap-rs/clap/issues/3022.md) on 2021-11-14 01:52_

---

_Referenced in [clap-rs/clap#1232](../../clap-rs/clap/issues/1232.md) on 2021-11-15 14:31_

---

_Referenced in [epage/clapng#92](../../epage/clapng/issues/92.md) on 2021-12-06 17:34_

---

_Referenced in [epage/clapng#202](../../epage/clapng/issues/202.md) on 2021-12-06 21:21_

---

_Referenced in [epage/clapng#238](../../epage/clapng/issues/238.md) on 2021-12-06 22:24_

---

_Label `E-easy` added by @epage on 2021-12-13 17:38_

---

_Referenced in [clap-rs/clap#3166](../../clap-rs/clap/issues/3166.md) on 2021-12-13 17:55_

---

_Comment by @epage on 2024-08-10 00:39_

As this shouldn't be a problem with rust-native completions, I'm closing this.

To track stabilization, see #3166

---

_Closed by @epage on 2024-08-10 00:39_

---
