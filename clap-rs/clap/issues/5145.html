<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backwards compatibility broken? rustc 1.67.1 clap 4.1.4  (msrv increased without clap version changed) - clap-rs/clap #5145</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Backwards compatibility broken? rustc 1.67.1 clap 4.1.4  (msrv increased without clap version changed)</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/5145">#5145</a>
        opened by <a href="https://github.com/alparty">@alparty</a>
        on 2023-09-28 15:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/alparty">@alparty</a> on 2023-09-28 15:45</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.67.1 (d5a82bbd2 2023-02-07)</p>
<h3>Clap Version</h3>
<p>4.1.4</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">fn main() {}
</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<p>With</p>
<pre><code>rustup toolchain list
1.67-x86_64-unknown-linux-gnu (default)
</code></pre>
<p>Create a new project with cargo new , add clap as dependency to your Cargo.toml file.</p>
<pre><code>[package]
name = &quot;test-proj&quot;
version = &quot;0.1.0&quot;
edition = &quot;2021&quot;

[dependencies]
clap = { version = &quot;4.1&quot;, features = [&quot;derive&quot;, &quot;env&quot;] }
</code></pre>
<p>Now run cargo check:</p>
<h3>Actual Behaviour</h3>
<pre><code>cargo check
    Updating crates.io index
error: package `clap_derive v4.4.2` cannot be built because it requires rustc 1.70.0 or newer, while the currently active rustc version is 1.67.1
Either upgrade to rustc 1.70.0 or newer, or use
cargo update -p clap_derive@4.4.2 --precise ver
where `ver` is the latest version of `clap_derive` supporting rustc 1.67.1
</code></pre>
<h3>Expected Behaviour</h3>
<p>Should check without errors.
When Cargo.toml selects <code>clap = { version = &quot;4.1&quot;, features = [&quot;derive&quot;, &quot;env&quot;] }</code> cargo check should not try to pull clap version 4.4.5.</p>
<h3>Additional Context</h3>
<p>In this project we can't update to a newer toolchain yet, and are stuck with 1.67 for the time being.
I have a hunch this error might actually come from cargo, as after running <code>cargo check</code>and investigating the Cargo.lock  file it seems cargo pulled the latest version of clap and not the one specified in Cargo.toml:</p>
<pre><code class="language-toml">[[package]]
name = &quot;clap&quot;
version = &quot;4.4.5&quot;
source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
checksum = &quot;824956d0dca8334758a5b7f7e50518d66ea319330cbceedcf76905c2f6ab30e3&quot;
dependencies = [
 &quot;clap_builder&quot;,
 &quot;clap_derive&quot;,
]
</code></pre>
<h3>Debug Output</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @alparty on 2023-09-28 15:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-09-28 15:57</div>
            <div class="timeline-body"><p>In the community, MSRV bumps are no generally considered a breaking change.  It is a change in builld environment requirements much like new versions of Rust requiring new Linux kernels, new versions of macOS, etc.</p>
<p>Our <a href="https://github.com/clap-rs/clap/blob/master/CONTRIBUTING.md#compatibility-expectations">documented policy</a> is that we'll reserve MSRV bumps for minor version bumps.  This does not extend to our dependencies as that would require <a href="https://doc.rust-lang.org/nightly/cargo/reference/specifying-dependencies.html#multiple-version-requirements">setting upper bounds on our dependencies</a>.</p>
<p>With stable rust, the main way to deal with this is to <a href="https://doc.rust-lang.org/nightly/cargo/faq.html#why-have-cargolock-in-version-control">commit your lockfile</a> and use <code>cargo update</code> to specify the dependency versions you need (e.g. <code>cargo update -p clap --precise 4.1.0</code>).</p>
<p>We are working on improving this situation <a href="https://github.com/rust-lang/cargo/issues/9930">in cargo</a>.  As of now, you can run <code>cargo +nightly generate-lockfile -Zmsrv-policy</code> to pull in the right dependency versions.  The error messages from this are known to be terrible and the above tracking issue includes tracking the work to improve them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2023-09-28 15:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alparty">@alparty</a> on 2023-09-28 16:10</div>
            <div class="timeline-body"><p>All right, thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5158.html">clap-rs/clap#5158</a> on 2023-10-04 18:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:34 UTC
    </footer>
</body>
</html>
