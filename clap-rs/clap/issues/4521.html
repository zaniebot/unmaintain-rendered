<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow global args in top-level multicall - clap-rs/clap #4521</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow global args in top-level multicall</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/clap-rs/clap/issues/4521">#4521</a>
        opened by <a href="https://github.com/jaskij">@jaskij</a>
        on 2022-11-29 12:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jaskij">@jaskij</a></div>
            <div class="timeline-body">Please complete the following tasks
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
Clap Version
<p>4.0.27</p>
Describe your use case
<p>When writing a multicall program, I have some options that I&#x27;d like to be available to all commands. In addition, to reduce boilerplate, I would like them to be in the top-level struct.</p>
<p>A prime example of this would be log level, which is set once, just after parsing the commandline, before entering a specific subcommand.</p>
Describe the solution you&#x27;d like
<p>This looks good enough - as is, this is rejected by debug asserts.</p>
<pre><code>#[derive(Debug, clap::Parser)]
#[command(multicall(true))]
struct Cli {
    #[command(subcommand)]
    command: Command,

    #[arg(global = true)]
    log_level: LogLevel,
}
</code></pre>
Alternatives, if applicable
<p>A workaround would be to add the log level enum as an option on all subcommands - doable, but seems to require some amount of repetitive code, which is always an issue when it comes to later changes.</p>
<p>The amount of repetition could perhaps be eased by using a declarative macro, but those are somewhat annoying to write and not everyone is comfortable with them.</p>
Additional Context
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by <a href="https://github.com/jaskij">@jaskij</a> on 2022-11-29 12:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-decision</span> added by <a href="https://github.com/epage">@epage</a> on 2022-11-29 12:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-builder</span> added by <a href="https://github.com/epage">@epage</a> on 2022-11-29 12:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-11-29 12:35</div>
            <div class="timeline-body"><p>When I prevented arguments on the multicall command, I was trying to balance</p>
<ul>
<li>Correct parsing behavior (ie disallowing <code>$ --verbose cmd</code>)</li>
<li>Correct <code>$ help</code> behavior (not showing arguments)</li>
<li>Minimal binary size impact<ul>
<li>At the moment, I would classify this a small scope feature (few people would use it) which means we prioritize binary size over conveniences.</li>
</ul>
</li>
</ul>
<p>It would be nice to support global arguments but any solution should maintain the above balance unless we find a reason to re-evaluate our priorities for this feature.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/paulyoung">@paulyoung</a> on 2022-12-05 06:45</div>
            <div class="timeline-body"><p>I’m trying to understand if this is the same as my use case or not, and if my use case is supported even if the one in this issue isn’t.</p>
<p>I have an existing program set up with the derive API that takes 2 positional arguments, e.g. <code>foo a b</code></p>
<p>I’d like to also be able to call this as <code>bar a b</code> and behave differently based on the executable name.</p>
<p>Is this possible when using <code>multicall(true)</code>?</p>
<p>I was only able to get trivial examples like <code>hostname</code> to work but couldn’t figure out how to port what I already have.</p>
<p>It seems like a reasonable thing to support so perhaps I’m overlooking how to do it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-12-05 14:25</div>
            <div class="timeline-body"><p>Yes, this is supported. Could you open a Discussion with more details to figure out what is going on? This issue is specifically for <code>Arg::global</code> which I&#x27;m assuming is unrelated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/paulyoung">@paulyoung</a> on 2022-12-05 17:38</div>
            <div class="timeline-body"><p>I created https://github.com/clap-rs/clap/discussions/4541. Sorry for the confusion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>thin-edge/thin-edge.io#3311</a> on 2025-01-03 13:51</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:59:32 UTC
    </footer>
</body>
</html>
