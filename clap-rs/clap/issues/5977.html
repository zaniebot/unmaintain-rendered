<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unclear relationship between `global` and `required` - clap-rs/clap #5977</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Unclear relationship between <code>global</code> and <code>required</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/clap-rs/clap/issues/5977">#5977</a>
        opened by <a href="https://github.com/mlegner">@mlegner</a>
        on 2025-04-24 14:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mlegner">@mlegner</a></div>
            <div class="timeline-body"><p>It is unclear whether an argument can be marked as <code>global</code> and <code>required</code> simultaneously. There used to be a note &quot;Global arguments <em>cannot</em> be required.&quot; in the docs, which was removed in #1075. There still remains a <a href="https://github.com/clap-rs/clap/blob/183cfe3b011f2f1385a996ee9606289c69189550/clap_builder/src/builder/debug_asserts.rs#L255-L260">debug assertion</a> forbidding the combination.</p>
<p>If an argument is in fact both <code>global</code> and <code>required</code>, it seems that it is expected to be provided at <em>all</em> levels. Consider the following minimal example:</p>
<pre><code>use clap::Parser;

#[derive(Parser)]
struct Cli {
    #[arg(long, global = true)]
    name: String,
    #[command(subcommand)]
    subcommand: Subcommand,
}

#[derive(Parser, Debug)]
enum Subcommand {
    Print,
}

fn main() {
    let cli = Cli::parse();
    println!(&quot;Name: {}&quot;, cli.name);
}
</code></pre>
<p>When running the debug build, this triggers the debug assertion:</p>
<pre><code>$ cargo run -- print                        
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.02s
     Running `target/debug/test-clap print`

thread &#x27;main&#x27; panicked at ~/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/clap_builder-4.5.37/src/builder/debug_asserts.rs:255:9:
Command test-clap: Global arguments cannot be required.

        &#x27;name&#x27; is marked as both global and required
</code></pre>
<p>When running the release build, it requires the <code>name</code> at every level:</p>
<pre><code>$ cargo run --release -- print --name test
    Finished `release` profile [optimized] target(s) in 0.06s
     Running `target/release/test-clap print --name test`
error: the following required arguments were not provided:
  --name &lt;NAME&gt;

Usage: test-clap --name &lt;NAME&gt; &lt;COMMAND&gt;

For more information, try &#x27;--help&#x27;.

$ cargo run --release -- --name test print
    Finished `release` profile [optimized] target(s) in 0.02s
     Running `target/release/test-clap --name test print`
error: the following required arguments were not provided:
  --name &lt;NAME&gt;

Usage: test-clap --name &lt;NAME&gt; print --name &lt;NAME&gt;

For more information, try &#x27;--help&#x27;.

$ cargo run --release -- --name test print --name test
    Finished `release` profile [optimized] target(s) in 0.01s
     Running `target/release/test-clap --name test print --name test`
Name: test
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>MystenLabs/walrus#2003</a> on 2025-04-24 14:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-parsing</span> added by <a href="https://github.com/epage">@epage</a> on 2025-04-24 14:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-validators</span> added by <a href="https://github.com/epage">@epage</a> on 2025-04-24 14:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by <a href="https://github.com/epage">@epage</a> on 2025-04-24 14:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-04-24 14:16</div>
            <div class="timeline-body"><p>Related issues:</p>
<ul>
<li>#5020</li>
<li>#1546</li>
<li>#1204</li>
<li>#6049</li>
<li>#6160</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#6026</a> on 2025-06-09 14:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#6049</a> on 2025-06-27 15:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 20:00:28 UTC
    </footer>
</body>
</html>
