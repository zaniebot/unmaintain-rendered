```yaml
number: 5253
title: Mutual exclusion of groups of args
type: issue
state: open
author: johnrichardrinehart
labels:
  - C-enhancement
assignees: []
created_at: 2023-12-08T23:53:22Z
updated_at: 2025-08-30T13:26:35Z
url: https://github.com/clap-rs/clap/issues/5253
synced_at: 2026-01-10T01:57:49Z
```

# Mutual exclusion of groups of args

---

_Issue opened by @johnrichardrinehart on 2023-12-08 23:53_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Clap Version

4.4.8

### Describe your use case

I'm building an app which compares two commits on a GitHub repo. I want to support users either passing `rev1` and `rev2` for comparison or I want them to be able to pass the `pr` number. So, in terms of `clap` Usage text I'd have something like
```
<--rev1 <REV1> --rev2 <REV2> | --pr <PR>>
```

### Describe the solution you'd like

I'd like to be able to combine `ArgGroup` and `required` statements in such a way as to accomplish the above.

### Alternatives, if applicable

_No response_

### Additional Context

_No response_

---

_Label `C-enhancement` added by @johnrichardrinehart on 2023-12-08 23:53_

---

_Comment by @epage on 2023-12-11 16:44_

I believe this is a duplicate of #5041.  Closing in favor of that.  If there is something I missed, let us know!

---

_Closed by @epage on 2023-12-11 16:44_

---

_Comment by @johnrichardrinehart on 2023-12-16 02:34_

Thanks, @epage . My concern is a bit different than #5041 . My concern is around the generated usage text, not the runtime evaluation of the provided arguments.

---

_Reopened by @epage on 2023-12-17 01:14_

---

_Comment by @epage on 2023-12-17 01:14_

Could you add a minimal reproduction case of the situation you are interested in and contrast the existing behavior with the behavior you would want? 

---

_Comment by @imp on 2025-08-29 09:22_

I think I am hitting the same issue: mutual exclusion works great for a group of args, but doesn't work for a nested group.

See below the code that demonstrates the problem with latest clap (4.5.46 as of this writing).

```Rust
use clap::{Args, CommandFactory, Parser};

#[derive(Debug, Parser)]
struct Cli1 {
    #[command(flatten)]
    arg: ArgGroup,
}

#[derive(Debug, Args)]
#[group(multiple = false, required = true)]
struct ArgGroup {
    #[arg(long)]
    foo: String,
    #[arg(long)]
    bar: String,
}

#[derive(Debug, Parser)]
struct Cli2 {
    #[command(flatten)]
    arg: ArgSuperGroup,
}

#[derive(Debug, Args)]
#[group(multiple = false, required = true)]
struct ArgSuperGroup {
    #[command(flatten)]
    arg1: ArgGroup1,
    #[command(flatten)]
    arg2: ArgGroup2,
}

#[derive(Debug, Args)]
struct ArgGroup1 {
    #[arg(long)]
    foo: String,
    #[arg(long)]
    bar: String,
}

#[derive(Debug, Args)]
struct ArgGroup2 {
    #[arg(long)]
    baz: String,
    #[arg(long)]
    qux: String,
}

fn main() {
    println!("{}", Cli1::command().render_usage());
    println!("{}", Cli2::command().render_usage());
}

```

running it produces:
```
Usage: demo <--foo <FOO>|--bar <BAR>>
Usage: demo --foo <FOO> --bar <BAR> --baz <BAZ> --qux <QUX> <>
```

So for the `Cli1` it groks correctly that `foo` and `bar` args are mutually exclusive parts of the group. However, if I want to have a group of mutually exclusive arguments - that doesn't work.
I.e. I was expecting to get something like

```
Usage: demo <--foo <FOO> --bar <BAR>>|<--baz <BAZ> --qux <QUX>>
```

(Also note there is spurious `<>` at the end of the generated usage text in the second case)


---
