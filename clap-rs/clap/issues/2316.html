<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bash tab completion confused when one subcommand is a prefix of another - clap-rs/clap #2316</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>bash tab completion confused when one subcommand is a prefix of another</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/2316">#2316</a>
        opened by <a href="https://github.com/dkg">@dkg</a>
        on 2021-01-28 19:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dkg">@dkg</a></div>
            <div class="timeline-body">Make sure you completed the following tasks
<ul>
<li>[x] Searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[x] Searched the closed issues</li>
</ul>
Code
<p>Please see <a href="https://gitlab.com/sequoia-pgp/sequoia/">sequoia&#x27;s sq</a> for code.  The problem i&#x27;m reporting is that <code>sq key&lt;TAB&gt;</code> does the wrong thing.</p>
<p>I <a href="https://gitlab.com/sequoia-pgp/sequoia/-/issues/654">reported this concern to sequoia</a> and they indicated that it is a bug in clap&#x27;s bash tab completion.  I describe it in more detail below.</p>
Steps to reproduce the issue
<ol>
<li>build and install <code>sq</code> from the <code>sequoia-sq</code> crate.  <code>sq</code> has two subcommands with the unusual property that one is a prefix of another: <code>key</code> and <code>keyring</code></li>
<li>in bash, run <code>touch keyfoo</code></li>
<li>in bash, type <code>sq k&lt;TAB&gt;</code> and it fills in to <code>sq key</code></li>
<li>now hit <code>&lt;TAB&gt;</code> again.</li>
</ol>
Version
<ul>
<li><strong>Rust</strong>: 1.48.0</li>
<li><strong>Clap</strong>: 2.33.3</li>
</ul>
Actual Behavior Summary
<p><code>sq key&lt;TAB&gt;</code> completes to <code>sq keyfoo</code> because of the local file named <code>keyfoo</code>.</p>
Expected Behavior Summary
<p>It <em>should</em> require <code>sq key&lt;TAB&gt;&lt;TAB&gt;</code> to show a list of two possible subcommands, <code>key</code> and <code>keyring</code></p>
Additional context
<p>I note that the problem might be deeper than just when one subcommand is a prefix of another, though the prefix situation makes it more evident.</p>
<p>For example, <code>sq</code> has another subcommand with no lexical overlap with other subcommands: <code>packet</code>.</p>
<p>If i <code>touch packetfoo</code> and then in bash type <code>sq packet&lt;TAB&gt;</code> (note the lack of trailing whitespace), I&#x27;d expect bash to insert a space (because the subcommand token is complete, so we should move on to generating the next token).  Instead, it autocompletes to <code>sq packetfoo </code>.</p>
<p>This isn&#x27;t likely to happen during normal usage because <code>sq p&lt;TAB&gt;</code> autocompletes to <code>sq packet </code> (note the trailing whitespace) and <code>sq packet &lt;TAB&gt;</code> (again, note the whitespace) actually does the right thing.</p>
Debug output
<p>sorry, i don&#x27;t have debug output for this case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by <a href="https://github.com/dkg">@dkg</a> on 2021-01-28 19:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;3.1&quot; by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-03-09 16:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: generator</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-03-09 16:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">:money_with_wings: $5</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-03-09 16:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>epage/clapng#176</a> on 2021-12-06 20:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;3.1&quot; by <a href="https://github.com/epage">@epage</a> on 2021-12-13 15:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-medium</span> added by <a href="https://github.com/epage">@epage</a> on 2021-12-13 15:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-08-10 00:36</div>
            <div class="timeline-body"><p>As this is not a problem with <code>clap_complete::dynamic</code>, I am going to close this.</p>
<p>To track stabilization, see #3166</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/epage">@epage</a> on 2024-08-10 00:36</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:58:00 UTC
    </footer>
</body>
</html>
