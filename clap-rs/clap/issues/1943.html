<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Placing `--` before a subcommand fails with a confusing error - clap-rs/clap #1943</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Placing <code>--</code> before a subcommand fails with a confusing error</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1943">#1943</a>
        opened by <a href="https://github.com/Demi-Marie">@Demi-Marie</a>
        on 2020-05-26 05:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Demi-Marie">@Demi-Marie</a></div>
            <div class="timeline-body">

Rust Version
<p><code>rustc 1.43.1 (8d69840ab 2020-05-04)</code></p>
Affected Version of clap
<p>2.33.0</p>
Expected Behavior Summary
<p>If <code>x</code> is a subcommand, then <code>./some_binary -- x</code> should give a message stating that <code>--</code> before a subcommand name is not allowed.</p>
Actual Behavior Summary
<p><code>./some_binary -- x</code> suggests that I re-run <code>./some_binary -- x</code>.</p>
Steps to Reproduce the issue
<p>Include <code>--</code> before a subcommand name</p>
Sample Code or Link to Sample Code
<p><a href="https://github.com/paritytech/ledgeracio/tree/39f34590b4ec27c8f8cb2f004931e5f35bf50cbf">This commit of Ledgeracio</a> reproduces the problem when <code>cargo run -- -- stash</code> is run.</p>
Debug output
<p>Compile clap with <code>debug</code> feature:</p>
<pre><code>[dependencies]
clap = { version = &quot;*&quot;, features = [&quot;debug&quot;] }
</code></pre>
<p>The output may be very long, so feel free to link to a gist or attach a text file</p>

 Debug Output 
<pre>
<code>
DEBUG:clap:Parser::add_subcommand: term_w=None, name=show
DEBUG:clap:Parser::add_subcommand: term_w=None, name=status
DEBUG:clap:Parser::add_subcommand: term_w=None, name=claim
DEBUG:clap:Parser::add_subcommand: term_w=None, name=submit-validator-set
DEBUG:clap:Parser::add_subcommand: term_w=None, name=add-controller-key
DEBUG:clap:Parser::add_subcommand: term_w=None, name=stash
DEBUG:clap:Parser::add_subcommand: term_w=None, name=status
DEBUG:clap:Parser::add_subcommand: term_w=None, name=announce
DEBUG:clap:Parser::add_subcommand: term_w=None, name=replace-key
DEBUG:clap:Parser::add_subcommand: term_w=None, name=generate-keys
DEBUG:clap:Parser::add_subcommand: term_w=None, name=validator
DEBUG:clap:Parser::propagate_settings: self=Ledgeracio, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: sc=stash, settings=AppFlags(
    SC_REQUIRED_ELSE_HELP | NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO,
), g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: self=stash, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: sc=show, settings=AppFlags(
    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO,
), g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: self=show, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: sc=status, settings=AppFlags(
    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO,
), g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: self=status, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: sc=claim, settings=AppFlags(
    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO,
), g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: self=claim, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: sc=submit-validator-set, settings=AppFlags(
    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO,
), g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: self=submit-validator-set, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: sc=add-controller-key, settings=AppFlags(
    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO,
), g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: self=add-controller-key, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: sc=validator, settings=AppFlags(
    SC_REQUIRED_ELSE_HELP | NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO,
), g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: self=validator, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: sc=status, settings=AppFlags(
    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO,
), g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: self=status, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: sc=announce, settings=AppFlags(
    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO,
), g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: self=announce, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: sc=replace-key, settings=AppFlags(
    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO,
), g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: self=replace-key, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: sc=generate-keys, settings=AppFlags(
    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO,
), g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: self=generate-keys, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:Parser::create_help_and_version: Building help
DEBUG:clap:Parser::get_matches_with: Begin parsing &#x27;&quot;--&quot;&#x27; ([45, 45])
DEBUG:clap:Parser::is_new_arg:&quot;--&quot;:NotFound
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: -- found
DEBUG:clap:Parser::get_matches_with: setting TrailingVals=true
DEBUG:clap:Parser::get_matches_with: Begin parsing &#x27;&quot;stash&quot;&#x27; ([115, 116, 97, 115, 104])
DEBUG:clap:Parser::is_new_arg:&quot;stash&quot;:NotFound
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: probably value
DEBUG:clap:Parser::is_new_arg: starts_new_arg=false
DEBUG:clap:usage::create_usage_with_title;
DEBUG:clap:usage::create_usage_no_title;
DEBUG:clap:usage::get_required_usage_from: reqs=[], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:usage::needs_flags_tag;
DEBUG:clap:usage::needs_flags_tag:iter: f=dry-run;
DEBUG:clap:Parser::groups_for_arg: name=dry-run
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:usage::needs_flags_tag:iter: [FLAGS] required
DEBUG:clap:usage::create_help_usage: usage=ledgeracio [FLAGS] [OPTIONS] &lt;SUBCOMMAND&gt;
DEBUG:clap:Parser::color;
DEBUG:clap:Parser::color: Color setting...Auto
DEBUG:clap:is_a_tty: stderr=true
DEBUG:clap:Colorizer::error;
DEBUG:clap:Colorizer::warning;
DEBUG:clap:Colorizer::good;
DEBUG:clap:Colorizer::good;
DEBUG:clap:Colorizer::good;

</code>
</pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;3.1&quot; by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-05-26 06:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: usage strings</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-05-26 06:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-05-26 06:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2020-05-26 22:04</div>
            <div class="timeline-body"><p>Upgrading to 3.0-beta.1 provides a better, but still not perfect message:</p>
<pre><code>cargo run -- -- stash
   Compiling ledgeracio v0.1.0 (/home/kevin/.tmp/ledgeracio)
    Finished dev [unoptimized + debuginfo] target(s) in 5.98s
     Running `target/debug/ledgeracio -- stash`
error: Found argument &#x27;stash&#x27; which wasn&#x27;t expected, or isn&#x27;t valid in this context

If you tried to supply `stash` as a PATTERN use `-- stash`

USAGE:
    ledgeracio [FLAGS] [OPTIONS] &lt;SUBCOMMAND&gt;

For more information try --help
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2020-05-26 22:06</div>
            <div class="timeline-body"><p>Basically, we shouldn&#x27;t include this line:</p>
<pre><code>If you tried to supply `stash` as a PATTERN use `-- stash`
</code></pre>
<p>if <code>--</code> was used.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: usage strings</span> removed by <a href="https://github.com/kbknapp">@kbknapp</a> on 2020-05-26 22:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: errors</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2020-05-26 22:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-05-27 00:07</div>
            <div class="timeline-body"><p>And check the first arg after the <code>--</code>. If it&#x27;s a subcommand, show a friendly hint.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ldm0">@ldm0</a> on 2020-10-06 01:09</div>
            <div class="timeline-body"><p>Related: <a href="https://github.com/clap-rs/clap/issues/1744">clap-rs/clap#1744</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#2154</a> on 2020-10-06 12:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#2157</a> on 2020-10-08 02:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/bors[bot]">@bors[bot]</a> on 2020-10-09 17:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:57:49 UTC
    </footer>
</body>
</html>
