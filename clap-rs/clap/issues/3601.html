<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>clap does not understand value with dashes, &quot;prg -k -- -value&quot; - clap-rs/clap #3601</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>clap does not understand value with dashes, &quot;prg -k -- -value&quot;</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/3601">#3601</a>
        opened by <a href="https://github.com/ayrapetovai">@ayrapetovai</a>
        on 2022-04-01 17:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ayrapetovai">@ayrapetovai</a></div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.55.0-nightly (150fad30e 2021-06-19)</p>
<h3>Clap Version</h3>
<p>3.1.8</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">use clap::{Arg, command};

fn main() {
   let matches = command!()
        .arg(Arg::new(&quot;expression&quot;)
            .long(&quot;expression&quot;)
            .short('e')
            .takes_value(true)
        .get_matches();
}
</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<p>cargo run -- -e -1
cargo run -- -e -- '-1'</p>
<h3>Actual Behaviour</h3>
<p>When run app with a key and passing an argument with -- and a '-' prefix ('prg -k -- -1'), clap thinks that the argument is a next key. And prints</p>
<blockquote>
<p>If you tried to supply <code>-1</code> as a value rather than a flag, use <code>-- -1</code>
but I do used <code>-- -1</code>!</p>
</blockquote>
<h3>Expected Behaviour</h3>
<p>clap is expected to think that '-- -1' is one argument &quot;-1&quot;.</p>
<h3>Additional Context</h3>
<p>$ binc -e -- '-1'
error: Found argument '-1' which wasn't expected, or isn't valid in this context</p>
<h3>Debug Output</h3>
<pre><code class="language-text">$ binc -e -- -1
[        clap::build::command] 	App::_do_parse
[        clap::build::command] 	App::_build
[        clap::build::command] 	App::_propagate:binc
[        clap::build::command] 	App::_check_help_and_version: binc
[        clap::build::command] 	App::_check_help_and_version: Removing `-h` from help
[        clap::build::command] 	App::_propagate_global_args:binc
[        clap::build::command] 	App::_derive_display_order:binc
[  clap::build::debug_asserts] 	Command::_debug_asserts
[  clap::build::debug_asserts] 	Arg::_debug_asserts:help
[  clap::build::debug_asserts] 	Arg::_debug_asserts:version
[  clap::build::debug_asserts] 	Arg::_debug_asserts:v
[  clap::build::debug_asserts] 	Arg::_debug_asserts:history
[  clap::build::debug_asserts] 	Arg::_debug_asserts:expression
[  clap::build::debug_asserts] 	Arg::_debug_asserts:format
[  clap::build::debug_asserts] 	Command::_verify_positionals
[         clap::parse::parser] 	Parser::get_matches_with
[         clap::parse::parser] 	Parser::get_matches_with: Begin parsing 'RawOsStr(&quot;-e&quot;)' ([45, 101])
[         clap::parse::parser] 	Parser::get_matches_with: Positional counter...1
[         clap::parse::parser] 	Parser::get_matches_with: Low index multiples...false
[         clap::parse::parser] 	Parser::possible_subcommand: arg=RawOsStr(&quot;-e&quot;)
[         clap::parse::parser] 	Parser::get_matches_with: sc=None
[         clap::parse::parser] 	Parser::parse_short_arg: short_arg=RawOsStr(&quot;e&quot;)
[         clap::parse::parser] 	Parser::parse_short_arg:iter:e
[         clap::parse::parser] 	Parser::parse_short_arg:iter:e: cur_idx:=1
[         clap::parse::parser] 	Parser::parse_short_arg:iter:e: Found valid opt or flag
[         clap::parse::parser] 	Parser::parse_short_arg:iter:e: val=RawOsStr(&quot;&quot;) (bytes), val=[] (ascii), short_arg=RawOsStr(&quot;e&quot;)
[         clap::parse::parser] 	Parser::parse_opt; opt=expression, val=None
[         clap::parse::parser] 	Parser::parse_opt; opt.settings=ArgFlags(TAKES_VAL)
[         clap::parse::parser] 	Parser::parse_opt; Checking for val...
[         clap::parse::parser] 	Parser::parse_opt: More arg vals required...
[         clap::parse::parser] 	Parser::remove_overrides: id=expression
[    clap::parse::arg_matcher] 	ArgMatcher::inc_occurrence_of_arg: id=expression
[        clap::build::command] 	App::groups_for_arg: id=expression
[        clap::build::command] 	App::groups_for_arg: id=expression
[         clap::parse::parser] 	Parser::get_matches_with: After parse_short_arg Opt(expression)
[         clap::parse::parser] 	Parser::get_matches_with: Begin parsing 'RawOsStr(&quot;--&quot;)' ([45, 45])
[         clap::parse::parser] 	Parser::get_matches_with: Positional counter...1
[         clap::parse::parser] 	Parser::get_matches_with: Low index multiples...false
[         clap::parse::parser] 	Parser::parse_long_arg
[         clap::parse::parser] 	Parser::parse_long_arg: cur_idx:=2
[         clap::parse::parser] 	Parser::parse_long_arg: Does it contain '='...
[         clap::parse::parser] 	Parser::get_matches_with: After parse_long_arg NoArg
[         clap::parse::parser] 	Parser::get_matches_with: setting TrailingVals=true
[         clap::parse::parser] 	Parser::get_matches_with: Begin parsing 'RawOsStr(&quot;-1&quot;)' ([45, 49])
[         clap::parse::parser] 	Parser::get_matches_with: Positional counter...1
[         clap::parse::parser] 	Parser::get_matches_with: Low index multiples...false
[         clap::parse::parser] 	Parser::possible_subcommand: arg=RawOsStr(&quot;-1&quot;)
[         clap::output::usage] 	Usage::create_usage_with_title
[         clap::output::usage] 	Usage::create_usage_no_title
[         clap::output::usage] 	Usage::create_help_usage; incl_reqs=true
[         clap::output::usage] 	Usage::get_required_usage_from: incls=[], matcher=false, incl_last=false
[         clap::output::usage] 	Usage::get_required_usage_from: unrolled_reqs={}
[         clap::output::usage] 	Usage::get_required_usage_from: ret_val=[]
[         clap::output::usage] 	Usage::needs_options_tag
[         clap::output::usage] 	Usage::needs_options_tag:iter: f=help
[         clap::output::usage] 	Usage::needs_options_tag:iter Option is built-in
[         clap::output::usage] 	Usage::needs_options_tag:iter: f=version
[         clap::output::usage] 	Usage::needs_options_tag:iter Option is built-in
[         clap::output::usage] 	Usage::needs_options_tag:iter: f=v
[        clap::build::command] 	App::groups_for_arg: id=v
[         clap::output::usage] 	Usage::needs_options_tag:iter: [OPTIONS] required
[         clap::output::usage] 	Usage::create_help_usage: usage=binc [OPTIONS]
[        clap::build::command] 	App::color: Color setting...
[        clap::build::command] 	Auto
error: Found argument '-1' which wasn't expected, or isn't valid in this context

	If you tried to supply `-1` as a value rather than a flag, use `-- -1`

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @ayrapetovai on 2022-04-01 17:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-04-01 17:36</div>
            <div class="timeline-body"><p>Did you try passing <code>arg.allow_hyphen_values(true)</code>
https://docs.rs/clap/latest/clap/struct.Arg.html#method.allow_hyphen_values</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ayrapetovai">@ayrapetovai</a> on 2022-04-02 07:37</div>
            <div class="timeline-body"><p>Thanks for fast reply.<br />
The applying of <code>Arg::allow_hyphen_values(true)</code></p>
<pre><code class="language-rust">Arg::new(&quot;expression&quot;)
  .long(&quot;expression&quot;)
  .short('e')
  .takes_value(true)
  .allow_hyphen_values(true)
</code></pre>
<p>leads to this result</p>
<pre><code>$ binc -e -- -1
error: Found argument '-1' which wasn't expected, or isn't valid in this context

	If you tried to supply `-1` as a value rather than a flag, use `-- -1`

USAGE:
    binc [OPTIONS]

For more information try --help
</code></pre>
<p>The same result as without <code>Arg::allow_hyphen_values(true)</code>. This does not seem an expected behaviour to me. May be I am wrong...</p>
<p>Nevertheless, with <code>Arg::allow_hyphen_values(true)</code> applied the variant</p>
<pre><code>$ binc -e -1
</code></pre>
<p>works. -1 is treated as value for the key -e</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-04-04 14:30</div>
            <div class="timeline-body"><p>iirc <code>--</code> is meant to escape positional arguments, so it cannot be used for passing an argument to an option.  So it seems this is now working as expected and closing this out.</p>
<p>If there is any concern with the resolution, let us know what it is!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2022-04-04 14:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:48:31 UTC
    </footer>
</body>
</html>
