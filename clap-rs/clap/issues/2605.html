<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nested `updates` implemented have bugs around subcommands - clap-rs/clap #2605</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Nested `updates` implemented have bugs around subcommands</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/2605">#2605</a>
        opened by <a href="https://github.com/epage">@epage</a>
        on 2021-07-19 16:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/epage">@epage</a> on 2021-07-19 16:06</div>
            <div class="timeline-body"><h3>Discussed in https://github.com/clap-rs/clap/discussions/2591</h3>
<div type='discussions-op-text'>

<p><sup>Originally posted by <strong>epage</strong> July 14, 2021</sup>
This was implemented in #1878 for #1837 based on #1836.</p>
<p>I've not dig into all of #1878's comments but at one point the thought was:</p>
<blockquote>
<p>We don't know which fields the flattened struct consists of, so we delegate to the flattened type itself - it must know how to update itself.</p>
</blockquote>
<p>This isn't always the case.  From inspection</p>
<ul>
<li><code>SubCmd{ field: i32 }</code> generates an augment update</li>
<li><code>SubCmd(Args)</code> is hard coded to call augment</li>
<li><code>#[flatten] Subcommand(MoreCmds)</code> is hard coded to call augment</li>
<li><code>#[subcmmand] field: SubCmd</code> calls augment update</li>
<li><code>#[flatten] field: MoreArgs</code> is hard coded to call augment</li>
</ul>
<p>Example generated code from <code>clap_derive/tests/flatten.rs</code> where there is a mismatch in augment vs from</p>
<pre><code class="language-rust">        fn augment_clap_for_update&lt;'b&gt;(app: clap::App&lt;'b&gt;) -&gt; clap::App&lt;'b&gt; {
            {
                let app = app;
                let app = &lt;Common as clap::IntoApp&gt;::augment_clap(app);
                app
            }
        }
...
        fn update_from_arg_matches(&amp;mut self, arg_matches: &amp;clap::ArgMatches) {
            {
                #[allow(non_snake_case)]
                let common = &amp;mut self.common;
                clap::FromArgMatches::update_from_arg_matches(common, arg_matches);
            }
        }
```&lt;/div&gt;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2606.html">clap-rs/clap#2606</a> on 2021-07-19 16:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @pksunkara on 2021-07-25 13:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: derive macros</span> added by @pksunkara on 2021-07-25 13:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2625.html">clap-rs/clap#2625</a> on 2021-07-26 15:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2021-07-27 19:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4974.html">clap-rs/clap#4974</a> on 2023-06-19 17:18</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:08 UTC
    </footer>
</body>
</html>
