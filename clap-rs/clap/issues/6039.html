<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hide Argument as CLI, Show as Environment Variable - clap-rs/clap #6039</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Hide Argument as CLI, Show as Environment Variable</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/6039">#6039</a>
        opened by <a href="https://github.com/naftulikay">@naftulikay</a>
        on 2025-06-19 20:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/naftulikay">@naftulikay</a></div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[x] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[x] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>4.5.40</p>
<h3>Describe your use case</h3>
<p>Any application can accept configuration from a number of sources, and clap supports accepting values from command-line arguments and from environment variables with the <code>env</code> feature enabled.</p>
<p>There are certain environment variables that will not be accepted as CLI arguments, such as <code>RUST_LOG</code>, but the user should still be made aware of them when invoking the help option, as they modify what happens at runtime during program execution.</p>
<h3>Describe the solution you'd like</h3>
<p>First, let's talk about the desired output. For environment arguments that are not registered as CLI parameters, output help text could look like this:</p>
<pre><code class="language-text">Usage: clap-demo --action &lt;ACTION&gt; &lt;NAME&gt;

Arguments:
  &lt;NAME&gt;  The name of the foo to bar

Options:
      --action &lt;ACTION&gt;  
  -h, --help             Print help

Environment Variables:
  RUST_LOG=  Comma-delimited log directives to be used for filtering telemetry
</code></pre>
<p>Now, let's discuss how to go about it. There are a couple ways I could imagine this working.</p>
<h3>Solution A: Arg Type is <code>()</code> and Only <code>env</code> is Defined</h3>
<p>If:</p>
<ul>
<li>argument type is <code>()</code></li>
<li><code>env</code> feature is enabled</li>
<li><code>env</code> is defined on the argument and nothing else</li>
</ul>
<p>Then display it exclusively as an environment variable. Example struct:</p>
<pre><code class="language-rust">#[derive(Debug, Clone, Parser)]
struct Args {
    //// Comma-delimited log directives to be used for filtering telemetry
    #[clap(env = &quot;RUST_LOG&quot;)]
    _rust_log: (),
}
</code></pre>
<h3>Solution B: Hide is True, Hide Env is False</h3>
<p>If:</p>
<ul>
<li><code>env</code> feature is enabled</li>
<li><code>env</code> is defined on the argument</li>
<li><code>hide</code> is true</li>
<li><code>hide_env</code> is false</li>
</ul>
<p>Then display it exclusively as an environment variable. Example struct:</p>
<pre><code class="language-rust">#[derive(Debug, Clone, Parser)]
struct Args {
    //// Comma-delimited log directives to be used for filtering telemetry
    #[clap(hide(true), hide_env(false), env = &quot;RUST_LOG&quot;)]
    _rust_log: (),
}
</code></pre>
<h3>Solution C: Add <code>only_env</code> Boolean to Argument</h3>
<p>In this solution, simply add another flag to an argument <code>only_env: bool</code>, which will mark the argument as being exclusively an environment variable:</p>
<pre><code class="language-rust">#[derive(Debug, Clone, Parser)]
struct Args {
    //// Comma-delimited log directives to be used for filtering telemetry
    #[clap(only_env(true), env = &quot;RUST_LOG&quot;)]
    _rust_log: (),
}
</code></pre>
<h3>Alternatives, if applicable</h3>
<p>Alternatives listed above.</p>
<h3>Additional Context</h3>
<p>I came across <a href="https://github.com/clap-rs/clap/discussions/5978">this discussion</a> but I want to make clear that my intention with this is <em>not</em> to make clap an application configuration management system as mentioned in the discussion, rather to extend help text to improve the user-experience of being able to know about environment variables that will affect the application at runtime.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @naftulikay on 2025-06-19 20:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-06-19 20:24</div>
            <div class="timeline-body"><p>Note that any feature would at its core need to be described in terms of the builder API.</p>
<p>I would consider it a misuse to hide an argument for the sake of having the environment variable read.  At the point that we are talking about reading environment variables independent of arguments, I feel like we are treading into the territory of #2763 and would prefer the discussion to be focused there.  As such, I'm going to be closing this issue.</p>
<p>When discussing this there, keep in mind that the core machinery of clap is the builder API and functionality would need to be discussed in terms of that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2025-06-19 20:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:49:36 UTC
    </footer>
</body>
</html>
