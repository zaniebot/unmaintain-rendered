<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Required group can duplicate items in help text - clap-rs/clap #1487</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Required group can duplicate items in help text</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1487">#1487</a>
        opened by <a href="https://github.com/TyPR124">@TyPR124</a>
        on 2019-06-12 03:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/TyPR124">@TyPR124</a></div>
            <div class="timeline-body">Affected Version of clap
<ul>
<li>2.33.0, and master branch as of time of writing (784524f)</li>
</ul>
Bug Summary
<p>Code below outputs the following in help
<code>USAGE:</code>
<code>    test &lt;arg1|arg2|arg1|arg2&gt;</code></p>
<p>The code makes the undocumented mistake of including the group in both args, and also both args in the group. I feel this should be allowed, and the duplicates just removed.</p>
Expected Behavior Summary
<p><code>USAGE:</code>
<code>    test &lt;arg1|arg2&gt;</code></p>
Sample Code or Link to Sample Code
<p>Issue visible by running without arguments or with -h</p>
<p>https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=e0592c09f4648ffb8ea1a81d8ebc074d</p>
<pre><code>use clap::{App, Arg, ArgGroup};

fn main() {
    let _ = App::new(&quot;test&quot;)
        .arg(Arg::with_name(&quot;arg1&quot;)
            .group(&quot;group1&quot;))
        .arg(Arg::with_name(&quot;arg2&quot;)
            .group(&quot;group1&quot;))
        .group(ArgGroup::with_name(&quot;group1&quot;)
            .args(&amp;[&quot;arg1&quot;, &quot;arg2&quot;])
            .required(true))
        .get_matches();
}
</code></pre>
Debug output

 Debug Output 
<pre>
<code>

<p>DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:Parser::get_matches_with: Begin parsing &#x27;&quot;-h&quot;&#x27; ([45, 104])
DEBUG:clap:Parser::is_new_arg:&quot;-h&quot;:NotFound
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: - found
DEBUG:clap:Parser::is_new_arg: starts_new_arg=true
DEBUG:clap:Parser::possible_subcommand: arg=&quot;-h&quot;
DEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None
DEBUG:clap:ArgMatcher::process_arg_overrides:None;
DEBUG:clap:Parser::parse_short_arg: full_arg=&quot;-h&quot;
DEBUG:clap:Parser::parse_short_arg:iter:h
DEBUG:clap:Parser::parse_short_arg:iter:h: Found valid flag
DEBUG:clap:Parser::check_for_help_and_version_char;
DEBUG:clap:Parser::check_for_help_and_version_char: Checking if -h is help or version...Help
DEBUG:clap:Parser::_help: use_long=false
DEBUG:clap:Help::write_parser_help;
DEBUG:clap:Help::write_parser_help;
DEBUG:clap:Parser::color;
DEBUG:clap:Parser::color: Color setting...Auto
DEBUG:clap:is_a_tty: stderr=false
DEBUG:clap:Help::new;
DEBUG:clap:Help::write_help;
DEBUG:clap:Help::write_default_help;
DEBUG:clap:Help::write_bin_name;
DEBUG:clap:Help::write_version;
DEBUG:clap:usage::create_usage_no_title;
DEBUG:clap:usage::get_required_usage_from: reqs=[&quot;group1&quot;], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=[&quot;group1&quot;]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[&quot;arg1&quot;, &quot;arg2&quot;]
DEBUG:clap:usage::needs_flags_tag;
DEBUG:clap:usage::needs_flags_tag:iter: f=hclap_help;
DEBUG:clap:usage::needs_flags_tag:iter: f=vclap_version;
DEBUG:clap:usage::needs_flags_tag: [FLAGS] not required
DEBUG:clap:usage::get_args_tag;
DEBUG:clap:usage::get_args_tag:iter:arg1:
DEBUG:clap:Parser::groups_for_arg: name=arg1
DEBUG:clap:Parser::groups_for_arg: Searching through groups...
Found &#x27;group1&#x27;
Found &#x27;group1&#x27;
DEBUG:clap:usage::get_args_tag:iter:arg1:iter:group1;
DEBUG:clap:usage::get_args_tag:iter:arg2:
DEBUG:clap:Parser::groups_for_arg: name=arg2
DEBUG:clap:Parser::groups_for_arg: Searching through groups...
Found &#x27;group1&#x27;
Found &#x27;group1&#x27;
DEBUG:clap:usage::get_args_tag:iter:arg2:iter:group1;
DEBUG:clap:usage::create_help_usage: usage=clap-testing.exe &lt;arg1|arg2|arg1|arg2&gt;
DEBUG:clap:Help::write_all_args;
DEBUG:clap:Help::write_args;
DEBUG:clap:Help::write_args: Current Longest...2
DEBUG:clap:Help::write_args: New Longest...6
DEBUG:clap:Help::write_args: Current Longest...6
DEBUG:clap:Help::write_args: New Longest...9
DEBUG:clap:Help::write_arg;
DEBUG:clap:Help::short;
DEBUG:clap:Help::long;
DEBUG:clap:Help::val: arg=--help
DEBUG:clap:Help::spec_vals: a=--help
DEBUG:clap:Help::val: Has switch...Yes
DEBUG:clap:Help::val: force_next_line...false
DEBUG:clap:Help::val: nlh...false
DEBUG:clap:Help::val: taken...21
DEBUG:clap:Help::val: help_width &gt; (width - taken)...23 &gt; (120 - 21)
DEBUG:clap:Help::val: longest...9
DEBUG:clap:Help::val: next_line...No
DEBUG:clap:write_spaces!: num=7
DEBUG:clap:Help::help;
DEBUG:clap:Help::help: Next Line...false
DEBUG:clap:Help::help: Too long...No
DEBUG:clap:Help::write_arg;
DEBUG:clap:Help::short;
DEBUG:clap:Help::long;
DEBUG:clap:Help::val: arg=--version
DEBUG:clap:Help::spec_vals: a=--version
DEBUG:clap:Help::val: Has switch...Yes
DEBUG:clap:Help::val: force_next_line...false
DEBUG:clap:Help::val: nlh...false
DEBUG:clap:Help::val: taken...21
DEBUG:clap:Help::val: help_width &gt; (width - taken)...26 &gt; (120 - 21)
DEBUG:clap:Help::val: longest...9
DEBUG:clap:Help::val: next_line...No
DEBUG:clap:write_spaces!: num=4
DEBUG:clap:Help::help;
DEBUG:clap:Help::help: Next Line...false
DEBUG:clap:Help::help: Too long...No
DEBUG:clap:Help::write_args_unsorted;
DEBUG:clap:Help::write_arg;
DEBUG:clap:Help::short;
DEBUG:clap:Help::long;
DEBUG:clap:Help::val: arg=
DEBUG:clap:Help::spec_vals: a=
DEBUG:clap:Help::val: Has switch...No, and not next_line
DEBUG:clap:write_spaces!: num=4
DEBUG:clap:Help::help;
DEBUG:clap:Help::help: Next Line...false
DEBUG:clap:Help::help: Too long...No
DEBUG:clap:Help::write_arg;
DEBUG:clap:Help::short;
DEBUG:clap:Help::long;
DEBUG:clap:Help::val: arg=
DEBUG:clap:Help::spec_vals: a=
DEBUG:clap:Help::val: Has switch...No, and not next_line
DEBUG:clap:write_spaces!: num=4
DEBUG:clap:Help::help;
DEBUG:clap:Help::help: Next Line...false
DEBUG:clap:Help::help: Too long...No</p>
</code>
</pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#1511</a> on 2019-06-26 00:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TyPR124">@TyPR124</a> on 2019-06-26 00:10</div>
            <div class="timeline-body"><p>Fixed in v3 - closing issue
Also added regression test in #1511</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/TyPR124">@TyPR124</a> on 2019-06-26 00:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>doy/rbw#54</a> on 2021-04-17 06:39</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:57:25 UTC
    </footer>
</body>
</html>
