<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>using global env var arg produces different help output - clap-rs/clap #5673</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>using global env var arg produces different help output</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/5673">#5673</a>
        opened by <a href="https://github.com/davepacheco">@davepacheco</a>
        on 2024-08-13 19:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/davepacheco">@davepacheco</a></div>
            <div class="timeline-body">Please complete the following tasks
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
Rust Version
<p>rustc 1.80.1 (3f5fd8dd4 2024-08-06)</p>
Clap Version
<p>4.5.15</p>
Minimal reproducible code
<pre><code>use clap::Args;
use clap::Parser;
use clap::Subcommand;

#[derive(Debug, Clone, Parser)]
struct Cli {
    #[command(subcommand)]
    command: MyCommands,
}

#[derive(Debug, Clone, Subcommand)]
enum MyCommands {
    One(OneSubcommands),
}

#[derive(Debug, Clone, Args)]
struct OneSubcommands {
    #[clap(env = &quot;MY_ARG&quot;, global = true)]
    my_arg: Option&lt;String&gt;,

    #[command(subcommand)]
    command: MySubcommand,
}

#[derive(Debug, Clone, Subcommand)]
enum MySubcommand {
    Two,
}

fn main() {
    let cli = Cli::parse();
    eprintln!(&quot;{:?}&quot;, cli);
}
</code></pre>
Steps to reproduce the bug with the above code
<p><code>MY_ARG= cargo run -- one</code></p>
Actual Behaviour
<p>It produces an explicit &quot;error&quot; message and <em>no</em> additional help output.</p>
<pre><code>$ MY_ARG= cargo run -- one
   Compiling clap-message v0.1.0 (/Users/dap/oxide/clap-bug)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.58s
     Running `target/debug/clap-message one`
error: &#x27;clap-message one&#x27; requires a subcommand but one was not provided
  [subcommands: two, help]

Usage: clap-message one [MY_ARG] &lt;COMMAND&gt;

For more information, try &#x27;--help&#x27;.
</code></pre>
Expected Behaviour
<p>This is what happens if you don&#x27;t provide <code>MY_ARG</code>:</p>
<pre><code>$ cargo run -- one
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.03s
     Running `target/debug/clap-message one`
Usage: clap-message one [MY_ARG] &lt;COMMAND&gt;

Commands:
  two   
  help  Print this message or the help of the given subcommand(s)

Arguments:
  [MY_ARG]  [env: MY_ARG=]

Options:
  -h, --help  Print help
</code></pre>
<p>Here you get more detailed help output.</p>
Additional Context
<p>If you make the environment variable non-global, you get the same behavior as if the env var wasn&#x27;t specified.</p>
<p>If you don&#x27;t provide an env var, but do provide the argument on the command line, you get the same behavior as if you&#x27;d provided the env var:</p>
<pre><code>$ cargo run -- one my_value
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.03s
     Running `target/debug/clap-message one my_value`
error: &#x27;clap-message one&#x27; requires a subcommand but one was not provided
  [subcommands: two, help]

Usage: clap-message one [MY_ARG] &lt;COMMAND&gt;

For more information, try &#x27;--help&#x27;.
</code></pre>
<hr>
<p>This behavior was particularly confusing because for the program where I found this, the env variable is an optional override that basically says which instance of a server you want the program to talk to.  It&#x27;s something that people might set in their environment and forget about and would think it would have no impact on how the program reports usage messages that don&#x27;t have anything to do with that env var.</p>
Debug Output
<pre><code>$ MY_ARG= cargo run -- one
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.04s
     Running `target/debug/clap-message one`
[clap_builder::builder::command]Command::_do_parse
[clap_builder::builder::command]Command::_build: name=&quot;clap-message&quot;
[clap_builder::builder::command]Command::_propagate:clap-message
[clap_builder::builder::command]Command::_check_help_and_version:clap-message expand_help_tree=false
[clap_builder::builder::command]Command::long_help_exists
[clap_builder::builder::command]Command::_check_help_and_version: Building default --help
[clap_builder::builder::command]Command::_check_help_and_version: Building help subcommand
[clap_builder::builder::command]Command::_propagate_global_args:clap-message
[clap_builder::builder::command]Command::_propagate pushing &quot;my_arg&quot; to one
[clap_builder::builder::debug_asserts]Command::_debug_asserts
[clap_builder::builder::debug_asserts]Arg::_debug_asserts:my_arg
[clap_builder::builder::debug_asserts]Arg::_debug_asserts:help
[clap_builder::builder::debug_asserts]Command::_verify_positionals
[clap_builder::parser::parser]Parser::get_matches_with
[clap_builder::parser::parser]Parser::get_matches_with: Begin parsing &#x27;&quot;one&quot;&#x27;
[clap_builder::parser::parser]Parser::possible_subcommand: arg=Ok(&quot;one&quot;)
[clap_builder::parser::parser]Parser::get_matches_with: sc=Some(&quot;one&quot;)
[clap_builder::parser::parser]Parser::parse_subcommand
[ clap_builder::output::usage]Usage::get_required_usage_from: incls=[], matcher=false, incl_last=true
[ clap_builder::output::usage]Usage::get_required_usage_from: unrolled_reqs=[]
[ clap_builder::output::usage]Usage::get_required_usage_from: ret_val=[]
[clap_builder::builder::command]Command::_build_subcommand Setting bin_name of one to &quot;clap-message one&quot;
[clap_builder::builder::command]Command::_build_subcommand Setting display_name of one to &quot;clap-message-one&quot;
[clap_builder::builder::command]Command::_build: name=&quot;one&quot;
[clap_builder::builder::command]Command::_propagate:one
[clap_builder::builder::command]Command::_check_help_and_version:one expand_help_tree=false
[clap_builder::builder::command]Command::long_help_exists
[clap_builder::builder::command]Command::_check_help_and_version: Building default --help
[clap_builder::builder::command]Command::_check_help_and_version: Building help subcommand
[clap_builder::builder::command]Command::_propagate_global_args:one
[clap_builder::builder::command]Command::_propagate pushing &quot;my_arg&quot; to two
[clap_builder::builder::debug_asserts]Command::_debug_asserts
[clap_builder::builder::debug_asserts]Arg::_debug_asserts:my_arg
[clap_builder::builder::debug_asserts]Arg::_debug_asserts:help
[clap_builder::builder::debug_asserts]Command::_verify_positionals
[clap_builder::parser::parser]Parser::parse_subcommand: About to parse sc=one
[clap_builder::parser::parser]Parser::get_matches_with
[clap_builder::parser::parser]Parser::add_env
[clap_builder::parser::parser]Parser::add_env: Checking arg `[MY_ARG]`
[clap_builder::parser::parser]Parser::add_env: Found an opt with value=&quot;&quot;
[clap_builder::parser::parser]Parser::react action=Set, identifier=None, source=EnvVariable
[clap_builder::parser::arg_matcher]ArgMatcher::start_custom_arg: id=&quot;my_arg&quot;, source=EnvVariable
[clap_builder::builder::command]Command::groups_for_arg: id=&quot;my_arg&quot;
[clap_builder::parser::parser]Parser::push_arg_values: [&quot;&quot;]
[clap_builder::parser::parser]Parser::add_single_val_to_arg: cur_idx:=1
[clap_builder::parser::arg_matcher]ArgMatcher::needs_more_vals: o=my_arg, pending=0
[clap_builder::parser::arg_matcher]ArgMatcher::needs_more_vals: expected=1, actual=0
[clap_builder::parser::parser]Parser::react not enough values passed in, leaving it to the validator to complain
[clap_builder::parser::parser]Parser::add_env: Checking arg `--help`
[clap_builder::parser::parser]Parser::add_defaults
[clap_builder::parser::parser]Parser::add_defaults:iter:my_arg:
[clap_builder::parser::parser]Parser::add_default_value: doesn&#x27;t have conditional defaults
[clap_builder::parser::parser]Parser::add_default_value:iter:my_arg: doesn&#x27;t have default vals
[clap_builder::parser::parser]Parser::add_defaults:iter:help:
[clap_builder::parser::parser]Parser::add_default_value: doesn&#x27;t have conditional defaults
[clap_builder::parser::parser]Parser::add_default_value:iter:help: doesn&#x27;t have default vals
[clap_builder::parser::validator]Validator::validate
[clap_builder::builder::command]Command::groups_for_arg: id=&quot;my_arg&quot;
[clap_builder::parser::validator]Conflicts::gather_direct_conflicts id=&quot;my_arg&quot;, conflicts=[]
[ clap_builder::output::usage]Usage::create_usage_with_title
[ clap_builder::output::usage]Usage::create_usage_no_title
[ clap_builder::output::usage]Usage::write_help_usage
[ clap_builder::output::usage]Usage::write_arg_usage; incl_reqs=true
[ clap_builder::output::usage]Usage::needs_options_tag
[ clap_builder::output::usage]Usage::needs_options_tag:iter: f=help
[ clap_builder::output::usage]Usage::needs_options_tag:iter Option is built-in
[ clap_builder::output::usage]Usage::needs_options_tag: [OPTIONS] not required
[ clap_builder::output::usage]Usage::write_args: incls=[]
[ clap_builder::output::usage]Usage::get_args: unrolled_reqs=[]
[ clap_builder::output::usage]Usage::write_subcommand_usage
[ clap_builder::output::usage]Usage::create_usage_with_title: usage=Usage: clap-message one [MY_ARG] &lt;COMMAND&gt;
[clap_builder::builder::command]Command::color: Color setting...
[clap_builder::builder::command]Auto
[clap_builder::builder::command]Command::color: Color setting...
[clap_builder::builder::command]Auto
error: &#x27;clap-message one&#x27; requires a subcommand but one was not provided
  [subcommands: two, help]

Usage: clap-message one [MY_ARG] &lt;COMMAND&gt;

For more information, try &#x27;--help&#x27;.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by <a href="https://github.com/davepacheco">@davepacheco</a> on 2024-08-13 19:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davepacheco">@davepacheco</a> on 2024-08-13 19:59</div>
            <div class="timeline-body"><p>The template wanted actual code and not a repo pointer, but in case it&#x27;s useful, here&#x27;s a repo that reproduces it:
https://github.com/davepacheco/clap-usage-message</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-parsing</span> added by <a href="https://github.com/epage">@epage</a> on 2024-08-13 20:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-08-13 20:18</div>
            <div class="timeline-body"><p>I&#x27;m able to reproduce the main behavior you mentioned</p>
<pre><code>#!/usr/bin/env nargo
---
[dependencies]
clap = { version = &quot;4&quot;, features = [&quot;derive&quot;, &quot;env&quot;] }
---

use clap::Args;
use clap::Parser;
use clap::Subcommand;

#[derive(Debug, Clone, Parser)]
struct Cli {
    #[command(subcommand)]
    command: MyCommands,
}

#[derive(Debug, Clone, Subcommand)]
enum MyCommands {
    One(OneSubcommands),
}

#[derive(Debug, Clone, Args)]
struct OneSubcommands {
    #[clap(env = &quot;MY_ARG&quot;, global = true)]
    my_arg: Option&lt;String&gt;,

    #[command(subcommand)]
    command: MySubcommand,
}

#[derive(Debug, Clone, Subcommand)]
enum MySubcommand {
    Two,
}

fn main() {
    let cli = Cli::parse();
    eprintln!(&quot;{:?}&quot;, cli);
}

</code></pre>
<pre><code>$ MY_ARG= ./clap-5673.rs one
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.08s
     Running `/home/epage/src/personal/cargo/target/debug/cargo -Zscript -Zmsrv-policy ./clap-5673.rs one`
warning: `package.edition` is unspecified, defaulting to `2021`
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.07s
     Running `/home/epage/.cargo/target/1b/a671870fa36384/debug/clap-5673 one`
error: &#x27;clap-5673 one&#x27; requires a subcommand but one was not provided
  [subcommands: two, help]

Usage: clap-5673 one [MY_ARG] &lt;COMMAND&gt;

For more information, try &#x27;--help&#x27;.
</code></pre>
<p>but I can&#x27;t reproduce</p>
<blockquote>
<p>If you make the environment variable non-global, you get the same behavior as if the env var wasn&#x27;t specified.</p>
</blockquote>
<pre><code>#!/usr/bin/env nargo
---
[dependencies]
clap = { version = &quot;4&quot;, features = [&quot;derive&quot;, &quot;env&quot;] }
---

use clap::Args;
use clap::Parser;
use clap::Subcommand;

#[derive(Debug, Clone, Parser)]
struct Cli {
    #[command(subcommand)]
    command: MyCommands,
}

#[derive(Debug, Clone, Subcommand)]
enum MyCommands {
    One(OneSubcommands),
}

#[derive(Debug, Clone, Args)]
struct OneSubcommands {
    #[clap(env = &quot;MY_ARG&quot;)]
    my_arg: Option&lt;String&gt;,

    #[command(subcommand)]
    command: MySubcommand,
}

#[derive(Debug, Clone, Subcommand)]
enum MySubcommand {
    Two,
}

fn main() {
    let cli = Cli::parse();
    eprintln!(&quot;{:?}&quot;, cli);
}
</code></pre>
<pre><code>$ MY_ARG= ./clap-5673.rs one
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.09s
     Running `/home/epage/src/personal/cargo/target/debug/cargo -Zscript -Zmsrv-policy ./clap-5673.rs one`
warning: `package.edition` is unspecified, defaulting to `2021`
   Compiling clap-5673 v0.0.0 (/home/epage/src/personal/dump)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.31s
     Running `/home/epage/.cargo/target/1b/a671870fa36384/debug/clap-5673 one`
error: &#x27;clap-5673 one&#x27; requires a subcommand but one was not provided
  [subcommands: two, help]

Usage: clap-5673 one [MY_ARG] &lt;COMMAND&gt;

For more information, try &#x27;--help&#x27;.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-08-13 20:23</div>
            <div class="timeline-body"><p>The help output comes from <a href="https://docs.rs/clap/latest/clap/struct.Command.html#method.arg_required_else_help"><code>Command::arg_required_else_help</code></a> is set by default for required subcommands.  It won&#x27;t show up if any &quot;explicit&quot; values are specified, to avoid masking user errors.</p>
<p>Assuming <code>global</code> has nothing to to with this, this discrepancy you are seeing is because we consider an <code>env</code> to be explicitly specified value, like <code>std::env::args_os()</code> and unlike default values, so the help isn&#x27;t shown and the rest of the validation occurs, showing that message.  This is why it matches the behavior of <code>cargo run -- one my_value</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davepacheco">@davepacheco</a> on 2024-08-13 20:32</div>
            <div class="timeline-body"><p>Sorry, I had confused a few variations that I had tried.  If the argument is at the top level and global, as in:</p>
<pre><code>use clap::Args;
use clap::Parser;
use clap::Subcommand;

#[derive(Debug, Clone, Parser)]
struct Cli {
    #[clap(env = &quot;MY_ARG&quot;, global = true)]
    my_arg: Option&lt;String&gt;,

    #[command(subcommand)]
    command: MyCommands,
}

#[derive(Debug, Clone, Subcommand)]
enum MyCommands {
    One(OneSubcommands),
}

#[derive(Debug, Clone, Args)]
struct OneSubcommands {
    #[command(subcommand)]
    command: MySubcommand,
}

#[derive(Debug, Clone, Subcommand)]
enum MySubcommand {
    Two,
}

fn main() {
    let cli = Cli::parse();
    eprintln!(&quot;{:?}&quot;, cli);
}
</code></pre>
<p>Then I see:</p>
<pre><code>dap@zathras clap-bug $ cargo run -- one 
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.04s
     Running `target/debug/clap-message one`
Usage: clap-message one [MY_ARG] &lt;COMMAND&gt;

Commands:
  two   
  help  Print this message or the help of the given subcommand(s)

Arguments:
  [MY_ARG]  [env: MY_ARG=]

Options:
  -h, --help  Print help
</code></pre>
<p>and:</p>
<pre><code>$ MY_ARG= cargo run -- one 
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.03s
     Running `target/debug/clap-message one`
error: &#x27;clap-message one&#x27; requires a subcommand but one was not provided
  [subcommands: two, help]

Usage: clap-message one [MY_ARG] &lt;COMMAND&gt;

For more information, try &#x27;--help&#x27;.
</code></pre>
<p>If I then make the argument non-global, like:</p>
<pre><code>use clap::Args;
use clap::Parser;
use clap::Subcommand;

#[derive(Debug, Clone, Parser)]
struct Cli {
    #[clap(env = &quot;MY_ARG&quot;)]
    my_arg: Option&lt;String&gt;,

    #[command(subcommand)]
    command: MyCommands,
}

#[derive(Debug, Clone, Subcommand)]
enum MyCommands {
    One(OneSubcommands),
}

#[derive(Debug, Clone, Args)]
struct OneSubcommands {
    #[command(subcommand)]
    command: MySubcommand,
}

#[derive(Debug, Clone, Subcommand)]
enum MySubcommand {
    Two,
}

fn main() {
    let cli = Cli::parse();
    eprintln!(&quot;{:?}&quot;, cli);
}
</code></pre>
<p>then I get the same behavior (full help output) regardless of whether the variable was specified:</p>
<pre><code>$ cargo run -- one 
   Compiling clap-message v0.1.0 (/Users/dap/oxide/clap-bug)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.95s
     Running `target/debug/clap-message one`
Usage: clap-message one &lt;COMMAND&gt;

Commands:
  two   
  help  Print this message or the help of the given subcommand(s)

Options:
  -h, --help  Print help

$ MY_ARG= cargo run -- one 
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.04s
     Running `target/debug/clap-message one`
Usage: clap-message one &lt;COMMAND&gt;

Commands:
  two   
  help  Print this message or the help of the given subcommand(s)

Options:
  -h, --help  Print help
</code></pre>
<blockquote>
<p>The help output comes from <a href="https://docs.rs/clap/latest/clap/struct.Command.html#method.arg_required_else_help"><code>Command::arg_required_else_help</code></a> is set by default for required subcommands. It won&#x27;t show up if any &quot;explicit&quot; values are specified, to avoid masking user errors.</p>
<p>Assuming <code>global</code> has nothing to to with this, this discrepancy you are seeing is because we consider an <code>env</code> to be explicitly specified value, like <code>std::env::args_os()</code> and unlike default values, so the help isn&#x27;t shown and the rest of the validation occurs, showing that message. This is why it matches the behavior of <code>cargo run -- one my_value</code>.</p>
</blockquote>
<p>I think I can see the series of decisions that results in this behavior (though I&#x27;m not sure what user errors you&#x27;re talking about masking if it didn&#x27;t do this).  But I think it remains pretty surprising.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-08-13 20:53</div>
            <div class="timeline-body"><p>Looks like we have #3572 covering this case (had mislabeled it so I missed it in my search), closing in favor of that.</p>
<blockquote>
<p>I think I can see the series of decisions that results in this behavior (though I&#x27;m not sure what user errors you&#x27;re talking about masking if it didn&#x27;t do this). But I think it remains pretty surprising.</p>
</blockquote>
<p>Take</p>
<pre><code>$ cargo run -- one my_value
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.03s
     Running `target/debug/clap-message one my_value`
error: &#x27;clap-message one&#x27; requires a subcommand but one was not provided
  [subcommands: two, help]

Usage: clap-message one [MY_ARG] &lt;COMMAND&gt;

For more information, try &#x27;--help&#x27;.
</code></pre>
<p>If we showed help, we leave the user guessing as to what went wrong that caused the help to show up.  This is one reason why the old <code>SubcommandRequiredElseHelp</code> was dropped in favor of having just <code>arg_required_else_help</code>, in addition to simplifying clap overall.</p>
<p>which leaves us with whether the user explicitly setting an environment variable is more like <code>cargo run -- one my_value</code> or <code>cargo run -- one</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davepacheco">@davepacheco</a> on 2024-08-14 05:16</div>
            <div class="timeline-body"><p>Thanks for diving in!</p>
<blockquote>
<p>Looks like we have #3572 covering this case (had mislabeled it so I missed it in my search), closing in favor of that.</p>
</blockquote>
<p>:+1: (but this one is currently still open, FYI)</p>
<blockquote>
<blockquote>
<p>I think I can see the series of decisions that results in this behavior (though I&#x27;m not sure what user errors you&#x27;re talking about masking if it didn&#x27;t do this). But I think it remains pretty surprising.</p>
</blockquote>
<p>Take</p>
<pre><code>$ cargo run -- one my_value
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.03s
     Running `target/debug/clap-message one my_value`
error: &#x27;clap-message one&#x27; requires a subcommand but one was not provided
  [subcommands: two, help]

Usage: clap-message one [MY_ARG] &lt;COMMAND&gt;

For more information, try &#x27;--help&#x27;.
</code></pre>
<p>If we showed help, we leave the user guessing as to what went wrong that caused the help to show up.</p>
</blockquote>
<p>Concretely, the help output would look like:</p>
<pre><code>$ cargo run -- one my_value
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.04s
     Running `target/debug/clap-message one`
Usage: clap-message one [MY_ARG] &lt;COMMAND&gt;

Commands:
  two   
  help  Print this message or the help of the given subcommand(s)

Arguments:
  [MY_ARG]  [env: MY_ARG=]

Options:
  -h, --help  Print help
</code></pre>
<p>To me that&#x27;s pretty clear: <code>my_value</code> pattern-matches with <code>[MY_ARG</code>] (even if I hadn&#x27;t named it that way) and is obviously not one of the two commands listed.  The message <code>&#x27;clap-message one&#x27; requires a subcommand but one was not provided</code> doesn&#x27;t seem particularly clearer -- that&#x27;s pretty much what the <code>&lt;COMMAND&gt;</code> in the synopsis means, isn&#x27;t it?  It might be clearer to convey that <code>my_value</code> is not one of the supported commands and was interpreted as a value for <code>MY_ARG</code>, but I&#x27;m not sure it&#x27;s worth it.  Obviously, this is just one opinion.  But I gather I&#x27;m not the first person to find this behavior confusing -- I&#x27;m sorry I missed #5113 when I searched before filing this!</p>
<blockquote>
<p>This is one reason why the old <code>SubcommandRequiredElseHelp</code> was dropped in favor of having just <code>arg_required_else_help</code>, in addition to simplifying clap overall.</p>
</blockquote>
<p>I didn&#x27;t know about this one and just <a href="https://docs.rs/clap/latest/clap/struct.Command.html#method.arg_required_else_help">looked it up</a>.  The docs only say that applies to a command with no arguments present.  Are you saying it would apply here, too?  Is it the default behavior or something that could be used to work around this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/epage">@epage</a> on 2024-08-14 13:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-08-14 13:27</div>
            <div class="timeline-body"><blockquote>
<blockquote>
<p>This is one reason why the old SubcommandRequiredElseHelp was dropped in favor of having just arg_required_else_help, in addition to simplifying clap overall.</p>
</blockquote>
</blockquote>
<blockquote>
<p>I didn&#x27;t know about this one and just <a href="https://docs.rs/clap/latest/clap/struct.Command.html#method.arg_required_else_help">looked it up</a>. The docs only say that applies to a command with no arguments present. Are you saying it would apply here, too? Is it the default behavior or something that could be used to work around this?</p>
</blockquote>
<p><code>arg_required_else_help</code> is the behavior that is under discussion in this issue as it is what causes the help output to show up.  It is a default behavior for derive users when they have a required subcommand.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>oxidecomputer/omicron#6368</a> on 2024-08-16 21:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 20:00:17 UTC
    </footer>
</body>
</html>
