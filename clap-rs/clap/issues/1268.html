<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AllowLeadingHyphen and AllowNegativeNumbers breaks argument parsing for subsequent arguments - clap-rs/clap #1268</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>AllowLeadingHyphen and AllowNegativeNumbers breaks argument parsing for subsequent arguments</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1268">#1268</a>
        opened by <a href="https://github.com/Jarngreipr">@Jarngreipr</a>
        on 2018-05-04 10:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Jarngreipr">@Jarngreipr</a></div>
            <div class="timeline-body"><h3>Rust Version</h3>
<p>rustc 1.27.0-nightly (7f3444e1b 2018-04-26)</p>
<h3>Affected Version of clap</h3>
<p>clap 2.31.2 (registry+https://github.com/rust-lang/crates.io-index)&quot;</p>
<h3>Expected Behavior Summary</h3>
<p>Enabling AppSettings::{AllowLeadingHyphen, AllowNegativeNumbers} and argument setting <code>allow_hyphen_values</code> should allow optional arguments to contain a hyphen without affecting subsequently passed arguments:</p>
<pre><code>myapp --hyphenated &quot;-20&quot; --other
</code></pre>
<h3>Actual Behavior Summary</h3>
<p>Testing revealed that arguments passed after an argument that takes a hyphen value are not parsed.
If there are required arguments among them, an error stating that they were not passed.
Other arguments are silently unparsed.</p>
<h3>Steps to Reproduce the issue</h3>
<p>Enable any of <code>AllowLeadingHyphen</code>, <code>AllowNegativeNumbers</code>, <code>allow_hyphen_value</code>.
Pass an argument that takes a hyphenated value, then pass another argument (preferably a required one).</p>
<h3>Sample Code or Link to Sample Code</h3>
<pre><code>#[test]
fn test_negative_builder() {
    let m = App::new(&quot;minus&quot;)
            .subcommand(SubCommand::with_name(&quot;num&quot;)
            .about(&quot;Plots data from given simulation paths&quot;)
            .args(&amp;[
                    Arg::with_name(&quot;neg&quot;)
                           .short(&quot;n&quot;)
                           .takes_value(true)
                           .allow_hyphen_values(true)
                           .multiple(true),
                    Arg::with_name(&quot;req&quot;)
                           .short(&quot;r&quot;)
                           .required(true),
            ])).get_matches_from(vec![&quot;minus&quot;, &quot;num&quot;,&quot;-n&quot;, &quot;-0.5,0.5&quot;, &quot;-r&quot;]);
    if let Some(matches) = m.subcommand_matches(&quot;num&quot;) {
        let val: Vec&lt;&amp;str&gt; = matches.values_of(&quot;neg&quot;).unwrap().collect();
        let vals: Vec&lt;&amp;str&gt; = val[0].split(&quot;,&quot;).collect();
        assert_eq!(vals, vec![&quot;-0.5&quot;, &quot;0.5&quot;]);
    }   
}
</code></pre>
<p>The same test with <code>.get_matches_from(vec![&quot;minus&quot;, &quot;num&quot;, &quot;-r&quot;,&quot;-n&quot;, &quot;-0.5,0.5&quot;])</code> should pass.</p>
<h3>Debug output</h3>
<p>N/A</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/scirner22">@scirner22</a> on 2018-05-18 04:09</div>
            <div class="timeline-body"><p>Try attaching <code>AllowLeadingHyphen</code> to the subcommand and not the app.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Jarngreipr">@Jarngreipr</a> on 2018-06-04 11:27</div>
            <div class="timeline-body"><p>@scirner22 Your suggestion does not appear to resolve the issue.
Adding <code>.setting(AppSettings::AllowLeadingHyphen)</code> after <code>.subcommand(SubCommand::with_name(&quot;num&quot;)</code>
and using <code>.get_matches_from(vec![&quot;minus&quot;, &quot;num&quot;,&quot;-n&quot;, &quot;-0.5,0.5&quot;, &quot;-r&quot;])</code> fails with the following:</p>
<pre><code>error: The following required arguments were not provided:
    -r
</code></pre>
<p>What appears to be happening is that after passing <code>-n &quot;-0.5&quot;</code>, all subsequent arguments will be interpreted as values instead of arguments, thus the required argument <code>-r</code> is not found which causes the error above.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-06-05 02:08</div>
            <div class="timeline-body"><p>This is why the docs suggest using <code>Arg::allow_hyphen_values</code> instead of an application wide <code>AppSettings::AllowLeadingHyphen</code>. If you <em>must</em> use an application wide setting, it's very much recommended to use things like <code>Arg::number_of_values(1)</code> for your arguments to limit the number of values they could use in a row.</p>
<p>Otherwise, clap has no way of knowing when to stop parsing values. If all you say is, &quot;all values can start with a <code>-</code>, <em>and</em> they accept multiple values&quot; clap really can't tell when one argument stops and another one starts. This may sound simple because, &quot;if it matches an argument I defined of course it's an argument and not a value!&quot; Unfortunately, it's not that simple because there are many times when a value may also equal an argument you defined, especially when working with shorts and negative numbers.</p>
<p>I'm going to close this as the best thing for a CLI UX perspective is to limit the number of values in a row, or design the CLI so that such arguments which accept negative numbers or hyphen values always come last (such as with <code>Arg::last</code> or <code>AppSettings::TrailingVarArg</code>). If you have some other specifics on your use case and why you may or may not be able to use these limitations, please ping me or hit me up in the Gitter channel and we can discuss further :wink:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2018-06-05 02:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:47:09 UTC
    </footer>
</body>
</html>
