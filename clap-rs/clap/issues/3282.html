<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`rename_all` on a `Subcommand` applies to variant-struct fields - clap-rs/clap #3282</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>rename_all</code> on a <code>Subcommand</code> applies to variant-struct fields</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/3282">#3282</a>
        opened by <a href="https://github.com/epage">@epage</a>
        on 2022-01-11 20:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a></div>
            <div class="timeline-body">Please complete the following tasks
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
Rust Version
<p>rustc 1.57.0 (f1edd0429 2021-11-29)</p>
Clap Version
<p>v3.0.6</p>
Minimal reproducible code
<pre><code>use clap::{Parser, Subcommand};

#[derive(Parser, Debug)]
#[clap(author, version, about, long_about = None)]
struct Cli {
    #[clap(long)]
    out_dir: Option&lt;String&gt;,

    #[clap(subcommand)]
    command: Commands,
}

#[derive(Subcommand, Debug)]
#[clap(rename_all = &quot;snake_case&quot;)]
enum Commands {
    /// Adds files to myapp
    Add {
        #[clap(long)]
        out_dir: Option&lt;String&gt;,
    },
}

fn main() {
    let cli = Cli::parse();
    dbg!(cli);
}
</code></pre>
Steps to reproduce the bug with the above code
<pre><code>$ cargo run -- add --help
</code></pre>
Actual Behaviour
<pre><code>test-clap-add 
Adds files to myapp

USAGE:
    test-clap add [OPTIONS]

OPTIONS:
    -h, --help                 Print help information
        --out_dir &lt;OUT_DIR&gt;    
</code></pre>
Expected Behaviour
<pre><code>test-clap-add 
Adds files to myapp

USAGE:
    test-clap add [OPTIONS]

OPTIONS:
    -h, --help                 Print help information
        --out-dir &lt;OUT_DIR&gt;    
</code></pre>
Additional Context
<p>Found via <a href="https://github.com/rust-lang/rustc-perf/pull/1142">rust-lang/rustc-perf#1142</a></p>
Debug Output
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by <a href="https://github.com/epage">@epage</a> on 2022-01-11 20:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-medium</span> added by <a href="https://github.com/epage">@epage</a> on 2022-01-11 20:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-derive</span> added by <a href="https://github.com/epage">@epage</a> on 2022-01-11 20:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>rust-lang/rustc-perf#1142</a> on 2022-01-11 20:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">M-breaking-change</span> added by <a href="https://github.com/epage">@epage</a> on 2022-02-09 00:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;4.0&quot; by <a href="https://github.com/epage">@epage</a> on 2022-02-09 00:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-05-06 21:54</div>
            <div class="timeline-body"><p>Since clap specifically tests for this behavior, I got worried about what precedent is set for this so I tested serde</p>
<pre><code>#!/usr/bin/env rust-script

//! ```cargo
//! [dependencies]
//! serde = { version = &quot;1&quot;, features = [&quot;derive&quot;] }
//! serde_json = &quot;1&quot;
//! ```

#[derive(serde::Serialize, serde::Deserialize, Debug)]
#[serde(rename_all = &quot;SCREAMING_SNAKE_CASE&quot;)]
enum Args {
    One,
    Two { field: String },
}

fn main() {
    let args = Args::One;
    let json = serde_json::to_string(&amp;args).unwrap();
    println!(&quot;{}&quot;, json);
    let args = Args::Two {
        field: &quot;value&quot;.into(),
    };
    let json = serde_json::to_string(&amp;args).unwrap();
    println!(&quot;{}&quot;, json);
}
</code></pre>
<pre><code>$ ./clap-3282.rs
    Finished dev [unoptimized + debuginfo] target(s) in 0.01s
     Running `/home/epage/src/personal/cargo-script-mvs/target/debug/rust-script ./clap-3282.rs`
&quot;ONE&quot;
{&quot;TWO&quot;:{&quot;field&quot;:&quot;value&quot;}}
</code></pre>
<p>Looks like serde does not apply <code>rename_all</code> recursively which makes sense because variants and fields are very different and can have different naming needs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-05-08 02:05</div>
            <div class="timeline-body"><p>Thinking about it more, I think  with it being an <code>id</code>, it is fine being skipped by <code>rename_all</code>, especially since we set <code>value_name</code>.  However, I could see us providing more specialized renames, <code>rename_flags</code>, <code>rename_commands</code>, <code>rename_values</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#3708</a> on 2022-05-09 15:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#3709</a> on 2022-05-09 15:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/epage">@epage</a> on 2022-05-09 15:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#4759</a> on 2023-03-13 17:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#4869</a> on 2023-04-28 20:26</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:58:43 UTC
    </footer>
</body>
</html>
