<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Question - how can I print the arguments given an opt instance? - clap-rs/clap #3131</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Question - how can I print the arguments given an opt instance?</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/clap-rs/clap/issues/3131">#3131</a>
        opened by <a href="https://github.com/epage">@epage</a>
        on 2021-12-09 16:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a></div>
            <div class="timeline-body"><p><a href="https://github.com/avnerbarr"><img src="https://avatars.githubusercontent.com/u/2404795?v=4"></a> <strong>Issue by <a href="https://github.com/avnerbarr">avnerbarr</a></strong>
<em>Thursday Oct 15, 2020 at 13:51 GMT</em>
<em>Originally opened as <a href="https://github.com/TeXitoi/structopt/issues/441">TeXitoi/structopt#441</a></em></p>
<hr>
<p>I want to get the string representation leading to a particular Opt instance (after I&#x27;ve modified it).</p>
<p>for instance</p>
<pre><code>#[derive(StructOpt)]
struct Opt {
a : String,
b: String,
c: i32,
...
z : String
}

...
let opts = Opt::from_args();
...
if some condition occured, change opts and print the correct representation {
  let new_opts = Opt { z: &quot;this_value_should_be_written&quot;, ..Opt::from_args() }; // change some values
  print(how do I print &quot;new_opts&quot; in such a way that is valid for the Opt parser for next run?)
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-09 16:34</div>
            <div class="timeline-body"><p><a href="https://github.com/EverlastingBugstopper"><img src="https://avatars.githubusercontent.com/u/9408157?v=4"></a> <strong>Comment by <a href="https://github.com/EverlastingBugstopper">EverlastingBugstopper</a></strong>
<em>Monday Oct 19, 2020 at 18:05 GMT</em></p>
<hr>
<p>you could add a debug derivation like so: <code>#[derive(StructOpt, Debug)]</code> and then print like <code>println!(&quot;{:?}, new_opts);</code> or even <code>println!(&quot;{:#?}&quot;, new_opts);</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-09 16:34</div>
            <div class="timeline-body"><p><a href="https://github.com/TeXitoi"><img src="https://avatars.githubusercontent.com/u/5787066?v=4"></a> <strong>Comment by <a href="https://github.com/TeXitoi">TeXitoi</a></strong>
<em>Tuesday Oct 20, 2020 at 09:16 GMT</em></p>
<hr>
<p>AFAIK, that&#x27;s not possible, and it will be a quite complicated feature, relying deeply in clap internal.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-09 16:34</div>
            <div class="timeline-body"><p><a href="https://github.com/therealbnut"><img src="https://avatars.githubusercontent.com/u/635596?v=4"></a> <strong>Comment by <a href="https://github.com/therealbnut">therealbnut</a></strong>
<em>Tuesday Apr 06, 2021 at 00:32 GMT</em></p>
<hr>
<p>Adding to this I want to use <code>structopt</code> for IPC with a forked child process, and so I&#x27;d like to be able to go from an <code>Opt</code> structure to a <code>Vec</code>/<code>Iterator</code> of argument strings.</p>
<p>ie.</p>
<pre><code>enum Opt {
    #[structopt(short, long)]
    host_name: String,
}

// [&quot;--host_name&quot;, &quot;my-server&quot;]
(Opt { host_name: &quot;my-server&quot;.to_owned() }).args()
</code></pre>
<p>If this was possible then you could emit debugging info by doing:</p>
<pre><code>println!(&quot;{:?}&quot;, op.args())
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-09 16:34</div>
            <div class="timeline-body"><p><a href="https://github.com/Xaeroxe"><img src="https://avatars.githubusercontent.com/u/6182002?v=4"></a> <strong>Comment by <a href="https://github.com/Xaeroxe">Xaeroxe</a></strong>
<em>Monday Oct 04, 2021 at 16:29 GMT</em></p>
<hr>
<p>@TeXitoi would you be open to a PR implementing this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-09 16:34</div>
            <div class="timeline-body"><p><a href="https://github.com/TeXitoi"><img src="https://avatars.githubusercontent.com/u/5787066?v=4"></a> <strong>Comment by <a href="https://github.com/TeXitoi">TeXitoi</a></strong>
<em>Monday Oct 04, 2021 at 16:51 GMT</em></p>
<hr>
<p>Better to propose to clapv3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-derive</span> added by <a href="https://github.com/epage">@epage</a> on 2021-12-09 16:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by <a href="https://github.com/epage">@epage</a> on 2021-12-09 16:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-12-10 01:54</div>
            <div class="timeline-body"><p>@epage This is currently possible with v3, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-10 19:46</div>
            <div class="timeline-body"><p>I&#x27;m not aware of a way to convert a <code>Parser</code> to a valid args.</p>
<p>First, doing so would only work if all fields are <code>Display</code> (which will fail in common cases like <code>Path</code>).  Ideally we would be instead generating <code>OsStrings</code> rather than <code>Strings</code> and there isn&#x27;t anything like <code>Display</code> for <code>OsStr</code> though we could generate some specialization hacks to work in some cases.</p>
<p>Second, we&#x27;d have to examine all of the attributes to see what a valid command would look like.</p>
<ul>
<li>The most obvious is dealing with if a short/long is needed and what that is.</li>
<li>An example of an easy to miss case is if they set <a href="https://docs.rs/clap/3.0.0-rc.3/clap/struct.Arg.html#method.require_equals"><code>require_equals</code></a>.</li>
<li>A complicated case is when it comes to validation rules and defaulting.  Once #3020 goes in, users can set requires that ignore defaults but we will have a hard time knowing in this what is a default to not put in the command line.</li>
</ul>
<p>Of course, with all features, there is a question of how much correctness is needed so you aren&#x27;t laying traps for people vs how much it gets in the way of progress.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> added by <a href="https://github.com/epage">@epage</a> on 2021-12-10 19:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Xaeroxe">@Xaeroxe</a> on 2022-01-18 18:10</div>
            <div class="timeline-body"><p>The shape I&#x27;d like to see this API take would be</p>
<ul>
<li><code>clap</code> exposes an additional derive trait, called something like <code>IntoArgs</code> (we can bikeshed the name)</li>
<li>That trait provides a method for generating an <code>Iterator</code> of <code>OsString</code>s.</li>
<li>That <code>Iterator</code> can be fed into <code>std::process::Command::args</code> and if the target executable uses <code>Parser::parse()</code> on the same structure definition that we used <code>IntoArgs</code> on, then the transmission of the structure between programs is guaranteed to be correct.*</li>
</ul>
<p>* Barring further manipulation of the <code>Command</code> which may invalidate the argument structure and ordering</p>
<p>It may be possible to lean on the <a href="https://serde.rs/data-model.html">serde data model</a> for this. i.e. if the structure also implements <code>serde::Serialize</code> then <code>clap</code> only has to accept the serde data model, rather than requiring all of the members to implement some new trait that reverses <code>FromStr</code>. <code>Display</code> would be a poor choice for reversing <code>FromStr</code> because <code>Display</code> doesn&#x27;t require a guarantee that it&#x27;s compatible with <code>FromStr</code>. However it&#x27;s worth noting that using the serde data model has a similar problem, unless <code>clap</code> also starts using <code>serde</code> for deserializing the arguments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Kinrany">@Kinrany</a> on 2022-09-22 22:50</div>
            <div class="timeline-body"><p>Is it generally possible to generate a correct <code>std::process::Command</code> regardless of the OS, or is this complicated enough that Clap would have to target another library?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-09-23 00:50</div>
            <div class="timeline-body"><p>&quot;Regardless of OS&quot; part is likely the easy part.  The hard part is more in getting the data back out once it has been parsed as I outlined above.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dzmitry-lahoda">@dzmitry-lahoda</a> on 2024-07-24 19:53</div>
            <div class="timeline-body"><p>claps deserializes(parses, for example hex to bytes), but does not have  backward way of serialization (for example, mapping bytes to string). clean solution would be to finalize clap to have <code>serialize</code> equivalent.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#4729</a> on 2024-07-25 16:03</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:58:35 UTC
    </footer>
</body>
</html>
