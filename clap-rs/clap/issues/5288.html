<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expose inner error context to allow removing pieces of context, for consistency - clap-rs/clap #5288</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Expose inner error context to allow removing pieces of context, for consistency</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/clap-rs/clap/issues/5288">#5288</a>
        opened by <a href="https://github.com/5HT2">@5HT2</a>
        on 2024-01-08 13:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/5HT2">@5HT2</a></div>
            <div class="timeline-body">Please complete the following tasks
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
Clap Version
<p><code>master</code></p>
Describe your use case
<p>Currently, error messages provided by <code>clap::Error</code> rely on numerous private APIs when being constructed, which force you to rely on writing an entirely new Context formatter, instead of being able to access the inner styles directly, as with other similar use cases.</p>
<p>A similar proposed enhancement, #5065, already goes into in-depth discussion about possible alternatives and solutions at the moment, suggests making <code>Error::set_source</code> accessible, which <em>is</em> incredibly beneficial for solving most of my problems when it comes to making error prints pretty, however, it still doesn&#x27;t address being able to trim unnecessary help flags from errors, which would either require exposing specific inner methods, or simply exposing a public API to remove from the inner error context, which would be complimenting <code>Error::insert</code></p>
Describe the solution you&#x27;d like
<p>Currently, I feel like the most straightforward and flexible solution here would be a public API method exposing <code>.inner.context.remove()</code>, akin to the current <code>Error::insert</code> exposing <code>.inner.context.insert()</code>, defined here: https://github.com/clap-rs/clap/blob/2ab48b295c2463ce8c141a9868095b811ccf3b99/clap_builder/src/error/mod.rs#L197-L202</p>
<p>One could imagine how similar this public API would be, and how fitting it would be for the sake of completeness in the library, as it&#x27;s a very non-roundabout way to go about allowing prettier Error outputs without hardcoding even more public methods to expose, to access the inner styles and help flags.</p>
<pre><code>-    /// Insert a piece of context
+    /// Remove a piece of context
=    #[inline(never)]
=    #[cfg(feature = &quot;error-context&quot;)]
-    pub fn insert(&amp;mut self, kind: ContextKind, value: ContextValue) -&gt; Option&lt;ContextValue&gt; {
+    pub fn remove(&amp;mut self, kind: ContextKind) -&gt; Option&lt;ContextValue&gt; {
-        self.inner.context.insert(kind, value)
+        self.inner.context.remove(&amp;kind)
=    }
</code></pre>
Alternatives, if applicable
<p>I&#x27;ve already gone over them, including exposing specifically the inner prettier and inner help flag params, this solution is cleaner.</p>
Additional Context
ðŸš€
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by <a href="https://github.com/5HT2">@5HT2</a> on 2024-01-08 13:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-01-08 13:38</div>
            <div class="timeline-body"><p>Whats helpful in discussing potential solutions (plural is intentional) is an understanding of the problem.  Could you provide more details on what problems you are having with the errors being generated by clap?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-help</span> added by <a href="https://github.com/epage">@epage</a> on 2024-01-08 13:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/5HT2">@5HT2</a> on 2024-01-08 17:30</div>
            <div class="timeline-body"><p>I don&#x27;t find all parts of the generated error context useful, from an end user perspective, and occasionally the default inner help flags end up bloating the error output of my libraries, which I would rather be able to trim selectively on my end.</p>
<p>Given the fact that you can&#x27;t access the inner pretty nor the inner help flags directly, it would be inconvenient to just expose all of them via a public API, and it makes more sense to be able to trim them via an opposite equivalent to the existing <code>Error::insert</code> function.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-01-08 17:41</div>
            <div class="timeline-body"><blockquote>
<p>I don&#x27;t find all parts of the generated error context useful, from an end user perspective, and occasionally the default inner help flags end up bloating the error output of my libraries, which I would rather be able to trim selectively on my end.</p>
</blockquote>
<p>Could you give more concrete examples</p>
<blockquote>
<p>Given the fact that you can&#x27;t access the inner pretty nor the inner help flags directly, it would be inconvenient to just expose all of them via a public API, and it makes more sense to be able to trim them via an opposite equivalent to the existing Error::insert function.</p>
</blockquote>
<p>Currently, our primary way of customizing is through custom formatters.  If there are APIs missing for those, it is a bug.  However, I can understand the extra work it is to replace the formatter completely, rather than customizing the values.</p>
<p>Better understanding what routes we want to support is dependent on knowing what people are trying to accomplish.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 20:00:02 UTC
    </footer>
</body>
</html>
