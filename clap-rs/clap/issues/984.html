<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>takes_value does not always works - clap-rs/clap #984</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>takes_value does not always works</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/984">#984</a>
        opened by <a href="https://github.com/mantal">@mantal</a>
        on 2017-06-09 11:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mantal">@mantal</a> on 2017-06-09 11:58</div>
            <div class="timeline-body"><pre><code>    let matches = App::new(&quot;foo&quot;)
        .arg(Arg::with_name(&quot;a&quot;)
             .short(&quot;a&quot;)
             .takes_value(true)
             )
        .arg(Arg::with_name(&quot;b&quot;)
             .short(&quot;b&quot;)
             )
        .get_matches();
}
</code></pre>
<p>Launching this program with <code>-a -b</code> does not produce error as it should.</p>
<p><code>clap 2.24.2</code> with <code>rustc 1.17.0</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-06-16 15:24</div>
            <div class="timeline-body"><p>This should be:</p>
<pre><code class="language-rust">let matches = App::new(&quot;foo&quot;)
    .arg(Arg::with_name(&quot;a&quot;)
        .short(&quot;a&quot;)
        .takes_value(true)
        .empty_values(false)   // Added this &lt;-----    
    )
    .arg(Arg::with_name(&quot;b&quot;)
        .short(&quot;b&quot;)
    )
    .get_matches();
</code></pre>
<p>https://docs.rs/clap/2.24.2/clap/struct.Arg.html#method.empty_values</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> added by @kbknapp on 2017-06-16 15:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2017-06-20 03:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mantal">@mantal</a> on 2017-06-20 10:15</div>
            <div class="timeline-body"><p>The documentation state that explicit empty values are allowed but this is implicit.
But if they are allowed too, that mean that <code>-b -a</code> incorrectly produce an error.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @kbknapp on 2017-07-21 03:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-07-21 03:45</div>
            <div class="timeline-body"><p>I've re-opened this as a docs issue, but it should be moot shortly as I'm trying to fix this for 3.x :wink:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: docs</span> added by @kbknapp on 2017-07-21 03:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> removed by @kbknapp on 2017-07-21 03:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v3-beta.1" by @kbknapp on 2018-07-22 02:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by @kbknapp on 2018-07-22 02:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: enhancement</span> added by @kbknapp on 2018-07-22 02:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> added by @kbknapp on 2018-07-22 02:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by @kbknapp on 2018-07-22 02:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">M: mentored</span> added by @kbknapp on 2018-07-22 02:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @kbknapp on 2018-07-22 02:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1339.html">clap-rs/clap#1339</a> on 2018-09-13 00:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fvictorio">@fvictorio</a> on 2019-11-28 20:38</div>
            <div class="timeline-body"><p>Hi @kbknapp, I looked into this in the <code>v2</code> branch with the reproduction steps of #1339, but this is something you want to fix in v3, is that right?</p>
<p>Anyway, if this is still open, and you can give me some pointers, I would love to give it a try.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Dylan-DPC-zz">@Dylan-DPC-zz</a> on 2019-11-28 20:41</div>
            <div class="timeline-body"><p>@fvictorio yes, we want it preferably on v3 (which is currently master iirc). We can always backport if required. Let me know if you need any help with this</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fvictorio">@fvictorio</a> on 2019-11-28 21:35</div>
            <div class="timeline-body"><p>Thanks @Dylan-DPC. I added this (failing) test:</p>
<pre><code class="language-rust">
#[test]
fn issue_984_takes_value_and_default_value() {
    let m = App::new(&quot;hello&quot;)
        .arg(
            Arg::with_name(&quot;exit-code&quot;)
                .long(&quot;exit-code&quot;)
                .required(true)
                .takes_value(true)
                .default_value(&quot;0&quot;),
        )
        .try_get_matches_from(vec![&quot;hello&quot;, &quot;--exit-code&quot;]);
    assert!(m.is_err());
    assert_eq!(m.unwrap_err().kind, ErrorKind::EmptyValue);
}
</code></pre>
<p>Then I looked into the code, but I'm not really sure who should be responsible for this. The <code>add_defaults</code> method in <code>parser.rs</code> is the one that ignores the fact that the argument was specified but without a value, but it doesn't seem to return an error in any path. There's also <code>parse_opt</code> that performs some checks, but when I added one (very naively) it broke some other tests.</p>
<p>What function should be handling this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "v3-beta.1" by @pksunkara on 2020-02-01 07:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v3.0" by @pksunkara on 2020-02-01 07:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: asserts</span> added by @pksunkara on 2020-04-12 21:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: asserts</span> removed by @pksunkara on 2020-04-12 21:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-12 21:56</div>
            <div class="timeline-body"><p>The issue in the original comment has been fixed on master. <code>takes_value</code> and <code>default_value</code> situation is described in https://github.com/clap-rs/clap/issues/1545</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @pksunkara on 2020-04-12 21:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:07 UTC
    </footer>
</body>
</html>
