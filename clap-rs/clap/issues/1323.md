```yaml
number: 1323
title: Bug in error message for required conflicted args
type: issue
state: closed
author: kpp
labels:
  - C-bug
  - A-parsing
assignees: []
created_at: 2018-07-20T18:09:03Z
updated_at: 2020-12-12T12:18:53Z
url: https://github.com/clap-rs/clap/issues/1323
synced_at: 2026-01-10T01:57:42Z
```

# Bug in error message for required conflicted args

---

_Issue opened by @kpp on 2018-07-20 18:09_

### Rust Version

`rustc 1.29.0-nightly (12ed235ad 2018-07-18)`

### Affected Version of clap

`2.32.0`

### Bug Summary

There are 4 args: `a`, `b`, `c`, `d`. You may only provide 2 of them at a time: (`a` or `b`) AND (`c` or `d`). If you provide `c` and don't provide (`a` or `b`) the clap tells you that `a`, `b`, `d` were not provided while `d` is in a conflict with `c`.

### Expected Behavior Summary

```
error: The following required arguments were not provided:
    --a <a>
    --b <b>
```

### Actual Behavior Summary

```
error: The following required arguments were not provided:
    --a <a>
    --b <b>
    --d <d>
```


### Steps to Reproduce the issue

`$ cargo run -- --c asd`

### Sample Code or Link to Sample Code

```rust
extern crate clap;
use clap::{Arg, App};

fn main() {
    let matches = App::new("My Super Program")
        .arg(Arg::with_name("a")
           .long("a")
           .takes_value(true)
           .required_unless("b")
           .conflicts_with("b")
        )
        .arg(Arg::with_name("b")
            .long("b")
            .takes_value(true)
            .required_unless("a")
            .conflicts_with("a")
        )
        .arg(Arg::with_name("c")
           .long("c")
           .takes_value(true)
           .required_unless("d")
           .conflicts_with("d")
        )
        .arg(Arg::with_name("d")
           .long("d")
           .takes_value(true)
           .required_unless("c")
           .conflicts_with("c")
        )
        .get_matches();
}
```

### Debug output

<details>
<summary> Debug Output </summary>
<pre>
<code>

```
     Running `target/debug/clap_test --c asd`
DEBUG:clap:Parser::propagate_settings: self=My Super Program, g_settings=AppFlags(
    (empty)
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:Parser::get_matches_with: Begin parsing '"--c"' ([45, 45, 99])
DEBUG:clap:Parser::is_new_arg:"--c":NotFound
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: -- found
DEBUG:clap:Parser::is_new_arg: starts_new_arg=true
DEBUG:clap:Parser::possible_subcommand: arg="--c"
DEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None
DEBUG:clap:ArgMatcher::process_arg_overrides:None;
DEBUG:clap:Parser::parse_long_arg;
DEBUG:clap:Parser::parse_long_arg: Does it contain '='...No
DEBUG:clap:OptBuilder::fmt:c
DEBUG:clap:Parser::parse_long_arg: Found valid opt '--c <c>'
DEBUG:clap:Parser::parse_opt; opt=c, val=None
DEBUG:clap:Parser::parse_opt; opt.settings=ArgFlags(REQUIRED | EMPTY_VALS | TAKES_VAL | DELIM_NOT_SET)
DEBUG:clap:Parser::parse_opt; Checking for val...None
DEBUG:clap:ArgMatcher::inc_occurrence_of: arg=c
DEBUG:clap:ArgMatcher::inc_occurrence_of: first instance
DEBUG:clap:Parser::groups_for_arg: name=c
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:Parser::parse_opt: More arg vals required...
DEBUG:clap:Parser:get_matches_with: After parse_long_arg Opt("c")
DEBUG:clap:Parser::get_matches_with: Begin parsing '"asd"' ([97, 115, 100])
DEBUG:clap:Parser::is_new_arg:"asd":Opt("c")
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: probably value
DEBUG:clap:Parser::is_new_arg: starts_new_arg=false
DEBUG:clap:Parser::add_val_to_arg; arg=c, val="asd"
DEBUG:clap:Parser::add_val_to_arg; trailing_vals=false, DontDelimTrailingVals=false
DEBUG:clap:Parser::add_single_val_to_arg;
DEBUG:clap:Parser::add_single_val_to_arg: adding val..."asd"
DEBUG:clap:Parser::groups_for_arg: name=c
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:ArgMatcher::needs_more_vals: o=c
DEBUG:clap:ArgMatcher::process_arg_overrides:Some("c");
DEBUG:clap:Parser::remove_overrides:[];
DEBUG:clap:Validator::validate;
DEBUG:clap:Parser::add_defaults;
DEBUG:clap:Parser::add_defaults:iter:a: doesn't have conditional defaults
DEBUG:clap:Parser::add_defaults:iter:a: doesn't have default vals
DEBUG:clap:Parser::add_defaults:iter:b: doesn't have conditional defaults
DEBUG:clap:Parser::add_defaults:iter:b: doesn't have default vals
DEBUG:clap:Parser::add_defaults:iter:c: doesn't have conditional defaults
DEBUG:clap:Parser::add_defaults:iter:c: doesn't have default vals
DEBUG:clap:Parser::add_defaults:iter:d: doesn't have conditional defaults
DEBUG:clap:Parser::add_defaults:iter:d: doesn't have default vals
DEBUG:clap:Validator::validate_blacklist;
DEBUG:clap:Validator::validate_blacklist:iter:c;
DEBUG:clap:Parser::groups_for_arg: name=c
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:Validator::validate_required: required=["a", "b", "c", "d"];
DEBUG:clap:Validator::validate_required:iter:a:
DEBUG:clap:Validator::is_missing_required_ok: a=a
DEBUG:clap:Validator::validate_arg_conflicts: a="a";
DEBUG:clap:Validator::validate_required_unless: a="a";
DEBUG:clap:Validator::missing_required_error: extra=None
DEBUG:clap:Parser::color;
DEBUG:clap:Parser::color: Color setting...Auto
DEBUG:clap:is_a_tty: stderr=true
DEBUG:clap:Validator::missing_required_error: reqs=[
    "a",
    "b",
    "d"
]
DEBUG:clap:usage::get_required_usage_from: reqs=["a", "b", "d"], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=["a", "b", "d"]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:usage::get_required_usage_from:iter:a:
DEBUG:clap:OptBuilder::fmt:a
DEBUG:clap:usage::get_required_usage_from:iter:b:
DEBUG:clap:OptBuilder::fmt:b
DEBUG:clap:usage::get_required_usage_from:iter:d:
DEBUG:clap:OptBuilder::fmt:d
DEBUG:clap:Colorizer::error;
DEBUG:clap:Colorizer::error;
DEBUG:clap:Colorizer::error;
DEBUG:clap:Validator::missing_required_error: req_args="\n    \u{1b}[1;31m--a <a>\u{1b}[0m\n    \u{1b}[1;31m--b <b>\u{1b}[0m\n    \u{1b}[1;31m--d <d>\u{1b}[0m"
DEBUG:clap:usage::create_usage_with_title;
DEBUG:clap:usage::create_usage_no_title;
DEBUG:clap:usage::get_required_usage_from: reqs=["a", "b", "c", "d"], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=["a", "b", "c", "d"]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:usage::get_required_usage_from:iter:a:
DEBUG:clap:OptBuilder::fmt:a
DEBUG:clap:usage::get_required_usage_from:iter:b:
DEBUG:clap:OptBuilder::fmt:b
DEBUG:clap:usage::get_required_usage_from:iter:c:
DEBUG:clap:OptBuilder::fmt:c
DEBUG:clap:usage::get_required_usage_from:iter:d:
DEBUG:clap:OptBuilder::fmt:d
DEBUG:clap:usage::needs_flags_tag;
DEBUG:clap:usage::needs_flags_tag:iter: f=hclap_help;
DEBUG:clap:usage::needs_flags_tag:iter: f=vclap_version;
DEBUG:clap:usage::needs_flags_tag: [FLAGS] not required
DEBUG:clap:usage::create_help_usage: usage=clap_test --a <a> --b <b> --c <c> --d <d>
DEBUG:clap:Parser::color;
DEBUG:clap:Parser::color: Color setting...Auto
DEBUG:clap:is_a_tty: stderr=true
DEBUG:clap:Colorizer::error;
DEBUG:clap:Colorizer::good;
error: The following required arguments were not provided:
    --a <a>
    --b <b>
    --d <d>
```

</code>
</pre>
</details>


---

_Comment by @kbknapp on 2018-07-21 02:44_

Thanks for reporting, I'll look into this :+1: 

---

_Label `T: bug` added by @kbknapp on 2018-07-22 02:43_

---

_Label `P2: need to have` added by @kbknapp on 2018-07-22 02:43_

---

_Label `D: intermediate` added by @kbknapp on 2018-07-22 02:43_

---

_Label `C: parsing` added by @kbknapp on 2018-07-22 02:43_

---

_Label `W: 3.x` added by @kbknapp on 2018-07-22 02:43_

---

_Added to milestone `v3-alpha.1` by @kbknapp on 2018-07-22 02:43_

---

_Removed from milestone `v3-alpha.2` by @pksunkara on 2020-02-01 07:45_

---

_Added to milestone `v3.0` by @pksunkara on 2020-02-01 07:45_

---

_Comment by @CreepySkeleton on 2020-06-30 13:41_

And that's what you get with master:
```
error: The following required arguments were not provided:
    --a <a>

USAGE:
    probe.exe --a <a>
```

---

_Comment by @pksunkara on 2020-06-30 23:06_

So, the behaviour has changed but it's still not correct, right?

---

_Comment by @CreepySkeleton on 2020-07-01 01:36_

Right

---

_Referenced in [clap-rs/clap#2251](../../clap-rs/clap/pulls/2251.md) on 2020-12-11 21:35_

---

_Closed by @pksunkara on 2020-12-12 12:18_

---
