<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add support for the trait From&lt;regex::RegexSet&gt; to Arg - clap-rs/clap #2675</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add support for the trait From&lt;regex::RegexSet&gt; to Arg</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/2675">#2675</a>
        opened by <a href="https://github.com/PandH4cker">@PandH4cker</a>
        on 2021-08-10 11:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/PandH4cker">@PandH4cker</a> on 2021-08-10 11:07</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
<h3>Clap Version</h3>
<p>3.0.0-beta.2</p>
<h3>Describe your use case</h3>
<p>It would be nice that clap handle not only a single RegEx in the <em>validator_regex() function</em> but a RegexSet.
RegexSet are useful to combine multiple regex together and check if any of the regex provided match the string to test.</p>
<h3>What I standed for BEFORE <em>validator_regex()</em>:</h3>
<p>This is what I did in conjunction to <em>validator() function</em>.</p>
<pre><code class="language-rust">use lazy_static::lazy_static;
use regex::Regex;

pub fn is_hosts(v: &amp;str) -&gt; Result&lt;(), String&gt; {
    lazy_static! {
        static ref HOSTNAME_REGEX: Regex = Regex::new(r&quot;(?x)
            ^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])
            (\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9]))*$
        &quot;).unwrap();
        static ref IP_REGEX: Regex = Regex::new(r&quot;(?x)
            ^((\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])\.){3}
            (\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])$
        &quot;).unwrap();
        static ref NETINT_REGEX: Regex = Regex::new(r&quot;(?x)
            ^((\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])\.){3}
            (\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])/([1-9]|[12]\d|3[012])$
        &quot;).unwrap();
    }
    match HOSTNAME_REGEX.is_match(v) || IP_REGEX.is_match(v) || NETINT_REGEX.is_match(v) {
        true =&gt; {
            Ok(())
        }
        false =&gt; {
            Err(format!(&quot;{} isn't a host nor an ip nor a network interface&quot;, v))
        }
    }
}
</code></pre>
<h3>What I standed for AFTER <em>validator_regex()</em>:</h3>
<p>So I would like to do this kind of thing:</p>
<pre><code class="language-rust">//In the module that generate the App
App::new(&quot;...&quot;)
// [SNIP...]
      .arg(
            Arg::new(target::NAME)
                .last(true)
                .takes_value(true)
                .value_delimiter(&quot; &quot;)
                .multiple(true)
                //.validator(validators::net::is_hosts)
                .validator_regex(HOST_REGEXSET, &quot;only hostnames, ip, network intefaces are allowed&quot;)
                .required_unless_present_any(&amp;[input_list::NAME, input_random::NAME])
                .display_order(1)
     )
</code></pre>
<pre><code class="language-rust">//In a module of constants variables
use regex::RegexSet;

const HOSTNAME_REGEX_STR : &amp;str = r&quot;(?x)
            ^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])
            (\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9]))*$
&quot;;
const IP_REGEX_STR : &amp;str = r&quot;(?x)
            ^((\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])\.){3}
            (\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])$
&quot;;
const NETINT_REGEX_STR : &amp;str = r&quot;(?x)
            ^((\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])\.){3}
            (\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])/([1-9]|[12]\d|3[012])$
&quot;;
pub const HOST_REGEXSET : RegexSet = RegexSet::new(&amp;[
    HOSTNAME_REGEX_STR,
    IP_REGEX_STR,
    NETINT_REGEX_STR
]).unwrap();
</code></pre>
<h3>Describe the solution you'd like</h3>
<p>I would like a function or an implementation to <strong>validate the RegexSet</strong> like the <em>validator_regex()</em>:</p>
<pre><code class="language-rust">impl&lt;'a&gt; From&lt;RegexSet&gt; for RegexRef&lt;'a&gt; {
    fn from(r: RegexSet) -&gt; Self {
        RegexRef(Cow::Owned(r))
    }
}
</code></pre>
<p>But RegexRef take a Cow&lt;'a, Regex&gt;, maybe you should refactor this to have RegexSet instead ?</p>
<h3>Alternatives, if applicable</h3>
<p>The solution I standed before the <em>validator_regex()</em> works fine, I would like to know:</p>
<p><em>Which one of these both solutions are the most effective ?</em></p>
<p>Since I am not figuring out yet : <em>How could I use the lazy_static to improve the effectiveness of the regex compilation combining to store it in a constant variable and be reusable further in the code ?</em></p>
<p>So until there is not an implementation for handling RegexSet I would use the validator and my match pattern ðŸ˜„ .</p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by @PandH4cker on 2021-08-10 11:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: validators</span> added by @pksunkara on 2021-08-10 23:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @pksunkara on 2021-08-10 23:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.0" by @epage on 2021-10-16 18:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @epage on 2021-10-16 18:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2899.html">clap-rs/clap#2899</a> on 2021-10-16 21:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @bors[bot] on 2021-10-16 22:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-05-23 20:22</div>
            <div class="timeline-body"><p>FYI I am considering removing <code>validator_regex</code>, see #3743</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:08 UTC
    </footer>
</body>
</html>
