<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`name` implies a user-facing meaning, causing confusion - clap-rs/clap #3335</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>name</code> implies a user-facing meaning, causing confusion</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/3335">#3335</a>
        opened by <a href="https://github.com/pwinckles">@pwinckles</a>
        on 2022-01-24 16:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/pwinckles">@pwinckles</a></div>
            <div class="timeline-body"><p>Maintainer's notes:</p>
<ul>
<li>The root cause was <a href="https://github.com/clap-rs/clap/issues/3335#issuecomment-1020308017">confusion over <code>name</code> vs <code>value_name</code> and impact on the rest of the API</a></li>
<li>We should look into renaming <code>Arg::name</code> to <code>Arg::id</code></li>
<li>We should also resolve https://github.com/clap-rs/clap/issues/2475 which is possible because we (should be) setting <code>value_name</code> on people's behalf.</li>
</ul>
<hr />
<h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.58.1 (db9d1b20b 2022-01-20)</p>
<h3>Clap Version</h3>
<p>3.0.10</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">use clap::Parser;

#[derive(Debug, Parser)]
pub struct Example {
    #[clap(short = 'S', long, conflicts_with = &quot;version&quot;)]
    pub staged: bool,

    #[clap(name = &quot;OBJ_ID&quot;)]
    pub object_id: String,

    #[clap(name = &quot;VERSION&quot;)]
    pub version: Option&lt;String&gt;,
}

fn main() {
    println!(&quot;{:?}&quot;, Example::parse());
}
</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<pre><code class="language-shell">cargo run -- asdf
</code></pre>
<h3>Actual Behaviour</h3>
<p>Panics:</p>
<pre><code>thread 'main' panicked at 'App clap-example: Argument or group 'version' specified in 'conflicts_with*' for 'staged' does not exist', /home/pwinckles/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.0.10/src/build/app/debug_asserts.rs:171:13
</code></pre>
<h3>Expected Behaviour</h3>
<p>It should not panic. I would expect Clap to enforce that the <code>staged</code> flag cannot be set if a <code>version</code> positional arg is provided, and otherwise allow the flag to be present or not.</p>
<h3>Additional Context</h3>
<p><code>conflicts_with</code> works as expected when conflicting with another flag. The problem seems to be when conflicting with an optional positional arg.</p>
<h3>Debug Output</h3>
<pre><code>[            clap::build::app] 	App::_do_parse
[            clap::build::app] 	App::_build
[            clap::build::app] 	App::_propagate:clap-example
[            clap::build::app] 	App::_check_help_and_version
[            clap::build::app] 	App::_check_help_and_version: Removing generated version
[            clap::build::app] 	App::_propagate_global_args:clap-example
[            clap::build::app] 	App::_derive_display_order:clap-example
[clap::build::app::debug_asserts] 	App::_debug_asserts
[clap::build::arg::debug_asserts] 	Arg::_debug_asserts:help
[clap::build::arg::debug_asserts] 	Arg::_debug_asserts:staged
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @pwinckles on 2022-01-24 16:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`conflicts_with` on a flag does not work when conflicting with a positional arg" to "`conflicts_with` on a flag panics when conflicting with a positional arg" by @pwinckles on 2022-01-24 16:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-01-24 16:49</div>
            <div class="timeline-body"><pre><code class="language-rust">use clap::Parser;

#[derive(Debug, Parser)]
pub struct Example {
    #[clap(short = 'S', long, conflicts_with = &quot;version&quot;)]
    pub staged: bool,

    #[clap(name = &quot;OBJ_ID&quot;)]
    pub object_id: String,

    #[clap(name = &quot;VERSION&quot;)]
    pub version: Option&lt;String&gt;,
}

fn main() {
    println!(&quot;{:?}&quot;, Example::parse());
}
</code></pre>
<p>should be</p>
<pre><code class="language-rust">use clap::Parser;

#[derive(Debug, Parser)]
pub struct Example {
    #[clap(short = 'S', long, conflicts_with = &quot;VERSION&quot;)]
    pub staged: bool,

    #[clap(name = &quot;OBJ_ID&quot;)]
    pub object_id: String,

    #[clap(name = &quot;VERSION&quot;)]
    pub version: Option&lt;String&gt;,
}

fn main() {
    println!(&quot;{:?}&quot;, Example::parse());
}
</code></pre>
<p>With <code>name</code>, you overrode the ID for referencing the version argument within clap, so you need to update references to that ID as well.</p>
<p>Most likely what you want is <code>value_name</code> instead of <code>name</code> (we do default <code>value_name</code> based on <code>name</code>).</p>
<pre><code class="language-rust">use clap::Parser;

#[derive(Debug, Parser)]
pub struct Example {
    #[clap(short = 'S', long, conflicts_with = &quot;version&quot;)]
    pub staged: bool,

    #[clap(value_name = &quot;OBJ_ID&quot;)]
    pub object_id: String,

    #[clap(value_name = &quot;VERSION&quot;)]
    pub version: Option&lt;String&gt;,
}

fn main() {
    println!(&quot;{:?}&quot;, Example::parse());
}
</code></pre>
<p>This kind of confusion is why I want to rename it from <code>name</code> to <code>id</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pwinckles">@pwinckles</a> on 2022-01-24 16:52</div>
            <div class="timeline-body"><p>:blush:</p>
<p>Thank you! You are correct that I was confusing <code>name</code> with <code>value_name</code>. Sorry for the trouble.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`conflicts_with` on a flag panics when conflicting with a positional arg" to "`name` implies a user-facing meaning, causing confusion" by @epage on 2022-01-24 16:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-builder</span> added by @epage on 2022-01-24 16:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-experimental</span> added by @epage on 2022-01-24 16:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-01-24 17:00</div>
            <div class="timeline-body"><p>Keeping this open as a use case for why we should explore changing <code>Arg::name</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pwinckles">@pwinckles</a> on 2022-01-24 17:14</div>
            <div class="timeline-body"><p>For what it's worth, I experienced the issue because I migrated from clap 2 + structopt, and structopt includes an example like the following in its docs:</p>
<pre><code>    /// File name: only required when `out-type` is set to `file`
    #[structopt(name = &quot;FILE&quot;, required_if(&quot;out-type&quot;, &quot;file&quot;))]
    file_name: Option&lt;String&gt;,
</code></pre>
<p>I looked at the docs for clap 3, and I do think it's clear what <code>name</code> does, though I agree that it isn't intuitive without reading the docs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">M-breaking-change</span> added by @epage on 2022-01-24 17:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "4.0" by @epage on 2022-01-24 17:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2475.html">clap-rs/clap#2475</a> on 2022-02-11 20:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3453.html">clap-rs/clap#3453</a> on 2022-02-11 20:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2022-02-11 20:28</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:48:24 UTC
    </footer>
</body>
</html>
