```yaml
number: 4133
title: "clap::Error to colored string"
type: issue
state: closed
author: sigoden
labels:
  - C-enhancement
  - A-help
  - S-blocked
assignees: []
created_at: 2022-08-27T12:36:27Z
updated_at: 2022-09-28T16:15:53Z
url: https://github.com/clap-rs/clap/issues/4133
synced_at: 2026-01-10T01:57:47Z
```

# clap::Error to colored string

---

_Issue opened by @sigoden on 2022-08-27 12:36_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Clap Version

master

### Describe your use case

I make a bash cli tool(https://github.com/sigoden/argc), it use clap as cli parser.

A pr(https://github.com/sigoden/argc/issues/37) have been submitted for request colored help and colored error message.

So I need a way to covert clap::Error to colored string.

### Describe the solution you'd like

The easiest way is to expose following two apis.

1.  [clap::error::Error::formatted](https://github.com/clap-rs/clap/blob/a2f3ee2cfa3767ed6ddd6c8c27ec154ef3f8a890/src/error/mod.rs#L500)

2. [clap::builder::StyledStr::write_colored](https://github.com/clap-rs/clap/blob/a2f3ee2cfa3767ed6ddd6c8c27ec154ef3f8a890/src/builder/styled_str.rs#L145)

A better way is to add a `to_color_string` function to clap::error::Error 
```
impl Error {
    #[cfg(feature = "color")]
    pub fn to_colored_string(&self) -> String {

    }
}
```

### Alternatives, if applicable

_No response_

### Additional Context

_No response_

---

_Label `C-enhancement` added by @sigoden on 2022-08-27 12:36_

---

_Label `A-help` added by @epage on 2022-08-29 13:09_

---

_Label `S-blocked` added by @epage on 2022-08-29 13:09_

---

_Added to milestone `4.x` by @epage on 2022-08-29 13:09_

---

_Comment by @epage on 2022-08-29 13:12_

Is there a reason you can't just use `Error::print` or `Error::exit`?

In clap 4.x, we are planning on changing how we handle terminal styling which will lead to use exposing something like what is proposed in here. 

---

_Comment by @sigoden on 2022-08-29 13:52_

Argc use bash `eval $(argc --argc-eval "$0" "$@")` to retrive passed variables from stdout, so the help text or error message must print to stderr.

`Error::print` or `Error::exit` will print to stdout in some situation(`ErrorKind::DisplayHelp | ErrorKind::DisplayVersion`). So I can't use them.



---

_Comment by @epage on 2022-08-29 14:25_

> Error::print or Error::exit will print to stdout in some situation(ErrorKind::DisplayHelp | ErrorKind::DisplayVersion). So I can't use them.

In the interim, you can check the error kind and conditionally do it based on that.

---

_Comment by @sigoden on 2022-08-29 14:56_

But I still need to print help(`ErrorKind::DisplayHelp`) to stderr. Is there a way to get the **colored** help string?

---

_Comment by @epage on 2022-08-29 15:00_

No, and there won't be until some time during clap 4.x.

I was providing a way to workaround the problem until we do provide an API for this.  This is my top clap priority once 4.0 is released.

---

_Comment by @epage on 2022-09-28 16:15_

Went ahead with this in #4248

---

_Closed by @epage on 2022-09-28 16:15_

---
