<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Default `--version` doesn't include newline - clap-rs/clap #1960</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Default <code>--version</code> doesn&#x27;t include newline</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1960">#1960</a>
        opened by <a href="https://github.com/tailhook">@tailhook</a>
        on 2020-06-04 11:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tailhook">@tailhook</a></div>
            <div class="timeline-body"><p>In version 2.33.0: <code>cargo run --example 01a_quick_example -- --version</code> prints version with the final newline. In the current master (f4ace424) it doesn&#x27;t include the newline which makes it inconvenient in some shells:</p>
<pre><code>[root@8428a91f4e1e /]# myapp --version
MyApp 1.0[root@8428a91f4e1e /]#
</code></pre>
<p>I couldn&#x27;t find an issue about that. Was the change intentional?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by <a href="https://github.com/tailhook">@tailhook</a> on 2020-06-04 11:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>geldata/gel-cli#76</a> on 2020-06-04 11:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/asteding">@asteding</a> on 2020-06-10 07:52</div>
            <div class="timeline-body"><p>Hello,
@tailhook which shell do you use?</p>
<p>On my <code>zsh</code> or <code>bash</code> right now i cannot confirm the bug for version <code>2.33.0</code></p>
<p>Best regards.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-06-10 07:58</div>
            <div class="timeline-body"><p>He&#x27;s talking about master</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-06-10 08:14</div>
            <div class="timeline-body"><p>This reproduces on linux (bash and zsh) but not on windows (CMD)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P1: urgent</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-06-10 08:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;3.0&quot; by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-06-10 08:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-06-10 08:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">Z: good first issue</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-06-10 08:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/asteding">@asteding</a> on 2020-06-10 08:56</div>
            <div class="timeline-body"><p>Oh I see. Sorry my bad.</p>
<p>I still digged into the code and probably</p>
<pre><code>    pub(crate) fn _write_version&lt;W: Write&gt;(&amp;self, w: &amp;mut W, use_long: bool) -&gt; io::Result&lt;()&gt; {
        debug!(&quot;App::_write_version&quot;);

        let ver = if use_long {
            self.long_version
                .unwrap_or_else(|| self.version.unwrap_or(&quot;&quot;))
        } else {
            self.version
                .unwrap_or_else(|| self.long_version.unwrap_or(&quot;&quot;))
        };
        if let Some(bn) = self.bin_name.as_ref() {
            if bn.contains(&#x27; &#x27;) {
                // In case we&#x27;re dealing with subcommands i.e. git mv is translated to git-mv
                write!(w, &quot;{} {}&quot;, bn.replace(&quot; &quot;, &quot;-&quot;), ver)
            } else {
                write!(w, &quot;{} {}&quot;, &amp;self.name[..], ver)
            }
        } else {
            write!(w, &quot;{} {}&quot;, &amp;self.name[..], ver)
        }
    }
</code></pre>
<p>Is lacking some <code>\n</code> for the <code>write!()</code> macros isn&#x27;t it? If i add them i get a new line in my bash.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-06-10 08:58</div>
            <div class="timeline-body"><p>Yeah the fix is as simple as that. Please make you add a test or update one if it already exists.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/asteding">@asteding</a> on 2020-06-10 12:24</div>
            <div class="timeline-body"><p>Okay so i think using a <code>writeln!(w, &quot;{} {}&quot;, bn.replace(&quot; &quot;, &quot;-&quot;), ver)</code> instead of <code>write!(w, &quot;{} {}&quot;, bn.replace(&quot; &quot;, &quot;-&quot;), ver)</code> is the best solution for this bug.</p>
<p>What I struggle with is a fitting test. Here&#x27;s the test code i added to <code>tests/help.rs</code></p>
<pre><code>static ISSUE_1960_MISSING_NEWLINE: &amp;str = &quot;soapsurfer 1.2.3\n&quot;;
#[test]
fn issue_1960_missing_newline() {
    let app = App::new(&quot;soapsurfer&quot;).version(&quot;1.2.3&quot;);
    assert!(utils::compare_output(
        app,
        &quot;soapsurfer --version&quot;,
        ISSUE_1960_MISSING_NEWLINE,
        false
    ))
}
</code></pre>
<p>But this test passes with and without the <code>\n</code> in <code>static ISSUE_1960_MISSING_NEWLINE: &amp;str = &quot;soapsurfer 1.2.3\n&quot;;</code></p>
<p>Any thoughts?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-06-10 12:27</div>
            <div class="timeline-body"><p>The tests might be using <code>trim</code> for the newline char.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/asteding">@asteding</a> on 2020-06-10 12:37</div>
            <div class="timeline-body"><p>Yes exaclty!
Nice, thanks a lot. It&#x27;s probably not a good idea to add a parameter <code>trim</code> to <code>compare_output()</code> so i probably write new testing functions in <code>utils.rs</code>? Would that be fitting?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-06-10 12:38</div>
            <div class="timeline-body"><p>Try removing <code>trim</code> from that function and see what functions fail.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/asteding">@asteding</a> on 2020-06-10 12:50</div>
            <div class="timeline-body"><p>The result okay so far. It&#x27;s only</p>
<pre><code>failures:
    dont_collapse_args
    issue_1093_allow_ext_sc
    require_eq
    skip_possible_values
    unified_help
</code></pre>
<p>Looking at e.g. the definition of <code>dont_collapse_args</code></p>
<pre><code>static DONT_COLLAPSE_ARGS: &amp;str = &quot;clap-test v1.4.8

USAGE:
    clap-test [arg1] [arg2] [arg3]

ARGS:
    &lt;arg1&gt;    some
    &lt;arg2&gt;    some
    &lt;arg3&gt;    some

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information&quot;;
</code></pre>
<p>There would now be the need to also add newline charater <code>\n</code> so:</p>
<pre><code>static DONT_COLLAPSE_ARGS: &amp;str = &quot;clap-test v1.4.8

USAGE:
    clap-test [arg1] [arg2] [arg3]

ARGS:
    &lt;arg1&gt;    some
    &lt;arg2&gt;    some
    &lt;arg3&gt;    some

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information\n&quot;;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/asteding">@asteding</a> on 2020-06-10 13:27</div>
            <div class="timeline-body"><p>It looks like a whole bunch of other test cases seems to be lacking <code>\n</code> at the end.
So what should I do?</p>
<p>edit: I probably found a good solution and i&#x27;m preparing the pull request so far.
Let&#x27;s see what you guys think of it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-06-10 13:59</div>
            <div class="timeline-body"><p>If it&#x27;s only a few tests you can add a new line to the fixtures</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#1972</a> on 2020-06-10 14:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/bors[bot]">@bors[bot]</a> on 2020-06-10 19:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>sharkdp/hexyl#131</a> on 2021-04-23 04:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>nervosnetwork/ckb-cli#417</a> on 2021-08-24 07:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:57:49 UTC
    </footer>
</body>
</html>
