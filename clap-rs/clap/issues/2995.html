<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhance error messages, check argument names for correctness - clap-rs/clap #2995</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Enhance error messages, check argument names for correctness</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/2995">#2995</a>
        opened by <a href="https://github.com/Tastaturtaste">@Tastaturtaste</a>
        on 2021-11-05 16:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Tastaturtaste">@Tastaturtaste</a> on 2021-11-05 16:58</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
<h3>Clap Version</h3>
<p>2.33.3</p>
<h3>Describe your use case</h3>
<p>Enhance error reporting to better guide the user to the underlying issue and to the corresponding documentation.
The (minimalized) issue triggering this request was me trying to set a argument as follows:</p>
<pre><code>use clap::{App, Arg};

fn main() {
    let args = App::new(&quot;prog&quot;)
        .arg(Arg::with_name(&quot;flag&quot;).long(&quot;flag&quot;).short(&quot;ff&quot;))
        .get_matches_from(vec![&quot;prog&quot;, &quot;-ff&quot;]);
    println!(&quot;{:?}&quot;, args);
}
</code></pre>
<p>As you can see I foolishly tried to set <code>.short(&quot;ff&quot;)</code> which does not work since <a href="https://docs.rs/clap/2.33.3/clap/struct.Arg.html#method.short">only the first non <code>-</code> character is used as the short argument</a>.
While the docs are quite clear about it, the error message I got is much less useful in my opinion:</p>
<blockquote>
<p>error: The argument '--flag' was provided more than once, but cannot be used multiple times</p>
</blockquote>
<p>My original use case involved more arguments, custom parsing, structopt, etc. and the cause of this issue was very much not obvious to me.</p>
<h3>Describe the solution you'd like</h3>
<p>What I would have liked to happen would be a Error or panic! out of the <code>.short</code> method, even before matching of the actual arguments happens, indicating that the provided short-name is not allowed.
While the docs are clear regarding this issue I did not even know to look there, instead thinking my custom parsing or the order of arguments messed some things up.</p>
<h3>Alternatives, if applicable</h3>
<p><em>No response</em></p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by @Tastaturtaste on 2021-11-05 16:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-11-05 17:06</div>
            <div class="timeline-body"><blockquote>
<p>.short(&quot;ff&quot;)</p>
</blockquote>
<p><code>clap</code> v3 changed the type for <code>short</code> from <code>&amp;str</code> to<code> char</code>, so this will now be a compile-time error.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Tastaturtaste">@Tastaturtaste</a> on 2021-11-05 17:32</div>
            <div class="timeline-body"><p>Wow, nice. I should maybe switch to the beta.
Also, that has to be one of the fastest responses I ever got on github, thanks üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @Tastaturtaste on 2021-11-05 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-11-05 17:59</div>
            <div class="timeline-body"><p>Docs are a weak point; we are waiting to see how things shake up first.  You can track how close we are at https://github.com/clap-rs/clap/milestone/76.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:34:41 UTC
    </footer>
</body>
</html>
