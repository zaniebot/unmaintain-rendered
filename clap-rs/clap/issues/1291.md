```yaml
number: 1291
title: Cannot order options versus positional arguments
type: issue
state: closed
author: gcp
labels: []
assignees: []
created_at: 2018-06-08T21:32:54Z
updated_at: 2018-08-02T03:30:24Z
url: https://github.com/clap-rs/clap/issues/1291
synced_at: 2026-01-10T01:57:42Z
```

# Cannot order options versus positional arguments

---

_Issue opened by @gcp on 2018-06-08 21:32_

### Affected Version of clap

version = "2.31.2"

### Expected Behavior Summary

```
    let matches = App::new("foo)
        .version(crate_version!())
        .about(env!("CARGO_PKG_DESCRIPTION"))
        .author(crate_authors!())
        .setting(AppSettings::TrailingVarArg)
        .arg(
            Arg::with_name("fd")
                .long("fd")
                .help("Starts as server communicating on fd#")
                .takes_value(true)
                .number_of_values(1)
                .required(true)
                .display_order(1)
                .conflicts_with("target"),
        )
        .arg(
            Arg::with_name("target")
                .help("Launches the target program")
                .index(1)
                .required(true)
                .conflicts_with("fd"),
        )
        .arg(
            Arg::with_name("target_args")
                .help("Arguments for the target program")
                .index(2)
                .multiple(true)
                .requires("target"),
        )
        .get_matches();
```

This prints:

```
USAGE:
    foo <target> --fd <fd> [target_args]...
```

It's not possible to order the "fd" argument before the positional ones in usage (display order 1 for fd vs default display order for target/target_args). DeriveDisplayOrder does not help either.

Because fd and target are exclusive, but target_args requires target, it is annoying that USAGE prints fd in-between target and target_args.

---

_Comment by @kbknapp on 2018-06-10 18:54_

The best way to do this is with an [`ArgGroup`](https://docs.rs/clap/2.31.2/clap/struct.ArgGroup.html). It's usually not advised to have two required arguments which are mutually exclusive. The preferred method is to add both mutually exclusive args to an `ArgGroup` and make that group required.

```rust
    let matches = App::new("foo")
        .version(crate_version!())
        .about(env!("CARGO_PKG_DESCRIPTION"))
        .author(crate_authors!())
        .setting(AppSettings::TrailingVarArg)
        .arg(
            Arg::with_name("fd")
                .long("fd")
                .help("Starts as server communicating on fd#")
                .takes_value(true)
                .number_of_values(1)
                .display_order(1)
                .conflicts_with("target"),
        )
        .arg(
            Arg::with_name("target")
                .help("Launches the target program")
                .index(1)
                .conflicts_with("fd"),
        )
        .arg(
            Arg::with_name("target_args")
                .help("Arguments for the target program")
                .index(2)
                .multiple(true)
                .requires("target"),
        )
        .group(
            ArgGroup::with_name("target_fd")
                .arg("fd")
                .arg("target")
                .required(true)
        )
        .get_matches();
```

However, this points out a different bug in the usage string printer :stuck_out_tongue_winking_eye: 

---

_Closed by @kbknapp on 2018-06-10 18:54_

---

_Comment by @kbknapp on 2018-06-10 18:54_

I'm going to close this issue, and open a new one for the bug this pointed out


---

_Comment by @kbknapp on 2018-06-10 19:05_

See #1292 

---

_Comment by @gcp on 2018-06-21 15:21_

I'm testing this suggestion now, but (aside from the printing issue), it does not work. I wonder if I didn't manage to explain the expected behavior well enough.

There are two uses for my program:

```foo --fd 5```

or

```foo vim file.txt```

This works as intended, except for the argument printing order in the help or usage suggestion not being modifiable (and awkward by default). If I follow your suggestion, I'll get an error like ```error: The argument '--fd <fd>' cannot be used with one or more of the other specified arguments```



---

_Comment by @gcp on 2018-06-21 15:25_

That is, the code I pasted works as expected, but prints:

```
USAGE:
    foo <target> --fd <fd> [target_args]...
```

Trying to modify the argument order to make it read:
```
USAGE:
    foo --fd <fd> <target> [target_args]...
```

Does not work.

---

_Comment by @kbknapp on 2018-06-22 15:47_

You can also specify a usage string manually with `App::usage` which then ignores the autogenerated one.

---
