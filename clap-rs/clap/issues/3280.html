<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Derive should only show help when argc==1 rather than missing subcommand - clap-rs/clap #3280</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Derive should only show help when argc==1 rather than missing subcommand</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/3280">#3280</a>
        opened by <a href="https://github.com/epage">@epage</a>
        on 2022-01-11 17:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a></div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.57.0 (f1edd0429 2021-11-29)</p>
<h3>Clap Version</h3>
<p>v3.0.6</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">use clap::{AppSettings, Parser, Subcommand};

#[derive(Parser)]
#[clap(author, version, about, long_about = None)]
#[clap(global_setting(AppSettings::PropagateVersion))]
#[clap(global_setting(AppSettings::UseLongFormatForHelpSubcommand))]
struct Cli {
    #[clap(short, long, parse(from_occurrences), global = true)]
    verbose: usize,

    #[clap(subcommand)]
    command: Commands,
}

#[derive(Subcommand)]
enum Commands {
    /// Adds files to myapp
    Add { name: Option&lt;String&gt; },
}

fn main() {
    let cli = Cli::parse();

    // You can check for the existence of subcommands, and if found use their
    // matches just as you would the top level app
    match &amp;cli.command {
        Commands::Add { name } =&gt; {
            println!(&quot;'myapp add' was used, name is: {:?}&quot;, name)
        }
    }
}

</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<pre><code class="language-console">$ cargo run -- -v
</code></pre>
<h3>Actual Behaviour</h3>
<pre><code class="language-console">$ cargo run -- -v
   Compiling test-clap v0.1.0 (/home/epage/src/personal/test-clap)
    Finished dev [unoptimized + debuginfo] target(s) in 0.70s
     Running `target/debug/test-clap -v`
test-clap 0.1.0
Me
From Cargo.toml

USAGE:
    test-clap [OPTIONS] &lt;SUBCOMMAND&gt;

OPTIONS:
    -h, --help       Print help information
    -v, --verbose    
    -V, --version    Print version information

SUBCOMMANDS:
    add     Adds files to myapp
    help    Print this message or the help of the given subcommand(s)

</code></pre>
<h3>Expected Behaviour</h3>
<pre><code class="language-console">$ cargo run -- -v
   Compiling test-clap v0.1.0 (/home/epage/src/personal/test-clap)
    Finished dev [unoptimized + debuginfo] target(s) in 0.67s
     Running `target/debug/test-clap -v`
error: 'test-clap' requires a subcommand, but one was not provided

USAGE:
    test-clap [OPTIONS] &lt;SUBCOMMAND&gt;

For more information try --help
</code></pre>
<h3>Additional Context</h3>
<p>To reproduce the desired behavior:</p>
<pre><code class="language-rust">#[clap(setting(AppSettings::SubcommandRequired))]
#[clap(setting(AppSettings::ArgRequiredElseHelp))]
#[clap(unset_setting(AppSettings::SubcommandRequiredElseHelp))]
</code></pre>
<p>This was inspired by a conversation in #2513</p>
<p>In my mind, showing of help should be reserved for when the user has taken no action but <code>SubcommandRequired</code> allows the user to pass some arguments.  In those cases, we should be showing a more specific error message than a long, generic message that takes the user some work to figure out what the next steps are.</p>
<h3>Debug Output</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @epage on 2022-01-11 17:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-decision</span> added by @epage on 2022-01-11 17:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-builder</span> added by @epage on 2022-01-11 17:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-derive</span> added by @epage on 2022-01-11 17:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-01-11 17:59</div>
            <div class="timeline-body"><p>I do not think this dramatically breaks user expectations that this would be considered a breaking change and can happen anytime,</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-01-11 18:01</div>
            <div class="timeline-body"><p>Personally, I think we should deprecate and remove <code>SubcommandRequiredElseHelp</code> in favor of <code>SubcommandRequired | ArgRequiredElseHelp</code> (resolving this issue doesn't need to be blocked on a decision about this but we will then need to create a separate issue).  The behavior seems too close to justify having both.  We are working to find ways to simplify clap to reduce API overhead (didn't know you could get this better behavior and actually thought this was what I was getting) and code bloat from too much built-in customization.</p>
<p>29ca7b2f74376ca0cdb9d8ee3bfa99f7640cc404 and #133 don't include details as to why we have both.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-decision</span> removed by @epage on 2022-01-11 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-builder</span> removed by @epage on 2022-01-11 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-easy</span> added by @epage on 2022-01-11 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-01-11 18:02</div>
            <div class="timeline-body"><p>I guess a question for 4.0 is if we should stop including <code>ArgRequiredElseHelp</code> by default and require users to opt-in.  I'm mixed on that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2513.html">clap-rs/clap#2513</a> on 2022-01-11 18:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2717.html">clap-rs/clap#2717</a> on 2022-02-10 19:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-02-11 17:57</div>
            <div class="timeline-body"><p>Experimented with this recently.  <code>SubcommandRequired</code> has higher precedence than <code>ArgRequiredElseHelp</code>.  We'd need to swap these.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3455.html">clap-rs/clap#3455</a> on 2022-02-11 21:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3456.html">clap-rs/clap#3456</a> on 2022-02-11 21:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../SeaQL/sea-orm/issues/664.html">SeaQL/sea-orm#664</a> on 2022-04-09 22:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.x" by @epage on 2022-05-09 20:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3721.html">clap-rs/clap#3721</a> on 2022-05-12 08:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.x" by @epage on 2022-06-08 16:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "4.0" by @epage on 2022-06-08 16:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3822.html">clap-rs/clap#3822</a> on 2022-06-14 12:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3969.html">clap-rs/clap#3969</a> on 2022-07-22 17:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2022-07-22 17:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/6001.html">clap-rs/clap#6001</a> on 2025-05-12 09:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:48:22 UTC
    </footer>
</body>
</html>
