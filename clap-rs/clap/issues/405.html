<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>argument with 'multiple' option enabled consumes subcommands that follow - clap-rs/clap #405</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>argument with &#x27;multiple&#x27; option enabled consumes subcommands that follow</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/405">#405</a>
        opened by <a href="https://github.com/Byron">@Byron</a>
        on 2016-01-31 11:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Byron">@Byron</a></div>
            <div class="timeline-body"><p>When I upgraded [google-apis-rs] to clap v2, I noticed that subcommands seem to be consumed by greedy options preceding them.</p>
<p>A command with usage (<em>truncated</em>) ...</p>
<pre><code>USAGE:
    drive3 [FLAGS] [OPTIONS] [SUBCOMMAND]
OPTIONS:
        --scope &lt;url&gt;...         Specify the authentication a method should be executed in.

SUBCOMMANDS:
    about          methods: &#x27;get&#x27;
[...]
</code></pre>
<p>... will not be able to parse its subcommands anymore when invoked with (for example):</p>
<pre><code>./drive3 --scope https://docs.google.com/feeds files list
# or 
./drive3 --scope=https://docs.google.com/feeds files list
</code></pre>
<p>This used to work with clap <em>v1</em>.</p>
How to reproduce
<ol>
<li>Download the previous version of the program that used clap v1 (<a href="http://dl.byronimo.de/google.rs/cli/0.3.1/osx/drive2.tar.gz">DL for osx</a>) and extract it.<ul>
<li>Run <code>./drive2 --scope foo files list</code> to see that it will attempt to use that scope, failing with <code>invalid scope</code></li>
</ul>
</li>
<li>Download the current version of the program that uses clap v2 (<a href="http://dl.byronimo.de/google.rs/cli/0.3.3_clap-broken/osx/drive3.tar.gz">DL for osx</a>) and extract it.<ul>
<li>Run <code>./drive3 --scope foo files list</code> to see that it will fail to parse subcommands, and thus yields <code>Please specify the main sub-command.</code>.</li>
<li>The error message is part of the <a href="https://github.com/Byron/google-apis-rs/blob/master/gen/drive3-cli/src/main.rs#L2904">commands implementation</a>, and indicates that no subcommand was available in the argument matches.</li>
<li>I chose <em>drive2</em> and <em>drive3</em> just for convenience, they are equivalent in the way subcommands are defined and handled.</li>
</ul>
</li>
</ol>
Meta
<ul>
<li>clap-rs version v2.0.1</li>
<li><pre><code>➜  google-apis-rs git:(master) ✗ rustc -vV
rustc 1.6.0 (c30b771ad 2016-01-19)
binary: rustc
commit-hash: c30b771ad9d44ab84f8c88b80c25fcfde2433126
commit-date: 2016-01-19
host: x86_64-apple-darwin
release: 1.6.0
</code></pre>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>Byron/google-apis-rs#145</a> on 2016-01-31 11:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-01-31 19:29</div>
            <div class="timeline-body"><p>Ah ok, thanks for filing! This should be a simple fix to check if the next argument matches a subcommand before consuming as a value.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-01-31 19:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-01-31 19:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: subcommands</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-01-31 19:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-01-31 19:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: parsing</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-01-31 19:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-01-31 19:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/kbknapp">@kbknapp</a> by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-01-31 19:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;argument &#x27;multiple&#x27; option enabled consumes subcommands that follow&quot; to &quot;argument with &#x27;multiple&#x27; option enabled consumes subcommands that follow&quot; by <a href="https://github.com/Byron">@Byron</a> on 2016-02-01 03:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Byron">@Byron</a> on 2016-02-01 03:14</div>
            <div class="timeline-body"><p>Great, I am looking forward to it !</p>
<p>By the way: I find the label-nomenclature intriguing ! Is there a formal descriptions of this system ? I&#x27;d like to see how it works :).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/homu">@homu</a> on 2016-02-01 06:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-02-01 06:46</div>
            <div class="timeline-body"><p>v2.0.2 is out on crates.io now.</p>
<p>For the label naming, no not that I know of. Use a single letter to logically group related labels (also visually separated by colors). The first letter as in <code>C: app</code> (the <code>C</code>) really only serves the purpose to sorting the labels, so the <code>C</code> is arbitrary. Although I do use letters that have some sort meaning, even though that&#x27;s not required at all, i.e. <code>C</code> is for &quot;Component&quot; <code>D</code> is for &quot;Difficulty&quot;, etc. The only one that&#x27;s different is priority <code>P#</code> where the number also sorts the priorities in order of significance.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Byron">@Byron</a> on 2016-02-01 07:17</div>
            <div class="timeline-body"><p>Thanks again ! I will use that to rebuild the entire suite of google-api CLI programs. It&#x27;s just going to take a day :D.</p>
<p>Now that I am working on [Byron&#x27;s EditTools][https://github.com/Byron/atom-byrons-edittools] I was curious on how to best use tags to show what is going on via issues. The system you use here makes quite some sense to me, and I will see if I can just use it as you do in clap-rs. After all, it is a fantastic example of an open-source project, in every perceivable way.</p>
<p>The unit-tests added for v2 truly make it stand out as well, as it can now be trusted to work and stay that way.</p>
<p>Also noteworthy is the use of homu - for some reason I am somewhat afraid of bots, but do see the benefits coming with them. Let&#x27;s see if I can make @homu work for me as well !</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:56:20 UTC
    </footer>
</body>
</html>
