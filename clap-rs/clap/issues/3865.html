<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Offline docs - clap-rs/clap #3865</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Offline docs</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/3865">#3865</a>
        opened by <a href="https://github.com/pickfire">@pickfire</a>
        on 2022-06-24 15:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/pickfire">@pickfire</a></div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>3.2.6</p>
<h3>Describe your use case</h3>
<p><code>cargo doc --open</code> shows clap documentation that is not helpful when user is offline and noticed the docs required internet.</p>
<blockquote>
<p>https://github.com/clap-rs/clap</p>
</blockquote>
<h3>Describe the solution you'd like</h3>
<p>IIRC clap used to include module level docs, even some little example to get user started is fine or a high level view, or even including README is fine.</p>
<h3>Alternatives, if applicable</h3>
<p>Users have to be online to read clap docs, which may not be available all the time anywhere (like on the plane).</p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @pickfire on 2022-06-24 15:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-06-26 03:16</div>
            <div class="timeline-body"><p>If you run <code>cargo doc --features unstable-doc --open</code> then you will see something closer to <code>docs.rs</code></p>
<p>We have several desires at odds</p>
<ul>
<li>We want to test the examples</li>
<li>We want to single-source the README and top-level lib documentation</li>
<li>We want to use features not available with the default features</li>
</ul>
<p>From that combination, we require a feature flag to get the top-level module documentation.  We could ;potentially have an alternate example but we'd need to make sure it gets tested and kept up-to-date when most people won't be seeing it to notice it going stale (not just in whether it compiles but does it make sense at runtime and is it following best practices)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-decision</span> added by @epage on 2022-06-26 03:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-help</span> added by @epage on 2022-06-26 03:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2022-06-26 14:12</div>
            <div class="timeline-body"><p>If README could include another file, then this issue can be solved, but single-source file is probably hard in this case. But how do clap even test the README? If in lib.rs I undestand, but testing README.md code?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-06-28 01:38</div>
            <div class="timeline-body"><p><code>lib.rs</code> pulls in the README when certain feature flags are set.  We then run the doc tests in that scenario, testing the readme's code sample.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2022-06-28 16:34</div>
            <div class="timeline-body"><p>Ah, that explains why the docs only shows up with <code>derive</code> but not with default features https://github.com/clap-rs/clap/blob/b4a1362486a95309c44f4ba9ef24038f1281f384/src/lib.rs#L8</p>
<p>Maybe we can update the existing docs to mention why it doesn't show the example docs? (because derive is not enabled)</p>
<pre><code>//! &lt;https://github.com/clap-rs/clap&gt;
</code></pre>
<p>Or maybe we can include docs when it is not testing even with default features? https://doc.rust-lang.org/reference/conditional-compilation.html#test</p>
<pre><code class="language-rust">#![cfg_attr(any(feature = &quot;derive&quot;, not(test)), doc = include_str!(&quot;../README.md&quot;))]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3886.html">clap-rs/clap#3886</a> on 2022-06-30 01:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-06-30 01:59</div>
            <div class="timeline-body"><blockquote>
<p>Or maybe we can include docs when it is not testing even with default features?</p>
</blockquote>
<p>I just tested that solution and it doesn't quite work.  I'm assuming when the rustdoc code is being extracted, it isn't setting <code>test</code> for us to condition on it.</p>
<p>Going with the explanation</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2022-06-30 16:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:48:37 UTC
    </footer>
</body>
</html>
