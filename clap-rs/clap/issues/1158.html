<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>requires_all does not display all missing requirements - clap-rs/clap #1158</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>requires_all does not display all missing requirements</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1158">#1158</a>
        opened by <a href="https://github.com/smcmurray">@smcmurray</a>
        on 2018-02-01 00:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/smcmurray">@smcmurray</a></div>
            <div class="timeline-body">

Rust Version
<p>1.23</p>
Affected Version of clap
<p>2.29.2</p>
Expected Behavior Summary
<p>When an agument has a requires_all list, and that argument is present but multiple of its required arguments are missing, clap should print an error message that includes all missing required arguments.</p>
Actual Behavior Summary
<p>clap will print out just one of the missing arguments. The user has to repeat the command over and over, adding one missing argument at a time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/smcmurray">@smcmurray</a> on 2018-02-01 00:49</div>
            <div class="timeline-body"><p>To clarify, this is ArgGroup.requires_all</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/smcmurray">@smcmurray</a> on 2018-02-01 18:54</div>
            <div class="timeline-body"><p>I&#x27;m trying to set up a command line something like:
<code>    example --conf &lt;FILE&gt;...|&lt;&lt;ID&gt; --x &lt;X&gt;... --y &lt;Y&gt; --z &lt;Z&gt;&gt;</code></p>
<p>but I get:</p>
<pre><code>  $ example -h
  example [OPTIONS] &lt;ID&gt; --conf &lt;FILE&gt;... --x &lt;X&gt;... --y &lt;Y&gt; --z &lt;Z&gt;
</code></pre>
<p>and</p>
<pre><code>$ example test
error: The following required arguments were not provided:
    --conf &lt;FILE&gt;...
    --x &lt;X&gt;...
    --y &lt;Y&gt;
    --z &lt;Z&gt;
</code></pre>
<p>In this case, --conf  is not required or missing. In fact, including it would cause a conflict.
I understand that &#x27;example -h&#x27; will put [OPTIONS] in there even though there are no other options. I can live with that. But it needs to get the | right, and the grouping right.</p>
<p>Here&#x27;s my code:</p>
<pre><code>extern crate clap;
use clap::{Arg, App};

fn main(){
  let matches = App::new(&quot;example&quot;)
                        .version(&quot;1.0&quot;)
                        .about(&quot;clap example&quot;)
                        .arg(Arg::with_name(&quot;config&quot;)
                             .short(&quot;c&quot;)
                             .long(&quot;conf&quot;)
                             .value_name(&quot;FILE&quot;)
                             .help(&quot;Custom config file.&quot;)
                             .takes_value(true)
                             .multiple(true)
                             .required_unless(&quot;ID&quot;)
                             .conflicts_with(&quot;ID&quot;)
                        )
                        .arg(Arg::with_name(&quot;ID&quot;)
                             .index(1)
                             .help(&quot;ID&quot;)
                             .required_unless(&quot;config&quot;)
                             .conflicts_with(&quot;config&quot;)
                             .requires_all(&amp;[&quot;x&quot;, &quot;y&quot;, &quot;z&quot;])
                        )
                        .arg(Arg::with_name(&quot;x&quot;)
                             .short(&quot;x&quot;)
                             .long(&quot;x&quot;)
                             .value_name(&quot;X&quot;)
                             .help(&quot;x&quot;)
                             .multiple(true)
                             .takes_value(true)
                        )
                        .arg(Arg::with_name(&quot;y&quot;)
                             .short(&quot;y&quot;)
                             .long(&quot;y&quot;)
                             .value_name(&quot;Y&quot;)
                             .help(&quot;y&quot;)
                             .takes_value(true)
                        )
                        .arg(Arg::with_name(&quot;z&quot;)
                             .short(&quot;z&quot;)
                             .long(&quot;z&quot;)
                             .value_name(&quot;Z&quot;)
                             .help(&quot;z&quot;)
                             .takes_value(true)
                        )
                        .get_matches();
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-02-02 01:48</div>
            <div class="timeline-body"><p>Apologies, I&#x27;ve confirmed this bug. I&#x27;m in a heated battle with getting v3 out the door (which will include this bug fix) but I might be able to squeeze the part of this bug fix that will at least remove <code>--conf</code> from the required list when <code>id</code> (or another of it&#x27;s conflicts) is used. The deeper fix to fix all arg group related conflicts will have to wait until v3. This initial fix should be able to come out in 2.29.3 since I think it&#x27;ll be easy enough to forward port to v3.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-02-02 01:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-02-02 01:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: intermediate</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-02-02 01:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-02-02 01:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: errors</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-02-02 01:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;2.29.3&quot; by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-02-02 01:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#1164</a> on 2018-02-05 01:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-02-05 01:10</div>
            <div class="timeline-body"><p>This is fixed in #1164 however, the usage string isn&#x27;t exactly what you want. So I would recommend using a custom usage string. The behaviour is correct though.</p>
<pre><code>    let matches = App::new(&quot;example&quot;)
        .usage(&quot;example &lt;--config [FILE] | -x [X] -y [Y] -z [Z]&gt;&quot;)
        .arg(Arg::from_usage(&quot;-c, --config [FILE] &#x27;Custom config file.&#x27;&quot;)
             .required_unless(&quot;ID&quot;)
             .conflicts_with(&quot;ID&quot;))
        .arg(Arg::from_usage(&quot;[ID] &#x27;ID&#x27;&quot;)
             .required_unless(&quot;config&quot;)
             .conflicts_with(&quot;config&quot;)
             .requires_all(&amp;[&quot;x&quot;, &quot;y&quot;, &quot;z&quot;]))
        .arg(Arg::from_usage(&quot;-x [X] &#x27;X&#x27;&quot;))
        .arg(Arg::from_usage(&quot;-y [Y] &#x27;Y&#x27;&quot;))
        .arg(Arg::from_usage(&quot;-z [Z] &#x27;Z&#x27;&quot;))
        .get_matches();
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-02-05 03:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#1037</a> on 2018-02-05 03:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#3197</a> on 2021-12-22 17:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:57:05 UTC
    </footer>
</body>
</html>
