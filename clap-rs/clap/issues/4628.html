<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assert an argument has no default values when `contains_id` or `try_contains_id` is called - clap-rs/clap #4628</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Assert an argument has no default values when <code>contains_id</code> or <code>try_contains_id</code> is called</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/4628">#4628</a>
        opened by <a href="https://github.com/rhysd">@rhysd</a>
        on 2023-01-11 12:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/rhysd">@rhysd</a></div>
            <div class="timeline-body">Please complete the following tasks
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
Clap Version
<p><code>master</code></p>
Describe your use case
<p><code>contains_id</code> and <code>try_contains_id</code> always return <code>true</code> when the argument has default values as discussed below:</p>
<ul>
<li>https://github.com/clap-rs/clap/discussions/4511</li>
<li>https://github.com/clap-rs/clap/discussions/4575</li>
</ul>
<p>And I also mistook the usage:</p>
<p>https://github.com/rhysd/hgrep/commit/e64b4b84266af15ef58c6b404d7c7b2c22abb2ba</p>
<p>It looks a pitfall because</p>
<ul>
<li><code>contains_id</code> just works fine as replacement of <code>is_present</code> when the argument has no default values</li>
<li><code>ArgAction::{SetTrue,SetFalse,Count}</code> introduce their default values implicitly</li>
<li>These methods just return a boolean value. Compiler cannot check the misuse. Users need to notice some flags are always unintentionally set to <code>true</code> by themselves.</li>
</ul>
Describe the solution you&#x27;d like
<p>Check if the argument has no default values with <code>debug_assert</code> in <code>try_contains_id</code> so that users can notice their mistakes while development.</p>
Alternatives, if applicable
<p><em>No response</em></p>
Additional Context
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by <a href="https://github.com/rhysd">@rhysd</a> on 2023-01-11 12:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#4629</a> on 2023-01-11 12:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-01-11 13:08</div>
            <div class="timeline-body"><p>This is expected behavior and is why we renamed <code>is_present</code>.  We wanted to focus on the role of <code>ArgMatches</code> as a container and the container does have the ID.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/epage">@epage</a> on 2023-01-11 13:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rhysd">@rhysd</a> on 2023-01-11 13:25</div>
            <div class="timeline-body"><p>@epage Yes, I understand that this is an expected behavior. I just wonder it might be possible to add some assertions to prevent mistakes since calling the methods which always return <code>true</code> does not make sense. Don&#x27;t adding the assertions make sense to you?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-01-11 13:33</div>
            <div class="timeline-body"><p>No as that would be breaking the API existing contract.  There would also be nothing in the name to clarify that this only works for some args and panics for others.  Yes, it can be documented but when you rely on documentation only, you have failed your users.  The same could not be said of the existing problem you are highlighting because we renamed the functions to both intentionally break people&#x27;s code and to clarify the semantics.</p>
<p>Besides the point</p>
<ul>
<li>This would be a breaking change and would have to wait until v5.</li>
<li>The <code>try_</code> versions are not supposed to panic but return error messages</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rhysd">@rhysd</a> on 2023-01-11 13:46</div>
            <div class="timeline-body"><p>OK, I understood the points. Thank you so much for the detailed explanation.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:59:35 UTC
    </footer>
</body>
</html>
