<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The executable size impact - clap-rs/clap #1139</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>The executable size impact</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1139">#1139</a>
        opened by <a href="https://github.com/RazrFalcon">@RazrFalcon</a>
        on 2018-01-05 18:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/RazrFalcon">@RazrFalcon</a> on 2018-01-05 18:16</div>
            <div class="timeline-body"><p>A minimal <em>Hello World!</em> application after <code>strip -s</code> is 427 KiB on my machine. But <code>01b_quick_example.rs</code> is 1155 KiB which is almost 3x bigger.</p>
<p>It's a pretty huge impact and I think it worth creating an issue because such kind of libraries should be tiny (in my opinion).
Maybe it's worth investigating what causes such impact on the size.</p>
<p>I've also tested with my own library, <code>svgdom</code>, which is pretty big and I got only 803 KiB.</p>
<p>Used Cargo.toml:</p>
<pre><code class="language-toml">[dependencies.clap]
version = &quot;2&quot;
default-features = false

[profile.release]
opt-level = 3
lto = true
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-01-09 17:43</div>
            <div class="timeline-body"><p>This is the exact purpose of #1143 :smile:</p>
<p>The <code>01b_quick_example</code> is probably due to the usage parser, but I'll investigate more later.</p>
<p>I would however kind of like to keep things in perspective. While I agree binary sizes should be as small as possible, clap does <em>a lot</em> especially when compared to minimal arg parsers like <code>getopts</code>, <code>pirate</code>, or <code>argparse</code> where you end up implementing all those features manually and those implementations won't get counted against smaller arg parsing libs. So comparing binary sizes of arg parsers isn't super fair because it's not a true apples to apples comparison, even though it sounds like it should be.</p>
<p>I do very much want to decrease <em>needless bloat</em>, and that's what I'm starting to investigate :+1:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: enhancement</span> added by @kbknapp on 2018-01-09 17:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: intermediate</span> added by @kbknapp on 2018-01-09 17:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P3: want to have</span> added by @kbknapp on 2018-01-09 17:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-01-09 17:45</div>
            <div class="timeline-body"><p>Also, I forgot to add that I would expect opt-leve=3 and lto=true to increase binary sizes. Which I know is the default for clap, but this is also because the perf gains typically outweigh a few kb in size IMO. And if they don't, it's easy to change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-01-15 17:37</div>
            <div class="timeline-body"><p>Here's the table for different build options (again using <code>ripgrep</code> as the test binary and <code>clap</code> as the crate to measure). Since I was curious :smile:</p>
<p>All build options were set in <code>ripgrep</code>s Cargo.toml, clean build in release mode</p>
<p>| Size  | LTO | Opt Level |
| :---: | :---: | :---: |
| 197.4KiB  | True  | 3 |
| 189.3KiB  | False  | 3 |
| 186.5KiB  | True  | 2 |
| 183.9KiB  | False  | 2 |
| 137.3KiB  | True  | 1 |
| 139.3KiB  | False  | 1 |
| 152.5KiB  | True  | s |
| 155.0KiB  | False  | s |
| 122.9KiB  | True  | z |
| 125.5KiB  | False  | z |</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-02-12 20:05</div>
            <div class="timeline-body"><p>I'm going to close this, as it's one of those things that could be forever tweaked and tuned. Once v3-beta is out, there will be a chance to re-address this with more specific goals/comments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2018-02-12 20:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RazrFalcon">@RazrFalcon</a> on 2018-02-13 07:40</div>
            <div class="timeline-body"><p>I'm satisfied already =) Thanks for your work.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:43 UTC
    </footer>
</body>
</html>
