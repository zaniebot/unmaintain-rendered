<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Replace value_t* macros with functions - clap-rs/clap #1809</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Replace value_t* macros with functions</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1809">#1809</a>
        opened by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a>
        on 2020-04-12 00:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/CreepySkeleton">@CreepySkeleton</a></div>
            <div class="timeline-body">Make sure you completed the following tasks
<ul>
<li>[x] Searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[x] Searched the closes issues</li>
</ul>
Describe your use case
<p>I&#x27;m trying to cure the <code>#[doc(hidden)]</code> infestation that is spread largely thought our codebase. I&#x27;m hitting the wall in the form of <code>Cannot leak crate-visible type in public interface</code>.</p>
<p>The problem is that certain functions marked as <code>#[doc(hidden)] pub</code> are used by these macros so they ought to be <code>pub</code>, and certain <code>struct</code>s are <code>pub hidden</code> only because they occur in a signature of one of those functions.</p>
Describe the solution you&#x27;d like
<p>Replace the macros with functions of the same name:</p>
<pre><code>pub fn value_of_t&lt;K: Key, R: FromStr&gt;(&amp;self, name: K) -&gt; Result&lt;R, clap::Error&gt; {
    if let Some(v) = self.value_of(name) {
        match v.parse::&lt;R&gt;() {
            Ok(val) =&gt; Ok(val),
            Err(_)  =&gt;
                Err(::clap::Error::value_validation_auto(
                    format!(&quot;The argument &#x27;{}&#x27; isn&#x27;t a valid value&quot;, v))),
        }
    } else {
        Err(::clap::Error::argument_not_found_auto(name))
    }
} 

// and so on ...
</code></pre>
<p>No need for those hidden functions to be <code>pub</code> anymore!</p>
<p>This will actually be improvement over macros because users won&#x27;t have to specify the type explicitly, in many cases they can just leave the type up to the type inference.</p>
<p>If maintainers think this is a good design, I would be happy to send a PR for you!</p>
Alternatives, if applicable
<p>Do nothing and let the disease spread ðŸ¤¢ . Might as well render #1803 impossible.</p>
Additional context
<p>This was previously discussed in <a href="https://github.com/clap-rs/clap/issues/915">clap-rs/clap#915</a> and Kevin agreed it would be nice, although he eventually closed the issue in favor of the upcoming derive. Since the derive is 90% imported, we could just remove the macros. I don&#x27;t have a strong opinion regarding removal - I can imagine where these macros are preferable over derive, all I want is to finally move forward.</p>
<p>Related to #1803 since <code>Id</code> occurs in some of these functions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-04-12 00:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;3.0&quot; by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-12 00:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#1811</a> on 2020-04-12 03:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/bors[bot]">@bors[bot]</a> on 2020-04-13 08:07</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:57:45 UTC
    </footer>
</body>
</html>
