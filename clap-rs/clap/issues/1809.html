<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Replace value_t* macros with functions - clap-rs/clap #1809</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Replace value_t* macros with functions</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1809">#1809</a>
        opened by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a>
        on 2020-04-12 00:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/CreepySkeleton">@CreepySkeleton</a></div>
            <div class="timeline-body"><h3>Make sure you completed the following tasks</h3>
<ul>
<li>[x] Searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[x] Searched the closes issues</li>
</ul>
<h3>Describe your use case</h3>
<p>I'm trying to cure the <code>#[doc(hidden)]</code> infestation that is spread largely thought our codebase. I'm hitting the wall in the form of <code>Cannot leak crate-visible type in public interface</code>.</p>
<p>The problem is that certain functions marked as <code>#[doc(hidden)] pub</code> are used by these macros so they ought to be <code>pub</code>, and certain <code>struct</code>s are <code>pub hidden</code> only because they occur in a signature of one of those functions.</p>
<h3>Describe the solution you'd like</h3>
<p>Replace the macros with functions of the same name:</p>
<pre><code class="language-rust">pub fn value_of_t&lt;K: Key, R: FromStr&gt;(&amp;self, name: K) -&gt; Result&lt;R, clap::Error&gt; {
    if let Some(v) = self.value_of(name) {
        match v.parse::&lt;R&gt;() {
            Ok(val) =&gt; Ok(val),
            Err(_)  =&gt;
                Err(::clap::Error::value_validation_auto(
                    format!(&quot;The argument '{}' isn't a valid value&quot;, v))),
        }
    } else {
        Err(::clap::Error::argument_not_found_auto(name))
    }
} 

// and so on ...
</code></pre>
<p>No need for those hidden functions to be <code>pub</code> anymore!</p>
<p>This will actually be improvement over macros because users won't have to specify the type explicitly, in many cases they can just leave the type up to the type inference.</p>
<p>If maintainers think this is a good design, I would be happy to send a PR for you!</p>
<h3>Alternatives, if applicable</h3>
<p>Do nothing and let the disease spread ðŸ¤¢ . Might as well render #1803 impossible.</p>
<h3>Additional context</h3>
<p>This was previously discussed in https://github.com/clap-rs/clap/issues/915 and Kevin agreed it would be nice, although he eventually closed the issue in favor of the upcoming derive. Since the derive is 90% imported, we could just remove the macros. I don't have a strong opinion regarding removal - I can imagine where these macros are preferable over derive, all I want is to finally move forward.</p>
<p>Related to #1803 since <code>Id</code> occurs in some of these functions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by @CreepySkeleton on 2020-04-12 00:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @pksunkara on 2020-04-12 00:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/1811.html">clap-rs/clap#1811</a> on 2020-04-12 03:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @bors[bot] on 2020-04-13 08:07</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:47:36 UTC
    </footer>
</body>
</html>
