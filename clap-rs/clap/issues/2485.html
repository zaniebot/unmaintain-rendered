<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>clap generates invalid bash completions for ArgEnum - clap-rs/clap #2485</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>clap generates invalid bash completions for ArgEnum</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/2485">#2485</a>
        opened by <a href="https://github.com/ajeetdsouza">@ajeetdsouza</a>
        on 2021-05-20 05:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ajeetdsouza">@ajeetdsouza</a></div>
            <div class="timeline-body">Please complete the following tasks
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
Rust Version
<p>rustc 1.52.1 (9bc8c42bb 2021-05-09)</p>
Clap Version
<p>3.0.0-beta.2</p>
Minimal reproducible code
<pre><code>use clap::{ArgEnum, Clap, IntoApp};

#[derive(Clap, Debug)]
pub struct App {
    #[clap(arg_enum)]
    pub shell: Shell,
}

#[derive(ArgEnum, Debug)]
pub enum Shell {
    Bash,
    Fish,
    Zsh,
}

fn main() {
    let mut app = App::into_app();
    clap_generate::generate::&lt;clap_generate::generators::Bash, _&gt;(
        &amp;mut app,
        &quot;play&quot;,
        &amp;mut std::io::stdout(),
    );
}
</code></pre>
Steps to reproduce the bug with the above code
<pre><code>cargo run
</code></pre>
Actual Behaviour
<p>Assuming a binary name of <code>foo</code>, if I type in <code>foo</code>Tab, I get the following completions:</p>
<pre><code>-h         --help     &lt;shell&gt;    -V         --version
</code></pre>
Expected Behaviour
<p>The <code>&lt;shell&gt;</code> value is a placeholder, it&#x27;s not supposed to be used in completions.</p>
<p>I should have gotten the options of <code>bash</code>, <code>fish</code>, <code>zsh</code> instead.</p>
Additional Context
<p>The full generated bash completions are:</p>
<pre><code>_play() {
    local i cur prev opts cmds
    COMPREPLY=()
    cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
    prev=&quot;${COMP_WORDS[COMP_CWORD-1]}&quot;
    cmd=&quot;&quot;
    opts=&quot;&quot;

    for i in ${COMP_WORDS[@]}
    do
        case &quot;${i}&quot; in
            play)
                cmd=&quot;play&quot;
                ;;
            
            *)
                ;;
        esac
    done

    case &quot;${cmd}&quot; in
        play)
            opts=&quot; -h -V  --help --version  &lt;shell&gt; &quot;
            if [[ ${cur} == -* || ${COMP_CWORD} -eq 1 ]] ; then
                COMPREPLY=( $(compgen -W &quot;${opts}&quot; -- &quot;${cur}&quot;) )
                return 0
            fi
            case &quot;${prev}&quot; in
                
                *)
                    COMPREPLY=()
                    ;;
            esac
            COMPREPLY=( $(compgen -W &quot;${opts}&quot; -- &quot;${cur}&quot;) )
            return 0
            ;;
        
    esac
}

complete -F _play -o bashdefault -o default play
</code></pre>
Debug Output
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by <a href="https://github.com/ajeetdsouza">@ajeetdsouza</a> on 2021-05-20 05:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">:money_with_wings: $5</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-05-20 09:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: generator</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-05-20 09:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#2490</a> on 2021-05-20 12:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>ryought/dbgphmm#37</a> on 2021-07-11 22:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/bors[bot]">@bors[bot]</a> on 2021-10-14 21:42</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:58:07 UTC
    </footer>
</body>
</html>
