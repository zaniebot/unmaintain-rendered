<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZSH completion generation broken - clap-rs/clap #754</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ZSH completion generation broken</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/754">#754</a>
        opened by <a href="https://github.com/panicbit">@panicbit</a>
        on 2016-11-19 12:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/panicbit">@panicbit</a> on 2016-11-19 12:47</div>
            <div class="timeline-body"><h3>Rust Version</h3>
<ul>
<li>rustc 1.13.0 (2c6933acc 2016-11-07)</li>
</ul>
<h3>Affected Version of clap</h3>
<ul>
<li>2.18.0</li>
</ul>
<h3>Expected Behavior Summary</h3>
<p><code>gen_completions(cmd, Shell::Zsh,  dir)</code> generates a ZSH completion script.</p>
<h3>Actual Behavior Summary</h3>
<p>Completion script generation panics:</p>
<pre><code>thread 'main' panicked at 'Fatal internal error. Please consider filing a bug report at https://github.com/kbknapp/clap-rs/issues', ../src/libcore/option.rs:705
stack backtrace:
   1:     0x558efa9f637f - std::sys::backtrace::tracing::imp::write::h6f1d53a70916b90d
   2:     0x558efa9f97cd - std::panicking::default_hook::{{closure}}::h137e876f7d3b5850
   3:     0x558efa9f87aa - std::panicking::default_hook::h0ac3811ec7cee78c
   4:     0x558efa9f8cf8 - std::panicking::rust_panic_with_hook::hc303199e04562edf
   5:     0x558efa9f8b92 - std::panicking::begin_panic::h6ed03353807cf54d
   6:     0x558efa9f8ad0 - std::panicking::begin_panic_fmt::hc321cece241bb2f5
   7:     0x558efa9f8a51 - rust_begin_unwind
   8:     0x558efaa2e5ef - core::panicking::panic_fmt::h27224b181f9f037f
   9:     0x558efaa2e665 - core::option::expect_failed::h8606bc228cd3f504
  10:     0x558efa9a89d3 - &lt;core::option::Option&lt;T&gt;&gt;::expect::h4eef01aca2951918
                        at /buildslave/rust-buildbot/slave/stable-dist-rustc-linux/build/obj/../src/libcore/option.rs:293
  11:     0x558efa9e8b37 - clap::completions::zsh::parser_of::h29f7e853afa02986
                        at /home/mike/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-2.18.0/src/completions/zsh.rs:239
  12:     0x558efa9e74cd - clap::completions::zsh::subcommand_details::h85a792e7c51fc169
                        at /home/mike/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-2.18.0/src/completions/zsh.rs:101
  13:     0x558efa9e6c2d - clap::completions::zsh::ZshGen::generate_to::h69571ed107da5350
                        at /home/mike/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-2.18.0/src/completions/zsh.rs:29
  14:     0x558efa9ec87c - clap::completions::ComplGen::generate::h1fffbc0c7c9dda2f
                        at /home/mike/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-2.18.0/src/completions/mod.rs:35
  15:     0x558efa9d7049 - clap::app::parser::Parser::gen_completions_to::h80949e589e22861b
                        at /home/mike/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-2.18.0/src/app/parser.rs:113
  16:     0x558efa9d772b - clap::app::parser::Parser::gen_completions::hded68d6387747cf6
                        at /home/mike/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-2.18.0/src/app/parser.rs:132
  17:     0x558efa99478e - clap::app::App::gen_completions::hd6193132c5aca4e7
                        at /home/mike/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-2.18.0/src/app/mod.rs:1138
  18:     0x558efa99b910 - build_script_build::main::hc8eaf18f56714396
                        at /home/mike/novemb.rs/super/build.rs:14
  19:     0x558efaa01296 - __rust_maybe_catch_panic
  20:     0x558efa9f8021 - std::rt::lang_start::h538f8960e7644c80
  21:     0x558efa99ba13 - main
  22:     0x7f290f5b7290 - __libc_start_main
  23:     0x558efa9931f9 - _start
  24:                0x0 - &lt;unknown&gt;
</code></pre>
<h3>Steps to Reproduce the issue</h3>
<p>Try to generate a ZSH completion script from this app struct: https://github.com/SUPERAndroidAnalyzer/super/blob/1c6b1f7507822b109f1cd49d020b965caac003fe/src/cli.rs</p>
<h3>Sample Code or Link to Sample Code</h3>
<p>https://github.com/panicbit/super/blob/69e93ebf7b2661adefb641c235185c6bcae35fe3/build.rs
https://github.com/panicbit/super/blob/69e93ebf7b2661adefb641c235185c6bcae35fe3/src/cli.rs</p>
<h3>Debug output</h3>
<p><a href="https://github.com/kbknapp/clap-rs/files/601444/debug.txt">debug_output</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../SUPERAndroidAnalyzer/super/issues/77.html">SUPERAndroidAnalyzer/super#77</a> on 2016-11-19 13:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-11-20 19:54</div>
            <div class="timeline-body"><p>Thanks for posting this! I think it relates to #581 which I may have a solution for now. I'll post back here with updates.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: completion gen</span> added by @kbknapp on 2016-11-20 19:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: intermediate</span> added by @kbknapp on 2016-11-20 19:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> added by @kbknapp on 2016-11-20 19:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @kbknapp on 2016-11-20 19:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @kbknapp on 2016-11-20 19:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-11-21 01:15</div>
            <div class="timeline-body"><p>It turned out not to be related, but I've got it fixed and am uploading the PR as we speak.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @homu on 2016-11-21 04:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-11-21 14:17</div>
            <div class="timeline-body"><p>v2.19.0 is out on crates.io</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/panicbit">@panicbit</a> on 2016-11-21 14:22</div>
            <div class="timeline-body"><p>Awesome!</p>
<p>Kevin K. notifications@github.com schrieb am Mo., 21. Nov. 2016, 15:17:</p>
<blockquote>
<p>v2.19.0 is out on crates.io</p>
<p>â€”
You are receiving this because you authored the thread.
Reply to this email directly, view it on GitHub
https://github.com/kbknapp/clap-rs/issues/754#issuecomment-261949604,
or mute the thread
https://github.com/notifications/unsubscribe-auth/AAmW3bEbpVkYopCtfMh75_VlUhjQBb6Wks5rAaf6gaJpZM4K3Pun
.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../SUPERAndroidAnalyzer/super/pulls/97.html">SUPERAndroidAnalyzer/super#97</a> on 2016-11-21 15:06</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:06 UTC
    </footer>
</body>
</html>
