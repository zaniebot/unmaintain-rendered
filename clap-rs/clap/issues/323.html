<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inconsistent and incorrect behavior with optional options that take multiple values - clap-rs/clap #323</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Inconsistent and incorrect behavior with optional options that take multiple values</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/323">#323</a>
        opened by <a href="https://github.com/jimmycuadra">@jimmycuadra</a>
        on 2015-10-28 03:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jimmycuadra">@jimmycuadra</a> on 2015-10-28 03:55</div>
            <div class="timeline-body"><p>I've come across a few cases using optional options that take multiple values where the input on the CLI is parsed inconsistently or incorrectly depending on the argument order or form.</p>
<p>Given the sample program:</p>
<pre><code class="language-rust">extern crate clap;

use clap::{App, Arg};

fn main() {
    let matches = App::new(&quot;example&quot;)
        .arg(
            Arg::with_name(&quot;positional&quot;)
                .index(1)
                .required(true)
        )
        .arg(
            Arg::with_name(&quot;optional&quot;)
                .short(&quot;o&quot;)
                .long(&quot;optional&quot;)
                .takes_value(true)
                .multiple(true)
        )
        .get_matches();

    println!(&quot;{:?}&quot;, matches.values_of(&quot;optional&quot;));
}
</code></pre>
<p>Here are some example inputs and their output.</p>
<p>This works:</p>
<pre><code>$ ./target/debug/clap_sample pos -ofoo
Some([&quot;foo&quot;])
</code></pre>
<p>Adding a second value for &quot;optional&quot; causes a complete failure:</p>
<pre><code>$ ./target/debug/clap_sample pos -ofoo -obar
error: The following required arguments were not supplied:

USAGE:
    clap_sample &lt;positional&gt; --optional &lt;optional&gt;...

For more information try --help
</code></pre>
<p>Using the long form for the second value makes it work:</p>
<pre><code>$ ./target/debug/clap_sample pos -ofoo --optional=bar
Some([&quot;foo&quot;, &quot;bar&quot;])
</code></pre>
<p>But not if you use a space instead of an equals sign for the key/value delimiter:</p>
<pre><code>$ ./target/debug/clap_sample pos -ofoo --optional bar
error: The following required arguments were not supplied:

USAGE:
    clap_sample &lt;positional&gt; --optional &lt;optional&gt;...

For more information try --help
</code></pre>
<p>A single value for &quot;optional&quot; using the long form and a space delimiter fails as well:</p>
<pre><code>./target/debug/clap_sample pos --optional foo
error: The following required arguments were not supplied:

USAGE:
    clap_sample &lt;positional&gt; --optional &lt;optional&gt;...

For more information try --help
</code></pre>
<p>While an equals sign works:</p>
<pre><code>$ ./target/debug/clap_sample pos --optional=foo
Some([&quot;foo&quot;])
</code></pre>
<p>And adding a second value using the same syntax works:</p>
<pre><code>$ ./target/debug/clap_sample pos --optional=foo --optional=bar
Some([&quot;foo&quot;, &quot;bar&quot;])
</code></pre>
<p>But using any other form of syntax fails:</p>
<pre><code>$ ./target/debug/clap_sample pos --optional=foo -obar
error: The following required arguments were not supplied:

USAGE:
    clap_sample &lt;positional&gt; --optional &lt;optional&gt;...

For more information try --help
$ ./target/debug/clap_sample pos --optional=foo -o bar
error: The following required arguments were not supplied:

USAGE:
    clap_sample &lt;positional&gt; --optional &lt;optional&gt;...

For more information try --help
$ ./target/debug/clap_sample pos --optional=foo -o=bar
error: The following required arguments were not supplied:

USAGE:
    clap_sample &lt;positional&gt; --optional &lt;optional&gt;...

For more information try --help
$ ./target/debug/clap_sample pos --optional=foo --optional bar
error: The following required arguments were not supplied:

USAGE:
    clap_sample &lt;positional&gt; --optional &lt;optional&gt;...

For more information try --help
</code></pre>
<p>If the positional argument is removed from the <code>clap::App</code>, the behavior is different still.</p>
<p>A single value for &quot;optional&quot; continues to work with the short, spaceless form:</p>
<pre><code>./target/debug/clap_sample -ofoo
Some([&quot;foo&quot;])
</code></pre>
<p>But adding a second value ignores the second value instead of causing an error like the version with the positional argument did:</p>
<pre><code>$ ./target/debug/clap_sample -ofoo -obar
Some([&quot;foo&quot;])
</code></pre>
<p>Using the long form for the second value makes it work, as before:</p>
<pre><code>$ ./target/debug/clap_sample -ofoo --optional=bar
Some([&quot;foo&quot;, &quot;bar&quot;])
</code></pre>
<p>And even works using a space delimiter, which caused an error in the version with the positional argument!</p>
<pre><code>$ ./target/debug/clap_sample -ofoo --optional bar
Some([&quot;foo&quot;, &quot;bar&quot;])
</code></pre>
<p>A single value provided using the long option in both forms works:</p>
<pre><code>$ ./target/debug/clap_sample --optional bar
Some([&quot;bar&quot;])
$ ./target/debug/clap_sample --optional=bar
Some([&quot;bar&quot;])
</code></pre>
<p>As does providing a second value with either form of the long option:</p>
<pre><code>$ ./target/debug/clap_sample --optional foo --optional bar
Some([&quot;foo&quot;, &quot;bar&quot;])
$ ./target/debug/clap_sample --optional foo --optional=bar
Some([&quot;foo&quot;, &quot;bar&quot;])
</code></pre>
<p>But using the short form for the second value, only a space delimiter actually captures the value:</p>
<pre><code>$ ./target/debug/clap_sample --optional foo -obar
Some([&quot;foo&quot;])
$ ./target/debug/clap_sample --optional foo -o=bar
Some([&quot;foo&quot;])
$ ./target/debug/clap_sample --optional foo -o bar
Some([&quot;foo&quot;, &quot;bar&quot;])
</code></pre>
<p>I know that providing multiple values without repeating the name of the option itself (<code>-o foo bar</code> or <code>--optional foo bar</code>) works more consistently (but not in all cases!), but my expectation is that all variations of short and long forms, with or without the app having a positional argument, should correctly recognize the option and extract all the provided values.</p>
<p>All these examples use clap 1.4.5 on Rust 1.3 (OS X). Hope this is helpful! Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2015-10-28 07:42</div>
            <div class="timeline-body"><p>Thanks for the detailed write, we really appreciate it! I'll start working on this bug and post back here with updates :+1:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @kbknapp on 2015-10-28 07:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P1: urgent</span> added by @kbknapp on 2015-10-28 07:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by @kbknapp on 2015-10-28 07:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: parsing</span> added by @kbknapp on 2015-10-28 07:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 1.x</span> added by @kbknapp on 2015-10-28 07:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2015-10-28 07:54</div>
            <div class="timeline-body"><p>These are the forms I'm tracking as not working. I'll check off as fixed.</p>
<ul>
<li>[x] <code>$ prog pos -ofoo -obar</code></li>
<li>[x] <code>$ prog pos -o foo -obar</code></li>
<li>[x] <code>$ prog pos -ofoo -o bar</code></li>
<li>[x] <code>$ prog pos -ofoo --optional bar</code></li>
<li>[x] <code>$ prog pos --optional foo</code></li>
<li>[x] <code>$ prog pos --optional=foo -obar</code></li>
<li>[x] <code>$ prog pos --optional=foo -o bar</code></li>
<li>[x] <code>$ prog pos --optional=foo --optional bar</code></li>
<li>[x] <code>$ prog --optional foo -obar</code></li>
<li>[x] <code>$ prog -ofoo -obar</code></li>
<li>[x] <code>$ prog -o foo -obar</code></li>
<li>[x] <code>$ prog -ofoo -o bar</code></li>
<li>[x] <code>$ prog --optional foo -obar</code></li>
</ul>
<p>One note is that forms like this  <code>$ ./target/debug/clap_sample pos --optional=foo -o=bar</code> aren't designed to be supported. No reason we probably couldn't add it, but the short form with <code>=</code> wasn't an intended form. Just FYI ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jimmycuadra">@jimmycuadra</a> on 2015-10-28 10:00</div>
            <div class="timeline-body"><p>Thanks so much! I don't actually use the equals form myself, but some tools do (even exclusively) so once I realized there was some strangeness going on I started trying all the combinations I could think of. :}</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2015-10-28 12:57</div>
            <div class="timeline-body"><p>@jimmycuadra All those bugs are fixed with #324</p>
<p>One thing that has not been added yet is using <code>=</code> with a short option (long option and <code>=</code> works). Is that required for your use case? If so, we can add it to the tracker for implementation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "1.4.6" by @kbknapp on 2015-10-28 13:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jimmycuadra">@jimmycuadra</a> on 2015-10-28 21:10</div>
            <div class="timeline-body"><p>That was fast! No, I don't have any particular use for the short form with an equals sign. Thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2015-10-29 07:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:06 UTC
    </footer>
</body>
</html>
