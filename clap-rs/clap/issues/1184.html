<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No way to create a global template - clap-rs/clap #1184</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>No way to create a global template</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/clap-rs/clap/issues/1184">#1184</a>
        opened by <a href="https://github.com/anna-is-cute">@anna-is-cute</a>
        on 2018-02-14 17:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/anna-is-cute">@anna-is-cute</a></div>
            <div class="timeline-body"><!--
Please use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`
-->

<h3>Affected Version of clap</h3>
<p>2.29.4</p>
<h3>Expected Behavior Summary</h3>
<p>Being able to call <code>global_template</code> and have the template propagate down to subcommands.</p>
<h3>Actual Behavior Summary</h3>
<p>For every single subcommand, I have to add a <code>template</code> call to get them all to match my custom template.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-02-14 18:58</div>
            <div class="timeline-body"><p>Totally agree this is a lacking feature, thanks for the suggestion!</p>
<p>In order for me to actually get v3 released I have to put blinders on and only implement bug fixes or super trivial features which are simple to forward port to the v3 branch.</p>
<p>I don't know that this is one such issue. I'll leave it open for v3 as it is something I <em>do</em> want to have.</p>
<p>Having said all this, if someone implements this for v2 I'm not against the PR, so long as the understanding is that for v3 I may have to rip out the commit and re-do it depending how deep into the internals it gets to implement this. (for v3 the internals are quite different, so some changes aren't trivial to forward port).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: help message</span> added by @kbknapp on 2018-02-14 18:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: subcommands</span> added by @kbknapp on 2018-02-14 18:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: intermediate</span> added by @kbknapp on 2018-02-14 18:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P3: want to have</span> added by @kbknapp on 2018-02-14 18:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: settings</span> added by @kbknapp on 2018-02-14 18:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by @kbknapp on 2018-02-14 18:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1037.html">clap-rs/clap#1037</a> on 2018-02-15 14:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v3-alpha.1" by @kbknapp on 2018-07-22 02:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">M: mentored</span> added by @kbknapp on 2018-07-22 02:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @kbknapp on 2018-07-22 02:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../TeXitoi/structopt/issues/172.html">TeXitoi/structopt#172</a> on 2019-03-19 00:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "v3-alpha.2" by @pksunkara on 2020-02-01 07:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v3.0" by @pksunkara on 2020-02-01 07:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.0" by @pksunkara on 2020-10-09 17:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @pksunkara on 2020-10-09 17:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> removed by @pksunkara on 2020-10-09 17:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: medium</span> removed by @pksunkara on 2020-10-09 17:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">Z: mentored</span> removed by @pksunkara on 2020-10-09 17:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">:money_with_wings: $5</span> added by @pksunkara on 2020-10-09 17:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by @pksunkara on 2020-10-09 17:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-10-09 17:33</div>
            <div class="timeline-body"><p>To solve this, we would either need to add a <code>global_help_template</code> function that would forward the template to children (<a href="https://github.com/clap-rs/clap/pull/2143/files#diff-7ae8c41c3ed7d1c77421d580c63754fcR2296-R2301">example</a>) or we could add a setting called <code>PropagateTemplate</code> which does the same.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/87.html">epage/clapng#87</a> on 2021-12-06 16:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: subcommands</span> removed by @epage on 2021-12-08 20:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: settings</span> removed by @epage on 2021-12-08 20:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-builder</span> added by @epage on 2021-12-08 20:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.1" by @epage on 2021-12-08 20:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> removed by @epage on 2021-12-09 18:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P3: want to have</span> removed by @epage on 2021-12-09 18:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-easy</span> removed by @epage on 2021-12-09 18:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> added by @epage on 2021-12-09 18:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-09 18:07</div>
            <div class="timeline-body"><p>One idea I have for this (and other issues) is if we implemented a layered config. Some fields would be designated as layered, like this, and others would not, like a subcommands display order.  For layered fields, we propagate them to subcommands if they are set in the parent but not the sucommand, and then continue this recursively.</p>
<p>So build would have code like:</p>
<pre><code>if let Some(help_template) = self.help_template.as_deref() {
    sub.help_template.get_or_insert(help_template)
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-12-10 02:10</div>
            <div class="timeline-body"><p>I think you might need to expand on this. I am quite confused reading your comment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-10 18:15</div>
            <div class="timeline-body"><p>Yeah, I can see needing to re-phrase since i'm using a term in an adjacent domain for which we have feature requests ;).</p>
<p>What if we modeled clap's builder API after layered config?  What I mean is where you take configuration from different sources and merge them together.</p>
<p>The approach I've taken in several applications that I've been finding works well is that the config data tracks what is <a href="https://github.com/epage/git-stack/blob/main/src/config.rs#L4">explicitly set, using <code>Option</code></a>.  You then build the final config by <a href="https://github.com/epage/git-stack/blob/main/src/config.rs#L38">merging all the sources</a> by <a href="https://github.com/epage/git-stack/blob/main/src/config.rs#L299">reading each layer and reading the explicitly set values, giving precedence to the higher layer</a>.  All the config fields are private and we expose <a href="https://github.com/epage/git-stack/blob/main/src/config.rs#L319">getters that contain the default value</a> so the callers don't care about these details.  Granted, when a user does a <code>--dump-config</code>, I want to <a href="https://github.com/epage/git-stack/blob/main/src/config.rs#L183">merge in the defaults</a> so they can see them</p>
<p>So what this would look like in <code>clap</code> is an <code>App</code> would have all &quot;global&quot; fields be <code>Option&lt;T&gt;</code>.  When we build, we merge the parent <code>App</code>s global fields into its subcommand with code blocks similar to</p>
<pre><code class="language-rust">if let Some(help_template) = self.help_template.as_deref() {
    subcommand.help_template.get_or_insert(help_template)
}
</code></pre>
<p>This will preserve the subcommands original help template.  If it was never explicitly set by the user, the parent command's help template would be used.</p>
<p>Depending on performance, we might also apply the default layer so that the accessors don't have to re-compute it on each call.</p>
<p><code>Arg::display_order</code> is part way there at this point</p>
<ul>
<li>https://github.com/clap-rs/clap/blob/master/src/build/arg/mod.rs#L84</li>
<li>https://github.com/clap-rs/clap/blob/master/src/build/arg/mod.rs#L4869</li>
<li>https://github.com/clap-rs/clap/blob/master/src/build/app/mod.rs#L2877</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2513.html">clap-rs/clap#2513</a> on 2021-12-13 16:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @epage on 2021-12-13 22:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2717.html">clap-rs/clap#2717</a> on 2022-01-10 15:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">:money_with_wings: $5</span> removed by @pksunkara on 2024-06-07 06:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:47:05 UTC
    </footer>
</body>
</html>
