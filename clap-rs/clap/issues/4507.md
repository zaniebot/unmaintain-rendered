```yaml
number: 4507
title: "Derive API: `#[arg(num_args = <...>)]` on `Vec<T>` has no effect"
type: issue
state: open
author: cyqsimon
labels:
  - C-bug
assignees: []
created_at: 2022-11-24T13:12:36Z
updated_at: 2023-01-05T14:00:46Z
url: https://github.com/clap-rs/clap/issues/4507
synced_at: 2026-01-10T01:57:48Z
```

# Derive API: `#[arg(num_args = <...>)]` on `Vec<T>` has no effect

---

_Issue opened by @cyqsimon on 2022-11-24 13:12_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Rust Version

1.65.0

### Clap Version

4.0.26

### Minimal reproducible code

```rust
use clap::Parser;

fn main() {
    let CliArgs { multi } = CliArgs::parse();
    dbg!(multi);
}

#[derive(Clone, Debug, Parser)]
pub struct CliArgs {
    #[arg(num_args = 1)]
    multi: Vec<String>,
}
```

### Steps to reproduce the bug with the above code

`cargo run -- a b c d`

### Actual Behaviour

Program debug prints `vec!["a", "b", "c", "d"]`.

### Expected Behaviour

Errors with something like this:
`error: Found argument 'b' which wasn't expected, or isn't valid in this context`

---

_Label `C-bug` added by @cyqsimon on 2022-11-24 13:12_

---

_Renamed from "Derive API: `#[arg(num_args = 1)]` on `Vec<T>` does not prevent multiple args" to "Derive API: `#[arg(num_args = <...>)]` on `Vec<T>` has no effect" by @cyqsimon on 2022-11-24 13:18_

---

_Comment by @cyqsimon on 2022-11-24 13:22_

What I was trying to do here was to only allow comma-separated values for `multi`. So my original code looked like this:
```rust
#[derive(Clone, Debug, Parser)]
pub struct CliArgs {
    #[arg(num_args = 1, value_delimiter = ',')]
    multi: Vec<String>,
}
```

But it seems like as long as the type of `multi` is `Vec<T>`, `num_args` has no effect, whether I set `#[arg(num_args = 1)]` or `#[arg(num_args = 1..=1)]`.

Eventually what I did was I set `action = ArgAction::Set`, which I guess is an alternate way to force the parser to reject additional arguments, but this is just a workaround in lieu of the non-functional `num_args`. This would only work if you want exactly 1 argument (like in my case). If you want to specify exactly 2 arguments for example, you would be out of luck.

---

_Comment by @cyqsimon on 2022-11-24 13:29_

Related discussion: https://github.com/clap-rs/clap/discussions/4469

I think this is where their confusion stems from.

---

_Comment by @epage on 2022-11-24 13:40_

The weird thing is that for positionals, the derive sets both `num_args(1..)` and `ArgAction::Append`.   I left a comment but neither it nor #4020 really explain why I did that.  At minimum, `num_args(1..)` is needed for proper support for groups when #4020 is stablized and `Append` is needed to intersperse positionals and flags.

---

_Comment by @JMLX42 on 2023-01-05 11:45_

Same proble with `1..` (to have at least 1 value):

```rust
#[derive(Args)]
pub struct DeleteFolder {
    #[arg(help = "The ID(s) of the folder(s) to delete", num_args = 1..)]
    pub folder: Vec<PathBuf>,
}
```

The command can be called with 0 value.

---

_Comment by @epage on 2023-01-05 14:00_

@JMLX42 `num_args` controls how many values are needed per occurrence but does not require an occurrence to be present.  For that, you would need `required = true`.

---

_Referenced in [clap-rs/clap#4613](../../clap-rs/clap/pulls/4613.md) on 2023-01-09 12:14_

---

_Referenced in [prefix-dev/pixi#2282](../../prefix-dev/pixi/pulls/2282.md) on 2024-10-15 12:23_

---
