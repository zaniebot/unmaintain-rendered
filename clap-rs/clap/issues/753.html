<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>required_unless() doesn't seem to work - clap-rs/clap #753</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>required_unless() doesn't seem to work</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/753">#753</a>
        opened by <a href="https://github.com/bestouff">@bestouff</a>
        on 2016-11-18 15:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/bestouff">@bestouff</a> on 2016-11-18 15:26</div>
            <div class="timeline-body"><h3>Rust Version</h3>
<p>1.13.0</p>
<h3>Affected Version of clap</h3>
<p>v2.18.0</p>
<h3>Expected Behavior Summary</h3>
<p>accept <code>--list</code> as an only arg</p>
<h3>Actual Behavior Summary</h3>
<pre><code>error: The following required arguments were not provided:
    --iface &lt;INTERFACE&gt;
    --file &lt;TESTFILE&gt;
    --server &lt;SERVER_IP&gt;
</code></pre>
<h3>Steps to Reproduce the issue</h3>
<p>call with <code>--list</code></p>
<h3>Sample Code or Link to Sample Code</h3>
<pre><code>        .arg(Arg::from_usage(&quot;-l, --list 'List available interfaces (and stop there)'&quot;))
        .arg(Arg::from_usage(&quot;-i, --iface=[INTERFACE] 'Ethernet interface for fetching NTP packets'&quot;)
            .required_unless(&quot;list&quot;))
        .arg(Arg::from_usage(&quot;-f, --file=[TESTFILE] 'Fetch NTP packets from pcap file'&quot;)
            .conflicts_with(&quot;iface&quot;)
            .required_unless(&quot;list&quot;))
        .arg(Arg::from_usage(&quot;-s, --server=[SERVER_IP] 'NTP server IP address'&quot;)
            .required_unless(&quot;list&quot;))
        .arg(Arg::from_usage(&quot;-p, --port=[SERVER_PORT] 'NTP server port'&quot;)
            .default_value(&quot;123&quot;))
        .get_matches();
</code></pre>
<h3>Debug output</h3>
<pre><code>*DEBUG:clap: fn=from_usage;
*DEBUG:clap: fn=new; usage=&quot;-l, --list \'List available interfaces (and stop there)\'&quot;
*DEBUG:clap: fn=parse;
*DEBUG:clap: iter; pos=0;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: fn=short_or_long;
*DEBUG:clap: fn=short;
*DEBUG:clap: setting short: l
*DEBUG:clap: setting name: l
*DEBUG:clap: iter; pos=1;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: fn=short_or_long;
*DEBUG:clap: fn=long;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: setting name: list
*DEBUG:clap: setting long: list
*DEBUG:clap: iter; pos=10;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: fn=help;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: setting help: List available interfaces (and stop there)
*DEBUG:clap: iter; pos=55;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: vals: None
*DEBUG:clap: fn=from_usage;
*DEBUG:clap: fn=new; usage=&quot;-i, --iface=[INTERFACE] \'Ethernet interface for fetching NTP packets\'&quot;
*DEBUG:clap: fn=parse;
*DEBUG:clap: iter; pos=0;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: fn=short_or_long;
*DEBUG:clap: fn=short;
*DEBUG:clap: setting short: i
*DEBUG:clap: setting name: i
*DEBUG:clap: iter; pos=1;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: fn=short_or_long;
*DEBUG:clap: fn=long;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: setting name: iface
*DEBUG:clap: setting long: iface
*DEBUG:clap: iter; pos=11;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: fn=name;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: setting val name: INTERFACE
*DEBUG:clap: iter; pos=22;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: fn=help;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: setting help: Ethernet interface for fetching NTP packets
*DEBUG:clap: iter; pos=69;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: vals: Some({0: &quot;INTERFACE&quot;})
*DEBUG:clap: fn=from_usage;
*DEBUG:clap: fn=new; usage=&quot;-f, --file=[TESTFILE] \'Fetch NTP packets from pcap file\'&quot;
*DEBUG:clap: fn=parse;
*DEBUG:clap: iter; pos=0;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: fn=short_or_long;
*DEBUG:clap: fn=short;
*DEBUG:clap: setting short: f
*DEBUG:clap: setting name: f
*DEBUG:clap: iter; pos=1;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: fn=short_or_long;
*DEBUG:clap: fn=long;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: setting name: file
*DEBUG:clap: setting long: file
*DEBUG:clap: iter; pos=10;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: fn=name;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: setting val name: TESTFILE
*DEBUG:clap: iter; pos=20;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: fn=help;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: setting help: Fetch NTP packets from pcap file
*DEBUG:clap: iter; pos=56;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: vals: Some({0: &quot;TESTFILE&quot;})
*DEBUG:clap: fn=from_usage;
*DEBUG:clap: fn=new; usage=&quot;-s, --server=[SERVER_IP] \'NTP server IP address\'&quot;
*DEBUG:clap: fn=parse;
*DEBUG:clap: iter; pos=0;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: fn=short_or_long;
*DEBUG:clap: fn=short;
*DEBUG:clap: setting short: s
*DEBUG:clap: setting name: s
*DEBUG:clap: iter; pos=1;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: fn=short_or_long;
*DEBUG:clap: fn=long;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: setting name: server
*DEBUG:clap: setting long: server
*DEBUG:clap: iter; pos=12;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: fn=name;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: setting val name: SERVER_IP
*DEBUG:clap: iter; pos=23;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: fn=help;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: setting help: NTP server IP address
*DEBUG:clap: iter; pos=48;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: vals: Some({0: &quot;SERVER_IP&quot;})
*DEBUG:clap: fn=from_usage;
*DEBUG:clap: fn=new; usage=&quot;-p, --port=[SERVER_PORT] \'NTP server port\'&quot;
*DEBUG:clap: fn=parse;
*DEBUG:clap: iter; pos=0;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: fn=short_or_long;
*DEBUG:clap: fn=short;
*DEBUG:clap: setting short: p
*DEBUG:clap: setting name: p
*DEBUG:clap: iter; pos=1;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: fn=short_or_long;
*DEBUG:clap: fn=long;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: setting name: port
*DEBUG:clap: setting long: port
*DEBUG:clap: iter; pos=10;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: fn=name;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: setting val name: SERVER_PORT
*DEBUG:clap: iter; pos=23;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: fn=help;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: setting help: NTP server port
*DEBUG:clap: iter; pos=42;
*DEBUG:clap: fn=stop_at;
*DEBUG:clap: vals: Some({0: &quot;SERVER_PORT&quot;})
*DEBUG:clap: fn=get_matches_with;
*DEBUG:clap: fn=create_help_and_version;
*DEBUG:clap: Building --help
*DEBUG:clap: Building --version
*DEBUG:clap: Begin parsing '&quot;--list&quot;' ([45, 45, 108, 105, 115, 116])
*DEBUG:clap: Starts new arg...Maybe
*DEBUG:clap: fn=possible_subcommand
*DEBUG:clap: fn=parse_long_arg;
*DEBUG:clap: Does it contain '='...No
*DEBUG:clap: Found valid flag '--list'
*DEBUG:clap: Checking if --list is help or version...Neither
*DEBUG:clap: fn=parse_flag;
*DEBUG:clap: macro=validate_multiples!;
*DEBUG:clap: fn=groups_for_arg; name=list
*DEBUG:clap: No groups defined
*DEBUG:clap: macro=arg_post_processing!;
*DEBUG:clap: Is '--list' in overrides...No
*DEBUG:clap: Does '--list' have overrides...No
*DEBUG:clap: Does '--list' have conflicts...No
*DEBUG:clap: Does '--list' have requirements...No
*DEBUG:clap: macro=_handle_group_reqs!;
*DEBUG:clap: fn=add_val_to_arg;
*DEBUG:clap: adding val: &quot;123&quot;
*DEBUG:clap: fn=groups_for_arg; name=port
*DEBUG:clap: No groups defined
*DEBUG:clap: fn=validate_value; val=&quot;123&quot;
*DEBUG:clap: macro=arg_post_processing!;
*DEBUG:clap: fn=fmt
*DEBUG:clap: Is '--port &lt;SERVER_PORT&gt;' in overrides...No
*DEBUG:clap: fn=fmt
*DEBUG:clap: Does '--port &lt;SERVER_PORT&gt;' have overrides...No
*DEBUG:clap: fn=fmt
*DEBUG:clap: Does '--port &lt;SERVER_PORT&gt;' have conflicts...No
*DEBUG:clap: fn=fmt
*DEBUG:clap: Does '--port &lt;SERVER_PORT&gt;' have requirements...No
*DEBUG:clap: macro=_handle_group_reqs!;
*DEBUG:clap: fn=validate_blacklist;blacklist=[]
*DEBUG:clap: fn=validate_num_args;
*DEBUG:clap: fn=_validate_num_vals;
*DEBUG:clap: fn=create_usage;
*DEBUG:clap: fn=create_usage_no_title;
*DEBUG:clap: args_in_groups=[]
*DEBUG:clap: fn=fmt
*DEBUG:clap: fn=fmt
*DEBUG:clap: fn=fmt
*DEBUG:clap: fn=needs_flags_tag;
*DEBUG:clap: iter;f=list;
*DEBUG:clap: fn=groups_for_arg; name=list
*DEBUG:clap: No groups defined
*DEBUG:clap: Flag not required...(returning true)
*DEBUG:clap: args_in_groups=[]
*DEBUG:clap: fn=fmt
*DEBUG:clap: fn=fmt
*DEBUG:clap: fn=fmt
*DEBUG:clap: fn=create_usage;
*DEBUG:clap: fn=create_usage_no_title;
*DEBUG:clap: fn=smart_usage;
*DEBUG:clap: args_in_groups=[]
*DEBUG:clap: fn=fmt
*DEBUG:clap: fn=fmt
*DEBUG:clap: fn=fmt
*DEBUG:clap: fn=fmt
*DEBUG:clap: fn=color;
*DEBUG:clap: Color setting...Auto
*DEBUG:clap: fn=error;
*DEBUG:clap: fn=is_a_tty;
*DEBUG:clap: Use stderr...true
*DEBUG:clap: fn=good;
*DEBUG:clap: fn=is_a_tty;
*DEBUG:clap: Use stderr...true
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-11-20 19:52</div>
            <div class="timeline-body"><p>Thanks for posting this! I should have fixed quickly :wink:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: parsing</span> added by @kbknapp on 2016-11-20 19:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by @kbknapp on 2016-11-20 19:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> added by @kbknapp on 2016-11-20 19:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @kbknapp on 2016-11-20 19:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @kbknapp on 2016-11-20 19:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-11-21 00:11</div>
            <div class="timeline-body"><p>I've got this fixed in a local branch, should have it uploaded and the PR through shortly. Then I'll upload the new version to crates.io and post back here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @homu on 2016-11-21 04:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bestouff">@bestouff</a> on 2016-11-21 08:00</div>
            <div class="timeline-body"><p>Great thanks !</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-11-21 14:17</div>
            <div class="timeline-body"><p>v2.19.0 is out on crates.io</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:22 UTC
    </footer>
</body>
</html>
