<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom argument display groups - clap-rs/clap #805</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Custom argument display groups</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/805">#805</a>
        opened by <a href="https://github.com/RazrFalcon">@RazrFalcon</a>
        on 2017-01-03 20:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/RazrFalcon">@RazrFalcon</a></div>
            <div class="timeline-body"><p>Hello. I want to group options into categories, like <a href="https://github.com/RazrFalcon/svgcleaner/blob/master/data/help.txt">this</a>. See: Elements, Attributes, Paths, etc.</p>
<p>It there a way to do this in the current <code>clap</code> version or is it will be implemented?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-03 21:22</div>
            <div class="timeline-body"><p>Unfortunately it&#x27;s not supported at this time unless you simply write the help message yourself (copy/paste your example into <code>App::help</code>). That&#x27;s not a <em>horrible</em> answer, as you still get all the benefits of <code>clap</code> like context sensitive usage statements/errors, validations, aliases, relationships, etc. But you do miss out on having the help generated/updated for you. If that doesn&#x27;t sound like something you&#x27;d want to do, there&#x27;s also <a href="https://github.com/docopt/docopt.rs">docopt</a> which is another argv parser that basically takes your help message as you have written and uses that to generate the valid arguments.</p>
<p>For completeness sake, you <em>could</em> force it to happen in clap, but it&#x27;d be very hacky even though functional. If you want to see, I can give you a demo :wink:</p>
<hr>
<p>Having said all this, it&#x27;d be possible for me to add this is feature, and I&#x27;d be curious to know if others want this same thing. I personally think it&#x27;d be somewhat of a pain to enter, <code>arg.help_group(&quot;foo&quot;)</code> for every arg unless you&#x27;re using a macro (which many actually do). Of course, I could also add an <code>App::help_group(&quot;group&quot;, &amp;[&quot;arg1&quot;, &quot;arg2&quot;, &quot;arg3&quot;])</code> but you&#x27;d still risk not keeping that list up to date as your list of args changes and evolves.</p>
<p>I&#x27;d like to hear some thoughts on the matter :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-03 21:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#686</a> on 2017-01-03 21:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-03 21:27</div>
            <div class="timeline-body"><p>Possibly relates to #686</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RazrFalcon">@RazrFalcon</a> on 2017-01-03 21:48</div>
            <div class="timeline-body"><blockquote>
<p>That&#x27;s not a horrible answer</p>
</blockquote>
<p>Well... it&#x27;s not, since it what I&#x27;m <a href="https://github.com/RazrFalcon/svgcleaner/blob/master/src/cli.rs#L165">doing right now</a>.</p>
<p>I don&#x27;t really know what kind of API I want, but since I prefer that options should be in a specific order (I forgot to mention this in OP. In example, there are not only groups that matter, but also an order of options inside. Yes, it&#x27;s visual only and do not change parsing in any way.), so I guess something like:
<code>Arg::group_to(&quot;group_name&quot;).group_pos(1)</code>
but it&#x27;s looks to specific for my case and I don&#x27;t know it anyone will want to use it.</p>
<p>I&#x27;ll think about how it can be implemented, API-wise. Sounds like keeping an own help file is the easiest way...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-03 23:38</div>
            <div class="timeline-body"><p>The order of arguments can already be specified manually (using <a href="https://docs.rs/clap/2.19.3/clap/struct.Arg.html#method.display_order"><code>Arg::display_order</code></a>), or placed in the order that you define them (using <a href="https://docs.rs/clap/2.19.3/clap/enum.AppSettings.html#variant.DeriveDisplayOrder"><code>AppSettings::DeriveDisplayOrder</code></a>)</p>
<p>In fact, the hack I hinted at uses those options, along with afew others to trick the generated help message.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-04 01:20</div>
            <div class="timeline-body"><p><a href="https://gist.github.com/kbknapp/e4b1c4671848c7c1b019e39021e28ae4">Here&#x27;s what I meant by the hack to make it work</a></p>
<p>Is this any better than copy/pasting the help? I know it&#x27;s looks uglier, but it has the benefit of never falling out of date. Granted, there are drawbacks such as the &quot;can&#x27;t have a default here&quot; portions. Although there are ways around that; such as unless you have a really good reason not to (like porting a well known CLI), it&#x27;s considered better UX to use flags instead of options for the <code>true/false</code> values. This would also remove the need for defaults. If you <em>do</em> need to use an option for <code>true/false</code> you could just use <code>value_of(&quot;option&quot;).unwrap_or(default)</code> for those 4 or so args which isn&#x27;t too big a deal.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RazrFalcon">@RazrFalcon</a> on 2017-01-04 06:33</div>
            <div class="timeline-body"><p><code>DeriveDisplayOrder</code> is a good stuff, I didn&#x27;t notice it.</p>
<p>Adding newlines to <code>help()</code> is an interesting idea, sadly I need default values. Maybe there is a way to insert dummy/custom text between args?</p>
<p>About <code>true/false</code>: yes, I don&#x27;t like it either, but most of options should be enabled by default and I don&#x27;t know is it possible for flags. Only way I see is too name default options as <code>keep-*</code>(or similar) and disabled as <code>remove-*</code>(or similar). So flag will able to disable enabled options and enable disabled. But then to change the default value I have to rename it...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-04 14:37</div>
            <div class="timeline-body"><blockquote>
<p>About <code>true/false</code></p>
</blockquote>
<p>I think convention is to use <code>--no-*</code> for something that defaults to true and <code>--*</code> for something that defaults to false.</p>
<p>Such as <code>--remove-comments &lt;FLAG&gt; [defualt: true]</code> -&gt; <code>--comments</code>, or <code>--remove-gradient-attributes &lt;FLAG&gt; [defualt: false]</code> -&gt; <code>--no-gradient-attributes</code></p>
<p>Another option is to group like functionality into a single option. For example, all the &quot;removal&quot; flags become:</p>
<pre><code>--remove-element &lt;ELEMENT&gt;...    Removes a particular element [values: comments, declarations,
                                 nonsvg-elements, unused-defs, title, desc, metadata, 
                                 dupl-lineargradient, dupl-radialgradient, dupl-fegaussianblur, 
                                 invalid-stops, invisible-elements]
</code></pre>
<p>Then you could set this up to allow <code>--remove-element &lt;element1&gt; &lt;element2&gt;</code> or <code>--remove-element &lt;element1&gt; --remove-element &lt;element2&gt;</code> depending on whichever you prefer.</p>
<p>We&#x27;re digressing from the original topic, but that&#x27;s fine because I enjoy CLI UX :smile:</p>
<hr>
<p>I&#x27;m going to play with adding, &quot;display groups&quot; and see how it feels. I&#x27;ll post back here with an example once I have it working.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RazrFalcon">@RazrFalcon</a> on 2017-01-04 16:51</div>
            <div class="timeline-body"><p><code>--no-*</code> is a great idea, it&#x27;s like in GCC, but is such behavior handled by clap? Or is there should be two flags for each option?</p>
<p>I thought about groping, but it&#x27;s harder to generate, from GUI for example, and also it&#x27;s harder to write, because it will be one, very long line. And I&#x27;m already have more than 50 options. In current version I can separate each option with the <code>\</code> (for new lines). Which is useful.</p>
<p>Actual problem with flags, is that most of them are enabled by default. So it will be just a bunch of keys which disables staff, like: <code>--keep-*</code>, <code>--skip-*</code>, etc. Which is counter-intuitive.</p>
<p>PS: I don&#x27;t mind discussing CLI UX, since there are not mach articles about it. And <code>docopt</code> doc, which you mention, is one of them. Also there are not much applications with a lot of CLI arguments. I look up for: gcc, clang, mpv. And they all simply shows alphabetically sorted list of options. Some exceptions are <code>qmake</code>, which uses grouping just like me. But the way they do this <a href="https://github.com/qt/qtbase/blob/dev/qmake/option.cpp#L125">is not really interesting</a>. And <code>eix</code>, but they <a href="https://github.com/vaeth/eix/blob/master/src/eix.cc#L89">do the same</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-04 19:21</div>
            <div class="timeline-body"><blockquote>
<p>is such behavior handled by clap? Or is there should be two flags for each option?</p>
</blockquote>
<p>No, if an argument defaults to true, that means the functionality is &quot;on&quot; by default. So the user not passing the flag is consent for that action to take place (default true), but then you have a <code>--no-*</code> to change the default functionality, or turn off that functionality. So you only need one flag per item.</p>
<p>Here&#x27;s the comparison for items defaulting to true:</p>
<p>New | Previous
------|----------
<strong>nothing</strong> |  <code>--option true</code>
<code>--no-option</code> | <code>--option false</code></p>
<p>The inverse also applies. Something that defaults to false, <em>doesn&#x27;t</em> do some particular action. Then supplying <code>--action</code> turns that feature back on.</p>
<p>New | Previous
------|----------
<code>--option</code> |  <code>--option true</code>
<strong>nothing</strong> | <code>--option false</code></p>
<p>It makes your CLI more concise, and help messages are easier to read as well.</p>
<blockquote>
<p>grouping [..] it&#x27;s harder to write, because it will be one, very long line.</p>
</blockquote>
<p><code>clap</code> handles this part of your help message for you (Look up <code>Arg::possible_values</code>, work proxy is preventing me from linking to it). So no writing required (other than specifying the options that are valid). You can also prevent them from being printed in the help message if you think it&#x27;s too long via <code>AppSettings::HidePossibleValues</code></p>
<blockquote>
<p>Actual problem with flags, is that most of them are enabled by default. So it will be just a bunch of keys which disables staff, like: --keep-<em>, --skip-</em>, etc. Which is counter-intuitive.</p>
</blockquote>
<p>I think it&#x27;s actually the opposite. And your help message for that flag can say, &quot;By default svgcleaner removes X, this flag disables that removal&quot; Because the other way around, what you&#x27;ll end up seeing is people running <code>svgcleaner --option true</code> even though it&#x27;s the default, they&#x27;ll think you <em>have</em> to specify something, &quot;Or else it wouldn&#x27;t be an option.&quot;</p>
<p>There&#x27;s other oddities as well, such as users forgetting whether it&#x27;s <code>true/false</code>, <code>yes/no</code>, <code>on/off</code>, <code>y/n</code> or any other variant. So you may end creating parser to allow any of the above, or translating a <code>true/false</code> instead of simply checking if <code>--no-*</code> was used or not. Done.</p>
<p>I&#x27;m not saying it&#x27;s <em>wrong</em>, as it can totally be done with <code>true/false</code> it&#x27;s just slightly harder :)</p>
<blockquote>
<p>I don&#x27;t mind discussing CLI UX, since there are not mach articles about it.</p>
</blockquote>
<p>I&#x27;m actually working on releasing an mdBook (same as Rust book) about CLI UX in general, and using Rust, since it&#x27;s something I really enjoy working on and thinking about. It&#x27;ll be a while before it&#x27;s ready though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RazrFalcon">@RazrFalcon</a> on 2017-01-05 17:16</div>
            <div class="timeline-body"><p>Thanks. I&#x27;ll keep thinking about it.</p>
<p>Waiting for a book.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Custom options grouping categories &quot; to &quot;Custom argument display groups&quot; by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-30 05:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-04-05 18:43</div>
            <div class="timeline-body"><p>I did some playing with this and ergonomics aren&#x27;t great. It&#x27;s also a huge rework of how clap writes a help message and thus I&#x27;m gonna have to close this for now as it&#x27;s not feasible to include in the current version. Perhaps 3.x will make this more doable, but it&#x27;s still unlikely.</p>
<p>I am, however, still open to suggestions on how this could work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-04-05 18:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/RazrFalcon">@RazrFalcon</a> on 2017-04-05 18:52</div>
            <div class="timeline-body"><p>Ok. I&#x27;ve ended up thinking that a custom help is the best solution.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-04-05 19:01</div>
            <div class="timeline-body"><p>Bah, I&#x27;m gonna keep this open. It <em>is</em> something I&#x27;d like to have. It probably won&#x27;t happen soon, but I do want this style of feature.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-04-05 19:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: args</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-04-05 19:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: help message</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-04-05 19:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: hard</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-04-05 19:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P3: want to have</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-04-05 19:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-04-05 19:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> removed by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-04-05 19:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x blocker</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-05-09 18:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rtsuk">@rtsuk</a> on 2017-08-08 16:04</div>
            <div class="timeline-body"><p>Adding my vote for this feature. My Fuchsia-specific cargo wrapper <a href="https://fuchsia.googlesource.com/fargo/">Fargo</a> could really benefit from it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-08-09 02:31</div>
            <div class="timeline-body"><p>I&#x27;m trying to get 3.x out the door in the coming weeks so I can start knocking out all the current feature/bug reports. This particular feature is high on my list though :wink:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-02-05 15:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x blocker</span> removed by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-02-05 15:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#1037</a> on 2018-02-15 14:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#1211</a> on 2018-03-18 12:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-04-04 03:38</div>
            <div class="timeline-body"><p>Closed with #1211 (will be released in v3)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-04-04 03:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#1250</a> on 2018-04-18 09:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>BurntSushi/ripgrep#1814</a> on 2021-07-28 13:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:56:42 UTC
    </footer>
</body>
</html>
