<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add no_std compatibility - clap-rs/clap #1485</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add no_std compatibility</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/clap-rs/clap/issues/1485">#1485</a>
        opened by <a href="https://github.com/elast0ny">@elast0ny</a>
        on 2019-06-05 18:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/elast0ny">@elast0ny</a> on 2019-06-05 18:06</div>
            <div class="timeline-body"><h3>Feature Request Summary</h3>
<p>Would it be possible to split clap argument parsing logic into a <code>no_std</code> &quot;clap_core&quot; crate or allow crates to toggle a <code>no_std</code> style feature.</p>
<p>This would probably strip most of the clap features such as <code>print_help()</code>, exiting on error, loading from yaml, etc... but the core argument parsing logic should still work.</p>
<p><code>no_std</code> clap could expose a <code>.get_matches_from()</code> like function which could return a <code>ClapResult&lt;ArgMatches&lt;'a&gt;&gt;</code> leaving the error handling up to the caller. Optionally, <code>no_std</code> clap could also expose ways to get pre-formated help/long_help buffers for crates who wish to display the information.</p>
<h3>Current Behavior</h3>
<p>Clap is incompatible with <code>no_std</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Split argument parsing logic into a no_std library" to "Add no_std compatibility" by @elast0ny on 2019-06-05 18:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-01 13:30</div>
            <div class="timeline-body"><p>Marking for <code>3.0</code> milestone because it would be breaking change</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: other</span> added by @CreepySkeleton on 2020-02-01 13:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> added by @CreepySkeleton on 2020-02-01 13:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by @CreepySkeleton on 2020-02-01 13:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new setting</span> added by @CreepySkeleton on 2020-02-01 13:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @CreepySkeleton on 2020-02-01 13:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Dylan-DPC-zz">@Dylan-DPC-zz</a> on 2020-02-01 13:54</div>
            <div class="timeline-body"><p>This needs some work and depend on the demand (cli in environments where you want no_std is niche iirc). We can push this for a future release</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1384.html">clap-rs/clap#1384</a> on 2020-02-01 15:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new setting</span> removed by @pksunkara on 2020-02-01 19:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-02-01 19:07</div>
            <div class="timeline-body"><p>I agree, this is not breaking if we just add a new feature to cargo. We can push this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by @pksunkara on 2020-02-01 19:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.0" by @pksunkara on 2020-02-01 19:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @pksunkara on 2020-02-01 19:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-02-01 20:03</div>
            <div class="timeline-body"><p>You'll want to add a <code>std</code> feature that is enabled by default and produces a compilation error when it is disabled. Otherwise it's quite likely that you'll break extant uses of <code>default-features = false</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-02-01 20:05</div>
            <div class="timeline-body"><p>@BurntSushi Thanks for the input. I haven't worked with <code>no_std</code> before. Is this the standard way of doing things? Is there any issue with adding <code>no_std</code> feature instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-02-01 20:10</div>
            <div class="timeline-body"><p>Yes it is standard. Features should be additive, since enabling them in a dependency enables it for all instances of that crate in a dependency tree.</p>
<p>The main point here is to make sure you add the feature in clap 3, so that you can add it later in a backwards compatible fashion.</p>
<p>(I would personally be surprised if making clap compatible with no_std was easy without significant changes to the public API. Perhaps an alloc-only version would be simpler. But I confess that I have not thought deeply about it.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.1" by @pksunkara on 2020-02-01 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @pksunkara on 2020-02-01 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Dylan-DPC-zz">@Dylan-DPC-zz</a> on 2020-02-01 21:22</div>
            <div class="timeline-body"><p>Don't worry. I'll handle the no_std part. Well generally the default crate should be in no_std and then std is added as a new feature. The problem with that is it is difficult to do it in a non-breaking way. Also I don't want to keep the release waiting for it, so likely it will happen in a minor release in the future in a non-breaking (or a short term solution ) or properly in 4.0</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-02-01 21:45</div>
            <div class="timeline-body"><p>@Dylan-DPC Hmmm, I'm not sure if I conveyed my thoughts well enough. What I'm saying here is that with the clap 3 initial release, you can add a <code>std</code> feature that is enabled by default. When it is disabled, you can use <code>compile_error!(...)</code> to cause it to always fail. That way, once you do decide to add the feature, you can make whatever changes you want since the lack of a <code>std</code> feature previously never compiled anyway.</p>
<p>This is exactly the approach that the <code>regex</code> crate takes, with the hope of providing an alloc-only mode in the future.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Dylan-DPC-zz">@Dylan-DPC-zz</a> on 2020-02-02 00:30</div>
            <div class="timeline-body"><p>I've added a dummy no-op feature in https://github.com/clap-rs/clap/commit/6aaeb2718b6daa3d2024759183d588243e5c3565</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.0" by @CreepySkeleton on 2020-02-02 01:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @CreepySkeleton on 2020-02-02 01:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.1" by @pksunkara on 2020-02-02 05:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @pksunkara on 2020-02-02 05:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.0" by @pksunkara on 2020-02-02 05:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @pksunkara on 2020-02-02 05:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> removed by @pksunkara on 2021-08-13 10:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/120.html">epage/clapng#120</a> on 2021-12-06 18:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: other</span> removed by @epage on 2021-12-08 20:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-meta</span> added by @epage on 2021-12-08 20:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.1" by @epage on 2021-12-08 20:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> removed by @epage on 2021-12-08 21:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @epage on 2021-12-08 21:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> removed by @epage on 2021-12-09 20:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-decision</span> added by @epage on 2021-12-09 20:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/barafael">@barafael</a> on 2022-04-30 20:38</div>
            <div class="timeline-body"><p>It would also be very useful to be able to derive <code>ArgEnum</code> for enums from no_std crates.</p>
<p>E.g.:</p>
<pre><code>    #[clap(default_value = &quot;None&quot;, possible_values = &amp;[&quot;None&quot;, &quot;Odd&quot;, &quot;Even&quot;])]
    parity: Parity,
</code></pre>
<p>where <code>Parity</code> is an enum defined in some <code>no_std</code> driver for which one is currently writing a CLI.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/felipebalbi">@felipebalbi</a> on 2022-12-04 12:34</div>
            <div class="timeline-body"><p>Support for <code>no_std</code> would be super useful in environments such as UEFI where one can rely on <code>uefi-rs</code> to write applications for it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ChandlerPrue">@ChandlerPrue</a> on 2024-07-26 14:48</div>
            <div class="timeline-body"><p>This ticket looks pretty stale. I just tested the no_std in 4.5.11 and see its still dependent on std. As someone trying to compile for UEFI i'd support this feature, but would also appreciate the clarity of closing this issue if its not being considered anymore</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-07-26 15:07</div>
            <div class="timeline-body"><blockquote>
<p>would also appreciate the clarity of closing this issue if its not being considered anymore</p>
</blockquote>
<p>Just because something is stale doesn't mean it won't be considered any more.  There are lots of features of interest and limited capacity to move them forward.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tommasoclini">@tommasoclini</a> on 2025-02-02 13:50</div>
            <div class="timeline-body"><p>Do you know any alternatives compatible with no_std?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-02-03 17:12</div>
            <div class="timeline-body"><p>The big problem with <code>no_std</code> is the lack of <code>OsStr</code>.  That is a fundamental type for CLI parsers and they would need to be generic over it, making the API less ergonomic.  <a href="https://docs.rs/getargs/0.5.0/getargs/"><code>getargs</code></a> is one of the few that is <code>no_std</code>, dealing only with <code>&amp;str</code>s.  However, take any of their performance numbers with a grain of salt (<a href="https://www.reddit.com/r/rust/comments/wbblxc/getargs_050_is_finally_out_fastest_rust_argument/ii6atqw/">explanation</a>).  Looks like <a href="https://docs.rs/gumdrop/0.8.1/gumdrop/"><code>gumpdrop</code></a> also uses <code>&amp;str</code>, unsure why they haven't added <code>no_std</code> support as well (containers?).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tommasoclini">@tommasoclini</a> on 2025-02-03 17:51</div>
            <div class="timeline-body"><p>I need a CLI in an embedded system, so I don't really care about the API being ergonomic, I've found the <a href="https://crates.io/crates/embedded-cli/">embedded-cli</a> crate, but it has been developed by a single person, and is not very active because of not many people using it. The shell part is not that hard to make, I'm not sure if I would even need history or autocompletion, but the features that clap offer are pretty nice.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:07 UTC
    </footer>
</body>
</html>
