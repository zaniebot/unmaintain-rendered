<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Is there currently a way to call a function to provide a default value (instead of a static string)? - clap-rs/clap #1777</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Is there currently a way to call a function to provide a default value (instead of a static string)?</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/1777">#1777</a>
        opened by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a>
        on 2020-04-01 21:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-04-01 21:26</div>
            <div class="timeline-body"><p>Is there currently a way to call a function to provide a default value (instead of a static string)? This is in the context of Clap's proc_macro.</p>
<p>We have some resolution logic (config file, plus global configuration, plus some environment stuff) for default values, and that would be very useful.</p>
<p>For a concrete example, we have a <code>--file</code> argument for a server, which takes a filename and validates it's a valid path (user can write to it). If it's not passed in, it should be read from an environment variable. If that's not specified, it should be in a configuration file. If it's not there, it should be at the root of the project (if the user is running inside a project). All else, it should be a temporary file (using <code>temp_file()</code>). We could use an <code>Option&lt;PathBuf&gt;</code> and set it after arg matching, but it complicates the code using it (unwrapping everywhere). Simplest is to panic during arg parsing (e.g. if user has no right to the fs), else just be a <code>PathBuf</code>, from the clap code directly.</p>
<p>I know there is a <code>parse</code> argument to the proc_macro, but AFAIK it only applies if there is a value passed by the user, not for default values.</p>
<p><em>Originally posted by @hansl in https://github.com/clap-rs/clap/discussions/1776</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: other</span> added by @CreepySkeleton on 2020-04-01 21:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by @CreepySkeleton on 2020-04-01 21:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-01 21:35</div>
            <div class="timeline-body"><p>What does clap need to do here? If we are talking about default values for args being provided by external stuff, we should already have an issue about this called hooks somewhere.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TeXitoi">@TeXitoi</a> on 2020-04-01 22:40</div>
            <div class="timeline-body"><p>@hansl does using a lazy static allow you to do what you want.</p>
<p>An example: https://github.com/CanalTP/mimirsbrunn/blob/master/libs/bragi/src/lib.rs#L67</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-07 15:54</div>
            <div class="timeline-body"><p>This should be covered by the hooks suggestion in https://github.com/clap-rs/clap/issues/1634</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @pksunkara on 2020-04-07 15:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lynn">@lynn</a> on 2024-04-16 12:55</div>
            <div class="timeline-body"><p>You can now use <code>#[clap(default_value_t = my_fn())]</code> for this. <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=731f0008d73402fd93f44c54b5c7e2f0">Example on Rust Playground</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1453.html">clap-rs/clap#1453</a> on 2025-01-20 03:41</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:32 UTC
    </footer>
</body>
</html>
