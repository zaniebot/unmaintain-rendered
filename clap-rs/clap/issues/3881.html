<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>modify existing subcommands in `Command` struct - clap-rs/clap #3881</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>modify existing subcommands in `Command` struct</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/3881">#3881</a>
        opened by <a href="https://github.com/emersonford">@emersonford</a>
        on 2022-06-28 22:43
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/emersonford">@emersonford</a> on 2022-06-28 22:43</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>3.2.6</p>
<h3>Describe your use case</h3>
<p>I'm writing a Clap CLI that will eventually replace an existing Python CLI we have. The goal is to have this new CLI be the default one used and have it support fallback to the Python CLI for subcommands that are not yet implemented. Ideally, I'd like to <em>dynamically</em> generate the fallback subcommands as to not require any code changes / manually syncing between the Python version and the Clap/Rust version.</p>
<p>While <code>.allow_external_subcommands</code> gets me sort of there, but it gets messy in this instance:</p>
<ol>
<li>Python CLI has command <code>foo generate bar</code> and <code>foo read bar</code></li>
<li>New Clap CLI has command <code>foo generate baz</code> and <code>foo read baz</code> but not <code>foo generate bar</code> or <code>foo read bar</code>.</li>
</ol>
<p>Currently, we'd have to add <code>.allow_external_subcommands</code> to both the <code>generate</code> subcommand and <code>read</code> subcommand, and implement duplicate matching logic for both. This also can't be done dynamically and we'd have to update the Rust/Clap CLI if there are any changes to the Python CLI.</p>
<p>What I'd ideally like is, traverse an existing <code>Command</code> we have (i.e. made with the Derive API) and insert subcommands found from the Python CLI command tree (which I can already generate) that are not in our current <code>Command</code> struct. This part is currently not possible as there's no way to modify existing subcommands as far as I'm aware. I can then have logic with <code>get_matches()</code> to detect when a fallback subcommand is used.</p>
<h3>Describe the solution you'd like</h3>
<p>There's already an API to modify existing args, <code>mut_arg</code> so I think the best solution would just be to duplicate this logic in a <code>mut_subcommand</code> method.</p>
<h3>Alternatives, if applicable</h3>
<p><em>No response</em></p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @emersonford on 2022-06-28 22:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3882.html">clap-rs/clap#3882</a> on 2022-06-28 22:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-06-30 01:28</div>
            <div class="timeline-body"><p>Wow, that is a fairly limited solution, one that I would not normally prioritize for implementation but the tool proposed for the solution is fully aligned with what we would want anyways, so I'm ok with this moving forward.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @emersonford on 2022-07-15 16:19</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:34 UTC
    </footer>
</body>
</html>
