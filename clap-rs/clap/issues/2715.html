<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support fish correct completion for nested subcommands - clap-rs/clap #2715</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support fish correct completion for nested subcommands</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/2715">#2715</a>
        opened by <a href="https://github.com/ModProg">@ModProg</a>
        on 2021-08-18 14:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ModProg">@ModProg</a> on 2021-08-18 14:24</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
<h3>Clap Version</h3>
<p>master</p>
<h3>Describe your use case</h3>
<p>There are two cases where the current solution does not work:</p>
<h4>Simple case (can be solved with fish build-ins)</h4>
<p>Example command syntax:
<code>command A B &lt;parameter&gt;</code>
<code>command A C &lt;parameter&gt;</code>
Currently pressing tab after writing <code>A</code> it will complete <code>B</code> as well as <code>C</code> again.</p>
<h4>Complex case (we probably would need to write something our own)</h4>
<p>Probably wont happen that often:
Two subcommand chains:
<code>command A B C</code>
<code>command B A D</code>
These are even with the simple solution not differentiable.</p>
<h3>Describe the solution you'd like</h3>
<h4>Simple Case</h4>
<p>Instead of only requirering the parent subcommand to exist, rather also check that self and the sibling commands do not exist:</p>
<pre><code class="language-sh">complete -c command -n &quot;__fish_use_subcommand&quot; -x -a &quot;A&quot;
complete -c command -n &quot;__fish_seen_subcommand_from A; and not __fish_seen_subcommand_from B C&quot; -x -a &quot;B&quot;
complete -c command -n &quot;__fish_seen_subcommand_from A; and not __fish_seen_subcommand_from B C&quot; -x -a &quot;C&quot;
</code></pre>
<h4>Complex case</h4>
<p>Not sure how to solve. Probably need something like https://github.com/clap-rs/clap/blob/a61eaf8aade76cfe90ccc0f7125751ebf60e3254/src/completions.rs#L237-L248 again.
With fish buildins <code>A B</code> and <code>B A</code> is  the same. Therefor you would get both <code>C</code> and <code>D</code> for both. The same would happen if at some point a subcommand gets repeated (maybe more likely than the <code>AB</code> <code>BA</code> example).</p>
<p>Insufficient solution using standard <code>complete</code> functionality</p>
<pre><code class="language-sh">complete -c command -n &quot;__fish_use_subcommand&quot; -x -a &quot;A&quot;
complete -c command -n &quot;__fish_use_subcommand&quot; -x -a &quot;B&quot;
complete -c command -n &quot;__fish_seen_subcommand_from A; and not __fish_seen_subcommand_from B&quot; -x -a &quot;B&quot;
complete -c command -n &quot;__fish_seen_subcommand_from B; and not __fish_seen_subcommand_from A&quot; -x -a &quot;A&quot;
complete -c command -n &quot;__fish_seen_subcommand_from A; and __fish_seen_subcommand_from B;  and not __fish_seen_subcommand_from C&quot; -x -a &quot;C&quot;
complete -c command -n &quot;__fish_seen_subcommand_from B; and __fish_seen_subcommand_from A;  and not __fish_seen_subcommand_from D&quot; -x -a &quot;D&quot;
</code></pre>
<h3>Alternatives, if applicable</h3>
<p><em>No response</em></p>
<h3>Additional Context</h3>
<p>This is somewhat a regression see  #685</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by @ModProg on 2021-08-18 14:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ModProg">@ModProg</a> on 2021-08-18 14:25</div>
            <div class="timeline-body"><p>Hmm, maybe this would have been rather a bug than a feature</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/685.html">clap-rs/clap#685</a> on 2021-08-18 14:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-08-18 14:54</div>
            <div class="timeline-body"><p>I wouldn't worry about subcommand chains since they are not supported in clap.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> removed by @pksunkara on 2021-08-18 14:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @pksunkara on 2021-08-18 14:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: generator</span> added by @pksunkara on 2021-08-18 14:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ModProg">@ModProg</a> on 2021-08-18 15:11</div>
            <div class="timeline-body"><blockquote>
<p>I wouldn't worry about subcommand chains since they are not supported in clap.</p>
</blockquote>
<p>I did not mean chained commands, I meant multiple level of subcommands, where the naming is repeating.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ModProg">@ModProg</a> on 2021-08-18 15:47</div>
            <div class="timeline-body"><p>I'll have a look at how the simple version can be implemented.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2726.html">clap-rs/clap#2726</a> on 2021-08-19 22:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @pksunkara on 2021-09-08 14:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:08 UTC
    </footer>
</body>
</html>
