```yaml
number: 4838
title: Please provide an argument to make the derive automatically generate a test
type: issue
state: open
author: joshtriplett
labels:
  - C-enhancement
  - A-derive
  - S-waiting-on-design
assignees: []
created_at: 2023-04-17T04:40:00Z
updated_at: 2023-04-17T15:05:31Z
url: https://github.com/clap-rs/clap/issues/4838
synced_at: 2026-01-10T01:57:48Z
```

# Please provide an argument to make the derive automatically generate a test

---

_Issue opened by @joshtriplett on 2023-04-17 04:40_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Clap Version

4.2.2

### Describe your use case

I currently have a manual test written that calls `debug_assert`.

```
#[cfg(test)]
mod tests {
    #[test]
    pub fn test_clap() {
        use clap::CommandFactory;
        super::Bit::command().debug_assert();
    }
}
```

I'd like to, instead, provide a `test` argument to the `#[command]` derive, and have clap generate this test for me:

```
#[derive(Parser, Debug)]
#[command(name = "bit", test)]
pub struct Bit {
```

### Describe the solution you'd like

Please add a `test` argument for the `#[command]` derive that generates a test calling `debug_assert`.

### Alternatives, if applicable

As another alternative, clap could generate this test by default, on the theory that it doesn't do any harm if not building/running tests, and it's likely what the user wants. (In that case, though, there should probably be an option `test = false` just in case the user is doing something strange.)

### Additional Context

_No response_

---

_Label `C-enhancement` added by @joshtriplett on 2023-04-17 04:40_

---

_Label `E-easy` added by @epage on 2023-04-17 14:58_

---

_Label `A-derive` added by @epage on 2023-04-17 14:58_

---

_Comment by @epage on 2023-04-17 15:05_

If we did this automatically, we'd want to do it only for the `Parser` trait as that communicates "top-level".  Anything not-"top-level" is more likely for the user to be doing something strange.

On a first pass, I'd want to treat that as a breaking change though which means it would be delayed to v5.  A `#[command(test)]` would allow access now.

Another alternative is for clap to unconditionally call `debug_assert()` when doing a top-level build.  This would require building the whole tree of commands.  As we want consistent runtime behavior between debug and release and building all could mask things, we'd likely want to do a `clone` and then `debug_assert`.  I would expect the different in runtime performance in debug builds to not be bad enough to be a problem though I might want to ping the deno people as they are currently trying to optimize start up times even further (#4774) and so they are more likely to notice and care about debug performance.

---

_Label `E-easy` removed by @epage on 2023-04-17 15:05_

---

_Label `S-waiting-on-design` added by @epage on 2023-04-17 15:05_

---

_Referenced in [clap-rs/clap#4467](../../clap-rs/clap/issues/4467.md) on 2023-05-08 11:55_

---

_Referenced in [clap-rs/clap#6174](../../clap-rs/clap/issues/6174.md) on 2025-11-03 16:17_

---
