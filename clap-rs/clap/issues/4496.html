<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deriving default fields from Cargo.toml does not work - clap-rs/clap #4496</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Deriving default fields from Cargo.toml does not work</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/4496">#4496</a>
        opened by <a href="https://github.com/laclouis5">@laclouis5</a>
        on 2022-11-21 12:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/laclouis5">@laclouis5</a> on 2022-11-21 12:04</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.65.0 (897e37553 2022-11-02)</p>
<h3>Clap Version</h3>
<p>4.0.26</p>
<h3>Minimal reproducible code</h3>
<p>Theo code is the one from the <a href="https://docs.rs/clap/latest/clap/_derive/_tutorial/index.html#configuring-the-parser">&quot;Configuring the Parser&quot;</a> example, the part about using <code>#[command(author, version, about)]</code> to default attributes from fields in Cargo.toml:</p>
<pre><code class="language-rust">use clap::Parser;

#[derive(Parser)]
#[command(author, version, about, long_about = None)] // Read from `Cargo.toml`
struct Cli {
    #[arg(long)]
    two: String,
    #[arg(long)]
    one: String,
}

fn main() {
    let cli = Cli::parse();

    println!(&quot;two: {:?}&quot;, cli.two);
    println!(&quot;one: {:?}&quot;, cli.one);
}
</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<pre><code>cargo new clapbug
cd clapbug
cargo add clap --features derive
</code></pre>
<p>Add a &quot;about&quot; field to Cargo.toml:</p>
<pre><code class="language-toml">[package]
name = &quot;clapbug&quot;
version = &quot;0.1.0&quot;
edition = &quot;2021&quot;
about = &quot;A simple to use, efficient, and full-featured Command Line Argument Parser&quot;

[dependencies]
clap = { version = &quot;4.0.26&quot;, features = [&quot;derive&quot;] }
</code></pre>
<p>Run:</p>
<pre><code>cargo run -- --help
</code></pre>
<h3>Actual Behaviour</h3>
<p>The about message is not shown. Output:</p>
<pre><code>Usage: clapbug --two &lt;TWO&gt; --one &lt;ONE&gt;

Options:
      --two &lt;TWO&gt;  
      --one &lt;ONE&gt;  
  -h, --help       Print help information
  -V, --version    Print version information
</code></pre>
<h3>Expected Behaviour</h3>
<p>The expected output is the one from the example:</p>
<pre><code>A simple to use, efficient, and full-featured Command Line Argument Parser

Usage: clapbug --two &lt;TWO&gt; --one &lt;ONE&gt;

Options:
      --two &lt;TWO&gt;  
      --one &lt;ONE&gt;  
  -h, --help       Print help information
  -V, --version    Print version information
</code></pre>
<h3>Additional Context</h3>
<p>The compiler outputs a warning <code>warning: unused manifest key: package.about</code>.</p>
<h3>Debug Output</h3>
<pre><code>[      clap::builder::command] 	Command::_do_parse
[      clap::builder::command] 	Command::_build: name=&quot;clapbug&quot;
[      clap::builder::command] 	Command::_propagate:clapbug
[      clap::builder::command] 	Command::_check_help_and_version:clapbug expand_help_tree=false
[      clap::builder::command] 	Command::long_help_exists
[      clap::builder::command] 	Command::_check_help_and_version: Building default --help
[      clap::builder::command] 	Command::_check_help_and_version: Building default --version
[      clap::builder::command] 	Command::_propagate_global_args:clapbug
[clap::builder::debug_asserts] 	Command::_debug_asserts
[clap::builder::debug_asserts] 	Arg::_debug_asserts:two
[clap::builder::debug_asserts] 	Arg::_debug_asserts:one
[clap::builder::debug_asserts] 	Arg::_debug_asserts:help
[clap::builder::debug_asserts] 	Arg::_debug_asserts:version
[clap::builder::debug_asserts] 	Command::_verify_positionals
[        clap::parser::parser] 	Parser::get_matches_with
[        clap::parser::parser] 	Parser::get_matches_with: Begin parsing 'RawOsStr(&quot;--help&quot;)' ([45, 45, 104, 101, 108, 112])
[        clap::parser::parser] 	Parser::possible_subcommand: arg=Ok(&quot;--help&quot;)
[        clap::parser::parser] 	Parser::get_matches_with: sc=None
[        clap::parser::parser] 	Parser::parse_long_arg
[        clap::parser::parser] 	Parser::parse_long_arg: Does it contain '='...
[        clap::parser::parser] 	Parser::parse_long_arg: Found valid arg or flag '--help'
[        clap::parser::parser] 	Parser::parse_long_arg(&quot;help&quot;): Presence validated
[        clap::parser::parser] 	Parser::react action=Help, identifier=Some(Long), source=CommandLine
[        clap::parser::parser] 	Help: use_long=true
[      clap::builder::command] 	Command::long_help_exists: false
[      clap::builder::command] 	Command::write_help_err: clapbug, use_long=false
[      clap::builder::command] 	Command::long_help_exists: false
[          clap::output::help] 	write_help
[ clap::output::help_template] 	HelpTemplate::new cmd=clapbug, use_long=false
[ clap::output::help_template] 	should_show_arg: use_long=false, arg=two
[ clap::output::help_template] 	HelpTemplate::write_templated_help
[ clap::output::help_template] 	HelpTemplate::write_before_help
[         clap::output::usage] 	Usage::create_usage_no_title
[         clap::output::usage] 	Usage::create_help_usage; incl_reqs=true
[         clap::output::usage] 	Usage::needs_options_tag
[         clap::output::usage] 	Usage::needs_options_tag:iter: f=two
[         clap::output::usage] 	Usage::needs_options_tag:iter Option is required
[         clap::output::usage] 	Usage::needs_options_tag:iter: f=one
[         clap::output::usage] 	Usage::needs_options_tag:iter Option is required
[         clap::output::usage] 	Usage::needs_options_tag:iter: f=help
[         clap::output::usage] 	Usage::needs_options_tag:iter Option is built-in
[         clap::output::usage] 	Usage::needs_options_tag:iter: f=version
[         clap::output::usage] 	Usage::needs_options_tag:iter Option is built-in
[         clap::output::usage] 	Usage::needs_options_tag: [OPTIONS] not required
[         clap::output::usage] 	Usage::get_args: incls=[]
[         clap::output::usage] 	Usage::get_args: unrolled_reqs=[&quot;two&quot;, &quot;one&quot;]
[         clap::output::usage] 	Usage::get_args: ret_val=[StyledStr { pieces: [(Some(Literal), &quot;--&quot;), (Some(Literal), &quot;two&quot;), (Some(Placeholder), &quot; &quot;), (Some(Placeholder), &quot;&lt;TWO&gt;&quot;)] }, StyledStr { pieces: [(Some(Literal), &quot;--&quot;), (Some(Literal), &quot;one&quot;), (Some(Placeholder), &quot; &quot;), (Some(Placeholder), &quot;&lt;ONE&gt;&quot;)] }]
[         clap::output::usage] 	Usage::create_help_usage: usage=clapbug --two &lt;TWO&gt; --one &lt;ONE&gt;
[ clap::output::help_template] 	HelpTemplate::write_all_args
[ clap::output::help_template] 	should_show_arg: use_long=false, arg=two
[ clap::output::help_template] 	should_show_arg: use_long=false, arg=one
[ clap::output::help_template] 	should_show_arg: use_long=false, arg=help
[ clap::output::help_template] 	should_show_arg: use_long=false, arg=version
[ clap::output::help_template] 	HelpTemplate::write_args Options
[ clap::output::help_template] 	should_show_arg: use_long=false, arg=two
[ clap::output::help_template] 	HelpTemplate::write_args: arg=&quot;two&quot; longest=11
[ clap::output::help_template] 	should_show_arg: use_long=false, arg=one
[ clap::output::help_template] 	HelpTemplate::write_args: arg=&quot;one&quot; longest=11
[ clap::output::help_template] 	should_show_arg: use_long=false, arg=help
[ clap::output::help_template] 	HelpTemplate::write_args: arg=&quot;help&quot; longest=11
[ clap::output::help_template] 	should_show_arg: use_long=false, arg=version
[ clap::output::help_template] 	HelpTemplate::write_args: arg=&quot;version&quot; longest=11
[ clap::output::help_template] 	should_show_arg: use_long=false, arg=two
[ clap::output::help_template] 	HelpTemplate::spec_vals: a=--two &lt;TWO&gt;
[ clap::output::help_template] 	should_show_arg: use_long=false, arg=one
[ clap::output::help_template] 	HelpTemplate::spec_vals: a=--one &lt;ONE&gt;
[ clap::output::help_template] 	should_show_arg: use_long=false, arg=help
[ clap::output::help_template] 	HelpTemplate::spec_vals: a=--help
[ clap::output::help_template] 	should_show_arg: use_long=false, arg=version
[ clap::output::help_template] 	HelpTemplate::spec_vals: a=--version
[ clap::output::help_template] 	HelpTemplate::spec_vals: a=--two &lt;TWO&gt;
[ clap::output::help_template] 	HelpTemplate::short
[ clap::output::help_template] 	HelpTemplate::long
[ clap::output::help_template] 	HelpTemplate::align_to_about: arg=two, next_line_help=false, longest=11
[ clap::output::help_template] 	HelpTemplate::align_to_about: positional=false arg_len=11, spaces=2
[ clap::output::help_template] 	HelpTemplate::help
[ clap::output::help_template] 	HelpTemplate::help: help_width=19, spaces=0, avail=81
[ clap::output::help_template] 	HelpTemplate::spec_vals: a=--one &lt;ONE&gt;
[ clap::output::help_template] 	HelpTemplate::short
[ clap::output::help_template] 	HelpTemplate::long
[ clap::output::help_template] 	HelpTemplate::align_to_about: arg=one, next_line_help=false, longest=11
[ clap::output::help_template] 	HelpTemplate::align_to_about: positional=false arg_len=11, spaces=2
[ clap::output::help_template] 	HelpTemplate::help
[ clap::output::help_template] 	HelpTemplate::help: help_width=19, spaces=0, avail=81
[ clap::output::help_template] 	HelpTemplate::spec_vals: a=--help
[ clap::output::help_template] 	HelpTemplate::short
[ clap::output::help_template] 	HelpTemplate::long
[ clap::output::help_template] 	HelpTemplate::align_to_about: arg=help, next_line_help=false, longest=11
[ clap::output::help_template] 	HelpTemplate::align_to_about: positional=false arg_len=6, spaces=7
[ clap::output::help_template] 	HelpTemplate::help
[ clap::output::help_template] 	HelpTemplate::help: help_width=19, spaces=22, avail=81
[ clap::output::help_template] 	HelpTemplate::spec_vals: a=--version
[ clap::output::help_template] 	HelpTemplate::short
[ clap::output::help_template] 	HelpTemplate::long
[ clap::output::help_template] 	HelpTemplate::align_to_about: arg=version, next_line_help=false, longest=11
[ clap::output::help_template] 	HelpTemplate::align_to_about: positional=false arg_len=9, spaces=4
[ clap::output::help_template] 	HelpTemplate::help
[ clap::output::help_template] 	HelpTemplate::help: help_width=19, spaces=25, avail=81
[ clap::output::help_template] 	HelpTemplate::write_after_help
[      clap::builder::command] 	Command::color: Color setting...
[      clap::builder::command] 	Auto
[      clap::builder::command] 	Command::color: Color setting...
[      clap::builder::command] 	Auto
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @laclouis5 on 2022-11-21 12:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-11-21 12:36</div>
            <div class="timeline-body"><p>The manifest field that is being read is <code>package.description</code>, see https://doc.rust-lang.org/cargo/reference/manifest.html#the-description-field.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2022-11-21 12:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4776.html">clap-rs/clap#4776</a> on 2023-03-22 04:42</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:34 UTC
    </footer>
</body>
</html>
