<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ability to forward completions in Rust native completions - clap-rs/clap #5653</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Ability to forward completions in Rust native completions</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/clap-rs/clap/issues/5653">#5653</a>
        opened by <a href="https://github.com/epage">@epage</a>
        on 2024-08-10 00:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/epage">@epage</a> on 2024-08-10 00:16</div>
            <div class="timeline-body"><ul>
<li><code>cargo run</code></li>
<li><code>cargo &lt;plugin&gt;</code></li>
</ul>
<p>and likely other cases require completing other commands.</p>
<p>See https://carapace-sh.github.io/carapace-bin/spec/embed.html</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-medium</span> added by @epage on 2024-08-10 00:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-completion</span> added by @epage on 2024-08-10 00:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @epage on 2024-08-10 02:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5706.html">clap-rs/clap#5706</a> on 2024-08-29 09:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/shannmu">@shannmu</a> on 2024-08-29 09:59</div>
            <div class="timeline-body"><p>This feature is undoubtedly a powerful capability. Let me try to explain my understanding of this feature.</p>
<p>For external subcommand completions, we can categorize them into cases that require forward completions and those that do not.</p>
<ul>
<li><p>For cases that do not require forward completions, such as <code>cargo &lt;alias&gt;</code>, this is simple to implement.</p>
</li>
<li><p>For cases that require forward completions, such as <code>mycommand git [TAB]</code>, we need to address the following:</p>
<p>For external subcommand completions, we might need to clarify the type of subcommand. I categorize them into external commands implemented by clap and those not implemented by clap:</p>
<ul>
<li><p><strong>For external commands implemented by clap</strong>: We could potentially save some metadata in a special path, which might allow us to achieve shell-independent completions within clap itself. We might call <code>COMPLETE=&lt;shell&gt; external_subcommand -- xx xx xx xx</code> to obtain completion results.</p>
</li>
<li><p><strong>For external commands not implemented by clap</strong>: Their completions are necessarily shell-specific because we have no knowledge about how to complete them or what their completion scripts are like. We need to construct a new command-line input (excluding argv[0]) and then invoke some shell built-in commands (or write a script) to obtain completion results.</p>
<ul>
<li><p>fish
<code>complete --do-complete=&quot;&lt;command line&gt;&quot;</code> could get the completion of <code>&lt;command line&gt;</code></p>
</li>
<li><p>bash
We could reset <code>COMP_LINE</code>, <code>COMP_WORDS</code>, <code>COMP_POINT</code>, <code>COMP_CWORD</code> to get completions from <code>COMPRELAY</code></p>
</li>
<li><p>There are also some other shells for which I am currently unsure how to implement this feature.</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-medium</span> removed by @epage on 2024-08-29 17:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-hard</span> added by @epage on 2024-08-29 17:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-08-29 17:57</div>
            <div class="timeline-body"><blockquote>
<p>For cases that do not require forward completions, such as cargo <alias>, this is simple to implement.</p>
</blockquote>
<p>I view this as separate from this issue though it would be good to have a way to solve it.</p>
<blockquote>
<p>For external commands implemented by clap:</p>
</blockquote>
<p>imo users and other applications should not be aware an application is using <code>clap</code>.</p>
<blockquote>
<p>For external commands not implemented by clap:</p>
</blockquote>
<p>This is likely what we'll need to do.</p>
<p>I put this as one of the lowest priority items.  I do not believe it is needed for parity with existing <code>clap_complete</code> or for <code>cargo</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/6107.html">clap-rs/clap#6107</a> on 2025-08-19 13:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/6016.html">clap-rs/clap#6016</a> on 2025-11-03 21:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3266.html">clap-rs/clap#3266</a> on 2025-11-03 21:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:35 UTC
    </footer>
</body>
</html>
