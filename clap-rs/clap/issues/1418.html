<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[feature request] derive for enums from outside of clap lib - clap-rs/clap #1418</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[feature request] derive for enums from outside of clap lib</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/1418">#1418</a>
        opened by <a href="https://github.com/xoac">@xoac</a>
        on 2019-02-19 15:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/xoac">@xoac</a> on 2019-02-19 15:13</div>
            <div class="timeline-body"><p>It would be great to allow people to not include <code>clap</code> in library but still easy allow use that enums in CLI (binary) without execs of code. I think the current solution is quite good. But in my opinion it would be better instead of using <code>args_enum!</code> show that u can use for example <a href="https://crates.io/crates/strum">strum</a> to derive <code>FromStr</code>, <code>Display</code> and <code>Iterator</code> over that enum, and easy use it with clap. Rust love code reusing. This could be done for 0.3 as it could require some breaking changes.</p>
<p>The current strum version compile and work with clap but I wrote some extra code to make it work.</p>
<p>Example:</p>
<pre><code class="language-rust">#[derive(Debug, ParialEq, Clone, Hash, Deserialize, Serialize)]
#[derive(Display, EnumString, EnumIter)] //to work with clap
#[serde(rename_all = &quot;lowercase&quot;)]
pub enum Gain {
    X1,
    X2,
    X4,
    X8,
    X16,
}    

// the extra code that is ugly!
let possible_values = Gain::iter()
          .map(|item| item.to_string())
          .collect::&lt;Vec&lt;_&gt;&gt;();

let possible_values_ref = possible_values
          .iter()
          .map(|st| st.as_ref())
          .collect::&lt;Vec&lt;_&gt;&gt;();


let gain_subcmd = SubCommand::with_name(&quot;gain&quot;)
                .about(&quot;Set gain for module&quot;)
                .arg(
                    Arg::with_name(&quot;current&quot;)
                        .long(&quot;current&quot;)
                        .takes_value(true)
                        .number_of_values(1)
                        .possible_values(&amp;possible_values_ref)
                        .case_insensitive(true)
                );
</code></pre>
<p>What do u guys think to:</p>
<ul>
<li>add this to example for possible usecase?</li>
<li>add additional information to doc -- that u don't need to use <code>arg_enum!</code> if u don't like.</li>
<li>do this as default behavior for 0.3.x</li>
</ul>
<p>Of course this is only idea. It doesn't need to be <code>strum</code> and if it may require some PR to clap or stum for example <code>possible_values()</code> can accept iterator instead of slice or strum should generate slice of possible string.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "derive for enums from outside of clap lib" to "[feature request] derive for enums from outside of clap lib" by @xoac on 2019-02-20 11:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lpil">@lpil</a> on 2019-10-07 19:12</div>
            <div class="timeline-body"><p>strum seems to now have a <code>EnumVariantNames</code> for this situation</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">clap-derive-related</span> added by @CreepySkeleton on 2020-02-01 15:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: derive macros</span> added by @pksunkara on 2020-02-03 09:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">clap-derive-related</span> removed by @pksunkara on 2020-02-03 09:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @pksunkara on 2020-04-12 20:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: arg enums</span> added by @pksunkara on 2020-04-12 20:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-22 08:34</div>
            <div class="timeline-body"><p>Unfortunately, this is not enough. The <code>from_str</code> needs to also care about <code>case_insensitive</code> which is not supported by strum. You can see the linked PR for the trait's function signatures.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @bors[bot] on 2020-04-22 18:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/xoac">@xoac</a> on 2020-04-23 02:18</div>
            <div class="timeline-body"><p>@pksunkara
The idea was just to use separate crate (not exactly strum) that just works with string and enums. The case_insensitive feature could be added to that external crate if author would like to cooperate. But it looks like more complicated task (for example there is also need support for aliases).</p>
<p>For example <a href="https://github.com/Peternator7/strum/wiki/Derive-EnumString">EnumString</a> do some magic with <code>Default::default()</code>.</p>
<p>Probably the best option for now is use <code>From</code>  <code>Into</code> traits and just copy fields for outside enum.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:07 UTC
    </footer>
</body>
</html>
