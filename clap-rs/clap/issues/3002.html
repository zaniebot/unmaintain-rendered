<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ability to apply a setting to all args - clap-rs/clap #3002</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ability to apply a setting to all args</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/3002">#3002</a>
        opened by <a href="https://github.com/epage">@epage</a>
        on 2021-11-08 14:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/epage">@epage</a> on 2021-11-08 14:14</div>
            <div class="timeline-body"><h3>Use Cases</h3>
<ul>
<li>&quot;in our application tests [we need] to set an argument setting on all arguments programmatically just in the test context, and we had a lot of arguments so safest, cleanest, and easiest, to be able to set it with this new function.  Essentially: <code>app.mut_args(|arg| Some(arg.setting(ArgSettings::HideEnvValues)))</code>&quot;.  See #2966</li>
<li><a href="https://docs.rs/clap/3.0.0-beta.5/clap/enum.AppSettings.html#variant.AllArgsOverrideSelf"><code>AppSettings::AllArgsOverrideSelf</code></a> is arg configuration that we want to apply everywhere.  Rather than creating specialized arguments, is there a different way?</li>
<li>One option for sorting arguments in help after https://github.com/clap-rs/clap/issues/2808 is to set the same display order on all arguments</li>
<li><a href="https://docs.rs/clap/3.0.0-beta.5/clap/struct.App.html#method.help_heading"><code>App::help_heading</code></a> allows applying <code>Arg:help_heading</code> to all future arguments to take advantage of the natural grouping of arguments when adding them.</li>
</ul>
<p>Note: in some cases, users will want this to apply globally (ie to all subcommand args)</p>
<h3>Solution Options</h3>
<p><em>Note: this isn't a &quot;pick one&quot; but we can use a mixture</em></p>
<ul>
<li>Specialize <code>Arg</code> settings in <code>App</code> (ie <strong>do nothing</strong>), like<ul>
<li><code>AppSettings::AllArgsOverrideSelf</code></li>
<li><code>App::help_heading</code></li>
<li>A <code>App::next_display_order</code> for #2808</li>
<li><strong>Con::</strong> design / implementation is needed for each solution</li>
<li><strong>Con:</strong> each solution ends up different than the others</li>
</ul>
</li>
<li>Direct users to use reflection + <code>mut_arg</code> to manually apply a setting (ie <strong>do nothing</strong>, see #2976)<ul>
<li>This ended up being what we used instead of #2966 which led to it being reverted in #2994</li>
<li><strong>Con:</strong> Not ergonomic for <code>clap_derive</code> users (instead of calling <code>Parser</code>, they have to call <code>IntoApp</code> and <code>FromArgMarches</code>)</li>
</ul>
</li>
<li>Provide a <code>App:args_mut(&amp;mut self) -&gt; impl Iterator&lt;Item = &amp;mut Arg&gt;</code>.<ul>
<li><strong>Con:</strong> Not ergonomic for <code>clap_derive</code> users (instead of calling <code>Parser</code>, they have to call <code>IntoApp</code> and <code>FromArgMarches</code>)</li>
</ul>
</li>
<li>Provide a <code>App::arg_setting</code><ul>
<li><strong>Con:</strong> Only works with <code>ArgSettings</code>, so doesn't help with <code>AppSettings::AllArgsOverrideSelf</code> or <code>display_order</code></li>
<li><strong>Con:</strong> We are deprecating settings (#2717)</li>
</ul>
</li>
<li><code>mut_args</code>, modeled after <code>mut_arg</code> (see #2966, #2994)<ul>
<li><strong>Con:</strong> The return type is confusing (should it be just <code>bool</code>?)</li>
<li><strong>Con:</strong> Policy of when to return what is unclear</li>
</ul>
</li>
<li>Like <code>mut_args</code> above but <code>Fn</code> doesn't have a return type<ul>
<li><code>mut_arg</code> assumes you are calling it on an arg you intend to keep, so an implicit <code>--version</code> becomes explicit, making it show up when you might have disabled it</li>
<li>#2966 carried this policy forward but provided a return value to avoid adding disabled args</li>
<li>This solution assumes that mass-setting an argument is argument-agnostic and it does not imply the intention of using that argument, so it keeps <code>--version</code> implicit</li>
</ul>
</li>
<li><code>App::default_arg(arg: Arg)</code> or <code>App::mut_default_arg</code> is layered underneath each arg<ul>
<li>We'd have to implement support for tracking what arguments are explicitly set or not to know what is set in the &quot;default arg&quot; and what not to override in each arg</li>
<li>Not all settings should be layered (like <code>alias</code> or <code>long</code>)</li>
</ul>
</li>
<li><code>App::override_arg(arg: Arg)</code> or <code>App::mut_override_arg</code> is layered on top of each arg<ul>
<li>We'd have to implement support for tracking what arguments are explicitly set or not to know what is set in the &quot;override arg&quot;</li>
<li>Not all settings should be layered (like <code>alias</code> or <code>long</code>)</li>
</ul>
</li>
</ul>
<p>For when to apply these to subcommands, we could</p>
<ul>
<li>Have a <code>global_</code> variant of any function, like today's ``global_settings`</li>
<li>Accept a <code>global: bool</code> or <code>scope: enum Scope { Local, Inherit }</code> argument in any function</li>
<li>Layer Subcommands on top of their immediate parent App (see also https://github.com/clap-rs/clap/issues/2717)<ul>
<li>Like with default and override args, this will require tracking what configuration is explicitly set</li>
<li>Not all settings should be layered, like <code>alias</code> (used for subcommands)</li>
</ul>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by @epage on 2021-11-08 14:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: args</span> added by @epage on 2021-11-08 14:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: app</span> added by @epage on 2021-11-08 14:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: derive macros</span> added by @epage on 2021-11-08 14:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-11-08 14:15</div>
            <div class="timeline-body"><p>@repi in case you have any further thoughts on this topic</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/234.html">epage/clapng#234</a> on 2021-12-06 22:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: args</span> removed by @epage on 2021-12-08 20:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> removed by @epage on 2021-12-08 21:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @epage on 2021-12-08 21:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-decision</span> added by @epage on 2021-12-13 22:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../aobatact/clap-serde/issues/25.html">aobatact/clap-serde#25</a> on 2022-01-31 11:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2022-02-12 09:04</div>
            <div class="timeline-body"><blockquote>
<p>Only works with ArgSettings, so doesn't help with AppSettings::AllArgsOverrideSelf or display_order</p>
</blockquote>
<p>Hmm.. it would work if we make an <code>ArgSetting::ArgOverrideSelf</code> and then <code>AllArgsOverrideSelf</code> is basically setting that on all args in the app.</p>
<p>I am not sure what the scenario with display_order is though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-02-14 14:06</div>
            <div class="timeline-body"><blockquote>
<p>Hmm.. it would work if we make an ArgSetting::ArgOverrideSelf and then AllArgsOverrideSelf is basically setting that on all args in the app.</p>
</blockquote>
<p>I keep going back and forth on whether that should be the default behavior.</p>
<blockquote>
<p>I am not sure what the scenario with display_order is though.</p>
</blockquote>
<p>From the use cases:</p>
<blockquote>
<p>One option for sorting arguments in help after https://github.com/clap-rs/clap/issues/2808 is to set the same display order on all arguments</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5051.html">clap-rs/clap#5051</a> on 2023-08-01 00:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2023-08-01 00:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:08 UTC
    </footer>
</body>
</html>
