<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triage Structopt PRs since the fork - clap-rs/clap #2809</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Triage Structopt PRs since the fork</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/2809">#2809</a>
        opened by <a href="https://github.com/epage">@epage</a>
        on 2021-10-04 19:17
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/epage">@epage</a> on 2021-10-04 19:17</div>
            <div class="timeline-body"><h3>Discussed in https://github.com/clap-rs/clap/discussions/2658</h3>
<div type='discussions-op-text'>

<p><sup>Originally posted by <strong>epage</strong> August  2, 2021</sup>
Dependabot notified me of a structopt update that included https://github.com/TeXitoi/structopt/pull/483.  This seems relevant for clap but made me wonder about the problem generally.</p>
<p>When was our last sync-up with structopt and how do we track it so things don't fall through the cracks for future changes?</div></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @epage on 2021-10-04 19:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: enhancement</span> added by @epage on 2021-10-04 19:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: medium</span> added by @epage on 2021-10-04 19:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: derive macros</span> added by @epage on 2021-10-04 19:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @epage on 2021-10-04 19:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-10-04 20:56</div>
            <div class="timeline-body"><p>ea76fa1b1b273e65e3b0b1046643715b49bec51f is the last commit in  https://github.com/clap-rs/clap_derive/commits/master?after=acea444f962a0d7c8126273739d4df8bdb152624+34&amp;branch=master from purely structopt.  It looks like some fixes went in since then but unsure which</p>
<p>Post fork, already ported</p>
<ul>
<li>[x] https://github.com/TeXitoi/structopt/pull/143</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/148</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/146</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/154</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/158</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/161</li>
<li>[x] https://github.com/TeXitoi/structopt/commit/3d5f9bd063613dde84528624f7192c9eefb6ae21</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/169</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/186</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/190</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/191</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/192</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/193</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/194</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/195</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/204</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/198</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/216</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/213</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/218</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/221</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/225</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/231</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/234</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/236</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/239</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/244</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/246</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/248</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/250</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/252</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/260</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/271</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/275</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/279</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/278</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/282</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/284</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/281</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/287</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/290</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/293</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/302</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/296</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/313</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/312</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/325</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/334</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/314</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/334</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/346</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/342</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/381</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/399</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/400</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/401</li>
</ul>
<p>Start of new port series</p>
<ul>
<li>[x] https://github.com/TeXitoi/structopt/pull/414, see #2821</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/412, see https://github.com/clap-rs/clap/pull/2822</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/440, re-implemented in https://github.com/clap-rs/clap/pull/1992</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/448, see https://github.com/clap-rs/clap/pull/2823</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/450, https://github.com/clap-rs/clap/pull/2824</li>
<li>[ ] https://github.com/TeXitoi/structopt/pull/483, split out into https://github.com/clap-rs/clap/issues/2769</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/491, see https://github.com/clap-rs/clap/pull/2825</li>
<li>[x] https://github.com/TeXitoi/structopt/pull/494, see https://github.com/clap-rs/clap/pull/2826</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-10-04 20:58</div>
            <div class="timeline-body"><p>@pksunkara and @CreepySkeleton since you two were involved a lot during the late stages of <code>clap_derive</code>, <strong>if</strong> its quick to do a scan to see what is already ported to <code>clap_derive</code>, that'd be appreciated.  If not, I'm fully willing to take on doing this deep dive.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-10-05 21:33</div>
            <div class="timeline-body"><p>Looks like I found the point of divergence.  We have everything up to 401 and need 414 and after</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2821.html">clap-rs/clap#2821</a> on 2021-10-06 17:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2822.html">clap-rs/clap#2822</a> on 2021-10-06 17:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2823.html">clap-rs/clap#2823</a> on 2021-10-06 18:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2824.html">clap-rs/clap#2824</a> on 2021-10-06 18:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2825.html">clap-rs/clap#2825</a> on 2021-10-06 18:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2826.html">clap-rs/clap#2826</a> on 2021-10-06 18:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-10-09 02:24</div>
            <div class="timeline-body"><ul>
<li>[ ] No coverage for <a href="https://github.com/TeXitoi/structopt/pull/401/files#diff-57e8e1f836204e3d43fdd26c8c05d8aa25edc6db8c921f99f5d482c3f56e05a9R134">test</a></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2769.html">clap-rs/clap#2769</a> on 2021-10-11 19:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-10-11 19:28</div>
            <div class="timeline-body"><blockquote>
<pre><code>* [ ]  No coverage for [test](https://github.com/TeXitoi/structopt/pull/401/files#diff-57e8e1f836204e3d43fdd26c8c05d8aa25edc6db8c921f99f5d482c3f56e05a9R134)</code></pre>
</blockquote>
<p>I'm not even sure what that is trying to test; I forgot what structopt does when <code>flatten</code>ing in that context.</p>
<p>As for <code>clap_derive</code>, we don't even allow an <code>enum</code> to <code>flatten</code> a <code>struct</code>, its a compiler error due to mismatched types.  Of the various combinations of bad <code>flatten</code> and <code>subcommand</code>, it looks like the only one we cover is</p>
<pre><code class="language-rust">#[derive(clap::Parser)]
struct Opt {
    #[clap(flatten)]
    sub: SubCmd,
}

#[derive(clap::Parser)]
enum SubCmd {}

fn main() {}
</code></pre>
<p>I'm mixed on the value of expanding out the rest of the combinations but either way, don't think it would block 3.0.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-10-11 19:29</div>
            <div class="timeline-body"><p>I'm delegating the generics work to https://github.com/clap-rs/clap/issues/2769 which means we are done or practically done with this.  Rather than this lingering on for each new issue, I'm going to go ahead and close it.  We can create new issues for each additional structopt porting effort and prioritize accordingly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2021-10-11 19:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-10-11 20:33</div>
            <div class="timeline-body"><blockquote>
<p>As for clap_derive, we don't even allow an enum to flatten a struct, its a compiler error due to mismatched types.</p>
</blockquote>
<p>Yeah, we need an UI test for that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2850.html">clap-rs/clap#2850</a> on 2021-10-11 20:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:33 UTC
    </footer>
</body>
</html>
