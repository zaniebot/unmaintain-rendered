<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>suboptimal flag suggestion - clap-rs/clap #1073</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>suboptimal flag suggestion</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1073">#1073</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2017-10-21 22:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a></div>
            <div class="timeline-body">

Rust Version
<p><code>rustc 1.17.0 (56124baa9 2017-04-24)</code></p>
Affected Version of clap
<p><code>2.26.2</code></p>
Expected Behavior Summary
<p>CLI error message suggests <code>--files-without-match</code></p>
Actual Behavior Summary
<p>CLI error message suggests <code>--files-with-matches</code></p>
Steps to Reproduce the issue
<pre><code>$ cargo new ripgrep-616 --bin
$ $EDITOR Cargo.toml
... add `clap` to dependencies
$ cat &gt; src/main.rs &lt;&lt;EOF
extern crate clap;

use clap::{App, Arg};

fn main() {
    let app = App::new(&quot;ripgrep-616&quot;)
        .arg(Arg::with_name(&quot;files-with-matches&quot;).long(&quot;files-with-matches&quot;))
        .arg(Arg::with_name(&quot;files-without-match&quot;).long(&quot;files-without-match&quot;));
    app.get_matches();
}
EOF
$ cargo run -- --files-without-matches
    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs
     Running `target/debug/ripgrep-616 --files-without-matches`
error: Found argument &#x27;--files-without-matches&#x27; which wasn&#x27;t expected, or isn&#x27;t valid in this context
        Did you mean --files-with-matches?

USAGE:
    ripgrep-616 --files-with-matches

For more information try --help
</code></pre>
Sample Code or Link to Sample Code
<p>See above.</p>
Debug output
<pre><code>cargo run -- --files-without-matches
   Compiling clap v2.26.2
   Compiling ripgrep-616 v0.1.0 (file:///tmp/ripgrep-616)
    Finished dev [unoptimized + debuginfo] target(s) in 16.63 secs
     Running `target/debug/ripgrep-616 --files-without-matches`
DEBUG:clap:Parser::propogate_settings: self=ripgrep-616, g_settings=AppFlags(
    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:Parser::get_matches_with: Begin parsing &#x27;&quot;--files-without-matches&quot;&#x27; ([45, 45, 102, 105, 108, 101, 115, 45, 119, 105, 116, 104, 111, 117, 116, 45, 109, 97, 116, 99, 104, 101, 115])
DEBUG:clap:Parser::is_new_arg: arg=&quot;--files-without-matches&quot;, Needs Val of=NotFound
DEBUG:clap:Parser::is_new_arg: Arg::allow_leading_hyphen(false)
DEBUG:clap:Parser::is_new_arg: -- found
DEBUG:clap:Parser::is_new_arg: starts_new_arg=true
DEBUG:clap:Parser::possible_subcommand: arg=&quot;--files-without-matches&quot;
DEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None
DEBUG:clap:Parser::parse_long_arg;
DEBUG:clap:Parser::parse_long_arg: Does it contain &#x27;=&#x27;...No
DEBUG:clap:Parser::parse_long_arg: Didn&#x27;t match anything
DEBUG:clap:Parser::groups_for_arg: name=files-with-matches
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:usage::create_usage_with_title;
DEBUG:clap:usage::create_usage_no_title;
DEBUG:clap:usage::smart_usage;
DEBUG:clap:usage::get_required_usage_from: reqs=[&quot;files-with-matches&quot;], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=[&quot;files-with-matches&quot;]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:usage::get_required_usage_from:iter:files-with-matches:
DEBUG:clap:Parser::color;
DEBUG:clap:Parser::color: Color setting...Auto
DEBUG:clap:is_a_tty: stderr=true
DEBUG:clap:Colorizer::error;
DEBUG:clap:Colorizer::warning;
DEBUG:clap:Colorizer::good;
error: Found argument &#x27;--files-without-matches&#x27; which wasn&#x27;t expected, or isn&#x27;t valid in this context
        Did you mean --files-with-matches?

USAGE:
    ripgrep-616 --files-with-matches

For more information try --help
</code></pre>
Other
<p>This bug was reported to ripgrep: <a href="https://github.com/BurntSushi/ripgrep/issues/616">BurntSushi/ripgrep#616</a></p>
<p>Note that I don&#x27;t <em>necessarily</em> think this can or should be fixed. In particular, these sorts of algorithms often involve heuristics, and making one case better may make other cases worse. Regardless, I wanted to shuffle this off to you in case there was something here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>BurntSushi/ripgrep#616</a> on 2017-10-21 22:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-10-22 00:31</div>
            <div class="timeline-body"><p>Thanks for pinging me and taking the time to file this! I&#x27;ve been swamped lately and haven&#x27;t viewed my notifications in quite some time :smile:</p>
<p>I&#x27;m <em>pretty sure</em> this is due to the heuristics used in <a href="https://github.com/dguo/strsim-rs"><code>strsim</code></a> which is actually quite tweakable. I&#x27;m currently using a <a href="https://github.com/kbknapp/clap-rs/blob/569ced1f3d7036c3d6b3090a77e64161bfe1a01c/src/suggestions.rs#L22-L26">moderately arbitrary configuration</a>, so it almost certainly can be improved. It&#x27;s also code from two years ago (according to <code>git blame</code>), and <code>strsim</code> has changed and added features since then.</p>
<p>In this particular case if we discounted all matching characters in sequence, and only &quot;compared&quot; the remainder I&#x27;m sure it&#x27;d be more accurate. But I don&#x27;t know if that would change other cases without a bit of testing.</p>
<p>So I&#x27;ll leave this open in case someone wants to take a stab at it. Although, with the issues I&#x27;ve got in the backlog it&#x27;ll be a low priority issue for me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: intermediate</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-10-22 00:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-10-22 00:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">M: mentored</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-10-22 00:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-10-22 00:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: enhancement</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-10-22 00:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-10-22 00:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-07-22 02:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> removed by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-07-22 02:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;3.0&quot; by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-09 07:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-09 07:13</div>
            <div class="timeline-body"><p>@pickfire Since you worked on <a href="https://github.com/clap-rs/clap/pull/1710">clap-rs/clap#1710</a>, do you think you can make a PR for this after testing that this is still an issue?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-04-11 11:55</div>
            <div class="timeline-body"><p>@pksunkara Thanks for pinging me on this old issue, I am surprised you still remembered it. I will check and add it to the tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-04-11 15:23</div>
            <div class="timeline-body"><p>@pksunkara No, that PR does not affect this. The output is still the same, probably.</p>
<pre><code>    Finished dev [unoptimized + debuginfo] target(s) in 0.04s
     Running `target/debug/clap --files-without-matches`
error: Found argument &#x27;--files-without-matches&#x27; which wasn&#x27;t expected, or isn&#x27;t valid in this context
        Did you mean --files-without-match?
If you tried to supply `--files-without-matches` as a PATTERN use `-- --files-without-matches`

USAGE:
    clap --files-without-match

For more information try --help
</code></pre>
<p>But yes, the issue @BurntSushi is fixed. It recommends <code>--files-without-match</code> now. Should I still write a test for this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-11 15:43</div>
            <div class="timeline-body"><p>Yes, please add a test. If you see <a href="https://github.com/clap-rs/clap/blob/5d2876163028b71c5b170d290c730bf472de7b97/tests/opts.rs#L6">here</a>, the current test works with only 1 option.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#1814</a> on 2020-04-12 15:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/bors[bot]">@bors[bot]</a> on 2020-04-12 16:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/bors[bot]">@bors[bot]</a> on 2020-04-12 16:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:57:00 UTC
    </footer>
</body>
</html>
