<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Derive does not automatically capture multiple parameters - clap-rs/clap #3248</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Derive does not automatically capture multiple parameters</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/3248">#3248</a>
        opened by <a href="https://github.com/chrisduerr">@chrisduerr</a>
        on 2022-01-03 19:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/chrisduerr">@chrisduerr</a> on 2022-01-03 19:05</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
<h3>Clap Version</h3>
<p>3</p>
<h3>Describe your use case</h3>
<p>With structopt when defining a type as a <code>Vec&lt;T&gt;</code>, it would automatically capture multiple values. Generally I'd say this makes sense because rarely would one want to specify an array differently on the command line. However the new clap derive does not do this, which I'd assume might also cause some regressions for people migrating that aren't careful about their CLI.</p>
<p>While it is currently possible to just specify <code>multiple_values = true</code>, it seems unnecessary.</p>
<h3>Describe the solution you'd like</h3>
<p>A field annotated with <code>#[clap(...)]</code> of the type <code>Vec&lt;T&gt;</code> for automatic derive should imply <code>multiple_values = true</code>.</p>
<h3>Alternatives, if applicable</h3>
<p><em>No response</em></p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @chrisduerr on 2022-01-03 19:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chrisduerr">@chrisduerr</a> on 2022-01-03 19:12</div>
            <div class="timeline-body"><p>Looking at what seems to be the relevant code (https://github.com/clap-rs/clap/blob/master/clap_derive/src/derives/args.rs#L311-L320), it might be intentional that a vec only implies <code>multiple_occurences</code>, not necessarily <code>multiple_values</code>?</p>
<p>I'd still really like to see this because I think only having <code>multiple_occurences</code> mostly makes sense for flags, but for a <code>Vec&lt;T&gt;</code> which actually takes a string as an argument it should pretty much always be convenient to the user to not have to specify <code>--option</code> again just to pass another thing when <code>--option x y z</code> would come at probably no disadvantage?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../alacritty/alacritty/pulls/5744.html">alacritty/alacritty#5744</a> on 2022-01-03 22:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-01-04 00:38</div>
            <div class="timeline-body"><p>It was intentional that we deviated from structopt.   See https://github.com/clap-rs/clap/issues/1772</p>
<p>Most applications either take</p>
<ul>
<li>Multiple occurrences (<code>cargo build --package foo --package bar</code>)</li>
<li>Multiple delimited values (<code>cargo build --features &quot;derive wrap_help&quot;</code>)</li>
<li>Or both (<code>cargo build --features &quot;derive wrap_help&quot; --features suggestions</code>)</li>
</ul>
<p>Making multiple occurrences by default</p>
<ul>
<li>Is a solid base to then build up other behavior (usually if you do delimited values, you also do multiple occurrences)</li>
<li>Is less surprising since it is what most developers are expecting (personal anecdote: I wrote many applications with <code>Vec</code> in structopt thinking I was getting multiple occurrences only but I was also getting multiple values)</li>
<li>Has fewer gotchas (see <a href="https://docs.rs/clap/latest/clap/struct.Arg.html#method.multiple_values">Arg::multiple_values</a>)</li>
</ul>
<p>For the cases when users want the older / structopt experience, they can still easily get it by opting in with <code>multiple_values(true)</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2022-01-04 00:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-01-04 00:51</div>
            <div class="timeline-body"><p>btw this was called out in the breaking changes from structopt: https://github.com/clap-rs/clap/blob/master/CHANGELOG.md#breaking-changes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chrisduerr">@chrisduerr</a> on 2022-01-04 02:20</div>
            <div class="timeline-body"><p>I can't say I agree with that choice, but I suppose <code>multiple_values</code> can still be specified manually.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-derive</span> added by @epage on 2022-01-11 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-wont-fix</span> added by @epage on 2022-01-11 18:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3283.html">clap-rs/clap#3283</a> on 2022-01-11 22:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tdudz">@tdudz</a> on 2022-01-11 22:45</div>
            <div class="timeline-body"><p>@chrisduerr is there a way i can use derive to get clap v3 to capture multiple values?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chrisduerr">@chrisduerr</a> on 2022-01-11 23:41</div>
            <div class="timeline-body"><p>I'm a bit confused because this issue has multiple comments outlining how to do this already.</p>
<p>But just to make it 100% clear: https://github.com/alacritty/alacritty/blob/master/alacritty/src/cli.rs#L61</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-01-12 00:20</div>
            <div class="timeline-body"><p>You can also look at our tests for ideas of what can be done
https://github.com/clap-rs/clap/blob/master/tests/derive/options.rs#L297</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:34:50 UTC
    </footer>
</body>
</html>
