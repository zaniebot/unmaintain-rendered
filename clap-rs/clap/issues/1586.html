<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>requires_all ArgGroup with a default, causes the entire ArgGroup to be required - clap-rs/clap #1586</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>requires_all ArgGroup with a default, causes the entire ArgGroup to be required</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1586">#1586</a>
        opened by <a href="https://github.com/leeola">@leeola</a>
        on 2019-10-26 21:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/leeola">@leeola</a></div>
            <div class="timeline-body">

Rust Version
<p>rustc 1.40.0-nightly (10a52c25c 2019-10-24)</p>
Affected Version of clap
<p>clap 2.33.0</p>
Expected Behavior Summary
<ol>
<li>Using <code>ArgGroup</code> to make 3 flags required to use together, if at all. Eg, <code>--foo</code> and <code>--bar</code> are optional, but if specified at all <code>--foo</code> and <code>--bar</code> must both have a value.</li>
<li>Additionally, <code>--baz</code> has a default value, in the same group of <code>--foo</code> and <code>--bar</code>.</li>
</ol>
Actual Behavior Summary
<p>The default value of <code>--baz</code> seems to make the <code>ArgGroup</code> behave as if the user is always attempting to use it. Such that the <code>ArgGroup</code> becomes required. Example:</p>
<pre><code>&gt; cargo run
    Finished dev [unoptimized + debuginfo] target(s) in 0.01s
     Running `target/debug/test-clap-arggroup`
error: The following required arguments were not provided:

USAGE:
    test-clap-arggroup &lt;--foo &lt;FOO&gt;|--bar &lt;BAR&gt;&gt;

For more information try --help
</code></pre>
Steps to Reproduce the issue
<p>Run the sample code, with no flags specified.</p>
Sample Code or Link to Sample Code
<pre><code>/// A bug report test binary
use clap::*;

fn main() {
  let _matches = App::new(&quot;bin&quot;)
    .arg(
      Arg::with_name(&quot;foo&quot;)
        .required(false)
        .long(&quot;foo&quot;)
        .value_name(&quot;FOO&quot;)
        .takes_value(true),
    )
    .arg(
      Arg::with_name(&quot;bar&quot;)
        .required(false)
        .long(&quot;bar&quot;)
        .value_name(&quot;BAR&quot;)
        .takes_value(true),
    )
    .arg(
      Arg::with_name(&quot;baz&quot;)
        .required(false)
        .long(&quot;baz&quot;)
        .value_name(&quot;BAZ&quot;)
        .default_value(&quot;default value&quot;)
        .takes_value(true),
    )
    .group(
      ArgGroup::with_name(&quot;test_flags&quot;)
        .multiple(true)
        .args(&amp;[&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;])
        .requires_all(&amp;[&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;]),
    )
    .get_matches();
}
</code></pre>
Debug output

 Debug Output 
<pre>
<code>

<pre><code>Finished dev [unoptimized + debuginfo] target(s) in 0.01s
 Running `target/debug/test-clap-arggroup`</code></pre>
<p>DEBUG:clap:Parser::propagate_settings: self=bin, g_settings=AppFlags(
(empty),
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:ArgMatcher::process_arg_overrides:None;
DEBUG:clap:Parser::remove_overrides:[];
DEBUG:clap:Validator::validate;
DEBUG:clap:Parser::add_defaults;
DEBUG:clap:Parser::add_defaults:iter:foo: doesn&#x27;t have conditional defaults
DEBUG:clap:Parser::add_defaults:iter:foo: doesn&#x27;t have default vals
DEBUG:clap:Parser::add_defaults:iter:bar: doesn&#x27;t have conditional defaults
DEBUG:clap:Parser::add_defaults:iter:bar: doesn&#x27;t have default vals
DEBUG:clap:Parser::add_defaults:iter:baz: doesn&#x27;t have conditional defaults
DEBUG:clap:Parser::add_defaults:iter:baz: has default vals
DEBUG:clap:Parser::add_defaults:iter:baz: wasn&#x27;t used
DEBUG:clap:Parser::add_val_to_arg; arg=baz, val=&quot;default value&quot;
DEBUG:clap:Parser::add_val_to_arg; trailing_vals=false, DontDelimTrailingVals=false
DEBUG:clap:Parser::add_single_val_to_arg;
DEBUG:clap:Parser::add_single_val_to_arg: adding val...&quot;default value&quot;
DEBUG:clap:Parser::groups_for_arg: name=baz
DEBUG:clap:Parser::groups_for_arg: Searching through groups...
Found &#x27;test_flags&#x27;
DEBUG:clap:ArgMatcher::needs_more_vals: o=baz
DEBUG:clap:Validator::validate_blacklist;
DEBUG:clap:Validator::validate_blacklist:iter:baz;
DEBUG:clap:Parser::groups_for_arg: name=baz
DEBUG:clap:Parser::groups_for_arg: Searching through groups...
Found &#x27;test_flags&#x27;
DEBUG:clap:Validator::validate_blacklist:iter:test_flags;
DEBUG:clap:Parser::groups_for_arg: name=test_flags
DEBUG:clap:Parser::groups_for_arg: Searching through groups...
DEBUG:clap:Validator::validate_blacklist:iter:test_flags:group;
DEBUG:clap:Validator::validate_blacklist:iter:test_flags:group:iter:foo;
DEBUG:clap:Validator::validate_blacklist:iter:test_flags:group:iter:bar;
DEBUG:clap:Validator::validate_blacklist:iter:test_flags:group:iter:baz;
DEBUG:clap:Validator::validate_required: required=[];
DEBUG:clap:Validator::validate_matched_args;
DEBUG:clap:Validator::validate_matched_args:iter:baz: vals=[
&quot;default value&quot;,
]
DEBUG:clap:Validator::validate_arg_num_vals:baz
DEBUG:clap:Validator::validate_arg_values: arg=&quot;baz&quot;
DEBUG:clap:Validator::validate_arg_requires:baz;
DEBUG:clap:Validator::validate_arg_num_occurs: a=baz;
DEBUG:clap:Validator::validate_matched_args:iter:test_flags: vals=[
&quot;default value&quot;,
]
DEBUG:clap:Validator::missing_required_error: extra=None
DEBUG:clap:Parser::color;
DEBUG:clap:Parser::color: Color setting...Auto
DEBUG:clap:is_a_tty: stderr=true
DEBUG:clap:Validator::missing_required_error: reqs=[]
DEBUG:clap:usage::get_required_usage_from: reqs=[], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:Validator::missing_required_error: req_args=&quot;&quot;
DEBUG:clap:usage::create_usage_with_title;
DEBUG:clap:usage::create_usage_no_title;
DEBUG:clap:usage::smart_usage;
DEBUG:clap:usage::get_required_usage_from: reqs=[&quot;baz&quot;, &quot;test_flags&quot;], extra=None
DEBUG:clap:usage::get_required_usage_from:iter:test_flags: adding group req=&quot;foo&quot;
DEBUG:clap:usage::get_required_usage_from:iter:test_flags: adding group req=&quot;bar&quot;
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[&quot;foo&quot;, &quot;bar&quot;]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=[&quot;bar&quot;, &quot;baz&quot;, &quot;foo&quot;, &quot;test_flags&quot;]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;]
DEBUG:clap:OptBuilder::fmt:foo
DEBUG:clap:OptBuilder::fmt:bar
DEBUG:clap:OptBuilder::fmt:baz
DEBUG:clap:Parser::color;
DEBUG:clap:Parser::color: Color setting...Auto
DEBUG:clap:is_a_tty: stderr=true
DEBUG:clap:Colorizer::error;
DEBUG:clap:Colorizer::good;
error: The following required arguments were not provided:</p>
<p>USAGE:
test-clap-arggroup &lt;--foo |--bar |--baz &gt;</p>
<p>For more information try --help</p>
</code>
</pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;ArgGroup flag with a default, causes the entire ArgGroup to be required&quot; to &quot;requires_all ArgGroup with a default, causes the entire ArgGroup to be required&quot; by <a href="https://github.com/leeola">@leeola</a> on 2019-10-26 21:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-01 11:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">not-sure</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-01 14:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: arg groups</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-06 08:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-06 08:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-06 08:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-06 08:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-06 08:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-06 08:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">cc: CreepySkeleton</span> removed by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-06 09:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;3.1&quot; by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-09 08:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LordMZTE">@LordMZTE</a> on 2020-09-13 10:17</div>
            <div class="timeline-body"><p>any progress on this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;3.1&quot; by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-09-13 18:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;3.0&quot; by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-09-13 18:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> removed by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-09-13 18:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> removed by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-09-13 18:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/ldm0">@ldm0</a> by <a href="https://github.com/ldm0">@ldm0</a> on 2021-03-13 13:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ldm0">@ldm0</a> on 2021-08-08 08:49</div>
            <div class="timeline-body"><p>I think this is the expected behaviour. Default value just behaves as if the user is always using it. If clap special case it, you will see an <code>ArgGroup</code> requires non present argument, but still successfully gets a value.</p>
<pre><code>use clap::*;

fn main() {
  let _matches = App::new(&quot;bin&quot;)
    .arg(
      Arg::new(&quot;foo&quot;)
        .required(false)
        .long(&quot;foo&quot;)
        .value_name(&quot;FOO&quot;)
        .takes_value(true),
    )
    .arg(
      Arg::new(&quot;bar&quot;)
        .required(false)
        .long(&quot;bar&quot;)
        .value_name(&quot;BAR&quot;)
        .takes_value(true),
    )
    .arg(
      Arg::new(&quot;baz&quot;)
        .required(false)
        .long(&quot;baz&quot;)
        .value_name(&quot;BAZ&quot;)
        .default_value(&quot;default value&quot;)
        .takes_value(true),
    )
    .group(
      ArgGroup::new(&quot;test_flags&quot;)
        .multiple(true)
        .args(&amp;[&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;])
        .requires_all(&amp;[&quot;baz&quot;]),
    )
    .get_matches();

    assert_eq!(_matches.value_of(&quot;test_flags&quot;), Some(&quot;default value&quot;));
}

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/ldm0">@ldm0</a> on 2021-08-08 08:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-08-09 02:10</div>
            <div class="timeline-body"><p>I wouldn&#x27;t consider this fixed if we need to change how default values interact with parsing. This is fully related to #1906. We had similar issues in #1605. Maybe we need to rethink this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-08-09 02:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned <a href="https://github.com/ldm0">@ldm0</a> by <a href="https://github.com/ldm0">@ldm0</a> on 2021-08-15 16:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#2714</a> on 2021-08-18 14:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#2896</a> on 2021-10-16 19:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;3.0&quot; by <a href="https://github.com/epage">@epage</a> on 2021-10-16 19:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-10-16 19:38</div>
            <div class="timeline-body"><p>This is related to #2714 and I am reducing the impact through documentation in #2896. I assume @pksunkara will want this to remain open as part of future work to try to resolve this,</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#2897</a> on 2021-10-16 19:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/bors[bot]">@bors[bot]</a> on 2021-10-27 21:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>epage/clapng#10</a> on 2021-11-17 21:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#3076</a> on 2021-12-07 21:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:57:31 UTC
    </footer>
</body>
</html>
