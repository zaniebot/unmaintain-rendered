<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>contains_id doesn't panic - clap-rs/clap #5130</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>contains_id doesn't panic</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/5130">#5130</a>
        opened by <a href="https://github.com/Avgor46">@Avgor46</a>
        on 2023-09-19 16:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Avgor46">@Avgor46</a> on 2023-09-19 16:50</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.72.0 (5680fa18f 2023-08-23)</p>
<h3>Clap Version</h3>
<p>4.4.4</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">fn main() {
    let matches = clap::Command::new(&quot;myapp&quot;)
        .get_matches_from([&quot;myapp&quot;]);

    match matches.try_contains_id(&quot;arg&quot;) {
        Ok(fl) =&gt; println!(&quot;Ok: {fl}&quot;),
        Err(e) =&gt; println!(&quot;Error: {e}&quot;),
    }

    println!(&quot;It must panic: {}&quot;, matches.contains_id(&quot;arg&quot;));
}
</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<p>First, run with <code>cargo run</code>, then with <code>cargo run --release</code></p>
<h3>Actual Behaviour</h3>
<p>With <code>cargo run</code>:</p>
<pre><code>    Error: Unknown argument or group id.  Make sure you are using the argument id and not the short or long flags

    thread 'main' panicked at 'Mismatch between definition and access of `arg`. Unknown argument or group id. 
    Make sure you are using the argument id and not the short or long flags</code></pre>
<p>With <code>cargo run --release</code>:</p>
<pre><code>    Ok: false
    It must panic: false</code></pre>
<h3>Expected Behaviour</h3>
<p>Imho program above should print Error: {error message} and then panic in all cases.</p>
<h3>Additional Context</h3>
<p>Description says that <code>contains_id</code> panics <code>If id is not a valid argument or group name.</code> But in release mod it isn't true. Perhaps <a href="https://github.com/clap-rs/clap/blob/e6e539660f36487e3521ab6835ef1381a21785a4/clap_builder/src/parser/matches/arg_matches.rs#L1267">line</a> is the reason for this behavior. If this behavior was intended, the description of the function may be misleading to users. What do you think?</p>
<h3>Debug Output</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @Avgor46 on 2023-09-19 16:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-09-19 16:57</div>
            <div class="timeline-body"><p>It is intentional that our asserts are debug only as we don't want the extra bookkeeping to slow down applications.</p>
<p>Without any extra motivation given, I'm inclined to close this.  If there is a reason we should reconsider this, let us know!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2023-09-19 16:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avgor46">@Avgor46</a> on 2023-09-19 17:17</div>
            <div class="timeline-body"><p>According to the documentation, <code>contains_id</code> should panic if an invalid argument is given, but in release mode it does not panic. Am I missing something here? @epage</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-09-19 17:37</div>
            <div class="timeline-body"><p>The distinction is trivial since your code should work on both but I'm updating them to do clarify it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Avgor46">@Avgor46</a> on 2023-09-19 17:59</div>
            <div class="timeline-body"><p>Ok, thank you</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:34 UTC
    </footer>
</body>
</html>
