```yaml
number: 2776
title: "AppSettings::ColorNever does not works for \"Did you mean --flag\""
type: issue
state: closed
author: leizongmin
labels:
  - C-bug
assignees: []
created_at: 2021-09-19T03:36:00Z
updated_at: 2021-09-19T05:48:13Z
url: https://github.com/clap-rs/clap/issues/2776
synced_at: 2026-01-10T01:57:45Z
```

# AppSettings::ColorNever does not works for "Did you mean --flag"

---

_Issue opened by @leizongmin on 2021-09-19 03:36_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the existing issues

### Rust Version

rustc 1.57.0-nightly (9dd4ce80f 2021-09-17)

### Clap Version

2.33.3

### Minimal reproducible code

```rust
use clap::{AppSettings, Arg, SubCommand};

fn main() {
    let app = clap::App::new("example")
        .global_setting(AppSettings::ColorNever)
        .arg(Arg::with_name("aaa").long("aaa").global(true))
        .subcommand(SubCommand::with_name("bbb"));
    let args = std::env::args().collect::<Vec<_>>();
    match app.get_matches_from_safe(args) {
        Ok(matches) => println!("Ok: {:?}", matches),
        Err(e) => println!("Err: {}", e)
    }
}
```


### Steps to reproduce the bug with the above code

```bash
cargo run -- --aa
```


### Actual Behaviour

![image](https://user-images.githubusercontent.com/841625/133914442-ef5e9b8f-d71d-472f-bbe0-33dbec8c1b97.png)


### Expected Behaviour

the text "--aaa" is uncolored

### Additional Context

_No response_

### Debug Output

```
     Running `target/debug/clap-demo --aa`
DEBUG:clap:Parser::add_subcommand: term_w=None, name=bbb
DEBUG:clap:Parser::propagate_settings: self=example, g_settings=AppFlags(
    COLOR_NEVER,
)
DEBUG:clap:Parser::propagate_settings: sc=bbb, settings=AppFlags(
    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO,
), g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: self=bbb, g_settings=AppFlags(
    COLOR_NEVER,
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:Parser::create_help_and_version: Building help
DEBUG:clap:Parser::get_matches_with: Begin parsing '"--aa"' ([45, 45, 97, 97])
DEBUG:clap:Parser::is_new_arg:"--aa":NotFound
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: -- found
DEBUG:clap:Parser::is_new_arg: starts_new_arg=true
DEBUG:clap:Parser::possible_subcommand: arg="--aa"
DEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None
DEBUG:clap:ArgMatcher::process_arg_overrides:None;
DEBUG:clap:Parser::parse_long_arg;
DEBUG:clap:Parser::parse_long_arg: Does it contain '='...No
DEBUG:clap:Parser::parse_long_arg: Didn't match anything
DEBUG:clap:Parser::groups_for_arg: name=aaa
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:usage::create_usage_with_title;
DEBUG:clap:usage::create_usage_no_title;
DEBUG:clap:usage::smart_usage;
DEBUG:clap:usage::get_required_usage_from: reqs=["aaa"], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=["aaa"]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:usage::get_required_usage_from:iter:aaa:
DEBUG:clap:Parser::color;
DEBUG:clap:Parser::color: Color setting...Never
DEBUG:clap:is_a_tty: stderr=true
DEBUG:clap:Colorizer::error;
DEBUG:clap:Colorizer::warning;
DEBUG:clap:Colorizer::good;
Err: error: Found argument '--aa' which wasn't expected, or isn't valid in this context
	Did you mean --aaa?

USAGE:
    clap-demo --aaa

For more information try --help
```


---

_Label `T: bug` added by @leizongmin on 2021-09-19 03:36_

---

_Referenced in [denoland/deno#12118](../../denoland/deno/issues/12118.md) on 2021-09-19 03:42_

---

_Comment by @ldm0 on 2021-09-19 05:48_

```rust
use clap::{App, AppSettings, Arg};

fn main() {
    let app = clap::App::new("example")
        .global_setting(AppSettings::ColorNever)
        .arg(Arg::new("aaa").long("aaa").global(true))
        .subcommand(App::new("bbb"));
    let args = std::env::args().collect::<Vec<_>>();
    match app.try_get_matches_from(args) {
        Ok(matches) => println!("Ok: {:?}", matches),
        Err(e) => println!("Err: {}", e),
    }
}
```
![image](https://user-images.githubusercontent.com/31354274/133916950-eb4f1144-7b78-4449-8d85-82a9378b9ad8.png)
This has already been fixed on current master.

---

_Closed by @ldm0 on 2021-09-19 05:48_

---
