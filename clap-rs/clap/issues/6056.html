<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Changing the styling of spec values in long help from `literal` to `context_value`  - clap-rs/clap #6056</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Changing the styling of spec values in long help from `literal` to `context_value` </h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/6056">#6056</a>
        opened by <a href="https://github.com/GilShoshan94">@GilShoshan94</a>
        on 2025-07-01 20:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/GilShoshan94">@GilShoshan94</a> on 2025-07-01 20:38</div>
            <div class="timeline-body"><p>For &quot;Possible values&quot;, the styling for the values is already set with the <code>literal</code> styling but just for the <code>long help</code>, so it feels inconsistent, but changing that could be considered a breaking change and therefore, we might leave it for 5.0.</p>
<p>Related to #5093, we are adding styling for <code>context</code> and <code>context_value</code>, so here we should apply the <code>context_value</code> styling instead of <code>literal</code>.</p>
<p>I think it would make senses to also apply the <code>context</code> styling on the header <code>Possible values:</code>, just like it is with the other contexts (default, aliases, ...).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2025-07-01 20:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/6057.html">clap-rs/clap#6057</a> on 2025-07-01 20:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @epage on 2025-07-01 20:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "5.0" by @epage on 2025-07-01 20:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-help</span> added by @epage on 2025-07-01 20:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> added by @epage on 2025-07-01 20:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-07-01 20:46</div>
            <div class="timeline-body"><p>Sorry, the intent of this wasn't clear as it just quoted a comment.  Would you be able to be clearer in what this is saying?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GilShoshan94">@GilShoshan94</a> on 2025-07-01 21:27</div>
            <div class="timeline-body"><p>Yes, it is a reference to my original discussion with you, from those 2 comments (with images):</p>
<ul>
<li>https://github.com/clap-rs/clap/issues/5093#issuecomment-2091863555</li>
<li>https://github.com/clap-rs/clap/issues/5093#issuecomment-2091916662</li>
</ul>
<p>Bottom line the styling for &quot;Possible values&quot;, the values are already treated with <code>literal</code> styling but just for the long help, so it feels inconsistent, but changing that would be a breaking change.
So, we split the issue in 2 PR, one to add the styling to the &quot;contexts&quot; and their values (while leaving it by default not styled to not introduce a breaking change) and the PR for this issue that will make it consistent but will be a breaking change and should be merged for the 5.0 release (that's what I understood from @pksunkara)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Changing the styling of spec values in long help from `literal` to `context_possible_values_data` " to "Changing the styling of spec values in long help from `literal` to `context_data` " by @GilShoshan94 on 2025-07-01 22:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-07-02 20:23</div>
            <div class="timeline-body"><p>Could you update the issue description with what this issue is about?  I appreciate you taking the time to clarify but people shouldn't have to dig through the thread for that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Changing the styling of spec values in long help from `literal` to `context_data` " to "Changing the styling of spec values in long help from `literal` to `context_value` " by @GilShoshan94 on 2025-07-03 05:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GilShoshan94">@GilShoshan94</a> on 2025-07-03 05:19</div>
            <div class="timeline-body"><p>Done, I updated the issue description</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GilShoshan94">@GilShoshan94</a> on 2025-07-07 23:58</div>
            <div class="timeline-body"><p><img width="1760" height="1627" alt="Image" src="https://github.com/user-attachments/assets/45dab54c-5aa0-42b8-8823-f5e1d1a91ce8" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GilShoshan94">@GilShoshan94</a> on 2025-07-09 22:03</div>
            <div class="timeline-body"><p>I am adding here that in this issue I would like to style the context &quot;title&quot; with <code>context</code>, not just the values.</p>
<p>So in the code, replace:
<code>self.writer.push_str(&quot;Possible values:&quot;);</code>
by
<code>self.writer.push_string(format!(&quot;{ctx}Possible values:{ctx:#}&quot;));</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GilShoshan94">@GilShoshan94</a> on 2025-07-30 07:44</div>
            <div class="timeline-body"><p>Hi @epage,</p>
<p>I know this is a pretty minor ticket, just wanted to let you know that whenever you have time to revisit this in the coming months, I am here to discuss this with you and if you decide that you want to go ahead and apply my suggestion, I will be happy to prepare the PR for you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">M-breaking-change</span> added by @epage on 2025-07-30 21:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-08-05 20:34</div>
            <div class="timeline-body"><p>To make things easier to work with than a screenshot:</p>
<p>The thread at https://github.com/clap-rs/clap/pull/6057#discussion_r2182922085 is relevant, starting with:</p>
<blockquote>
<p>Let's defer out all &quot;Possible Values&quot; changes in long help to #6056.</p>
<p>The original issue was focused on the <code>[]</code> sections. The possibility of touching long help didn't come up until <a href="https://github.com/clap-rs/clap/issues/5093#issuecomment-2091863555">#5093 (comment)</a> and I never got to reply to that.</p>
<p>I feel like the formatting of Possible Values is very different than <code>[]</code>. Instead of being a special syntax for context, its written more like what someone would write out and I don't feel confident that styling it like <code>[]</code> is the right call.</p>
<p>Take <code>rg --help</code> as an example</p>
<pre><code>        --color &lt;WHEN&gt;
            This flag controls when to use colors. The default setting is 'auto', which
            means ripgrep will try to guess when to use colors. For example, if ripgrep is
            printing to a terminal, then it will use colors, but if it is redirected to a
            file or a pipe, then it will suppress color output. ripgrep will suppress color
            output in some other circumstances as well. For example, if the TERM
            environment variable is not set or set to 'dumb', then ripgrep will not use
            colors.

            The possible values for this flag are:

                never    Colors will never be used.
                auto     The default. ripgrep tries to be smart.
                always   Colors will always be used regardless of where output is sent.
                ansi     Like 'always', but emits ANSI escapes (even in a Windows console).

            When the --vimgrep flag is given to ripgrep, then the default value for the
            --color flag changes to 'never'.
</code></pre>
<p>this isn't using clap anymore and it didn't use our Possible Values rendering, but the format is similar.</p>
</blockquote>
<p>From https://github.com/clap-rs/clap/pull/6057#discussion_r2183241507</p>
<blockquote>
<p>But except for this case, the other &quot;contexts&quot; (default, env, ...) use the same formatting function for the long help, so they are automatically using the same styling <code>context</code> and <code>context_value</code> for the long help than in the short help.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-08-05 20:35</div>
            <div class="timeline-body"><p>If we did something, it would have to wait for the start of v5.0.0 work or go behind the <code>unstable-v5</code> flag.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-08-05 20:37</div>
            <div class="timeline-body"><blockquote>
<p>I feel like the formatting of Possible Values is very different than []. Instead of being a special syntax for context, its written more like what someone would write out and I don't feel confident that styling it like [] is the right call.</p>
</blockquote>
<p>Currently, I lean towards the Possible Values section being different enough from <code>[specs]</code> that it is reasonable and expected to be rendered differently and would be inclined to close this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GilShoshan94">@GilShoshan94</a> on 2025-08-06 09:27</div>
            <div class="timeline-body"><blockquote>
<p>If we did something, it would have to wait for the start of v5.0.0 work or go behind the <code>unstable-v5</code> flag.</p>
</blockquote>
<p>Indeed, agree.</p>
<blockquote>
<p>Currently, I lean towards the Possible Values section being different enough from [specs] that it is reasonable and expected to be rendered differently and would be inclined to close this.</p>
</blockquote>
<p>While I don't agree with you, this is a matter of taste/opinion and I can be ok with that, the issue I think is that it does not feel consistent nor between the short help and the long help, and even in the long help, the &quot;possible values&quot; is treated differently according to if it does has long help on the values or not.</p>
<p>I slightly transformed the example <code>examples\typed-derive.rs</code> to showcase this to you.</p>
<p>I used the following styling:</p>
<pre><code class="language-rust">const STYLING: Styles = Styles::styled()
    .header(AnsiColor::Green.on_default().bold())
    .usage(AnsiColor::Green.on_default().bold())
    .literal(AnsiColor::Cyan.on_default().bold())
    .placeholder(AnsiColor::Cyan.on_default())
    .error(AnsiColor::Red.on_default().bold())
    .valid(AnsiColor::Green.on_default().bold())
    .invalid(AnsiColor::Yellow.on_default().bold())
    .context(AnsiColor::Yellow.on_default().dimmed())
    .context_value(AnsiColor::Yellow.on_default());
</code></pre>
<p>So literals are in bold cyan and the context / context_value are in dimmed yellow / yellow.</p>
<p>Here is the result, I hope you can see the inconsistencies I am observing as well:</p>
<p><img width="1853" height="1021" alt="Image" src="https://github.com/user-attachments/assets/aa359cf7-5645-4a83-8d89-0e30f06f4fd4" /></p>
<p>(Here I attached the modified example, if you want to try it yourself, I added the <code>.txt</code> just to be able to attach it here)</p>
<p><a href="https://github.com/user-attachments/files/21615069/test_clap.rs.txt">test_clap.rs.txt</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/6091.html">clap-rs/clap#6091</a> on 2025-08-06 16:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-08-06 16:50</div>
            <div class="timeline-body"><p>imo the <code>[possible values: ]</code> form and the <code>Possible Values</code> form are very different, so I'm not concerned about consistency between them</p>
<p>Instead our goal is looking like we were part of the users <code>about</code>.  Seeing your screenshot, I realize there is an issue with that that is highlighted by the use of colors.  We should have Possible Values before context.  This was fixed in #6091.</p>
<p>Also, #5156 might allow us to drop the <code>[possible values]</code> form in a lot of cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GilShoshan94">@GilShoshan94</a> on 2025-08-06 18:03</div>
            <div class="timeline-body"><blockquote>
<p>imo the [possible values: ] form and the Possible Values form are very different</p>
</blockquote>
<p>Thanks for taking the time to look into this, I appreciate the discussion.
It really comes down to personal preference.
If you’re comfortable with the current approach, I’m okay leaving it as is.
My only suggestion would be to consider seeking additional feedback, as I view<code> [possible values:]</code> and <code>Possible Values</code> as forms as closely related in context.</p>
<p>=&gt; Unless you decide otherwise, I won’t open a PR on this for now.</p>
<blockquote>
<p>Instead our goal is looking like we were part of the users about. Seeing your screenshot, I realize there is an issue with that that is highlighted by the use of colors. We should have Possible Values before context. This was fixed in https://github.com/clap-rs/clap/pull/6091.</p>
<p>Also, https://github.com/clap-rs/clap/issues/5156 might allow us to drop the [possible values] form in a lot of cases.</p>
</blockquote>
<p>Sorry, I don't follow to be honnest... I looked into the links you put but I fail to understand you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-08-06 19:20</div>
            <div class="timeline-body"><blockquote>
<p>Sorry, I don't follow to be honnest... I looked into the links you put but I fail to understand you.</p>
</blockquote>
<p>For #6091, re-run the code you used for the screenshot with the latest clap.  The <code>[default:]</code> no longer splits the user content from <code>Possible Values:</code>, making it look more cohesive.</p>
<p>For #5156, imagine if instead of</p>
<pre><code>--port &lt;PORT&gt;
    Support for discrete numbers

    [default: 22]
    [possible values: 22, 80]

--log-level &lt;LOG_LEVEL&gt;
    Support enum from a foreign crate that don't implement `ValueEnum`

    Possible Values:
    - trace: ...
    - debug: ...
    - info: ...
    - warn: ...
    - error: ...
</code></pre>
<p>we had</p>
<pre><code>--port &lt;22|80&gt;
    Support for discrete numbers

    [default: 22]

--log-level &lt;trace|debug|info|warn|error&gt;
    Support enum from a foreign crate that don't implement `ValueEnum`

    Possible Values:
    - trace: ...
    - debug: ...
    - info: ...
    - warn: ...
    - error: ...
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GilShoshan94">@GilShoshan94</a> on 2025-08-06 19:47</div>
            <div class="timeline-body"><p>Ah, ok, I understand better, thank you.
Yes, it looks great.
I guess the only times it would not are in some edge case with either a large number of possible values or with too &quot;wide&quot; (many characters to display) values.</p>
<p>Just for those edge case, it would be nice to leave an option still display it as it is currently today, with the placeholder.</p>
<p>Now, I don't know what the better default is, to make the new behavior (without the placeholder for possible values) opt-in or opt-out.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-08-06 19:49</div>
            <div class="timeline-body"><p>I discuss potential for disabling the literals and opt-in/opt-out in #5156.  Likely a better conversation for that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GilShoshan94">@GilShoshan94</a> on 2025-08-06 19:52</div>
            <div class="timeline-body"><p>Ok so, we can continue this discussion there,
Do you want to close this ticket or leave it open to gather additional feedback?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-08-06 20:46</div>
            <div class="timeline-body"><p>I lean towards closing.  We can always re-visit it if a motivating enough case comes up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2025-08-06 20:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:35 UTC
    </footer>
</body>
</html>
