<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Derive: adding `visible_alias` attribute to complex subcommands results in duplicated aliases - clap-rs/clap #2898</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Derive: adding `visible_alias` attribute to complex subcommands results in duplicated aliases</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/2898">#2898</a>
        opened by <a href="https://github.com/tranzystorekk">@tranzystorekk</a>
        on 2021-10-16 20:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/tranzystorekk">@tranzystorekk</a> on 2021-10-16 20:08</div>
            <div class="timeline-body"><p>StructOpt Issue: https://github.com/TeXitoi/structopt/issues/418
StructOpt PR: https://github.com/TeXitoi/structopt/pull/504</p>
<h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
<h3>Rust Version</h3>
<p>1.55.0</p>
<h3>Clap Version</h3>
<p>3.0.0-beta.4</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">use clap::Clap;

#[derive(Clap)]
enum Cmd {
    #[clap(visible_alias = &quot;alias&quot;)]
    Test { args: Vec&lt;String&gt; },
}

#[derive(Clap)]
struct Cli {
    #[clap(subcommand)]
    cmd: Cmd,
}

fn main() {
    let cli = Cli::parse();
}
</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<p>cargo run -- --help</p>
<h3>Actual Behaviour</h3>
<pre><code class="language-console">FLAGS:
    -h, --help       Print help information
    -V, --version    Print version information

SUBCOMMANDS:
    help    Print this message or the help of the given subcommand(s)
    test     [aliases: alias, alias]
</code></pre>
<h3>Expected Behaviour</h3>
<pre><code class="language-console">FLAGS:
    -h, --help       Print help information
    -V, --version    Print version information

SUBCOMMANDS:
    help    Print this message or the help of the given subcommand(s)
    test     [aliases: alias]
</code></pre>
<h3>Additional Context</h3>
<p>Output of <code>cargo expand</code> with duplicated calls to <code>visible_alias</code>:</p>
<pre><code class="language-rust">impl clap::Subcommand for Cmd {
    fn augment_subcommands&lt;'b&gt;(app: clap::App&lt;'b&gt;) -&gt; clap::App&lt;'b&gt; {
        let app = app;
        let app = app.subcommand({
            let subcommand = clap::App::new(&quot;test&quot;);
            let subcommand = subcommand;
            let subcommand = {
                let subcommand = subcommand;
                let subcommand = subcommand.arg(
                    clap::Arg::new(&quot;args&quot;)
                        .takes_value(true)
                        .value_name(&quot;ARGS&quot;)
                        .multiple_values(true)
                        .validator(|s| ::std::str::FromStr::from_str(s).map(|_: String| ())),
                );
                subcommand.visible_alias(&quot;alias&quot;)
            };
            subcommand.visible_alias(&quot;alias&quot;)
        });
        app
    }
</code></pre>
<h3>Debug Output</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @tranzystorekk on 2021-10-16 20:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Derive: adding `visible_alias` attribute to complex subcommands result in duplicated aliases" to "Derive: adding `visible_alias` attribute to complex subcommands results in duplicated aliases" by @tranzystorekk on 2021-10-16 20:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: alias</span> added by @pksunkara on 2021-10-16 20:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: derive macros</span> added by @pksunkara on 2021-10-16 20:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-10-16 20:22</div>
            <div class="timeline-body"><p>@epage Might be fixed by your recent changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-10-16 20:28</div>
            <div class="timeline-body"><p>It isn't.  This was also recently reported for structopt.  You can see the proposed fix https://github.com/TeXitoi/structopt/pull/504</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-10-16 20:30</div>
            <div class="timeline-body"><p>My proposed fix for #2894 should also fix this without having to duplicate logic like in the structopt fix (due to our divergence, the level of duplication is different, I don't remember if its worse or better).  So the question is whether we get to #2894 or go ahead and port structopt's fix over in the mean time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-10-16 20:41</div>
            <div class="timeline-body"><p>I am of the opinion that we should focus on #2894 after the release and fix it correctly. Structopt's fixes are temporary because it is basically in maintenance mode.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-10-16 20:46</div>
            <div class="timeline-body"><p>#2894 involves a breaking change (just added the tag).  We'll have to change the trait definitions.</p>
<p>This is one of those things I classify as a non-disruptive breaking change.  Most users will be using the derive and will not notice the breaking change, only the bug fixes (and where you draw the line on behavior changes being breaking is another question)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../tranzystorekk/pakr/issues/2.html">tranzystorekk/pakr#2</a> on 2021-10-16 20:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @epage on 2021-10-25 18:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @epage by @epage on 2021-10-26 18:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2952.html">clap-rs/clap#2952</a> on 2021-10-26 21:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @bors[bot] on 2021-10-26 23:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @bors[bot] on 2021-10-26 23:04</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:33 UTC
    </footer>
</body>
</html>
