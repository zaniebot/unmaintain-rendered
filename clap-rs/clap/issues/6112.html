<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invalid completion generation for nushell when option is of style `--option.suboption &lt;value&gt;` - clap-rs/clap #6112</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Invalid completion generation for nushell when option is of style <code>--option.suboption &lt;value&gt;</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/clap-rs/clap/issues/6112">#6112</a>
        opened by <a href="https://github.com/0xferrous">@0xferrous</a>
        on 2025-08-27 08:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/0xferrous">@0xferrous</a> on 2025-08-27 08:10</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[x] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[x] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.91.0-nightly (9eb4a2652 2025-08-18)</p>
<h3>Clap Version</h3>
<p>clap_complete_nushell = &quot;4.5.8&quot;, clap = &quot;4.5.46&quot;, clap_complete = &quot;4.5.57&quot;</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">use clap::CommandFactory;
use clap_complete::aot::generate;

#[derive(clap::Parser)]
struct Args {
    #[arg(long = &quot;nested.option&quot;)]
    pub nested_option: Option&lt;u64&gt;,
}

fn main() {
    generate(
        clap_complete_nushell::Nushell,
        &amp;mut Args::command(),
        &quot;repro&quot;,
        &amp;mut std::io::stdout(),
    );
}
</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<p><code>cargo r</code></p>
<h3>Actual Behaviour</h3>
<pre><code class="language-nushell">module completions {

  export extern repro [
    --nested.option: string
    --help(-h)                # Print help
  ]

}

export use completions *
</code></pre>
<p>generated completion is not valid nushell:</p>
<pre><code>Error: nu::parser::parse_mismatch

  × Parse mismatch during operation.
   ╭─[entry #1:2:5]
 1 │   export extern repro [
 2 │     --nested.option: string
   ·     ───────┬───────
   ·            ╰── expected valid variable name for this long flag
 3 │     --help(-h)                # Print help
   ╰────
</code></pre>
<h3>Expected Behaviour</h3>
<p>Not sure what the valid generation for this option's completion will be(i will try to look into this soon), but whatever is generated should be valid nushell.</p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
<h3>Debug Output</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @0xferrous on 2025-08-27 08:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-medium</span> added by @epage on 2025-08-27 14:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-completion</span> added by @epage on 2025-08-27 14:35</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 12:32:14 UTC
    </footer>
</body>
</html>
