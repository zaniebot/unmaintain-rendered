<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>clap_derive: Default value support for Vec of ValueEnums - clap-rs/clap #3932</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>clap_derive: Default value support for Vec of ValueEnums</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/3932">#3932</a>
        opened by <a href="https://github.com/emersonford">@emersonford</a>
        on 2022-07-14 03:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/emersonford">@emersonford</a> on 2022-07-14 03:15</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>3.2.10</p>
<h3>Describe your use case</h3>
<p>Suppose you have the following:</p>
<pre><code class="language-rust">#[derive(clap::ValueEnum, PartialEq, Debug, Clone)]
enum ArgChoice {
    Foo,
    Bar,
}

#[derive(Parser, PartialEq, Debug)]
struct Opt {
    #[clap(value_enum, value_parser)]
    arg: Vec&lt;ArgChoice&gt;,
}
</code></pre>
<p>providing default values for <code>arg</code> doesn't feel very ergonomic to me. As far as I'm aware, you have the following options:</p>
<ol>
<li><p><code>#[clap(value_enum, value_parser, default_value=&quot;foo,bar&quot;, value_delimiter=',')]</code> as shown in #3541</p>
<ul>
<li>Doesn't feel super great to me since you're forced into using <code>value_delimiter</code> and can't easily set the default to &quot;all variants&quot;. Also, if you ever use <code>rename_all</code>, you'd have to ensure <code>default_value</code> also gets changed.</li>
</ul>
</li>
<li><p><code>default_values(...)</code> with something like</p>
<pre><code class="language-rust">ArgChoice::value_variants().iter().map(|val| val.to_possible_value().unwrap().get_name()).collect::&lt;Vec&lt;_&gt;&gt;().as_slice()
</code></pre>
<p>or</p>
<pre><code class="language-rust">&amp;[ArgChoice::Foo.to_possible_value().unwrap().get_name(), ArgChoice::Foo.to_possible_value().unwrap().get_name()]
</code></pre>
<ul>
<li>Requires a lot of boiler plate and repeated code.</li>
</ul>
</li>
</ol>
<h3>Describe the solution you'd like</h3>
<p>Fixing <code>default_value_t</code> so you can do the following:</p>
<pre><code class="language-rust">#[derive(clap::ValueEnum, PartialEq, Debug, Clone)]
enum ArgChoice {
    Foo,
    Bar,
}

#[derive(Parser, PartialEq, Debug)]
struct Opt {
    #[clap(value_enum, value_parser, default_value_t = vec![ArgChoice::Foo])]
    arg: Vec&lt;ArgChoice&gt;,
}
</code></pre>
<p>and</p>
<pre><code class="language-rust">#[derive(clap::ValueEnum, PartialEq, Debug, Clone)]
enum ArgChoice {
    Foo,
    Bar,
}

#[derive(Parser, PartialEq, Debug)]
struct Opt {
    #[clap(value_enum, value_parser, default_value_t = ArgChoice::value_variants().to_vec())]
    arg: Vec&lt;ArgChoice&gt;,
}
</code></pre>
<h3>Alternatives, if applicable</h3>
<p>I could see an argument for adding a <code>default_values_t</code> attr, but since <code>default_value_t</code> doesn't work to begin with for <code>Vec&lt;impl ValueEnum&gt;</code>, I feel like we might as well fix <code>default_value_t</code> (plus I personally find it more intuitive, if I used the &quot;typed&quot; version for a Vec, I should be able to pass a Vec).</p>
<h3>Additional Context</h3>
<p><code>default_value_t</code> doesn't work in any way:</p>
<pre><code class="language-rust">#[derive(Parser, PartialEq, Debug)]
struct Opt {
    #[clap(
        value_enum, 
        value_parser, 
        default_value_t = ArgChoice::Foo,
    )]
    arg: Vec&lt;ArgChoice&gt;,
}
</code></pre>
<pre><code>error[[E0308]](https://doc.rust-lang.org/stable/error-index.html#E0308): mismatched types
  --&gt; src/main.rs:14:27
   |
14 |         default_value_t = ArgChoice::Foo,
   |                           ^^^^^^^^^^^^^^ expected struct `Vec`, found enum `ArgChoice`
15 |     )]
16 |     arg: Vec&lt;ArgChoice&gt;,
   |          -------------- expected due to this
   |
   = note: expected struct `Vec&lt;ArgChoice&gt;`
                found enum `ArgChoice`
</code></pre>
<pre><code class="language-rust">#[derive(Parser, PartialEq, Debug)]
struct Opt {
    #[clap(
        value_enum, 
        value_parser, 
        default_value_t = vec![ArgChoice::Foo],
    )]
    arg: Vec&lt;ArgChoice&gt;,
}
</code></pre>
<pre><code>error[[E0277]](https://doc.rust-lang.org/stable/error-index.html#E0277): the trait bound `Vec&lt;ArgChoice&gt;: ArgEnum` is not satisfied
  --&gt; src/main.rs:14:9
   |
14 |         default_value_t = vec![ArgChoice::Foo],
   |         ^^^^^^^^^^^^^^^ the trait `ArgEnum` is not implemented for `Vec&lt;ArgChoice&gt;`
   |
   = help: the trait `ArgEnum` is implemented for `ArgChoice`
</code></pre>
<p>so changing <code>default_value_t</code>'s behavior here for a Vec of ValueEnums wouldn't be a breaking change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @emersonford on 2022-07-14 03:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3933.html">clap-rs/clap#3933</a> on 2022-07-14 03:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/emersonford">@emersonford</a> on 2022-07-14 04:31</div>
            <div class="timeline-body"><p>documenting this here from the PR:</p>
<blockquote>
<p>I realized I could apply this for all Vec<impl Display>, not just a Vec<impl ValueEnum>.</p>
</blockquote>
<p>so I added another commit to the PR to fix <code>default_value_t</code> for all <code>Vec</code> types</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/benny-n">@benny-n</a> on 2022-07-14 15:21</div>
            <div class="timeline-body"><p>I realized that I need this feature today and this design is exactly what I had in mind!
Looking forward to seeing this merged ðŸ™‚</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @emersonford on 2022-07-25 21:45</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:08 UTC
    </footer>
</body>
</html>
