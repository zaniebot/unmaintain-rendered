<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AllowMissingPositional + trailing multiple(true) arg imposes weird requirement - clap-rs/clap #1990</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>AllowMissingPositional + trailing multiple(true) arg imposes weird requirement</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1990">#1990</a>
        opened by <a href="https://github.com/theastrallyforged">@theastrallyforged</a>
        on 2020-06-28 03:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/theastrallyforged">@theastrallyforged</a></div>
            <div class="timeline-body">Make sure you completed the following tasks
<ul>
<li>[*] Searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[*] Searched the closes issues</li>
</ul>
Code
<pre><code>use clap::{App, AppSettings, Arg};

fn main() {
    let args = App::new(&quot;mcve&quot;)
                       .setting(AppSettings::TrailingVarArg)
                       .setting(AppSettings::AllowMissingPositional)
                       .arg(Arg::with_name(&quot;file&quot;)
                            .required(true))
                       .arg(Arg::with_name(&quot;inner-args&quot;)
                            .multiple(true))
                       .get_matches();
    dbg!(args);
}
</code></pre>
Steps to reproduce the issue
<ol>
<li><code>cargo run</code> (see actual and expected behavior sections)</li>
</ol>
Version
<ul>
<li><strong>Rust</strong>: <code>rustc 1.44.0 (49cae5576 2020-06-01)</code></li>
<li><strong>Clap</strong>: <code>2.33.1</code></li>
</ul>
Actual Behavior Summary
<p>a. <code>cargo run -- file</code> =&gt; <code>error: The following required arguments were not provided: &lt;file&gt;</code>
b. <code>cargo run -- file -- arg</code> =&gt; <code>error: The following required arguments were not provided: &lt;file&gt;</code>
c. <code>cargo run -- file foo -- bar</code> =&gt; <code>file</code> is <code>&quot;file&quot;</code> and <code>inner-args</code> is <code>[&quot;foo&quot;, &quot;--&quot;, &quot;bar&quot;]</code></p>
Expected Behavior Summary
<p>a. Parsing succeeds; <code>file</code> is <code>&quot;file&quot;</code> and <code>inner-args</code> is <code>[]</code>
b. Parsing succeeds; <code>file</code> is <code>&quot;file&quot;</code> and <code>inner-args</code> is <code>[&quot;arg&quot;]</code>
c. <code>file</code> is <code>&quot;file&quot;</code> and <code>inner-args</code> is <code>[&quot;foo&quot;, &quot;bar&quot;]</code></p>
End Goal
<p>I&#x27;m writing an interpreter. The first positional argument is the path to the program being run. Any remaining positional arguments are passed through as arguments to the program, but these program arguments are <em>optional.</em> (There are also various flags that control the behavior of the interpreter, but those didn&#x27;t seem relevant to the main issue.)</p>
<p>I want the usage to look like <code>interpreter [FLAGS ...] &lt;program&gt; [--] [program-args ...]</code>. That is:</p>
<ol>
<li><code>program</code>, mandatory positional argument</li>
<li>flags, optional non-positional</li>
<li>an optional <code>--</code> to explicitly begin <code>program-args</code></li>
<li><code>program-args</code>, optional positional arguments</li>
<li>anything after the first <code>program-args</code> is also part of <code>program-args</code>, even if it looks like a flag or whatever</li>
</ol>
<p><code>Arg::last()</code> seems related to what I want, but it makes the <code>--</code> <em>required</em>, and I want it to be optional.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by <a href="https://github.com/theastrallyforged">@theastrallyforged</a> on 2020-06-28 03:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-06-29 05:06</div>
            <div class="timeline-body"><p><code>AllowMissingPositional</code> is often a bad idea. It&#x27;s just a workaround for some use cases needed because clap&#x27;s parser is too dumb to populate positional args properly.</p>
<p>Without it, <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=e4a4a6dcfb0972a2ffedeecae76acf63">everything&#x27;s working pretty much as expected</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-06-30 23:26</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:57:49 UTC
    </footer>
</body>
</html>
