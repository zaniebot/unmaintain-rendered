```yaml
number: 4498
title: "`Default`-able arguments are \"missing\" when encountering unknown flag with `ignore_errors`"
type: issue
state: closed
author: MarijnS95
labels: []
assignees: []
created_at: 2022-11-21T15:37:54Z
updated_at: 2025-05-07T14:22:33Z
url: https://github.com/clap-rs/clap/issues/4498
synced_at: 2026-01-10T01:57:48Z
```

# `Default`-able arguments are "missing" when encountering unknown flag with `ignore_errors`

---

_Issue opened by @MarijnS95 on 2022-11-21 15:37_

When parsing unknown flags into a struct that has `ignore_errors(true)`, `clap` fails with `"The following required argument was not provided: bar"` upon encountering an unrecognized flag, whereas `bar` is a `bool` flag that should default to `false`.

# Repro

https://play.rust-lang.org/?version=stable&mode=debug&edition=2021&gist=c8526876b56fbc51bb2a8e2440be52c1

```rust
use clap::{CommandFactory, FromArgMatches, Parser};

#[derive(Debug, Parser)]
struct Args {
    #[clap(short, long)]
    bar: bool,
}

fn main() {
    let command = Args::command().ignore_errors(true).no_binary_name(true);

    let args = Args::from_arg_matches(&command.clone().get_matches_from::<_, &str>([])).unwrap();
    assert!(!args.bar);
    dbg!(args);

    let args = Args::from_arg_matches(&command.clone().get_matches_from(["--bar"])).unwrap();
    assert!(args.bar);
    dbg!(args);

    let args = Args::from_arg_matches(&command.clone().get_matches_from(["--foo"])).unwrap();
    assert!(!args.bar);
    dbg!(args);

    let args = Args::from_arg_matches(&command.get_matches_from(["--foo", "--bar"])).unwrap();
    assert!(args.bar);
    dbg!(args);
}
```

## Bonus

I added an example with an unknown arg first, assuming it should step over the unknown arg and still set `bar` to true based on `--bar` presence. Not sure if that's possible at all, given that we just discussed positional args vs `--bar` possibly being a value to the `--foo` flag...

_Originally posted by @MarijnS95 in https://github.com/clap-rs/clap/issues/1404#issuecomment-1309254274_
      

---

_Comment by @MarijnS95 on 2022-11-21 15:39_

> Originally posted by @MarijnS95 in [#1404 (comment)](https://github.com/clap-rs/clap/issues/1404#issuecomment-1309254274)

Looks like this ends up being a duplicate of #4391, after GH title search (when creating issues) is more helpful than a search for keywords on its own.

EDIT: Or not, since it seems to work correctly for me _when not passing `--bar`_, and specifically requires an ignored unknown arg first...

---

_Comment by @bonigarcia on 2023-12-13 16:29_

I am experiencing this problem as well. The following snippet is the relevant part of my clap setup:

```
#[derive(Parser, Debug)]
#[clap(version, about, long_about = None, ignore_errors = true, help_template = "\
{name} {version}
{about-with-newline}
{usage-heading} {usage}
{all-args}")]
struct Cli {
    /// Browser name (chrome, firefox, edge, iexplorer, safari, safaritp, or webview2)
    #[clap(long, value_parser)]
    browser: Option<String>,

    // ... More fields

    /// Output type: LOGGER (using INFO, WARN, etc.), JSON (custom JSON notation), or SHELL (Unix-like)
    #[clap(long, value_parser, default_value = "LOGGER")]
    output: String,
	
    // ... More fields
}
```

When I add `ignore_errors = true`, after adding a non-supported argument, my CLI tool fails as follows:

```
error: The following required argument was not provided: output
```

Is there any plan to fix it? Thank you.

---

_Comment by @epage on 2025-05-07 14:22_

Looks like this is a duplicate of #4391, closing in favor of that.

If there is a reason to keep this open, let us know!

---

_Closed by @epage on 2025-05-07 14:22_

---
