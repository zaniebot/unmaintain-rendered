<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Example code of README.md using builder pattern results in panic - clap-rs/clap #1965</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Example code of README.md using builder pattern results in panic</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1965">#1965</a>
        opened by <a href="https://github.com/asteding">@asteding</a>
        on 2020-06-08 05:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/asteding">@asteding</a></div>
            <div class="timeline-body">Make sure you completed the following tasks
<ul>
<li>[x] Searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[x] Searched the closes issues</li>
</ul>
Code
<pre><code>// (Full example with detailed comments in examples/01a_quick_example.rs)
//
// This example demonstrates clap&#x27;s &quot;builder pattern&quot; method of creating arguments
// which the most flexible, but also most verbose.
use clap::{Arg, App};

fn main() {
    let matches = App::new(&quot;My Super Program&quot;)
        .version(&quot;1.0&quot;)
        .author(&quot;Kevin K. &lt;kbknapp@gmail.com&gt;&quot;)
        .about(&quot;Does awesome things&quot;)
        .arg(Arg::new(&quot;config&quot;)
            .short(&#x27;c&#x27;)
            .long(&quot;config&quot;)
            .value_name(&quot;FILE&quot;)
            .about(&quot;Sets a custom config file&quot;)
            .takes_value(true))
        .arg(Arg::new(&quot;INPUT&quot;)
            .about(&quot;Sets the input file to use&quot;)
            .required(true)
            .index(1))
        .arg(Arg::new(&quot;v&quot;)
            .short(&#x27;v&#x27;)
            .multiple(true)
            .about(&quot;Sets the level of verbosity&quot;))
        .subcommand(App::new(&quot;test&quot;)
            .about(&quot;controls testing features&quot;)
            .version(&quot;1.3&quot;)
            .author(&quot;Someone E. &lt;someone_else@other.com&gt;&quot;)
            .arg(Arg::new(&quot;debug&quot;)
                .short(&#x27;d&#x27;)
                .about(&quot;print debug information verbosely&quot;)))
        .get_matches();

    // Same as above examples...
}
</code></pre>
Steps to reproduce the issue
<ol>
<li>Run <code>cargo run</code></li>
</ol>
Version
<ul>
<li><strong>Rust</strong>: rustc 1.45.0-nightly (47c3158c3 2020-06-04)</li>
<li><strong>Clap</strong>: 3.0.0-beta.1</li>
</ul>
Actual Behavior Summary
<p>If i use the above example code from the clap-rs <a href="https://github.com/clap-rs/clap/blob/master/README.md#using-builder-pattern">README.md</a> i get a
thread &#x27;main&#x27; panicked at &#x27;Argument names must be unique, but &#x27;&#x27; is in use by more than one argument or group&#x27;</p>
Expected Behavior Summary
<p>I think <em>this</em> should happen instead.
error: The following required arguments were not provided:
</p>
<p>USAGE:
clap_bug [FLAGS] [OPTIONS]  [SUBCOMMAND]</p>
Additional context
Debug output
<p>Compile clap with <code>debug</code> feature:</p>
<pre><code>[dependencies]
clap = { version = &quot;*&quot;, features = [&quot;debug&quot;] }
</code></pre>
<p>The output may be very long, so feel free to link to a gist or attach a text file</p>

 Debug Output 
<pre>
<code>

<p>Paste Debug Output Here
[            clap::build::app]  App::_do_parse
[            clap::build::app]  App::_build
[            clap::build::app]  App::_derive_display_order:My Super Program
[            clap::build::app]  App::_derive_display_order:test
[            clap::build::app]  App::_create_help_and_version
[            clap::build::app]  App::_create_help_and_version: Building --help
[            clap::build::app]  App::_create_help_and_version: Building --version
[            clap::build::app]  App::_create_help_and_version: Building help
[            clap::build::app]  App::_debug_asserts
[            clap::build::arg]  Arg::_debug_asserts:
thread &#x27;main&#x27; panicked at &#x27;Argument names must be unique, but &#x27;&#x27; is in use by more than one argument or group&#x27;, /home/andi/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.0.0-beta.1/src/build/app/mod.rs:1613:13
note: run with <code>RUST_BACKTRACE=1</code> environment variable to display a backtrace
</code>
</pre></p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by <a href="https://github.com/asteding">@asteding</a> on 2020-06-08 05:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;3.0&quot; by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-06-08 08:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-06-08 08:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">Z: good first issue</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-06-08 08:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/asteding">@asteding</a> on 2020-06-08 10:18</div>
            <div class="timeline-body"><p>After some research it looks like the field <a href="https://github.com/clap-rs/clap/blob/master/src/build/arg/mod.rs#L60">arg.name</a> is always <code>&quot;&quot;</code></p>
<p>So</p>
<pre><code>assert!(
    two_args_of(|x| x.name == arg.name).is_none(),
    &quot;Argument names must be unique, but &#x27;{}&#x27; is in use by more than one argument or group&quot;,
    arg.name,
    );
</code></pre>
<p>returns always a <code>false</code>.</p>
<p>Due to my still little knowledge of Rust i&#x27;d be happy to help and learn.
Would someone provide some information where i should look? Probably I need to investigate</p>
<pre><code>impl&lt;&#x27;help&gt; Arg&lt;&#x27;help&gt; {
    /// @TODO @p2 @docs @v3-beta1: Write Docs
    pub fn new&lt;T: Key + ToString&gt;(t: T) -&gt; Self {
        Arg {
            id: t.into(),
            disp_ord: 999,
            unified_ord: 999,
            ..Default::default()
        }
    }
}
</code></pre>
<p>which is lacking a name field too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-06-08 11:54</div>
            <div class="timeline-body"><p>In the first snippet, the condition must be <code>x.id == arg.id</code>.</p>
<p>Where did you get the second snippet from? I can&#x27;t find it in the codebase.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-06-08 11:56</div>
            <div class="timeline-body"><p>I don&#x27;t get it. Our tests should be failing if the condition is wrong.</p>
<p>On Mon, Jun 8, 2020, 13:55 CreepySkeleton <a href="mailto:notifications@github.com">notifications@github.com</a> wrote:</p>
<blockquote>
<p>In the first snippet, the condition must be x.id == arg.id.</p>
<p>Where did you get the second snippet from? I can&#x27;t find it in the codebase.</p>
<p>â€”
You are receiving this because you are subscribed to this thread.
Reply to this email directly, view it on GitHub
<a href="https://github.com/clap-rs/clap/issues/1965#issuecomment-640557191">clap-rs/clap#1965</a>, or
unsubscribe
<a href="https://github.com/notifications/unsubscribe-auth/AABKU356EBAPR4DDAIDJSZ3RVTGSDANCNFSM4NX7WYWA">https://github.com/notifications/unsubscribe-auth/AABKU356EBAPR4DDAIDJSZ3RVTGSDANCNFSM4NX7WYWA</a>
.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/asteding">@asteding</a> on 2020-06-08 11:58</div>
            <div class="timeline-body"><p>Hello @CreepySkeleton ,
it&#x27;s from <a href="https://github.com/clap-rs/clap/blob/v3.0.0-beta.1/src/build/arg/mod.rs#L137">here</a>
It also looks like it&#x27;s already fixed on the master branch?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-06-08 12:04</div>
            <div class="timeline-body"><p>Ah, yes. There used to be <code>Arg::new</code> method different from <code>with_name</code>.  We eventually decided to ditch the old <code>new</code> and just rename <code>with_name</code> to <code>new</code>. it happened after  the <code>beta</code> release.</p>
<p>This is fixed in master. The condition must be fixed though - it&#x27;s not <em>wrong</em>, but it would be &quot;more correct&quot; to check <code>id</code>. We would appreciate such PR!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/asteding">@asteding</a> on 2020-06-08 12:10</div>
            <div class="timeline-body"><p>Alright.
Thanks for the feedback.
I&#x27;ll set up a PR if nobody minds? :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#1966</a> on 2020-06-08 12:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/asteding">@asteding</a> on 2020-06-09 05:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:57:49 UTC
    </footer>
</body>
</html>
