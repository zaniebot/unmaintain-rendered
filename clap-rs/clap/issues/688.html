<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unexpected help text formatting with possible_values and default_value functions - clap-rs/clap #688</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Unexpected help text formatting with possible_values and default_value functions</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/688">#688</a>
        opened by <a href="https://github.com/volks73">@volks73</a>
        on 2016-10-15 13:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/volks73">@volks73</a> on 2016-10-15 13:41</div>
            <div class="timeline-body"><p>I believe I have found an issue with the automatic formatting for an option using the <code>possible_values</code> function.</p>
<p>If the following code is used:</p>
<pre><code class="language-Rust">let filter_values = [&quot;Nearest&quot;, &quot;Linear&quot;, &quot;Cubic&quot;, &quot;Gaussian&quot;, &quot;Lanczos3&quot;];

let matches = App::new(&quot;example&quot;)
    .arg(Arg::with_name(&quot;filter&quot;)
        .help(&quot;Sets the filter, or sampling method, to use for interpolation when resizing the particle images. The default is Linear (Bilinear).&quot;)
        .long(&quot;filter&quot;)
        .possible_values(&amp;filter_values)
        .takes_value(true)
)

// Rest of code
</code></pre>
<p>The following output is created for the help text:</p>
<pre><code class="language-text"> --filter &lt;filter&gt;
            Sets the filter, or sampling method, to use for interpolation when resizing the particle images. The default is Linear
            (Bilinear). [values: Nearest, Linear, Cubic, Gaussian, Lanczos3]
</code></pre>
<p>A new line appears to be inserted and the indention is off. This might be the intended behavior as it looks like the code is attempting to keep the possible values list on the same line. If the following code is used instead, i.e. manually create the bracketed list of possible values and turn off the automatic generation with the <code>hide_possible_values</code> function:</p>
<pre><code class="language-Rust">let filter_values = [&quot;Nearest&quot;, &quot;Linear&quot;, &quot;Cubic&quot;, &quot;Gaussian&quot;, &quot;Lanczos3&quot;];

let matches = App::new(&quot;example&quot;)
    .arg(Arg::with_name(&quot;filter&quot;)
        .help(&quot;Sets the filter, or sampling method, to use for interpolation when resizing the particle images. The default is Linear (Bilinear). [values: Nearest, Linear, Cubic, Gaussian, Lanczos3]&quot;)
        .long(&quot;filter&quot;)
        .possible_values(&amp;filter_values)
        .hide_possible_values(true)
        .takes_value(true)
)

// Rest of code
</code></pre>
<p>The following output is created for the help text:</p>
<pre><code class="language-text">--filter &lt;filter&gt;                    Sets the filter, or sampling method, to use for interpolation when resizing the particle
                                     images. The default is Linear (Bilinear). [values: Nearest, Linear, Cubic, Gaussian, and
                                     Lanczos3]
</code></pre>
<p>The help text is properly wrapped and on the same line as the option description. Note, I have omitted the rest of the help text and code in the examples for clarity, but the rest of the help text is causing the relatively large gap between the option description and the help text and it is expected.</p>
<p>This is in Terminal.app on Mac OSX El Captian with a MacBookPro Retina. I have not confirmed it for other systems, but I believe I saw a similar behavior on a Windows machine. It is not a huge issue as the workaround can be setting the values manually and turning off automatic generation as in the second example, but the same problem also appears to occur with the <code>default_value</code> function and there is no <code>hide_default_value</code> function equivalent to the <code>hide_possible_values</code> function.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-10-16 03:08</div>
            <div class="timeline-body"><p>Thanks for putting in all these details!</p>
<p>What width is your terminal? And was the terminal the same width/size for both of the above tests?</p>
<p>I'm asking because clap automatically does some calculations with terminal width, and decides if the help message is too long for the current line, or would wrap &quot;too much&quot; and therefore adds a newline and indents just past the flags/options (a la, something like <code>git</code> help message styles, or other long form help messages).</p>
<p>This could also be a bug you found; in that clap is doing the math differently if possible values are hidden or not (shouldn't be the case, and would be a bug).</p>
<p>I don't want to tag with the bug label until it's confirmed :wink:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> added by @kbknapp on 2016-10-16 03:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-10-16 03:11</div>
            <div class="timeline-body"><p>Also, some of the math that goes into determining when to wrap and indent like this is determined by the length of the longest flag/option in comparison with your terminal width, so it may be helpful to see the wrest of the help message.</p>
<p>Another thing you could try, and might provide even better info is to compile clap with the <code>debug</code> feature, then past the output here.</p>
<p>i.e.</p>
<pre><code class="language-toml">[dependencies]
clap = {version = &quot;2.14.0&quot;, features = [&quot;debug&quot;]}
</code></pre>
<p>Then past the output when running <code>$ program --help</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/volks73">@volks73</a> on 2016-10-16 13:48</div>
            <div class="timeline-body"><p>The previous examples were run in Terminal.app in fullscreen mode with 141 columns and 36 lines (based on output from the <code>tput cols</code> and <code>tput lines</code> commands). Both examples were run with this terminal configuration.</p>
<p>I have turned on debugging, compiled the application and clap, and attached the output for both conditions. The <code>possible-values-shown.txt</code> file is the output when the help text is on the new line and indented from the option. The <code>possible-values-hidden.txt</code> is the output when the possible values are hidden with the <code>hide_possible_values</code> function but the possible values are added manually to the help text. The same terminal size (141x36) is used for both outputs and the full help text is included at the end.</p>
<p><a href="https://github.com/kbknapp/clap-rs/files/531850/possible-values-hidden.txt">possible-values-hidden.txt</a>
<a href="https://github.com/kbknapp/clap-rs/files/531851/possible-values-shown.txt">possible-values-shown.txt</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "2.14.1" by @kbknapp on 2016-10-18 14:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @kbknapp on 2016-10-18 14:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> added by @kbknapp on 2016-10-18 14:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: help message</span> added by @kbknapp on 2016-10-18 14:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @kbknapp on 2016-10-18 14:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> removed by @kbknapp on 2016-10-18 14:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/697.html">clap-rs/clap#697</a> on 2016-10-20 02:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-10-20 02:55</div>
            <div class="timeline-body"><p>@volks73 this should be fixed in #697 :wink:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @homu on 2016-10-21 14:09</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:06 UTC
    </footer>
</body>
</html>
