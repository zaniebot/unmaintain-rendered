<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Section headings don't match contents - clap-rs/clap #2785</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Section headings don't match contents</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/2785">#2785</a>
        opened by <a href="https://github.com/stevenengler">@stevenengler</a>
        on 2021-09-24 15:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/stevenengler">@stevenengler</a> on 2021-09-24 15:33</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.55.0 (c8dfcfe04 2021-09-06)</p>
<h3>Clap Version</h3>
<p>master</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">use clap::Clap;

#[derive(Debug, Clone, Clap)]
struct CliOptions {
    #[clap(flatten)]
    options_a: OptionsA,

    #[clap(flatten)]
    options_b: OptionsB,
}

#[derive(Debug, Clone, Clap)]
#[clap(help_heading = &quot;HEADING A&quot;)]
struct OptionsA {
    #[clap(long)]
    should_be_in_section_a: Option&lt;u32&gt;,
}

#[derive(Debug, Clone, Clap)]
#[clap(help_heading = &quot;HEADING B&quot;)]
struct OptionsB {
    #[clap(long)]
    should_be_in_section_b: Option&lt;u32&gt;,
}

fn main() {
    CliOptions::parse();
}
</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<pre><code>cargo run -- --help
</code></pre>
<h3>Actual Behaviour</h3>
<pre><code>clap-failure-example

USAGE:
    clap-failure-example [OPTIONS]

FLAGS:
    -h, --help       Print help information
    -V, --version    Print version information

OPTIONS:
        --should-be-in-section-a &lt;SHOULD_BE_IN_SECTION_A&gt;

HEADING A:
        --should-be-in-section-b &lt;SHOULD_BE_IN_SECTION_B&gt;
</code></pre>
<h3>Expected Behaviour</h3>
<pre><code>clap-failure-example

USAGE:
    clap-failure-example

FLAGS:
    -h, --help       Print help information
    -V, --version    Print version information

HEADING A:
        --should-be-in-section-a &lt;SHOULD_BE_IN_SECTION_A&gt;

HEADING B:
        --should-be-in-section-b &lt;SHOULD_BE_IN_SECTION_B&gt;
</code></pre>
<h3>Additional Context</h3>
<p>This was broken by #2531.</p>
<h3>Debug Output</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @stevenengler on 2021-09-24 15:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-09-24 15:42</div>
            <div class="timeline-body"><p>Thanks for digging into this more than needed. Always appreciate the extra info.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: derive macros</span> added by @pksunkara on 2021-09-24 15:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-09-24 15:42</div>
            <div class="timeline-body"><p>This was broken by #2531.</p>
<p><code>App::help_heading</code> is required to be called before adding args but in #2531, we switched to calling app methods after args.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">:money_with_wings: $10</span> added by @pksunkara on 2021-09-24 15:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by @pksunkara on 2021-09-24 15:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-09-24 15:44</div>
            <div class="timeline-body"><p>My proposal is still the same, we revert #2531 and instead move setting of help/about to <code>into_app</code>.  <code>Args</code> should not be setting these while <code>Clap</code>s should.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @pksunkara on 2021-09-24 15:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-09-24 15:45</div>
            <div class="timeline-body"><p>@pksunkara I wouldn't classify this as easy until we have a decision made on what we want the behavior to be because <code>help_heading</code> is at tension with the doc comment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> removed by @pksunkara on 2021-09-24 15:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">:money_with_wings: $10</span> removed by @pksunkara on 2021-09-24 15:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-09-24 15:48</div>
            <div class="timeline-body"><p>Note: this can be worked around by setting the help heading on each arg.  Not ideal but one way to be unblocked.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-09-24 15:58</div>
            <div class="timeline-body"><p>I think just the first arg in each flattened struct should be enough as a workaround IIRC.</p>
<pre><code class="language-rust">#[derive(Debug, Clone, Clap)]
struct OptionsA {
    #[clap(long)]
    #[clap(help_heading = &quot;HEADING A&quot;)]
    should_be_in_section_a: Option&lt;u32&gt;,
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-09-24 15:59</div>
            <div class="timeline-body"><p>I will leave the decision of 3.0 milestone to you. I am not sure if what you are proposing needs breaking changes or not.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/stevenengler">@stevenengler</a> on 2021-09-24 16:09</div>
            <div class="timeline-body"><p>Thanks for the quick replies!</p>
<blockquote>
<p>I think just the first arg in each flattened struct should be enough as a workaround IIRC.</p>
</blockquote>
<p>It looks like it needs to be set on each individually:</p>
<pre><code class="language-rust">use clap::Clap;

#[derive(Debug, Clone, Clap)]
struct CliOptions {
    #[clap(flatten)]
    options_a: OptionsA,

    #[clap(flatten)]
    options_b: OptionsB,
}

#[derive(Debug, Clone, Clap)]
struct OptionsA {
    #[clap(long)]
    #[clap(help_heading = Some(&quot;HEADING A&quot;))]
    should_be_in_section_a: Option&lt;u32&gt;,

    #[clap(long)]
    should_also_be_in_section_a: Option&lt;u32&gt;,
}

#[derive(Debug, Clone, Clap)]
struct OptionsB {
    #[clap(long)]
    #[clap(help_heading = Some(&quot;HEADING B&quot;))]
    should_be_in_section_b: Option&lt;u32&gt;,

    #[clap(long)]
    should_also_be_in_section_b: Option&lt;u32&gt;,
}

fn main() {
    CliOptions::parse();
}
</code></pre>
<pre><code class="language-text">clap-failure-example

USAGE:
    clap-failure-example [OPTIONS]

FLAGS:
    -h, --help       Print help information
    -V, --version    Print version information

OPTIONS:
        --should-also-be-in-section-a &lt;SHOULD_ALSO_BE_IN_SECTION_A&gt;
        --should-also-be-in-section-b &lt;SHOULD_ALSO_BE_IN_SECTION_B&gt;

HEADING A:
        --should-be-in-section-a &lt;SHOULD_BE_IN_SECTION_A&gt;

HEADING B:
        --should-be-in-section-b &lt;SHOULD_BE_IN_SECTION_B&gt;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-09-24 16:10</div>
            <div class="timeline-body"><blockquote>
<p>I will leave the decision of 3.0 milestone to you. I am not sure if what you are proposing needs breaking changes or not.</p>
</blockquote>
<p>My proposed change would not be an API breakage but a behavior breakage (expectations for what deriving <code>Args</code> does)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-09-24 16:11</div>
            <div class="timeline-body"><blockquote>
<p>It looks like it needs to be set on each:</p>
</blockquote>
<p>Thanks for confirming this.  I was making my assumption based on doc string</p>
<blockquote>
<p>Set a custom heading for this arg to be printed under</p>
</blockquote>
<p>https://docs.rs/clap/3.0.0-beta.4/clap/struct.Arg.html#method.help_heading</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-09-24 17:58</div>
            <div class="timeline-body"><p>Ah, I was confusing that with https://docs.rs/clap/3.0.0-beta.4/clap/struct.App.html#method.help_heading</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2803.html">clap-rs/clap#2803</a> on 2021-10-01 20:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2814.html">clap-rs/clap#2814</a> on 2021-10-05 14:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @epage by @epage on 2021-10-14 02:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2872.html">clap-rs/clap#2872</a> on 2021-10-14 16:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2873.html">clap-rs/clap#2873</a> on 2021-10-14 17:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2882.html">clap-rs/clap#2882</a> on 2021-10-15 14:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @bors[bot] on 2021-10-16 04:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2894.html">clap-rs/clap#2894</a> on 2021-10-16 15:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../shadow/shadow/pulls/1726.html">shadow/shadow#1726</a> on 2021-10-18 03:48</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:33 UTC
    </footer>
</body>
</html>
