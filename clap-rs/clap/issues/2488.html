<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document how to source completions - clap-rs/clap #2488</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Document how to source completions</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/2488">#2488</a>
        opened by <a href="https://github.com/ajeetdsouza">@ajeetdsouza</a>
        on 2021-05-20 05:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ajeetdsouza">@ajeetdsouza</a></div>
            <div class="timeline-body">Please complete the following tasks
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
Clap Version
<p>3.0.0-beta.2</p>
Where?
<p>clap_generate</p>
What&#x27;s wrong?
<p>Currently, clap generates completions without providing any insight into how to actually get them running in the shell.</p>
How to fix?
<p>It would be nice if we could specify (for each shell):</p>
<ol>
<li>How to source the generated completions as a file</li>
<li>How to source the generated completions when printed to stdout</li>
<li>How to add the above to your shell configuration file</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: docs</span> added by <a href="https://github.com/ajeetdsouza">@ajeetdsouza</a> on 2021-05-20 05:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: generator</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-05-20 09:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#2479</a> on 2021-05-21 11:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kidonng">@kidonng</a> on 2021-06-20 16:08</div>
            <div class="timeline-body"><p>I&#x27;d like to give a simple and general description:</p>
<ul>
<li><p>Bash: install <a href="https://github.com/scop/bash-completion">bash-completion</a> (some distros have this by default), then the completions can be sourced</p>
</li>
<li><p>Zsh: the optimal way is to use <code>$fpath</code>, but if one would really like to go the manual way:</p>
<pre><code>autoload -U compinit
compinit
source &lt;(program completions zsh | sed &#x27;$d&#x27;) # can also be `head -n -1` or whatever as long as the last line is removed
compdef _program program
</code></pre>
<p>FWIW, it is <a href="https://github.com/starship/starship/issues/2806#issuecomment-864568502">said</a> that completions generated by <a href="https://github.com/spf13/cobra">cobra</a> (clap counterpart in Go) can be directly sourced (i.e. no need to strip the last line), may worth looking into</p>
</li>
<li><p>Fish: directly source-able ðŸŽ‰</p>
</li>
</ul>
<p>I don&#x27;t have much experience with other shells so additions welcome.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nicholastmosher">@nicholastmosher</a> on 2021-07-03 17:22</div>
            <div class="timeline-body"><p>Hmm, that makes me wonder if there wouldn&#x27;t be any reason not to update the output of <code>program completions zsh</code> to just include the autoload and compdef commands. It&#x27;d be nice to just be able to do</p>
<pre><code>source &lt;(program completions zsh)
</code></pre>
<p>Where <code>program completions zsh</code> would just look like</p>
<pre><code>autoload -U compinit
compinit
&lt;old content of &#x27;program completions zsh&#x27;&gt;
compdef _program program
</code></pre>
<p>One could certainly do that at the app-level, but is there no reason to build that directly into the completions output of clap?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kidonng">@kidonng</a> on 2021-07-04 05:36</div>
            <div class="timeline-body"><p>@nicholastmosher I can&#x27;t say for sure, but I think generally clap completions are generated at <em>packaging time</em>. That is to say, when you install a program from the package manager, it comes with the completions placed at the suitable location so shells will pick them up automatically. Manually sourcing the completions is not the usual way people use it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nicholastmosher">@nicholastmosher</a> on 2021-07-06 13:44</div>
            <div class="timeline-body"><p>Ah I see. I was taking inspiration from the oh-my-zsh <code>kubectl</code> completions plugin: https://github.com/ohmyzsh/ohmyzsh/blob/master/plugins/kubectl/kubectl.plugin.zsh#L1-L11, though it seems like that is more geared towards dynamic completions like described in <a href="https://github.com/clap-rs/clap/issues/1232">clap-rs/clap#1232</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>epage/clapng#187</a> on 2021-12-06 21:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-easy</span> added by <a href="https://github.com/epage">@epage</a> on 2021-12-13 16:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by <a href="https://github.com/epage">@epage</a> on 2021-12-13 16:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gakonst">@gakonst</a> on 2021-12-22 02:10</div>
            <div class="timeline-body"><p>For me I had to do 2 things to get it working with ZSH 5.8 (<code>program</code> is your command&#x27;s name):</p>
<ol>
<li>Remove the last line (<code>program &quot;$@&quot;</code>)</li>
<li>Replace the first line from <code>#compdef program</code> to <code>#compdef _program program</code></li>
</ol>
<p>Unsure why this is not happening by default, is this a bug?</p>
<p>Also, if there&#x27;s any backticks in any help message, the shell tries to interpret it due to shell expansion, suspect it&#x27;s related to <a href="https://github.com/clap-rs/clap/issues/1596">clap-rs/clap#1596</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>TeXitoi/structopt#461</a> on 2021-12-22 02:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>jj-vcs/jj#67</a> on 2022-02-20 21:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>starship/starship#2806</a> on 2023-01-22 07:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>jstz-dev/jstz#382</a> on 2024-02-08 14:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#3166</a> on 2024-07-05 14:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#5586</a> on 2024-07-17 14:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-07-19 14:30</div>
            <div class="timeline-body"><p>The <code>feature=unstable-dynamic</code> completions now have documentation on how to source them, see #5586.</p>
<p>I&#x27;m inclined to consider this closed but would be open to input from others on if there is concern over that vs the current code-generated completions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-08-10 00:38</div>
            <div class="timeline-body"><p>As this was resolved for dynamic completions in #5586, I&#x27;m going to go ahead and close this.</p>
<p>To track stabilization, see #3166</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/epage">@epage</a> on 2024-08-10 00:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#6086</a> on 2025-08-04 17:48</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:58:07 UTC
    </footer>
</body>
</html>
