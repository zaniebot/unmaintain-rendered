<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`takes_value()` parameters with `default_value()` are shown in USAGE like mandatory - clap-rs/clap #1140</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`takes_value()` parameters with `default_value()` are shown in USAGE like mandatory</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/1140">#1140</a>
        opened by <a href="https://github.com/albel727">@albel727</a>
        on 2018-01-05 22:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/albel727">@albel727</a> on 2018-01-05 22:04</div>
            <div class="timeline-body"><h3>Affected Version of clap</h3>
<p>clap 2.29.0</p>
<h3>Expected Behavior Summary</h3>
<p>When command line parsing fails, a USAGE section is shown. This usage section should NOT contain non-required parameters with default values. Suppose there are two parameters, &quot;required&quot; and &quot;defaulted&quot;, and the user didn't specify the required one. The output should be as follows</p>
<pre><code>error: The following required arguments were not provided:
    &lt;required&gt;

USAGE:
    prog [OPTIONS] &lt;required&gt;

For more information try --help
</code></pre>
<h3>Actual Behavior Summary</h3>
<p>Defaulted option parameters are mentioned in parse error help for no particular reason, confusingly looking like they're mandatory, even if they're <code>required(false)</code>.</p>
<pre><code>error: The following required arguments were not provided:
    &lt;required&gt;

USAGE:
    prog &lt;required&gt; --defaulted &lt;defaulted&gt;

For more information try --help
</code></pre>
<h3>Steps to Reproduce the issue</h3>
<p>Utilize the following code. Note that if one comments out &quot;.default_value()&quot;, the parse error no longer contains the mention of the defaulted parameter, as expected.</p>
<h3>Sample Code or Link to Sample Code</h3>
<pre><code class="language-rust">    App::new(&quot;Test&quot;)
        .arg(
            Arg::with_name(&quot;required&quot;)
                .required(true)
        )
        .arg(
            Arg::with_name(&quot;defaulted&quot;)
                .takes_value(true)
                .short(&quot;d&quot;)
                .long(&quot;defaulted&quot;)
                .default_value(&quot;1&quot;)
        ).get_matches();
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`takes_value()` parameters with `default_value()` are shown in USAGE like required" to "`takes_value()` parameters with `default_value()` are shown in USAGE like mandatory" by @albel727 on 2018-01-05 22:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/albel727">@albel727</a> on 2018-01-05 22:28</div>
            <div class="timeline-body"><p>It's particularly annoying that this shadows all other flags. So</p>
<pre><code class="language-rust">    App::new(&quot;Test&quot;)
        .arg(
            Arg::with_name(&quot;required&quot;)
                .required(true)
        )
        .arg(
            Arg::with_name(&quot;defaulted&quot;)
                .takes_value(true)
                .short(&quot;d&quot;)
                .long(&quot;defaulted&quot;)
                .default_value(&quot;1&quot;)
        )
        .arg(
            Arg::with_name(&quot;another&quot;)
        )
        .get_matches_from(vec![&quot;prog&quot;]);
</code></pre>
<p>produces</p>
<pre><code>USAGE:
    prog &lt;required&gt; --defaulted &lt;defaulted&gt;
</code></pre>
<p>instead of</p>
<pre><code>USAGE:
    prog [OPTIONS] &lt;required&gt; [another]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-01-09 18:08</div>
            <div class="timeline-body"><p>The error messages show &quot;used arguments&quot; i.e. &quot;this possibly what the command you just tried running <em>should</em> have been run&quot;</p>
<p>But yes, defaults get thrown in there too. I can do some work to remove default values from error messages. This wouldn't however &quot;turn off&quot; the shadowing. With that fix</p>
<pre><code>$ prog another
error: missing required [..snip]

USAGE:
    prog &lt;required&gt; --defaulted &lt;defaulted&gt; [another]
</code></pre>
<p>Would become</p>
<pre><code>$ prog another
error: missing required [..snip]

USAGE:
    prog &lt;required&gt; [another]
</code></pre>
<p>I'm open to adding an option to <em>turn off</em> this &quot;smart usage&quot; so that the error would become just the default:</p>
<pre><code>$ prog another
error: missing required [..snip]

USAGE:
    prog [FLAGS] [OPTIONS] &lt;required&gt;
</code></pre>
<p>(you can already <em>kind of</em> do this <a href="https://docs.rs/clap/2.29.0/clap/struct.App.html#method.usage">by just supplying your own usage string</a>, which will get used no matter what.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-01-09 18:08</div>
            <div class="timeline-body"><p>If someone wants to add this setting to disable the &quot;smart usage&quot; I'd be happy to mentor it. Removing the defaults from the usage string is probably more complicated than just adding this setting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/albel727">@albel727</a> on 2018-01-10 20:33</div>
            <div class="timeline-body"><p>I see. I'll consider the possible ways to proceed from here, after I take a look at the clap sources when I'm done with other things. For the time being, I have another alternative to posit.</p>
<p>How hard would it be to, at least, make the defaulted but non-required arguments be printed in square brackets, so as to convey their non-mandatory nature? I.e. something like</p>
<pre><code>USAGE:
    prog &lt;required&gt; [--defaulted &lt;defaulted&gt;] [another]
</code></pre>
<p>Or do you think that this would violate user's expectations, making them believe that they have to put &quot;--defaulted&quot; in square brackets in order to use it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-01-15 19:36</div>
            <div class="timeline-body"><blockquote>
<p>I.e. something like</p>
</blockquote>
<p>It would be fine, but almost as much work as simply not printing the defaults (which is a <em>slightly</em> better solution IMO).</p>
<p><a href="https://github.com/kbknapp/clap-rs/blob/e078a5893b9cdc367fe1621d529dfbbcc93a9095/src/app/usage.rs#L22-L45">In the source</a> for either of these two fixes, when clap is printing the usage string, it doesn't know if something is a default value or not, it just sees an argument was used (used by user, or used by default). So it would require re-looping through the used arguments to see if they have a default, and if so if the value that was used was in fact the default.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: enhancement</span> added by @kbknapp on 2018-07-22 03:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> added by @kbknapp on 2018-07-22 03:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: hard</span> added by @kbknapp on 2018-07-22 03:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by @kbknapp on 2018-07-22 03:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: usage strings</span> added by @kbknapp on 2018-07-22 03:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../arusahni/git-req/pulls/41.html">arusahni/git-req#41</a> on 2019-12-30 01:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @pksunkara on 2020-04-09 07:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> removed by @pksunkara on 2021-08-13 10:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/86.html">epage/clapng#86</a> on 2021-12-06 16:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-08 20:03</div>
            <div class="timeline-body"><p>In some ways, this reminds me of #3076</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-help</span> added by @epage on 2021-12-08 20:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: usage strings</span> removed by @epage on 2021-12-08 20:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> removed by @epage on 2021-12-09 18:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-hard</span> removed by @epage on 2021-12-09 18:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.1" by @epage on 2021-12-09 18:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-medium</span> added by @epage on 2021-12-09 18:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.x" by @epage on 2022-01-04 13:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.x" by @epage on 2022-02-02 19:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @epage on 2022-02-02 19:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-02-08 18:39</div>
            <div class="timeline-body"><p>This was fixed by https://github.com/clap-rs/clap/pull/2609</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2022-02-08 18:39</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:07 UTC
    </footer>
</body>
</html>
