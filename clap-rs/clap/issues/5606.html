<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hyphens missing from listItemText in generated PowerShell autocomplete scripts - clap-rs/clap #5606</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Hyphens missing from listItemText in generated PowerShell autocomplete scripts</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/5606">#5606</a>
        opened by <a href="https://github.com/Mixu78">@Mixu78</a>
        on 2024-07-29 19:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Mixu78">@Mixu78</a></div>
            <div class="timeline-body">Please complete the following tasks
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
Rust Version
<p>rustc 1.80.0 (051478957 2024-07-21)</p>
Clap Version
<p>4.5.11</p>
Minimal reproducible code
<pre><code>use std::io;

use clap::{Arg, Command};
use clap_complete::{generate, Shell};

fn main() {

    let mut cmd = Command::new(&quot;dummy&quot;)
        .arg(Arg::new(&quot;foo&quot;).long(&quot;foo&quot;))
        .subcommand(Command::new(&quot;foo&quot;));

    generate(Shell::PowerShell, &amp;mut cmd, &quot;dummy&quot;, &amp;mut io::stdout());
}
</code></pre>
Steps to reproduce the bug with the above code
<pre><code>cargo run
</code></pre>
<p>or to source the script:</p>
<pre><code>Invoke-Expression (cargo run | Out-String)
</code></pre>
Actual Behaviour
<p>The generated completion script is missing hyphens in the <code>CompletionResult::new</code> <code>listItemText</code> parameter for all options. This is at best confusing, leading to options being listed without their hyphens when attempting to complete them, and at worst causes collisions making it impossible to complete a subcommand with the same name as an option without first typing a character. Completion scripts for other shells seem to include hyphens correctly.</p>
<p>A snippet of the completion script generated by the reproduction code:</p>
<pre><code>&#x27;dummy&#x27; {
            [CompletionResult]::new(&#x27;--foo&#x27;, &#x27;foo&#x27;, [CompletionResultType]::ParameterName, &#x27;foo&#x27;)
            [CompletionResult]::new(&#x27;-h&#x27;, &#x27;h&#x27;, [CompletionResultType]::ParameterName, &#x27;Print help&#x27;)
            [CompletionResult]::new(&#x27;--help&#x27;, &#x27;help&#x27;, [CompletionResultType]::ParameterName, &#x27;Print help&#x27;)
            [CompletionResult]::new(&#x27;foo&#x27;, &#x27;foo&#x27;, [CompletionResultType]::ParameterValue, &#x27;foo&#x27;)
            [CompletionResult]::new(&#x27;help&#x27;, &#x27;help&#x27;, [CompletionResultType]::ParameterValue, &#x27;Print this message or the help of the given subcommand(s)&#x27;)     
            break
        }
</code></pre>
<p>In the snippet above the missing hyphens cause option <code>--foo</code> and subcommand <code>foo</code> to collide. The option <code>--foo</code> is displayed as &quot;foo&quot; when completing with no input other than the command, with the subcommand <code>foo</code> being uncompletable. <code>foo</code> is correctly completed only when at least the first letter has been typed.</p>
Expected Behaviour
<p>The generated completion script should have hyphens in both the <code>completionText</code> and <code>listItemText</code> parameters in the <code>CompletionResult</code> constructor call:</p>
<pre><code>&#x27;dummy&#x27; {
            [CompletionResult]::new(&#x27;--foo&#x27;, &#x27;--foo&#x27;, [CompletionResultType]::ParameterName, &#x27;foo&#x27;)
            [CompletionResult]::new(&#x27;-h&#x27;, &#x27;-h&#x27;, [CompletionResultType]::ParameterName, &#x27;Print help&#x27;)
            [CompletionResult]::new(&#x27;--help&#x27;, &#x27;--help&#x27;, [CompletionResultType]::ParameterName, &#x27;Print help&#x27;)
            [CompletionResult]::new(&#x27;foo&#x27;, &#x27;foo&#x27;, [CompletionResultType]::ParameterValue, &#x27;foo&#x27;)
            [CompletionResult]::new(&#x27;help&#x27;, &#x27;help&#x27;, [CompletionResultType]::ParameterValue, &#x27;Print this message or the help of the given subcommand(s)&#x27;)     
            break
        }
</code></pre>
Additional Context
<p>Lines 134 and 145 in <a href="https://github.com/clap-rs/clap/blob/16fba4b9f91cf772ab1f6e7b1016a257e5f6cf62/clap_complete/src/shells/powershell.rs"><code>clap_complete/src/shells/powershell.rs</code></a> seem to be causing this.</p>
Debug Output
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by <a href="https://github.com/Mixu78">@Mixu78</a> on 2024-07-29 19:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-completion</span> added by <a href="https://github.com/epage">@epage</a> on 2024-07-29 19:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-easy</span> added by <a href="https://github.com/epage">@epage</a> on 2024-07-29 19:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#5610</a> on 2024-07-31 11:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/epage">@epage</a> on 2024-08-10 00:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 20:00:15 UTC
    </footer>
</body>
</html>
