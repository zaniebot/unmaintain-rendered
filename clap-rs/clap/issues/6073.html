<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add some test cases for Command aliases - clap-rs/clap #6073</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add some test cases for Command aliases</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/6073">#6073</a>
        opened by <a href="https://github.com/GilShoshan94">@GilShoshan94</a>
        on 2025-07-21 20:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/GilShoshan94">@GilShoshan94</a></div>
            <div class="timeline-body"><p>Hi,
The tests for aliases (of arguments and subcommands) are distributed between several files:</p>
<p>For Arg:
-tests/builder/arg_aliases_short.rs
-tests/builder/arg_aliases.rs
It covers well everything I think regarding aliases.</p>
<p>For Command (on the subcommand):
-tests/builder/flag_subcommands.rs
-tests/builder/subcommands.rs
It does not 100% fully cover in my opinion as <strong>it is missing the following cases:</strong></p>
<p><a href="https://docs.rs/clap/4.5.41/clap/struct.Command.html#method.visible_aliases">visible_aliases</a> (but visible_alias is tested, but only to match the help, not tested with a try_get_matches_from)
<a href="https://docs.rs/clap/4.5.41/clap/struct.Command.html#method.visible_short_flag_alias">visible_short_flag_alias</a> (but visible_short_flag_aliases is properly tested)
<a href="https://docs.rs/clap/4.5.41/clap/struct.Command.html#method.visible_long_flag_alias">visible_long_flag_alias</a> (but visible_long_flag_aliases is properly tested)</p>
<hr />
<p><strong>Either we should add the few missing case, or we should maybe consolidate all the aliases cases into one place</strong> (expect for the help that are fully covered in <code>tests/builder/help.rs</code>).</p>
<hr />
<p>Here a code for inspiration that covers all the aliases and check for matching.</p>
<pre><code class="language-rust">use clap::{Arg, Command};

fn setup_aliases() -&gt; Command {
    Command::new(&quot;ctest&quot;)
        .version(&quot;0.1&quot;)
        .arg(
            Arg::new(&quot;dest&quot;)
                .short('d')
                .long(&quot;destination&quot;)
                .value_name(&quot;FILE&quot;)
                .help(&quot;File to save into&quot;)
                .long_help(&quot;The Filepath to save into the result&quot;)
                .short_alias('q')
                .short_aliases(['w', 'e'])
                .alias(&quot;arg-alias&quot;)
                .aliases([&quot;do-stuff&quot;, &quot;do-tests&quot;])
                .visible_short_alias('t')
                .visible_short_aliases(['i', 'o'])
                .visible_alias(&quot;file&quot;)
                .visible_aliases([&quot;into&quot;, &quot;to&quot;])
                .action(ArgAction::Set),
        )
        .subcommand(
            Command::new(&quot;rev&quot;)
                .short_flag('r')
                .long_flag(&quot;inplace&quot;)
                .about(&quot;In place&quot;)
                .long_about(&quot;Change mode to work in place on source&quot;)
                .alias(&quot;subc-alias&quot;)
                .aliases([&quot;subc-do-stuff&quot;, &quot;subc-do-tests&quot;])
                .short_flag_alias('j')
                .short_flag_aliases(['k', 'l'])
                .long_flag_alias(&quot;subc-long-flag-alias&quot;)
                .long_flag_aliases([&quot;subc-long-do-stuff&quot;, &quot;subc-long-do-tests&quot;])
                .visible_alias(&quot;source&quot;)
                .visible_aliases([&quot;from&quot;, &quot;onsource&quot;])
                .visible_short_flag_alias('s')
                .visible_short_flag_aliases(['f', 'g'])
                .visible_long_flag_alias(&quot;origin&quot;)
                .visible_long_flag_aliases([&quot;path&quot;, &quot;tryfrom&quot;])
                .arg(
                    Arg::new(&quot;input&quot;)
                        .value_name(&quot;INPUT&quot;)
                        .help(&quot;The source file&quot;),
                ),
        )
}

#[test]
fn all_aliases_work() {
    let app = setup_aliases();

    for arg_al in [
        &quot;-d&quot;,
        &quot;--destination&quot;,
        &quot;-q&quot;,
        &quot;-w&quot;,
        &quot;-e&quot;,
        &quot;--arg-alias&quot;,
        &quot;--do-stuff&quot;,
        &quot;--do-tests&quot;,
        &quot;-t&quot;,
        &quot;-i&quot;,
        &quot;-o&quot;,
        &quot;--file&quot;,
        &quot;--into&quot;,
        &quot;--to&quot;,
    ] {
        let m = app
            .clone()
            .try_get_matches_from(vec![&quot;ctest&quot;, arg_al, &quot;filepath&quot;]);
        assert!(m.is_ok(), &quot;{}&quot;, m.unwrap_err());
        let m = m.unwrap();
        assert!(m.subcommand_name().is_none());
    }

    for subc_al in [
        &quot;rev&quot;,
        &quot;-r&quot;,
        &quot;--inplace&quot;,
        &quot;subc-alias&quot;,
        &quot;subc-do-stuff&quot;,
        &quot;subc-do-tests&quot;,
        &quot;-j&quot;,
        &quot;-k&quot;,
        &quot;-l&quot;,
        &quot;--subc-long-flag-alias&quot;,
        &quot;--subc-long-do-tests&quot;,
        &quot;source&quot;,
        &quot;from&quot;,
        &quot;onsource&quot;,
        &quot;-s&quot;,
        &quot;-f&quot;,
        &quot;-g&quot;,
        &quot;--origin&quot;,
        &quot;--path&quot;,
        &quot;--tryfrom&quot;,
    ] {
        let m = app
            .clone()
            .try_get_matches_from(vec![&quot;ctest&quot;, subc_al, &quot;filepath&quot;]);
        assert!(m.is_ok(), &quot;{}&quot;, m.unwrap_err());
        let m = m.unwrap();
        assert!(m.subcommand_name().is_some());
    }
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/6068.html">clap-rs/clap#6068</a> on 2025-07-21 21:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/GilShoshan94">@GilShoshan94</a> on 2025-07-21 21:30</div>
            <div class="timeline-body"><p>Closed by https://github.com/clap-rs/clap/pull/6068</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2025-07-30 02:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:49:37 UTC
    </footer>
</body>
</html>
