<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fish completion fails with nested subcommands - clap-rs/clap #685</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>fish completion fails with nested subcommands</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/685">#685</a>
        opened by <a href="https://github.com/emk">@emk</a>
        on 2016-10-10 15:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/emk">@emk</a></div>
            <div class="timeline-body"><p><a href="https://github.com/faradayio/cage">cage</a> has nested subcommands:</p>
<pre><code>&gt; cage repo 
cage repo 
cage-repo 
Commands for working with git repositories

USAGE:
    cage repo [SUBCOMMAND]

FLAGS:
    -h, --help    Prints help information

SUBCOMMANDS:
    clone    Clone a git repository using its short alias and mount it
             into the containers that use it
    help     Prints this message or the help of the given subcommand(s)
    list     List all known git repository aliases and URLs
</code></pre>
<p>The top-level subcommands complete fine under fish:</p>
<pre><code class="language-sh">&gt; cage rep&lt;TAB&gt;
&gt; cage repo
</code></pre>
<p>But second-level subcommands fail:</p>
<pre><code class="language-sh">&gt; cage repo l&lt;TAB&gt;
...lists files in current directory...
</code></pre>
<p>Using the generated bash completion, this works correctly:</p>
<pre><code class="language-sh">&gt; cage repo l&lt;TAB&gt;
&gt; cage repo list
</code></pre>
<p>I don't have time to dig into this right now, but I hope that because it already works with one shell, it's just a simple fix for the other.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-10-10 17:35</div>
            <div class="timeline-body"><p>Thanks for fiiling this! I'll start looking into it and report back with what I find.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @kbknapp on 2016-10-10 17:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> added by @kbknapp on 2016-10-10 17:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @kbknapp on 2016-10-10 17:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: completion gen</span> added by @kbknapp on 2016-10-10 17:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-10-10 17:40</div>
            <div class="timeline-body"><p>cc @wdv4758h</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wdv4758h">@wdv4758h</a> on 2016-10-15 01:19</div>
            <div class="timeline-body"><p>I can try to fix it, but the progress may be slow, since I'm fulfilling my country's mandatory military service.
I don't have much time to write code until next year. :(</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/687.html">clap-rs/clap#687</a> on 2016-10-15 09:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wdv4758h">@wdv4758h</a> on 2016-10-15 09:56</div>
            <div class="timeline-body"><p>I have fixed it!</p>
<p>@emk here is the new result for <a href="https://github.com/faradayio/cage">cage</a>'s <code>cli.yml</code>, please try it.</p>
<pre><code>function __fish_using_command
    set cmd (commandline -opc)
    if [ (count $cmd) -eq (count $argv) ]
        for i in (seq (count $argv))
            if [ $cmd[$i] != $argv[$i] ]
                return 1
            end
        end
        return 0
    end
    return 1
end

complete -c cage -n '__fish_using_command cage' -s p -l project-name -d 'The name of this project.  Defaults to the current directory name.'
complete -c cage -n '__fish_using_command cage' -l override -d 'Use overrides from the specified subdirectory of `pods/overrides`.  Defaults to `development` unless running tests.'
complete -c cage -n '__fish_using_command cage' -l default-tags -d 'A list of tagged image names, one per line, to be used as defaults for images.'
complete -c cage -n '__fish_using_command cage' -s h -l help -d 'Prints help information'
complete -c cage -n '__fish_using_command cage' -s V -l version -d 'Prints version information'
complete -c cage -n '__fish_using_command cage' -f -a 'sysinfo'
complete -c cage -n '__fish_using_command cage' -f -a 'new'
complete -c cage -n '__fish_using_command cage' -f -a 'build'
complete -c cage -n '__fish_using_command cage' -f -a 'pull'
complete -c cage -n '__fish_using_command cage' -f -a 'up'
complete -c cage -n '__fish_using_command cage' -f -a 'stop'
complete -c cage -n '__fish_using_command cage' -f -a 'run'
complete -c cage -n '__fish_using_command cage' -f -a 'exec'
complete -c cage -n '__fish_using_command cage' -f -a 'shell'
complete -c cage -n '__fish_using_command cage' -f -a 'test'
complete -c cage -n '__fish_using_command cage' -f -a 'repo'
complete -c cage -n '__fish_using_command cage' -f -a 'generate'
complete -c cage -n '__fish_using_command cage' -f -a 'export'
complete -c cage -n '__fish_using_command cage' -f -a 'help'
complete -c cage -n '__fish_using_command cage sysinfo' -s h -l help -d 'Prints help information'
complete -c cage -n '__fish_using_command cage sysinfo' -s V -l version -d 'Prints version information'
complete -c cage -n '__fish_using_command cage new' -s h -l help -d 'Prints help information'
complete -c cage -n '__fish_using_command cage new' -s V -l version -d 'Prints version information'
complete -c cage -n '__fish_using_command cage build' -s h -l help -d 'Prints help information'
complete -c cage -n '__fish_using_command cage build' -s V -l version -d 'Prints version information'
complete -c cage -n '__fish_using_command cage pull' -s h -l help -d 'Prints help information'
complete -c cage -n '__fish_using_command cage pull' -s V -l version -d 'Prints version information'
complete -c cage -n '__fish_using_command cage up' -s h -l help -d 'Prints help information'
complete -c cage -n '__fish_using_command cage up' -s V -l version -d 'Prints version information'
complete -c cage -n '__fish_using_command cage stop' -s h -l help -d 'Prints help information'
complete -c cage -n '__fish_using_command cage stop' -s V -l version -d 'Prints version information'
complete -c cage -n '__fish_using_command cage run' -l user -d 'User as which to run a command'
complete -c cage -n '__fish_using_command cage run' -l entrypoint -d 'Override the entrypoint of the service'
complete -c cage -n '__fish_using_command cage run' -s e -d 'Set an environment variable in the container'
complete -c cage -n '__fish_using_command cage run' -s d -d 'Run command detached in background'
complete -c cage -n '__fish_using_command cage run' -s T -d 'Do not allocate a TTY when running a command'
complete -c cage -n '__fish_using_command cage run' -s h -l help -d 'Prints help information'
complete -c cage -n '__fish_using_command cage run' -s V -l version -d 'Prints version information'
complete -c cage -n '__fish_using_command cage exec' -l user -d 'User as which to run a command'
complete -c cage -n '__fish_using_command cage exec' -s d -d 'Run command detached in background'
complete -c cage -n '__fish_using_command cage exec' -s T -d 'Do not allocate a TTY when running a command'
complete -c cage -n '__fish_using_command cage exec' -l privileged -d 'Run a command with elevated privileges'
complete -c cage -n '__fish_using_command cage exec' -s h -l help -d 'Prints help information'
complete -c cage -n '__fish_using_command cage exec' -s V -l version -d 'Prints version information'
complete -c cage -n '__fish_using_command cage shell' -l user -d 'User as which to run a command'
complete -c cage -n '__fish_using_command cage shell' -s d -d 'Run command detached in background'
complete -c cage -n '__fish_using_command cage shell' -s T -d 'Do not allocate a TTY when running a command'
complete -c cage -n '__fish_using_command cage shell' -l privileged -d 'Run a command with elevated privileges'
complete -c cage -n '__fish_using_command cage shell' -s h -l help -d 'Prints help information'
complete -c cage -n '__fish_using_command cage shell' -s V -l version -d 'Prints version information'
complete -c cage -n '__fish_using_command cage test' -l user -d 'User as which to run a command'
complete -c cage -n '__fish_using_command cage test' -l entrypoint -d 'Override the entrypoint of the service'
complete -c cage -n '__fish_using_command cage test' -s e -d 'Set an environment variable in the container'
complete -c cage -n '__fish_using_command cage test' -s d -d 'Run command detached in background'
complete -c cage -n '__fish_using_command cage test' -s T -d 'Do not allocate a TTY when running a command'
complete -c cage -n '__fish_using_command cage test' -s h -l help -d 'Prints help information'
complete -c cage -n '__fish_using_command cage test' -s V -l version -d 'Prints version information'
complete -c cage -n '__fish_using_command cage repo' -s h -l help -d 'Prints help information'
complete -c cage -n '__fish_using_command cage repo' -s V -l version -d 'Prints version information'
complete -c cage -n '__fish_using_command cage repo' -f -a 'list'
complete -c cage -n '__fish_using_command cage repo' -f -a 'clone'
complete -c cage -n '__fish_using_command cage repo' -f -a 'help'
complete -c cage -n '__fish_using_command cage repo list' -s h -l help -d 'Prints help information'
complete -c cage -n '__fish_using_command cage repo list' -s V -l version -d 'Prints version information'
complete -c cage -n '__fish_using_command cage repo clone' -s h -l help -d 'Prints help information'
complete -c cage -n '__fish_using_command cage repo clone' -s V -l version -d 'Prints version information'
complete -c cage -n '__fish_using_command cage repo help' -s h -l help -d 'Prints help information'
complete -c cage -n '__fish_using_command cage repo help' -s V -l version -d 'Prints version information'
complete -c cage -n '__fish_using_command cage generate' -s h -l help -d 'Prints help information'
complete -c cage -n '__fish_using_command cage generate' -s V -l version -d 'Prints version information'
complete -c cage -n '__fish_using_command cage generate' -f -a 'completion'
complete -c cage -n '__fish_using_command cage generate' -f -a 'secrets'
complete -c cage -n '__fish_using_command cage generate' -f -a 'vault'
complete -c cage -n '__fish_using_command cage generate' -f -a 'help'
complete -c cage -n '__fish_using_command cage generate completion' -s h -l help -d 'Prints help information'
complete -c cage -n '__fish_using_command cage generate completion' -s V -l version -d 'Prints version information'
complete -c cage -n '__fish_using_command cage generate secrets' -s h -l help -d 'Prints help information'
complete -c cage -n '__fish_using_command cage generate secrets' -s V -l version -d 'Prints version information'
complete -c cage -n '__fish_using_command cage generate vault' -s h -l help -d 'Prints help information'
complete -c cage -n '__fish_using_command cage generate vault' -s V -l version -d 'Prints version information'
complete -c cage -n '__fish_using_command cage generate help' -s h -l help -d 'Prints help information'
complete -c cage -n '__fish_using_command cage generate help' -s V -l version -d 'Prints version information'
complete -c cage -n '__fish_using_command cage export' -s h -l help -d 'Prints help information'
complete -c cage -n '__fish_using_command cage export' -s V -l version -d 'Prints version information'
complete -c cage -n '__fish_using_command cage help' -s h -l help -d 'Prints help information'
complete -c cage -n '__fish_using_command cage help' -s V -l version -d 'Prints version information'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @homu on 2016-10-16 03:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/emk">@emk</a> on 2016-10-16 11:39</div>
            <div class="timeline-body"><p>@wdv4758h I can confirm that this fix works great! Thank you for taking time during your military service to implement this patch.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dpc">@dpc</a> on 2019-10-15 04:19</div>
            <div class="timeline-body"><p>Has this regressed since it was implemented? I'm using <code>structopt</code> with nested subcommands (https://github.com/crev-dev/cargo-crev/blob/5c61181a14b947568cb33a17ab76a7e278d5eb13/cargo-crev/src/main.rs#L267) and I'm getting</p>
<pre><code>trust level'
complete -c cargo -n &quot;__fish_seen_subcommand_from issue&quot; -l low-cost -d '[trust-graph-traversal] Cost of traversing trust graph edge of low trust level'
complete -c cargo -n &quot;__fish_seen_subcommand_from issue&quot; -l trust -d 'Minimum trust level of the reviewers for reviews'
complete -c cargo -n &quot;__fish_seen_subcommand_from issue&quot; -s u -l unrelated -d 'This crate is not neccesarily a dependency of the current cargo project'
complete -c cargo -n &quot;__fish_seen_subcommand_from issue&quot; -s h -l help -d 'Prints help information'
complete -c cargo -n &quot;__fish_seen_subcommand_from issue&quot; -s V -l version -d 'Prints version information'
complete -c cargo -n &quot;__fish_seen_subcommand_from help&quot; -s h -l help -d 'Prints help information'
</code></pre>
<p>and not what is mentioned here (`-n '__fish_using_command cage generate help')</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../remkop/picocli/issues/725.html">remkop/picocli#725</a> on 2020-11-16 06:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2715.html">clap-rs/clap#2715</a> on 2021-08-18 14:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ModProg">@ModProg</a> on 2021-08-18 14:28</div>
            <div class="timeline-body"><blockquote>
<p>Has this regressed since it was implemented?</p>
</blockquote>
<p>yes it had, I made a new issue over here #2715</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:46:42 UTC
    </footer>
</body>
</html>
