<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow the completed command to be an alias - clap-rs/clap #1764</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Allow the completed command to be an alias</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/clap-rs/clap/issues/1764">#1764</a>
        opened by <a href="https://github.com/d-e-s-o">@d-e-s-o</a>
        on 2020-03-26 21:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/d-e-s-o">@d-e-s-o</a> on 2020-03-26 21:05</div>
            <div class="timeline-body"><p>It would be great if the shell completion was more flexible in what commands it applies to. Let's say I have a program <code>foo</code> and a completion script <code>foo.bash</code> as generated by <code>clap</code>. If I source <code>foo.bash</code> I now have completion for <code>foo</code>'s arguments. Fine.</p>
<p>However, what if I have aliased <code>f</code> to <code>foo</code>? Naturally, I'd want to have completion for <code>f</code> as well. Usually that's not a problem. The completion script just registers the completion functionality for a certain command. E.g.,</p>
<pre><code class="language-bash">complete -F _foo -o bashdefault -o default foo
</code></pre>
<p>can be found in <code>foo.bash</code>.</p>
<p>Unfortunately, though, just changing that to</p>
<pre><code class="language-bash">complete -F _foo -o bashdefault -o default f
</code></pre>
<p>doesn't work, because, well, the script itself has the command/name coded into its logic.</p>
<p>That doesn't have to be the case, however, as <a href="https://github.com/git/git/blob/master/contrib/completion/git-completion.bash"><code>git</code></a> for example shows. Here all I have to do is register my alias as follows:</p>
<pre><code class="language-bash">__git_complete g __git_main
</code></pre>
<p>and bam, <code>g</code> has completion.</p>
<p>Would be great to have such a more flexible completion script.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by @d-e-s-o on 2020-03-26 21:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-03-26 21:09</div>
            <div class="timeline-body"><p>We are always open to PRs. I am not exactly good at the completion scripts. I couldn't even get zsh running locally ðŸ˜ž</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/d-e-s-o">@d-e-s-o</a> on 2020-03-26 21:23</div>
            <div class="timeline-body"><p>My bash completion days are also behind me (and I happily flushed 90% I knew from memory). That being said, this patch seems to be doing the trick:</p>
<pre><code class="language-patch">--- src/completions/bash.rs
+++ src/completions/bash.rs
@@ -33,8 +33,8 @@ impl&lt;'a, 'b&gt; BashGen&lt;'a, 'b&gt; {
     for i in ${{COMP_WORDS[@]}}
     do
         case &quot;${{i}}&quot; in
-            {name})
-                cmd=&quot;{name}&quot;
+            &quot;${{1}}&quot;)
+                cmd=&quot;${{1}}&quot;
                 ;;
             {subcmds}
             *)
@@ -43,7 +43,7 @@ impl&lt;'a, 'b&gt; BashGen&lt;'a, 'b&gt; {
     done

     case &quot;${{cmd}}&quot; in
-        {name})
+        &quot;${{1}}&quot;)
             opts=&quot;{name_opts}&quot;
             if [[ ${{cur}} == -* || ${{COMP_CWORD}} -eq 1 ]] ; then
                 COMPREPLY=( $(compgen -W &quot;${{opts}}&quot; -- &quot;${{cur}}&quot;) )
</code></pre>
<p>I'll probably open a PR unless I find an issue...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/1765.html">clap-rs/clap#1765</a> on 2020-03-26 21:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-04-04 03:32</div>
            <div class="timeline-body"><p>I believe this is fixed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/d-e-s-o">@d-e-s-o</a> on 2020-04-04 15:11</div>
            <div class="timeline-body"><blockquote>
<p>I believe this is fixed.</p>
</blockquote>
<p>Mind sharing details as to why you believe that to be the case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-04 15:27</div>
            <div class="timeline-body"><p>@pickfire How is this fixed?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../d-e-s-o/nitrocli/pulls/107.html">d-e-s-o/nitrocli#107</a> on 2020-04-05 06:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-04-05 14:16</div>
            <div class="timeline-body"><p>Because there was a pull request for it? Ah, I didn't notice it was closed instead of merged.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-05 16:40</div>
            <div class="timeline-body"><p>And it was closed without merging because it didn't actually fix the issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @pksunkara on 2020-04-05 16:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: generator</span> added by @pksunkara on 2020-04-09 08:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1898.html">clap-rs/clap#1898</a> on 2020-05-03 07:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3022.html">clap-rs/clap#3022</a> on 2021-11-14 01:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1232.html">clap-rs/clap#1232</a> on 2021-11-15 14:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/92.html">epage/clapng#92</a> on 2021-12-06 17:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/146.html">epage/clapng#146</a> on 2021-12-06 19:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/238.html">epage/clapng#238</a> on 2021-12-06 22:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> removed by @epage on 2021-12-08 21:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @epage on 2021-12-08 21:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "More flexible shell completion" to "Allow the completed command to be an alias" by @epage on 2021-12-09 21:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-medium</span> added by @epage on 2021-12-09 21:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.1" by @epage on 2021-12-09 21:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3166.html">clap-rs/clap#3166</a> on 2021-12-13 17:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:32 UTC
    </footer>
</body>
</html>
