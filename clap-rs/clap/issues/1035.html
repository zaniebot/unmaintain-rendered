<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`clap_app!` can't have default arguments with numbers/some characters. - clap-rs/clap #1035</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>clap_app!</code> can't have default arguments with numbers/some characters.</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1035">#1035</a>
        opened by <a href="https://github.com/jaccarmac">@jaccarmac</a>
        on 2017-08-21 04:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jaccarmac">@jaccarmac</a></div>
            <div class="timeline-body"><h3>Rust Version</h3>
<p><code>rustc 1.21.0-nightly (8c303ed87 2017-08-20)</code></p>
<h3>Affected Version of clap</h3>
<p><code>2.26.0</code></p>
<h3>Expected Behavior Summary</h3>
<p>The <code>clap_app!</code> macro can have arguments with defaults which are numbers or contain special characters, possibly with some quoting.</p>
<h3>Actual Behavior Summary</h3>
<p>No amount of quoting can stop Clap from failing to parse the macro form properly.</p>
<h3>Steps to Reproduce the issue</h3>
<p>Try to compile the sample code. Replace the default arguments with simple strings and see it compile successfully.</p>
<h3>Sample Code or Link to Sample Code</h3>
<pre><code>#[macro_use]
extern crate clap;

fn main() {
    let matches = clap_app!(app =&gt;
        (@arg host: default_value[foo.com] &quot;hostname&quot;)
        (@arg port: default_value[8080] &quot;port number&quot;)).get_matches();
}
</code></pre>
<h3>Debug output</h3>
<p>No output.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-08-21 22:26</div>
            <div class="timeline-body"><p>Thanks for reporting! I'm in the process of trying to get 3.x out the door, so I'll verify/fix this issue on that branch.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by @kbknapp on 2017-08-21 22:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: macros</span> added by @kbknapp on 2017-08-21 22:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: intermediate</span> added by @kbknapp on 2017-08-21 22:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @kbknapp on 2017-08-21 22:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gluxon">@gluxon</a> on 2019-01-26 18:18</div>
            <div class="timeline-body"><p>I'm not sure if the following was possible back when this issue was originally created, but I'm able to create a default argument (that's a number) like so:</p>
<pre><code class="language-rust">#[macro_use]
extern crate clap;

fn main() {
    let matches = clap_app!(app =&gt;
        (@arg host: default_value[foo.com] &quot;hostname&quot;)
        (@arg port: default_value(&quot;8080&quot;) &quot;port number&quot;)).get_matches();
}
</code></pre>
<p>It's a workaround, but I hope that's helpful for others until 3.x arrives.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/0x8f701">@0x8f701</a> on 2019-06-06 01:47</div>
            <div class="timeline-body"><p>hello @gluxon , could you explain a bit the difference between <code>[]</code> and <code>()</code> in default_value, and also why we need to add double quote for 8080 not <code>foo.com</code>.</p>
<p>Thanks in advance!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gluxon">@gluxon</a> on 2019-06-06 03:14</div>
            <div class="timeline-body"><blockquote>
<p>hello @gluxon , could you explain a bit the difference between [] and () in default_value</p>
</blockquote>
<p>Sure.</p>
<p>[] and () are both valid ways to call a function-like macro. So in terms of the Rust programming language, they're both exactly the same. For example, the first two lines are common, but all 4 are valid lines of Rust code.</p>
<pre><code class="language-rust">println!(&quot;hello&quot;);
let a = vec![1, 2, 3];
println![&quot;hello&quot;];
let a = vec!(1, 2, 3);
</code></pre>
<p>However, one works where the other doesn't here because of quirks in how <code>clap_app</code> and <code>default_value</code> are implemented. You would have to look at the source code for those two functions to see exactly why.</p>
<blockquote>
<p>and also why we need to add double quote for 8080 not foo.com.</p>
</blockquote>
<p>I'm also not 100% sure, but it's for similar reasons as above. Command line arguments are parsed as strings, so the fact that it's quoted doesn't change the type, but it gets around quirks in the aforementioned macro implementations.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @pksunkara on 2020-04-12 08:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-12 09:59</div>
            <div class="timeline-body"><p>With the upcoming PR which would close this issue, for certain characters, you would need to wrap them in <code>&quot;</code>. Otherwise, numbers will be allowed now</p>
<pre><code class="language-rust">fn main() {
    let matches = clap_app!(app =&gt;
        (@arg host: default_value[&quot;foo.com&quot;] &quot;hostname&quot;)
        (@arg port: default_value[8080] &quot;port number&quot;)).get_matches();
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/1813.html">clap-rs/clap#1813</a> on 2020-04-12 10:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-04-12 17:31</div>
            <div class="timeline-body"><p>Um, I don't get what problem is about.</p>
<pre><code class="language-rust">#[macro_use]
extern crate clap;

fn main() {
    let matches = clap_app!(app =&gt;
        (@arg host: default_value[&quot;foo.com&quot;] &quot;hostname&quot;)
        (@arg port: default_value[&quot;8080&quot;] &quot;port number&quot;)).get_matches();
}
</code></pre>
<p>There's no way to distinguish between <code>&quot;string literal&quot;</code> and <code>&lt;any other expression&gt;</code> on <code>macro_rules!</code> level so I think requiring values to be <code>&amp;str</code> is a fair compromise.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @bors[bot] on 2020-04-12 22:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Osse">@Osse</a> on 2021-11-19 12:02</div>
            <div class="timeline-body"><p>Has something changed recently? When I compile your example I get:</p>
<pre><code>error: no rules expected the token `-`
 --&gt; src\main.rs:5:19
  |
5 |       let matches = clap_app!(app =&gt;
  |  ___________________^
6 | |         (@arg host: default_value[&quot;foo.com&quot;] &quot;hostname&quot;)
7 | |         (@arg port: default_value[&quot;8080&quot;] &quot;port number&quot;)).get_matches();
  | |_________________________________________________________^ no rules expected this token in macro call
  |
  = note: this error originates in the macro `clap_app` (in Nightly builds, run with -Z macro-backtrace for more info)
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:46:59 UTC
    </footer>
</body>
</html>
