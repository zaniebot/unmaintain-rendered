<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tracking issue CustomDerive - clap-rs/clap #146</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Tracking issue CustomDerive</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/146">#146</a>
        opened by <a href="https://github.com/kbknapp">@kbknapp</a>
        on 2015-07-06 01:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/kbknapp">@kbknapp</a> on 2015-07-06 01:22</div>
            <div class="timeline-body"><h2>To Do</h2>
<h3>Derive FromArgMatches</h3>
<pre><code class="language-rust">#[derive(FromArgMatches)]
struct MyApp {
    verb: bool
}

fn main() {
    let m: MyApp = App::new(&quot;test&quot;)
        .arg_from_usage(&quot;-v, --verbose 'turns on verbose printing'&quot;)
        .get_matches()
        .into();

    println!(&quot;Verbose on: {:?}&quot;, m.verb);
}
</code></pre>
<ul>
<li>[ ] <code>#[derive(FromArgMatches)]</code><ul>
<li>[ ] Docs</li>
<li>[ ] Tests</li>
<li>[ ] Ensure requirements can't be violated (i.e. use <code>Default</code> where possible and document such)</li>
</ul>
</li>
</ul>
<h3>Derive App</h3>
<pre><code class="language-rust">/// Does stuff
#[derive(App)]
struct MyApp {
    /// Turns on verbose printing
    #[clap(short = 'v', long = &quot;verbose&quot;)]
    verb: bool
}
</code></pre>
<ul>
<li>[ ] <code>#[derive(App)]</code><ul>
<li>[ ] Docs</li>
<li>[ ] Tests</li>
</ul>
</li>
</ul>
<h3>Derive Subcommands</h3>
<pre><code class="language-rust">#[derive(SubCommands)]
pub enum Commands {
    Test(Test),
}
</code></pre>
<ul>
<li>[ ] <code>#[derive(SubCommands)]</code><ul>
<li>[ ] Docs</li>
<li>[ ] Tests</li>
</ul>
</li>
</ul>
<h3>Derive SubcommandFromArgMatches</h3>
<pre><code class="language-rust">#[derive(SubCommandFromArgMatches)]
pub enum Commands {
    Test(Test),
}
</code></pre>
<ul>
<li>[ ] <code>#[derive(DefineSubCommands)]</code><ul>
<li>[ ] Docs</li>
<li>[ ] Tests</li>
</ul>
</li>
</ul>
<h3>Derive TryFromArgMatches</h3>
<pre><code class="language-rust">#[derive(TryFromArgMatches)]
struct MyApp {
    verb: bool
}

fn main() {
    let m: Result&lt;MyApp, clap::Error&gt; = App::new(&quot;test&quot;)
        .arg_from_usage(&quot;-v, --verbose 'turns on verbose printing'&quot;)
        .get_matches()
        .try_into();
}
</code></pre>
<ul>
<li>[ ] <code>#[derive(FromArgMatches)]</code><ul>
<li>[ ] Docs</li>
<li>[ ] Tests</li>
</ul>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v2.0" by @kbknapp on 2015-07-06 01:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">feature request</span> added by @kbknapp on 2015-07-06 01:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: hard</span> added by @kbknapp on 2015-07-15 04:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P3: want to have</span> added by @kbknapp on 2015-07-15 04:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: matches</span> added by @kbknapp on 2015-07-15 04:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/251.html">clap-rs/clap#251</a> on 2015-09-12 13:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/249.html">clap-rs/clap#249</a> on 2015-09-18 10:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/WildCryptoFox">@WildCryptoFox</a> on 2015-09-18 10:53</div>
            <div class="timeline-body"><p>RustcSerialize/Deserialize? Serde2?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2015-09-18 20:10</div>
            <div class="timeline-body"><p>I'm thinking more about creating a <code>docopt</code> like struct instead of using string based (read &quot;error prone&quot;) <code>ArgMatches</code> approach.</p>
<p>i.e. imagine all valid options are set the same as they are now, but instead of using <code>matches.value_of(&quot;some_arg&quot;)</code> you'd access the value via a <code>matches.some_arg</code></p>
<p>As a <em>secondary</em> feature, it would be nice to actually serialize basic types using any of the above listed methods.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sru">@sru</a> on 2015-09-19 02:12</div>
            <div class="timeline-body"><p>I think @james-darkfox is asking what kind of library we would use if we are going to do this.</p>
<p>I don't think it is possible without library and without syntax extension because of the custom fields.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/WildCryptoFox">@WildCryptoFox</a> on 2015-09-19 03:56</div>
            <div class="timeline-body"><p>No syntax extension required. We have macros for this already. I could modify my builder macro to build a <code>struct</code>, and <code>impl</code> with <code>fn new</code> doing the current building that we have already. The <code>struct</code> would either need one of these libraries or, alternatively the macro could also build a function to <code>Matches { foo: matches.value_of(&quot;foo&quot;).unwrap_or(&quot;default&quot;) }</code> which does not need any external library either.</p>
<p><strong>Note</strong>: This also makes the default value accessible to the builder macro. :wink:</p>
<hr />
<p>For decoding into types. This depends on what types we want to support? I don't think we'd need RustcSerialize/deser, or serde2 as they are for more generic purposes. Currently we only have strings; I'd expect integers (u8 i8 u16 i16 u32 i32 u64 i64 f32 f64...), booleans (1/0, true/false, yes/no), paths, ???, <strong>Note</strong>: Inherit validation ensures that &quot;foo&quot; is not a number and as such not a valid value for an argument accepting a number.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sru">@sru</a> on 2015-09-19 05:32</div>
            <div class="timeline-body"><p>@james-darkfox Actually, that works quite nice, besides forcing user to use macro if they want the custom struct (which I think is somewhat trivial because the builder macro is simple enough).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/WildCryptoFox">@WildCryptoFox</a> on 2015-09-19 05:38</div>
            <div class="timeline-body"><p>Doesn't force the user to use it. As they can always use the current behavior or manually construct their own struct and <code>From&lt;App&gt;</code> or from matches. Or whatever.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/WildCryptoFox">@WildCryptoFox</a> on 2015-09-19 05:40</div>
            <div class="timeline-body"><p>I'm actually thinking about how clap could be refactored down... It is <em>REALLY</em> quite a large implementation for what everyone would like to call a simple task. Docopt was initially created to be simple, quick, and easy. I have a number of ideas that would refactor clap down <strong>heavily</strong> but this would be a <em>VERY</em> breaking change.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sru">@sru</a> on 2015-09-19 05:49</div>
            <div class="timeline-body"><p>@james-darkfox I see what you are getting at now.</p>
<p>On the other hand, you can always open up issues with RFC tag.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/WildCryptoFox">@WildCryptoFox</a> on 2015-09-19 05:57</div>
            <div class="timeline-body"><p>@sru Maybe when I have the basic concepts working. I'm currently throwing together some ideas for a minimal clap implementation. Tackling the problem much the same way as I have for my own builder &amp; macro which constructs a dummy registry of crates.</p>
<p>Notably: <code>From&lt;FooBuilder&gt; for Foo</code> and simplifying the global flags into a pseudo subcommand 'clap_global'.</p>
<p>Once I have this quick hack ready. We will see which of the following is better: porting the ideas over to the current clap (preferable); or extending the minimal implementation (much more work).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/259.html">clap-rs/clap#259</a> on 2015-09-19 10:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @kbknapp on 2015-09-22 13:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "v2.0" by @kbknapp on 2016-01-23 15:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-10-28 02:29</div>
            <div class="timeline-body"><p>Thanks to @kamalmarhubi at RustBelt, but thanks to macros 1.1 this may be a possibility. I need to look into this further!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Serialize matches into struct" to "Serialize matches into struct (macros 1.1?)" by @kbknapp on 2016-10-28 02:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/WildCryptoFox">@WildCryptoFox</a> on 2016-10-28 03:07</div>
            <div class="timeline-body"><p>@kbknapp Macros 1.1 are no better for this job than normal macros. Feel free to jump on IRC <code>irc.mozilla.org SSL 6697 #clap-rs</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Nemo157">@Nemo157</a> on 2016-11-12 20:12</div>
            <div class="timeline-body"><p>So I was playing round with something like this over the last week, basically a macros 1.1 builder that generates a <code>clap::App</code> from a set of struct and enum definitions along with a parser back from the <code>clap::ArgMatches</code> to the expected struct. A super simple example is:</p>
<pre><code class="language-rust">#[derive(StompCommand)]
pub struct MyApp {
    /// Sets a custom config file
    #[stomp(short = 'c', value_name = &quot;FILE&quot;)]
    config: Option&lt;String&gt;,
}

fn main() {
    let app = MyApp::parse();
    if let Some(c) = app.config {
        println!(&quot;Value for config: {}&quot;, c);
    }
}
</code></pre>
<p>There's a full rewrite of the main clap example at https://github.com/Nemo157/stomp-rs/blob/master/examples/01b_quick_example.rs along with a rewrite of the app I'm currently using clap in at https://github.com/Nemo157/ipfsdc-rs/commit/41e5d5f3b9562f0f4c6eab90c0c9a49e282ec6c1</p>
<p>One of the nice things about this is how much can be inferred from just the types given; if something is a <code>bool</code> then it's a simple flag option; if it's an <code>Option&lt;T&gt;</code> then it's optional, otherwise it's required; if it's a <code>Vec&lt;T&gt;</code> then it takes multiple values; if it implements <code>FromStr</code> then it can have an auto-generated validator that will report why parsing the value failed:</p>
<pre><code>cargo run --example 12_typed_values -- 9b
     Running `target/debug/examples/12_typed_values 9b`
error: failed to parse value &quot;9b&quot; for argument 'seq': invalid digit found in string
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kamalmarhubi">@kamalmarhubi</a> on 2016-11-12 21:11</div>
            <div class="timeline-body"><p>@Nemo157 yes! That's what I had in mind. Awesome that you put together a proof of concept.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kamalmarhubi">@kamalmarhubi</a> on 2016-11-12 21:14</div>
            <div class="timeline-body"><blockquote>
<p>One of the nice things about this is how much can be inferred from just the types given; if something is a <code>bool</code> then it's a simple flag option; if it's an <code>Option&lt;T&gt;</code> then it's optional, otherwise it's required; if it's a <code>Vec&lt;T&gt;</code> then it takes multiple values; if it implements <code>FromStr</code> then it can have an auto-generated</p>
</blockquote>
<p>These are all really cool ideas. :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/817.html">clap-rs/clap#817</a> on 2017-01-18 01:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/818.html">clap-rs/clap#818</a> on 2017-01-18 14:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kamalmarhubi">@kamalmarhubi</a> on 2017-01-29 23:24</div>
            <div class="timeline-body"><p>@Nemo157 @kbknapp is the best place to make progress here or in stomp-rs?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kamalmarhubi">@kamalmarhubi</a> on 2017-01-29 23:56</div>
            <div class="timeline-body"><p>(Since 1.15 and macros 1.1 is landing soon, I'd love if we can make the CLI story in Rust beautiful!)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-30 00:04</div>
            <div class="timeline-body"><p>@Nemo157 I can't believe I missed these comments somehow! Apologies to both you and @kamalmarhubi!</p>
<p>This is a very cool proof of concept that's super exciting! I think this could either be continued in <code>stomp-rs</code> or if @Nemo157 would be willing, it could potentially be merged into <code>clap</code> proper. Merging seems like the best user experience, but I'd have to look through the entirity of the code to ensure it matches all edge cases and such. If merging is the route taken, I'd also like to go with standard naming conventions such as <code>StompCommand</code>-&gt;<code>ClapCommand</code>, etc. At that point I'd also like to get @Nemo157's assistance as a contributor to help maintain that portion since it's a decently large addition that I'm sure quite a few people are going to want/use.</p>
<p>There are, however, two parts that could have potential issues</p>
<ul>
<li>Storing Options in a <code>Vec&lt;T&gt;</code> doesn't ensure the order of values, which some CLIs rely on. Also it'd potentially nice to store single options in a <code>T</code> just like positional args, and infer when multiples are used that it should be a <code>Vec&lt;T&gt;</code> (or which ever data structure ends up getting used).</li>
<li>Using <code>T</code> instead of <code>Option&lt;T&gt;</code> for requirements could be dangerous when things like requirements get overriden, conditional requirements, etc. We could bound that the <code>T</code> implement <code>Default</code>, which may work well to overcome this issue.</li>
<li>The subcommands portion would be even nicer if the enum could be specified inline</li>
</ul>
<p>This is amazing work, and I'm really excited by it!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kamalmarhubi">@kamalmarhubi</a> on 2017-01-30 01:01</div>
            <div class="timeline-body"><p>@kbknapp</p>
<blockquote>
<p>I can't believe I missed these comments somehow!</p>
</blockquote>
<p>That explains a lot! I'd be willing to help with merging this into clap and looking over the API for other changes like you suggested.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kamalmarhubi">@kamalmarhubi</a> on 2017-01-30 01:01</div>
            <div class="timeline-body"><p>I'd love for this to land within the 1.15 cycle!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-30 02:45</div>
            <div class="timeline-body"><p>@kamalmarhubi</p>
<blockquote>
<p>I'd love for this to land within the 1.15 cycle!</p>
</blockquote>
<p>Absolutely, me too! If we can resolve those outstanding questions above (values in order, ensuring <code>T</code> is bound with <code>Default</code> if not using <code>Option&lt;T&gt;</code>) and ensure the naming conventions of the APIs are inline with each other I don't see why this couldn't happen!</p>
<p>The subcommand enum not being inlined I'm fine with.</p>
<p>@Nemo157 and @kamalmarhubi</p>
<p>I forgot to mention in the last post the example above merges two distinct ideas into one, but I'd also want the ability to do one <em>or</em> the other and not be forced to use both. I haven't dug into the source yet, so if it's already possible ignore this comment ðŸ˜œ</p>
<p>What I mean is, I view both of these as distinct ideas (also, I'm using <code>clap</code> names in this example, but if it remains in the stomp crate, it'd be <code>stomp</code>):</p>
<ul>
<li>Create an <code>App</code> struct from <code>MyApp</code> using the <code>#[clap(short='c', long=&quot;config&quot;)]</code></li>
<li>Create <code>MyApp</code> struct from <code>ArgMatches</code> using the <code>#[derive(ClapCommand)]</code></li>
</ul>
<p>Being able to do these two things separatly would greatly increase adoptability. i.e. &quot;I've already got an <code>App</code>, so now I just write out my <code>MyApp</code> struct and place a <code>#[derive]</code> attribute on there and I'm off to the races.</p>
<p>Likewise, if for some unknown reason they don't want to use the <code>ArgMatches</code>-&gt;<code>MyApp</code> conversion, but still want to take advantage of the <code>MyApp</code>-&gt;<code>App</code> they could. Although I see this as less beneficial merely a biproduct.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @kbknapp on 2017-01-30 04:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Nemo157">@Nemo157</a> on 2017-01-30 07:24</div>
            <div class="timeline-body"><p>ðŸ˜ƒ I would definitely be happy to make this a part of <code>clap</code> proper.</p>
<blockquote>
<p>look through the entirity of the code to ensure it matches all edge cases and such</p>
</blockquote>
<p>At the moment, definitely not. I was basically using my application and the primary <code>clap</code> example as a feature list for what to implement, so there are many things missing.</p>
<blockquote>
<p>Using T instead of Option<T> for requirements could be dangerous when things like requirements get overriden, conditional requirements, etc.</p>
</blockquote>
<p>Yeah, again because of the test cases I was using I did not consider that at all. Hopefully, at least for the case where the user both generates the <code>App</code> and the conversion from <code>ArgMatches</code>, it should be possible to detect issues at compile time.</p>
<blockquote>
<p>The subcommands portion would be even nicer if the enum could be specified inline</p>
</blockquote>
<p>Depends which way you mean, an anonymous enum in the parent command would be cool, but probably not really doable without proper anonymous enum support in Rust. An enum with struct variants definitely should be possible, it would result in some massive generated code blocks, but that shouldn't be too bad, and could be fixed in the future with <a href="https://github.com/rust-lang/rfcs/pull/1450">types for enum variants</a> allowing delegating variant specific parsing.</p>
<blockquote>
<p>I forgot to mention in the last post the example above merges two distinct ideas into one, but I'd also want the ability to do one or the other and not be forced to use both.</p>
</blockquote>
<p>The trait doesn't allow it, but the macro is basically following two distinct paths for each so would be simple to split the trait for it.</p>
<p>Also, one thought I had soon after I implemented this was that the macro is doing too much. It should be possible to split a lot of what the macro is doing based on types (which is actually based on type names, so could very easily be broken with type aliases etc.) out to trait implementations. For example something like <code>trait FillArg { fn fill_arg(arg: Arg) -&gt; Arg }</code> (superbad name ðŸ˜ž) for filling out the details derived from the type and something else used during parsing.</p>
<p>I think I should have some time this week I could spend on this, I can definitely try and do a quick port into the <code>clap</code> codebase and do a bit of documentation on how it currently works and what's missing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Nemo157">@Nemo157</a> on 2017-01-30 17:44</div>
            <div class="timeline-body"><p>Just pushed <a href="https://github.com/kbknapp/clap-rs/compare/master...Nemo157:stomp">a branch with a quick port of the changes into the <code>clap</code> source tree</a>. Renamed most stuff, left the changes to <code>clap</code> itself in a <code>stomp</code> module pending bikeshedding the trait names and where in the hierarchy they might fit. While moving this I also split the traits into two, one for creating the <code>App</code> and one for parsing the resulting <code>ArgMatches</code> back, so users could manually implement one if they wanted (although, they would need to know exactly what the derive would expect to avoid runtime failures).</p>
<p>Currently it fails to build the example, and I'm not sure exactly why. There was some changes to <code>proc_macro_derive</code> since my initial implementation so the macro can't actually modify the item it's deriving for. I used to strip out all the <code>#[stomp(...)]</code> attributes to get around unknown attribute warnings, but now the compiler is meant to do that for you for a list of known attributes you give it. I've done that but I'm still getting an error from the compiler for having the attribute there:</p>
<pre><code>â†’ cargo +nightly run --example 01b_quick_example_stomp
   Compiling clap v2.20.1 (file:///Users/Nemo157/sources/clap-rs)
error: macro undefined: 'clap!'
  --&gt; examples/01b_quick_example_stomp.rs:36:1
   |
36 | #[clap(name = &quot;MyApp&quot;, version = &quot;1.0&quot;)]
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Nemo157">@Nemo157</a> on 2017-01-30 17:48</div>
            <div class="timeline-body"><blockquote>
<p>an anonymous enum in the parent command would be cool, but probably not really doable without proper anonymous enum support in Rust</p>
</blockquote>
<p>That's definitely off the table now that procedural macros can't modify the item at all.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-30 17:48</div>
            <div class="timeline-body"><p>I think the <code>#[x(y=&quot;z&quot;)]</code> was removed from macros 1.1</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Nemo157">@Nemo157</a> on 2017-01-30 17:50</div>
            <div class="timeline-body"><p>It's currently allowed in master (and beta): https://github.com/rust-lang/rust/blob/master/src/test/compile-fail-fulldeps/proc-macro/proc-macro-attributes.rs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Nemo157">@Nemo157</a> on 2017-01-30 18:05</div>
            <div class="timeline-body"><p>Looks like it might be related to some of the features I was still using, removed them all and <code>cargo +beta run --example 01b_quick_example_stomp -- --help</code> works now ðŸ˜„</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-30 18:26</div>
            <div class="timeline-body"><p>The part that people have been really asking for is the <code>ArgMatches</code>-&gt;<code>MyApp</code> piece. So I would even ben fine if we had to pull the <code>MyApp</code>-&gt;<code>App</code> part out, or simply do a true procedural macro/compiler plugin and mark it with <code>unstable</code> (clap features).</p>
<p>Either way this will eventually merge as <code>clap</code> 3.x and the custom derive part will remain using the clap <code>unstable</code> feature until Rust 1.17 is released for compatibility reason (so Current - 2 releases can be supported on stable Rust).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-30 18:53</div>
            <div class="timeline-body"><blockquote>
<p>Just pushed a branch with a quick port of the changes into the clap source tree.</p>
</blockquote>
<p>Excellent!!! I'm going to be looking through this over the next few days, feel free to continue working on it, and if I get some time I'll probably push some commits as well. Full disclosure, I'll be traveling pretty heavily for the next two weeks so my replies may not be instant :wink:</p>
<p>My initial bikeshed thoughts are to move the traits into a <code>code_gen</code> module. I think we could also use easier names, such as <code>DefineApp</code>-&gt;<code>App</code>, <code>DefineSubCommands</code>-&gt;<code>SubCommands</code>. <code>FromArgMatches</code> is great because it follows the stdlib example.</p>
<p>For UX, I think <code>#[derive(SubCommands)]</code> can imply <code>#[derive(SubCommands, SubCommandsFromArgMatches)]</code></p>
<p>So the example would go to:</p>
<pre><code class="language-rust">/// Does awesome things.
#[derive(App, FromArgMatches)]
#[clap(name = &quot;MyApp&quot;, version = &quot;1.0&quot;)]
#[clap(author = &quot;Nemo157 &lt;clap@nemo157.com&gt;&quot;)]
pub struct MyApp {
    /// Sets a custom config file
    #[clap(short = &quot;c&quot;, value_name = &quot;FILE&quot;)]
    config: Option&lt;String&gt;,

    /// Sets an optional output file
    #[clap(index = &quot;1&quot;)]
    output: Option&lt;String&gt;,

    /// Turn debugging information on
    #[clap(counted, short = &quot;d&quot;, long = &quot;debug&quot;)]
    debug_level: u64,

    #[clap(subcommand)]
    subcommand: Option&lt;Commands&gt;,
}

#[derive(SubCommands)]
pub enum Commands {
    Test(Test),
}

/// does testing things
#[derive(App, FromArgMatches)]
pub struct Test {
    /// lists test values
    #[clap(short = &quot;l&quot;)]
    list: bool,
}
</code></pre>
<p>I'm going to go ahead and submit a PR so we can use it for tracking purposes and as a standard place for easily seeing the diffs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/835.html">clap-rs/clap#835</a> on 2017-01-30 19:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-30 19:23</div>
            <div class="timeline-body"><p>#835 is open. Feel free to discuss exact implementation details in that PR, but also know that I'll be keeping that PR quite clean and deleting old comments and such as well as updating the OP to keep track of current discussion.</p>
<p>If talk around abstract implementation details need to continue to happen, I'd prefer to use this issue for historical data reasons.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Serialize matches into struct (macros 1.1?)" to "Tracking issue for Macros 1.1 custom derive" by @kbknapp on 2017-02-16 02:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x blocker</span> added by @kbknapp on 2017-05-09 18:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> removed by @kbknapp on 2017-05-09 18:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1037.html">clap-rs/clap#1037</a> on 2017-08-22 04:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Tracking issue for Macros 1.1 custom derive" to "Tracking issue CustomDerive" by @kbknapp on 2017-11-12 19:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-11-12 19:53</div>
            <div class="timeline-body"><p>This issue was moved to kbknapp/clap-derives#4</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2017-11-12 19:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1661.html">clap-rs/clap#1661</a> on 2020-02-03 09:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:17 UTC
    </footer>
</body>
</html>
