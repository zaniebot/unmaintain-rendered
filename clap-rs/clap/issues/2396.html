<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom value hint - clap-rs/clap #2396</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Custom value hint</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/2396">#2396</a>
        opened by <a href="https://github.com/tailhook">@tailhook</a>
        on 2021-03-09 15:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/tailhook">@tailhook</a> on 2021-03-09 15:10</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
<h3>Describe your use case</h3>
<p>Let's imagine I have a <code>make</code>-like utility. And I want:</p>
<pre><code>make &lt;tab&gt;
</code></pre>
<p>To complete to commands listed in the <code>Makefile</code> in the current directory. Most current shells can handle this, but I don't think there is a way to generate completions for that by clap.</p>
<h3>Describe the solution you'd like</h3>
<p>I propose something like this:</p>
<pre><code>    Arg::new(&quot;target&quot;)
        .about(&quot;target to execute&quot;)
        .takes_value(true)
        .value_hint(ValueHint::RunCommand([&quot;--list-targets&quot;]))
</code></pre>
<p>This means that shell runs <code>$binname --list-targets</code> to fetch the names of the targets for completion.</p>
<p>The complication is that some shells (namely zsh) may use a description in completion data but others can't so there are two options:</p>
<ol>
<li>Add <code>--shell=zsh</code> for command (this is nice if command has subcommands: <code>mymake list-targets --shell=zsh</code> but is weird if <code>mymake --list-targets --shell=zsh</code>, because basically <code>--shell=</code> will be accepted but not used in any invocation)</li>
<li>Standardize the output format and adapt it to specific shell by our shell function (i.e. stripping descriptions in bash)</li>
</ol>
<h3>Alternatives, if applicable</h3>
<p>Alternative solution is to have <code>ValueHint::ShellFunction(&quot;_my_make_targets&quot;)</code> and manually append function <code>_my_make_targets</code> to the generated file. This is more flexible, but is harder to use since the shell function will have to be implemented for every shell manually.</p>
<hr />
<p>What do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by @tailhook on 2021-03-09 15:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-03-09 16:56</div>
            <div class="timeline-body"><p>Duplicate of #1232</p>
<p>I assume you saw that issue when searching? Why did you decide to create a new one?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @pksunkara on 2021-03-09 16:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> removed by @pksunkara on 2021-03-09 16:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">R: duplicate</span> added by @pksunkara on 2021-03-09 16:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tailhook">@tailhook</a> on 2021-03-10 15:07</div>
            <div class="timeline-body"><blockquote>
<p>Duplicate of #1232</p>
<p>I assume you saw that issue when searching? Why did you decide to create a new one?</p>
</blockquote>
<p>No I didn't see that. Sorry.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chisui">@chisui</a> on 2021-09-06 22:04</div>
            <div class="timeline-body"><p>#1232 seems to be about delegating completion to clap itself. By extending <code>ValueHint</code> you would enable the completion script to call any other program. It also doesn't have to handle the completion itself but simply enumerate possible values. Would it be possible to reopen this issue @pksunkara?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-09-06 23:25</div>
            <div class="timeline-body"><p>Since the design for #1232 is not yet done and the thing being requested here is so close what's being discussed in that issue, they might actually end up being the same.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5449.html">clap-rs/clap#5449</a> on 2024-04-09 03:39</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:08 UTC
    </footer>
</body>
</html>
