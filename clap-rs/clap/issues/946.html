<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flag also parsed as positional argument - clap-rs/clap #946</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Flag also parsed as positional argument</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/946">#946</a>
        opened by <a href="https://github.com/Mark-Simulacrum">@Mark-Simulacrum</a>
        on 2017-05-05 04:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Mark-Simulacrum">@Mark-Simulacrum</a></div>
            <div class="timeline-body"><h3>Rust Version</h3>
<p>N/A, but tested on latest nightly</p>
<h3>Affected Version of clap</h3>
<p>2.22.1</p>
<h3>Expected Behavior Summary</h3>
<p>With a single, optional positional argument and a flag, we don't parse the flag as the positional argument. I also set <code>AllowLeadingHyphen</code>, since some of my arguments start with <code>-C</code>.</p>
<h3>Actual Behavior Summary</h3>
<p>The optional positional argument is parsed as <code>Some(&quot;--verbose&quot;)</code> instead of <code>None</code>, and <code>--verbose</code> is also parsed.</p>
<h3>Steps to Reproduce the issue</h3>
<p>I'm not really sure what to put here, but basically</p>
<p><code>app --verbose</code> is parsed as:</p>
<ul>
<li><code>is_present(&quot;--verbose&quot;) = true</code></li>
<li>`value_of(&quot;filter&quot;) == Some(&quot;--verbose&quot;)</li>
</ul>
<h3>Sample Code or Link to Sample Code</h3>
<p>https://github.com/Mark-Simulacrum/rust/tree/cleanup is the branch, but you'll need to cd to src/tools/compiletest and then just cargo build should work.</p>
<p>After that, running this command reproduces the issue, pay attention to how filter is printed as <code>Some(&quot;--verbose&quot;)</code> in the debug output:</p>
<p><code>./src/target/debug/compiletest &quot;--compile-lib-path&quot; &quot;./rust/build/x86_64-unknown-linux-gnu/stage1/lib&quot; &quot;--run-lib-path&quot; &quot;./rust/build/x86_64-unknown-linux-gnu/stage1/lib/rustlib/x86_64-unknown-linux-gnu/lib&quot; &quot;--rustc-path&quot; &quot;./rust/build/x86_64-unknown-linux-gnu/stage1/bin/rustc&quot; &quot;--rustdoc-path&quot; &quot;./rust/build/x86_64-unknown-linux-gnu/stage1/bin/rustdoc&quot; &quot;--src-base&quot; &quot;./rust/src/test/compile-fail&quot; &quot;--build-base&quot; &quot;./rust/build/x86_64-unknown-linux-gnu/test/compile-fail&quot; &quot;--stage-id&quot; &quot;stage1-x86_64-unknown-linux-gnu&quot; &quot;--mode&quot; &quot;compile-fail&quot; &quot;--target&quot; &quot;x86_64-unknown-linux-gnu&quot; &quot;--host&quot; &quot;x86_64-unknown-linux-gnu&quot; &quot;--llvm-filecheck&quot; &quot;./rust/build/x86_64-unknown-linux-gnu/llvm/build/bin/FileCheck&quot; &quot;--nodejs&quot; &quot;/usr/bin/node&quot; &quot;--host-rustcflags&quot; &quot;-Crpath -O&quot; &quot;--target-rustcflags&quot; &quot;-Crpath -O -Lnative=./rust/build/x86_64-unknown-linux-gnu/native/rust-test-helpers&quot; &quot;--docck-python&quot; &quot;/usr/bin/python2.7&quot; &quot;--lldb-python&quot; &quot;/usr/bin/python2.7&quot; &quot;--gdb&quot; &quot;/usr/bin/gdb&quot; &quot;--llvm-version&quot; &quot;4.0.1\n&quot; &quot;--verbose&quot; &quot;--cc&quot; &quot;&quot; &quot;--cxx&quot; &quot;&quot; &quot;--cflags&quot; &quot;&quot; &quot;--llvm-components&quot; &quot;&quot; &quot;--llvm-cxxflags&quot; &quot;&quot; &quot;--adb-path&quot; &quot;adb&quot; &quot;--adb-test-dir&quot; &quot;/data/tmp/work&quot; &quot;--android-cross-path&quot; &quot;&quot;</code></p>
<h3>Debug output</h3>
<p>https://gist.github.com/Mark-Simulacrum/b86c4f16f922be7ef542e7853cf93e01, with what I think being relevant here: https://gist.github.com/Mark-Simulacrum/b86c4f16f922be7ef542e7853cf93e01#file-gistfile1-txt-L1590</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-05-06 18:12</div>
            <div class="timeline-body"><p>Thanks for taking the time to file this! I've confirmed the bug, and it should be an easy one to fix.</p>
<p>Also, just to note <code>AllowLeadingHyphen</code> is for when <em>values</em> may start with a hyphen, and should be used sparingly if possible. A better option is to use <a href="https://docs.rs/clap/2.24.0/clap/struct.Arg.html#method.allow_hyphen_values"><code>allow_hyphen_values</code></a> only on the args who's values may start with a leading hyphen. It's not critical, I just wanted to note it (and if you already knew this I apologize :smile:)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by @kbknapp on 2017-05-06 18:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> added by @kbknapp on 2017-05-06 18:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @kbknapp on 2017-05-06 18:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @kbknapp on 2017-05-06 18:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "2.24.1" by @kbknapp on 2017-05-06 18:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Mark-Simulacrum">@Mark-Simulacrum</a> on 2017-05-06 18:35</div>
            <div class="timeline-body"><p>Great! Thanks for pointing out that there's a difference between <code>AllowLeadingHypen</code> and <code>allow_hyphen_values</code>, but I think I'm confused (feel free to tell me I should move this to another issue). The documentation for <a href="https://docs.rs/clap/2.24.0/clap/enum.AppSettings.html#variant.AllowLeadingHyphen"><code>AllowLeadingHyphen</code></a> suggests that I <em>have to</em> set that globally: &quot;NOTE: This can only be set application wide and not on a per argument basis.&quot; But what you're saying seems to suggest that's not the case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-05-06 18:48</div>
            <div class="timeline-body"><blockquote>
<p>there's a difference between AllowLeadingHypen and allow_hyphen_values, but I think I'm confused</p>
</blockquote>
<p>They do the same thing, one is globally (<code>AllowLeadingHyphen</code>) and the other is per argument (<code>allow_hyphen_values</code>).</p>
<p>The documentation is out of date (<em>embarrassed</em>). That was true before <code>allow_hyphen_values</code> was introduced. I'm updating it as we speak.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2017-05-07 14:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-05-07 14:47</div>
            <div class="timeline-body"><p>2.24.1 is on crates.io</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:46:53 UTC
    </footer>
</body>
</html>
