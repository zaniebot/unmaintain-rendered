<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redundant code in Zsh completion when there are no subcommands - clap-rs/clap #1142</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Redundant code in Zsh completion when there are no subcommands</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/1142">#1142</a>
        opened by <a href="https://github.com/segevfiner">@segevfiner</a>
        on 2018-01-06 12:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/segevfiner">@segevfiner</a> on 2018-01-06 12:42</div>
            <div class="timeline-body"><!--
Please use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`
-->

<h3>Rust Version</h3>
<p><code>rustc 1.23.0 (766bd11c8 2018-01-01)</code></p>
<h3>Affected Version of clap</h3>
<p><code>2.29.0</code></p>
<h3>Expected Behavior Summary</h3>
<p>There shouldn't be redundant code in the generated Zsh completion code.</p>
<h3>Actual Behavior Summary</h3>
<p>There is some redundant code when there are no sub-commands.</p>
<p><strong>Generated from the sample:</strong></p>
<pre><code class="language-zsh">#compdef clap-test

_clap-test() {
    typeset -A opt_args
    local ret=1

    local context curcontext=&quot;$curcontext&quot; state line
    _arguments -s -S -C \
'--completions[]' \
'-h[Prints help information]' \
'--help[Prints help information]' \
'-V[Prints version information]' \
'--version[Prints version information]' \
&amp;&amp; ret=0
    
}

(( $+functions[_clap-test_commands] )) ||
_clap-test_commands() {
    local commands; commands=(
        
    )
    _describe -t commands 'clap-test commands' commands &quot;$@&quot;
}
(( $+functions[_clap-test_commands] )) ||
_clap-test_commands() {
    local commands; commands=(
        
    )
    _describe -t commands 'clap-test commands' commands &quot;$@&quot;
}

_clap-test &quot;$@&quot;
</code></pre>
<p>Notice the double <code>_clap-test_commands</code> part.</p>
<h3>Steps to Reproduce the issue</h3>
<ol>
<li>Build the sample.</li>
<li>Run <code>cargo run -- --completions</code>.</li>
<li>Check the output.</li>
</ol>
<h3>Sample Code or Link to Sample Code</h3>
<pre><code class="language-rust">extern crate clap;

use std::io;
use clap::{App, Arg, Shell};

fn build_cli() -&gt; App&lt;'static, 'static&gt; {
    App::new(&quot;clap-test&quot;)
        .arg(Arg::with_name(&quot;completions&quot;)
            .long(&quot;completions&quot;))
}

fn main() {
    let matches = build_cli().get_matches();

    if matches.is_present(&quot;completions&quot;) {
        build_cli().gen_completions_to(&quot;clap-test&quot;, Shell::Zsh, &amp;mut io::stdout())
    }
}
</code></pre>
<h3>Debug output</h3>
<p><a href="https://github.com/kbknapp/clap-rs/files/1608772/clap-debug.txt">clap-debug.txt</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-01-09 18:01</div>
            <div class="timeline-body"><p>@segevfiner since you're already on a roll for these completions PRs, do you want to take a swing at this one? :smile:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: enhancement</span> added by @kbknapp on 2018-01-09 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: intermediate</span> added by @kbknapp on 2018-01-09 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P3: want to have</span> added by @kbknapp on 2018-01-09 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: completion gen</span> added by @kbknapp on 2018-01-09 18:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/segevfiner">@segevfiner</a> on 2018-01-10 05:58</div>
            <div class="timeline-body"><p>I probaby will ðŸ˜‰</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/1144.html">clap-rs/clap#1144</a> on 2018-01-10 18:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2018-01-15 16:51</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:32 UTC
    </footer>
</body>
</html>
