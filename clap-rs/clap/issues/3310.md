```yaml
number: 3310
title: debug_assert fails with PropagateVersion in 3.0.8/3.0.9, but get_matches does not
type: issue
state: closed
author: Roguelazer
labels:
  - C-bug
assignees: []
created_at: 2022-01-18T20:07:53Z
updated_at: 2022-01-18T21:03:30Z
url: https://github.com/clap-rs/clap/issues/3310
synced_at: 2026-01-10T01:57:46Z
```

# debug_assert fails with PropagateVersion in 3.0.8/3.0.9, but get_matches does not

---

_Issue opened by @Roguelazer on 2022-01-18 20:07_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the existing issues

### Rust Version

rustc 1.57.0 (f1edd0429 2021-11-29)

### Clap Version

3.0.9

### Minimal reproducible code

```rust
fn cli() -> clap::App<'static> {
    clap::App::new(env!("CARGO_PKG_NAME"))
        .version(env!("CARGO_PKG_VERSION"))
        .global_setting(clap::AppSettings::PropagateVersion)
        .subcommand(clap::App::new("subcommand"))
}

fn main() {
    let cli = cli();
    cli.get_matches();
}

#[cfg(test)]
mod tests {
    #[test]
    fn test_cli() {
        super::cli().debug_assert();
    }
}
```


### Steps to reproduce the bug with the above code

`cargo run -- --help` succeeds, but `cargo test` fails

### Actual Behaviour

PropagateVersion should work in debug_assert

### Expected Behaviour

PropagateVersion seems to not work in debug_assert

### Additional Context

If I pin `clap` to `=3.0.7`, this works, so this is a regression in 3.0.8

### Debug Output

```
running 1 test
[            clap::build::app] 	App::_build
[            clap::build::app] 	App::_propagate:clp-test
[            clap::build::app] 	App::_check_help_and_version
[            clap::build::app] 	App::_check_help_and_version: Building help subcommand
[            clap::build::app] 	App::_propagate_global_args:clp-test
[            clap::build::app] 	App::_derive_display_order:clp-test
[            clap::build::app] 	App::_derive_display_order:subcommand
[            clap::build::app] 	App::_derive_display_order:help
[clap::build::app::debug_asserts] 	App::_debug_asserts
[clap::build::arg::debug_asserts] 	Arg::_debug_asserts:help
[clap::build::arg::debug_asserts] 	Arg::_debug_asserts:version
[clap::build::app::debug_asserts] 	App::_verify_positionals
[            clap::build::app] 	App::_build
[            clap::build::app] 	App::_propagate:subcommand
[            clap::build::app] 	App::_check_help_and_version
[            clap::build::app] 	App::_propagate_global_args:subcommand
[            clap::build::app] 	App::_derive_display_order:subcommand
[clap::build::app::debug_asserts] 	App::_debug_asserts
[clap::build::arg::debug_asserts] 	Arg::_debug_asserts:help
[clap::build::arg::debug_asserts] 	Arg::_debug_asserts:version
[clap::build::app::debug_asserts] 	App::_verify_positionals
[            clap::build::app] 	App::_build
[            clap::build::app] 	App::_propagate:help
[            clap::build::app] 	App::_check_help_and_version
[            clap::build::app] 	App::_check_help_and_version: Removing generated help
[            clap::build::app] 	App::_check_help_and_version: Removing generated version
[            clap::build::app] 	App::_propagate_global_args:help
[            clap::build::app] 	App::_derive_display_order:help
[clap::build::app::debug_asserts] 	App::_debug_asserts
test tests::test_cli ... FAILED

failures:

---- tests::test_cli stdout ----
thread 'tests::test_cli' panicked at 'App help: No version information via App::version or App::long_version to propagate', /Users/jbrown/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-3.0.9/src/build/app/debug_asserts.rs:18:9
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace

```

---

_Label `C-bug` added by @Roguelazer on 2022-01-18 20:07_

---

_Renamed from "debug_assert fails with PropagateVersion in 3.0.9, but get_matches does not" to "debug_assert fails with PropagateVersion in 3.0.8/3.0.9, but get_matches does not" by @Roguelazer on 2022-01-18 20:21_

---

_Referenced in [clap-rs/clap#3311](../../clap-rs/clap/pulls/3311.md) on 2022-01-18 20:40_

---

_Closed by @epage on 2022-01-18 20:58_

---

_Comment by @epage on 2022-01-18 21:03_

Sorry about that.  v3.0.10 is out with the fix

---
