<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support clearing args matches - clap-rs/clap #5973</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support clearing args matches</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/5973">#5973</a>
        opened by <a href="https://github.com/kryvashek">@kryvashek</a>
        on 2025-04-17 15:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/kryvashek">@kryvashek</a> on 2025-04-17 15:41</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[x] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[x] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>master</p>
<h3>Describe your use case</h3>
<p>I'm trying to &quot;merge&quot; commands from several sources (config and CLI actually), which means when some argument has been set to its default value because of its absence in CLI this default value will also override the value from the file. This behavior can be fixed by deleting all default-set arguments from ArgMatches before merging.</p>
<p>But ArgMatches doesn't have any interface for removing occurrences without getting them in return. Returning occurrences (in all supported forms) requires specifying the type (i.e. ArgMatches::try_remove_occurrences). This turns out to be inconvenient when it is only needed to remove specific argument matches without utilizing related values.</p>
<h3>Describe the solution you'd like</h3>
<p>Implement a method like ~~<code>ArgMatches::drop_occurrences(id: &amp;str)</code>~~ <code>ArgMatches::try_clear_id(id: &amp;str)</code> (see comments below), which will remove all occurrences with the given id from the current <code>ArgMatches</code> without returning them.</p>
<h3>Alternatives, if applicable</h3>
<p>Provide a method for removing all default-set arguments from the current ArgMatches.</p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @kryvashek on 2025-04-17 15:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5974.html">clap-rs/clap#5974</a> on 2025-04-17 15:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-parsing</span> added by @epage on 2025-04-17 21:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> added by @epage on 2025-04-17 21:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-04-17 21:22</div>
            <div class="timeline-body"><p>This seems like a fairly niche use case but not too much cost to adding it.  Note that for us, the costs include build times, binary size, and API bloat.</p>
<p>Not thrilled with the prefix <code>drop</code>.  Know of any precedence for doing that?</p>
<p>As for <code>_occurrences</code> suffix, I feel like that would imply this is more limited than it is.  I'd maybe go with <code>_id</code> (or prefix only if it isn't too generic like <code>drop</code>).</p>
<p>We should at minimum have a <code>try_</code> variant of this function.  Due to its specialized nature, I lean towards only having the <code>try_</code> variant.</p>
<p>As for contributing, FYI</p>
<ul>
<li>We ask that non-draft PRs wait until a design is selected and this is marked as ready to contribute (<a href="https://github.com/clap-rs/clap/blob/master/CONTRIBUTING.md#where-to-start">source</a>)</li>
<li>We ask that commits be atomic which includes documentation and tests (<a href="https://github.com/clap-rs/clap/blob/master/CONTRIBUTING.md#preparing-the-pr">source</a>)
-We suggest that test commits can come before the feature/fix commit (though not after) when it works to highlight the role of the fix or feature.  This is done by finding a way to make the test commit pass on its own, showing the current behavior.  The fix/feature commit then updates the test to ensure it still passes.  The diff of the test between the two commits role of the PR very clear to reviewers and the community.  This can likely be skipped for this PR.  One potential way of doing it would be to use <code>try_remove</code> when you don't know the type, getting an error and that nothing changed.  In the feature commit, you can then switch to the new function and show it now works.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kryvashek">@kryvashek</a> on 2025-04-18 07:30</div>
            <div class="timeline-body"><blockquote>
<p>seems like a fairly niche use case</p>
</blockquote>
<p>It is indeed. That is why I've chosen the minimally invasive change which came to my mind (instead of making some kind of <code>remove_all_default_set</code> method for example).</p>
<blockquote>
<p>Not thrilled with the prefix <code>drop</code>. Know of any precedence for doing that?</p>
</blockquote>
<p>Can't remember anything right now (except for the standard function of course). I've looked at options <code>remove</code> and <code>clear</code> at start, but disregarded both. The first implied some similarity with other <code>remove</code> methods, which I found confusing since the significant difference in their behavior. And the second do the same, but with <code>clear()</code> methods of standard containers, which clear all entries without distinguishing them. In the mean time the <code>drop()</code> function implies taking some single value without returning it back, which seemed similar to targeted behavior.</p>
<blockquote>
<p>As for <code>_occurrences</code> suffix, I feel like that would imply this is more limited than it is. I'd maybe go with <code>_id</code></p>
</blockquote>
<p>It actually seems like a good idea, thanks! I'll use this suffix.</p>
<blockquote>
<p>We should at minimum have a <code>try_</code> variant of this function. Due to its specialized nature, I lean towards only having the <code>try_</code> variant.</p>
</blockquote>
<p>Agree. Considering two previous remarks I suggest the name <code>try_delete_id</code>.</p>
<blockquote>
<p>We ask that non-draft PRs wait until a design is selected and this is marked as ready to contribute</p>
</blockquote>
<p>I see. I'm sorry I've broken some rules. I was kinda in a hurry and even implemented the solution first, and only then created this issue. I marked the PR as draft now to be that until we come into some final decision.</p>
<blockquote>
<p>We ask that commits be atomic which includes documentation and tests</p>
</blockquote>
<p>I'll fix that. And thank you for the idea about how to implement the test when method still isn't added.</p>
<p>By the way, considering the suggested change should I bump the patch version? I'm not quite sure.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-04-18 14:19</div>
            <div class="timeline-body"><blockquote>
<p>Can't remember anything right now (except for the standard function of course). I've looked at options remove and clear at start, but disregarded both. The first implied some similarity with other remove methods, which I found confusing since the significant difference in their behavior. And the second do the same, but with clear() methods of standard containers, which clear all entries without distinguishing them. In the mean time the drop() function implies taking some single value without returning it back, which seemed similar to targeted behavior.</p>
<p>Agree. Considering two previous remarks I suggest the name try_delete_id.</p>
</blockquote>
<p><code>delete</code> isn't commonly used.</p>
<p><code>drop</code> has somewhat similar semantics but is usually limited to actual drop operations</p>
<p><code>clear</code> has the same operational semantics though a wider scope.  However, I think the suffix could help with that.</p>
<p>I'm leaning towards <code>try_clear_id</code></p>
<blockquote>
<p>By the way, considering the suggested change should I bump the patch version? I'm not quite sure.</p>
</blockquote>
<p>I bump versions on release.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kryvashek">@kryvashek</a> on 2025-04-18 14:24</div>
            <div class="timeline-body"><blockquote>
<p>I'm leaning towards <code>try_clear_id</code></p>
</blockquote>
<p>Ok, then i'll use this name.</p>
<p>Shall we consider this issue passed the design stage?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> removed by @epage on 2025-04-18 14:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-easy</span> added by @epage on 2025-04-18 14:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-04-18 14:26</div>
            <div class="timeline-body"><p>Yup</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kryvashek">@kryvashek</a> on 2025-04-18 14:57</div>
            <div class="timeline-body"><p>@epage, thank you for guiding me and being patient. I've marked <a href="https://github.com/clap-rs/clap/pull/5974">the PR</a> as ready to review.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2025-04-18 19:05</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:09 UTC
    </footer>
</body>
</html>
