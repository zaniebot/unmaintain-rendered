<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`name` ignored in usage, showing the binary file name - clap-rs/clap #6100</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`name` ignored in usage, showing the binary file name</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/6100">#6100</a>
        opened by <a href="https://github.com/winksaville">@winksaville</a>
        on 2025-08-10 05:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/winksaville">@winksaville</a> on 2025-08-10 05:53</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[x] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[x] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.89.0 (29483883e 2025-08-04)</p>
<h3>Clap Version</h3>
<p>4.5.43</p>
<h3>Minimal reproducible code</h3>
<p>main.rs:</p>
<pre><code class="language-rust">use clap::Parser;

// Arguments for the clap-test application
#[derive(Parser)]
#[command(name = &quot;clap-test-name&quot;, version)]
struct Args {}

fn main() {
    Args::parse();
}
</code></pre>
<p>Cargo.toml:</p>
<pre><code>[package]
name = &quot;clap-test&quot;
version = &quot;0.1.0&quot;
edition = &quot;2024&quot;

[dependencies]
clap = { version = &quot;4.5.43&quot;, features = [&quot;derive&quot;] }
</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<p>Run <code>-h</code> and then <code>-V</code>:</p>
<pre><code class="language-bash">cargo run -- -h
cargo run -- -V
</code></pre>
<h3>Actual Behaviour</h3>
<p>The name is different:</p>
<pre><code class="language-bash">$ cargo run -- -h
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.02s
     Running `target/debug/clap-test -h`
Usage: clap-test

Options:
  -h, --help     Print help
  -V, --version  Print version
$ cargo run -- -V
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.01s
     Running `target/debug/clap-test -V`
clap-test-name 0.1.0
</code></pre>
<h3>Expected Behaviour</h3>
<p>Both should be the same &quot;clap-test-name&quot; or maybe &quot;clap-test&quot;:</p>
<pre><code class="language-bash">$ cargo run -- -h
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.02s
     Running `target/debug/clap-test -h`
Usage: clap-test-name

Options:
  -h, --help     Print help
  -V, --version  Print version
$ cargo run -- -V
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.01s
     Running `target/debug/clap-test -V`
clap-test-name 0.1.0
</code></pre>
<h3>Additional Context</h3>
<p><em>No response</em></p>
<h3>Debug Output</h3>
<pre><code class="language-bash">$ cargo run -- -h
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.02s
     Running `target/debug/clap-test -h`
[clap_builder::builder::command]Command::_do_parse
[clap_builder::builder::command]Command::_build: name=&quot;clap-test-name&quot;
[clap_builder::builder::command]Command::_propagate:clap-test-name
[clap_builder::builder::command]Command::_check_help_and_version:clap-test-name expand_help_tree=false
[clap_builder::builder::command]Command::long_help_exists
[clap_builder::builder::command]Command::_check_help_and_version: Building default --help
[clap_builder::builder::command]Command::_check_help_and_version: Building default --version
[clap_builder::builder::command]Command::_propagate_global_args:clap-test-name
[clap_builder::builder::debug_asserts]Command::_debug_asserts
[clap_builder::builder::debug_asserts]Arg::_debug_asserts:help
[clap_builder::builder::debug_asserts]Arg::_debug_asserts:version
[clap_builder::builder::debug_asserts]Command::_verify_positionals
[clap_builder::parser::parser]Parser::get_matches_with
[clap_builder::parser::parser]Parser::parse
[clap_builder::parser::parser]Parser::get_matches_with: Begin parsing '&quot;-h&quot;'
[clap_builder::parser::parser]Parser::possible_subcommand: arg=Ok(&quot;-h&quot;)
[clap_builder::parser::parser]Parser::get_matches_with: sc=None
[clap_builder::parser::parser]Parser::parse_short_arg: short_arg=ShortFlags { inner: &quot;h&quot;, utf8_prefix: CharIndices { front_offset: 0, iter: Chars(['h']) }, invalid_suffix: None }
[clap_builder::parser::parser]Parser::parse_short_arg:iter:h
[clap_builder::parser::parser]Parser::parse_short_arg:iter:h: Found valid opt or flag
[clap_builder::parser::parser]Parser::react action=Help, identifier=Some(Short), source=CommandLine
[clap_builder::parser::parser]Help: use_long=false
[clap_builder::builder::command]Command::write_help_err: clap-test-name, use_long=false
[  clap_builder::output::help]write_help
[clap_builder::output::help_template]HelpTemplate::new cmd=clap-test-name, use_long=false
[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help
[clap_builder::output::help_template]HelpTemplate::write_templated_help
[clap_builder::output::help_template]HelpTemplate::write_before_help
[ clap_builder::output::usage]Usage::create_usage_no_title
[ clap_builder::output::usage]Usage::create_usage_no_title
[ clap_builder::output::usage]Usage::write_help_usage
[ clap_builder::output::usage]Usage::write_arg_usage; incl_reqs=true
[ clap_builder::output::usage]Usage::needs_options_tag
[ clap_builder::output::usage]Usage::needs_options_tag:iter: f=help
[ clap_builder::output::usage]Usage::needs_options_tag:iter Option is built-in
[ clap_builder::output::usage]Usage::needs_options_tag:iter: f=version
[ clap_builder::output::usage]Usage::needs_options_tag:iter Option is built-in
[ clap_builder::output::usage]Usage::needs_options_tag: [OPTIONS] not required
[ clap_builder::output::usage]Usage::write_args: incls=[]
[ clap_builder::output::usage]Usage::get_args: unrolled_reqs=[]
[ clap_builder::output::usage]Usage::write_subcommand_usage
[ clap_builder::output::usage]Usage::create_usage_no_title: usage=clap-test
[clap_builder::output::help_template]HelpTemplate::write_all_args
[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help
[clap_builder::output::help_template]should_show_arg: use_long=false, arg=version
[clap_builder::output::help_template]HelpTemplate::write_args Options
[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help
[clap_builder::output::help_template]HelpTemplate::write_args: arg=&quot;help&quot; longest=10
[clap_builder::output::help_template]should_show_arg: use_long=false, arg=version
[clap_builder::output::help_template]HelpTemplate::write_args: arg=&quot;version&quot; longest=13
[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help
[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--help
[clap_builder::output::help_template]HelpTemplate::spec_vals: Found short aliases...[]
[clap_builder::output::help_template]HelpTemplate::spec_vals: Found aliases...[]
[clap_builder::output::help_template]should_show_arg: use_long=false, arg=version
[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--version
[clap_builder::output::help_template]HelpTemplate::spec_vals: Found short aliases...[]
[clap_builder::output::help_template]HelpTemplate::spec_vals: Found aliases...[]
[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--help
[clap_builder::output::help_template]HelpTemplate::spec_vals: Found short aliases...[]
[clap_builder::output::help_template]HelpTemplate::spec_vals: Found aliases...[]
[clap_builder::output::help_template]HelpTemplate::short
[clap_builder::output::help_template]HelpTemplate::long
[clap_builder::output::help_template]HelpTemplate::align_to_about: arg=help, next_line_help=false, longest=13
[clap_builder::output::help_template]HelpTemplate::align_to_about: positional=false arg_len=10, spaces=5
[clap_builder::output::help_template]HelpTemplate::help
[clap_builder::output::help_template]HelpTemplate::help: help_width=17, spaces=10, avail=83
[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--version
[clap_builder::output::help_template]HelpTemplate::spec_vals: Found short aliases...[]
[clap_builder::output::help_template]HelpTemplate::spec_vals: Found aliases...[]
[clap_builder::output::help_template]HelpTemplate::short
[clap_builder::output::help_template]HelpTemplate::long
[clap_builder::output::help_template]HelpTemplate::align_to_about: arg=version, next_line_help=false, longest=13
[clap_builder::output::help_template]HelpTemplate::align_to_about: positional=false arg_len=13, spaces=2
[clap_builder::output::help_template]HelpTemplate::help
[clap_builder::output::help_template]HelpTemplate::help: help_width=17, spaces=13, avail=83
[clap_builder::output::help_template]HelpTemplate::write_after_help
[clap_builder::builder::command]Command::color: Color setting...
[clap_builder::builder::command]Auto
[clap_builder::builder::command]Command::color: Color setting...
[clap_builder::builder::command]Auto
Usage: clap-test

Options:
  -h, --help     Print help
  -V, --version  Print version
$ cargo run -- -V
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.02s
     Running `target/debug/clap-test -V`
[clap_builder::builder::command]Command::_do_parse
[clap_builder::builder::command]Command::_build: name=&quot;clap-test-name&quot;
[clap_builder::builder::command]Command::_propagate:clap-test-name
[clap_builder::builder::command]Command::_check_help_and_version:clap-test-name expand_help_tree=false
[clap_builder::builder::command]Command::long_help_exists
[clap_builder::builder::command]Command::_check_help_and_version: Building default --help
[clap_builder::builder::command]Command::_check_help_and_version: Building default --version
[clap_builder::builder::command]Command::_propagate_global_args:clap-test-name
[clap_builder::builder::debug_asserts]Command::_debug_asserts
[clap_builder::builder::debug_asserts]Arg::_debug_asserts:help
[clap_builder::builder::debug_asserts]Arg::_debug_asserts:version
[clap_builder::builder::debug_asserts]Command::_verify_positionals
[clap_builder::parser::parser]Parser::get_matches_with
[clap_builder::parser::parser]Parser::parse
[clap_builder::parser::parser]Parser::get_matches_with: Begin parsing '&quot;-V&quot;'
[clap_builder::parser::parser]Parser::possible_subcommand: arg=Ok(&quot;-V&quot;)
[clap_builder::parser::parser]Parser::get_matches_with: sc=None
[clap_builder::parser::parser]Parser::parse_short_arg: short_arg=ShortFlags { inner: &quot;V&quot;, utf8_prefix: CharIndices { front_offset: 0, iter: Chars(['V']) }, invalid_suffix: None }
[clap_builder::parser::parser]Parser::parse_short_arg:iter:V
[clap_builder::parser::parser]Parser::parse_short_arg:iter:V: Found valid opt or flag
[clap_builder::parser::parser]Parser::react action=Version, identifier=Some(Short), source=CommandLine
[clap_builder::parser::parser]Version: use_long=false
[clap_builder::builder::command]Command::_render_version
[clap_builder::builder::command]Command::color: Color setting...
[clap_builder::builder::command]Auto
[clap_builder::builder::command]Command::color: Color setting...
[clap_builder::builder::command]Auto
clap-test-name 0.1.0
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @winksaville on 2025-08-10 05:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-help</span> added by @epage on 2025-08-11 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-08-11 14:40</div>
            <div class="timeline-body"><p><code>Command</code> / <code>#[command()]</code> actually has a couple of different fields</p>
<ul>
<li><a href="https://docs.rs/clap/latest/clap/struct.Command.html#method.name"><code>name</code></a><ul>
<li>For subcommands, this is meant to match what the user specified</li>
<li>For top-level commands, this serves as the default for <code>*_name</code> fields.  This doesn't have much meaning otherwise.</li>
</ul>
</li>
<li><a href="https://docs.rs/clap/latest/clap/struct.Command.html#method.bin_name"><code>bin_name</code></a><ul>
<li>This shows up in Usage</li>
</ul>
</li>
<li><a href="https://docs.rs/clap/latest/clap/struct.Command.html#method.display_name"><code>display_name</code></a><ul>
<li>This is used in <code>--version</code> or any other place where the application is being described.</li>
</ul>
</li>
</ul>
<p>It is traditional that Usage strings more literally match the command-line used.  For this reason, <code>bin_name</code> defaults to <code>argv[0].file_name()</code> if being used when parsing and <code>name</code> otherwise.  This is what is leading to your discrepancy.  <code>--help</code> is generated when parsing a command line, so <code>binary_name</code> is <code>argv[0].file_name()</code> while in <code>--version</code> you are getting a user-facing display name for the program.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/winksaville">@winksaville</a> on 2025-08-11 19:24</div>
            <div class="timeline-body"><p>You've explained why they are different, but should they be different, IMO they shouldn't.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-08-11 19:53</div>
            <div class="timeline-body"><p>Originally, we only had <code>name</code>.  The others were added to address various needs.</p>
<p>For example,</p>
<ul>
<li>In many cases, people want their bin name to be <code>space separated</code></li>
<li>In many cases, people want their display name to be <code>dash-separated</code></li>
</ul>
<p>A very strong case would need to be made to outweigh what we've already done and it would likely only happen with clap v5.</p>
<p>However, what we can do is see if there is anything we can improve about how these are communicated so people are less likely to be confused.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/winksaville">@winksaville</a> on 2025-08-11 23:47</div>
            <div class="timeline-body"><p>Here is another example using your demo.rs:</p>
<pre><code>$ cat src/main.rs 
use clap::Parser;

/// Simple program to greet a person
#[derive(Parser, Debug)]
#[command(version, about, long_about = None)]
struct Args {
    /// Name of the person to greet
    #[arg(short, long)]
    name: String,

    /// Number of times to greet
    #[arg(short, long, default_value_t = 1)]
    count: u8,
}

fn main() {
    let args = Args::parse();

    for _ in 0..args.count {
        println!(&quot;Hello {}!&quot;, args.name);
    }
}
$ cat Cargo.toml 
[package]
name = &quot;demo&quot;
version = &quot;0.1.0&quot;
description = &quot;A demo project using clap&quot;
edition = &quot;2024&quot;

[dependencies]
clap = { version = &quot;4.5.43&quot;, features = [&quot;derive&quot;] }
</code></pre>
<p>Install it:</p>
<pre><code>$ cargo install --path .
  Installing demo v0.1.0 (/home/wink/data/prgs/clap/demo)
    Updating crates.io index
     Locking 30 packages to latest Rust 1.89.0 compatible versions
    Finished `release` profile [optimized] target(s) in 0.21s
  Installing /home/wink/.cargo/bin/demo
   Installed package `demo v0.1.0 (/home/wink/data/prgs/clap/demo)` (executable `demo`)
</code></pre>
<p>The default behavior is <code>-h</code> and <code>-V</code> are the same, as we expect:</p>
<pre><code>$ demo -h
A demo project using clap

Usage: demo [OPTIONS] --name &lt;NAME&gt;

Options:
  -n, --name &lt;NAME&gt;    Name of the person to greet
  -c, --count &lt;COUNT&gt;  Number of times to greet [default: 1]
  -h, --help           Print help
  -V, --version        Print version
$ demo -V
demo 0.1.0
</code></pre>
<p>But now lets rename <code>demo</code> to <code>demoz</code>.</p>
<p>We see <code>-h</code> is <code>demoz</code> and <code>-V</code> is <code>demo</code>:</p>
<pre><code>$ mv ~/.cargo/bin/demo ~/.cargo/bin/demoz
$ demoz -h
A demo project using clap

Usage: demoz [OPTIONS] --name &lt;NAME&gt;

Options:
  -n, --name &lt;NAME&gt;    Name of the person to greet
  -c, --count &lt;COUNT&gt;  Number of times to greet [default: 1]
  -h, --help           Print help
  -V, --version        Print version
$ demoz -V
demo 0.1.0
</code></pre>
<p>That doesn't feel right to me, but renaming an executable is an infrequent corner case and maybe not important.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-08-12 13:25</div>
            <div class="timeline-body"><p>Yes, Usage using the user-specified file name for the binary is partially what this is about, as mentioned at https://github.com/clap-rs/clap/issues/6100#issuecomment-3175169003</p>
<blockquote>
<p>It is traditional that Usage strings more literally match the command-line used. For this reason, <code>bin_name</code> defaults to <code>argv[0].file_name()</code> if being used when parsing and <code>name</code> otherwise. This is what is leading to your discrepancy. <code>--help</code> is generated when parsing a command line, so <code>binary_name</code> is <code>argv[0].file_name()</code> while in <code>--version</code> you are getting a user-facing display name for the program.</p>
</blockquote>
<p>Some programs take this further and don't use <code>.file_name()</code> but use the full path.  So if you do <code>./target/debug/demoz</code>, then that whole string will appear in the usage, rather than just <code>demoz</code> like clap does.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/winksaville">@winksaville</a> on 2025-08-12 14:19</div>
            <div class="timeline-body"><p>So what do you think the solution for this issue?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-08-12 16:36</div>
            <div class="timeline-body"><p>I lean towards closing this because it is working as expected.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/winksaville">@winksaville</a> on 2025-08-12 17:45</div>
            <div class="timeline-body"><p>Your decision, but I think it's unexpected, but that's just me :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2025-08-12 17:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-wont-fix</span> added by @epage on 2025-08-12 17:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Name field can be incorrect" to "`name` ignored in usage, showing the binary file name" by @epage on 2025-08-12 17:52</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:09 UTC
    </footer>
</body>
</html>
