<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Using `number_of_values` and `default_value` together - clap-rs/clap #1050</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Using <code>number_of_values</code> and <code>default_value</code> together</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1050">#1050</a>
        opened by <a href="https://github.com/Frederick888">@Frederick888</a>
        on 2017-09-19 09:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Frederick888">@Frederick888</a></div>
            <div class="timeline-body"><p>Found this issue with <code>clap 2.26.2</code></p>
<p>It seems that currently the default value is implemented by appending it to the existing matches. But it causes issues if a combination of  <code>number_of_values</code> and <code>default_value</code> is used.</p>
<p>For instance,</p>
<pre><code class="language-rust">extern crate clap;

use clap::{App, Arg};

fn main() {
    let m = App::new(&quot;hello_world&quot;)
        .arg(
            Arg::with_name(&quot;exit-code&quot;)
                .long(&quot;exit-code&quot;)
                .required(true)
                .takes_value(true)
                .number_of_values(1)
                .default_value(&quot;0&quot;),
        )
        .get_matches();
    println!(
        &quot;{:?}&quot;,
        m.values_of(&quot;exit-code&quot;).unwrap().collect::&lt;Vec&lt;_&gt;&gt;()
    );
}
</code></pre>
<pre><code>⇒  ./hello_world --exit-code
[&quot;0&quot;]
⇒  ./hello_world --exit-code 1
error: The argument '--exit-code &lt;exit-code&gt;' requires 1 values, but 2 were provided

USAGE:
    hello_world --exit-code &lt;exit-code&gt;

For more information try --help
</code></pre>
<p>Changing <code>number_of_values(1)</code> to <code>number_of_values(2)</code> would make it work if the argument is correctly given but the error message is still off when it's not provided:</p>
<pre><code>⇒  ./hello_world --exit-code  
error: The argument '--exit-code &lt;exit-code&gt; &lt;exit-code&gt;' requires 2 values, but 1 was provided

USAGE:
    hello_world --exit-code &lt;exit-code&gt; &lt;exit-code&gt;

For more information try --help
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../kbknapp/cargo-outdated/issues/63.html">kbknapp/cargo-outdated#63</a> on 2017-09-19 09:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Frederick888">@Frederick888</a> on 2017-09-20 09:27</div>
            <div class="timeline-body"><pre><code class="language-diff">diff --git a/src/app/parser.rs b/src/app/parser.rs
index 6ec72034..35eb3f9b 100644
--- a/src/app/parser.rs
+++ b/src/app/parser.rs
@@ -1733,15 +1733,8 @@ impl&lt;'a, 'b&gt; Parser&lt;'a, 'b&gt;
                 if let Some(ref val) = $a.v.default_val {
                     if $m.get($a.b.name).map(|ma| ma.vals.len()).map(|len| len == 0).unwrap_or(false) {
                         $_self.add_val_to_arg($a, OsStr::new(val), $m)?;
 
-                        if $_self.cache.map_or(true, |name| name != $a.name()) {
-                            arg_post_processing!($_self, $a, $m);
-                            $_self.cache = Some($a.name());
-                        }
-                    } else {
-                        $_self.add_val_to_arg($a, OsStr::new(val), $m)?;
-
                         if $_self.cache.map_or(true, |name| name != $a.name()) {
                             arg_post_processing!($_self, $a, $m);
                             $_self.cache = Some($a.name());
                         }
</code></pre>
<p>...fixes it for me. But I'm not really clear about the purpose of the codes here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-10-04 03:14</div>
            <div class="timeline-body"><p>Yep, I just saw this when going through #1056</p>
<p>I'm not sure why it's doing the same thing in both branches :confused:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1056.html">clap-rs/clap#1056</a> on 2017-10-04 03:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: parsing</span> added by @kbknapp on 2017-10-04 03:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by @kbknapp on 2017-10-04 03:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">M: mentored</span> added by @kbknapp on 2017-10-04 03:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> added by @kbknapp on 2017-10-04 03:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @kbknapp on 2017-10-04 03:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @kbknapp on 2017-10-04 03:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "2.27.0" by @kbknapp on 2017-10-12 21:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../JP-Ellis/mathematica-notebook-filter/issues/1.html">JP-Ellis/mathematica-notebook-filter#1</a> on 2017-10-21 06:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2017-10-25 01:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1037.html">clap-rs/clap#1037</a> on 2017-11-13 01:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:47:00 UTC
    </footer>
</body>
</html>
