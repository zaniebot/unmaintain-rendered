```yaml
number: 2124
title: required_unless not working with yaml
type: issue
state: closed
author: grm
labels:
  - C-bug
  - E-help-wanted
  - E-easy
  - ":money_with_wings: $5"
assignees: []
created_at: 2020-09-05T14:32:36Z
updated_at: 2020-10-09T16:36:34Z
url: https://github.com/clap-rs/clap/issues/2124
synced_at: 2026-01-10T01:57:44Z
```

# required_unless not working with yaml

---

_Issue opened by @grm on 2020-09-05 14:32_

### Make sure you completed the following tasks

- [X] Searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] Searched the closed issues

### Actual Behavior Summary

I cannot make required_unless work with a yaml function !

Here is an extract f the yaml used: 
```yaml
  - register:
        short: r
        long: register
        help: Asks rdss to register the files
        required_unless: stack
  - stack:
        short: s
        long: stack
        help: Asks rdss to stack the files
```

When i execute my program, here is the output i obtain : 
```
$ /target/debug/rdss-cli --stack
error: The following required arguments were not provided:
    --register
```

I am not sur I am using the *required_unless* he right way in yaml
I tried by using strings (e.g. double quotes) in the yaml file with no success.

Does someone mange to make ti work in yaml ?

Thanks for your help,
Jérémie

---

_Label `T: bug` added by @grm on 2020-09-05 14:32_

---

_Label `:money_with_wings: $5` added by @pksunkara on 2020-10-05 15:26_

---

_Label `C: yaml parser` added by @pksunkara on 2020-10-05 15:26_

---

_Label `Z: good first issue` added by @pksunkara on 2020-10-05 15:26_

---

_Label `help wanted` added by @pksunkara on 2020-10-05 15:26_

---

_Comment by @thiagoarrais on 2020-10-08 17:24_

I have tried to reproduce this but couldn't. What version are you using, @grm?

I have made a `cli.yaml` based on your example and created a simple program that simply outputs if the `stack` flag was used. Here's what I get when using `v2.33.3` (latest in v2 series AFAIK):

```
$ ./target/debug/myclap        
error: The following required arguments were not provided:
    --register

USAGE:
    myclap [FLAGS] --register

For more information try --help
$ ./target/debug/myclap --stack
--stack was used
```

And here's what I get with both the current main branch tip (9163374) and `v3.0.0-beta.2`

```
$ ./target/debug/myclap
thread 'main' panicked at 'Unknown Arg setting 'required_unless' in YAML file for arg 'register'', /path/to/clap/src/build/arg/mod.rs:4426:22
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
```

But this can be fixed if you use `required_unless_present` instead of `required_unless`:

```
$ ./target/debug/myclap
error: The following required arguments were not provided:
    --register

USAGE:
    myclap --register

For more information try --help
$ ./target/debug/myclap --stack
--stack was used
```

---

_Comment by @pksunkara on 2020-10-09 16:36_

Thanks for looking into this @thiagoarrais.

@grm I am closing this for now and please comment with a clear failing example if you want me to open this.

---

_Closed by @pksunkara on 2020-10-09 16:36_

---
