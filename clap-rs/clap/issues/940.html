<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bug/inconsistency with the help formatting - clap-rs/clap #940</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Bug/inconsistency with the help formatting</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/940">#940</a>
        opened by <a href="https://github.com/golddranks">@golddranks</a>
        on 2017-04-24 04:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/golddranks">@golddranks</a> on 2017-04-24 04:20</div>
            <div class="timeline-body"><p>Not sure if this is intended or not, but I can't see any reason for this: the value name of trailing var arguments is printed differently in the usage string from how it's printed in the argument list.</p>
<h3>Rust Version</h3>
<p>rustc 1.18.0-nightly (2bd4b5c6d 2017-04-23)</p>
<h3>Affected Version of clap</h3>
<p>clap 2.23.2</p>
<h3>Expected Behavior Summary</h3>
<pre><code>$ cargo flamegraph --help</code></pre>
<p>Should print out:</p>
<pre><code>cargo-flamegraph

USAGE:
    cargo flamegraph [FLAGS] [OPTIONS] [&lt;BINFILE&gt;] [-- &lt;ARGS&gt;...]

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information
    -v, --verbose    Prints out more stuff.

OPTIONS:
    -f, --frequency &lt;HERTZ&gt;    The sampling frequency. By default, this is 99 Hz.
    -t, --timeout &lt;SECONDS&gt;    Timeout in seconds. By default, there is no timeout.

ARGS:
    &lt;BINFILE&gt;    The path of the binary to be profiled. If empty, Cargo.toml is searched for a binary.
    &lt;ARGS&gt;...       Any arguments you wish to pass to the binary being profiled.
</code></pre>
<h3>Actual Behavior Summary</h3>
<p>It prints out: (Note the discrepancy between <code>&lt;pass through args&gt;</code> and <code>&lt;ARGS&gt;...</code>)</p>
<pre><code>cargo-flamegraph

USAGE:
    cargo flamegraph [FLAGS] [OPTIONS] [&lt;BINFILE&gt;] [-- &lt;pass through args&gt;]

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information
    -v, --verbose    Prints out more stuff.

OPTIONS:
    -f, --frequency &lt;HERTZ&gt;    The sampling frequency. By default, this is 99 Hz.
    -t, --timeout &lt;SECONDS&gt;    Timeout in seconds. By default, there is no timeout.

ARGS:
    &lt;BINFILE&gt;    The path of the binary to be profiled. If empty, Cargo.toml is searched for a binary.
    &lt;ARGS&gt;...       Any arguments you wish to pass to the binary being profiled.
</code></pre>
<h3>Steps to Reproduce the issue</h3>
<p>N/A</p>
<h3>Sample Code or Link to Sample Code</h3>
<pre><code>fn main() {
    let matches = App::new(&quot;cargo flamegraph&quot;)
        .version(&quot;0.1&quot;)
        .bin_name(&quot;cargo&quot;)
        .about(&quot;Profiles your program and draws a nice flamegraph!&quot;)
        .author(&quot;Pyry Kontio&quot;)
        .setting(AppSettings::TrailingVarArg)
        .subcommand(SubCommand::with_name(&quot;flamegraph&quot;)
            .arg(Arg::with_name(&quot;verbose&quot;)
                .help(&quot;Prints out more stuff.&quot;)
                .short(&quot;v&quot;)
                .long(&quot;verbose&quot;)
                .multiple(true)
            )
            .arg(Arg::with_name(&quot;timeout&quot;)
                .help(&quot;Timeout in seconds. By default, there is no timeout.&quot;)
                .short(&quot;t&quot;)
                .long(&quot;timeout&quot;)
                .value_name(&quot;SECONDS&quot;)
                .takes_value(true)
            )
            .arg(Arg::with_name(&quot;frequency&quot;)
                .help(&quot;The sampling frequency. By default, this is 99 Hz.&quot;)
                .short(&quot;f&quot;)
                .long(&quot;frequency&quot;)
                .value_name(&quot;HERTZ&quot;)
                .takes_value(true)
            )
            .arg(Arg::with_name(&quot;binary path&quot;)
                .help(&quot;The path of the binary to be profiled. If empty, Cargo.toml is searched for a binary.&quot;)
                .takes_value(true)
                .value_name(&quot;BINFILE&quot;)
            )
            .arg(Arg::with_name(&quot;pass through args&quot;)
                .help(&quot;Any arguments you wish to pass to the binary being profiled.&quot;)
                .value_name(&quot;ARGS&quot;)
                .last(true)
                .multiple(true)
            )
        )
        .get_matches();
}
</code></pre>
<h3>Debug output</h3>
<p>DEBUG:clap:Parser::add_subcommand: term_w=None, name=flamegraph
DEBUG:clap:Parser::propogate_settings: self=cargo flamegraph, g_settings=AppFlags(
NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO
)
DEBUG:clap:Parser::propogate_settings: sc=flamegraph, settings=AppFlags(
NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO | DONT_COLLAPSE_ARGS | CONTAINS_LAST
), g_settings=AppFlags(
NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO
)
DEBUG:clap:Parser::propogate_settings: self=flamegraph, g_settings=AppFlags(
NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:Parser::create_help_and_version: Building help
DEBUG:clap:Parser::get_matches_with: Begin parsing '&quot;flamegraph&quot;' ([102, 108, 97, 109, 101, 103, 114, 97, 112, 104])
DEBUG:clap:Parser::is_new_arg: arg=&quot;flamegraph&quot;, Needs Val of=None
DEBUG:clap:Parser::is_new_arg: Arg::allow_leading_hyphen(false)
DEBUG:clap:Parser::is_new_arg: probably value
DEBUG:clap:Parser::is_new_arg: starts_new_arg=false
DEBUG:clap:Parser::possible_subcommand: arg=&quot;flamegraph&quot;
DEBUG:clap:Parser::get_matches_with: possible_sc=true, sc=Some(&quot;flamegraph&quot;)
DEBUG:clap:Parser::parse_subcommand;
DEBUG:clap:usage::get_required_usage_from: reqs=[], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:Parser::parse_subcommand: About to parse sc=flamegraph
DEBUG:clap:Parser::parse_subcommand: sc settings=AppFlags(
NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO | DONT_COLLAPSE_ARGS | CONTAINS_LAST
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:Parser::get_matches_with: Begin parsing '&quot;--help&quot;' ([45, 45, 104, 101, 108, 112])
DEBUG:clap:Parser::is_new_arg: arg=&quot;--help&quot;, Needs Val of=None
DEBUG:clap:Parser::is_new_arg: Arg::allow_leading_hyphen(false)
DEBUG:clap:Parser::is_new_arg: -- found
DEBUG:clap:Parser::is_new_arg: starts_new_arg=true
DEBUG:clap:Parser::possible_subcommand: arg=&quot;--help&quot;
DEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None
DEBUG:clap:Parser::parse_long_arg;
DEBUG:clap:Parser::parse_long_arg: Does it contain '='...No
DEBUG:clap:Parser::parse_long_arg: Found valid flag '--help'
DEBUG:clap:Parser::check_for_help_and_version_str;
DEBUG:clap:Parser::check_for_help_and_version_str: Checking if --help is help or version...Help
DEBUG:clap:Parser::_help: use_long=true
DEBUG:clap:Parser::use_long_help: ret=false
DEBUG:clap:Help::write_parser_help;
DEBUG:clap:Help::write_parser_help;
DEBUG:clap:Parser::color;
DEBUG:clap:Parser::color: Color setting...Auto
DEBUG:clap:Help::new;
DEBUG:clap:Help::write_help;
DEBUG:clap:Help::write_default_help;
DEBUG:clap:Help::write_bin_name;
DEBUG:clap:Help::write_version;
DEBUG:clap:usage::create_usage_no_title;
DEBUG:clap:usage::get_required_usage_from: reqs=[], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:usage::needs_flags_tag;
DEBUG:clap:usage::needs_flags_tag:iter: f=verbose;
DEBUG:clap:Parser::groups_for_arg: name=verbose
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:usage::needs_flags_tag:iter: [FLAGS] required
DEBUG:clap:usage::get_args_tag;
DEBUG:clap:usage::get_args_tag:iter:binary path:
DEBUG:clap:Parser::groups_for_arg: name=binary path
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:usage::get_args_tag:iter: 1 Args not required or hidden
DEBUG:clap:usage::get_args_tag:iter: Exactly one, returning binary path
DEBUG:clap:usage::create_help_usage: pass through args has .last(true)
DEBUG:clap:usage::create_help_usage: usage=cargo flamegraph [FLAGS] [OPTIONS] [<BINFILE>] [-- <pass through args>]
DEBUG:clap:Help::write_all_args;
DEBUG:clap:Help::write_args;
DEBUG:clap:Help::write_args: Current Longest...2
DEBUG:clap:Help::write_args: New Longest...9
DEBUG:clap:Help::write_args: Current Longest...9
DEBUG:clap:Help::write_args: New Longest...9
DEBUG:clap:Help::write_args: Current Longest...9
DEBUG:clap:Help::write_args: New Longest...9
DEBUG:clap:Help::write_arg;
DEBUG:clap:Help::short;
DEBUG:clap:Help::long;
DEBUG:clap:Help::val: arg=--help
DEBUG:clap:Help::spec_vals: a=--help
DEBUG:clap:Help::val: Has switch...Yes
DEBUG:clap:Help::val: force_next_line...false
DEBUG:clap:Help::val: nlh...false
DEBUG:clap:Help::val: taken...21
DEBUG:clap:Help::val: help_width &gt; (width - taken)...23 &gt; (175 - 21)
DEBUG:clap:Help::val: longest...9
DEBUG:clap:Help::val: next_line...No
DEBUG:clap:write_spaces!: num=7
DEBUG:clap:Help::help;
DEBUG:clap:Help::help: Next Line...false
DEBUG:clap:Help::help: Too long...No
DEBUG:clap:Help::write_arg;
DEBUG:clap:Help::short;
DEBUG:clap:Help::long;
DEBUG:clap:Help::val: arg=--version
DEBUG:clap:Help::spec_vals: a=--version
DEBUG:clap:Help::val: Has switch...Yes
DEBUG:clap:Help::val: force_next_line...false
DEBUG:clap:Help::val: nlh...false
DEBUG:clap:Help::val: taken...21
DEBUG:clap:Help::val: help_width &gt; (width - taken)...26 &gt; (175 - 21)
DEBUG:clap:Help::val: longest...9
DEBUG:clap:Help::val: next_line...No
DEBUG:clap:write_spaces!: num=4
DEBUG:clap:Help::help;
DEBUG:clap:Help::help: Next Line...false
DEBUG:clap:Help::help: Too long...No
DEBUG:clap:Help::write_arg;
DEBUG:clap:Help::short;
DEBUG:clap:Help::long;
DEBUG:clap:Help::val: arg=--verbose
DEBUG:clap:Help::spec_vals: a=--verbose
DEBUG:clap:Help::val: Has switch...Yes
DEBUG:clap:Help::val: force_next_line...false
DEBUG:clap:Help::val: nlh...false
DEBUG:clap:Help::val: taken...21
DEBUG:clap:Help::val: help_width &gt; (width - taken)...22 &gt; (175 - 21)
DEBUG:clap:Help::val: longest...9
DEBUG:clap:Help::val: next_line...No
DEBUG:clap:write_spaces!: num=4
DEBUG:clap:Help::help;
DEBUG:clap:Help::help: Next Line...false
DEBUG:clap:Help::help: Too long...No
DEBUG:clap:Help::write_args;
DEBUG:clap:Help::write_args: Current Longest...2
DEBUG:clap:OptBuilder::fmt
DEBUG:clap:Help::write_args: New Longest...19
DEBUG:clap:Help::write_args: Current Longest...19
DEBUG:clap:OptBuilder::fmt
DEBUG:clap:Help::write_args: New Longest...19
DEBUG:clap:Help::write_arg;
DEBUG:clap:Help::short;
DEBUG:clap:Help::long;
DEBUG:clap:Help::val: arg=DEBUG:clap:OptBuilder::fmt
--frequency <HERTZ>
DEBUG:clap:Help::spec_vals: a=DEBUG:clap:OptBuilder::fmt
--frequency <HERTZ>
DEBUG:clap:Help::val: Has switch...Yes
DEBUG:clap:Help::val: force_next_line...false
DEBUG:clap:Help::val: nlh...false
DEBUG:clap:Help::val: taken...31
DEBUG:clap:Help::val: help_width &gt; (width - taken)...50 &gt; (175 - 31)
DEBUG:clap:Help::val: longest...19
DEBUG:clap:Help::val: next_line...No
DEBUG:clap:OptBuilder::fmt
DEBUG:clap:write_spaces!: num=4
DEBUG:clap:Help::help;
DEBUG:clap:Help::help: Next Line...false
DEBUG:clap:Help::help: Too long...No
DEBUG:clap:Help::write_arg;
DEBUG:clap:Help::short;
DEBUG:clap:Help::long;
DEBUG:clap:Help::val: arg=DEBUG:clap:OptBuilder::fmt
--timeout <SECONDS>
DEBUG:clap:Help::spec_vals: a=DEBUG:clap:OptBuilder::fmt
--timeout <SECONDS>
DEBUG:clap:Help::val: Has switch...Yes
DEBUG:clap:Help::val: force_next_line...false
DEBUG:clap:Help::val: nlh...false
DEBUG:clap:Help::val: taken...31
DEBUG:clap:Help::val: help_width &gt; (width - taken)...52 &gt; (175 - 31)
DEBUG:clap:Help::val: longest...19
DEBUG:clap:Help::val: next_line...No
DEBUG:clap:OptBuilder::fmt
DEBUG:clap:write_spaces!: num=4
DEBUG:clap:Help::help;
DEBUG:clap:Help::help: Next Line...false
DEBUG:clap:Help::help: Too long...No
DEBUG:clap:Help::write_args_unsorted;
DEBUG:clap:Help::write_arg;
DEBUG:clap:Help::short;
DEBUG:clap:Help::long;
DEBUG:clap:Help::val: arg=<BINFILE>
DEBUG:clap:Help::spec_vals: a=<BINFILE>
DEBUG:clap:Help::val: Has switch...No, and not next_line
DEBUG:clap:write_spaces!: num=4
DEBUG:clap:Help::help;
DEBUG:clap:Help::help: Next Line...false
DEBUG:clap:Help::help: Too long...No
DEBUG:clap:Help::write_arg;
DEBUG:clap:Help::short;
DEBUG:clap:Help::long;
DEBUG:clap:Help::val: arg=<ARGS>
DEBUG:clap:Help::spec_vals: a=<ARGS>
DEBUG:clap:Help::val: Has switch...No, and not next_line
DEBUG:clap:write_spaces!: num=7
DEBUG:clap:Help::help;
DEBUG:clap:Help::help: Next Line...false
DEBUG:clap:Help::help: Too long...No
cargo-flamegraph</p>
<p>USAGE:
cargo flamegraph [FLAGS] [OPTIONS] [<BINFILE>] [-- <pass through args>]</p>
<p>FLAGS:
-h, --help       Prints help information
-V, --version    Prints version information
-v, --verbose    Prints out more stuff.</p>
<p>OPTIONS:
-f, --frequency <HERTZ>    The sampling frequency. By default, this is 99 Hz.
-t, --timeout <SECONDS>    Timeout in seconds. By default, there is no timeout.</p>
<p>ARGS:
<BINFILE>    The path of the binary to be profiled. If empty, Cargo.toml is searched for a binary.
<ARGS>...       Any arguments you wish to pass to the binary being profiled.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-05-05 01:00</div>
            <div class="timeline-body"><p>Sorry for the long wait. Would doing this solve it?</p>
<pre><code class="language-rust"> .arg(Arg::with_name(&quot;ARGS&quot;)
                .help(&quot;Any arguments you wish to pass to the binary being profiled.&quot;)
                .last(true)
                .multiple(true)
            )
</code></pre>
<p>Although this still probably a bug because it <em>should</em> be using the value name.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: args</span> added by @kbknapp on 2017-05-05 01:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: usage strings</span> added by @kbknapp on 2017-05-05 01:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by @kbknapp on 2017-05-05 01:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> added by @kbknapp on 2017-05-05 01:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @kbknapp on 2017-05-05 01:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @kbknapp on 2017-05-05 01:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/golddranks">@golddranks</a> on 2017-05-06 07:06</div>
            <div class="timeline-body"><p>That does its job the as a workaround, and actually this didn't provide any real problem to <em>me</em> ðŸ˜„ I just thought this might be an unintended inconsistency, so I reported it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "2.24.1" by @kbknapp on 2017-05-06 18:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2017-05-07 14:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-05-07 14:48</div>
            <div class="timeline-body"><p>2.24.1 is on crates.io</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:30 UTC
    </footer>
</body>
</html>
