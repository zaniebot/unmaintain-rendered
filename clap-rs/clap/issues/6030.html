<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>one args conflicts with some others only if condition met - clap-rs/clap #6030</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>one args conflicts with some others only if condition met</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/clap-rs/clap/issues/6030">#6030</a>
        opened by <a href="https://github.com/jnmdf">@jnmdf</a>
        on 2025-06-10 10:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jnmdf">@jnmdf</a> on 2025-06-10 10:14</div>
            <div class="timeline-body"><pre><code class="language-rust">/// 支持的哈希算法枚举
#[derive(Debug, Copy, Clone, PartialEq, Eq, PartialOrd, Ord, ValueEnum)]
enum HashAlgorithm {
    Sha1,
    Sha256,
    Sha384,
    Sha512,
}

/// OAEP 填充选项
#[derive(Debug, Parser)]
#[group(required = false, multiple = false)]
struct OaepOptions {
    /// MGF (Mask Generation Function) 哈希算法
    #[clap(long, value_enum, default_value = &quot;sha256&quot;)]
    mgf: HashAlgorithm,
    
    /// OAEP 哈希算法
    #[clap(long, value_enum, default_value = &quot;sha256&quot;)]
    hash: HashAlgorithm,
    
    /// OAEP 标签 (可选)
    #[clap(long)]
    label: Option&lt;String&gt;,
}

/// 加密参数
#[derive(Debug, Parser)]
#[clap(group(
    ArgGroup::new(&quot;padding_options&quot;)
        .required(false)
        .multiple(false)
        .args(&amp;[&quot;oaep_options&quot;]),
))]
struct EncryptArgs {
    /// 输入文件路径
    input: String,
    
    /// 输出文件路径
    output: String,
    
    /// 公钥文件路径 (PEM 格式)
    #[clap(short, long)]
    public_key: String,
    
    /// 填充方案
    #[clap(short, long, value_enum, default_value = &quot;oaep&quot;)]
    padding: PaddingSchemeChoice,
    
    /// OAEP 特定选项 (仅当 padding=oaep 时可用)
    #[clap(flatten)]
    oaep_options: Option&lt;OaepOptions&gt;,
}

/// 填充方案选择
#[derive(Debug, Copy, Clone, PartialEq, Eq, PartialOrd, Ord, ValueEnum)]
enum PaddingSchemeChoice {
    Pkcs1,
    Oaep,
}

</code></pre>
<p>clap version: 4.5.38
rust version: rustc 1.86.0 (05f9846f8 2025-03-31)
As the code shown above: what i want is making oaep_options conflict with padding if padding value is not oaep (pkcs1 here), in other words, oaep_options should be only allowed if padding=oaep.
After a lot of searching, one method is just ignoring oaep_options if padding != oaep, but in my opinion, raise some error message is more friendly for end users; another idea is using subcommand (make pkcs1 and oaep two subcommands), but i don't like it, because padding is just an option in context of rsa. Anyone has any idea about it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-validators</span> added by @epage on 2025-06-10 15:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @epage on 2025-06-10 15:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> added by @epage on 2025-06-10 15:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-06-10 15:44</div>
            <div class="timeline-body"><p>As a heads up, there are a lot of different validation needs people have, including</p>
<ul>
<li>#4682</li>
<li>#1801</li>
</ul>
<p>We're being a bit cautious in what all validators we add because every new feature has an impact on</p>
<ul>
<li>Build times</li>
<li>Binary size</li>
<li>People's ability to discover the API they need</li>
</ul>
<p>We would be very interested in a exploring ways to generalize the validation so its more pluggable (#3476).</p>
<p>In the mean time, it seems like a case like this could be handled by validating within your application code.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:09 UTC
    </footer>
</body>
</html>
