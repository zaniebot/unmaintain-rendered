<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subcommands break similarly named input values - clap-rs/clap #1389</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Subcommands break similarly named input values</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1389">#1389</a>
        opened by <a href="https://github.com/conways-glider">@conways-glider</a>
        on 2018-11-29 02:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/conways-glider">@conways-glider</a></div>
            <div class="timeline-body">Rust Version
<p>1.30.1</p>
Affected Version of clap
<p>2.32.0</p>
Bug or Feature Request Summary
<p>In the example posted in the README (https://github.com/clap-rs/clap#quick-example), if I try to pass the string <code>test.txt</code>, the program errors, and does not parse my input.</p>
<p>It will break on any file extension or even <code>tesst.txt</code>. When removing the subcommand, the example passes flawlessly.</p>
Expected Behavior Summary
<p>Subcommands are distinctly read from input</p>
Actual Behavior Summary
<p>Subcommands can render args broken for certain commands.
An example output is:</p>
<pre><code>$ cargo run -- &quot;test.txt&quot;
error: The subcommand &#x27;test.txt&#x27; wasn&#x27;t recognized
	Did you mean &#x27;test&#x27;?

If you believe you received this message in error, try re-running with &#x27;sandbox -- test.txt&#x27;

USAGE:
    sandbox [FLAGS] [OPTIONS] &lt;INPUT&gt; [SUBCOMMAND]

For more information try --help
</code></pre>
Steps to Reproduce the issue
<p>Copy &amp; Paste the linked example (https://github.com/clap-rs/clap#quick-example) and try to pass the argument <code>test.txt</code>.</p>
Sample Code or Link to Sample Code
<pre><code>// (Full example with detailed comments in examples/01b_quick_example.rs)
//
// This example demonstrates clap&#x27;s full &#x27;builder pattern&#x27; style of creating arguments which is
// more verbose, but allows easier editing, and at times more advanced options, or the possibility
// to generate arguments dynamically.
extern crate clap;
use clap::{Arg, App, SubCommand};

fn main() {
    let matches = App::new(&quot;My Super Program&quot;)
                          .version(&quot;1.0&quot;)
                          .author(&quot;Kevin K. &lt;kbknapp@gmail.com&gt;&quot;)
                          .about(&quot;Does awesome things&quot;)
                          .arg(Arg::with_name(&quot;config&quot;)
                               .short(&quot;c&quot;)
                               .long(&quot;config&quot;)
                               .value_name(&quot;FILE&quot;)
                               .help(&quot;Sets a custom config file&quot;)
                               .takes_value(true))
                          .arg(Arg::with_name(&quot;INPUT&quot;)
                               .help(&quot;Sets the input file to use&quot;)
                               .required(true)
                               .index(1))
                          .arg(Arg::with_name(&quot;v&quot;)
                               .short(&quot;v&quot;)
                               .multiple(true)
                               .help(&quot;Sets the level of verbosity&quot;))
                          .subcommand(SubCommand::with_name(&quot;test&quot;)
                                      .about(&quot;controls testing features&quot;)
                                      .version(&quot;1.3&quot;)
                                      .author(&quot;Someone E. &lt;someone_else@other.com&gt;&quot;)
                                      .arg(Arg::with_name(&quot;debug&quot;)
                                          .short(&quot;d&quot;)
                                          .help(&quot;print debug information verbosely&quot;)))
                          .get_matches();

    // Gets a value for config if supplied by user, or defaults to &quot;default.conf&quot;
    let config = matches.value_of(&quot;config&quot;).unwrap_or(&quot;default.conf&quot;);
    println!(&quot;Value for config: {}&quot;, config);

    // Calling .unwrap() is safe here because &quot;INPUT&quot; is required (if &quot;INPUT&quot; wasn&#x27;t
    // required we could have used an &#x27;if let&#x27; to conditionally get the value)
    println!(&quot;Using input file: {}&quot;, matches.value_of(&quot;INPUT&quot;).unwrap());

    // Vary the output based on how many times the user used the &quot;verbose&quot; flag
    // (i.e. &#x27;myprog -v -v -v&#x27; or &#x27;myprog -vvv&#x27; vs &#x27;myprog -v&#x27;
    match matches.occurrences_of(&quot;v&quot;) {
        0 =&gt; println!(&quot;No verbose info&quot;),
        1 =&gt; println!(&quot;Some verbose info&quot;),
        2 =&gt; println!(&quot;Tons of verbose info&quot;),
        3 | _ =&gt; println!(&quot;Don&#x27;t be crazy&quot;),
    }

    // You can handle information about subcommands by requesting their matches by name
    // (as below), requesting just the name used, or both at the same time
    if let Some(matches) = matches.subcommand_matches(&quot;test&quot;) {
        if matches.is_present(&quot;debug&quot;) {
            println!(&quot;Printing debug info...&quot;);
        } else {
            println!(&quot;Printing normally...&quot;);
        }
    }
}
</code></pre>
Debug output

 Debug Output 
<pre>
<code>
$ cargo run -- &quot;test.txt&quot;
    Finished dev [unoptimized + debuginfo] target(s) in 0.01s                                                                               
     Running `target/debug/sandbox test.txt`
DEBUG:clap:Parser::add_subcommand: term_w=None, name=test
DEBUG:clap:Parser::propagate_settings: self=My Super Program, g_settings=AppFlags(
    (empty)
)
DEBUG:clap:Parser::propagate_settings: sc=test, settings=AppFlags(
    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO
), g_settings=AppFlags(
    (empty)
)
DEBUG:clap:Parser::propagate_settings: self=test, g_settings=AppFlags(
    (empty)
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:Parser::create_help_and_version: Building help
DEBUG:clap:Parser::get_matches_with: Begin parsing &#x27;&quot;test.txt&quot;&#x27; ([116, 101, 115, 116, 46, 116, 120, 116])
DEBUG:clap:Parser::is_new_arg:&quot;test.txt&quot;:NotFound
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: probably value
DEBUG:clap:Parser::is_new_arg: starts_new_arg=false
DEBUG:clap:Parser::possible_subcommand: arg=&quot;test.txt&quot;
DEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None
DEBUG:clap:usage::create_usage_with_title;
DEBUG:clap:usage::create_usage_no_title;
DEBUG:clap:usage::get_required_usage_from: reqs=[&quot;INPUT&quot;], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=[&quot;INPUT&quot;]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:usage::needs_flags_tag;
DEBUG:clap:usage::needs_flags_tag:iter: f=v;
DEBUG:clap:Parser::groups_for_arg: name=v
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:usage::needs_flags_tag:iter: [FLAGS] required
DEBUG:clap:usage::create_help_usage: usage=sandbox [FLAGS] [OPTIONS]  [SUBCOMMAND]
DEBUG:clap:Parser::color;
DEBUG:clap:Parser::color: Color setting...Auto
DEBUG:clap:is_a_tty: stderr=true
DEBUG:clap:Colorizer::error;
DEBUG:clap:Colorizer::warning;
DEBUG:clap:Colorizer::good;
DEBUG:clap:Colorizer::good;
DEBUG:clap:Colorizer::good;
error: The subcommand &#x27;test.txt&#x27; wasn&#x27;t recognized
	Did you mean &#x27;test&#x27;?

<p>If you believe you received this message in error, try re-running with &#x27;sandbox -- test.txt&#x27;</p>
<p>USAGE:
sandbox [FLAGS] [OPTIONS]  [SUBCOMMAND]</p>
<p>For more information try --help</p>
</code>
</pre>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Subcommands break some input values&quot; to &quot;Subcommands break similarly named input values&quot; by <a href="https://github.com/conways-glider">@conways-glider</a> on 2018-11-29 04:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/conways-glider">@conways-glider</a> on 2018-11-30 20:27</div>
            <div class="timeline-body"><p>Upon digging in, it seems related to the <code>suggestions</code> feature. When providing <code>test.txt</code>, it errors and asks if I meant <code>test</code>. When providing <code>hello</code>, it errors and asks if I mean <code>help</code>. I think the <code>suggestions</code> feature has issues with accepting an arg that doesn&#x27;t use <code>short</code> or <code>long</code>, such as the required input arg.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/conways-glider">@conways-glider</a> on 2018-12-13 16:54</div>
            <div class="timeline-body"><p>Upon further review, it looks like this is a dupe of <a href="https://github.com/clap-rs/clap/issues/878">clap-rs/clap#878</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/conways-glider">@conways-glider</a> on 2018-12-13 16:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:57:19 UTC
    </footer>
</body>
</html>
