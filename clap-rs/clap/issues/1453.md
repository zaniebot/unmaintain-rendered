```yaml
number: 1453
title: "[Feature Request] default value from function (or closure)"
type: issue
state: closed
author: pbzweihander
labels:
  - E-help-wanted
assignees: []
created_at: 2019-04-11T02:36:03Z
updated_at: 2025-01-20T03:41:16Z
url: https://github.com/clap-rs/clap/issues/1453
synced_at: 2026-01-10T01:57:43Z
```

# [Feature Request] default value from function (or closure)

---

_Issue opened by @pbzweihander on 2019-04-11 02:36_

It would be great if I can make default values from functions, not literals.

For example, if I want to get some options from args, but if not exists, I want to fallback to environment variables, and if not exists either, I want to panic. Like this:

```rust
Arg::with_name("some-arg").default_from(|| {
    std::env::var("SOME_ARG").expect("Some arg is not found neither opt nor envvar")
));
```

If this is possible, I can make the 'environment variable part' lazily evaluated!


---

_Comment by @ananthp on 2019-05-02 13:23_

I thought it's already possible to generate a value from a function and use it as default value for an argument:

```
Arg::with_name("path")
    .default_value(generate_default_path())
```

The problem is:

- `generate_default_path()` dynamically constructs a value. It has to return `String`, not `&str`, but `default_value()` expects `&str`
- `.default_value(&generate_default_path())` has a lifetime issue. The borrowed value will expire by the time `get_matches()` returns the value. So, the parsed arguments can not be used.

---

_Comment by @frol on 2019-05-13 17:50_

Another problem of `.default_value(generate_default_path())` is laziness, i.e. `generate_default_path()` will be executed even if the value was provided.

---

_Label `T: new feature` added by @CreepySkeleton on 2020-02-01 14:38_

---

_Label `W: postponed` added by @CreepySkeleton on 2020-02-01 14:38_

---

_Comment by @CreepySkeleton on 2020-02-01 14:38_

Does anybody really need this? I doubt this calculations can ever be complex.

---

_Comment by @frol on 2020-02-01 14:59_

@CreepySkeleton The calculations could be non-complex, but they may involve some remote resource fetching or file reading, which you would prefer to avoid.

---

_Label `help wanted` added by @CreepySkeleton on 2020-02-01 15:02_

---

_Comment by @pksunkara on 2020-02-01 19:27_

I think this can be done with the hook feature that was described in https://github.com/clap-rs/clap/issues/1634#issuecomment-575885740. Do you guys agree?

---

_Comment by @CreepySkeleton on 2020-02-02 02:43_

Yes, indeed. Closing in favor of https://github.com/clap-rs/clap/issues/1634#issuecomment-575885740

---

_Closed by @CreepySkeleton on 2020-02-02 02:43_

---

_Comment by @Chris-Sahyouni on 2024-07-20 15:12_

Is it possible to achieve this using the Derive API? For example in my case I have an id arg that I want to default to a random hex string if it is not provided at runtime. Is it possible to do something like:
`#[arg(default_value = |<function logic>|]`

---

_Comment by @yuezk on 2025-01-20 03:41_

> Is it possible to achieve this using the Derive API? For example in my case I have an id arg that I want to default to a random hex string if it is not provided at runtime. Is it possible to do something like:
> `#[arg(default_value = |<function logic>|]`

Derive API also supports it, see https://github.com/clap-rs/clap/issues/1777#issuecomment-2059027180

---
