<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>default_value may not be included in possible_values and only checked in a runtime - clap-rs/clap #3202</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>default_value may not be included in possible_values and only checked in a runtime</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/clap-rs/clap/issues/3202">#3202</a>
        opened by <a href="https://github.com/Gordon01">@Gordon01</a>
        on 2021-12-21 12:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Gordon01">@Gordon01</a> on 2021-12-21 12:36</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
<h3>Clap Version</h3>
<p>3.0.0-rc.7</p>
<h3>Describe your use case</h3>
<p>A configuration when a <code>default_value</code> is not listed in <code>possible_values</code> is valid and i only get error in runtime.</p>
<p>example
<code>#[clap(short, long, default_value_t = 64, possible_values = [&quot;16&quot;, &quot;32&quot;])]</code>
this also works:
<code>#[clap(short, long, default_value = &quot;64&quot;, possible_values = [&quot;16&quot;, &quot;32&quot;])]</code></p>
<h3>Describe the solution you'd like</h3>
<p>I want to get error at compile time.
Maybe implementing a https://github.com/clap-rs/clap/issues/3201 may automatically resolve this issue.</p>
<pre><code>#[clap(short, long, default_value_t = 128, possible_values = [&quot;12&quot;, &quot;16&quot;, &quot;32&quot;])]
fat: u8,

error: default value is not in range of possible values
</code></pre>
<h3>Alternatives, if applicable</h3>
<p><em>No response</em></p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @Gordon01 on 2021-12-21 12:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-21 14:24</div>
            <div class="timeline-body"><p>It would help if you included a fully working code sample and the current runtime error output.  I have some guesses as to which errors you are seeing but I'd have to recreate a working sample to verify.  This is needed to triage this for how important it is for resolving.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-triage</span> added by @epage on 2021-12-21 14:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Gordon01">@Gordon01</a> on 2021-12-22 19:05</div>
            <div class="timeline-body"><pre><code class="language-rust">use clap::Parser;

#[derive(Parser)]
#[clap(author, version, about)]
struct Cli {
    #[clap(default_value = &quot;4&quot;, possible_values = [&quot;1&quot;, &quot;3&quot;, &quot;5&quot;])]
    count: u8,
}

fn main() {
    let cli = Cli::parse();

    println!(&quot;Count: {}&quot;, cli.count);
}
</code></pre>
<p>cargo run -q</p>
<blockquote>
<p>error: &quot;4&quot; isn't a valid value for '&lt;COUNT&gt;'
[possible values: 1, 3, 5]</p>
</blockquote>
<p>So yeah, this is just an ergonomic issue, but it would be great if this error could be checked at compile time.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-22 19:19</div>
            <div class="timeline-body"><p>Thanks!  i'm surprised we leave this to being an error from the validators.</p>
<p>The first priority would be to add a debug assert for this.  That will catch it in all of our APIs.  In our migration guide, we've recommended making tests out of the debug asserts.  We should also add that to the regular documentation.</p>
<p>#2740 proposed porting our debug asserts to run at compile time.  Not all of them thoroughly can (#3133) so even if we ignored the builder API, we'd still need the debug asserts in some cases.  This is one that wouldn't run into that problem.  When considering the builder API, we also have to deal with code duplication and code drift.  That makes it unlikely for us to duplicate the debug asserts at compile time.</p>
<p>If we haven't, we should probably also have a debug assert that validates the default value against the validator function, if present.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-triage</span> removed by @epage on 2021-12-22 19:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-builder</span> added by @epage on 2021-12-22 19:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-easy</span> added by @epage on 2021-12-22 19:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @epage on 2022-02-02 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3423.html">clap-rs/clap#3423</a> on 2022-02-08 20:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2022-02-08 21:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4405.html">clap-rs/clap#4405</a> on 2022-10-19 22:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4643.html">clap-rs/clap#4643</a> on 2023-01-16 16:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5017.html">clap-rs/clap#5017</a> on 2023-07-18 19:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-07-18 20:01</div>
            <div class="timeline-body"><p>Because of #4643, #5017  reverted the fix for this</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @epage on 2023-07-18 20:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:08 UTC
    </footer>
</body>
</html>
