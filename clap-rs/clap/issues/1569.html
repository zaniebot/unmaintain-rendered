<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>using a vulnerable rust-yaml version in clap v2 - clap-rs/clap #1569</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>using a vulnerable rust-yaml version in clap v2</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1569">#1569</a>
        opened by <a href="https://github.com/Licenser">@Licenser</a>
        on 2019-10-08 12:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Licenser">@Licenser</a></div>
            <div class="timeline-body"><p>clap depends on a version of rust-yaml that has a vulnerability - it would be nice to update to a newer version: https://rustsec.org/advisories/RUSTSEC-2018-0006</p>
Affected Version of clap
<ul>
<li>2.33.0</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rlabrecque">@rlabrecque</a> on 2019-10-10 05:28</div>
            <div class="timeline-body"><p>I just started using https://github.com/RustSec/cargo-audit via https://github.com/actions-rs/audit-check and clap is the only library causing issues because of rust-yaml. Would definitely be nice to get this updated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2019-10-10 05:47</div>
            <div class="timeline-body"><p><code>clap 3.0</code> gets this fixed in #1541 , so this issue is about backporting the update to 2.34.</p>
<p>Also, I don&#x27;t think the uncontrolled recursion case is possible with clap, so this is entirely about appeasing the audit gods :confused:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Licenser">@Licenser</a> on 2019-10-10 09:38</div>
            <div class="timeline-body"><p>In part yes, but it also removes the burden from maintainers to figure out that it&#x27;s &#x27;only&#x27; in clap and that clap isn&#x27;t affected.</p>
<p>As a user I&#x27;m not certain where exactly in the clap workflow yaml files are read, so it&#x27;s hard to decide if it&#x27;s an actual issue or a false positive. I sure could dig through the clap codebase and find out, but that&#x27;s quite a lot of work.</p>
<p>So it&#x27;s not only appeasing the audit gods but making security easier for everyone, which is a big + :D</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2019-10-10 15:03</div>
            <div class="timeline-body"><blockquote>
<p>As a user I&#x27;m not certain where exactly in the clap workflow yaml files are read, so it&#x27;s hard to decide if it&#x27;s an actual issue or a false positive. I sure could dig through the clap codebase and find out, but that&#x27;s quite a lot of work.</p>
</blockquote>
<p>Yaml files are an alternative to building the <code>clap::App</code> directly in your code. A developer of a CLI does it, those files never originate from a third party source. In fact, the maximum possible depth is about 10 for &quot;no subcommands&quot; CLI, every <strong>nested</strong> subcomman could add up to 10. I&#x27;m pretty sure there are not many apps out there that use mare than 4 nested subcommands.</p>
<blockquote>
<p>As a user I&#x27;m not certain where exactly in the clap workflow yaml files are read, so it&#x27;s hard to decide if it&#x27;s an actual issue or a false positive. I sure could dig through the clap codebase and find out, but that&#x27;s quite a lot of work.</p>
</blockquote>
<p>To be clear - I&#x27;m not saying that we shouldn&#x27;t do it, I&#x27;m just pointing out that there&#x27;s no practical way this could go sought today :smile:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2019-10-10 15:26</div>
            <div class="timeline-body"><p>@Dylan-DPC So how do we do it? I suggest to create <code>v2-backports</code> branch based on <a href="https://github.com/clap-rs/clap/commit/784524f7eb193e35f81082cc69454c8c21b948f7">this commit</a> and merge it there. Once done, you can release 2.34.0</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Licenser">@Licenser</a> on 2019-10-10 15:51</div>
            <div class="timeline-body"><p>No hurry on it :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>tremor-rs/tremor-runtime#5</a> on 2019-10-11 07:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-01 11:48</div>
            <div class="timeline-body"><p>The situation: clap v2 depends on rust-yaml v0.3 and the fix is not backported to it. Blocked on it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: blocking on external</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-01 11:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-01 11:52</div>
            <div class="timeline-body"><p>Blocked on <a href="https://github.com/chyh1990/yaml-rust/issues/126">chyh1990/yaml-rust#126</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-01 11:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#1387</a> on 2020-02-01 15:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#1541</a> on 2020-02-01 18:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;using a voulnerable rust-yaml version&quot; to &quot;using a vulnerable rust-yaml version&quot; by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-02-01 18:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;using a vulnerable rust-yaml version&quot; to &quot;using a vulnerable rust-yaml version in clap v2&quot; by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-02-01 18:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: vulnerability</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-02-01 18:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#1854</a> on 2020-04-23 07:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-04-23 08:06</div>
            <div class="timeline-body"><p>To be fair this is not a vulnerability. Vulnerability in computing is defined as (emphasis mine)</p>
<blockquote>
<p>In computer security, a vulnerability is a weakness which <strong>can be exploited by a threat actor</strong>, such as an attacker, to perform unauthorized actions within a computer system. To exploit a vulnerability, <strong>an attacker must have at least one applicable tool or technique that can connect to a system weakness</strong>.</p>
</blockquote>
<p>There&#x27;s no such tool for an attacker because <code>yml</code> files are included at compile time via <code>include_str!</code>; it&#x27;s a trusted input. I&#x27;m totally for fixing this - as soon as it&#x27;s fixed upstream, but the <code>T: vulnerability</code> label is uncalled for.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: vulnerability</span> removed by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-04-23 08:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ckaran">@ckaran</a> on 2020-05-05 13:11</div>
            <div class="timeline-body"><p>@CreepySkeleton you&#x27;re right that this isn&#x27;t a true vulnerability, but @Licenser is <strong>definitely</strong> correct when he said:</p>
<blockquote>
<p>In part yes, but it also removes the burden from maintainers to figure out that it&#x27;s &#x27;only&#x27; in clap and that clap isn&#x27;t affected.</p>
</blockquote>
<p>False positives waste time and lead to fatigue, which can lead to people finding ways of turning off the warnings, which leads to true positives getting through.  So this needs to get fixed as quickly as possible, even if it isn&#x27;t a vulnerability.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-05-05 14:01</div>
            <div class="timeline-body"><p>@ckaran Well yes, except <a href="https://github.com/clap-rs/clap/issues/1854#issuecomment-618245009">we can&#x27;t fix it unless it&#x27;s backported to yaml 0.3</a>, not really, because doing so would be a breaking change and potentially break god knows how many crates out there for <strong>no</strong> benefit.</p>
<p>We <em>might</em> be willing to publish a breaking change to fix a <em>real</em> vulnerability, but this one does not qualify as such.</p>
<p>Come to think of it, clap is not the one to blame here, it does everything right. It&#x27;s cargo-audit who emits a false-positive warning and causes the fatigue. If you ask me, an audit system must have a way to mark certain software as a known false positive and suppress the warning. Is there one?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ckaran">@ckaran</a> on 2020-05-05 14:40</div>
            <div class="timeline-body"><blockquote>
<p>If you ask me, an audit system must have a way to mark certain software as a known false positive and suppress the warning. Is there one?</p>
</blockquote>
<p>I don&#x27;t think so, but I&#x27;ve just started using it.  @tarcieri, is there a way to mark a vulnerability as a false positive?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-05-05 14:47</div>
            <div class="timeline-body"><p>Clarification:  @tarcieri, is there a way to mark a specific vulnerability in a specific version or range of versions of a specific crate that depends on a vulnerable crate but never triggers the vulnerability as a false positive?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tarcieri">@tarcieri</a> on 2020-05-05 14:51</div>
            <div class="timeline-body"><p>The main way to flag vulnerabilities as false positives is either via a command line <code>--ignore</code> argument to <code>cargo audit</code> or <a href="https://github.com/RustSec/cargo-audit/blob/master/audit.toml.example#L6">via its configuration</a>.</p>
<p>Regarding transitive dependencies where the vulnerable code path is never called (which appears to be what&#x27;s happening here?), detecting these scenarios is a long-time requested feature. We&#x27;d like to be able to do a call graph analysis. Here&#x27;s a relevant issue:</p>
<p>https://github.com/RustSec/cargo-audit/issues/89</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-05-05 15:14</div>
            <div class="timeline-body"><blockquote>
<p>Regarding transitive dependencies where the vulnerable code path is never called</p>
</blockquote>
<p>Not quite. The allege vulnerability in question is unrestrained recursion that leads to stack overflow, and this code is indeed called here. But the input we ever feed to the yaml parser (the one with that triggers recursion) is <strong>trusted</strong> (is included via <code>include_str!</code> at compile time) and the nesting level is  never big enough to trigger the overflow, not even close. So yeah, it&#x27;s pretty subtle, but not a vulnerability.</p>
<blockquote>
<p>The main way to flag vulnerabilities as false positives is either via a command line --ignore argument to cargo audit or via its configuration.</p>
</blockquote>
<p>The problem with this workflow is that users have to see the warning first, then discover that the report in question is a false one, then individually mark it as false positive for themselves. This is the fatigue @ckaran was talking about and it won&#x27;t go away until an automatic solution (from user&#x27;s perspective) is developed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tarcieri">@tarcieri</a> on 2020-05-05 15:28</div>
            <div class="timeline-body"><p>I&#x27;m afraid there aren&#x27;t presently any good solutions for that other than publishing a release which is able to use transitive dependency which isn&#x27;t in the vulnerable range.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2020-05-05 15:50</div>
            <div class="timeline-body"><p>Just throwing my thoughts in the ring as well. I 100% agree with @CreepySkeleton here, there isn&#x27;t much we can do unless <code>yaml_rust</code> backports the fix into a 0.3.x branch linked above. I think the clap team has put in a lot of effort here, as a clap maintainer has backported the fix to <code>yaml_rust</code> and opened the PR. Realistically the only thing we can do next is wait for the PR to be merged, or make a breaking change in clap. If this were an active vulnerability, I would be willing to make a breaking change in clap, but this isn&#x27;t.</p>
<p>Having said that, I <em>also</em> agree with the sentiment that it&#x27;s difficult for users to go through the headache of finding out what deps are causing which errors, and whether or not it&#x27;s a real vulnerability. However, I would caveat that with that&#x27;s just part of dependency management. Without better tooling, that&#x27;s just the state of things.</p>
<p>The only other solution I can think of at the moment is if we add a blurb in our docs for the affected API that says something to the effect of, &quot;There is a known false positive when using <code>cargo-audit</code>, link to discussion, use this <code>cargo-audit</code> config to ignore the error.&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ckaran">@ckaran</a> on 2020-05-05 15:53</div>
            <div class="timeline-body"><blockquote>
<p>The only other solution I can think of at the moment is if we add a blurb in our docs for the affected API that says something to the effect of, &quot;There is a known false positive when using cargo-audit, link to discussion, use this cargo-audit config to ignore the error.&quot;</p>
</blockquote>
<p>Assuming that the PR for the backport is accepted soon, this might be the best answer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tarcieri">@tarcieri</a> on 2020-05-05 16:03</div>
            <div class="timeline-body"><blockquote>
<p>&quot;There is a known false positive when using cargo-audit, link to discussion, use this cargo-audit config to ignore the error.&quot;</p>
</blockquote>
<p>I&#x27;d also be fine with adding this same text to the advisory itself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-05-05 16:04</div>
            <div class="timeline-body"><blockquote>
<p>The only other solution I can think of at the moment is if we add a blurb in our docs for the affected API that says something to the effect of, &quot;There is a known false positive when using cargo-audit, link to discussion, use this cargo-audit config to ignore the error.&quot;</p>
</blockquote>
<p>This kind of solution is unlikely to change anything because users get the warning from <code>cargo audit</code>. They don&#x27;t even have to know that this API - and the attached note - exists in the dirst place. t\all they see is</p>
<pre><code>ID:       RUSTSEC-2018-0006
Crate:    yaml-rust
Version:  0.3.5
Date:     2018-09-17
URL:      https://rustsec.org/advisories/RUSTSEC-2018-0006
Title:    Uncontrolled recursion leads to abort in deserialization
Solution:  upgrade to &gt;= 0.4.1
Dependency tree: 
yaml-rust 0.3.5
└── clap 2.33.0
</code></pre>
<p>Which doesn&#x27;t mention anything about the relevant API.</p>
<p>In order to be useful, this attachment must be visible. I&#x27;d suggest put it in readme and docs.rs front page, somewhere near the top, and paint it <strong>bold</strong>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-05-05 16:04</div>
            <div class="timeline-body"><blockquote>
<p>I&#x27;d also be fine with adding this same text to the advisory itself.</p>
</blockquote>
<p><em>That</em> would be marvelous.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ckaran">@ckaran</a> on 2020-05-05 16:09</div>
            <div class="timeline-body"><blockquote>
<p>I&#x27;d also be fine with adding this same text to the advisory itself.</p>
</blockquote>
<p>OK, so just so I&#x27;m 100% clear, this is going to be in <code>cargo audit</code>&#x27;s database itself, correct?  How do you handle a situation where a crate is using both <code>clap</code> and <code>rust-yaml</code>?  That is, this is not a vulnerability for <code>clap</code>, but for other uses it may be, so you want to make sure that you don&#x27;t accidentally turn off all auditing against <code>rust-yaml</code> just because you happen to include clap in your project.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>rustsec/advisory-db#288</a> on 2020-05-05 16:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-05-05 16:14</div>
            <div class="timeline-body"><blockquote>
<p>so you want to make sure that you don&#x27;t accidentally turn off all auditing against rust-yaml just because you happen to include clap in your project.</p>
</blockquote>
<p>Right, it must be worded in a way that explicitly conveys that <code>clap</code> is NOT vulnerable, but <code>rust-yaml</code> IS.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tarcieri">@tarcieri</a> on 2020-05-05 16:14</div>
            <div class="timeline-body"><p>@ckaran this would just be in the description of the advisory. <code>cargo audit</code> shows a dependency tree of how crates with advisories are used in the project, allowing the user to see whether it&#x27;s just <code>clap</code> pulling in <code>yaml-rust</code> or something else.</p>
<p>For what it&#x27;s worth, I also opened a ticket about potentially doing some sort of structured whitelisting in advisories as well:</p>
<p>https://github.com/RustSec/advisory-db/issues/288</p>
<p>In that case, <code>cargo audit</code> could check the dependency tree automatically, rather than relying on the user to do it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ckaran">@ckaran</a> on 2020-05-05 16:17</div>
            <div class="timeline-body"><p>@tarcieri that&#x27;s perfect!  The description can be a stopgap, and the ticket can be a future enhancement.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> removed by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-05-26 10:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#2506</a> on 2021-05-28 08:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>mozilla/application-services#4611</a> on 2021-10-26 20:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>epage/clapng#127</a> on 2021-12-06 18:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-09 15:56</div>
            <div class="timeline-body"><p>clap3 is using a newer rust-yaml and is at rc0, so I&#x27;m going ahead and closing this in favor of that release.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/epage">@epage</a> on 2021-12-09 15:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:57:29 UTC
    </footer>
</body>
</html>
