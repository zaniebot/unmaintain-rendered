```yaml
number: 1485
title: Add no_std compatibility
type: issue
state: open
author: elast0ny
labels:
  - C-enhancement
  - S-waiting-on-decision
  - A-meta
assignees: []
created_at: 2019-06-05T18:06:36Z
updated_at: 2025-02-03T17:51:20Z
url: https://github.com/clap-rs/clap/issues/1485
synced_at: 2026-01-10T01:57:43Z
```

# Add no_std compatibility

---

_Issue opened by @elast0ny on 2019-06-05 18:06_

### Feature Request Summary
Would it be possible to split clap argument parsing logic into a `no_std` "clap_core" crate or allow crates to toggle a `no_std` style feature.

This would probably strip most of the clap features such as `print_help()`, exiting on error, loading from yaml, etc... but the core argument parsing logic should still work.

`no_std` clap could expose a `.get_matches_from()` like function which could return a `ClapResult<ArgMatches<'a>>` leaving the error handling up to the caller. Optionally, `no_std` clap could also expose ways to get pre-formated help/long_help buffers for crates who wish to display the information.

### Current Behavior
Clap is incompatible with `no_std`

---

_Renamed from "Split argument parsing logic into a no_std library" to "Add no_std compatibility" by @elast0ny on 2019-06-05 18:25_

---

_Comment by @CreepySkeleton on 2020-02-01 13:30_

Marking for `3.0` milestone because it would be breaking change

---

_Label `C: other` added by @CreepySkeleton on 2020-02-01 13:31_

---

_Label `P4: nice to have` added by @CreepySkeleton on 2020-02-01 13:31_

---

_Label `T: new feature` added by @CreepySkeleton on 2020-02-01 13:31_

---

_Label `T: new setting` added by @CreepySkeleton on 2020-02-01 13:31_

---

_Added to milestone `3.0` by @CreepySkeleton on 2020-02-01 13:31_

---

_Comment by @Dylan-DPC-zz on 2020-02-01 13:54_

This needs some work and depend on the demand (cli in environments where you want no_std is niche iirc). We can push this for a future release 

---

_Referenced in [clap-rs/clap#1384](../../clap-rs/clap/issues/1384.md) on 2020-02-01 15:28_

---

_Label `T: new setting` removed by @pksunkara on 2020-02-01 19:07_

---

_Comment by @pksunkara on 2020-02-01 19:07_

I agree, this is not breaking if we just add a new feature to cargo. We can push this.

---

_Label `W: 3.x` added by @pksunkara on 2020-02-01 19:08_

---

_Removed from milestone `3.0` by @pksunkara on 2020-02-01 19:08_

---

_Added to milestone `3.1` by @pksunkara on 2020-02-01 19:08_

---

_Comment by @BurntSushi on 2020-02-01 20:03_

You'll want to add a `std` feature that is enabled by default and produces a compilation error when it is disabled. Otherwise it's quite likely that you'll break extant uses of `default-features = false`.

---

_Comment by @pksunkara on 2020-02-01 20:05_

@BurntSushi Thanks for the input. I haven't worked with `no_std` before. Is this the standard way of doing things? Is there any issue with adding `no_std` feature instead?

---

_Comment by @BurntSushi on 2020-02-01 20:10_

Yes it is standard. Features should be additive, since enabling them in a dependency enables it for all instances of that crate in a dependency tree.

The main point here is to make sure you add the feature in clap 3, so that you can add it later in a backwards compatible fashion.

(I would personally be surprised if making clap compatible with no_std was easy without significant changes to the public API. Perhaps an alloc-only version would be simpler. But I confess that I have not thought deeply about it.)

---

_Removed from milestone `3.1` by @pksunkara on 2020-02-01 20:11_

---

_Added to milestone `3.0` by @pksunkara on 2020-02-01 20:11_

---

_Comment by @Dylan-DPC-zz on 2020-02-01 21:22_

Don't worry. I'll handle the no_std part. Well generally the default crate should be in no_std and then std is added as a new feature. The problem with that is it is difficult to do it in a non-breaking way. Also I don't want to keep the release waiting for it, so likely it will happen in a minor release in the future in a non-breaking (or a short term solution ) or properly in 4.0

---

_Comment by @BurntSushi on 2020-02-01 21:45_

@Dylan-DPC Hmmm, I'm not sure if I conveyed my thoughts well enough. What I'm saying here is that with the clap 3 initial release, you can add a `std` feature that is enabled by default. When it is disabled, you can use `compile_error!(...)` to cause it to always fail. That way, once you do decide to add the feature, you can make whatever changes you want since the lack of a `std` feature previously never compiled anyway.

This is exactly the approach that the `regex` crate takes, with the hope of providing an alloc-only mode in the future.

---

_Comment by @Dylan-DPC-zz on 2020-02-02 00:30_

I've added a dummy no-op feature in https://github.com/clap-rs/clap/commit/6aaeb2718b6daa3d2024759183d588243e5c3565

---

_Removed from milestone `3.0` by @CreepySkeleton on 2020-02-02 01:52_

---

_Added to milestone `3.1` by @CreepySkeleton on 2020-02-02 01:52_

---

_Removed from milestone `3.1` by @pksunkara on 2020-02-02 05:55_

---

_Added to milestone `3.0` by @pksunkara on 2020-02-02 05:55_

---

_Removed from milestone `3.0` by @pksunkara on 2020-02-02 05:55_

---

_Added to milestone `3.1` by @pksunkara on 2020-02-02 05:55_

---

_Label `W: 3.x` removed by @pksunkara on 2021-08-13 10:40_

---

_Referenced in [epage/clapng#120](../../epage/clapng/issues/120.md) on 2021-12-06 18:35_

---

_Label `C: other` removed by @epage on 2021-12-08 20:19_

---

_Label `A-meta` added by @epage on 2021-12-08 20:19_

---

_Removed from milestone `3.1` by @epage on 2021-12-08 20:19_

---

_Label `T: new feature` removed by @epage on 2021-12-08 21:16_

---

_Label `C-enhancement` added by @epage on 2021-12-08 21:16_

---

_Label `P4: nice to have` removed by @epage on 2021-12-09 20:03_

---

_Label `S-waiting-on-decision` added by @epage on 2021-12-09 20:03_

---

_Comment by @barafael on 2022-04-30 20:38_

It would also be very useful to be able to derive `ArgEnum` for enums from no_std crates.

E.g.:
```
    #[clap(default_value = "None", possible_values = &["None", "Odd", "Even"])]
    parity: Parity,
```
where `Parity` is an enum defined in some `no_std` driver for which one is currently writing a CLI.

---

_Comment by @felipebalbi on 2022-12-04 12:34_

Support for `no_std` would be super useful in environments such as UEFI where one can rely on `uefi-rs` to write applications for it.

---

_Comment by @ChandlerPrue on 2024-07-26 14:48_

This ticket looks pretty stale. I just tested the no_std in 4.5.11 and see its still dependent on std. As someone trying to compile for UEFI i'd support this feature, but would also appreciate the clarity of closing this issue if its not being considered anymore

---

_Comment by @epage on 2024-07-26 15:07_

> would also appreciate the clarity of closing this issue if its not being considered anymore

Just because something is stale doesn't mean it won't be considered any more.  There are lots of features of interest and limited capacity to move them forward.

---

_Comment by @tommasoclini on 2025-02-02 13:50_

Do you know any alternatives compatible with no_std?

---

_Comment by @epage on 2025-02-03 17:12_

The big problem with `no_std` is the lack of `OsStr`.  That is a fundamental type for CLI parsers and they would need to be generic over it, making the API less ergonomic.  [`getargs`](https://docs.rs/getargs/0.5.0/getargs/) is one of the few that is `no_std`, dealing only with `&str`s.  However, take any of their performance numbers with a grain of salt ([explanation](https://www.reddit.com/r/rust/comments/wbblxc/getargs_050_is_finally_out_fastest_rust_argument/ii6atqw/)).  Looks like [`gumpdrop`](https://docs.rs/gumdrop/0.8.1/gumdrop/) also uses `&str`, unsure why they haven't added `no_std` support as well (containers?).

---

_Comment by @tommasoclini on 2025-02-03 17:51_

I need a CLI in an embedded system, so I don't really care about the API being ergonomic, I've found the [embedded-cli](https://crates.io/crates/embedded-cli/) crate, but it has been developed by a single person, and is not very active because of not many people using it. The shell part is not that hard to make, I'm not sure if I would even need history or autocompletion, but the features that clap offer are pretty nice.

---
