<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support automatic subcommands for completion - clap-rs/clap #810</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support automatic subcommands for completion</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/810">#810</a>
        opened by <a href="https://github.com/colemickens">@colemickens</a>
        on 2017-01-07 23:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/colemickens">@colemickens</a></div>
            <div class="timeline-body"><p>It seems to be something of a pattern for apps to support completion via the following:</p>
<pre><code>$ source &lt;(app completion zsh)
# or
$ source &lt;(app completion bash)
</code></pre>
<p>It&#x27;d be nice if there were a helper on <code>App</code> so that we could call <code>.add_completion_subcommands()</code> and have this wired up automatically.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-08 03:14</div>
            <div class="timeline-body"><p>This would be an easy addition, although it&#x27;d probably get implemented as an <code>AppSettings</code> variant.</p>
<p>The one thing that gives me pause, is that I&#x27;ve seen this done in a few different ways by different applications, such as <code>$ prog completion[s] [--shell] &lt;shell&gt;</code>.</p>
<p>Is the <code>prog completion &lt;shell&gt;</code> (singular form of &quot;completion&quot;) a standard? Because if it were only up to me, I&#x27;d implement it as <code>prog completions &lt;shell&gt;</code> (plural form of &quot;completion&quot; with a single positional argument accepting the shell name), but if there&#x27;s a written standard I haven&#x27;t seen I&#x27;d rather follow the standard.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: settings</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-08 03:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-08 03:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-08 03:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new setting</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-08 03:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-08 03:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-08 03:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/colemickens">@colemickens</a> on 2017-01-08 04:26</div>
            <div class="timeline-body"><p>I don&#x27;t know if one is more popular/&quot;standard&quot; than another. I thought I had other examples up my sleeve, but the only one I can think of now is <code>kubectl</code> which takes the form <code>kubectl completion zsh</code>. I have only a tiny preference for the subcommand style, rather than flag, but it seems to just be cosmetic.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-08 05:11</div>
            <div class="timeline-body"><p>In all honesty it&#x27;d be possible to give options for both, which is how I think I&#x27;ll tackle this.</p>
<ul>
<li><code>AppSettings::GenerateCompletionsSubcommand</code><ul>
<li>Will generate <code>prog completions &lt;shell&gt;</code></li>
</ul>
</li>
<li><code>AppSettings::GenerateCompletionsArg</code><ul>
<li>Will generate <code>prog --shell-completions &lt;shell&gt;</code></li>
</ul>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;2.21.0&quot; by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-01-30 05:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;2.21.0&quot; by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-03-27 02:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#1037</a> on 2018-02-15 14:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-07-22 01:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> removed by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-07-22 01:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> removed by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-07-22 01:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;v3.0&quot; by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-07-22 01:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>rust-lang/cargo#6645</a> on 2019-04-23 19:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rharriso">@rharriso</a> on 2019-07-04 22:06</div>
            <div class="timeline-body"><p>Is this possible anymore?</p>
<p>The clap_generate package depends on clap. Won&#x27;t this be a circular package dependency?
Also. I&#x27;m having trouble using <code>clap_generate</code></p>
<p>working in this branch:
https://github.com/rharriso/clap/tree/v3-master</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-02-14 14:42</div>
            <div class="timeline-body"><p>@rharriso Try the clap_generate now, it should work. But yeah, this would become a circular dependency. I am not sure we want this.</p>
<p>Maybe we could do some kind of macro.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-03-03 12:45</div>
            <div class="timeline-body"><p>@CreepySkeleton Would love your input here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-03-03 15:43</div>
            <div class="timeline-body"><p>That&#x27;s possible. We can make <code>clap_generate</code> just another module in <code>clap</code> (i.e it would be no longer a separate crate), possibly behind a feature flag.</p>
<p><strong>Pros:</strong></p>
<ul>
<li><p>Very convenient for end users.</p>
</li>
<li><p>We will no longer need the <code>#[doc(hidden)] pub</code> things.</p>
<p>Let me catch your attention here: currently, a lot of stuff in clap is <code>doc(hidden)</code> <em>precisely and only</em> because <code>clap_generate</code> needs it. It&#x27;s much more that you might have thought; many things (<code>struct</code>s and <code>enum</code>s) are public only because they are parts of such a &quot;public&quot; field, or a part of some function&#x27;s signature (also <code>pub hidden</code> one). The point is: this pseudo-publicity <em>expands</em> onto other things transitively, pulling them into the club even though they have no need to be publich.</p>
<p>In my estimation, about 30% of code is <code>pub hidden</code> now, and those erase the line between &quot;internal API used by <code>clap_generate</code>&quot; and really &quot;public API&quot;. Once/if we embrace the generate into the <code>clap</code> itself, we&#x27;ll be able to change them to <code>pub(crate)</code>, <em>as it should be</em>. A big improvement if you ask me.</p>
</li>
</ul>
<p><strong>Cons:</strong>
* <code>clap</code>&#x27;s own codebase would grow a bit. Well, we&#x27;re the ones who&#x27;s gonna have to maintain it one way or another ü§∑‚Äç‚ôÇ .</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TeXitoi">@TeXitoi</a> on 2020-03-03 15:47</div>
            <div class="timeline-body"><p>@CreepySkeleton You mean <code>clap_generate</code> instead of <code>clap_derive</code> ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-03-03 15:51</div>
            <div class="timeline-body"><p>There must have been a reason Kevin wanted to make it a separate crate.</p>
<p>On Tue, Mar 3, 2020, 16:47 Guillaume P. <a href="mailto:notifications@github.com">notifications@github.com</a> wrote:</p>
<blockquote>
<p>@CreepySkeleton <a href="https://github.com/CreepySkeleton">https://github.com/CreepySkeleton</a> You mean clap_generate
instead of clap_derive ?</p>
<p>‚Äî
You are receiving this because you commented.
Reply to this email directly, view it on GitHub
<a href="https://github.com/clap-rs/clap/issues/810?email_source=notifications&amp;email_token=AABKU35NWB52OG4OZCVHKO3RFURBVA5CNFSM4C3WHVVKYY3PNVWWK3TUL52HS4DFVREXG43VMVBW63LNMVXHJKTDN5WW2ZLOORPWSZGOENUAHZY#issuecomment-594019303">clap-rs/clap#810</a>,
or unsubscribe
<a href="https://github.com/notifications/unsubscribe-auth/AABKU3ZGNHAF4PG3EOK2DJ3RFURBVANCNFSM4C3WHVVA">https://github.com/notifications/unsubscribe-auth/AABKU3ZGNHAF4PG3EOK2DJ3RFURBVANCNFSM4C3WHVVA</a>
.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-03-03 15:53</div>
            <div class="timeline-body"><p>@TeXitoi right üò®</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-03-03 15:54</div>
            <div class="timeline-body"><p>I don&#x27;t see any reason, honestly. Not any I would call a good one.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TeXitoi">@TeXitoi</a> on 2020-03-03 16:47</div>
            <div class="timeline-body"><p>The advantage is that you will not compile it if you don&#x27;t use it. The other solution is features, and I personally prefer to keep features to the bare minimum as they complexify the code considerably.</p>
<p>But, having this implementation hole is quite dirty. I think the clean way would be:</p>
<ul>
<li>having the introspection API used by clap_generate public and documented</li>
<li>having clap_generate in the clap crate</li>
</ul>
<p>The second way seems easier now. But that&#x27;s just my humble opinion, I didn&#x27;t even seen the code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-03-03 16:55</div>
            <div class="timeline-body"><p>I made as much of introspection API public. The remaning stuff are <code>doc(hidden)</code> because they are macro helpers for the introspection API. If the whole system isn&#x27;t macros, they would have been private.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-03-03 17:00</div>
            <div class="timeline-body"><blockquote>
<p>The other solution is features, and I personally prefer to keep features to the bare minimum as they complexify the code considerably.</p>
</blockquote>
<p>That&#x27;s gonna be one module level <code>cfg</code> and one another <code>cfg</code> somewhere in <code>AppSettings</code>. Sounds simple enough.</p>
<p>I&#x27;ve seen the code, I&#x27;ve been trying to implement an introspection API of sorts (you just read my mind üòÉ, ha!), and I feel like I&#x27;m failing. <code>calp_generate</code> and <code>clap</code> are <em>so</em> closely tied to each other that we may as well make them all public. I&#x27;ll show you the result of this attempt soon, but I vote for pulling it into <code>clap</code>.</p>
<blockquote>
<p>I made as much of introspection API public.</p>
</blockquote>
<p>You did? Mind elaborate?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-03-03 17:05</div>
            <div class="timeline-body"><blockquote>
<p>The remaning stuff are doc(hidden) because they are macro helpers for the introspection API. If the whole system isn&#x27;t macros, they would have been private.</p>
</blockquote>
<p>I hate to be rude, but that&#x27;s actually not true at all. Just grep for <code>#[doc(hidden)]</code>: 140 matches across 17 files. Ridiculous.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-03-03 17:24</div>
            <div class="timeline-body"><p>@TeXitoi They seem to be implementing explicit support for features in docs.rs, see <a href="https://github.com/dtolnay/syn/pull/734">dtolnay/syn#734</a> . We might as well do that too.</p>
<p>Looks neat unless you have lots of cfg&#x27;ed items (we don&#x27;t): https://docs.rs/tokio/0.2.13/tokio/index.html#modules</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#1736</a> on 2020-03-10 16:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: generator</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-10 13:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: settings</span> removed by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-10 13:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-07-01 02:27</div>
            <div class="timeline-body"><p>@pksunkara @kbknapp So can we finally decide whether we want this or not? More specifically, are we open to inclusion <code>clap_generate</code> as a clap module? If we aren&#x27;t, than we can close this as impossible.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to <a href="https://github.com/pksunkara">@pksunkara</a> by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-07-01 08:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-07-01 08:15</div>
            <div class="timeline-body"><p>I will take care of this. I have a few ideas on how to fix this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-07-21 19:58</div>
            <div class="timeline-body"><p>btw another way of solving this is instead of having a setting for this, to provide types that implement <code>Args</code> and <code>Subcommand</code> (through derive or not).  A user could then choose to flatten those into their arguments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> removed by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-08-13 10:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#2720</a> on 2021-08-18 17:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;3.0&quot; by <a href="https://github.com/epage">@epage</a> on 2021-10-16 18:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;3.1&quot; by <a href="https://github.com/epage">@epage</a> on 2021-10-16 18:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>epage/clapng#68</a> on 2021-12-06 16:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by <a href="https://github.com/epage">@epage</a> on 2021-12-08 20:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new setting</span> removed by <a href="https://github.com/epage">@epage</a> on 2021-12-08 20:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> removed by <a href="https://github.com/epage">@epage</a> on 2021-12-09 17:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> removed by <a href="https://github.com/epage">@epage</a> on 2021-12-09 17:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> added by <a href="https://github.com/epage">@epage</a> on 2021-12-09 17:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone &quot;3.1&quot; by <a href="https://github.com/epage">@epage</a> on 2021-12-09 17:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned <a href="https://github.com/pksunkara">@pksunkara</a> by <a href="https://github.com/pksunkara">@pksunkara</a> on 2023-04-13 23:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-08-10 00:31</div>
            <div class="timeline-body"><p>While not automatic, we are exposing this as <a href="https://docs.rs/clap_complete/latest/clap_complete/dynamic/shells/enum.CompleteCommand.html"><code>clap_complete::dynamic::shells::CompleteCommand</code></a>.</p>
<p>For stabilization of this feature, see #3166</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/epage">@epage</a> on 2024-08-10 00:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#5947</a> on 2025-03-13 14:18</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:56:43 UTC
    </footer>
</body>
</html>
