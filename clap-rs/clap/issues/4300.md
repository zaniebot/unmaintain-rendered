```yaml
number: 4300
title: "Support reading `SHELL` into `Shell`"
type: issue
state: closed
author: XyLyXyRR
labels:
  - C-enhancement
  - A-completion
  - S-waiting-on-design
assignees: []
created_at: 2022-09-30T13:56:57Z
updated_at: 2022-11-07T13:38:54Z
url: https://github.com/clap-rs/clap/issues/4300
synced_at: 2026-01-10T01:57:47Z
```

# Support reading `SHELL` into `Shell`

---

_Issue opened by @XyLyXyRR on 2022-09-30 13:56_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Clap Version

3.1.15

### Describe your use case

Usually the env `$SHELL` is something like `/usr/bin/bash` or `/bin/fish`. I want clap support this env variable. It is more convenient to use. Right now I need add some code like below before clap parse env variables.

```rust
    env::var("SHELL").ok().map(|x| {
        PathBuf::from(x)
            .file_name()
            .map(|x| env::set_var("SHELL", x))
    });
```


### Describe the solution you'd like

I wish clap can handle this internally, so I don't need add this to my every project. #4296 just moved this part code into `FromStr` for `Shell` right now. It is a little ugly right now.

### Alternatives, if applicable

_No response_

### Additional Context

_No response_

---

_Label `C-enhancement` added by @XyLyXyRR on 2022-09-30 13:56_

---

_Renamed from "Feature request: support from env `SHELL` in `FromStr` of `Shell`" to "Support reading `SHELL` into `Shell`" by @epage on 2022-09-30 14:20_

---

_Label `A-builder` added by @epage on 2022-09-30 14:20_

---

_Label `S-waiting-on-design` added by @epage on 2022-09-30 14:29_

---

_Comment by @epage on 2022-09-30 14:34_

As I said in #4296, putting this in `FromStr` is a no-go.  Instead let's focus on the underlying needs.

I remember seeing an application using clap that parsed `SHELL` and then had some other logic for windows.  I'm wishing I could remember which that was as it would help provide insight into other use cases to see what else we might want to support.

My thinking is that we would have
- `Shell::from_shell_bin(path)`
  - We would want to use `file_stem`, instead of `file_name`, in case thats relevant for windows support (unsure what all cygwin does)
  - We'll probably want our own match statement in here in case there are divergences between SHELL and `Shell`
  - This would return an `Option<Shell>`
- `Shell::from_env` which just calls `Shell::from_shell_bin(std::env::var_os("SHELL"))`


---

_Referenced in [clap-rs/clap#4446](../../clap-rs/clap/issues/4446.md) on 2022-11-03 14:06_

---

_Referenced in [clap-rs/clap#4447](../../clap-rs/clap/pulls/4447.md) on 2022-11-03 14:06_

---

_Label `A-builder` removed by @epage on 2022-11-03 14:07_

---

_Label `A-completion` added by @epage on 2022-11-03 14:07_

---

_Comment by @tmccombs on 2022-11-04 04:44_

> I remember seeing an application using clap that parsed SHELL and then had some other logic for windows. I'm wishing I could remember which that was as it would help provide insight into other use cases to see what else we might want to support.

If that was fd, the logic was basically "if the SHELL environment variable isn't set, and you are on windows, assume powershell".  I don't use windows, but I think that is probably a decent assumption.  If it is in cygwin or WSL, then SHELL would probably be set. 

One thing I didn't think about is if  SHELL is set correctly  in  powershell on a unix-like system. I would hope it is, but I don't actually know. 

Should we have any fallback for any other OSes? I fairly confident SHELL is pretty reliable on linux. I think it should be reliable on Mac, but I'm not as confident there. I don't know about more exotic systems. 

There is also the question of what `Shell::from_env` would return. `Option<Shell>` would probably be simplest, but would an application want to know more details about why it failed to determine a shell (was it because SHELL wasn't set, or because the SHELL didn't contain a supported shell)?

---

_Closed by @epage on 2022-11-07 13:38_

---

_Referenced in [clap-rs/clap#5370](../../clap-rs/clap/issues/5370.md) on 2024-02-21 01:25_

---
