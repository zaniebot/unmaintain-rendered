<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow visible aliases for PossibleValue - clap-rs/clap #4416</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow visible aliases for PossibleValue</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/clap-rs/clap/issues/4416">#4416</a>
        opened by <a href="https://github.com/dbrgn">@dbrgn</a>
        on 2022-10-22 20:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dbrgn">@dbrgn</a></div>
            <div class="timeline-body">Please complete the following tasks
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
Clap Version
<p>4.0.18</p>
Describe your use case
<p><a href="https://github.com/dbrgn/tealdeer/">Tealdeer</a> has a parameter <code>-p, --platform &lt;PLATFORM&gt;</code> to select the platform. For historic reasons, this list must include &quot;osx&quot;, but should also include the alias &quot;macos&quot;. This alias should not be hidden, but should be visible.</p>
<p>With Clap 3, this was implemented using <code>FromStr</code>:</p>
<pre><code>#[derive(Debug, Eq, PartialEq, Copy, Clone, Serialize, Deserialize)]
#[serde(rename_all = &quot;lowercase&quot;)]
#[allow(dead_code)]
pub enum PlatformType {
    Linux,
    OsX,
    SunOs,
    Windows,
    Android,
}

impl str::FromStr for PlatformType {
    type Err = anyhow::Error;

    fn from_str(s: &amp;str) -&gt; Result&lt;Self, Self::Err&gt; {
        match s {
            &quot;linux&quot; =&gt; Ok(Self::Linux),
            &quot;osx&quot; | &quot;macos&quot; =&gt; Ok(Self::OsX),
            &quot;sunos&quot; =&gt; Ok(Self::SunOs),
            &quot;windows&quot; =&gt; Ok(Self::Windows),
            &quot;android&quot; =&gt; Ok(Self::Android),
            other =&gt; Err(anyhow!(
                &quot;Unknown OS: {}. Possible values: linux, macos, osx, sunos, windows, android&quot;,
                other
            )),
        }
    }
}
</code></pre>
<pre><code>    /// Override the operating system
    #[clap(
        short = &#x27;p&#x27;,
        long = &quot;platform&quot;,
        possible_values = [&quot;linux&quot;, &quot;macos&quot;, &quot;windows&quot;, &quot;sunos&quot;, &quot;osx&quot;, &quot;android&quot;],
    )]
    pub platform: Option&lt;PlatformType&gt;,
</code></pre>
<p>With Clap 4, I tried to migrate to <code>EnumValueParser</code>:</p>
<pre><code>impl clap::ValueEnum for PlatformType {
    fn value_variants&lt;&#x27;a&gt;() -&gt; &amp;&#x27;a [Self] {
        &amp;[Self::Linux, Self::OsX, Self::Windows, Self::SunOs, Self::Android]
    }

    fn to_possible_value&lt;&#x27;a&gt;(&amp;self) -&gt; Option&lt;clap::builder::PossibleValue&gt; {
        match self {
            Self::Linux =&gt; Some(clap::builder::PossibleValue::new(&quot;linux&quot;)),
            Self::OsX =&gt; Some(clap::builder::PossibleValue::new(&quot;osx&quot;).alias(&quot;macos&quot;)),
            Self::Windows =&gt; Some(clap::builder::PossibleValue::new(&quot;windows&quot;)),
            Self::SunOs =&gt; Some(clap::builder::PossibleValue::new(&quot;sunos&quot;)),
            Self::Android =&gt; Some(clap::builder::PossibleValue::new(&quot;android&quot;)),
        }
    }
}
</code></pre>
<p>This works, but the alias is not visible in help output or error messages.</p>
Describe the solution you&#x27;d like
<p>Since <code>Command</code> has both <code>.alias(...)</code> and <code>.visible_alias(...)</code>, would this be possible for <code>PossibleValue</code> as well?</p>
Alternatives, if applicable
<p><em>No response</em></p>
Additional Context
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by <a href="https://github.com/dbrgn">@dbrgn</a> on 2022-10-22 20:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dbrgn">@dbrgn</a> on 2022-10-22 20:08</div>
            <div class="timeline-body"><p>Note: <a href="https://github.com/clap-rs/clap/issues/4226#issuecomment-1251088224">This comment</a> by @epage might be related / an alternative API to the suggested <code>.visible_alias</code> method:</p>
<blockquote>
<p>Kind of like how clap switched from possible values being a <code>&amp;str</code> to <code>PossibleValue</code>, I wonder if we should have an <code>Alias&lt;T&gt;</code> which has a <code>hide</code> method on it.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-help</span> added by <a href="https://github.com/epage">@epage</a> on 2022-10-24 13:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-builder</span> added by <a href="https://github.com/epage">@epage</a> on 2022-10-24 13:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-medium</span> added by <a href="https://github.com/epage">@epage</a> on 2022-10-24 13:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-help-wanted</span> added by <a href="https://github.com/epage">@epage</a> on 2022-10-24 13:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-10-24 13:22</div>
            <div class="timeline-body"><p>I broke that comment out into #4421.  I think I&#x27;d prefer not going that route for PossibleValue until we do it for everything as it&#x27;d be weird to have such a divergent API.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#5479</a> on 2024-05-01 22:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>topgrade-rs/topgrade#787</a> on 2024-05-06 13:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#5480</a> on 2024-06-23 00:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-06-23 00:08</div>
            <div class="timeline-body"><p>The big question for me for this is how visible aliases for possible values should be rendered.  In the short help, it feels weird to redundantly list options that map back to the same thing and would get weird nesting expressions into each other.  With long help, we could have an <code>[aliases: ...]</code>  after the item, I guess.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-medium</span> removed by <a href="https://github.com/epage">@epage</a> on 2024-06-23 00:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-help-wanted</span> removed by <a href="https://github.com/epage">@epage</a> on 2024-06-23 00:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> added by <a href="https://github.com/epage">@epage</a> on 2024-06-23 00:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AmmarAbouZor">@AmmarAbouZor</a> on 2024-08-21 07:54</div>
            <div class="timeline-body"><p>I thought of two solutions for the short help:</p>
<ul>
<li>Not rendering them in that case at all since the short help should be compact and it must not have all the information (Like we are not printing the description for value eighter)</li>
<li>Adding brackets next to each option without the word &#x27;aliases&#x27; in it. Something like <code>[possible values: foo-option (foo, f) , bar-option (b), no-alias-option]</code></li>
</ul>
<p>We can make printing aliases in short description optional be adding a boolean or a flag for the function. Something like:</p>
<pre><code>// Boolean option 
pub fn visible_alias(mut self, name: impl IntoResettable&lt;Str&gt;, short-help: bool) -&gt; ...

// Flag option 
pub fn visible_alias(mut self, name: impl IntoResettable&lt;Str&gt;, flags: AliasFlags) -&gt; ...
bitflags! {
    pub struct AliasFlags: u32 {
        const ShortHelp = 0b00000001;
       ...
    }
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-08-21 14:03</div>
            <div class="timeline-body"><blockquote>
<p>We can make printing aliases in short description optional be adding a boolean or a flag for the function.</p>
</blockquote>
<p>We&#x27;re trying to keep minimum the configuration we provide, focusing on a consistent, quality out of box experience.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>biomejs/gritql#544</a> on 2024-10-21 16:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Alex-ley-scrub">@Alex-ley-scrub</a> on 2024-10-25 18:52</div>
            <div class="timeline-body"><p>@dbrgn you could probably achieve something similar to what you want (at least displaying them all - not more custom formatting) using something like this:</p>
<p><code>PossibleValuesParser.map() -&gt; MapValueParser</code> (<a href="https://docs.rs/clap/latest/clap/builder/struct.PossibleValuesParser.html#method.map">docs.rs</a>)</p>
<p>i.e. <code>possible_values()</code> returns all of the names + aliases and <code>map_value()</code> does the many-to-one alias mapping to your defined enum variants.</p>
<p>see: <a href="https://github.com/getgrit/gritql/pull/544">getgrit/gritql#544</a>/commits/a5887a7</p>
<pre><code>use clap::builder::{MapValueParser, PossibleValuesParser, TypedValueParser};

#[derive(ValueEnum, Debug, Clone, Copy, Default, PartialEq, Eq, Hash, Serialize, Deserialize)]
#[clap(rename_all = &quot;lower&quot;)]
#[serde(rename_all = &quot;lowercase&quot;)]
pub enum PlatformType {
    ...
}

impl PlatformType {
    fn get_aliases(&amp;self) -&gt; &amp;&#x27;static [&amp;&#x27;static str] {
        ...
    }

    fn map_value(s: String) -&gt; Self {
        ...
    }

    fn possible_values() -&gt; Vec&lt;&amp;&#x27;static str&gt; {
        ...
    }

    pub fn value_parser() -&gt; MapValueParser&lt;PossibleValuesParser, fn(String) -&gt; Self&gt; {
        PossibleValuesParser::new(Self::possible_values()).map(|s| Self::map_value(s))
    }
</code></pre>
<p>usage:</p>
<pre><code>#[derive(Args, Clone, Debug, Serialize)]
pub struct YourArgs {
    #[clap(short = &#x27;p&#x27;, long = &quot;platform&quot;, value_parser = PlatformType::value_parser())]
    pub platform: Option&lt;PlatformType&gt;,
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/theotchlx">@theotchlx</a> on 2025-11-25 15:42</div>
            <div class="timeline-body"><p>Hi, when I wrote <a href="https://github.com/ricktaylor/hardy/commit/b1ab229bd4c55fa0b49b5a44fbd485b2e3e0aef3">this commit</a>, I couldn&#x27;t find a way to print the aliases from the ValueEnum with <code>--help</code>.
So I hard-coded the aliases in the doc comments as you can see...:</p>
<pre><code>    /// Standard X-25 CRC-16 [aliases: crc16_x25, 16]
    #[clap(alias = &quot;crc16_x25&quot;, alias = &quot;16&quot;)]
</code></pre>
<p>I don&#x27;t like this, and I reckon this is originates from this issue.</p>
<p>If possible I&#x27;d like to get it done so that I can get rid of my hard-coded values in this other code. There seems to be unanswered design questions as to how to provide this feature?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eirnym">@eirnym</a> on 2025-11-25 18:43</div>
            <div class="timeline-body"><p>I think it&#x27;s better to have an unstable (versioned?) implementation rather than no implementation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/theotchlx">@theotchlx</a> on 2025-11-26 07:25</div>
            <div class="timeline-body"><blockquote>
<p>I think it&#x27;s better to have an unstable (versioned?) implementation rather than no implementation.</p>
</blockquote>
<p>Could you clarify your thoughts? Are you referring to an existing implementation or some design idea?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eirnym">@eirnym</a> on 2025-11-26 15:59</div>
            <div class="timeline-body"><p>The main problem I see in this PR is not that implementation of this PR would help people, but <em>how</em> data should be presented to a user. My statement is that any implementation would be better than no implementation.</p>
<p>There always be people, who don&#x27;t agree on specific output. For example, we all know from the past, that major version may break how data is configured and presented, this is why I still see multiple tools using clap 3.x rather than the latest version.</p>
<p>My additional proposal is to have presentation to be always feature-gated. And if there would be mechanism to provide representation of a specific feature, it would be even better. In this way even new representation would be placed, most people would use newest library version. rather than froze the version.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/theotchlx">@theotchlx</a> on 2025-11-26 22:50</div>
            <div class="timeline-body"><p>The feature flag seems like a nice idea, but I wouldn&#x27;t use it (same reasons as <a href="https://github.com/clap-rs/clap/issues/4416#issuecomment-2302136777">this comment</a> I suppose).
It&#x27;s more configuration for the devs (for a CLI!), e.g. with the commit I linked earlier, I don&#x27;t want to add a feature flag on the CLI package, demonstrate to the maintainer why this is needed, and that it&#x27;s transitive until the feature gets rolled out in some future version, when this flag will have to be removed.</p>
<hr>
<p>All in all I think we should just design this. It has to be done some day anyway :P</p>
<p>It looks like the design is on hold, as per <a href="https://github.com/clap-rs/clap/issues/4416#issuecomment-2184258391">this comment</a> from @epage :</p>
<blockquote>
<p>The big question for me for this is how visible aliases for possible values should be rendered. In the short help, it feels weird to redundantly list options that map back to the same thing and would get weird nesting expressions into each other. With long help, we could have an [aliases: ...] after the item, I guess.</p>
</blockquote>
<p>I think the <code>[aliases: ...] </code> idea is neat :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eirnym">@eirnym</a> on 2025-11-26 23:31</div>
            <div class="timeline-body"><p>I understand. There&#x27;s won&#x27;t be a &quot;standard&quot; output which will be great for everyone. There&#x27;s always be people who doesn&#x27;t want something, who wants it in way it&#x27;s implemented and many of them who want it differently. For example, I&#x27;d like some minor parts of <code>clap --help</code> output to be formatted differently and make eventually <code>clap --help</code> localized. Because of the same issues some applications just froze clap level, others hard-coded the output they like and in some applications I might do the same.</p>
<p><code>clap</code> could make output modular and configurable. E.g. to have default output, provide ability to pass a formatter function-like object directly and provide a separate module to keep legacy formats. This will satisfy all groups and keep standards while keeping all things clean. The additional improvement is this would open an ability to experiment and add multiple additional not yet implemented in standard way features like this one.</p>
<p>By the way, Rust ecosystem is one of the worst across multiple languages to provide localized messages to the user. And the biggest reasons are &quot;we don&#x27;t want to expose internal parts of <code>Error</code> enum&quot; and &quot;we want to make it in the one and only standard way&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/theotchlx">@theotchlx</a> on 2025-11-27 14:17</div>
            <div class="timeline-body"><p>That&#x27;s an idea with even more flexibility, which is great, but that comes with again more configuration and as I understand that&#x27;s not the point of clap</p>
<p>I mean we can provide an out-of-the-box &quot;display aliases&quot; thing and then, in a later issue, add a general formatter for clap but I feel this is a different beast.</p>
<p>I&#x27;d love to get a maintainer&#x27;s input on if we can finalize the design for this feature and release something?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-12-01 16:51</div>
            <div class="timeline-body"><blockquote>
<p>That&#x27;s an idea with even more flexibility, which is great, but that comes with again more configuration and as I understand that&#x27;s not the point of clap</p>
</blockquote>
<p>Earlier I commented about minimizing configuration (<a href="https://github.com/clap-rs/clap/issues/4416">clap-rs/clap#4416</a>#issuecomment-2302136777).  That was specifically about having a toggle for every little custom behavior someone might want.   Those add binary bloat, slow down compile times, and bypass us having the conversations about what clap should do by default for all projects.</p>
<p>I would very much be interested in splitting the help generation out into a type that collects data and a type that formats to put that behind a trait for people to provide whatever they need.  Then instead of clap dynamically choosing between hard coded help and dynamically generated help, users can get what they want for help without paying extra in compilation time.  I just haven&#x27;t had a chance yet to work on this.</p>
<blockquote>
<p>I&#x27;d love to get a maintainer&#x27;s input on if we can finalize the design for this feature and release something?</p>
</blockquote>
<p>I&#x27;ve not yet seen a concrete proposal for what the API and help output would be.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:59:27 UTC
    </footer>
</body>
</html>
