```yaml
number: 5091
title: "Default value that panics only if neither `arg` nor `env` provided"
type: issue
state: closed
author: SamuelMarks
labels:
  - C-enhancement
assignees: []
created_at: 2023-08-26T21:19:54Z
updated_at: 2023-08-27T01:13:22Z
url: https://github.com/clap-rs/clap/issues/5091
synced_at: 2026-01-10T01:57:48Z
```

# Default value that panics only if neither `arg` nor `env` provided

---

_Issue opened by @SamuelMarks on 2023-08-26 21:19_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Clap Version

4.4.0

### Describe your use case

```rs
use clap::{Parser, CommandFactory};

use const_format::concatcp;
use clap::Parser;

#[derive(Parser)]
struct Cli {
    #[arg(long, env = "ROOT", default_value_t = String::from(concatcp!(
    (
    (if cfg!(windows) {
    std::env::var("UserProfile")
    } else {
    std::env::var("HOME")
    })
    .unwrap()
    ),
    std::path::MAIN_SEPARATOR_STR, "stuff",
    std::path::MAIN_SEPARATOR_STR, "name")))]
    root: String,
}
```

### Describe the solution you'd like

Given a system without a home directory (e.g., could not be obtained from [`std::env::home_dir`](https://doc.rust-lang.org/std/env/fn.home_dir.html), [dirs](https://crates.io/crates/dirs), [directories](https://crates.io/crates/directories), or other crate), it should first:
- If arg is provided, use this
- Else if env var is provided, use this
- Finally, panic (if no home dir is available in environment) xor use home dir (if available)

### Alternatives, if applicable

_No response_

### Additional Context

_No response_

---

_Label `C-enhancement` added by @SamuelMarks on 2023-08-26 21:19_

---

_Comment by @epage on 2023-08-27 00:53_

First, I'm going to reinterpret "panic" as "error" seeing as we'd refer not to panic for user errors.

This runs a bit counter to the meaning of a default value.  My first reaction is that this should be handled in the code outside of clap because its so outside of the common case.  The second thought I had is you could allow for `~/` in the user input (even though most shells will expand it for you) and a `value_parser` could then expand it and error if there isn't a home directory.  If neither works, I would lean towards #3476.  Overall we have other stuff tracking that though, so I'm going to close in favor of one of these existing options.

---

_Closed by @epage on 2023-08-27 00:53_

---

_Comment by @SamuelMarks on 2023-08-27 01:13_

Sounds good I'll keep an eye on that issue. In the meantime I've put `$HOME` as placeholder and later on in my code I'll validate that if the value still startswith `$HOME` then look for homedir and panic if not found.

---
