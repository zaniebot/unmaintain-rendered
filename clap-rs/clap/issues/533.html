<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>required_unless produces error on a flag - clap-rs/clap #533</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>required_unless produces error on a flag</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/533">#533</a>
        opened by <a href="https://github.com/joshtriplett">@joshtriplett</a>
        on 2016-06-22 02:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/joshtriplett">@joshtriplett</a> on 2016-06-22 02:46</div>
            <div class="timeline-body"><p>As the clap documentation notes, you can't make a flag required.  However, it should be possible to mark a flag as <code>.required_unless</code> another flag or argument.  Doing so currently produces a runtime panic.</p>
<p>You can work around this with another argument by marking the argument as <code>.required_unless</code> the flag instead. However, given two flags you can't.</p>
<p>(Alternatively, if this would make the require requirements more difficult to express, the documentation could instead explicitly note this case and point to another way to say &quot;one or more of these are required&quot;.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-06-23 03:43</div>
            <div class="timeline-body"><p>The thought process behind that is somewhat opinionated...and being that <code>clap</code> is becoming more heavily used I'm willing to discuss changing.</p>
<hr />
<p>Currently flags can't be required because they're simply boolean values. If one should be required, then I would have thought the developer should &quot;imply&quot; it's use (perhaps with a note in the usage stating that it's implied in certain cases). IMO if flag <code>--foo</code> is required, then forcing the end user to type <code>--foo</code> unnecessary verbosity. There isn't any additional context passed to the developer/program by forcing them to do so.</p>
<p>The case against my thinking would be forcing the user to type <code>--foo</code> means they <em>know</em> that particular functionality/feature is being used.</p>
<p>I'm curious to know what others thoughts on the matter are?</p>
<hr />
<p>If the above reasoning is correct, and there is a case where <code>required_unless</code> falls within that reasoning yet still causes a runtime panic...that's a bug. In which case I just need some clarity on this particular case :smile:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> added by @kbknapp on 2016-06-23 03:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/joshtriplett">@joshtriplett</a> on 2016-06-23 04:31</div>
            <div class="timeline-body"><p>I completely agree with the rationale for not allowing <code>.required</code> on a flag; please don't change that.</p>
<p>Here's my use case: I have a command similar to <code>git rebase</code>, which takes a flag <code>--interactive</code> (<code>-i</code>) and a positional argument <code>onto</code>.  You can run <code>rebase -i</code> with no other arguments, or <code>rebase some_commit</code>, or <code>rebase -i some_commit</code>, but <code>rebase</code> without either <code>-i</code> or <code>onto</code> makes no sense as it would have nothing to do.  So, I'd like to say &quot;you must specify at least one of <code>onto</code> or <code>--interactive</code>.</p>
<p>I'd be happy with another way of doing this, such as a <code>require_any</code> method on <code>ArgGroup</code>, especially if that would give clap enough semantic information to give an error message like &quot;you must specify at least one of --interactive/-i or base&quot; (along with the help).  Ideally the usage message will also reflect this by calling out the flags in that <code>ArgGroup</code> and not burying them in <code>[FLAGS]</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-06-23 13:33</div>
            <div class="timeline-body"><p>Ah, ok I understand, thanks! I think what I'll try to do is add a method <code>ArgGroup::multiple(bool)</code> which when combined with <code>ArgGroup::required(true)</code> does exactly like you're saying. Vice the normal <code>ArgGroup::required(true)</code> which makes one of them required, but <em>only</em> one and the rest are all mutually exclusive.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: enhancement</span> added by @kbknapp on 2016-06-23 13:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: docs</span> added by @kbknapp on 2016-06-23 13:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: intermediate</span> added by @kbknapp on 2016-06-23 13:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P3: want to have</span> added by @kbknapp on 2016-06-23 13:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: parsing</span> added by @kbknapp on 2016-06-23 13:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @kbknapp on 2016-06-23 13:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: arg groups</span> added by @kbknapp on 2016-06-23 13:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> removed by @kbknapp on 2016-06-23 13:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "2.7.0" by @kbknapp on 2016-06-23 13:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @kbknapp by @kbknapp on 2016-06-23 13:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-06-23 15:29</div>
            <div class="timeline-body"><p>This is implemented with #535</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @homu on 2016-06-23 20:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/joshtriplett">@joshtriplett</a> on 2016-06-23 20:42</div>
            <div class="timeline-body"><p>@kbknapp Thanks for the fast fix!  I'll test this today, including what the error message looks like for not providing one of the arguments.</p>
<p>Any plans for a clap release incorporating this?  (I can pull clap from git for testing, but it'd be nice to have a released version on crates.io.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/joshtriplett">@joshtriplett</a> on 2016-06-23 21:36</div>
            <div class="timeline-body"><p>@kbknapp Just tested this; works perfectly.  Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/537.html">clap-rs/clap#537</a> on 2016-06-23 21:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-06-24 00:19</div>
            <div class="timeline-body"><p>@joshtriplett Once #376 #536 are merged I'll post the new version to crates.io. If #376 takes too much time I may just bump and publish prior. So in the next day or so I should have the new version out on crates.io</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-06-24 00:33</div>
            <div class="timeline-body"><p>Add #539 #538 and #537 to that list :stuck_out_tongue_winking_eye:</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:31 UTC
    </footer>
</body>
</html>
