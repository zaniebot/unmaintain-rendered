```yaml
number: 1204
title: "Conflicts don't propagate from the global level to the subcommand"
type: issue
state: open
author: larsrh
labels:
  - C-bug
  - A-parsing
  - E-medium
  - A-validators
assignees: []
created_at: 2018-03-06T21:25:15Z
updated_at: 2021-12-09T18:11:18Z
url: https://github.com/clap-rs/clap/issues/1204
synced_at: 2026-01-10T01:57:42Z
```

# Conflicts don't propagate from the global level to the subcommand

---

_Issue opened by @larsrh on 2018-03-06 21:25_

As discussed on Gitter: https://gitter.im/kbknapp/clap-rs?at=5a9f003af3f6d24c68450335

### Affected Version of clap

2.31.1

### Expected Behavior Summary

When declaring that a subcommand argument is in conflict with a global argument, clap should produce an error no matter whether the global argument comes after or before the subcommand.

### Actual Behavior Summary

global argument comes after: conflict
global argument comes before: no conflict

### Sample Code or Link to Sample Code

(by @kbknapp)

```rust
extern crate clap;
use clap::{Arg, App, SubCommand};

fn main(){
    let _ = App::new("fake")
        .arg(Arg::with_name("glob")
            .short("g")
            .global(true))
        .subcommand(SubCommand::with_name("foo")
            .arg(Arg::with_name("conf")
                .short("c")
                .conflicts_with("glob")))
        .get_matches_from(vec!["fake", "foo", "-g", "-c"]);
}
```

### Steps to Reproduce the issue

Run the above code with `fake foo -g -c` and `fake -g foo -c` and observe the difference.

---

_Label `T: bug` added by @kbknapp on 2018-03-07 01:23_

---

_Label `P3: want to have` added by @kbknapp on 2018-03-07 01:23_

---

_Label `C: parsing` added by @kbknapp on 2018-03-07 01:23_

---

_Label `C: errors` added by @kbknapp on 2018-03-07 01:23_

---

_Comment by @kbknapp on 2018-03-07 01:25_

Thanks for submitting!

For my own notes and from the gitter chat

* The flag is actually propagated down to the subcommand correctly, but the conflict doesn't register
* The same happens if we use options instead of flags (so it's not flag specific)


---

_Comment by @mainrs on 2018-08-25 10:26_

Just a side note, shouldn't the help also not display the global arg if the subcommand arg is in conflict and the subcommand arg is required? This case wouldn't allow the global arg anyway to be passed down. 
```rust
extern crate clap;
use clap::{Arg, App, SubCommand};

fn main() {
	let _ = App::new("fake")
		.arg(Arg::with_name("glob")
			.short("g")
			.global(true))
		.subcommand(SubCommand::with_name("foo")
			.arg(Arg::with_name("conf")
				.short("c")
				.takes_value(true)
				.required(true)
				.conflicts_with("glob")))
		.get_matches_from(vec!["fake", "foo", "-g", "-c"]);
}
```

---

_Added to milestone `3.0` by @pksunkara on 2020-04-09 07:18_

---

_Assigned to @ldm0 by @ldm0 on 2021-03-13 08:14_

---

_Removed from milestone `3.0` by @pksunkara on 2021-05-26 00:31_

---

_Added to milestone `3.1` by @pksunkara on 2021-05-26 00:31_

---

_Referenced in [epage/clapng#89](../../epage/clapng/issues/89.md) on 2021-12-06 16:40_

---

_Label `C: errors` removed by @epage on 2021-12-08 20:26_

---

_Label `C: validators` added by @epage on 2021-12-08 20:26_

---

_Removed from milestone `3.1` by @epage on 2021-12-08 20:26_

---

_Unassigned @ldm0 by @epage on 2021-12-09 18:10_

---

_Label `P3: want to have` removed by @epage on 2021-12-09 18:10_

---

_Label `E-medium` added by @epage on 2021-12-09 18:11_

---

_Referenced in [clap-rs/clap#3135](../../clap-rs/clap/issues/3135.md) on 2021-12-13 22:40_

---

_Referenced in [jj-vcs/jj#101](../../jj-vcs/jj/issues/101.md) on 2022-03-02 18:49_

---

_Referenced in [clap-rs/clap#3767](../../clap-rs/clap/pulls/3767.md) on 2022-05-30 05:10_

---

_Referenced in [paritytech/subxt#805](../../paritytech/subxt/pulls/805.md) on 2023-01-27 15:26_

---

_Referenced in [clap-rs/clap#5588](../../clap-rs/clap/issues/5588.md) on 2024-07-19 16:06_

---

_Referenced in [clap-rs/clap#5899](../../clap-rs/clap/issues/5899.md) on 2025-02-03 12:51_

---

_Referenced in [clap-rs/clap#5977](../../clap-rs/clap/issues/5977.md) on 2025-04-24 14:16_

---

_Referenced in [clap-rs/clap#6049](../../clap-rs/clap/issues/6049.md) on 2025-06-27 15:16_

---
