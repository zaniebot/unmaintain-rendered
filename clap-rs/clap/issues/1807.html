<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Better than display_order and DeriveDisplayOrder argument positioning - clap-rs/clap #1807</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Better than display_order and DeriveDisplayOrder argument positioning</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/clap-rs/clap/issues/1807">#1807</a>
        opened by <a href="https://github.com/I60R">@I60R</a>
        on 2020-04-11 14:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/I60R">@I60R</a> on 2020-04-11 14:06</div>
            <div class="timeline-body"><h3>Make sure you completed the following tasks</h3>
<ul>
<li>[x] Searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[x] Searched the closes issues</li>
</ul>
<h3>Describe your use case</h3>
<p>The same as for <code>Arg::display_order(usize)</code> and <code>DeriveDisplayOrder</code> but should be easier to apply</p>
<h3>Describe the solution you'd like</h3>
<ul>
<li>Works well with <code>structopt</code>/<code>clap_derive</code> flattening</li>
<li>Doesn't move both arguments to top or to the bottom like <code>.display_order</code> (because 999 is default for every argument).</li>
<li><code>DeriveDisplayOrder</code> shouldn't override it</li>
</ul>
<h3>Alternatives, if applicable</h3>
<p>Keep using <code>Arg::display_order(usize)</code> and <code>DeriveDisplayOrder</code></p>
<h3>Additional context</h3>
<hr />
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by @I60R on 2020-04-11 14:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @pksunkara on 2020-04-11 14:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: args</span> added by @pksunkara on 2020-04-11 14:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: usage strings</span> added by @pksunkara on 2020-04-11 14:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> added by @pksunkara on 2020-04-11 14:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2020-04-29 03:32</div>
            <div class="timeline-body"><p>This might be pretty hairy to implement, especially if we end up trying to detect loops (<code>A</code> says display after <code>B</code>, and <code>B</code> says display after <code>A</code>).</p>
<p>I'm leaning towards closing this feature, as it'd significantly impact the code used to generate help messages for (my subjectively) little benefit.</p>
<p>@I60R could you elaborate on why doesn't <code>DeriveDisplayOrder</code> work in your case? Or <code>Arg::help_heading</code> doesn't fit your use case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/I60R">@I60R</a> on 2020-05-06 06:42</div>
            <div class="timeline-body"><blockquote>
<p>This might be pretty hairy to implement, especially if we end up trying to detect loops (A says display after B, and B says display after A).</p>
</blockquote>
<p>Okay, I understand.</p>
<blockquote>
<p>@I60R could you elaborate on why doesn't DeriveDisplayOrder work in your case?</p>
</blockquote>
<p>I actually use it. The problem was that it don't play well with <code>structopt</code> flattening, more specifically it doesn't allow to move argument into separate struct while keeping its order in --help message. This could be easily <code>structopt</code> problem, however it also seems that it occurs because current <code>display_order</code> functionality in <code>clap</code> is somehow limited.</p>
<p><code>Arg::display_after</code> in <code>clap</code> was simply the most straightforward solution here that I was able to imagine</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2020-05-11 18:41</div>
            <div class="timeline-body"><blockquote>
<p>I actually use it. The problem was that it don't play well with structopt flattening, more specifically it doesn't allow to move argument into separate struct while keeping its order in --help message. This could be easily structopt problem, however it also seems that it occurs because current display_order functionality in clap is somehow limited.</p>
</blockquote>
<p>Aaah ok, I understand. Yeah to me that sounds like either a feature/bug we could work on as part of <code>clap_derive</code> (what was <code>structopt</code>).</p>
<p>I'm open to others opinions as well, but even when flattening the order should be preserved. That sounds like a new issue to me, or perhaps we re-name this issue and update the OP with this new constraint/requirement.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-05-11 18:43</div>
            <div class="timeline-body"><p>@I60R Could you provide us a sample code where it doesn't work? AFAIK, even flattening should make it work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Add display_after for easier arg positioning in --help message" to "Better than display_order and DeriveDisplayOrder argument positioning" by @I60R on 2020-05-18 20:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/I60R">@I60R</a> on 2020-05-18 20:11</div>
            <div class="timeline-body"><blockquote>
<p>I'm open to others opinions as well, but even when flattening the order should be preserved. That sounds like a new issue to me, or perhaps we re-name this issue and update the OP with this new constraint/requirement.</p>
</blockquote>
<p>Done. I also think that I've found what argument positioning I want:</p>
<ol>
<li><p>With <code>DeriveDisplayOrder</code> we increment each arg <code>display_order</code> starting from 1000 but only for those that had it unspecified. Then, if multiple args sharing the same <code>display_order</code> they would be sorted alphabetically (default behavior).</p>
</li>
<li><p>Instead or alongside with we may provide <code>display_all</code> method for <code>App</code> and <code>ArgGroup</code> which would be used like this:</p>
</li>
</ol>
<pre><code class="language-rust">    display_all = &amp;[
        (&quot;FLAGS&quot;, &amp;[
            &quot;first&quot;,
            &quot;second&quot;,
            &quot;x&quot;,
            ...
        ]),
        (&quot;OPTIONS&quot;, &amp;[
            &quot;nth&quot;,
            &quot;nth+1&quot;,
            ...
        ]),
        ...,
        (&quot;CUSTOM SECTION&quot;, &amp;[
            ...,
            &quot;last-1&quot;,
            &quot;last&quot;
        ])
    ],
</code></pre>
<p>it could substitute <code>display_order</code> and <code>display</code> functions, plus add more styling options like custom section headers, separators, etc.</p>
<p>@kbknapp is it possible to be implemented?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-05-18 20:22</div>
            <div class="timeline-body"><blockquote>
<p>custom section headers</p>
</blockquote>
<p>We have them. <code>help_heading</code>.</p>
<blockquote>
<p>is it possible to be implemented?</p>
</blockquote>
<p>You are not exactly giving us a sample of the code where <code>DeriveDisplayOrder</code> is not working in clap_derive. As I said before, flattening the struct should work with the option well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/I60R">@I60R</a> on 2020-05-18 20:44</div>
            <div class="timeline-body"><blockquote>
<p>We have them. help_heading.</p>
</blockquote>
<p>The whole point isn't in having them, but in having them in the same place and not using them explicitly.</p>
<blockquote>
<p>You are not exactly giving us a sample of the code where DeriveDisplayOrder is not working in clap_derive. As I said before, flattening the struct should work with the option well.</p>
</blockquote>
<p>That's actually the problem e.g. if you have this unflattened struct:</p>
<pre><code class="language-rust">#[derive(StructOpt)]
#[structopt(global_settings=&amp;[DeriveDisplayOrder])]
struct Opt {
    a: bool,
    b: bool,
    c: bool,
    ...
}
</code></pre>
<p>and then refactors it to flattened</p>
<pre><code class="language-rust">#[derive(StructOpt)]
#[structopt(global_settings=&amp;[DeriveDisplayOrder])]
struct Opt {
    b: bool,
    #[structopt(flatten)]
    flattened: Flattened,
    ...
}

#[derive(StructOpt)]
struct Flattened {
    a: bool,
    c: bool,
}
</code></pre>
<p>you may find that the original order is messed up (b-a-c) and there's no straightforward way to fix it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-05-19 08:39</div>
            <div class="timeline-body"><blockquote>
<p>With DeriveDisplayOrder we increment each arg display_order starting from 1000 but only for those that had it unspecified. Then, if multiple args sharing the same display_order they would be sorted alphabetically (default behavior).</p>
</blockquote>
<p>Yes, that can be implemented.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/153.html">epage/clapng#153</a> on 2021-12-06 20:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: args</span> removed by @epage on 2021-12-08 20:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: usage strings</span> removed by @epage on 2021-12-08 20:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-help</span> added by @epage on 2021-12-08 20:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> removed by @epage on 2021-12-08 21:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @epage on 2021-12-08 21:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-09 22:24</div>
            <div class="timeline-body"><blockquote>
<p>only for those that had it unspecified</p>
</blockquote>
<p>This is already done.  We detect defaults and don't override them.  The only thing remaining is what the starting display order should be when deriving.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3138.html">clap-rs/clap#3138</a> on 2021-12-09 22:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-09 22:33</div>
            <div class="timeline-body"><p>So the crux of the issue is that if the struct hierarchy doesn't match your visual hierarchy, you have to manually specify all of the display orders.</p>
<p>I was wondering if we could do something like <code>App::help_heading</code> (which has naming issues similar to #1553) but the problem is a derive user doesn't have the opportunity to set an app function outside of when they do the flatten or define the struct.  We can't just do a backup-restore approach because they would need to set where to pick up the counting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.1" by @epage on 2021-12-09 22:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> removed by @epage on 2021-12-09 22:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> added by @epage on 2021-12-09 22:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-12-10 14:06</div>
            <div class="timeline-body"><blockquote>
<p>you have to manually specify all of the display orders.</p>
</blockquote>
<p>I think the case for that would be pretty niche. I think people would just find it easy to reorder the struct.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-10 17:23</div>
            <div class="timeline-body"><p>If we feel its niche enough, is there anything left to do for this issue?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-12-10 17:28</div>
            <div class="timeline-body"><blockquote>
<p>The only thing remaining is what the starting display order should be when deriving.</p>
</blockquote>
<p>I think that. Unless another issue covers that? I will leave it up to you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-10 17:33</div>
            <div class="timeline-body"><p>For the starting display order value for deriving, I think we'd need more information on why one value should be picked over another.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-13 19:29</div>
            <div class="timeline-body"><p>Had some ideas:</p>
<p>In #1553, we are proposing renaming <code>help_heading</code> to <code>next_help_heading</code>.</p>
<p>What if we add a <code>next_display_order</code> that acts similar to <code>next_help_heading</code> in the builder API?  When passing in <code>None</code>, we default all of the display orders, making it like the user doesn't set <code>DeriveDisplayOrder</code> (this is similar to what is pproposed in #2808).</p>
<p>In the derive API, the one change is we won't save/restore the display order because that will be disruptive to the &quot;do nothing&quot; user.</p>
<p>For derive users, at minimum this gives them the ability to set the next display order.  The problem is they can't then change the display order mid-way to correct for wanting to jump around.  To solve that, we turn the <code>clap</code> attribute into a shorthand for <code>clap::app</code>, <code>clap::arg</code> , etc (depending on the context), see #1553.  We then add support for the user to specify <code>clap::app</code> on <code>Args</code> fields.  These would be app calls made before adding the <code>Arg</code> to the <code>App</code>.  This would allow both <code>next_help_heading</code> and <code>next_display_order</code> to be called by the user whenever they want, like they can with the builder API.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2983.html">clap-rs/clap#2983</a> on 2021-12-14 17:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3269.html">clap-rs/clap#3269</a> on 2022-01-09 01:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3221.html">clap-rs/clap#3221</a> on 2022-01-25 15:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-02-08 01:21</div>
            <div class="timeline-body"><p>#3414 did</p>
<ul>
<li><code>help_heading</code> -&gt; <code>next_help_heading</code></li>
<li>Added <code>next_display_order</code></li>
</ul>
<p>The only remaining work is to allow setting app attributes on arguments in the derive.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3444.html">clap-rs/clap#3444</a> on 2022-02-11 01:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-05-09 20:17</div>
            <div class="timeline-body"><blockquote>
<p>The only remaining work is to allow setting app attributes on arguments in the derive.</p>
</blockquote>
<p>Huh, so derive helper attributes can only be identifiers.  Item paths seem to be used for attribute macros.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-05-09 20:34</div>
            <div class="timeline-body"><p><strong>Context</strong>: Clap has context-specific builder functions.  <code>next_help_heading</code> is one example where it will set a field on all future <code>Arg</code>s added to the <code>Command</code>.</p>
<pre><code class="language-rust">    let cmd = Command::new(&quot;blorp&quot;)
        .author(&quot;Will M.&quot;)
        .about(&quot;does stuff&quot;)
        .version(&quot;1.4&quot;)
        .arg(
            arg!(-f --fake &quot;some help&quot;)
                .required(true)
                .value_names(&amp;[&quot;some&quot;, &quot;val&quot;])
                .takes_value(true)
                .use_value_delimiter(true)
                .require_value_delimiter(true)
                .value_delimiter(':'),
        )
        .next_help_heading(Some(&quot;NETWORKING&quot;))
        .arg(
            Arg::new(&quot;no-proxy&quot;)
                .short('n')
                .long(&quot;no-proxy&quot;)
                .help(&quot;Do not use system proxy settings&quot;),
        )
        .args(&amp;[Arg::new(&quot;port&quot;).long(&quot;port&quot;)]);
</code></pre>
<p><strong>Problem</strong>: this is not currently exposed in the derive API.  <a href="https://github.com/clap-rs/clap/tree/master/examples/derive_ref#overview"><code>Command</code> and <code>Arg</code> attributes can only show up in specific places</a>, so you can't create an attribute that affects all future fields / <code>Arg</code>s by calling a <code>Command</code> function via an attribute.  The one exception is when <code>#[clap(flatten)]</code>ing</p>
<pre><code class="language-rust">    #[derive(Debug, Clone, Parser)]
    struct CliOptions {
        #[clap(flatten)]
        options_a: OptionsA,
    }

    #[derive(Debug, Clone, Args)]
    #[clap(next_help_heading = &quot;HEADING A&quot;)]
    struct OptionsA {
        #[clap(long)]
        should_be_in_section_a: u32,
    }
</code></pre>
<p>How do we support context-specific builder methods like this without forcing a <code>#[clap(flatten)]</code>?</p>
<p><strong>Possible solutions</strong>:</p>
<p><strong>Key off of the inner-attribute name</strong> and call switch which we can from that (if attr inner name is <code>next_help_heading</code>, then know to call that on the <code>Command</code> rather than the <code>Arg</code>).  This seems brittle, only working for whats been hard coded (we might forget things, we might make assumptions for what people want to do), and can run into conflicts in function names between <code>Arg</code>s and <code>Command</code>s.</p>
<p><strong>Have the user explicitly state what the attribute is for</strong>.  I feel like this would also make what is happening clearer.</p>
<p>How does the user specify which kind of attribute it is?  Some ideas include:</p>
<ul>
<li>~~<code>#[clap::command(next_help_heading = &quot;NETWORKING&quot;)]</code>: outer-attribute namespace~~ Derive helper attributes can only be identifiers, not item paths</li>
<li><code>#[clap(command::next_help_heading = &quot;NETWORKING&quot;)]</code>: inner-attribute namespaces</li>
<li><code>#[clap_command(next_help_heading = &quot;NETWORKING&quot;)]</code>: psuedo-outer-attribute namespacing</li>
<li><code>#[clap(command(next_help_heading = &quot;NETWORKING&quot;))]</code>: fully own the nested parens</li>
</ul>
<p><strong>Per-use outer-attributes</strong></p>
<ul>
<li><code>#[command(next_help_heading = &quot;NETWORKING&quot;)]</code>: we'd have <code>#[command(...)]</code>, <code>#[arg(...)]</code>, etc.</li>
</ul>
<p>I'm leaning towards inner-attribute namespaces</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Muscraft">@Muscraft</a> on 2022-05-11 19:02</div>
            <div class="timeline-body"><p><code>psuedo-outer-attribute namespacing</code> should not be considered unless it comes from a different crate. It could cause problems when someone is new to the codebase and wants to look up how <code>clap_command</code> works and there is no crate for it.  <code>#[clap(command....)]</code> is more descriptive of where it comes from and what is going on.</p>
<p>As for <code>inner-attribute namespaces</code> vs <code>fully own the nested parens</code> I prefer the latter. This is mostly because I have seen other crates use it (e.g. <a href="https://serde.rs/container-attrs.html#rename_all"><code>#[serde(rename_all = &quot;...&quot;)]</code></a>). While there is no &quot;official&quot; style, keeping consistent with other crates is a benefit</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-05-11 19:13</div>
            <div class="timeline-body"><blockquote>
<p>As for inner-attribute namespaces vs fully own the nested parens I prefer the latter. This is mostly because I have seen other crates use it (e.g. <code>#[serde(rename_all = &quot;...&quot;)]</code>(https://serde.rs/container-attrs.html#rename_all)). While there is no &quot;official&quot; style, keeping consistent with other crates is a benefit</p>
</blockquote>
<p>To clarify, we already do what serde does.  Note the example is <code>#[clap(next_help_heading = &quot;SECTION&quot;)]</code>.  That is the outer/inner attribute style of serde.  I'm not aware of other crates using namespacing for attributes,. of any kind.  If anything, they use additional attributes but I can't remember what examples there are.  Forgot to include that in the options</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3799.html">clap-rs/clap#3799</a> on 2022-06-08 16:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "4.0" by @epage on 2022-06-08 16:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4129.html">clap-rs/clap#4129</a> on 2022-08-26 20:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4132.html">clap-rs/clap#4132</a> on 2022-08-27 02:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4179.html">clap-rs/clap#4179</a> on 2022-09-02 19:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4180.html">clap-rs/clap#4180</a> on 2022-09-02 20:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-09-02 20:56</div>
            <div class="timeline-body"><p>https://github.com/clap-rs/clap/pull/4180 renames the attributes:</p>
<pre><code class="language-rust">/// Simple program to greet a person
#[derive(Parser, Debug)]
#[command(author, version, about, long_about = None)]
struct Args {
    /// Name of the person to greet
    #[arg(short, long)]
    name: String,

    /// Number of times to greet
    #[arg(short, long, default_value_t = 1)]
    count: u8,
}
</code></pre>
<p>My original plan was to support:</p>
<pre><code class="language-rust">/// Simple program to greet a person
#[derive(Parser, Debug)]
#[command(author, version, about, long_about = None)]
struct Args {
    /// Name of the person to greet
    #[command(next_help_heading = &quot;Foo&quot;)]
    #[arg(short, long)]
    name: String,

    /// Number of times to greet
    #[command(next_help_heading = &quot;Bar&quot;)]
    #[arg(short, long, default_value_t = 1)]
    count: u8,
}
</code></pre>
<p>but alternatively we could do something like</p>
<pre><code class="language-rust">/// Simple program to greet a person
#[derive(Parser, Debug)]
#[command(author, version, about, long_about = None)]
struct Args {
    #[command(next_help_heading = &quot;Foo&quot;)]
    _foo: (),

    /// Name of the person to greet
    #[arg(short, long)]
    name: String,

    /// Number of times to greet
    #[command(next_help_heading = &quot;Bar&quot;)]
    _bar: (),

    #[arg(short, long, default_value_t = 1)]
    count: u8,
}
</code></pre>
<ul>
<li>Pro: More visually distinct</li>
<li>Pro: Less confusion over mixing of attributes on a field</li>
<li>Pro: Less hacky implemenation</li>
<li>Con: Requires naming the no-op field (should be neutral at compile time)</li>
</ul>
<p>Thoughts?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4181.html">clap-rs/clap#4181</a> on 2022-09-03 00:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-09-05 17:52</div>
            <div class="timeline-body"><p>In planning this, I forgot about https://github.com/clap-rs/clap/issues/1553 which has <code>command</code> attributes both for variants and the container.  We can''t use the attribute alone to distinguish.   Maybe good enough because doing things with subcommands is so rare?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4184.html">clap-rs/clap#4184</a> on 2022-09-06 17:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-09-06 17:57</div>
            <div class="timeline-body"><p>Another problem I ran into with this is that <code>#[command(subcommand)]</code> would be great to allow both container attributes and (for enums) child variant attributes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-09-06 18:39</div>
            <div class="timeline-body"><p>To recap</p>
<p>Ideally, we would like to support use of at least <code>next_display_order</code> and <code>next_help_heading</code> in the middle of structs and enums (see also #1553) as there isn't a way for derive users today to apply a help heading to a group of args (or subcommands after #1553) without either doing it one by one or by flattening which can be disruptive to the code.</p>
<p>I had made the <code>#[clap(...)]</code> attributes more specific (<code>arg</code>, <code>command</code>, etc) and was looking to</p>
<ul>
<li>allow <code>#[command(...)]</code> attributes on arg fields so they apply to the container</li>
<li>open up so <code>subcommand</code>, <code>flatten</code>, and <code>external_subcommand</code> could accept container attributes.</li>
</ul>
<p>Problems</p>
<ul>
<li><code>subcommand</code> on a variant already accepts attributes for the variant itself because it will be a subcommand</li>
<li>There no way to force <code>#[command(...]</code> attribute on a variant to apply to the container</li>
</ul>
<p>One alternative I had considered is just special casing <code>next_help_heading</code> and <code>next_display_order</code> but</p>
<ul>
<li>That muddles the waters for explaining to users the different attributes</li>
<li>It still runs unto problems with <code>#[command(subcommand)]</code> enum variants</li>
</ul>
<p>Out-there ideas</p>
<ul>
<li>Punt and allow this to work for deriving <code>Args</code> but not <code>Subcommand since most of this customization will be on </code>Subcommand`<ul>
<li>Should <code>#[command(subcommand)]</code> still not allow other attributes within an <code>Args</code> so that the attributes have a single meaning?  If so, the workaround for anything applied there is to put it on the enum.</li>
<li>Lack of consistency can make learning more difficult</li>
</ul>
</li>
<li>Add a new <code>#[parent(...)]</code> or <code>#[super(...)]</code> attribute<ul>
<li>Not as clear that it is tied to clap, could run into conflicts</li>
</ul>
</li>
<li>Add <code>#[command(super::next_help_heading = ...)]</code> support</li>
<li>Add a <code>#[command(super, next_help_heading = ...)]</code> kind<ul>
<li>This would require adding no-op fields and variants.  The latter would be unergonomic for a user to deal with due to exhaustiveness of match</li>
</ul>
</li>
</ul>
<p>@pksunkara and anyone else, I'd appreciate input on this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-09-07 15:30</div>
            <div class="timeline-body"><p>I don't think any of the proposed options require breaking changes beyond what is already merged, so going to push this out of 4.0.0.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "4.0" by @epage on 2022-09-07 15:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-derive</span> added by @epage on 2022-09-16 20:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../quickwit-oss/quickwit/issues/2236.html">quickwit-oss/quickwit#2236</a> on 2022-11-03 15:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/975.html">clap-rs/clap#975</a> on 2023-02-20 13:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../fluvio-community/fluvio/pulls/3234.html">fluvio-community/fluvio#3234</a> on 2023-05-08 16:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:07 UTC
    </footer>
</body>
</html>
