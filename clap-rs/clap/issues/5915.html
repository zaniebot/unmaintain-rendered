<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`hide_long_help(true)` causes help alignment issues - clap-rs/clap #5915</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>hide_long_help(true)</code> causes help alignment issues</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/5915">#5915</a>
        opened by <a href="https://github.com/wmmc88">@wmmc88</a>
        on 2025-02-18 23:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/wmmc88">@wmmc88</a></div>
            <div class="timeline-body">Please complete the following tasks
<ul>
<li>[x] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[x] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
Rust Version
<p>rustc 1.86.0-nightly (854f22563 2025-01-31)</p>
Clap Version
<p>4.5.30</p>
Minimal reproducible code
<pre><code>use clap::Parser;

#[derive(Parser)]
struct Cli {
    #[arg(long)]
    pub test_arg: Option&lt;String&gt;,

    #[arg(long, hide_long_help(true))] // false fixes the issue of newlines
    /// Process all packages in the workspace
    pub all: bool,
}

fn main() {
    Cli::parse();
}
</code></pre>
<p><code>Cargo.toml</code></p>
<pre><code>[dependencies]
clap = { version = &quot;4.5.30&quot;, features = [&quot;derive&quot;] }
</code></pre>
Steps to reproduce the bug with the above code
<p><code>cargo run -- --help</code></p>
Actual Behaviour
<p>The output looks like:</p>
<pre><code>cargo run -- --help
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.05s
     Running `target\debug\bar.exe --help`
Usage: bar.exe [OPTIONS]

Options:
      --test-arg &lt;TEST_ARG&gt;


  -h, --help
          Print help (see a summary with &#x27;-h&#x27;)
</code></pre>
<p>Notice that the help text is on a new line.</p>
Expected Behaviour
<p>When changing <code>hide_long_help</code> to <code>false</code>, the output looks like:</p>
<pre><code>cargo run -- --help
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.06s
     Running `target\debug\bar.exe --help`
Usage: bar.exe [OPTIONS]

Options:
      --test-arg &lt;TEST_ARG&gt;
      --all                  Process all packages in the workspace
  -h, --help                 Print help
</code></pre>
<p>I expect that adding <code>hide_long_help</code> to an arg to not mess up the help text and put all the help text in new lines</p>
Additional Context
<p>I originally ran into this issue while using <code>clap_cargo::Workspace</code> but was able to narrow the issue down to the args that have <code>hide_short_help(true)</code> or <code>hide_long_help(true)</code>.</p>
Debug Output
<pre><code>cargo run -- --help
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.29s
     Running `target\debug\bar.exe --help`
[clap_builder::builder::command]Command::_do_parse
[clap_builder::builder::command]Command::_build: name=&quot;bar&quot;
[clap_builder::builder::command]Command::_propagate:bar
[clap_builder::builder::command]Command::_check_help_and_version:bar expand_help_tree=false
[clap_builder::builder::command]Command::long_help_exists
[clap_builder::builder::command]Command::_check_help_and_version: Building default --help
[clap_builder::builder::command]Command::_propagate_global_args:bar
[clap_builder::builder::debug_asserts]Command::_debug_asserts
[clap_builder::builder::debug_asserts]Arg::_debug_asserts:test_arg
[clap_builder::builder::debug_asserts]Arg::_debug_asserts:all
[clap_builder::builder::debug_asserts]Arg::_debug_asserts:help
[clap_builder::builder::debug_asserts]Command::_verify_positionals
[clap_builder::parser::parser]Parser::get_matches_with
[clap_builder::parser::parser]Parser::parse
[clap_builder::parser::parser]Parser::get_matches_with: Begin parsing &#x27;&quot;--help&quot;&#x27;
[clap_builder::parser::parser]Parser::possible_subcommand: arg=Ok(&quot;--help&quot;)
[clap_builder::parser::parser]Parser::get_matches_with: sc=None
[clap_builder::parser::parser]Parser::parse_long_arg
[clap_builder::parser::parser]Parser::parse_long_arg: Does it contain &#x27;=&#x27;...
[clap_builder::parser::parser]Parser::parse_long_arg: Found valid arg or flag &#x27;--help&#x27;
[clap_builder::parser::parser]Parser::parse_long_arg(&quot;help&quot;): Presence validated
[clap_builder::parser::parser]Parser::react action=Help, identifier=Some(Long), source=CommandLine
[clap_builder::parser::parser]Help: use_long=true
[clap_builder::builder::command]Command::long_help_exists: true
[clap_builder::builder::command]Command::write_help_err: bar, use_long=true
[clap_builder::builder::command]Command::long_help_exists: true
[  clap_builder::output::help]write_help
[clap_builder::output::help_template]HelpTemplate::new cmd=bar, use_long=true
[clap_builder::output::help_template]should_show_arg: use_long=true, arg=test_arg
[clap_builder::output::help_template]HelpTemplate::write_templated_help
[clap_builder::output::help_template]HelpTemplate::write_before_help
[ clap_builder::output::usage]Usage::create_usage_no_title
[ clap_builder::output::usage]Usage::create_usage_no_title
[ clap_builder::output::usage]Usage::write_help_usage
[ clap_builder::output::usage]Usage::write_arg_usage; incl_reqs=true
[ clap_builder::output::usage]Usage::needs_options_tag
[ clap_builder::output::usage]Usage::needs_options_tag:iter: f=test_arg
[clap_builder::builder::command]Command::groups_for_arg: id=&quot;test_arg&quot;
[ clap_builder::output::usage]Usage::needs_options_tag:iter:iter: grp_s=&quot;Cli&quot;
[ clap_builder::output::usage]Usage::needs_options_tag:iter: [OPTIONS] required
[ clap_builder::output::usage]Usage::write_args: incls=[]
[ clap_builder::output::usage]Usage::get_args: unrolled_reqs=[]
[ clap_builder::output::usage]Usage::write_subcommand_usage
[ clap_builder::output::usage]Usage::create_usage_no_title: usage=bar.exe [OPTIONS]
[clap_builder::output::help_template]HelpTemplate::write_all_args
[clap_builder::output::help_template]should_show_arg: use_long=true, arg=test_arg
[clap_builder::output::help_template]should_show_arg: use_long=true, arg=all
[clap_builder::output::help_template]should_show_arg: use_long=true, arg=help
[clap_builder::output::help_template]HelpTemplate::write_args Options
[clap_builder::output::help_template]should_show_arg: use_long=true, arg=test_arg
[clap_builder::output::help_template]HelpTemplate::write_args: arg=&quot;test_arg&quot; longest=21
[clap_builder::output::help_template]should_show_arg: use_long=true, arg=help
[clap_builder::output::help_template]HelpTemplate::write_args: arg=&quot;help&quot; longest=21
[clap_builder::output::help_template]should_show_arg: use_long=true, arg=test_arg
[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--test-arg &lt;TEST_ARG&gt;
[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--test-arg &lt;TEST_ARG&gt;
[clap_builder::output::help_template]HelpTemplate::short
[clap_builder::output::help_template]HelpTemplate::long
[clap_builder::output::help_template]HelpTemplate::align_to_about: arg=test_arg, next_line_help=true, longest=21
[clap_builder::output::help_template]HelpTemplate::align_to_about: printing long help so skip alignment
[clap_builder::output::help_template]HelpTemplate::help
[clap_builder::output::help_template]HelpTemplate::help: Next Line...true
[clap_builder::output::help_template]HelpTemplate::help: help_width=10, spaces=0, avail=90
[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--help
[clap_builder::output::help_template]HelpTemplate::short
[clap_builder::output::help_template]HelpTemplate::long
[clap_builder::output::help_template]HelpTemplate::align_to_about: arg=help, next_line_help=true, longest=21
[clap_builder::output::help_template]HelpTemplate::align_to_about: printing long help so skip alignment
[clap_builder::output::help_template]HelpTemplate::help
[clap_builder::output::help_template]HelpTemplate::help: Next Line...true
[clap_builder::output::help_template]HelpTemplate::help: help_width=10, spaces=36, avail=90
[clap_builder::output::help_template]HelpTemplate::write_after_help
[clap_builder::builder::command]Command::color: Color setting...
[clap_builder::builder::command]Auto
[clap_builder::builder::command]Command::color: Color setting...
[clap_builder::builder::command]Auto
Usage: bar.exe [OPTIONS]

Options:
      --test-arg &lt;TEST_ARG&gt;


  -h, --help
          Print help (see a summary with &#x27;-h&#x27;)
</code></pre>
<p>With <code>hide_long_help(false)</code>:</p>
<pre><code>cargo run -- --help
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.06s
     Running `target\debug\bar.exe --help`
[clap_builder::builder::command]Command::_do_parse
[clap_builder::builder::command]Command::_build: name=&quot;bar&quot;
[clap_builder::builder::command]Command::_propagate:bar
[clap_builder::builder::command]Command::_check_help_and_version:bar expand_help_tree=false
[clap_builder::builder::command]Command::long_help_exists
[clap_builder::builder::command]Command::_check_help_and_version: Building default --help
[clap_builder::builder::command]Command::_propagate_global_args:bar
[clap_builder::builder::debug_asserts]Command::_debug_asserts
[clap_builder::builder::debug_asserts]Arg::_debug_asserts:test_arg
[clap_builder::builder::debug_asserts]Arg::_debug_asserts:all
[clap_builder::builder::debug_asserts]Arg::_debug_asserts:help
[clap_builder::builder::debug_asserts]Command::_verify_positionals
[clap_builder::parser::parser]Parser::get_matches_with
[clap_builder::parser::parser]Parser::parse
[clap_builder::parser::parser]Parser::get_matches_with: Begin parsing &#x27;&quot;--help&quot;&#x27;
[clap_builder::parser::parser]Parser::possible_subcommand: arg=Ok(&quot;--help&quot;)
[clap_builder::parser::parser]Parser::get_matches_with: sc=None
[clap_builder::parser::parser]Parser::parse_long_arg
[clap_builder::parser::parser]Parser::parse_long_arg: Does it contain &#x27;=&#x27;...
[clap_builder::parser::parser]Parser::parse_long_arg: Found valid arg or flag &#x27;--help&#x27;
[clap_builder::parser::parser]Parser::parse_long_arg(&quot;help&quot;): Presence validated
[clap_builder::parser::parser]Parser::react action=Help, identifier=Some(Long), source=CommandLine
[clap_builder::parser::parser]Help: use_long=true
[clap_builder::builder::command]Command::long_help_exists: false
[clap_builder::builder::command]Command::write_help_err: bar, use_long=false
[clap_builder::builder::command]Command::long_help_exists: false
[  clap_builder::output::help]write_help
[clap_builder::output::help_template]HelpTemplate::new cmd=bar, use_long=false
[clap_builder::output::help_template]should_show_arg: use_long=false, arg=test_arg
[clap_builder::output::help_template]HelpTemplate::write_templated_help
[clap_builder::output::help_template]HelpTemplate::write_before_help
[ clap_builder::output::usage]Usage::create_usage_no_title
[ clap_builder::output::usage]Usage::create_usage_no_title
[ clap_builder::output::usage]Usage::write_help_usage
[ clap_builder::output::usage]Usage::write_arg_usage; incl_reqs=true
[ clap_builder::output::usage]Usage::needs_options_tag
[ clap_builder::output::usage]Usage::needs_options_tag:iter: f=test_arg
[clap_builder::builder::command]Command::groups_for_arg: id=&quot;test_arg&quot;
[ clap_builder::output::usage]Usage::needs_options_tag:iter:iter: grp_s=&quot;Cli&quot;
[ clap_builder::output::usage]Usage::needs_options_tag:iter: [OPTIONS] required
[ clap_builder::output::usage]Usage::write_args: incls=[]
[ clap_builder::output::usage]Usage::get_args: unrolled_reqs=[]
[ clap_builder::output::usage]Usage::write_subcommand_usage
[ clap_builder::output::usage]Usage::create_usage_no_title: usage=bar.exe [OPTIONS]
[clap_builder::output::help_template]HelpTemplate::write_all_args
[clap_builder::output::help_template]should_show_arg: use_long=false, arg=test_arg
[clap_builder::output::help_template]should_show_arg: use_long=false, arg=all
[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help
[clap_builder::output::help_template]HelpTemplate::write_args Options
[clap_builder::output::help_template]should_show_arg: use_long=false, arg=test_arg
[clap_builder::output::help_template]HelpTemplate::write_args: arg=&quot;test_arg&quot; longest=21
[clap_builder::output::help_template]should_show_arg: use_long=false, arg=all
[clap_builder::output::help_template]HelpTemplate::write_args: arg=&quot;all&quot; longest=21
[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help
[clap_builder::output::help_template]HelpTemplate::write_args: arg=&quot;help&quot; longest=21
[clap_builder::output::help_template]should_show_arg: use_long=false, arg=test_arg
[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--test-arg &lt;TEST_ARG&gt;
[clap_builder::output::help_template]should_show_arg: use_long=false, arg=all
[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--all
[clap_builder::output::help_template]should_show_arg: use_long=false, arg=help
[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--help
[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--test-arg &lt;TEST_ARG&gt;
[clap_builder::output::help_template]HelpTemplate::short
[clap_builder::output::help_template]HelpTemplate::long
[clap_builder::output::help_template]HelpTemplate::align_to_about: arg=test_arg, next_line_help=false, longest=21
[clap_builder::output::help_template]HelpTemplate::align_to_about: positional=false arg_len=21, spaces=2
[clap_builder::output::help_template]HelpTemplate::help
[clap_builder::output::help_template]HelpTemplate::help: help_width=29, spaces=0, avail=71
[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--all
[clap_builder::output::help_template]HelpTemplate::short
[clap_builder::output::help_template]HelpTemplate::long
[clap_builder::output::help_template]HelpTemplate::align_to_about: arg=all, next_line_help=false, longest=21
[clap_builder::output::help_template]HelpTemplate::align_to_about: positional=false arg_len=5, spaces=18
[clap_builder::output::help_template]HelpTemplate::help
[clap_builder::output::help_template]HelpTemplate::help: help_width=29, spaces=37, avail=71
[clap_builder::output::help_template]HelpTemplate::spec_vals: a=--help
[clap_builder::output::help_template]HelpTemplate::short
[clap_builder::output::help_template]HelpTemplate::long
[clap_builder::output::help_template]HelpTemplate::align_to_about: arg=help, next_line_help=false, longest=21
[clap_builder::output::help_template]HelpTemplate::align_to_about: positional=false arg_len=6, spaces=17
[clap_builder::output::help_template]HelpTemplate::help
[clap_builder::output::help_template]HelpTemplate::help: help_width=29, spaces=10, avail=71
[clap_builder::output::help_template]HelpTemplate::write_after_help
[clap_builder::builder::command]Command::color: Color setting...
[clap_builder::builder::command]Auto
[clap_builder::builder::command]Command::color: Color setting...
[clap_builder::builder::command]Auto
Usage: bar.exe [OPTIONS]

Options:
      --test-arg &lt;TEST_ARG&gt;
      --all                  Process all packages in the workspace
  -h, --help                 Print help
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by <a href="https://github.com/wmmc88">@wmmc88</a> on 2025-02-18 23:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;hide_long_help(true) causes help alignment issues&quot; to &quot;`hide_long_help(true)` causes help alignment issues&quot; by <a href="https://github.com/wmmc88">@wmmc88</a> on 2025-02-18 23:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-02-19 14:10</div>
            <div class="timeline-body"><p>This isn&#x27;t help alignment issue but that &quot;next line help&quot; is automatically used for long help (<code>--help</code>).  If you ran short help (<code>-h</code>) you wouldn&#x27;t see this.</p>
<p>The logic we use to determine whether long help is present:
https://github.com/clap-rs/clap/blob/ac93ac6fa90be18106e31074e25968fe4d4f1967/clap_builder/src/builder/command.rs#L5066-L5089</p>
<p>I believe the intention here is that if you say you only want to hide something in the long help, then that makes the long help different than the short help and so the user intends for it to be shown separately.  The long help then always uses next-line help.</p>
<blockquote>
<p>I originally ran into this issue while using clap_cargo::Workspace but was able to narrow the issue down to the args that have hide_short_help(true) or hide_long_help(true).</p>
</blockquote>
<p><code>clap_cargo</code> should instead be using <code>hide = true</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>crate-ci/clap-cargo#83</a> on 2025-02-19 14:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wmmc88">@wmmc88</a> on 2025-02-19 15:04</div>
            <div class="timeline-body"><p>I&#x27;m not sure I understand why if a single arg disables long or short help, all other args long help uses &quot;next line help&quot;. Based on the logic, even when short help is hidden for a single arg, it causes all the args long help to be on newlines..</p>
<p>But thanks for the clap_cargo fix!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-02-19 15:25</div>
            <div class="timeline-body"><p>Long help assumes there will be multi-paragraph descriptions for the command and arguments.  It therefore always uses next-line-help to make this more readable.  Whether to do that or not or allow it to be overriden is separate from this.  As the long help detection is working as expected and clap-cargo is fixed, I&#x27;m going to go ahead and close this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/epage">@epage</a> on 2025-02-19 15:25</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 20:00:26 UTC
    </footer>
</body>
</html>
