<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Improve error message when subcommand is supplied after -- - clap-rs/clap #1744</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Improve error message when subcommand is supplied after --</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1744">#1744</a>
        opened by <a href="https://github.com/seppo0010">@seppo0010</a>
        on 2020-03-13 14:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/seppo0010">@seppo0010</a></div>
            <div class="timeline-body"><!--
Please use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`
-->

<h3>Rust Version</h3>
<pre><code>$ rustc -V
rustc 1.41.0 (5e1a79984 2020-01-27)
</code></pre>
<h3>Code</h3>
<p>The code comes directly from the readme</p>
<pre><code class="language-rust">// (Full example with detailed comments in examples/01a_quick_example.rs)
//
// This example demonstrates clap's &quot;builder pattern&quot; method of creating arguments
// which the most flexible, but also most verbose.
extern crate clap;
use clap::{Arg, App, SubCommand};

fn main() {
    let matches = App::new(&quot;My Super Program&quot;)
                          .version(&quot;1.0&quot;)
                          .author(&quot;Kevin K. &lt;kbknapp@gmail.com&gt;&quot;)
                          .about(&quot;Does awesome things&quot;)
                          .arg(Arg::with_name(&quot;config&quot;)
                               .short('c')
                               .long(&quot;config&quot;)
                               .value_name(&quot;FILE&quot;)
                               .help(&quot;Sets a custom config file&quot;)
                               .takes_value(true))
                          .arg(Arg::with_name(&quot;INPUT&quot;)
                               .help(&quot;Sets the input file to use&quot;)
                               .required(true)
                               .index(1))
                          .arg(Arg::with_name(&quot;v&quot;)
                               .short('v')
                               .multiple(true)
                               .help(&quot;Sets the level of verbosity&quot;))
                          .subcommand(SubCommand::with_name(&quot;test&quot;)
                                      .about(&quot;controls testing features&quot;)
                                      .version(&quot;1.3&quot;)
                                      .author(&quot;Someone E. &lt;someone_else@other.com&gt;&quot;)
                                      .arg(Arg::with_name(&quot;debug&quot;)
                                          .short('d')
                                          .help(&quot;print debug information verbosely&quot;)))
                          .get_matches();

    // Same as above examples...
}
</code></pre>
<h3>Steps to reproduce the issue</h3>
<pre><code>$ cargo build
(...)
$ ./target/debug/clap-test input test
Value for config: default.conf
Using input file: input
No verbose info
Printing normally...
$ ./target/debug/clap-test input -- test
error: The subcommand 'test' wasn't recognized
	Did you mean 'test'?

If you believe you received this message in error, try re-running with 'clap-test -- test'

USAGE:
    clap-test [FLAGS] [OPTIONS] &lt;INPUT&gt; [SUBCOMMAND]

For more information try --help
</code></pre>
<h3>Affected Version of <code>clap*</code></h3>
<p>2.33.0</p>
<h3>Actual Behavior Summary</h3>
<p>When using <code>--</code> the subcommand is not rightly executed, but the error message does show it as &quot;did you mean&quot; producing a confusing statement.</p>
<h3>Expected Behavior Summary</h3>
<p>In this example <code>--</code>  should be ignored and the subcommand should be executed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @seppo0010 on 2020-03-13 14:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-03-13 15:53</div>
            <div class="timeline-body"><p>I would say that subcommand <strong>must</strong> go before the <code>--</code>. Everything after the <code>--</code> is considered &quot;raw&quot; arguments in a sense they are <em>values</em> but not <em>options</em> (<code>--foo</code>) or <em>subcommands</em>.</p>
<p>The &quot;did you mean&quot; part is fixed in <code>master</code>, courtesy of https://github.com/clap-rs/clap/pull/1727, so run it with the latest master and you'll see</p>
<pre><code>$ cargo run -- input -- test
    Finished dev [unoptimized + debuginfo] target(s) in 0.12s
     Running `target\debug\probe.exe input -- test`
error: Found argument 'test' which wasn't expected, or isn't valid in this context
If you tried to supply `test` as a PATTERN use `-- test`

USAGE:
    probe.exe [OPTIONS] &lt;INPUT&gt; [SUBCOMMAND]

For more information try --help
error: process didn't exit successfully: `target\debug\probe.exe input -- test` (exit code: 2)
</code></pre>
<p>A few thoughts:</p>
<ul>
<li>We need to get rid of <code>If you tried to supply 'test' as a PATTERN use '-- test'</code>. It's not helpful, and I don't really know what it means.</li>
<li>We need to check the erroneous arg (the <code>test</code>) against known set of subcommands and show a helpful suggestion:<pre><code>$ cargo run -- input -- test
  Finished dev [unoptimized + debuginfo] target(s) in 0.12s
   Running `target\debug\probe.exe input -- test`
error: Found argument 'test' which wasn't expected, or isn't valid in this context

Hint: there is the 'test' subcommand, but subcommands must go before the '--'. Try 'probe.exe test input'

USAGE:
  probe.exe [OPTIONS] &lt;INPUT&gt; [SUBCOMMAND]

For more information try --help
error: process didn't exit successfully: `target\debug\probe.exe input -- test` (exit code: 2)
</code></pre>
</li>
</ul>
<pre><code></code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> removed by @CreepySkeleton on 2020-03-13 15:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: errors</span> added by @CreepySkeleton on 2020-03-13 15:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> added by @CreepySkeleton on 2020-03-13 15:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: enhancement</span> added by @CreepySkeleton on 2020-03-13 15:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by @CreepySkeleton on 2020-03-13 15:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @CreepySkeleton on 2020-03-13 15:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Double hyphen confusing clap " to "Improve error message when subcommand is suppied after --" by @CreepySkeleton on 2020-03-13 15:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Improve error message when subcommand is suppied after --" to "Improve error message when subcommand is supplied after --" by @CreepySkeleton on 2020-03-13 15:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../denoland/deno/issues/6790.html">denoland/deno#6790</a> on 2020-07-18 13:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1943.html">clap-rs/clap#1943</a> on 2020-10-06 01:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2154.html">clap-rs/clap#2154</a> on 2020-10-06 12:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2157.html">clap-rs/clap#2157</a> on 2020-10-08 02:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @bors[bot] on 2020-10-09 17:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ghosty141">@ghosty141</a> on 2021-01-01 19:03</div>
            <div class="timeline-body"><blockquote>
<pre><code>* We need to get rid of `If you tried to supply 'test' as a PATTERN use '-- test'`. It's not helpful, and I don't really know what it means.</code></pre>
</blockquote>
<p>@CreepySkeleton Is there any way to opt out of this currently? I really dislike the way that clap outputs quite a lot of text if I just give it a wrong argument.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-01-02 02:11</div>
            <div class="timeline-body"><p>Not right now but it is in the long term future plan to reduce the binary size.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:47:33 UTC
    </footer>
</body>
</html>
