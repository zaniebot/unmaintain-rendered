<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regression in 3.x: trailing commas do not mix well with arg_enum! - clap-rs/clap #1800</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Regression in 3.x: trailing commas do not mix well with arg_enum!</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1800">#1800</a>
        opened by <a href="https://github.com/lf-">@lf-</a>
        on 2020-04-09 09:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lf-">@lf-</a></div>
            <div class="timeline-body"><!--
Please use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`
-->

<p>Hi! It looks like #1244 got lost in the move to v3.x. Based on my poking at the git log, it seems like it just never made it into the history of <code>master</code>. #1097 also. Below is a bug report for the bug itself:</p>
<h3>Rust Version</h3>
<p><code>rustc 1.44.0-nightly (485c5fb6e 2020-04-08)</code></p>
<h3>Code</h3>
<pre><code class="language-rust">use clap::arg_enum;

arg_enum! {
enum Meow {
    Raw,
    Quoted,
}
}
</code></pre>
<h3>Steps to reproduce the issue</h3>
<ol>
<li><code>cargo new</code>; add the dependency to <code>Cargo.toml</code></li>
<li>paste the above into the top of <code>src/main.rs</code></li>
<li><code>cargo build</code></li>
</ol>
<h3>Affected Version of <code>clap*</code></h3>
<p><code>3.0.0-beta.1</code> (I have <code>clap = { git = &quot;https://github.com/clap-rs/clap/&quot; }</code> in my Cargo.toml)</p>
<h3>Actual Behavior Summary</h3>
<pre><code>error: no rules expected the token `:`
   --&gt; C:\Users\lf\.cargo\git\checkouts\clap-78dbe9b58f9073fe\89a4764\src\macros.rs:401:34
    |
317 | / macro_rules! arg_enum {
318 | |     (@as_item $($i:item)*) =&gt; ($($i)*);
319 | |     (@impls ( $($tts:tt)* ) -&gt; ($e:ident, $($v:ident),+)) =&gt; {
320 | |         $crate::arg_enum!(@as_item
...   |
401 | |         $crate::arg_enum!(enum $e:ident {
    | |                                  ^ no rules expected this token in macro call
...   |
411 | |     };
412 | | }
    | |_- in this expansion of `arg_enum!`
    | 
   ::: src\main.rs:21:1
    |
21  | / arg_enum! {
22  | | enum Meow {
23  | |     Raw,
24  | |     Quoted,
25  | | }
26  | | }
    | |_- in this macro invocation
</code></pre>
<h3>Expected Behavior Summary</h3>
<p>I'd like it to compile because trailing commas are nice :)</p>
<h3>Additional context</h3>
<p>N/A.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @lf- on 2020-04-09 09:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @pksunkara on 2020-04-09 10:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-09 10:09</div>
            <div class="timeline-body"><p>Would appreciate if you can make a PR cherry picking those commits.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-09 23:15</div>
            <div class="timeline-body"><p>#1124 which is fix for #1067 is in v3.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lf-">@lf-</a> on 2020-04-09 23:19</div>
            <div class="timeline-body"><p>That's super strange since I tried the above steps which are mentioned in the readme as how to install the latest development version and it definitely isn't doing trailing commas. That commit <em>is</em> in master_orig but I assume there was some restructuring since then that could have excluded it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-09 23:34</div>
            <div class="timeline-body"><p>No, I meant, I checked the code and that code is in v3.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/1802.html">clap-rs/clap#1802</a> on 2020-04-09 23:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @bors[bot] on 2020-04-10 08:41</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:47:36 UTC
    </footer>
</body>
</html>
