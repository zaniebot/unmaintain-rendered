<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`env` method not found in `Arg` - clap-rs/clap #6007</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`env` method not found in `Arg`</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/6007">#6007</a>
        opened by <a href="https://github.com/pronebird">@pronebird</a>
        on 2025-05-19 07:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/pronebird">@pronebird</a> on 2025-05-19 07:52</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[x] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[x] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.88.0-nightly (a15cce269 2025-04-17)</p>
<h3>Clap Version</h3>
<p>4</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">use clap::Args;

#[derive(Debug, Clone, Args)]
pub struct Command {
    #[arg(long, default_value_t, env = &quot;PLAY_BALL&quot;, action = clap::ArgAction::SetTrue)]
    pub play_ball: bool,
}
</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<p>Compile it</p>
<h3>Actual Behaviour</h3>
<p>Fails to compile with <code>env` method not found in `Arg</code></p>
<p>However <code>env()</code> is documented to exist on <code>Arg</code> as per https://docs.rs/clap/latest/clap/struct.Arg.html#method.env</p>
<h3>Expected Behaviour</h3>
<p>That the code compiles</p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
<h3>Debug Output</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @pronebird on 2025-05-19 07:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pi55man">@pi55man</a> on 2025-05-19 20:55</div>
            <div class="timeline-body"><p>the env method is behind a feature flag, you have to include the &quot;env&quot; feature in your cargo.toml</p>
<p><code>clap = {version = &quot;4&quot;, features = [&quot;derive&quot;, &quot;env&quot; ]}</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pronebird">@pronebird</a> on 2025-05-19 20:57</div>
            <div class="timeline-body"><p>@pi55man thanks. üôè Perhaps we need to document it because it's not very obvious from documentation?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-05-19 21:03</div>
            <div class="timeline-body"><p>The compiler should have given a message about <code>features = &quot;env&quot;</code>.  Do you have the full compiler output?</p>
<p>Also, the docs should also mention it but they aren't and I'm not seeing why.  I'll have to dig into that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pi55man">@pi55man</a> on 2025-05-19 21:13</div>
            <div class="timeline-body"><p>here's the compiler output:</p>
<blockquote>
<p>error[E0599]: no method named <code>env</code> found for struct <code>Arg</code> in the current scope
--&gt; src/main.rs:5:33
|
5 |     #[arg(long, default_value_t,env= &quot;PLAY_BALL&quot;, action = clap::ArgAction::SetTrue)]
|                                 ^^^ method not found in <code>Arg</code></p>
<p>For more information about this error, try <code>rustc --explain E0599</code>.
error: could not compile <code>foo</code> (bin &quot;foo&quot;) due to 2 previous errors</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-05-20 17:31</div>
            <div class="timeline-body"><p>For the docs:</p>
<ul>
<li><a href="https://docs.rs/clap/4.5.34/clap/struct.Arg.html#method.env">4.5.34</a> (2025-03-27): worked</li>
<li><a href="https://docs.rs/clap/4.5.35/clap/struct.Arg.html#method.env">4.5.35</a> (2025-04-01): didn't worked</li>
</ul>
<p>Not seeing anything relevant from the <a href="https://diff.rs/clap/4.5.34/4.5.35/Cargo.toml">diff</a></p>
<p>Looking at <a href="https://docs.rs/clap_builder/4.5.38/clap_builder/builder/struct.Arg.html#method.env">clap_builder</a>, it still works.  This seems to be a bug with re-exports.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-05-20 17:39</div>
            <div class="timeline-body"><p>For the docs, I opened rust-lang/rust#141301</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-05-20 18:46</div>
            <div class="timeline-body"><p>As for the compiler error, apparently its only for top-level items and not functions in <code>impl</code> blocks?</p>
<pre><code class="language-console">‚ùØ cargo check
    Checking dep v0.1.0 (/home/epage/src/personal/dump/clap-6007/dep)
    Checking clap-6007 v0.1.0 (/home/epage/src/personal/dump/clap-6007)
error[E0425]: cannot find function `foo_feature` in crate `dep`
 --&gt; src/main.rs:6:10
  |
6 |     dep::foo_feature();
  |          ^^^^^^^^^^^ help: a function with a similar name exists: `no_feature`
  |
 ::: /home/epage/src/personal/dump/clap-6007/dep/src/lib.rs:4:1
  |
4 | pub fn no_feature() {}
  | ------------------- similarly named function `no_feature` defined here
  |
note: found an item that was configured out
 --&gt; /home/epage/src/personal/dump/clap-6007/dep/src/lib.rs:2:8
  |
2 | pub fn foo_feature() {}
  |        ^^^^^^^^^^^
note: the item is gated behind the `foo` feature
 --&gt; /home/epage/src/personal/dump/clap-6007/dep/src/lib.rs:1:7
  |
1 | #[cfg(feature = &quot;foo&quot;)]
  |       ^^^^^^^^^^^^^^^

warning: unused import: `clap_builder as clap`
 --&gt; src/main.rs:1:5
  |
1 | use clap_builder as clap;
  |     ^^^^^^^^^^^^^^^^^^^^
  |
  = note: `#[warn(unused_imports)]` on by default

error[E0599]: no function or associated item named `foo_feature` found for struct `dep::Arg` in the current scope
 --&gt; src/main.rs:8:15
  |
8 |     dep::Arg::foo_feature();
  |               ^^^^^^^^^^^ function or associated item not found in `dep::Arg`
  |
note: if you're trying to build a new `dep::Arg`, consider using `dep::Arg::new` which returns `dep::Arg`
 --&gt; /home/epage/src/personal/dump/clap-6007/dep/src/lib.rs:9:5
  |
9 |     pub fn new() -&gt; Self {
  |     ^^^^^^^^^^^^^^^^^^^^
help: there is an associated function `no_feature` with a similar name
  |
8 -     dep::Arg::foo_feature();
8 +     dep::Arg::no_feature();
  |

Some errors have detailed explanations: E0425, E0599.
For more information about an error, try `rustc --explain E0425`.
warning: `clap-6007` (bin &quot;clap-6007&quot;) generated 1 warning
error: could not compile `clap-6007` (bin &quot;clap-6007&quot;) due to 2 previous errors; 1 warning emitted
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-05-20 18:49</div>
            <div class="timeline-body"><p>Looks like the compiler diagnostics are being tracked in rust-lang/rust#130319.</p>
<p>Looks like there is nothing more we can do so I'm going to close this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2025-05-20 18:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:35:46 UTC
    </footer>
</body>
</html>
