<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Using `clap(global = true)` with clap_derive - clap-rs/clap #2471</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Using <code>clap(global = true)</code> with clap_derive</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/2471">#2471</a>
        opened by <a href="https://github.com/kbknapp">@kbknapp</a>
        on 2021-05-07 17:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kbknapp">@kbknapp</a></div>
            <div class="timeline-body">Please complete the following tasks
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
Clap Version
<p>3.0.0-beta.2</p>
Where?
<p>clap_derive docs/examples</p>
What&#x27;s wrong?
<p>Using <code>clap(global = true)</code> has some oddities that should be documented better. Because if the child subcommand has no field defined for that parent&#x27;s global argument, no warnings or errors are emitted. Additionally, if you <em>do</em> define the field in the child command, there is no need to add all the additional clap metadata, that&#x27;s only required on the parent.</p>
Example
<pre><code>#[derive(Clap)]
struct Args {
    /// Some value
    #[clap(short, long, global = true)]
    value: String,
    #[clap(subcommand)]
    cmd: Cmd,
}

#[derive(Subcommand)]
enum Cmd {
    Foo(FooArgs),
}

#[derive(Clap)]
struct FooArgs { }
</code></pre>
<p>This compiles with no warnings/errors.</p>
<p>Now, obviously if I were to try to use a non-existent field <code>value</code> of <code>FooArgs</code>, Rust will not compile. Perhaps the user expected some macro magic would make that work? Regardless, the user could then copy/paste the whole field into the <code>FooArgs</code> struct, metadata and all:</p>
<pre><code>#[derive(Clap)]
struct FooArgs {
    /// Some value
    #[clap(short, long, global = true)]
    value: String,
}
</code></pre>
<p>However, that&#x27;s not necessary, and could actually lead to errors/confusion. All that is required is to add the field itself:</p>
<pre><code>#[derive(Clap)]
struct FooArgs {
    value: String,
}
</code></pre>
<p>The help message will be correct (as defined by the parent command), and clap will parse <code>args foo --value bar</code> correctly.</p>
<p>It&#x27;s a minor docs issue, but one that can be confusing.</p>
How to fix?
<p>Put an example in the <code>examples/</code> dir, or call this out during the <code>Arg::global</code> docs. I believe all that&#x27;s required to mention is that the target struct simply needs the field defined without all the clap metadata.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: docs</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2021-05-07 17:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2021-05-07 17:51</div>
            <div class="timeline-body"><p>Actually I&#x27;m going to close this, as what I said isn&#x27;t exactly correct. The sentiment is correct (we need better docs on the subject), but I&#x27;d say it&#x27;s a low enough priority that it&#x27;s not worth the open issue at the moment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/kbknapp">@kbknapp</a> on 2021-05-07 17:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-05-08 08:38</div>
            <div class="timeline-body"><p>#2026 should solve the issue.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:58:06 UTC
    </footer>
</body>
</html>
