<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>When setting `value_name`, argument parsing fails - clap-rs/clap #2632</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>When setting <code>value_name</code>, argument parsing fails</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/2632">#2632</a>
        opened by <a href="https://github.com/epage">@epage</a>
        on 2021-07-28 14:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a></div>
            <div class="timeline-body">Please complete the following tasks
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
Rust Version
<p>rustc 1.53.0 (53cb7b09b 2021-06-17)</p>
Clap Version
<p>5fbd764</p>
Minimal reproducible code
<pre><code>#[clap(
    number_of_values = 1,
    long = &quot;using&quot;,
    value_name = &quot;pm&quot;
)]
using: Option&lt;String&gt;,
</code></pre>
Steps to reproduce the bug with the above code
<p>Pass arguments as expected</p>
Actual Behaviour
<p>Error when parsing:</p>
<pre><code>error: The argument &#x27;--using &lt;USING&gt; &lt;pm&gt;&#x27; requires 2 values, but 1 was provided
</code></pre>
<p>and help:</p>
<pre><code>OPTIONS:
        --using &lt;USING&gt; &lt;pm&gt;    Specify the package manager to be invoked
</code></pre>
Expected Behaviour
<pre><code>OPTIONS:
        --using &lt;pm&gt;... Specify the package manager to be invoked
</code></pre>
Additional Context
<p><em>No response</em></p>
Debug Output
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by <a href="https://github.com/epage">@epage</a> on 2021-07-28 14:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;3.0&quot; by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-07-28 14:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: derive macros</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-07-28 14:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-07-28 14:03</div>
            <div class="timeline-body"><p>@rami3l created this to split the conversation out</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-07-28 14:04</div>
            <div class="timeline-body"><p>Oh, weird, <code>value_name</code> <strong>appends</strong></p>
<p>This isn&#x27;t documented</p>
<blockquote>
<p>Specifies the name for value of option or positional arguments inside of help documentation. This name is cosmetic only, the name is not used to access arguments. This setting can be very helpful when describing the type of input the user should be using, such as FILE, INTERFACE, etc. Although not required, it&#x27;s somewhat convention to use all capital letters for the value name.</p>
</blockquote>
<p>Two possible fixes:</p>
<ul>
<li>No longer append in <code>value_name</code></li>
<li>Check for <code>value_name</code> among the attributes and skip doing it if its there</li>
</ul>
<p>@pksunkara any thoughts on changing <code>value_name</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-07-28 14:05</div>
            <div class="timeline-body"><p>I think <code>value_name</code> is supposed to append because for an argument that takes multiple values people requested multiple value names.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-07-28 14:07</div>
            <div class="timeline-body"><p>Thats what <code>value_names</code> is for</p>
<blockquote>
<p>Specify multiple names for values of option arguments.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-07-28 14:08</div>
            <div class="timeline-body"><p>Interesting, the help also says</p>
<blockquote>
<p>These names are cosmetic only, used for help and usage strings only</p>
</blockquote>
<p>and yet @rami3l ran into parsing errors when setting this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-07-28 14:09</div>
            <div class="timeline-body"><pre><code>        if !(self.index.is_some() || (self.short.is_none() &amp;&amp; self.long.is_none()))
            &amp;&amp; self.is_set(ArgSettings::TakesValue)
            &amp;&amp; self.val_names.len() &gt; 1
        {
            self.num_vals = Some(self.val_names.len());
        }
</code></pre>
<p>It seems sane that we do this, just the help is a little misleading.</p>
<p>I&#x27;m unsure what <code>!(self.index.is_some() || (self.short.is_none() &amp;&amp; self.long.is_none()))</code> is meant to protect against though</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#2633</a> on 2021-07-28 14:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#2634</a> on 2021-07-28 14:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-07-30 09:40</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:58:12 UTC
    </footer>
</body>
</html>
