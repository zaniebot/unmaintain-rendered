<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>False positive: conflict with unused argument if in required group - clap-rs/clap #1230</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>False positive: conflict with unused argument if in required group</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1230">#1230</a>
        opened by <a href="https://github.com/ghost">@ghost</a>
        on 2018-03-25 02:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ghost">@ghost</a> on 2018-03-25 02:05</div>
            <div class="timeline-body"><h3>Rust Version</h3>
<pre><code>rustc 1.26.0-nightly (f5631d9ac 2018-03-24)
</code></pre>
<h3>Affected Version of clap</h3>
<pre><code>&quot;checksum clap 2.31.2 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;f0f16b89cbb9ee36d87483dc939fe9f1e13c05898d56d7b230a0d4dff033a536&quot;
</code></pre>
<h3>Expected Behavior Summary</h3>
<p>There is one requred group.
The requirement is fulfilled with <code>&quot;-a&quot;</code>.</p>
<p>Only one of <code>&quot;arg&quot;</code> and <code>&quot;unused&quot;</code> is specified.
I expected no conflict.</p>
<p><code>ArgGroup::required</code></p>
<blockquote>
<p>A required ArgGroup simply states that one argument from this group must be present at runtime (unless conflicting with another argument).</p>
</blockquote>
<p>and <code>Arg::conflicts_with</code></p>
<blockquote>
<p>Sets a conflicting argument by name. I.e. when using this argument, the following argument can't be present and vice versa.</p>
</blockquote>
<h3>Actual Behavior Summary</h3>
<p>Arguments get parsed without error.
Interestingly, if the group is not required, there is no error.</p>
<h3>Steps to Reproduce the issue</h3>
<p>Enter code below.</p>
<h3>Sample Code or Link to Sample Code</h3>
<pre><code class="language-rust">extern crate clap;
use clap::{App, Arg, ArgGroup};

fn main() {
    let matches = App::new(&quot;name&quot;)
        .group(ArgGroup::with_name(&quot;group&quot;)
            .required(true) // no error iff false
            .arg(&quot;arg&quot;)
            .arg(&quot;unused&quot;)
        )
        .arg(Arg::with_name(&quot;arg&quot;)
            .short(&quot;a&quot;)
            .conflicts_with(&quot;unused&quot;))
        .arg(Arg::with_name(&quot;unused&quot;))
        .get_matches_from(vec![
            &quot;-a&quot;,
        ]);
    println!(&quot;{:?}&quot;, matches);
}
</code></pre>
<h3>Debug output</h3>
<pre><code>DEBUG:clap:Parser::propagate_settings: self=name, g_settings=AppFlags(
    (empty)
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:ArgMatcher::process_arg_overrides:None;
DEBUG:clap:Parser::remove_overrides:[];
DEBUG:clap:Validator::validate;
DEBUG:clap:Parser::add_defaults;
DEBUG:clap:Parser::add_defaults:iter:unused: doesn't have conditional defaults
DEBUG:clap:Parser::add_defaults:iter:unused: doesn't have default vals
DEBUG:clap:Validator::validate_blacklist;
DEBUG:clap:Validator::validate_required: required=[&quot;group&quot;];
DEBUG:clap:Validator::validate_required:iter:group:
DEBUG:clap:Validator::missing_required_error: extra=None
DEBUG:clap:Parser::color;
DEBUG:clap:Parser::color: Color setting...Auto
DEBUG:clap:is_a_tty: stderr=true
DEBUG:clap:Validator::missing_required_error: reqs=[
    &quot;group&quot;
]
DEBUG:clap:usage::get_required_usage_from: reqs=[&quot;group&quot;], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=[&quot;group&quot;]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[&quot;arg&quot;, &quot;unused&quot;]
DEBUG:clap:Colorizer::error;
DEBUG:clap:Validator::missing_required_error: req_args=&quot;\n    \u{1b}[1;31m&lt;-a|unused&gt;\u{1b}[0m&quot;
DEBUG:clap:usage::create_usage_with_title;
DEBUG:clap:usage::create_usage_no_title;
DEBUG:clap:usage::get_required_usage_from: reqs=[&quot;group&quot;], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=[&quot;group&quot;]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[&quot;arg&quot;, &quot;unused&quot;]
DEBUG:clap:usage::needs_flags_tag;
DEBUG:clap:usage::needs_flags_tag:iter: f=arg;
DEBUG:clap:Parser::groups_for_arg: name=arg
DEBUG:clap:Parser::groups_for_arg: Searching through groups...
        Found 'group'
DEBUG:clap:usage::needs_flags_tag:iter:iter: grp_s=group;
DEBUG:clap:usage::needs_flags_tag:iter:iter: Group is required
DEBUG:clap:usage::needs_flags_tag:iter: f=hclap_help;
DEBUG:clap:usage::needs_flags_tag:iter: f=vclap_version;
DEBUG:clap:usage::needs_flags_tag: [FLAGS] not required
DEBUG:clap:usage::get_args_tag;
DEBUG:clap:usage::get_args_tag:iter:unused:
DEBUG:clap:Parser::groups_for_arg: name=unused
DEBUG:clap:Parser::groups_for_arg: Searching through groups...
        Found 'group'
DEBUG:clap:usage::get_args_tag:iter:unused:iter:group;
DEBUG:clap:usage::create_help_usage: usage=-a &lt;-a|unused&gt;
DEBUG:clap:Parser::color;
DEBUG:clap:Parser::color: Color setting...Auto
DEBUG:clap:is_a_tty: stderr=true
DEBUG:clap:Colorizer::error;
DEBUG:clap:Colorizer::good;
error: The following required arguments were not provided:
    &lt;-a|unused&gt;

USAGE:
    -a &lt;-a|unused&gt;

For more information try --help
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @kbknapp on 2018-03-25 02:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> added by @kbknapp on 2018-03-25 02:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: intermediate</span> added by @kbknapp on 2018-03-25 02:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @kbknapp on 2018-03-25 02:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: arg groups</span> added by @kbknapp on 2018-03-25 02:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-03-25 02:49</div>
            <div class="timeline-body"><p>Thanks for reporting, I should be able to check into this and get a fix out tomorrow.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @pksunkara on 2020-04-09 07:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> removed by @pksunkara on 2020-04-09 07:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-04-21 11:14</div>
            <div class="timeline-body"><p>@jrakow It's been a long tomorrow, but, as all things do, it has come to an end.</p>
<p>Turns out, in the end, it was you who made a mistake: <code>get_matches_from</code> expects the name of the binary to be passed as the first argument, as <code>std::env::args()</code> does. In other words, your reproducer should have been <code>get_matches_from(&quot;app&quot;, &quot;-a&quot;)</code>. And let me inform you: it works rather fine. Everything is working as expected, both in <code>master</code> and <code>2.33</code>.</p>
<p>For the record: I'd been hunting this ghost for almost an hour until a gave up and finally paid extra attention to the reproducer. Remember, maintainers: <strong>make sure the reproducer is correct first</strong>, otherwise you are liable to start spitting acid at your monitor, as I almost did.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @CreepySkeleton on 2020-04-21 11:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Dylan-DPC-zz">@Dylan-DPC-zz</a> on 2020-04-21 11:24</div>
            <div class="timeline-body"><p>We are not writing a book here so can you drop the philosophy</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spacekookie">@spacekookie</a> on 2020-04-21 12:16</div>
            <div class="timeline-body"><p>@CreepySkeleton is there a chance you can keep the vitriol out of your comments in the future? Getting angry at reporters, issues, or code is just childish and makes the project's atmosphere a lot less pleasant to engage with for everybody. Also...please don't talk <em>about</em> people like they're not in the room, even though they can clearly read what you're saying.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-21 12:25</div>
            <div class="timeline-body"><p>I think there's some miscommunication here. From what I understand of his post, he didn't write anything angry at anyone. He was only angry at himself. Just to clarify, @spacekookie Are you saying that he shouldn't be angry at even himself when commenting?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Dylan-DPC-zz">@Dylan-DPC-zz</a> on 2020-04-21 12:25</div>
            <div class="timeline-body"><p>if someone wants to be angry at themselves, they can do it in private, dont need to rant on any issue. And reading the comment, it is clear it is not a case of a self-rant. Don't try to justify it, the intention is pretty clear on this one</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/spacekookie">@spacekookie</a> on 2020-04-21 12:30</div>
            <div class="timeline-body"><p>@pksunkara There's a difference between saying &quot;Oh I did a bad, couldn't figure it out&quot; or whatever and &quot;I wasted time because I assumed the report was correct&quot;. One is targeted at nobody, the other is clearly targeted at the reporter.</p>
<p>And I feel the fact that we keep having to have these conversations shows that there's a problem. This is not how Rust projects communicate and it goes against the atmosphere in the rest of the project.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-21 12:33</div>
            <div class="timeline-body"><p>@spacekookie Thanks, I understand what you mean now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-04-21 17:13</div>
            <div class="timeline-body"><p>@Dylan-DPC @spacekookie</p>
<p>The sky on a sunny day is clear. Intentions rarely are.</p>
<p>If I may clarify the intention behind my comment:</p>
<ul>
<li>First sentence: a slight ironic apology for the time it took us to get to the issue. A matter of politeness, nothing more, nothing less.</li>
<li>Second paragraph: explanation why the report was false positive. I believe it consist of facts that everybody can check.</li>
<li>Third paragraph: a note to myself (and remainder to other maintainers) that I should check correctness of the reproducer before I try to confirm the bug, not after, and also a bit of joking to put emphasis on it. Contrary to your (apparent) beliefs, it wasn't supposed to be perceived as angry or bitter, it was supposed to be read in a very neutral tone. I apologize if it made somebody out there feel uncomfortable, I honestly do.</li>
</ul>
<p>If I worded it wrong, I would appreciate your explanation in form of &quot;The <code>X</code> clause may be considered impolite\offensive because of &lt;explanation&gt;&quot;. The explanation part is very important here because without it it's just your personal perception.</p>
<p>Please remember that the way things are being perceived may not to be the way they were intended to be perceived. There's absolutely no need to see me as always angry/upset person who is eager to leave a bitter comment in public; I am not, in fact. Very few of the comments I left are intended to be offensive, and none of those were left on programming forums. I'd be very thankful it you could kindly explain which parts of my comment left such a horrible impact and why they did so.</p>
<p>Please also keep in mind that people are different: what is perceived as an offense by one person may fly as a harmless note for another. For instance, &quot;I wasted time because I assumed the report was correct&quot; does sound totally neutral to me. Who made the wrong assumption? I did. Who wasted time because of the wrong assumption? I did. Whose time was wasted because of the wrong assumption? Mine. Whose to blame here? The person who harshly made the wrong assumption: me. I don't see what's wrong with the sentence, but I also understand it makes you uncomfortable somehow. This is why I'm asking you to kindly take some of your time to <em>explain</em> it to me.</p>
<p>So I ask of you: is there a chance you stop defaulting to viewing my comments as bitter or angry or childish or directed on somebody instead of what they really are? I'm ready to work on my writing style, definitely!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:46 UTC
    </footer>
</body>
</html>
