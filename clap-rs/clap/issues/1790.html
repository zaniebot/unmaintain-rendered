<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ability to style help messages - clap-rs/clap #1790</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Ability to style help messages</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/1790">#1790</a>
        opened by <a href="https://github.com/pickfire">@pickfire</a>
        on 2020-04-07 07:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/pickfire">@pickfire</a> on 2020-04-07 07:09</div>
            <div class="timeline-body"><p><a href="https://github.com/clap-rs/clap/issues/1790#issuecomment-955036046">Closing comment</a></p>
<blockquote>
<p>Rather than embedding a styling API into clap, might I suggest the following issues as a focus point for users and maintainers:</p>
<ul>
<li><a href="https://github.com/clap-rs/clap/issues/2914">[modular] Decouple help format from help generation #2914</a></li>
<li><a href="https://github.com/clap-rs/clap/issues/1433">Allow styled text in <code>template</code> #1433</a></li>
<li><a href="https://github.com/clap-rs/clap/issues/3108">The header for my examples are not colored like the others #3108</a></li>
</ul>
</blockquote>
<hr />
<h3>Make sure you completed the following tasks</h3>
<ul>
<li>[x] Searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[x] Searched the closes issues</li>
</ul>
<h3>Describe your use case</h3>
<p>Configuration to allows styling help messages. It is helpful for example when styling help messages in a way to improves discover-ability of sub-commands or even <strong>bold</strong> and <em>emphasize</em> command description, or with the use of colors.</p>
<h3>Describe the solution you'd like</h3>
<p>It may have cross platform terminal support issue so we may need to depend on some other crates to handle styling for this and it is also better to be feature gated.</p>
<p>A snipped in my mind would be to have some terminal escapes to display the color but it may not be cross-platform, this should be open for discussion.</p>
<pre><code class="language-rust">    .subcommand(&quot;\e[1mb\e[muild&quot;)
</code></pre>
<p>But it should be extensible so it could be reused for man page generation or completions later on.</p>
<h3>Alternatives, if applicable</h3>
<p>Use other crates to get the same feature</p>
<h3>Additional context</h3>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by @pickfire on 2020-04-07 07:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-07 09:00</div>
            <div class="timeline-body"><p>What happens currently if you actually use the ansi escape codes in the usage messages right now?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-04-08 13:29</div>
            <div class="timeline-body"><p>@pksunkara Oh, right now the ansi escape codes does not even work.</p>
<pre><code class="language-rust">use clap::{App, SubCommand};

fn main() { Run
    let matches = App::new(&quot;app&quot;)
        .subcommand(SubCommand::with_name(r&quot;\e[1mt\e[mest&quot;))
        .get_matches();
    dbg!(matches);
}
</code></pre>
<pre><code>&gt; cargo r -- -h
   Compiling hello v0.1.0 (/home/ivan/hello)
    Finished dev [unoptimized + debuginfo] target(s) in 0.77s
     Running `target/debug/hello -h`
app

USAGE:
    hello [SUBCOMMAND]

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

SUBCOMMANDS:
    \e[1mt\e[mest
    help             Prints this message or the help of the given subcommand(s)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Dylan-DPC-zz">@Dylan-DPC-zz</a> on 2020-04-08 18:55</div>
            <div class="timeline-body"><p>@pickfire hey, thanks for reporting this. do you want to work on this issue? feel free to submit a PR :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: help message</span> added by @pksunkara on 2020-04-09 08:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @pksunkara on 2020-04-09 08:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-04-10 01:10</div>
            <div class="timeline-body"><p>@Dylan-DPC Nope, I will probably not work on this. Maybe I will work on the extra line config #1642.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Dylan-DPC-zz">@Dylan-DPC-zz</a> on 2020-04-10 01:12</div>
            <div class="timeline-body"><p>@pickfire sure no issues</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-04-10 19:58</div>
            <div class="timeline-body"><p>Sidenote: on Windows &lt; 10 ascii escape codes are not supported AFAIK. Do we care?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1433.html">clap-rs/clap#1433</a> on 2020-07-09 13:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mainrs">@mainrs</a> on 2020-07-30 11:45</div>
            <div class="timeline-body"><p>Wouldn't an API be better that can be passed to items. This would allow for noop implementations on unsupported platforms. There are enough crates out there that already do that, there would just be the need to create an API around it. Maybe something like this?</p>
<pre><code class="language-rust">use clap::{App, SubCommand, Style};

fn main() { Run
    let style = Style::default()
        .fg(Color::Red)
        .bg(Color::Orange)
        .underline();

    let matches = App::new(&quot;app&quot;)
        .subcommand(SubCommand::with_name(&quot;test&quot;).style(style))
        .get_matches();
    dbg!(matches);
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-07-30 17:12</div>
            <div class="timeline-body"><p>But how does this API works with some more advanced? Like command description where one needs to change the style of some text partially? I bet it would be complicated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mainrs">@mainrs</a> on 2020-07-30 17:26</div>
            <div class="timeline-body"><p>I mean there are already solutions for that. For example https://github.com/mackwic/colored allows to color strings how you'd like. And you can just compose them using the format macros.</p>
<p>Given the example above it wasn't clear that a need arised in having everything colorable. And I kind of doubt the usefulness of that one.</p>
<p>Not sure what clap does under the hood to be honest, but I just tested it using a simple example and clap does filter out the ANSI. I did some fast digging but couldn't find the part where it does that. You guys probably know more though.</p>
<pre><code class="language-rust">use clap::{Arg, App};
use colored::Colorize;

fn main() {
    println!(&quot;{}&quot;, &quot;hello world&quot;.red());
    let matches = App::new(&quot;test&quot;)
        .arg(Arg::with_name(&quot;arg&quot;)
            .about(&quot;some longer description&quot;.cyan().as_ref()))
        .get_matches();
}
</code></pre>
<p>I expected the above to print the help in cyan, but the control codes get filtered out for some reason. The hello world is red though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-07-31 15:16</div>
            <div class="timeline-body"><p>@pksunkara IIRC currently clap filters out ansi escapes codes like @SirWindfield mentioned. I wonder if there is a reason behind it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-07-31 21:53</div>
            <div class="timeline-body"><p>I am not sure if we filter or remove it. I would need to check. But the current behavior you are describing is intentional. Having non display chars was messing with the help message indentation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-08-01 09:16</div>
            <div class="timeline-body"><p>But these escape codes for coloring are not adding any spaces or changing the indentation, maybe we can explicitly whitelist the escape codes for coloring (except those that mess with the cursors).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-08-01 12:29</div>
            <div class="timeline-body"><p>Pasting my own comment from elsewhere</p>
<hr />
<blockquote>
<p>That said, what I'd suggest is some kind of placeholder that resolves to either changing the colour if colourization is enabled or nothing if it's disabled.</p>
</blockquote>
<p>I was thinking along these lines in the context of #1790. Something like</p>
<pre><code>{color:yellow:USAGE}
</code></pre>
<p>or more generally</p>
<pre><code>{color:color_name-bold:text}
 ----- ---------- ---- ----
 |        |         |
 keyword  |       optional bold switch
       the color
</code></pre>
<p>And maintain the list of supported colors.</p>
<p>I don't want to support any RGB-or-something notations because Windows CMD has only a set of predefined colors and implementing the RGB code =&gt; winapi color mapping is something I very much like to avoid.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-08-01 12:54</div>
            <div class="timeline-body"><p>@CreepySkeleton Does windows support for coloring and codes similar to the one in linux? I wonder if it would be good to do it this way, the API looks interesting but I think it may be a bit limited for linux where people cannot use something special like blinking cursors (I rarely see people using it but it could be done). Or maybe should we still allow an API to let people paste raw text for different platforms or we could pair it with some kind of <code>#[cfg(platform?)]</code> for it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-08-01 14:22</div>
            <div class="timeline-body"><p>Wait, we were talking about coloring and <strong>bolding</strong> and <em>italicizing</em> arbitrary parts of the template and then we somehow ended up talking about blinking cursors??? How on earth does this stuff relate to help messages?</p>
<p>As for the question, yes, windows has support for text coloring. Specifically, we use <code>termocolor</code> for cross-platform handing of all this insanity, so I'd say <a href="https://docs.rs/termcolor/1.1.0/termcolor/enum.Color.html">this enum</a> is all you can count on (except <code>Ansi</code> and <code>Rgb</code>, see the reason above).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mainrs">@mainrs</a> on 2020-08-01 14:35</div>
            <div class="timeline-body"><p>That doesn't hold true for all Windows versions. Windows 10 does support RGB values the same as Linux does. I did find and use a crate that had support for it, not sure what it's name was though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pickfire">@pickfire</a> on 2020-08-01 15:39</div>
            <div class="timeline-body"><blockquote>
<p>Wait, we were talking about coloring and bolding and italicizing arbitrary parts of the template and then we somehow ended up talking about blinking cursors??? How on earth does this stuff relate to help messages?</p>
</blockquote>
<p>Yes, we are talking about coloring, <strong>bolding</strong> and <em>italicizing</em> (or maybe underline too). I just wanted to talk about the extensibility which probably we won't need because we are limited to cross platform support but I am just wondering if there is a possibility that we are able allow that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-08-01 15:56</div>
            <div class="timeline-body"><p>That's all nice and dandy, but let's imagine you're on Windows 7 or 8 or pre-escapes-supported win 10 (was about 35% of market share last time I looked) and you're trying to set the RGB color, say <code>{color:#ef432a:TEXT}</code>. What is clap supposed to do? What <em>can</em> clap do? Only ignore the setting - there's no sane way to map an RGB code to one of the 16 colors and make it look good.</p>
<p>If we implemented RGB handling in the way described above (and I see no others), then we're up to answering questions like, &quot;I (developer) made use of the brand new feature and now my Win 7 users complain they're left staring at black-and-white wall of text, all retro! You claimed support for win 7; is RGB broken?&quot;.</p>
<p>This is the reason I'm not excited about RGB: I don't want to roll features that sometimes work and sometimes don't.</p>
<p>Although, I admit I'm not dead set against it, but I'm going to need some further persuasion about why this is useful. Are the 16 colors not enough for help messages?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mainrs">@mainrs</a> on 2020-08-01 16:25</div>
            <div class="timeline-body"><p>I do get your point, but what is wrong with having the developer decide if they want to map the RGB colors back to the 16 if needs arises due to platform restrictions? I guess for a first implementation RGB can be ignored for sure. But I don't see why this couldn't even be an optional feature people can opt in to.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-08-01 16:46</div>
            <div class="timeline-body"><p>Hm, I guess what we need is some sort of (optional) fallback: <code>{color:#ef432a(yellow):TEXT}</code> which means &quot;if the platform does not support rgb, set it to yellow&quot;. If no fallback specified, you're out of luck and colors.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-08-11 01:01</div>
            <div class="timeline-body"><p>I like the format that is proposed but I am also vary about adding DSL's to the descriptions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ajeetdsouza">@ajeetdsouza</a> on 2021-04-27 20:40</div>
            <div class="timeline-body"><p>@pksunkara instead of a DSL, perhaps users can supply <code>after_help_pieces: Vec&lt;(String, Option&lt;Color&gt;)&gt;</code>? That way, you can just pass it to the <code>Colorizer</code> the same way other strings in clap are passed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lilyball">@lilyball</a> on 2021-06-28 21:24</div>
            <div class="timeline-body"><p>I want color in messages, but primarily I want to be able to just match clap's existing colors rather than specifying a particular one. My use case is when writing a help message for an option with possible/default values. Clap will include these possible/default values in the help string with colors, but if I'm referencing a possible value in the string itself, I want to use the same color. Similarly if I hide the default/possible values I want to be able to reproduce them in the help string.</p>
<p>Basically, what I want is to be able to write <code>arg.hide_default_value(true).hide_possible_values(true).help(â€¦)</code> and still be able to replicate precisely the same output clap does by default. The goal of course is to then modify that, but if I can replicate it, then that means I have the tools to do what I need.</p>
<p>Technically I can do this today in clap 2.33 by using the undocumented <code>clap::Format</code>, but I'm assuming it's undocumented for a reason and a cursory look at clap 3.0 suggests it's no longer available there.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lilyball">@lilyball</a> on 2021-06-28 21:41</div>
            <div class="timeline-body"><p>To expand on that, I would really like 3.0 to at least have the ability to apply the same coloration used for the default/possible values, regardless of any support for a full DSL for coloration. At the moment I am going ahead and using <code>clap::Format</code> in my code, with the expectation that I'll have to adapt once clap 3.0 is out and we switch to it, and I'd really love to have <em>some</em> solution that doesn't involve reimporting <code>atty</code> and <code>ansi_term</code> myself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ajeetdsouza">@ajeetdsouza</a> on 2021-06-29 07:23</div>
            <div class="timeline-body"><p>My use case is that I'd like to show environment variables in the <code>--help</code> menu.</p>
<pre><code>ENVIRONMENT VARIABLES:
    SAMPLE_FOO    This does foo thing.
    SAMPLE_BAR    This does bar thing.
</code></pre>
<p>I'd like a way to highlight the heading and items in this list the same way that clap does for flags and options.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.1" by @pksunkara on 2021-08-09 02:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2668.html">clap-rs/clap#2668</a> on 2021-08-09 02:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2963.html">clap-rs/clap#2963</a> on 2021-10-29 20:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-10-29 20:41</div>
            <div class="timeline-body"><p>#2914 is another way of resolving some of the care-abouts mentioned this thread.</p>
<p>Personally, this thread sounds like its pulling into claps' API a terminal styling API, directly or through a template language.  There are enough care-abouts and concerns with those APIs, I'm concerned having a bespoke styling API is a bigger concern than we should take on.  We could adopt an existing one but those tend to have their own cadence for breaking changes, I'm unsure how much we want to tie ourselves to them in that way.</p>
<p>See also</p>
<ul>
<li>#1433</li>
<li>#3108</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/116.html">epage/clapng#116</a> on 2021-12-06 18:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/150.html">epage/clapng#150</a> on 2021-12-06 19:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> removed by @epage on 2021-12-08 21:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @epage on 2021-12-08 21:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3108.html">clap-rs/clap#3108</a> on 2021-12-09 12:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-09 21:26</div>
            <div class="timeline-body"><p>Rather than embedding a styling API into clap, might I suggest the following issues as a focus point for users and maintainers:</p>
<ul>
<li>#2914</li>
<li>#1433</li>
<li>#3108</li>
</ul>
<p>I'm going to go ahead and close this out in favor of those issues.  If there are any concerns with the plan of relying on those issues, please let us know!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2021-12-09 21:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-12-10 14:09</div>
            <div class="timeline-body"><p>I think this issue was kept separate to #1433 because this would allow users to show different colors for their different subcommands. I am not sure if #2914 would cover that case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-10 21:04</div>
            <div class="timeline-body"><p>So, to a degree, we'll need to expose <code>Colorizer</code> to allow code-genned help after #2914.  Having that exposed in the whole API and allowing custom styling is what I'm most concerned about in this issue (especially when if a subcommand needs a separate display name from actual name for styling).</p>
<p>With the custom formatting allowed by #2914, a user could match on the subcommand names and do a lookup for how they would want to format it, so I do see that being a solution for this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2196.html">clap-rs/clap#2196</a> on 2021-12-13 15:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2389.html">clap-rs/clap#2389</a> on 2021-12-30 12:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3234.html">clap-rs/clap#3234</a> on 2021-12-31 12:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-wont-fix</span> added by @epage on 2022-01-11 18:42</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:32 UTC
    </footer>
</body>
</html>
