<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>&quot;invalid option definition&quot; in ripgrep Zsh completion - clap-rs/clap #771</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>&quot;invalid option definition&quot; in ripgrep Zsh completion</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/771">#771</a>
        opened by <a href="https://github.com/lilianmoraru">@lilianmoraru</a>
        on 2016-12-08 13:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lilianmoraru">@lilianmoraru</a></div>
            <div class="timeline-body">Rust Version
<ul>
<li>rustc 1.15.0-nightly (daf8c1dfc 2016-12-05)</li>
</ul>
Affected Version of clap
<ul>
<li>2.19.1</li>
</ul>
Expected Behavior Summary
<p>To see the completion</p>
Actual Behavior Summary
<p><code>ripgrep v0.3.2</code></p>
<p><code>ripgrep</code>&#x27;s zsh completion does not work and executing completion for <code>rg --</code> throws these messages(note: I tried <code>rustup</code> too and it worked):</p>
<pre><code>_arguments:comparguments:312: invalid option definition: --color+[When to use color. [default: auto]]: :(never auto always ansi)
_arguments:comparguments:312: invalid option definition: --color+[When to use color. [default: auto]]: :(never auto always ansi)
_arguments:comparguments:312: invalid option definition: --color+[When to use color. [default: auto]]: :(never auto always ansi)
_arguments:comparguments:312: invalid option definition: --color+[When to use color. [default: auto]]: :(never auto always ansi)
_arguments:comparguments:312: invalid option definition: --color+[When to use color. [default: auto]]: :(never auto always ansi)
</code></pre>
<p>I cannot create a gist(company proxy) so I will put here the generated completion:</p>
<pre><code>#compdef rg

_rg() {
	typeset -A opt_args
	local ret=1

	local context curcontext=&quot;$curcontext&quot; state line
    _arguments -s -S -C \
&quot;*-e+[A regular expression used for searching.]&quot; \
&quot;*--regexp+[A regular expression used for searching.]&quot; \
&quot;--color+[When to use color. [default: auto]]: :(never auto always ansi)&quot; \
&quot;*--colors+[Configure color settings and styles.]&quot; \
&quot;*-g+[Include or exclude files/directories.]&quot; \
&quot;*--glob+[Include or exclude files/directories.]&quot; \
&quot;*-t+[Only search files matching TYPE.]&quot; \
&quot;*--type+[Only search files matching TYPE.]&quot; \
&quot;*-T+[Do not search files matching TYPE.]&quot; \
&quot;*--type-not+[Do not search files matching TYPE.]&quot; \
&quot;-A+[Show NUM lines after each match.]&quot; \
&quot;--after-context+[Show NUM lines after each match.]&quot; \
&quot;-B+[Show NUM lines before each match.]&quot; \
&quot;--before-context+[Show NUM lines before each match.]&quot; \
&quot;-C+[Show NUM lines before and after each match.]&quot; \
&quot;--context+[Show NUM lines before and after each match.]&quot; \
&quot;--context-separator+[Set the context separator string. [default: --]]&quot; \
&quot;*-f+[Search for patterns from the given file.]&quot; \
&quot;*--file+[Search for patterns from the given file.]&quot; \
&quot;*--ignore-file+[Specify additional ignore files.]&quot; \
&quot;-m+[Limit the number of matches.]&quot; \
&quot;--max-count+[Limit the number of matches.]&quot; \
&quot;--maxdepth+[Descend at most NUM directories.]&quot; \
&quot;-r+[Replace matches with string given.]&quot; \
&quot;--replace+[Replace matches with string given.]&quot; \
&quot;-j+[The approximate number of threads to use.]&quot; \
&quot;--threads+[The approximate number of threads to use.]&quot; \
&quot;*--type-add+[Add a new glob for a file type.]&quot; \
&quot;*--type-clear+[Clear globs for given file type.]&quot; \
&quot;-h[Show short help output.]&quot; \
&quot;--help[Show verbose help output.]&quot; \
&quot;-V[Prints version information.]&quot; \
&quot;--version[Prints version information.]&quot; \
&quot;(-f --file -e --regexp --type-list)--files[Print each file that would be searched.]&quot; \
&quot;(-f --file --files -e --regexp)--type-list[Show all supported file types.]&quot; \
&quot;-a[Search binary files as if they were text.]&quot; \
&quot;--text[Search binary files as if they were text.]&quot; \
&quot;-c[Only show count of matches for each file.]&quot; \
&quot;--count[Only show count of matches for each file.]&quot; \
&quot;-F[Treat the pattern as a literal string.]&quot; \
&quot;--fixed-strings[Treat the pattern as a literal string.]&quot; \
&quot;-i[Case insensitive search.]&quot; \
&quot;--ignore-case[Case insensitive search.]&quot; \
&quot;-n[Show line numbers.]&quot; \
&quot;--line-number[Show line numbers.]&quot; \
&quot;-N[Suppress line numbers.]&quot; \
&quot;--no-line-number[Suppress line numbers.]&quot; \
&quot;-q[Do not print anything to stdout.]&quot; \
&quot;--quiet[Do not print anything to stdout.]&quot; \
&quot;*-u[Reduce the level of &quot;smart&quot; searching.]&quot; \
&quot;*--unrestricted[Reduce the level of &quot;smart&quot; searching.]&quot; \
&quot;-v[Invert matching.]&quot; \
&quot;--invert-match[Invert matching.]&quot; \
&quot;-w[Only show matches surrounded by word boundaries.]&quot; \
&quot;--word-regexp[Only show matches surrounded by word boundaries.]&quot; \
&quot;--column[Show column numbers]&quot; \
&quot;--debug[Show debug messages.]&quot; \
&quot;-l[Only show the path of each file with at least one match.]&quot; \
&quot;--files-with-matches[Only show the path of each file with at least one match.]&quot; \
&quot;--files-without-match[Only show the path of each file that contains zero matches.]&quot; \
&quot;-H[Show file name for each match.]&quot; \
&quot;--with-filename[Show file name for each match.]&quot; \
&quot;--no-filename[Never show the file name for a match.]&quot; \
&quot;--heading[Show matches grouped by each file.]&quot; \
&quot;--no-heading[Don&#x27;t group matches by each file.]&quot; \
&quot;--hidden[Search hidden files and directories.]&quot; \
&quot;-L[Follow symbolic links.]&quot; \
&quot;--follow[Follow symbolic links.]&quot; \
&quot;--mmap[Searching using memory maps when possible.]&quot; \
&quot;--no-messages[Suppress all error messages.]&quot; \
&quot;--no-mmap[Never use memory maps.]&quot; \
&quot;--no-ignore[Don&#x27;t respect ignore files.]&quot; \
&quot;--no-ignore-parent[Don&#x27;t respect ignore files in parent directories.]&quot; \
&quot;--no-ignore-vcs[Don&#x27;t respect VCS ignore files]&quot; \
&quot;--null[Print NUL byte after file names]&quot; \
&quot;-p[Alias for --color always --heading -n.]&quot; \
&quot;--pretty[Alias for --color always --heading -n.]&quot; \
&quot;-s[Search case sensitively.]&quot; \
&quot;--case-sensitive[Search case sensitively.]&quot; \
&quot;-S[Smart case search.]&quot; \
&quot;--smart-case[Smart case search.]&quot; \
&quot;--vimgrep[Show results in vim compatible format.]&quot; \
&quot;1:: :_rg_commands&quot; \
&amp;&amp; ret=0
    
}

(( $+functions[_rg_commands] )) ||
_rg_commands() {
    local commands; commands=(
        &quot;PATTERN:A regular expression used for searching.&quot; \
&quot;PATH:A file or directory to search.&quot; \
    )
    _describe -t commands &#x27;rg commands&#x27; commands &quot;$@&quot;
}
(( $+functions[_rg_commands] )) ||
_rg_commands() {
    local commands; commands=(
        &quot;PATTERN:A regular expression used for searching.&quot; \
&quot;PATH:A file or directory to search.&quot; \
    )
    _describe -t commands &#x27;rg commands&#x27; commands &quot;$@&quot;
}

_rg &quot;$@&quot;%
</code></pre>
Steps to Reproduce the issue
<ol>
<li><code>git clone -b 0.3.2 https://github.com/BurntSushi/ripgrep.git</code></li>
<li><code>cd ripgrep &amp;&amp; cargo build</code></li>
<li>Example on Ubuntu: <code>sudo cp ./target/debug/build/*/out/_rg /usr/share/zsh/functions/Completion/Linux/</code></li>
<li>Restart zsh terminal and try to obtain the completion for <code>ripgrep/target/debug/rg --</code></li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-12-08 14:53</div>
            <div class="timeline-body"><p>Thanks for taking the time to file all this! I&#x27;ll look into it tonight and post back here with anything I find.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: completion gen</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-12-08 14:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-12-08 14:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-12-08 14:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-12-08 14:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-12-08 14:56</div>
            <div class="timeline-body"><p>Actually, looking at this real quick I think it&#x27;s because in this line:</p>
<pre><code>&quot;--color+[When to use color. [default: auto]]: :(never auto always ansi)&quot; \
</code></pre>
<p>the <code>[</code> and <code>]</code> in the default value need to be escaped. So this should be an  easy fix :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-12-08 14:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-12-09 01:41</div>
            <div class="timeline-body"><p>This is fixed in #772</p>
<p>Once that merges I&#x27;ll put v2.19.2 on crates.io</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/homu">@homu</a> on 2016-12-09 03:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lilianmoraru">@lilianmoraru</a> on 2016-12-09 11:18</div>
            <div class="timeline-body"><p>I can confirm that it works now, thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>BurntSushi/ripgrep#287</a> on 2016-12-23 10:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>spf13/cobra#881</a> on 2019-06-12 20:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>linkerd/linkerd2#3999</a> on 2020-09-22 04:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>eksctl-io/eksctl#2747</a> on 2020-10-16 09:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:56:40 UTC
    </footer>
</body>
</html>
