<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update to structopt 0.3 master - clap-rs/clap #1660</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Update to structopt 0.3 master</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/1660">#1660</a>
        opened by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a>
        on 2019-10-02 20:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2019-10-02 20:25</div>
            <div class="timeline-body"><p><code>structopt</code> has released v0.3.0 a month ago. This update brings in a number of breaking changes (most noticeably <code>raw</code> attributes removal), cosmetic changes (like span-based error reporting), and a lot of minor improvements and bug fixes. Furthermore, it has been improving further over this month, working both on new features and bug fixes. Also docs have been clarified and greatly improved.</p>
<p>Summarizing all of it, I propose to use <code>structopt</code> v0.3 as <code>clap_derive</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2019-10-11 14:54</div>
            <div class="timeline-body"><p>@CreepySkeleton Could you link the structopt breaking changes here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TeXitoi">@TeXitoi</a> on 2019-10-11 15:01</div>
            <div class="timeline-body"><p>https://github.com/TeXitoi/structopt/blob/master/CHANGELOG.md#breaking-changes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2019-10-12 08:49</div>
            <div class="timeline-body"><p>@pksunkara Also please keep in mind that <code>structopt</code> is being improved even now. Since 0.3.0 it got a number of new features and bugfixes, see <a href="https://github.com/TeXitoi/structopt/blob/master/CHANGELOG.md">changelog</a>. So I highly recommend to take the last version, whatever it'll happen to be at the point.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2019-12-13 19:55</div>
            <div class="timeline-body"><p>@TeXitoi Is there a document about difference between structopt and clap_derive? Why are not combining the efforts?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2019-12-13 20:56</div>
            <div class="timeline-body"><blockquote>
<p>Is there a document about difference between structopt and clap_derive?</p>
</blockquote>
<p>When I try to do several things at once it typically results in nothing being done :( I'm going to write such a &quot;moving from <code>structopt v0.3</code> to <code>clap v3</code> once the transition is done.</p>
<blockquote>
<p>Why are not combining the efforts?</p>
</blockquote>
<p>I'd love to!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: derive macros</span> added by @pksunkara on 2020-02-03 09:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0.0-alpha.3" by @pksunkara on 2020-02-03 09:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Update to structopt 0.3" to "Update to structopt 0.3 master" by @pksunkara on 2020-02-03 09:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-02-06 09:30</div>
            <div class="timeline-body"><p>@CreepySkeleton We can close this, the only thing we are missing is:</p>
<p>https://github.com/TeXitoi/structopt/commit/dc7571c85bf8977fa9c1da654c78cda7be961da8</p>
<p>Also, We had decided not to use <code>paw</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-06 09:34</div>
            <div class="timeline-body"><p>Yeah, if somebody wants paw support here - well, I'm not totally against it, but let's wait for a feedback first.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @CreepySkeleton on 2020-02-06 09:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-02-06 09:35</div>
            <div class="timeline-body"><p>What about the error message improvement commit I linked above?</p>
<p>--
Pavan Kumar Sunkara</p>
<p>On 6 February 2020 at 10:34:04 AM, CreepySkeleton (notifications@github.com)
wrote:</p>
<p>Closed #1660 <a href="https://github.com/clap-rs/clap/issues/1660">https://github.com/clap-rs/clap/issues/1660</a>.</p>
<p>â€”
You are receiving this because you commented.
Reply to this email directly, view it on GitHub
<a href="https://github.com/clap-rs/clap/issues/1660?email_source=notifications&amp;email_token=AABKU34HVYTNELAK7PLK3TLRBPKQXA5CNFSM4KPBV5U2YY3PNVWWK3TUL52HS4DFWZEXG43VMVCXMZLOORHG65DJMZUWGYLUNFXW5KTDN5WW2ZLOORPWSZGOWOMKIHI#event-3013125149">https://github.com/clap-rs/clap/issues/1660?email_source=notifications&amp;email_token=AABKU34HVYTNELAK7PLK3TLRBPKQXA5CNFSM4KPBV5U2YY3PNVWWK3TUL52HS4DFWZEXG43VMVCXMZLOORHG65DJMZUWGYLUNFXW5KTDN5WW2ZLOORPWSZGOWOMKIHI#event-3013125149</a>,
or unsubscribe
<a href="https://github.com/notifications/unsubscribe-auth/AABKU32OWVK22PP77T25ORTRBPKQXANCNFSM4KPBV5UQ">https://github.com/notifications/unsubscribe-auth/AABKU32OWVK22PP77T25ORTRBPKQXANCNFSM4KPBV5UQ</a>
.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-06 09:37</div>
            <div class="timeline-body"><p>That's not much of improvement anyway, see diff for the <code>.stderr</code> files. I think it can wait for refactoring.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.0.0-beta.2" by @pksunkara on 2020-04-07 13:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @pksunkara on 2020-04-07 13:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Lucretiel">@Lucretiel</a> on 2020-09-22 16:34</div>
            <div class="timeline-body"><p>Oh, why was <code>paw</code> removed? <code>paw</code> was one of my favorite feature additions to <code>structopt</code>, for basically the same reason that <code>structopt</code> one of my favorite feature additions to <code>clap</code>, since it makes argument parsing <em>fully</em> declarative.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-09-22 19:59</div>
            <div class="timeline-body"><p><code>paw</code> is downright useless. Let's just compare it with raw clap:</p>
<pre><code class="language-rust">#[paw::main]
fn main(opts: Opts) {
    //...
}
</code></pre>
<pre><code class="language-rust">fn main() {
    let opts = Opts::parse();
    //...
}
</code></pre>
<p>Identical behavior, two lines difference per program. Is it even worth to talk about? IMO it definitely didn't worth <a href="https://github.com/TeXitoi/structopt/issues/407">the fuss it caused in structopt</a>.</p>
<p>This &quot;fully declarative&quot; argument is meaningless unless you specify your definition of &quot;fully declarative&quot;. I think I can count half a dozen of people I've met who had their own definition of declarative, exclusive of course, and obviously the only correct one. I guess it's fair to say that I have come to belief that this kind of &quot;this isn't <em>real</em> magic!&quot; kind of arguments is merely a synonym for &quot;I'm out of arguments, but I still believe my opponent is obviously wrong&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Dylan-DPC-zz">@Dylan-DPC-zz</a> on 2020-09-22 20:06</div>
            <div class="timeline-body"><p>@CreepySkeleton is there a good reason to demean other repositories? this is against the Code of Conduct of Clap and the CLI-WG organisation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-09-22 20:07</div>
            <div class="timeline-body"><p>@Lucretiel I am afraid that I don't understand this part.</p>
<blockquote>
<p>since it makes argument parsing fully declarative.</p>
</blockquote>
<p>Can you please explain what it means and why clap is lacking it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Lucretiel">@Lucretiel</a> on 2020-09-22 20:20</div>
            <div class="timeline-body"><blockquote>
<p>Can you please explain what it means and why clap is lacking it?</p>
</blockquote>
<p>The idea is that a derive macro replaces a &quot;imperative&quot; definition of your parameter set (via the macro or App builder methods) with a &quot;declarative&quot; definition (a struct definition). <code>paw</code> extends this pattern to the acquisition of these arguments by replacing the &quot;imperative&quot; invocation (<code>get_matches</code>) with a &quot;declarative one&quot; (function signature). It has the added (admittedly minor) benefit of circumventing the handling of various pre-emptive exit cases (parse failure, --help, --version), which currently have to be done either manually or with an <code>exit(0)</code> or <code>exit(1)</code> somewhere in the library.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Lucretiel">@Lucretiel</a> on 2020-09-22 20:23</div>
            <div class="timeline-body"><blockquote>
<p>Is it even worth to talk about?</p>
</blockquote>
<p>With respect, your <a href="https://github.com/clap-rs/clap/issues/1660#issuecomment-582815328">comment</a> was explicitly inviting discussion on this topic.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-09-22 20:43</div>
            <div class="timeline-body"><p>Ah, understood now. I think the question of adding <code>paw</code> falls into bikeshedding category (since it changes one line in the whole code) and I personally would want more people to request it before adding support for it with a feature gate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-09-22 23:10</div>
            <div class="timeline-body"><p>@Dylan-DPC I don't think you can classify it as a breach of CoC. I was careful to criticize code. not people; I wish the best of luck to the authors of <code>paw</code> in their endeavor. When criticizing the code, I made sure to explain why I find it useless (identical behavior, one line difference). I don't think that advocating for not using a crate is a CoC breach if you explained your reasoning. I realize I was being terse, but I don't think I was impolite: I was being terse because I don't think bikesheding is worth spending many words on. I don't see how it's a breach of CoC either. You're overreacting.</p>
<p>@Lucretiel Your comment reads a bit incoherent to me, but I think I can understand it in two ways:</p>
<ul>
<li><p>You realize the behavior is identical, but you see a real ideological difference between using an attribute and a function call, something akin to the difference between <code>Option&lt;T&gt;</code> and <code>Result&lt;T, ()&gt;</code>. Unlike <code>Option</code> that occurs in hundred of places in a typical program, this <code>paw</code> problem has extremely low impact: one line per program (or three, depending on how you count). Let's just agree this one is bikesheding at its finest.</p>
</li>
<li><p>You truly believe there's a functional difference between the examples above (your last sentence hints at it). This is wrong. If you mentally expand the <code>paw</code> example, it will result in the &quot;normal derive&quot; example:</p>
<pre><code class="language-rust">// The struct
#[derive(Clap)]
struct Opts {}

// paw invocation
#[paw::main]
fn main(opts: Opts) {
    // code
}

// and what it expands to

impl paw::ParseArgs for Opts {
    type Error = whatever; // irrelevant, never used

    fn parse_args() -&gt; Result&lt;Self, Self::Error&gt; {
        // it just directly does the call, exiting on error immediately
        // because it's what `parse` does
        Ok(Opts::parse())
    }
}

fn main() {
    let opts = Opts::parse_args().unwrap();
    // code
}
</code></pre>
</li>
</ul>
<p>As regards to my earlier comment: it was half a year ago. I used to believe that the feedback from the open source crowd is mostly sound and weighted, even when it's about bikesheding. Now I know better.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:07 UTC
    </footer>
</body>
</html>
