<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extend help subcommand - clap-rs/clap #5354</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Extend help subcommand</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/clap-rs/clap/issues/5354">#5354</a>
        opened by <a href="https://github.com/nwalfield">@nwalfield</a>
        on 2024-02-16 09:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/nwalfield">@nwalfield</a></div>
            <div class="timeline-body">Please complete the following tasks
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
Clap Version
<p>4.5.0</p>
Describe your use case
<p><a href="https://gitlab.com/sequoia-pgp/sequoia-sq"><code>sq</code></a> is the command-line front end for <a href="https://gitlab.com/sequoia-pgp/sequoia"><code>sequoia-openpgp</code></a>.  It has a dozen subcommands, and most of the subcommands have their own subcommands.  This deep hierarchical structure means getting an overview of <code>sq</code>&#x27;s functionality is not straightforward.</p>
Describe the solution you&#x27;d like
<p>Most non-fiction books include a table of contents, which gives the reader a quick overview of what is covered and where.  It would be nice if clap could offer similar functionality.</p>
<p>One idea what we had is to extended the <code>help</code> subcommand with an option, perhaps <code>-a</code>, which recursively lists all subcommands.  Right now, <code>sq help</code> shows:</p>
<pre><code>$ sq help -a
...
Commands:
  encrypt    Encrypts a message
  decrypt    Decrypts a message
  sign       Signs messages or data files
  verify     Verifies signed messages or detached signatures
  inspect    Inspects data, like file(1)
  cert       Manages certificates
  key        Manages keys
  pki        Authenticate certs using the Web of Trust
  autocrypt  Communicates certificates using Autocrypt
  network    Retrieves and publishes certificates over the network
  toolbox    Tools for developers, maintainers, and forensic specialists
  version    Detailed version and output version information
...
</code></pre>
<p><code>-a</code> could perhaps show something like:</p>
<pre><code>$ sq help -a
...
Commands:
  encrypt    Encrypts a message
  decrypt    Decrypts a message
  sign       Signs messages or data files
  verify     Verifies signed messages or detached signatures
  inspect    Inspects data, like file(1)
  cert       Manages certificates
  cert import  Imports certificates into the local certificate store
  cert export  Exports certificates from the local certificate store
  cert lint    Checks certificates for issues
  key        Manages keys
  key generate               Generates a new key
  key password               Changes password protecting secrets
  key expire                 Changes expiration times
  key revoke                 Revoke a certificate
  key userid                 Manages User IDs
  key subkey                 Manages Subkeys
  key extract-cert           Converts a key to a cert
  key attest-certifications  Attests to third-party certifications
  key adopt                  Binds keys from one certificate to another
  pki        Authenticate certs using the Web of Trust
  pki authenticate  Authenticate a binding
  pki lookup        Lookup the certificates associated with a User ID
  pki identify      Identify a certificate
  pki certify       Certifies a User ID for a Certificate
  pki link          Manages authenticated certificate and User ID links
  pki list          List all authenticated bindings (User ID and certificate pairs)
  pki path          Verify the specified path
  ...
</code></pre>
<p>I&#x27;ve spent some time looking at clap&#x27;s documentation, but I couldn&#x27;t find a way to extend the automatically generated <code>help</code> subcommand.  One option would be to disable the <code>help</code> subcommand and reimplement it in <code>sq</code> with the added functionality.  This seems brittle, however.</p>
Alternatives, if applicable
<p><em>No response</em></p>
Additional Context
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by <a href="https://github.com/nwalfield">@nwalfield</a> on 2024-02-16 09:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-02-16 12:20</div>
            <div class="timeline-body"><p>I know at least <code>git</code> has the <code>help -a</code> flag (along with <code>help -g</code>, see #5332).  Cargo has the top-level <code>--list</code>.  Know of any other prior art?</p>
<p>My first concern is with how people discover this.  People aren&#x27;t likely to run <code>sq help help</code>.  Git advertises the flag with an <code>after_help</code></p>
<pre><code>&#x27;git help -a&#x27; and &#x27;git help -g&#x27; list available subcommands and some
concept guides. See &#x27;git help &lt;command&gt;&#x27; or &#x27;git help &lt;concept&gt;&#x27;
to read about a specific subcommand or concept.
See &#x27;git help git&#x27; for an overview of the system.
</code></pre>
<p>I would be loathe to add a blanket after help for people.  Maybe them adding it is their way to &quot;opt in&quot;.</p>
<p>My second concern is I&#x27;m unsure if a flag is the right approach.  I feel like this would be better served as a &quot;topic&quot; (<code>sq help commands</code>) rather than a flag.  Mostly, this feels more consistent to me.  In part, I&#x27;ve wondered about allowing you to take arbitrary commands and inserting a <code>help</code> in the middle (much like you can with <code>--help</code>) which means we need to ignore all flags.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-decision</span> added by <a href="https://github.com/epage">@epage</a> on 2024-02-16 12:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-help</span> added by <a href="https://github.com/epage">@epage</a> on 2024-02-16 12:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>rust-lang/cargo#12114</a> on 2024-02-16 13:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#5355</a> on 2024-02-16 13:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nwalfield">@nwalfield</a> on 2024-02-16 13:52</div>
            <div class="timeline-body"><blockquote>
<p>I know at least git has the help -a flag (along with help -g, see https://github.com/clap-rs/clap/discussions/5332). Cargo has the top-level --list. Know of any other prior art?</p>
</blockquote>
<p><code>gpg</code> has <code>--dump-options</code>.</p>
<blockquote>
<p>I would be loathe to add a blanket after help for people. Maybe them adding it is their way to &quot;opt in&quot;.</p>
</blockquote>
<p>I don&#x27;t completely understand the suggestion.  Do you mean people adding a &quot;table-of-contents&quot; flag is opting in, or people adding an after_help is opting in?  Isn&#x27;t the latter ambiguous, as someone could add an after_help for other reasons?</p>
<blockquote>
<p>My second concern is I&#x27;m unsure if a flag is the right approach. I feel like this would be better served as a &quot;topic&quot; (sq help commands) rather than a flag.</p>
</blockquote>
<p>I&#x27;d be fine with this.  <code>-a</code> was just inspired by <code>git</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-02-16 14:56</div>
            <div class="timeline-body"><blockquote>
<p>I don&#x27;t completely understand the suggestion. Do you mean people adding a &quot;table-of-contents&quot; flag is opting in, or people adding an after_help is opting in? Isn&#x27;t the latter ambiguous, as someone could add an after_help for other reasons?</p>
</blockquote>
<p>One idea is that we support <code>-a</code> unconditionally but leave it to the caller to decide if they want to &quot;support it&quot; by them specifying the <code>after_help</code>, rather than us doing it automatically.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nwalfield">@nwalfield</a> on 2024-02-17 09:20</div>
            <div class="timeline-body"><p>Thanks for the clarification.  I think you are saying that <code>-a</code> is always implemented, but it is up to the application to document that.  I think that is okay.  But, it should probably still be documented under <code>help</code>, even if most people probably do not run <code>cli help help</code>:</p>
<pre><code>$ sq help help
Print this message or the help of the given subcommand(s)

Usage: sq help [COMMAND]...

Arguments:
  [COMMAND]...  Print help for the subcommand(s)
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 20:00:04 UTC
    </footer>
</body>
</html>
