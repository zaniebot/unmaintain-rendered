<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`rustc` gets sigkilled while compiling Clap in release mode - clap-rs/clap #1099</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>rustc</code> gets sigkilled while compiling Clap in release mode</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1099">#1099</a>
        opened by <a href="https://github.com/omern1">@omern1</a>
        on 2017-11-09 04:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/omern1">@omern1</a></div>
            <div class="timeline-body">

Rust Version
<p><code>rustc 1.22.0-nightly (4750c1ec0 2017-10-19)</code></p>
Affected Version of clap
<p><code>v2.27.1</code></p>
Expected Behavior Summary
<p>Clap should compile and run.</p>
Actual Behavior Summary
<p>Clap does not compile, the compiler gets <code>SIGKILL</code>ed.</p>
Steps to Reproduce the issue
<ol>
<li>Include a crate that requires clap (in my case <code>comrak</code>).</li>
<li>Try to compile a release build.</li>
<li>See the magic happen.</li>
</ol>
Sample Code or Link to Sample Code
<pre><code>   Compiling clap v2.26.2
     Running `rustc --crate-name clap /root/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-2.26.2/src/lib.rs --crate-type lib --emit=dep-info,link -C opt-level=3 --cfg &#x27;feature=&quot;ansi_term&quot;&#x27; --cfg &#x27;feature=&quot;atty&quot;&#x27; --cfg &#x27;feature=&quot;color&quot;&#x27; --cfg &#x27;feature=&quot;default&quot;&#x27; --cfg &#x27;feature=&quot;strsim&quot;&#x27; --cfg &#x27;feature=&quot;suggestions&quot;&#x27; --cfg&#x27;feature=&quot;term_size&quot;&#x27; --cfg &#x27;feature=&quot;wrap_help&quot;&#x27; -C metadata=83ba9ae54b80579e -C extra-filename=-83ba9ae54b80579e --out-dir /var/www/nabeelomer.me/target/release/deps -L dependency=/var/www/nabeelomer.me/target/release/deps --extern atty=/var/www/nabeelomer.me/target/release/deps/libatty-8982c3c53cb6d381.rlib --extern unicode_width=/var/www/nabeelomer.me/target/release/deps/libunicode_width-2b00e4ad336ace05.rlib --extern strsim=/var/www/nabeelomer.me/target/release/deps/libstrsim-210abe1bc674c4e6.rlib --extern textwrap=/var/www/nabeelomer.me/target/release/deps/libtextwrap-0466aacf0efd6616.rlib --extern term_size=/var/www/nabeelomer.me/target/release/deps/libterm_size-ab087923b35103ed.rlib --extern vec_map=/var/www/nabeelomer.me/target/release/deps/libvec_map-3a36d765a0f37010.rlib --extern bitflags=/var/www/nabeelomer.me/target/release/deps/libbitflags-a597111cc5faeae3.rlib --extern ansi_term=/var/www/nabeelomer.me/target/release/deps/libansi_term-344a753cad51277a.rlib --cap-lints allow`
error: Could not compile `clap`.

Caused by:
  process didn&#x27;t exit successfully: `rustc --crate-name clap /root/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-2.26.2/src/lib.rs --crate-type lib --emit=dep-info,link -C opt-level=3 --cfg feature=&quot;ansi_term&quot; --cfg feature=&quot;atty&quot; --cfg feature=&quot;color&quot; --cfg feature=&quot;default&quot; --cfg feature=&quot;strsim&quot; --cfg feature=&quot;suggestions&quot; --cfg feature=&quot;term_size&quot; --cfg feature=&quot;wrap_help&quot; -C metadata=83ba9ae54b80579e -C extra-filename=-83ba9ae54b80579e --out-dir /var/www/nabeelomer.me/target/release/deps -L dependency=/var/www/nabeelomer.me/target/release/deps --extern atty=/var/www/nabeelomer.me/target/release/deps/libatty-8982c3c53cb6d381.rlib --extern unicode_width=/var/www/nabeelomer.me/target/release/deps/libunicode_width-2b00e4ad336ace05.rlib --extern strsim=/var/www/nabeelomer.me/target/release/deps/libstrsim-210abe1bc674c4e6.rlib --extern textwrap=/var/www/nabeelomer.me/target/release/deps/libtextwrap-0466aacf0efd6616.rlib --extern term_size=/var/www/nabeelomer.me/target/release/deps/libterm_size-ab087923b35103ed.rlib --extern vec_map=/var/www/nabeelomer.me/target/release/deps/libvec_map-3a36d765a0f37010.rlib --extern bitflags=/var/www/nabeelomer.me/target/release/deps/libbitflags-a597111cc5faeae3.rlib --extern ansi_term=/var/www/nabeelomer.me/target/release/deps/libansi_term-344a753cad51277a.rlib --cap-lints allow` (signal: 9, SIGKILL: kill)
</code></pre>
Debug output
<p>N/A</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;`rustc` gets sigkilled while compiling &quot; to &quot;`rustc` gets sigkilled while compiling Clap in release mode&quot; by <a href="https://github.com/omern1">@omern1</a> on 2017-11-09 04:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-11-09 15:36</div>
            <div class="timeline-body"><p>I can&#x27;t reproduce the issue. Could you compile single threaded, to ensure it&#x27;s a clap issue? Also, what version of Rust are you using?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/omern1">@omern1</a> on 2017-11-09 19:26</div>
            <div class="timeline-body"><p>I&#x27;ve updated my <code>rustc</code> to <code>rustc 1.23.0-nightly (02004ef78 2017-11-08)</code>,  upgraded clap to <code>v2.26.2</code> and it still doesn&#x27;t compile. I&#x27;m on Ubuntu Server 16.04 (Linux 4.4.0-1039-aws).</p>
<p>Also, I don&#x27;t know how to compile it single threaded.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-11-09 19:28</div>
            <div class="timeline-body"><p>How much ram do you have on that machine? This smells like the Linux OOM killer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/omern1">@omern1</a> on 2017-11-09 19:35</div>
            <div class="timeline-body"><p>512 MiB. Yeah... You are right... It is the OOM killer.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/omern1">@omern1</a> on 2017-11-09 19:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-11-09 20:59</div>
            <div class="timeline-body"><p>I hadn&#x27;t looked at memory usage of compiling Rust programs...especially on low memory machines (VPSs, etc.). Compiling a bare <code>cargo new fake --bin</code> takes ~116mb of RAM on my machine. Adding clap bumps it to ~485mb.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:57:01 UTC
    </footer>
</body>
</html>
