<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add ability to remove a subcommand - clap-rs/clap #4927</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add ability to remove a subcommand</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/clap-rs/clap/issues/4927">#4927</a>
        opened by <a href="https://github.com/kvece">@kvece</a>
        on 2023-05-20 23:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/kvece">@kvece</a> on 2023-05-20 23:51</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>master</p>
<h3>Describe your use case</h3>
<p>Basically I am trying to make an interactive REPL</p>
<p>I decided to originally follow from the recipe provided in the cookbook, basically have a root command set with <code>multicall</code> and I all commands in the REPL are implemented as subcommands.</p>
<p>However, when the commands are the REPL are dynamic, I can add commands easily but removing commands that are no longer requires rebuilding the entire <code>Command</code> struct with the desired subcommand missing, which is rather tedious.</p>
<h3>Describe the solution you'd like</h3>
<p>I just took the <code>mut_subcommand</code> function, copied it, and modified it to a <code>remove_subcommand</code> function that has the same functionality except without the callback and without placing a subcommand back into <code>self.subcommands</code></p>
<h3>Alternatives, if applicable</h3>
<p>The other option I considered was modifying the <code>subcommand</code> function that followed the builder pattern, but since I'm not sure why you would need to remove a command in a builder pattern, I thought it was easier to modify the struct rather than create a new one.</p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @kvece on 2023-05-20 23:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4928.html">clap-rs/clap#4928</a> on 2023-05-20 23:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-05-21 00:43</div>
            <div class="timeline-body"><p>Could you expand on the use case for why commands are being added and removed during the lifetime of the REPL?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kvece">@kvece</a> on 2023-05-21 01:02</div>
            <div class="timeline-body"><p>Sure, picture an interactive CLI with a plugin system:</p>
<pre><code>&gt; load plugin
&gt; # associated commands become available
&gt; unload plugin
&gt; # associated commands no longer available
</code></pre>
<p>An alternative design could be:</p>
<pre><code>&gt; use plugin
plugin&gt; # opens a submenu with only the associated commands
plugin&gt; back
&gt; # associated commands no longer available
</code></pre>
<p>But this has the issue where switching back and forth between plugin commands is more tedious for the user (ideally user can load multiple plugins into namespace at once)</p>
<p>Another alternative would be to allow multiple at once:</p>
<pre><code>&gt; use plugin1
plugin1&gt; # opens submenu command object with plugin1 commands added
plugin1&gt; use plugin2
plugin1,plugin2&gt; # opens another object with plugin2 added
plugin1,plugin2&gt; unload plugin1    # now say plugin1 is no longer needed
plugin2&gt; # now I have to start from the root Command and rebuild the object, current solution
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kvece">@kvece</a> on 2023-05-21 01:15</div>
            <div class="timeline-body"><p>Or reference similar functionality in popular python module here: https://cmd2.readthedocs.io/en/stable/features/modular_commands.html</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-05-21 01:55</div>
            <div class="timeline-body"><p>This isn't the right approach with clap's design.  clap expects everything to be added and then &quot;builds&quot;.  Once the build happens, changes shouldn't be made (I'd like to enforce this within the type system but haven't found a satisfactory design yet).  Using this in a REPL to add / remove commands implies an existing instance is being reused.  As an alternative, you could recreate your <code>Command</code> on each interaction which will let you add the currently active plugins though I don't know if the cost for that would be reasonable.</p>
<p>For <code>cmd2</code>, it looks like they have an <code>ArgumentParsser</code> per command and I suspect that would be the right way to model this within your application.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:09 UTC
    </footer>
</body>
</html>
