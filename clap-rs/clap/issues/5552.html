<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fish completions include --no-files on subcommands - clap-rs/clap #5552</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fish completions include --no-files on subcommands</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/5552">#5552</a>
        opened by <a href="https://github.com/maddawik">@maddawik</a>
        on 2024-06-26 12:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/maddawik">@maddawik</a></div>
            <div class="timeline-body"><p>Hello! I first reported this issue downstream in https://github.com/MilesCranmer/rip2. The issue is that the completions generated for fish include <code>-f</code> which prevents files from being included in completion, which in this case is not desired.</p>
<p>Original issue: <a href="https://github.com/MilesCranmer/rip2/issues/39">MilesCranmer/rip2#39</a></p>
<p>Since I&#x27;m not familiar with rust I&#x27;ll just elaborate on the issue itself, here are the completions generated from rip2:</p>
<pre><code>complete -c rip -n &quot;__fish_use_subcommand&quot; -l graveyard -d &#x27;Directory where deleted files rest&#x27; -r -F
complete -c rip -n &quot;__fish_use_subcommand&quot; -s d -l decompose -d &#x27;Permanently deletes the graveyard&#x27;
complete -c rip -n &quot;__fish_use_subcommand&quot; -s s -l seance -d &#x27;Prints files that were deleted in the current directory&#x27;
complete -c rip -n &quot;__fish_use_subcommand&quot; -s u -l unbury -d &#x27;Restore the specified files or the last file if none are specified&#x27;
complete -c rip -n &quot;__fish_use_subcommand&quot; -s i -l inspect -d &#x27;Print some info about TARGET before burying&#x27;
complete -c rip -n &quot;__fish_use_subcommand&quot; -s h -l help -d &#x27;Print help&#x27;
complete -c rip -n &quot;__fish_use_subcommand&quot; -s V -l version -d &#x27;Print version&#x27;
complete -c rip -n &quot;__fish_use_subcommand&quot; -f -a &quot;completions&quot; -d &#x27;Generate shell completions file&#x27;
complete -c rip -n &quot;__fish_use_subcommand&quot; -f -a &quot;graveyard&quot; -d &#x27;Print the graveyard path&#x27;
complete -c rip -n &quot;__fish_use_subcommand&quot; -f -a &quot;help&quot; -d &#x27;Print this message or the help of the given subcommand(s)&#x27;
complete -c rip -n &quot;__fish_seen_subcommand_from completions&quot; -s h -l help -d &#x27;Print help&#x27;
complete -c rip -n &quot;__fish_seen_subcommand_from graveyard&quot; -s s -l seance -d &#x27;Get the graveyard subdirectory of the current directory&#x27;
complete -c rip -n &quot;__fish_seen_subcommand_from graveyard&quot; -s h -l help -d &#x27;Print help&#x27;
complete -c rip -n &quot;__fish_seen_subcommand_from help; and not __fish_seen_subcommand_from completions; and not __fish_seen_subcommand_from graveyard; and not __fish_seen_subcommand_from help&quot; -f -a &quot;completions&quot; -d &#x27;Generate shell completions file&#x27;
complete -c rip -n &quot;__fish_seen_subcommand_from help; and not __fish_seen_subcommand_from completions; and not __fish_seen_subcommand_from graveyard; and not __fish_seen_subcommand_from help&quot; -f -a &quot;graveyard&quot; -d &#x27;Print the graveyard path&#x27;
complete -c rip -n &quot;__fish_seen_subcommand_from help; and not __fish_seen_subcommand_from completions; and not __fish_seen_subcommand_from graveyard; and not __fish_seen_subcommand_from help&quot; -f -a &quot;help&quot; -d &#x27;Print this message or the help of the given subcommand(s)&#x27;
</code></pre>
<p>And it&#x27;s these 3 that (in my testing) are the problematic <code>-f</code> flags:</p>
<pre><code>complete -c rip -n &quot;__fish_use_subcommand&quot; -f -a &quot;completions&quot; -d &#x27;Generate shell completions file&#x27;
complete -c rip -n &quot;__fish_use_subcommand&quot; -f -a &quot;graveyard&quot; -d &#x27;Print the graveyard path&#x27;
complete -c rip -n &quot;__fish_use_subcommand&quot; -f -a &quot;help&quot; -d &#x27;Print this message or the help of the given subcommand(s)&#x27;
</code></pre>
<p>Removing those allows files to be included in completion. Here&#x27;s the author&#x27;s reply on their usage:</p>
<blockquote>
<p>For reference, the completions get generated by <code>clap_complete</code> here:</p>
<p>https://github.com/MilesCranmer/rip2/blob/75ea37ef4ea16ae64809e9c50999d95fd6a809bd/src/completions.rs#L24</p>
<p>I <em>think</em> I&#x27;m specifying subcommands correctly here:</p>
<p>https://github.com/MilesCranmer/rip2/blob/75ea37ef4ea16ae64809e9c50999d95fd6a809bd/src/args.rs#L114</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-06-26 13:23</div>
            <div class="timeline-body"><p>Not knowing rip2, could you give an example of like</p>
<blockquote>
<p>Try completing</p>
<pre><code>$ rip2 something\t
</code></pre>
<p>Expected completions:</p>
<p>Actual completions:</p>
</blockquote>
<p>If I&#x27;m understanding correctly, it sounds like <code>rip2</code> takes subcommands <em>xor</em> positional arguments and the <code>-f</code> on subcommands is preventing the completion of the positional arguments and hoping a further elaboration like above can clarify the problem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-completion</span> added by <a href="https://github.com/epage">@epage</a> on 2024-06-26 13:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/maddawik">@maddawik</a> on 2024-06-26 18:01</div>
            <div class="timeline-body"><p>Here&#x27;s an example of the issue:</p>
<pre><code>touch great.sh
rip gr\t
</code></pre>
<p>Expected completions:</p>
<pre><code>great.sh
graveyard
</code></pre>
<p>Actual completions</p>
<pre><code>graveyard
</code></pre>
<p>Hopefully this is more clear, let me know if I can provide anything further.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-medium</span> added by <a href="https://github.com/epage">@epage</a> on 2024-06-26 22:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by <a href="https://github.com/epage">@epage</a> on 2024-06-26 22:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-06-26 22:48</div>
            <div class="timeline-body"><p>Thanks!</p>
<p>To fix this, we&#x27;ll need to check whether positionals are supported in addition to subcommands.</p>
<p>We should ensure a test has this covered in a commit before making the change so that the tests get updated along the way, showing how the behavior changed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#5557</a> on 2024-06-27 21:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/epage">@epage</a> on 2024-06-28 16:42</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 20:00:12 UTC
    </footer>
</body>
</html>
