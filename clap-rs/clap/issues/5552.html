<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fish completions include --no-files on subcommands - clap-rs/clap #5552</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Fish completions include --no-files on subcommands</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/5552">#5552</a>
        opened by <a href="https://github.com/maddawik">@maddawik</a>
        on 2024-06-26 12:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/maddawik">@maddawik</a> on 2024-06-26 12:49</div>
            <div class="timeline-body"><p>Hello! I first reported this issue downstream in https://github.com/MilesCranmer/rip2. The issue is that the completions generated for fish include <code>-f</code> which prevents files from being included in completion, which in this case is not desired.</p>
<p>Original issue: https://github.com/MilesCranmer/rip2/issues/39</p>
<p>Since I'm not familiar with rust I'll just elaborate on the issue itself, here are the completions generated from rip2:</p>
<pre><code class="language-fish">complete -c rip -n &quot;__fish_use_subcommand&quot; -l graveyard -d 'Directory where deleted files rest' -r -F
complete -c rip -n &quot;__fish_use_subcommand&quot; -s d -l decompose -d 'Permanently deletes the graveyard'
complete -c rip -n &quot;__fish_use_subcommand&quot; -s s -l seance -d 'Prints files that were deleted in the current directory'
complete -c rip -n &quot;__fish_use_subcommand&quot; -s u -l unbury -d 'Restore the specified files or the last file if none are specified'
complete -c rip -n &quot;__fish_use_subcommand&quot; -s i -l inspect -d 'Print some info about TARGET before burying'
complete -c rip -n &quot;__fish_use_subcommand&quot; -s h -l help -d 'Print help'
complete -c rip -n &quot;__fish_use_subcommand&quot; -s V -l version -d 'Print version'
complete -c rip -n &quot;__fish_use_subcommand&quot; -f -a &quot;completions&quot; -d 'Generate shell completions file'
complete -c rip -n &quot;__fish_use_subcommand&quot; -f -a &quot;graveyard&quot; -d 'Print the graveyard path'
complete -c rip -n &quot;__fish_use_subcommand&quot; -f -a &quot;help&quot; -d 'Print this message or the help of the given subcommand(s)'
complete -c rip -n &quot;__fish_seen_subcommand_from completions&quot; -s h -l help -d 'Print help'
complete -c rip -n &quot;__fish_seen_subcommand_from graveyard&quot; -s s -l seance -d 'Get the graveyard subdirectory of the current directory'
complete -c rip -n &quot;__fish_seen_subcommand_from graveyard&quot; -s h -l help -d 'Print help'
complete -c rip -n &quot;__fish_seen_subcommand_from help; and not __fish_seen_subcommand_from completions; and not __fish_seen_subcommand_from graveyard; and not __fish_seen_subcommand_from help&quot; -f -a &quot;completions&quot; -d 'Generate shell completions file'
complete -c rip -n &quot;__fish_seen_subcommand_from help; and not __fish_seen_subcommand_from completions; and not __fish_seen_subcommand_from graveyard; and not __fish_seen_subcommand_from help&quot; -f -a &quot;graveyard&quot; -d 'Print the graveyard path'
complete -c rip -n &quot;__fish_seen_subcommand_from help; and not __fish_seen_subcommand_from completions; and not __fish_seen_subcommand_from graveyard; and not __fish_seen_subcommand_from help&quot; -f -a &quot;help&quot; -d 'Print this message or the help of the given subcommand(s)'
</code></pre>
<p>And it's these 3 that (in my testing) are the problematic <code>-f</code> flags:</p>
<pre><code class="language-fish">complete -c rip -n &quot;__fish_use_subcommand&quot; -f -a &quot;completions&quot; -d 'Generate shell completions file'
complete -c rip -n &quot;__fish_use_subcommand&quot; -f -a &quot;graveyard&quot; -d 'Print the graveyard path'
complete -c rip -n &quot;__fish_use_subcommand&quot; -f -a &quot;help&quot; -d 'Print this message or the help of the given subcommand(s)'
</code></pre>
<p>Removing those allows files to be included in completion. Here's the author's reply on their usage:</p>
<blockquote>
<p>For reference, the completions get generated by <code>clap_complete</code> here:</p>
<p>https://github.com/MilesCranmer/rip2/blob/75ea37ef4ea16ae64809e9c50999d95fd6a809bd/src/completions.rs#L24</p>
<p>I <em>think</em> I'm specifying subcommands correctly here:</p>
<p>https://github.com/MilesCranmer/rip2/blob/75ea37ef4ea16ae64809e9c50999d95fd6a809bd/src/args.rs#L114</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-06-26 13:23</div>
            <div class="timeline-body"><p>Not knowing rip2, could you give an example of like</p>
<blockquote>
<p>Try completing</p>
<pre><code class="language-console">$ rip2 something\t
</code></pre>
<p>Expected completions:</p>
<p>Actual completions:</p>
</blockquote>
<p>If I'm understanding correctly, it sounds like <code>rip2</code> takes subcommands <em>xor</em> positional arguments and the <code>-f</code> on subcommands is preventing the completion of the positional arguments and hoping a further elaboration like above can clarify the problem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-completion</span> added by @epage on 2024-06-26 13:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/maddawik">@maddawik</a> on 2024-06-26 18:01</div>
            <div class="timeline-body"><p>Here's an example of the issue:</p>
<pre><code class="language-sh">touch great.sh
rip gr\t
</code></pre>
<p>Expected completions:</p>
<pre><code class="language-sh">great.sh
graveyard
</code></pre>
<p>Actual completions</p>
<pre><code>graveyard
</code></pre>
<p>Hopefully this is more clear, let me know if I can provide anything further.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-medium</span> added by @epage on 2024-06-26 22:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @epage on 2024-06-26 22:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-06-26 22:48</div>
            <div class="timeline-body"><p>Thanks!</p>
<p>To fix this, we'll need to check whether positionals are supported in addition to subcommands.</p>
<p>We should ensure a test has this covered in a commit before making the change so that the tests get updated along the way, showing how the behavior changed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5557.html">clap-rs/clap#5557</a> on 2024-06-27 21:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2024-06-28 16:42</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:09 UTC
    </footer>
</body>
</html>
