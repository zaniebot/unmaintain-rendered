<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive prompts - clap-rs/clap #1471</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Interactive prompts</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/1471">#1471</a>
        opened by <a href="https://github.com/bedax">@bedax</a>
        on 2019-05-13 18:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/bedax">@bedax</a> on 2019-05-13 18:42</div>
            <div class="timeline-body"><p>Hello, I have a small command line program which I always forget the options for and have to use --help for every time. After looking at darcs recently it occurred to me that it would be nice to get a series of prompts when clap can't parse the input.</p>
<p>For example, let's say I'm writing a simple <code>log</code> program, with the following usage:</p>
<pre><code>USAGE:
   log [OPTIONS] &lt;message&gt;


FLAGS:
   -o, --overwrite
      Overwrite the output file before writing


OPTIONS:
   -p, --path &lt;path&gt;
      The path to the logs file, defaults to `~/.logs`
      
   -l, --level &lt;level&gt;
      The record's log level


ARGS:
   &lt;message&gt; 
      The message to log
</code></pre>
<p>If I type <code>log</code> with no arguments, it would be good to be given something like the following:</p>
<pre><code>USAGE: log [OPTIONS] &lt;message&gt;

[y/N] Overwrite the output file before writing
&gt; y

[optional] The path to the log file, defaults to `~/.logs` 
&gt; ~/.some-other-file

[optional] The record's log level 
&gt; info

[required] The message to log 
&gt; something happened
</code></pre>
<p>I realise this whole feature isn't necessarily something you want baked into the core, perhaps an external crate, perhaps a feature. Either way, I'm happy to write this, but I'm not sure how best to tap into the parser.</p>
<p>I think it would be useful if clap::App had a <code>get_matches_from_fns</code> function with a signature like this</p>
<pre><code>struct CommandDescription&lt;'a&gt; {
   name: &amp;'a str,
   help: &amp;'a str
}

struct ArgumentDescription&lt;'a&gt; {
   short: &amp;'a str,
   long: &amp;'a str,
   help: &amp;'a str
}

impl clap::App {
   fn get_matches_from_fns&lt;T: Into&lt;OsString&gt; + Clone&gt;
                          (command_getter: impl Fn(CommandDescription) -&gt; T,
                           flag_getter: impl Fn(ArgumentDescription) -&gt; bool,
                           option_getter: impl Fn(ArgumentDescription) -&gt; Option&lt;T&gt;,
                           argument_getter: impl Fn(ArgumentDescription) -&gt; T) 
                           -&gt; ArgMatches ...
}
</code></pre>
<p>Then those getters would in this case prompt the user for the input</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danieleades">@danieleades</a> on 2020-01-10 18:24</div>
            <div class="timeline-body"><p>this would be amazing.</p>
<p>If this isn't desired for the core library, are there any hooks that would allow one to implement outside the library?</p>
<p>i see that some work was already done in  #235. Looks like this was mostly complete, but there some questions about it being a blocking API.</p>
<p>I can imagine some use cases where this would be a problem, but I can imagine a lot more where it's a non-issue.</p>
<ul>
<li>small command line programs which do one thing and then exit</li>
<li>long-running programs that need to block on certain parameters until they can run anyway</li>
<li>Command line clients to other programs</li>
</ul>
<p>non-blocking APIs smells like a complete rewrite of the library to me (everything async, blocking api which wraps the async behind a feature flag).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1634.html">clap-rs/clap#1634</a> on 2020-01-10 20:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danieleades">@danieleades</a> on 2020-01-11 13:25</div>
            <div class="timeline-body"><p>could this be resolved by simply adding a hook to set a default using a closure?</p>
<p>something like</p>
<pre><code>Arg::default_with&lt;F, S&gt;(mut self, fun: F) -&gt; Self
    where
    F: FnOnce -&gt; S,
    S: AsRef&lt;str&gt;,
</code></pre>
<p>then passing your prompt function into this method.</p>
<p>I'm not too familiar with this codebase, does this sound like a reasonable solution? @kbknapp</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danieleades">@danieleades</a> on 2020-01-11 13:33</div>
            <div class="timeline-body"><p>i guess <code>default_with</code> wouldn't be compatible with <code>default_value</code>, so the default value field would become an enum, containing either the closure, or the value.</p>
<p>for symmetry, you'd have to do something similar for the other corresponding methods</p>
<p>| value method | closure method |
|-------|----------|
| default_value | default_with |
| default_value_os | default_with_os |
| default_values | defaults_with |</p>
<p>How are conflicting arguments handled elsewhere in Clap? should it be an enum, such that if you use both methods, the second one clobbers the first? or should they be separate fields with a <code>debug_assert</code> to check they're not both set?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danieleades">@danieleades</a> on 2020-01-11 13:53</div>
            <div class="timeline-body"><p>you would also want a <code>default_with_if</code>- so you could have patterns like</p>
<p><code>arg.default_with_if(&quot;interactive&quot;, prompt_user)</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-01-18 10:10</div>
            <div class="timeline-body"><p>I have worked on https://github.com/termapps/enquirer this week. Either a hook fn or a matches fn, this library can easily provide them. IMO, the prompts shouldn't be in the core. Hooks? yes but not prompts.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-01 13:50</div>
            <div class="timeline-body"><p>Closing in favor of #1634 , they are about the same thing anyway</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @CreepySkeleton on 2020-02-01 13:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: duplicate</span> added by @pksunkara on 2020-02-01 19:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/572.html">clap-rs/clap#572</a> on 2020-04-09 06:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1910.html">clap-rs/clap#1910</a> on 2020-05-06 15:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/132.html">epage/clapng#132</a> on 2021-12-06 18:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/157.html">epage/clapng#157</a> on 2021-12-06 20:15</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:07 UTC
    </footer>
</body>
</html>
