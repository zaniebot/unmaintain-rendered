```yaml
number: 1478
title: "Macros aren't imported properly in Rust 2018"
type: issue
state: closed
author: jacob-greenfield
labels:
  - C-bug
  - E-help-wanted
assignees: []
created_at: 2019-05-26T06:21:17Z
updated_at: 2020-02-02T10:49:15Z
url: https://github.com/clap-rs/clap/issues/1478
synced_at: 2026-01-10T01:57:43Z
```

# Macros aren't imported properly in Rust 2018

---

_Issue opened by @jacob-greenfield on 2019-05-26 06:21_

<!--
Please use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`
-->

### Rust Version

`rustc 1.35.0 (3c235d560 2019-05-20)`

### Affected Version of clap

`2.33.0`

### Bug or Feature Request Summary

Macros such as `app_from_crate!()` which rely on other custom macros do not do so properly (using `$crate`) in many cases, meaning that all dependent macros must also be individually imported with `use`.

### Expected Behavior Summary

For example:

```rust
macro_rules! app_from_crate {
    () => {
        $crate::App::new(crate_name!())
            .version($crate::crate_version!())
            .author($crate::crate_authors!())
            .about($crate::crate_description!())
    };
    ($sep:expr) => {
        $crate::App::new($crate::crate_name!())
            .version($crate::crate_version!())
            .author($crate::crate_authors!($sep))
            .about($crate::crate_description!())
    };
}
```

### Actual Behavior Summary

Current implementation:

https://github.com/clap-rs/clap/blob/784524f7eb193e35f81082cc69454c8c21b948f7/src/macros.rs#L559-L572

### Steps to Reproduce the issue

`src/main.rs`:

```rust
use clap::app_from_crate;

fn main() {
    let matches = app_from_crate!().get_matches();
}
```

Output:

```
error: cannot find macro `crate_name!` in this scope
 --> src/main.rs:4:19
  |
4 |     let matches = app_from_crate!().get_matches();
  |                   ^^^^^^^^^^^^^^^^^
  |
  = note: this error originates in a macro outside of the current crate (in Nightly builds, run with -Z external-macro-backtrace for more info)

error: cannot find macro `crate_version!` in this scope
 --> src/main.rs:4:19
  |
4 |     let matches = app_from_crate!().get_matches();
  |                   ^^^^^^^^^^^^^^^^^
  |
  = note: this error originates in a macro outside of the current crate (in Nightly builds, run with -Z external-macro-backtrace for more info)

error: cannot find macro `crate_authors!` in this scope
 --> src/main.rs:4:19
  |
4 |     let matches = app_from_crate!().get_matches();
  |                   ^^^^^^^^^^^^^^^^^
  |
  = note: this error originates in a macro outside of the current crate (in Nightly builds, run with -Z external-macro-backtrace for more info)

error: cannot find macro `crate_description!` in this scope
 --> src/main.rs:4:19
  |
4 |     let matches = app_from_crate!().get_matches();
  |                   ^^^^^^^^^^^^^^^^^
  |
  = note: this error originates in a macro outside of the current crate (in Nightly builds, run with -Z external-macro-backtrace for more info)

error: aborting due to 4 previous errors
```

### Sample Code or Link to Sample Code

N/A

### Debug output

N/A

---

_Referenced in [clap-rs/clap#1528](../../clap-rs/clap/pulls/1528.md) on 2019-07-29 02:23_

---

_Label `C: macros` added by @CreepySkeleton on 2020-02-01 13:39_

---

_Label `help wanted` added by @CreepySkeleton on 2020-02-01 13:39_

---

_Label `P3: want to have` added by @CreepySkeleton on 2020-02-01 13:39_

---

_Label `T: bug` added by @CreepySkeleton on 2020-02-01 13:39_

---

_Added to milestone `3.0` by @CreepySkeleton on 2020-02-01 13:39_

---

_Referenced in [clap-rs/clap#1349](../../clap-rs/clap/issues/1349.md) on 2020-02-02 05:08_

---

_Comment by @pksunkara on 2020-02-02 08:34_

This has been fixed in master and the minimum rust version is 1.36. I have added https://github.com/clap-rs/clap/pull/1656 to test it. We won't be backporting it to v2.

---

_Closed by @bors[bot] on 2020-02-02 10:49_

---
