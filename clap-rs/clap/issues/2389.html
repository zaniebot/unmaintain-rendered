<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clap derive should parse markdown doc comment into normal text - clap-rs/clap #2389</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Clap derive should parse markdown doc comment into normal text</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/2389">#2389</a>
        opened by <a href="https://github.com/ducaale">@ducaale</a>
        on 2021-03-06 20:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ducaale">@ducaale</a></div>
            <div class="timeline-body"><p>Maintainer's notes:</p>
<ul>
<li>Workaround: <code>verbatim_doc_comment</code> attribute</li>
<li><code>unstable-markdown</code> feature is being tracked in #5900</li>
</ul>
<hr />
<h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.48.0 (7eac88abb 2020-11-16)</p>
<h3>Clap Version</h3>
<p>3.0.0-beta.2</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">use clap::Clap;

#[derive(Clap, Debug)]
#[clap(name = &quot;xh&quot;)]
struct Cli {
    /// Optional key-value pairs to be included in the request.
    ///
    /// - key:=value to add a complex JSON value (e.g. `numbers:=[1,2,3]`)
    /// - key@filename to upload a file from filename (with --form)
    /// - header:value to add a header
    /// - header: to unset a header
    /// - header; to add a header with an empty value
    ///
    /// A backslash can be used to escape special characters (e.g. weird\:key=value).
    #[clap(value_name = &quot;REQUEST_ITEM&quot;)]
    raw_rest_args: Vec&lt;String&gt;
}

fn main() {
      let _ = Cli::parse();
}
</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<pre><code>cargo run -- --help
</code></pre>
<h3>Actual Behaviour</h3>
<pre><code>ARGS:
    &lt;REQUEST_ITEM&gt;...
            Optional key-value pairs to be included in the request.

            * key==value to add a parameter to the URL \n * key=value to add a JSON field (--json)
            or form field (--form) * key:=value to add a complex JSON value (e.g.
            `numbers:=[1,2,3]`) * key@filename to upload a file from filename (with --form) *
            header:value to add a header * header: to unset a header * header; to add a header with
            an empty value

            A backslash can be used to escape special characters (e.g. weird\:key=value).
</code></pre>
<h3>Expected Behaviour</h3>
<pre><code>ARGS:
    &lt;REQUEST_ITEM&gt;...
            Optional key-value pairs to be included in the request.

            * key==value to add a parameter to the URL
            * key=value to add a JSON field (--json) or form field (--form)
            * key:=value to add a complex JSON value (e.g. `numbers:=[1,2,3]`)
            * key@filename to upload a file from filename (with --form)
            * header:value to add a header
            * header: to unset a header
            * header; to add a header with an empty value

            A backslash can be used to escape special characters (e.g. weird\:key=value).
</code></pre>
<h3>Additional Context</h3>
<p>In StructOpt, it possible to use the <code>long_help</code> attribute to preserve newlines but ~~I couldn't find something similar in clap-derive~~.</p>
<p>Just found that it is called <code>long_about</code> in clap-derive.</p>
<h3>Debug Output</h3>
<p>Will add if requested</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @ducaale on 2021-03-06 20:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: derive macros</span> added by @pksunkara on 2021-03-06 20:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by @pksunkara on 2021-03-06 20:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">:money_with_wings: $5</span> added by @pksunkara on 2021-03-06 20:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @pksunkara on 2021-03-06 20:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2401.html">clap-rs/clap#2401</a> on 2021-03-09 19:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">:money_with_wings: $5</span> removed by @pksunkara on 2021-04-06 08:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> removed by @pksunkara on 2021-04-06 08:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-04-06 08:49</div>
            <div class="timeline-body"><p>There is quite a bit of discussion in #2401</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.0" by @pksunkara on 2021-04-23 09:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @pksunkara on 2021-04-23 09:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Preserve newlines in Doc comments" to "Clap derive should parse markdown doc comment into normal text" by @pksunkara on 2021-11-14 00:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3019.html">clap-rs/clap#3019</a> on 2021-11-14 00:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../ouch-org/ouch/pulls/196.html">ouch-org/ouch#196</a> on 2021-11-14 01:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/181.html">epage/clapng#181</a> on 2021-12-06 21:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3122.html">clap-rs/clap#3122</a> on 2021-12-10 01:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.1" by @epage on 2021-12-13 16:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> added by @epage on 2021-12-13 16:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-13 16:33</div>
            <div class="timeline-body"><p>One of the challenges with this is we'd basically need to pull in pulldown-cmark which is quite a large dependency.  This would need to be put behind a feature flag.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ducaale">@ducaale</a> on 2021-12-13 16:53</div>
            <div class="timeline-body"><p>My main goal was to preserve newlines in the doc comment and that should be achievable with the <code>verbatim_doc_comment</code> attribute.</p>
<h4>Example</h4>
<pre><code class="language-rust">// clap = { version = &quot;3.0.0-rc.4&quot;, features = [&quot;derive&quot;] }

use clap::Parser;

#[derive(Parser, Debug)]
#[clap(name = &quot;xh&quot;)]
struct Cli {
    /// Optional key-value pairs to be included in the request.
    ///
    ///   ‚Ä¢ key:=value to add a complex JSON value (e.g. `numbers:=[1,2,3]`)
    ///   ‚Ä¢ key@filename to upload a file from filename (with --form)
    ///   ‚Ä¢ header:value to add a header
    ///   ‚Ä¢ header: to unset a header
    ///   ‚Ä¢ header; to add a header with an empty value
    ///
    /// A backslash can be used to escape special characters (e.g. weird\:key=value).
    #[clap(value_name = &quot;REQUEST_ITEM&quot;, verbatim_doc_comment)]
    raw_rest_args: Vec&lt;String&gt;,
}

fn main() {
    let _ = Cli::parse();
}

</code></pre>
<h4>Output</h4>
<pre><code>USAGE:
    temp-clap [REQUEST_ITEM]...

ARGS:
    &lt;REQUEST_ITEM&gt;...
            Optional key-value pairs to be included in the request.

              ‚Ä¢ key:=value to add a complex JSON value (e.g. `numbers:=[1,2,3]`)
              ‚Ä¢ key@filename to upload a file from filename (with --form)
              ‚Ä¢ header:value to add a header
              ‚Ä¢ header: to unset a header
              ‚Ä¢ header; to add a header with an empty value

            A backslash can be used to escape special characters (e.g. weird\:key=value).

OPTIONS:
    -h, --help
            Print help information
</code></pre>
<p>I wouldn't mind if this issue was to be closed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-13 17:03</div>
            <div class="timeline-body"><p>I think its still an interesting topic for us to weigh out.  I did call out the workaround in the issue so its more discoverable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3198.html">clap-rs/clap#3198</a> on 2021-12-18 18:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3228.html">clap-rs/clap#3228</a> on 2021-12-28 04:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/I60R">@I60R</a> on 2021-12-29 02:51</div>
            <div class="timeline-body"><p>We may need only a subset of markdown features in CLI parser:</p>
<ul>
<li>newline escaping (implemented in #3228)</li>
<li>lists as suggested here (should be relatively easy to implement, even with nesting)</li>
<li>bold, italic, bold-italic, inline code - if colors enabled (not sure whether it's worth effort, but why not?)</li>
<li>fenced code blocks (without syntax highlighting, of course)</li>
</ul>
<p>There also could be some mechanism to cut off help message from doc comment as @epage suggested <a href="https://github.com/clap-rs/clap/issues/3198#issuecomment-1002154924">here</a> ‚Äî IMO markdown headers are a perfect mechanism for that e.g.:</p>
<ul>
<li>without any header everything goes to -h --help output<ul>
<li>that's the same as if everything was placed under <code># Help</code> header</li>
</ul>
</li>
<li>if <code># Long help</code> is specified that section will be appended to --help output (only)</li>
<li>we may also have <code># Manpage</code> section (if clap will provide some mechanism for manpage generation)</li>
<li>text under all other headers will be ignored by clap</li>
</ul>
<hr />
<p>I think this subset should satisfy 99.9% of all use cases of clap, everyone should like it, and it doesn't seem to be so complicated to require pulldown-cmark or any other heavy dependency.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-29 16:23</div>
            <div class="timeline-body"><p>My experience writing one off parsers has made me a bit cautious of doing so.  I threw together some <a href="https://github.com/epage/md-benchmarks-rs">md parser benchmarks</a> to see what might be small enough for being an optional dependency.  <code>minimad</code> looks tempting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-30 12:32</div>
            <div class="timeline-body"><p>Another thought on markdown support, should we support it at runtime, compile time, or both?</p>
<p>The core of this Issue is our line breaks which is a problem exclusive to the derive API.  For that, we could build markdown parsing directly into <code>clap_derive</code>.</p>
<p>Another step up is markdown formatting.  For that, we'd want to expose it to both APIs.  Say we generalized our <code>Colorizer</code> struct and accepted it for all our user-facing inputs (for #1790, #1433), users can do whatever styling they want, though it might be a bit arduous.  We then provided a markdown-parsing macro that would code-generate <code>Colorizer</code>.  <code>clap_derive</code> would then have this built-in for all doc comments.</p>
<p>The main benefit of this is that this would remove the binary-size overhead of the markdown parser.  We'd still need to compile it (though it'd be optional).  Though this would mean we wouldn't regress in <code>--help</code> and error performance by introducing markdown, the performance would have to be pretty bad for us to care.</p>
<p>This has the added benefit that we wouldn't need yet-another Setting in the API for doing controlling this at runtime.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-30 12:34</div>
            <div class="timeline-body"><p>Another question for us to answer in this issue is how disruptive would markdown parsing be.   While <code>--help</code>s output is not considered &quot;stable&quot;, we shouldn't dramatically alter users crafting of their help output.  To what degree of markdown parsing can we add in a patch, a feature release, or a breaking release?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3230.html">clap-rs/clap#3230</a> on 2021-12-30 17:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3231.html">clap-rs/clap#3231</a> on 2021-12-30 17:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gibfahn">@gibfahn</a> on 2021-12-30 19:38</div>
            <div class="timeline-body"><blockquote>
<p>Another thought on markdown support, should we support it at runtime, compile time, or both?</p>
</blockquote>
<p>Compile time only sounds reasonable to me (but I only use the derive API, so I guess I would say that üòÅ) .</p>
<blockquote>
<p>Another question for us to answer in this issue is how disruptive would markdown parsing be.</p>
</blockquote>
<p>I <em>think</em> that (as a user) if markdown parsing were turned on for existing help text that would probably break a bunch of people, but if it was behind a flag, or minor updates to the markdown output were later made in minor/patch updates, that would probably be fine, as what was intended to be output would still be there, just maybe looking slightly prettier.</p>
<blockquote>
<p>The core of this Issue is our line breaks which is a problem exclusive to the derive API. For that, we could build markdown parsing directly into clap_derive.</p>
</blockquote>
<p>For what it's worth there are a bunch of other things I would use if we had markdown support, not least:</p>
<ol>
<li><em>Italic</em> and <strong>bold</strong> <code>inline code</code></li>
<li>Subheadings and code blocks, e.g.:<pre><code class="language-markdown">## EXAMPLES: &lt;!-- Should be highlighted yellow the same way the other sections in the generated help like USAGE: are today. --&gt;

&lt;!-- Syntax highlighting in examples would be really neat. --&gt;
```console
# Run the subcommand with the arg specified.
‚ùØ my-command my-subcommand --my-arg
```
</code></pre>
</li>
<li>docs.rs compatibility -&gt; If you have a binary/library combo that takes a set of options, it's nice to be able to use the same documentation for docs.rs and for <code>mycmd --help</code>.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-30 20:36</div>
            <div class="timeline-body"><blockquote>
<p><code>&lt;!-- Syntax highlighting in examples would be really neat. --&gt;</code></p>
</blockquote>
<p>I was hoping someone wasn't going to say that :)</p>
<p>syntect is the main go-to for syntax highlighting.    It can be a bit slow to compile and big.  It can be made optional.    Looks like we can also disable the built-in language / theme set.  I doubt we need all of them.  The question is what languages do we need at minimum and how should we respond <em>if</em> someone asks for another language.</p>
<p>We'll need to do some analysis to decide how worth it this is vs <a href="https://github.com/clap-rs/clap/issues/2914">generating help at build-time</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3234.html">clap-rs/clap#3234</a> on 2021-12-31 12:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../NNPDF/pineappl/issues/89.html">NNPDF/pineappl#89</a> on 2022-01-07 17:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1695.html">clap-rs/clap#1695</a> on 2022-01-20 15:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3108.html">clap-rs/clap#3108</a> on 2022-01-20 21:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4110.html">clap-rs/clap#4110</a> on 2022-08-24 15:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4114.html">clap-rs/clap#4114</a> on 2022-08-25 18:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4132.html">clap-rs/clap#4132</a> on 2022-08-27 02:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4444.html">clap-rs/clap#4444</a> on 2022-11-02 22:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-07-17 13:22</div>
            <div class="timeline-body"><p>One design problem I've been running into is how to render markdown at compile time when the colors aren't known until runtime.</p>
<p>I think the way to do this is to allow a <code>fn(fmt, palette) -&gt; fmt::Result</code> to be passed into <code>StyledStr</code> and the derive would generate this, parsing the markdown at compile time but rendering the styles at runtime.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> removed by @epage on 2023-07-18 01:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-medium</span> added by @epage on 2023-07-18 01:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-blocked</span> added by @epage on 2023-07-18 01:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5053.html">clap-rs/clap#5053</a> on 2023-07-30 05:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5144.html">clap-rs/clap#5144</a> on 2023-09-27 15:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5196.html">clap-rs/clap#5196</a> on 2023-11-06 19:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../rust-lang/rust-clippy/pulls/12747.html">rust-lang/rust-clippy#12747</a> on 2024-05-06 15:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../prefix-dev/pixi/pulls/1338.html">prefix-dev/pixi#1338</a> on 2024-05-07 11:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pronebird">@pronebird</a> on 2024-07-02 20:03</div>
            <div class="timeline-body"><p>I'd only ask for italic and bold for basic formatting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../fulcrumgenomics/fqtk/pulls/45.html">fulcrumgenomics/fqtk#45</a> on 2024-07-16 20:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../oxidecomputer/oxide.rs/pulls/782.html">oxidecomputer/oxide.rs#782</a> on 2024-08-12 15:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../stellar/stellar-cli/pulls/1551.html">stellar/stellar-cli#1551</a> on 2024-09-26 20:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nrdxp">@nrdxp</a> on 2024-10-20 05:02</div>
            <div class="timeline-body"><p>In my case I just want to add a space in a list without having to add a newline between the bullets and without having to use verbatim doc comments (so wrap_help is respected properly)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5802.html">clap-rs/clap#5802</a> on 2024-11-04 18:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5803.html">clap-rs/clap#5803</a> on 2024-11-04 18:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../jj-vcs/jj/pulls/4808.html">jj-vcs/jj#4808</a> on 2024-11-09 00:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ModProg">@ModProg</a> on 2025-01-19 22:06</div>
            <div class="timeline-body"><p>Is there some specification on how this should work? Should we fully parse markdown, or should we just implement the parts that make sense, i.e., lists, bold, italic? I'm currently quite annoyed by lists not working so I'd be willing to invest some time into implementing some solution here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alerque">@alerque</a> on 2025-01-19 22:16</div>
            <div class="timeline-body"><p>How established is CommonMark in Rust docs contexts? I would suggest pulldown-cmark or, if another Markdown parser is established in Rust context whatever that is, as a full flow Markdown parser makes more sense than a &quot;whatever makes sense/minimalist&quot; approach. Markdown is notoriously hard to actually get right even if small things like emphasis or list parsing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-01-20 15:44</div>
            <div class="timeline-body"><p>Subsets of markdown were covered earlier in the thread
https://github.com/clap-rs/clap/issues/2389#issuecomment-1002370465</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ModProg">@ModProg</a> on 2025-01-20 17:19</div>
            <div class="timeline-body"><p>https://github.com/clap-rs/clap/issues/2389#issuecomment-1002673827 you also cautioned against writing a custom parser should we just use pulldown-cmark and ignore the ones we don't support?</p>
<p>Also should this be configurable, for some the mapping to ANSI is pretty clear e.g. <strong>bold</strong> or <em>italic</em> while for others it's unclear e.g. <code>code_block</code> should that set a backgroun? or keep the quotes ` ?</p>
<p>Another thing to consider would be should support be implemented for html tags like in color_print: https://docs.rs/color-print/latest/color_print/index.html#list-of-accepted-tags</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-01-20 17:27</div>
            <div class="timeline-body"><blockquote>
<p>https://github.com/clap-rs/clap/issues/2389#issuecomment-1002673827 you also cautioned against writing a custom parser should we just use pulldown-cmark and ignore the ones we don't support?</p>
</blockquote>
<p>Looking at <a href="https://github.com/epage/md-benchmarks-rs">md parser benchmarks</a>,  I would be curious about how well we could get by with minimad.</p>
<p>Details like <code>code_lock</code> would need to be figured out.  In a way, it is another form of literal.</p>
<p>It would be good to have a way for people to set colors but I would be worried about full HTML support.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ModProg">@ModProg</a> on 2025-01-20 18:18</div>
            <div class="timeline-body"><blockquote>
<p>It would be good to have a way for people to set colors but I would be worried about full HTML support.</p>
</blockquote>
<p>The only reason I mentioned <code>color_print</code> is that it is referenced in the clap docs, and it could be nice to also be able to use it inside of markdown.</p>
<p>I would agree that any block elements would be annoying to deal with, so only inline ones could work. Maybe adding some tags for all the styles definable could be useful, i.e., <code>&lt;header&gt;</code>, <code>&lt;error&gt;</code>, <code>usage</code>, ...</p>
<blockquote>
<p>Details like <code>code_block</code> would need to be figured out. In a way, it is another form of literal.</p>
</blockquote>
<p>Makes sense, though one could also add the different markdown elements to <code>Styles</code>, e.g., if someone wants to color their bold text red.</p>
<p>The other question is should mark down parsing be enabled at runtime as well? If not, the compile time parsed markdown needs to be converted like you suggested here:</p>
<blockquote>
<p>One design problem I've been running into is how to render markdown at compile time when the colors aren't known until runtime.
I think the way to do this is to allow a fn(fmt, palette) -&gt; fmt::Result to be passed into StyledStr and the derive would generate this, parsing the markdown at compile time but rendering the styles at runtime.</p>
</blockquote>
<p>Even if we support markdown parsing at runtime, one might like to move that effort to compilation where possible, but we could also just implement it for runtime first and then check if there is a relevant performance penalty end disable it if so.</p>
<p>The whole markdown feature should probably be behind a feature flag anyway.</p>
<p>Would you be in favor of building a PoC for markdown parsing to test it out?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-01-20 19:08</div>
            <div class="timeline-body"><p>I suspect we should do this all at compile time though either direction comes with its problems.</p>
<p>One combination of challenges</p>
<ul>
<li>I intentionally switched <code>StyledStr</code> to only hold ANSI escape codes</li>
<li>If we want to provide style classes like &quot;header&quot;,  the conversion of that to ANSI is only really available at runtime</li>
</ul>
<p>iirc there were more.  Feel free to play around and come back with more ideas.  I feel like I'd want things settled a little more before adding an unstable feature for this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ModProg">@ModProg</a> on 2025-01-24 14:27</div>
            <div class="timeline-body"><p>I found two issues with minimad, doesn't support lists using <code>-</code> and doesn't support multilevel list, because it thinks they are codeblocks https://github.com/Canop/minimad/issues/2.</p>
<p>While multilevel lists probably aren't as important, the list style could be quite confusing and result in unnecessary issues :D</p>
<pre><code class="language-md">- Not recognised as list
* Is a list
    * is a code block
</code></pre>
<p>results in:</p>
<pre><code class="language-rust">Text {
    lines: [
        Normal(
            Composite {
                style: Paragraph,
                compounds: [],
            },
        ),
        Normal(
            Composite {
                style: Paragraph,
                compounds: [
                    &quot;- Not recognised as list&quot;,
                ],
            },
        ),
        Normal(
            Composite {
                style: ListItem(
                    0,
                ),
                compounds: [
                    &quot;Is a list&quot;,
                ],
            },
        ),
        Normal(
            Composite {
                style: Code,
                compounds: [
                    &quot;* is a code block&quot;,
                ],
            },
        ),
    ],
}
</code></pre>
<p>I'm gonna experiment with pulldown, but shouldn't be too bad to switch that later on</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-01-24 14:31</div>
            <div class="timeline-body"><p>I wonder if they'd be open to adding more list styles.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ModProg">@ModProg</a> on 2025-01-24 14:53</div>
            <div class="timeline-body"><blockquote>
<p>I wonder if they'd be open to adding more list styles.</p>
</blockquote>
<p>Might be, but the issue was open for 4 years, and I was more interested in the other parts of this, but I think the main considerations are independent of parser and should be therefor easy enough to replace.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/passcod">@passcod</a> on 2025-01-24 18:15</div>
            <div class="timeline-body"><p>Just because I looked it up, I'll note for context that rustdoc uses pulldown-cmark, so that would be the most directly compatible.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5891.html">clap-rs/clap#5891</a> on 2025-01-24 22:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ModProg">@ModProg</a> on 2025-01-24 22:49</div>
            <div class="timeline-body"><p>Created an initial PoC https://github.com/clap-rs/clap/pull/5891</p>
<p><img src="https://github.com/user-attachments/assets/321f847b-6f33-47f8-9650-6b8d45e2dacc" alt="Image" /></p>
<p>Still some things to figure out, like should we use Unicode characters for list items? And which styles should we apply as we don't have access to the actual styles.</p>
<p>One thing I also need to fix is that <code>anstyle</code> fully resets the style when ending e.g. bold, so I need to restart italic manually.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-01-24 22:53</div>
            <div class="timeline-body"><p>I know at least Cargo is cautious on the use of unicode, auto-detecting when terminals should support it with a config to override it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ModProg">@ModProg</a> on 2025-01-25 15:55</div>
            <div class="timeline-body"><blockquote>
<p>I know at least Cargo is cautious on the use of unicode, auto-detecting when terminals should support it with a config to override it.</p>
</blockquote>
<p>As that'd be hard to do at compile time, should we only output ASCII for now? The only alternative would be to generate 2 help messages and then in the generated builder switch between them depending on Unicode capability.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ModProg">@ModProg</a> on 2025-01-26 03:12</div>
            <div class="timeline-body"><p>Short works as expected, i.e., only taking the first paragraph:</p>
<p><img src="https://github.com/user-attachments/assets/70664c24-9d8d-4e8c-a787-c698dfecf737" alt="Image" /></p>
<p>Long takes everything</p>
<p><img src="https://github.com/user-attachments/assets/ded494de-c2a3-4613-8f3e-5b2d55647f5b" alt="Image" /></p>
<p>@epage Should we also investigate using headings for separating sections and if so what would be the names? <code># Help</code> and <code># Long help</code> (probably matching any casing)?</p>
<p>Following https://github.com/clap-rs/clap/issues/2389#issuecomment-1002370465 the implementation would be as follows:</p>
<ol>
<li>if the doc comment contains no top-level heading with the content <code>help</code> (any casing) then follow regular procedure, i.e. take first paragraph as <code>help</code> and everything as <code>long_help</code>.</li>
<li>if the doc comment contains a top-level <code>help</code> heading take everything below it and use it for <code>help</code> if there is also a <code>long help</code> heading take everything below <code>help</code> and <code>long help</code> and use it for the long help.</li>
</ol>
<p>This leaves the following questions for me:</p>
<ol>
<li>What if the doc comment only contains <code># Long Help</code>?</li>
</ol>
<p>And the following alternative implementations</p>
<ol>
<li>We could instead of <code># Long Help</code> use a sub heading of <code># Help</code> called <code>## Long</code>.</li>
<li>We could (if there is no <code># Long Help</code>) apply the default parsing behavior to the content of <code># Help</code> i.e. use the first paragraph for <code>help</code> and everything for <code>long_help</code>.</li>
<li>Should we, if <code># Long Help</code> is specified only output this section as the complete text for <code>long_help</code>? This could be helpful if the short help is redundant when the <code>long_help</code> is also printed. In this case we could use <code># Long Help</code> to contain the complete <code>long_help</code> and use the <code>## Long (Help)</code> below <code># Help</code> to have the behavior of everything before <code>## Long</code> is only contained in <code>help</code> while <code>long_help</code> would contain everything in the <code># Help</code> section including <code>## Long</code>.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ModProg">@ModProg</a> on 2025-01-26 03:15</div>
            <div class="timeline-body"><p>btw there was one test where the output changed because of this, as now <code>`</code> is dropped in the output.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-01-27 16:23</div>
            <div class="timeline-body"><p>imo any handling of <code># Help</code> and <code># Long Help</code> would be a breaking change and doesn't need to be handled with improved markdown handling, so I'd recommend someone open a dedicated issue on it once we have this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ModProg">@ModProg</a> on 2025-01-27 17:31</div>
            <div class="timeline-body"><blockquote>
<p>imo any handling of <code># Help</code> and <code># Long Help</code> would be a breaking change and doesn't need to be handled with improved markdown handling, so I'd recommend someone open a dedicated issue on it once we have this.</p>
</blockquote>
<p>Agreed, solves a very different problem to simple markdown parsing as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ModProg">@ModProg</a> on 2025-01-27 23:55</div>
            <div class="timeline-body"><p>@epage I did document the styling in the PR-description (#5891). Feel free to expand on it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2025-02-03 21:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-02-03 22:38</div>
            <div class="timeline-body"><p>See #5900 for the tracking issue</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:47:51 UTC
    </footer>
</body>
</html>
