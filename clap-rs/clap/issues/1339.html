<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>clap allows required arguments to be omitted if there's a default set - clap-rs/clap #1339</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>clap allows required arguments to be omitted if there&#x27;s a default set</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1339">#1339</a>
        opened by <a href="https://github.com/richardjharris">@richardjharris</a>
        on 2018-09-07 16:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/richardjharris">@richardjharris</a></div>
            <div class="timeline-body">Rust Version
<p><code>rustc 1.30.0-nightly (6e0f1cc15 2018-09-05)</code></p>
Affected Version of clap
<p><code>&quot;checksum clap 2.32.0 (registry+https://github.com/rust-lang/crates.io-index)&quot; = &quot;b957d88f4b6a63b9d70d5f454ac8011819c6efa7727858f458ab71c756ce2d3e&quot;</code></p>
Bug or Feature Request Summary
<p>I have an arg <code>-f</code> which defaults to &quot;1&quot; but can be overriden. Clap allows the user to invoke <code>myscript -f</code> without any error (it is set to the default value 1).</p>
<pre><code>.arg(Arg::with_name(&quot;fields&quot;)
            .short(&quot;f&quot;)
            .long(&quot;fields&quot;)
            .alias(&quot;field&quot;)
            .empty_values(false)
            .number_of_values(1)
            .default_value(&quot;1&quot;)
</code></pre>
Expected Behavior Summary
<p>I only want the default of &#x27;1&#x27; if the option is omitted entirely. If the user specifies <code>-f</code> then they are intending to override this default, so if there&#x27;s nothing after it, it&#x27;s probably a mistake.</p>
<p>However I can&#x27;t get clap to do this, even with options like <code>number_of_values(1)</code>. The workaround is of course to move the default into <code>unwrap_or(&quot;1&quot;)</code> and manually update the help text.</p>
<p>Not a big deal but if there an option that does want I want, I&#x27;d appreciate the tip!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mertzt89">@mertzt89</a> on 2018-09-12 21:49</div>
            <div class="timeline-body"><p>The phrasing &quot;I only want the default of &#x27;1&#x27; if the option is omitted entirely&quot; indicates to me that the argument is not intended to be required. Are you wanting the following behavior?</p>
<pre><code>extern crate clap; // 2.32.0

use clap::{App, Arg};

fn main() {
    let args = App::new(&quot;Test Program&quot;).arg(
        Arg::with_name(&quot;fields&quot;)
            .short(&quot;f&quot;)
            .long(&quot;fields&quot;)
            .default_value(&quot;1&quot;)
            .takes_value(true),
    ).get_matches();

    println!(&quot;Value is {}&quot;, args.value_of(&quot;fields&quot;).unwrap());
}
</code></pre>
<p>$ cargo run -- -f 3
Value is 3</p>
<p>$ cargo run
Value is 1</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/richardjharris">@richardjharris</a> on 2018-09-12 22:20</div>
            <div class="timeline-body"><p>Hi, thank you for the example. That is what I would like except that <code>cargo run -- -f</code> should return an error.</p>
<p>My motivation is that (in the UNIX world at least) switches which may or may not take an argument are uncommon and confusing (as they can swallow up other arguments). In my case <code>-f</code> is a field number. A user typing <code>-f</code> without specifying the field number may have mistaken it for some other flag or simply forgotten to type the number. Typing <code>--fields</code> without an argument makes no sense, but I still want to default to <code>--fields 1</code> if the switch is missing.</p>
<p>I suspect the answer to this is to use <code>args.value_of(&quot;fields&quot;).unwrap_or(1)</code> and manually add <code>[default: 1]</code> to the option&#x27;s help/long_help. If there is a way to do it that&#x27;s built into clap though, that would be great :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mertzt89">@mertzt89</a> on 2018-09-12 22:25</div>
            <div class="timeline-body"><p>Ah yes, I see the problem now.</p>
<p>With the same code as above:</p>
<pre><code>$ cargo run -- -f
Value is 1

$ cargo run -- --fields
Value is 1
</code></pre>
<p>I agree that I would expect there to be a parsing error especially if <code>.takes_value(true)</code> is present.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mertzt89">@mertzt89</a> on 2018-09-13 00:19</div>
            <div class="timeline-body"><p>Looks like this might be a duplicate of #984</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#984</a> on 2019-11-28 20:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-02 05:23</div>
            <div class="timeline-body"><p>Duplicate of #984</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-02 05:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: duplicate</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-02-02 06:17</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:57:14 UTC
    </footer>
</body>
</html>
