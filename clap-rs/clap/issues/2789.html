<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cannot override the help subcommand - clap-rs/clap #2789</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Cannot override the help subcommand</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/2789">#2789</a>
        opened by <a href="https://github.com/jonathanmorley">@jonathanmorley</a>
        on 2021-09-24 17:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jonathanmorley">@jonathanmorley</a></div>
            <div class="timeline-body">Please complete the following tasks
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
Rust Version
<p>1.54.0</p>
Clap Version
<p>master</p>
Minimal reproducible code
<pre><code>
use clap::Clap;

#[derive(Clap)]
#[clap(
    global_setting = AppSettings::DisableHelpSubcommand
)]
enum Helper {
    Help {
        arg: String
    },
    NotHelp {
        arg: String
    }
}

impl Helper {
    fn handle(&amp;self) -&gt; String {
        match self {
            Helper::Help { arg } =&gt; format!(&quot;Helping {}&quot;, arg),
            Helper::NotHelp { arg } =&gt; format!(&quot;Not Helping {}&quot;, arg)
        }
    }
}

fn main() {
    // Test with a subcommand that is not `help`.
    let command = Helper::parse_from([&quot;help_cmd&quot;, &quot;not-help&quot;, &quot;foo&quot;]).handle();
    assert_eq!(command, &quot;Not Helping foo&quot;);

    // Test with the `help` subcommand.
    let command = Helper::parse_from([&quot;help_cmd&quot;, &quot;help&quot;, &quot;foo&quot;]).handle();
    assert_eq!(command, &quot;Helping foo&quot;);
}
</code></pre>
Steps to reproduce the bug with the above code
<p>cargo run</p>
Actual Behaviour
<p>The second assertion fails, and outputs a help message for the builtin Help subcommand:</p>
<pre><code>error:  The subcommand &#x27;foo&#x27; wasn&#x27;t recognized

USAGE:
    help_cmd &lt;subcommands&gt;

For more information try --help
</code></pre>
Expected Behaviour
<p>The tests should pass</p>
Additional Context
<p>https://github.com/clap-rs/clap/pull/2788</p>
Debug Output
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by <a href="https://github.com/jonathanmorley">@jonathanmorley</a> on 2021-09-24 17:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#2788</a> on 2021-09-24 17:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: subcommands</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-09-24 19:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-09-24 19:28</div>
            <div class="timeline-body"><blockquote>
<p>outputs a help message for the builtin Help subcommand:</p>
</blockquote>
<p>That is wrong. You are seeing an error. What&#x27;s happening is that our parser is treating <code>help</code> as a command with subcommands during parsing instead of looking at what the user gave.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: settings</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-09-24 19:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">:money_with_wings: $10</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-09-24 19:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-09-24 19:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: parsing</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-09-24 19:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#2796</a> on 2021-09-28 01:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2021-10-02 01:03</div>
            <div class="timeline-body"><p>I think what&#x27;s happening here is that <code>DisableHelpSubcommand</code> only keeps <code>clap</code> from <em>creating</em> a <code>help</code> subcommand. However, in the example code, a <code>help</code> subcommand is created by the user. And since a help subcommand exists, clap uses it as if it, itself, had created the help subcommand. This is more why I created <code>NoAutoHelp</code>. Although I can see how these two settings are confusing and either need to be re-named, or have better docs explaining what they&#x27;re for and how they&#x27;re used.</p>
<p>It could also be argued this is a bug where if the user says to disable the help command, clap could <em>also</em> not try to parse one.</p>
<p>I think the original intention was if a user wanted to create their own <code>help</code> subcommand details (i.e. about message, etc.) but still wanted clap to do all the normal parsing. There previously wasn&#x27;t a way for someone to tell clap, &quot;Don&#x27;t build the help subcommand because I&#x27;ll do that for you....but yeah go ahead and use it like normal.&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2021-10-02 01:07</div>
            <div class="timeline-body"><blockquote>
<p>I think what&#x27;s happening here is that DisableHelpSubcommand only keeps clap from creating a help subcommand. However, in the example code, a help subcommand is created by the user. And since a help subcommand exists, clap uses it as if it, itself, had created the help subcommand.</p>
</blockquote>
<p>To expand and clarify a little; when clap detects a <code>help</code> subcommand, the next argument(s) must also be subcommands, because clap will then display the help message of <em>those</em> subcommands. What&#x27;s happening in the example code is <code>foo</code> is not a subcommand, but clap expected one because thats how the normal <code>help</code> subcommand works.</p>
<p>I.e. using a fictional <code>git</code> CLI as an example:</p>
<pre><code># To get the `--help` of `git push`
$ git push --help

# OR clap allows
$ git help push
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-10-04 14:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>mrswastik-robot/pixi#2</a> on 2025-07-03 09:20</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:58:19 UTC
    </footer>
</body>
</html>
