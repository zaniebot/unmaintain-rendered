<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>write_help / write_long_help do not respect Command color settings - clap-rs/clap #3480</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>write_help / write_long_help do not respect Command color settings</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/3480">#3480</a>
        opened by <a href="https://github.com/nicklan">@nicklan</a>
        on 2022-02-16 23:04
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/nicklan">@nicklan</a> on 2022-02-16 23:04</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.58.1 (db9d1b20b 2022-01-20)</p>
<h3>Clap Version</h3>
<p>3.1.0</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">use std::io;
use clap::{Command, ColorChoice};

fn main() {
    let mut cmd = Command::new(&quot;myprog&quot;).color(ColorChoice::Always);

    println!(&quot;This prints color\n&quot;);
    cmd.print_help().unwrap();


    println!(&quot;\n\nThis doesn't\n&quot;);
    let mut out = io::stdout();
    cmd.write_help(&amp;mut out).expect(&quot;failed to write to stdout&quot;);
}
</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<p>Just run it and see that the first prints color, but the second does not</p>
<h3>Actual Behaviour</h3>
<p>No color, even though Color.Always is set</p>
<h3>Expected Behaviour</h3>
<p>Should print color</p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
<h3>Debug Output</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @nicklan on 2022-02-16 23:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "write_help / write_long_help do not respect Command color settings" to "`write_help` / `write_long_help` do not respect Command color settings" by @nicklan on 2022-02-16 23:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`write_help` / `write_long_help` do not respect Command color settings" to "write_help / write_long_help do not respect Command color settings" by @nicklan on 2022-02-16 23:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-help</span> added by @epage on 2022-02-16 23:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-wont-fix</span> added by @epage on 2022-02-16 23:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-02-16 23:43</div>
            <div class="timeline-body"><p>This is expected because we <code>Auto</code> won't be able to detect whether we should print colors, so we print everything unstyled.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nicklan">@nicklan</a> on 2022-02-17 19:58</div>
            <div class="timeline-body"><p>Okay, but I set <code>ColorChoice::Always</code>.</p>
<p>In general it would be nice for an application to be able to render colored help to something other than <code>stdout</code>, which isn't possible today.</p>
<p>Some ideas:</p>
<ol>
<li>Expose the <code>Colorizer</code> (https://github.com/clap-rs/clap/blob/master/src/output/fmt.rs#L9) so users can mimic what <code>print_help</code> does.</li>
<li>Provide a <code>write_help_color</code></li>
<li>Add a new argument to <code>write_help</code> to enable/disable color</li>
<li>Have <code>write_help</code> at least respect <code>ColorChoice::Always</code> and print color in that case.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-02-17 20:08</div>
            <div class="timeline-body"><blockquote>
<p>Have write_help at least respect ColorChoice::Always and print color in that case.</p>
</blockquote>
<p>I had been thinking about this and this is one that I don't think we should do.  For example, in my applications, I do not rely on clap auto-determining whether color should be shown but instead rely on the <code>concolor_clap</code> crate to decide.  So for mine, its always set to <code>Always</code> or <code>Never</code>.  The function call needs to be independent of that.</p>
<blockquote>
<p>Expose the Colorizer (https://github.com/clap-rs/clap/blob/master/src/output/fmt.rs#L9) so users can mimic what print_help does.</p>
</blockquote>
<p>Over time, we do plan to expose <code>Colorizer</code> (its not been polished enough to do so now) and give people more direct control over colors.  https://github.com/clap-rs/clap/discussions/3476#discussioncomment-2189821 is an example of these plans and relevant issues are</p>
<ul>
<li>https://github.com/clap-rs/clap/issues/2914</li>
<li>https://github.com/clap-rs/clap/issues/2913</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nicklan">@nicklan</a> on 2022-02-17 20:40</div>
            <div class="timeline-body"><p>Cool, thanks. Having the direct control would solve this issue.</p>
<p>Not quite clear on why you think having <code>write_help</code> respect <code>ColorChoice::Always</code> is a bad idea? Saying that other systems might try and determine it doesn't make sense. If I say &quot;always do color&quot; then shouldn't clap always do color?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-02-17 20:54</div>
            <div class="timeline-body"><p>When I specify the <code>ColorChoice</code> on the <code>Command</code>, its controlling the output of my errors, help, etc and its being set according to what <code>concolor</code> thinks my terminal is capable of.</p>
<p>If I were to call <code>write_help</code>, it can be for a different terminal and purpose and so setting it for one isn't necessarily relevant for the other.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nicklan">@nicklan</a> on 2022-02-17 20:58</div>
            <div class="timeline-body"><p>I get that for your use case respecting Always would break things, but it seems like you're relying on inconsistent behavior. Sure, it could be that <code>write_help</code> is going somewhere else that doesn't want color, but then you shouldn't ask to always have color :).</p>
<p>But I also know breaking existing things is not always an option, which was why I suggested <code>write_help_color</code> as a way to not break any existing code, but still allow writing colored help somewhere other than stdout.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2022-02-28 17:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../alexwlchan/dominant_colours/issues/20.html">alexwlchan/dominant_colours#20</a> on 2022-10-24 20:09</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:08 UTC
    </footer>
</body>
</html>
