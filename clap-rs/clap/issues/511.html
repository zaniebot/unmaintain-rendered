<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Positional arguments with TrailingVarArgs shouldn't split on delim - clap-rs/clap #511</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Positional arguments with TrailingVarArgs shouldn&#x27;t split on delim</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/511">#511</a>
        opened by <a href="https://github.com/luser">@luser</a>
        on 2016-05-22 22:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/luser">@luser</a></div>
            <div class="timeline-body"><p>I&#x27;m using <code>AppSettings::TrailingVarArg</code> for a binary that wraps compiler execution to pass the rest of the commandline arguments down to the compiler. I found that compiler arguments were unexpectedly being split on commas (like <code>-Wl,-foo</code> =&gt; [&quot;-Wl&quot;, &quot;-foo&quot;]).</p>
<p>I wrote a (failing) unit test for this, but haven&#x27;t tried to actually fix it:
https://github.com/luser/clap-rs/commit/ad9f8d80922f587eaa15fa6c966288c328c35565</p>
<p><code>parse_positional</code> calls <code>add_val_to_arg</code>:
https://github.com/kbknapp/clap-rs/blob/c8c20a046e9c2ea187fe2f511d5e2326d154025b/src/app/macros.rs#L122</p>
<p>which checks <code>val_delim</code>:
https://github.com/kbknapp/clap-rs/blob/1de71c00585043758608f096e256c03666513a16/src/app/parser.rs#L1119</p>
<p>...which defaults to &quot;,&quot;:
https://github.com/kbknapp/clap-rs/blob/1de71c00585043758608f096e256c03666513a16/src/args/arg.rs#L98</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-05-23 02:37</div>
            <div class="timeline-body"><p>Thanks for taking the time to find all this!</p>
<p>Since the <code>AppSettings::TrailingVarArg</code> requires a positional argument to work, one could set <a href="http://kbknapp.github.io/clap-rs/clap/struct.Arg.html#method.use_delimiter"><code>Arg::use_delimiter(false)</code></a> for that final positional argument. This allows the end user to decide whether or not they want to delimit those values or not.</p>
<p>If you set that to <code>false</code> does it still behave undesirably? If so, this is a bug and should be an easy fix.</p>
<p>The other option is to make the default behavior, if <code>AppSettings::TrailingVarArg</code> is set, to <em>not</em> use delimiters but I&#x27;d be curious to know about more use cases first.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-05-23 02:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: parsing</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-05-23 02:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-05-23 02:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: settings</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-05-23 02:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/luser">@luser</a> on 2016-05-23 10:07</div>
            <div class="timeline-body"><p>I was able to work around this by explicitly calling <code>use_delimiter(false)</code> on the positional argument:
https://github.com/luser/sccache2/blob/254a738e1cac3e40cd5a8ea0f74715a11293995d/src/cmdline.rs#L46</p>
<p>I still think this is undesirable behavior for this case. Consider that the same thing manifests in the case where &quot;--&quot; is passed to delineate a separate set of arguments, as in this other failing unittest:
https://github.com/luser/clap-rs/blob/b92045ce9d0090ffcbeb124465653eb3c711a7ef/tests/positionals.rs#L18</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-05-23 14:52</div>
            <div class="timeline-body"><p>What we could do is add some logic to check if either <code>AppSettings::TrailingVarArg</code> or <code>--</code> has been passed and stop delimiting values on that final positional argument if so, otherwise continue delimiting values.</p>
<p>My only hesitation with doing that is, is there anyone who <em>wants</em> values to be delimited when either of those two conditions are met? I&#x27;d say <code>clap</code> is small enough that the likelihood is improbable, but it&#x27;s something I&#x27;d like to consider. Primarily because making this change would also preclude anyone from being able to delimit values in those conditions if they truly wanted to.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/luser">@luser</a> on 2016-06-07 12:44</div>
            <div class="timeline-body"><p>I can&#x27;t imagine what the use case would be for that behavior, but it&#x27;s possible someone would want it, I guess? Personally I think the delimiter-splitting shouldn&#x27;t apply to positional arguments at all, that&#x27;s very unintuitive to me. Supporting <code>--foo=abc,xyz</code> =&gt; <code>&quot;foo&quot;: [&quot;abc&quot;, &quot;xyz&quot;]</code> makes sense, but <code>foo abc,xyz</code> =&gt; <code>[&quot;foo&quot;, &quot;abc&quot;, &quot;xyz&quot;]</code> is surprising.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;2.6.0&quot; by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-06-08 02:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/homu">@homu</a> on 2016-06-08 10:58</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:56:25 UTC
    </footer>
</body>
</html>
