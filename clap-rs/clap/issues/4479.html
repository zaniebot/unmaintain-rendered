<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Printing an argument from `get_positionals()` panicks with &quot;Fatal internal error&quot; - clap-rs/clap #4479</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Printing an argument from <code>get_positionals()</code> panicks with &quot;Fatal internal error&quot;</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/4479">#4479</a>
        opened by <a href="https://github.com/mss1451">@mss1451</a>
        on 2022-11-13 12:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mss1451">@mss1451</a></div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.65.0 (897e37553 2022-11-02)</p>
<h3>Clap Version</h3>
<p>4.0.23</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">use clap::{Command, Arg};

fn main() {
    env_logger::init();
    let command = Command::new(&quot;App Name&quot;).arg(Arg::new(&quot;arg&quot;));
    let positionals = command.get_positionals();
    for arg in positionals {
        println!(&quot;arg: {arg}&quot;);
    }
}
</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<p>Running <code>cargo run</code> is enough to trigger the fatal error.</p>
<h3>Actual Behaviour</h3>
<p>Panics when it is about to print an argument.</p>
<pre><code>thread 'main' panicked at 'Fatal internal error. Please consider filing a bug report at https://github.com/clap-rs/clap/issues', /home/sami/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-4.0.23/src/builder/arg.rs:4186:44
stack backtrace:
   0: rust_begin_unwind
             at /rustc/897e37553bba8b42751c67658967889d11ecd120/library/std/src/panicking.rs:584:5
   1: core::panicking::panic_fmt
             at /rustc/897e37553bba8b42751c67658967889d11ecd120/library/core/src/panicking.rs:142:14
   2: core::panicking::panic_display
             at /rustc/897e37553bba8b42751c67658967889d11ecd120/library/core/src/panicking.rs:72:5
   3: core::panicking::panic_str
             at /rustc/897e37553bba8b42751c67658967889d11ecd120/library/core/src/panicking.rs:56:5
   4: core::option::expect_failed
             at /rustc/897e37553bba8b42751c67658967889d11ecd120/library/core/src/option.rs:1880:5
   5: core::option::Option&lt;T&gt;::expect
             at /rustc/897e37553bba8b42751c67658967889d11ecd120/library/core/src/option.rs:738:21
   6: clap::builder::arg::Arg::render_arg_val
             at /home/sami/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-4.0.23/src/builder/arg.rs:4186:24
   7: clap::builder::arg::Arg::stylize_arg_suffix
             at /home/sami/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-4.0.23/src/builder/arg.rs:4170:27
   8: clap::builder::arg::Arg::stylized
             at /home/sami/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-4.0.23/src/builder/arg.rs:4144:23
   9: &lt;clap::builder::arg::Arg as core::fmt::Display&gt;::fmt
             at /home/sami/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-4.0.23/src/builder/arg.rs:4264:9
  10: &lt;&amp;T as core::fmt::Display&gt;::fmt
             at /rustc/897e37553bba8b42751c67658967889d11ecd120/library/core/src/fmt/mod.rs:2366:62
  11: core::fmt::write
             at /rustc/897e37553bba8b42751c67658967889d11ecd120/library/core/src/fmt/mod.rs:1202:17
  12: std::io::Write::write_fmt
             at /rustc/897e37553bba8b42751c67658967889d11ecd120/library/std/src/io/mod.rs:1679:15
  13: &lt;&amp;std::io::stdio::Stdout as std::io::Write&gt;::write_fmt
             at /rustc/897e37553bba8b42751c67658967889d11ecd120/library/std/src/io/stdio.rs:715:9
  14: &lt;std::io::stdio::Stdout as std::io::Write&gt;::write_fmt
             at /rustc/897e37553bba8b42751c67658967889d11ecd120/library/std/src/io/stdio.rs:689:9
  15: std::io::stdio::print_to
             at /rustc/897e37553bba8b42751c67658967889d11ecd120/library/std/src/io/stdio.rs:1017:21
  16: std::io::stdio::_print
             at /rustc/897e37553bba8b42751c67658967889d11ecd120/library/std/src/io/stdio.rs:1030:5
  17: auto_i18n::main
             at ./src/main.rs:7:9
  18: core::ops::function::FnOnce::call_once
             at /rustc/897e37553bba8b42751c67658967889d11ecd120/library/core/src/ops/function.rs:248:5
note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.
</code></pre>
<h3>Expected Behaviour</h3>
<p>Printed positional arguments. I don't know if the code makes sense or not as I don't quite know how clap works. I was merely experimenting.</p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
<h3>Debug Output</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @mss1451 on 2022-11-13 12:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4480.html">clap-rs/clap#4480</a> on 2022-11-14 18:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-11-14 18:14</div>
            <div class="timeline-body"><p>Note for it to render a meaningful value, you'll need to call <code>Command::build</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2022-11-14 18:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:48:54 UTC
    </footer>
</body>
</html>
