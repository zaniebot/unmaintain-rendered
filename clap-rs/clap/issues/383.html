<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API for shared arguments is a bit weird - clap-rs/clap #383</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>API for shared arguments is a bit weird</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/383">#383</a>
        opened by <a href="https://github.com/sgrif">@sgrif</a>
        on 2016-01-23 19:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sgrif">@sgrif</a></div>
            <div class="timeline-body"><p>So <code>diesel_cli</code> has a use case where basically all of our commands take the same argument. You can see our exact code here: https://github.com/sgrif/diesel/blob/331f81c353ec0c7f0b6897cb80cb405b2d9120bb/diesel_cli/src/main.rs#L13-L42</p>
<p>All of our commands except one take <code>--database-url</code> (and really it's not a big deal if it gets passed to that command as well). Right now, if I put that argument on the <code>Clap::App</code> instance, it requires that the command is run as <code>diesel --database-url=url migration run</code>, but I'd much rather it be <code>diesel migration run --database-url=url</code>, or really just allow it basically anywhere. (As an aside, we're having to wrap the argument in a closure because <code>Arg</code> doesn't derive <code>Clone</code>, but it probably could)</p>
<p>Does this seem like a reasonable/common enough use case to warrant support within clap itself?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-01-25 09:52</div>
            <div class="timeline-body"><p>If you add that <code>Arg</code> to your top level <code>App</code> instance but set the <code>Arg::global(true)</code> it <em>should</em> be exactly what you're looking for...i.e. it'll just propagate that particular <code>Arg</code> down through all child subcommands....if not it's a bug ;)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-01-25 09:54</div>
            <div class="timeline-body"><p>@sgrif Also I haven't forgotten about #372 I'm really hoping to have it out really soon with the 2.x base :wink:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> added by @kbknapp on 2016-01-25 09:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-01-25 10:18</div>
            <div class="timeline-body"><p>@sgrif Also I forgot to mention that in v2 it supports passing borrowed <code>Arg</code> structs, so you could create an <code>Arg</code> instance and just pass a borrow of that same instance to all your subcommands which doesn't require <code>Clone</code>ing like <code>global(true)</code> does in 1.x (<code>Arg::global</code> also exists in v2 ~~and removes the <code>Clone</code>ing as well, just FYI it's essentially shorthand for passing a borrow to down through each subcommand~~ Edit: <code>Arg::global</code> still clones, I was mistaken on how'd I'd implemented that...but passing a borrow does not clone so long as <code>global(true)</code> is not set).</p>
<p>Edit: Corrections</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sgrif">@sgrif</a> on 2016-01-26 19:21</div>
            <div class="timeline-body"><p>Yup, I just missed this. Thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @sgrif on 2016-01-26 19:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../rwx-research/abq/pulls/67.html">rwx-research/abq#67</a> on 2023-07-07 13:48</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:46:30 UTC
    </footer>
</body>
</html>
