<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Selectively disable word wrapping - clap-rs/clap #5144</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Selectively disable word wrapping</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/5144">#5144</a>
        opened by <a href="https://github.com/nic-hartley">@nic-hartley</a>
        on 2023-09-27 03:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/nic-hartley">@nic-hartley</a></div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>4.4.4</p>
<h3>Describe your use case</h3>
<p>I'm trying to write a long help message that looks something like this:</p>
<pre><code>Generate or restore the structure for a new blog.

This will generate a directory structure that looks something like:

$dir/
    .git/
    pages/
        README.md
    posts/
        README.md
    brb.yml
    index.md
    README.md
</code></pre>
<p>i.e. I want to selectively <em>not</em> word-wrap certain parts of the help message, while word-wrapping the rest normally.</p>
<p>I could also see this being useful for tables, example shell commands, psuedocode, lists, etc.</p>
<h3>Describe the solution you'd like</h3>
<p>I'm not sure exactly how this could look, but vaguely inspired by Markdown, perhaps some form of delimiter for the &quot;don't wrap&quot; part that gets deleted:</p>
<pre><code>/// Generate or restore the structure for a new blog.
/// 
/// This will generate a directory structure that looks something like:
/// 
/// ```
/// $dir/
///     .git/
///     pages/
///         README.md
///     posts/
///         README.md
///     brb.yml
///     index.md
///     README.md
/// ```
</code></pre>
<p>If you go this route, please <em>please</em> make the delimiter variable/escapable (e.g. &quot;any number of backticks &gt; 3, ended by that number of backticks again&quot;, or &quot;3 backticks, unless they start with a backslash&quot; not just &quot;exactly 3&quot;) -- granted, &quot;```&quot; might not be especially likely to show up in random text, but I could see it showing up in, say, a command-line Markdown parser.</p>
<h3>Alternatives, if applicable</h3>
<ol start="0">
<li><p>Keep the current &quot;all or nothing&quot; approach.</p>
<p>Obviously I dislike this idea or I wouldn't be writing this issue. I think word-wrapping is generally helpful, and I think it's most helpful when it can be disabled for part of the text.</p>
</li>
<li><p>Per-line indicator, e.g.:</p>
<pre><code>Generate or restore the structure for a new blog.

This will generate a directory structure that looks something like:

` $dir/
`     .git/
`     pages/
`         README.md
`     posts/
`         README.md
`     brb.yml
`     index.md
`     README.md
</code></pre>
<p>This would be workable, but probably much more annoying to write and edit. And if you, like me, have your editor render whitespace, it can be hard to see, too.</p>
</li>
<li><p>Add another section for a block that shouldn't be word-wrapped.</p>
<p>This causes two annoyances: You can't use doc comments for it anymore, which makes it much more of a pain to write and edit; and you can't just freely intersperse things like directory trees into your text, you have to make an &quot;appendix&quot; and then stuff everything in there.</p>
</li>
</ol>
<h3>Additional Context</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @nic-hartley on 2023-09-27 03:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nic-hartley">@nic-hartley</a> on 2023-09-27 03:16</div>
            <div class="timeline-body"><p>Just from what I've seen of the codebase, I <em>think</em> this should be <em>relatively</em> easy to do? I feel like it'd be as easy as adding a bit of code to <a href="https://github.com/clap-rs/clap/blob/master/clap_builder/src/output/textwrap/mod.rs#L15"><code>clap_builder::wrap</code></a> to find whatever delimiter and just include raw lines? I could probably make this as a PR once the relevant design work is done.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-09-27 15:44</div>
            <div class="timeline-body"><p>Taking unstructured data and adding structure to it would be a breaking change.</p>
<p>When we parse doc comments, we implement a hacked up subset of markdown.  #2389 has us expand that and would exist only within the derive layer.  This doesn't address unwrapped blocks.</p>
<p>However, it seems like this would be worked around on the users side by deciding on their wrap positions and their help messages.  If the unwrappable blocks go past the screen edge, there isn't really any good decision on what should be done.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nic-hartley">@nic-hartley</a> on 2023-09-27 17:46</div>
            <div class="timeline-body"><p>@epage I'm not sure what you mean by &quot;worked around on the user's side by deciding on their wrap positions&quot;, but to be clear I'm explicitly against requiring users to hard-wrap their own text. I like word-wrapping generally; I just don't want it to break certain parts of preformatted text.</p>
<p>As for building this into the pseudo-Markdown support -- that would work for all my use-cases, yep! I wasn't aware that was a thing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-09-27 18:04</div>
            <div class="timeline-body"><blockquote>
<p>I'm not sure what you mean by &quot;worked around on the user's side by deciding on their wrap positions&quot;, but to be clear I'm explicitly against requiring users to hard-wrap their own text. I like word-wrapping generally; I just don't want it to break certain parts of preformatted text.</p>
</blockquote>
<p>Not quite.</p>
<p>Maybe as a starting point,it'd be good to post a reproduction case</p>
<ul>
<li>A minimal reproduction case program</li>
<li>Example screenshot of it wrapping incorrectly.</li>
</ul>
<p>I think having that as a baseline will make it easier to explain my thought</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nic-hartley">@nic-hartley</a> on 2023-09-27 22:13</div>
            <div class="timeline-body"><p>Sure! So in the example in my question, I've typed it up like this:</p>
<pre><code class="language-rs">/// Generate or restore the structure for a new blog.
/// 
/// This will generate a directory structure that looks something like:
/// 
/// $dir/
///     .git/
///     pages/
///         README.md
///     posts/
///         README.md
///     brb.yml
///     index.md
///     README.md
</code></pre>
<p>Which, in a wide window, renders like this:</p>
<pre><code>Generate or restore the structure for a new blog.

This will generate a directory structure that looks something like:

$dir/ .git/ pages/ README.md posts/ README.md brb.yml index.md README.md
</code></pre>
<p>And very narrow, like this:</p>
<pre><code>Generate or restore the structure
for a new blog.

This will generate a &quot;reasonable
default&quot; directory structure for
your new blog.

$dir/ .git/ pages/ README.md posts/
README.md brb.yml index.md
README.md
</code></pre>
<p>Whereas I'd like to have a way to make it look like:</p>
<pre><code>Generate or restore the structure
for a new blog.

This will generate a &quot;reasonable
default&quot; directory structure for
your new blog.

$dir/
    .git/
    pages/
        README.md
    posts/
        README.md
    brb.yml
    index.md
    README.md
</code></pre>
<p>On an <em>even narrower</em> terminal, too small to fit the text in the tree, then the terminal wraps it how the terminal wraps it, oh well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-09-28 00:43</div>
            <div class="timeline-body"><p>The core problem here is not word wrapping but when the derive parses your doc comment, it is incorrectly identifying newlines as continuations.  This is the same problem as #2389.</p>
<p>Going to close in favor of that issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2023-09-28 00:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:49:13 UTC
    </footer>
</body>
</html>
