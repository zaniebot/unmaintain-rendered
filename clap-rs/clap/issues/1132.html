<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compilation failure under rust nightly webassembly target - clap-rs/clap #1132</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Compilation failure under rust nightly webassembly target</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1132">#1132</a>
        opened by <a href="https://github.com/smarter">@smarter</a>
        on 2017-12-20 01:06
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/smarter">@smarter</a></div>
            <div class="timeline-body"><!--
Please use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`
-->

<h3>Rust Version</h3>
<ul>
<li>rustc 1.24.0-nightly (dc39c3169 2017-12-17)</li>
</ul>
<h3>Affected Version of clap</h3>
<ul>
<li>2.29.0</li>
</ul>
<p>Rust now has a <a href="https://www.hellorust.com/setup/wasm-target/">webassembly target</a>, trying to use it in a project that depends on <code>clap</code> results in a build failure:</p>
<pre><code class="language-rust">     Running `rustc --crate-name clap /home/smarter/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-2.29.0/src/lib.rs --crate-type lib --emit=dep-info,link -C debuginfo=2 --cfg 'feature=&quot;ansi_term&quot;' --cfg 'feature=&quot;atty&quot;' --cfg 'feature=&quot;color&quot;' --cfg 'feature=&quot;default&quot;' --cfg 'feature=&quot;strsim&quot;' --cfg 'feature=&quot;suggestions&quot;' --cfg 'feature=&quot;vec_map&quot;' -C metadata=65f4e6c3f5bc989d -C extra-filename=-65f4e6c3f5bc989d --out-dir /home/smarter/opt/rav1e/target/wasm32-unknown-unknown/debug/deps --target wasm32-unknown-unknown -L dependency=/home/smarter/opt/rav1e/target/wasm32-unknown-unknown/debug/deps -L dependency=/home/smarter/opt/rav1e/target/debug/deps --extern unicode_width=/home/smarter/opt/rav1e/target/wasm32-unknown-unknown/debug/deps/libunicode_width-d8e4ab5b3b6e196a.rlib --extern bitflags=/home/smarter/opt/rav1e/target/wasm32-unknown-unknown/debug/deps/libbitflags-6b084702002cf111.rlib --extern ansi_term=/home/smarter/opt/rav1e/target/wasm32-unknown-unknown/debug/deps/libansi_term-ac6664a6dc50e79a.rlib --extern vec_map=/home/smarter/opt/rav1e/target/wasm32-unknown-unknown/debug/deps/libvec_map-c395abf84ff3b365.rlib --extern textwrap=/home/smarter/opt/rav1e/target/wasm32-unknown-unknown/debug/deps/libtextwrap-216ed0ff2756cb7b.rlib --extern atty=/home/smarter/opt/rav1e/target/wasm32-unknown-unknown/debug/deps/libatty-ee3084e679e50df7.rlib --extern strsim=/home/smarter/opt/rav1e/target/wasm32-unknown-unknown/debug/deps/libstrsim-64624fb788d914f4.rlib --cap-lints allow`
error[E0433]: failed to resolve. Could not find `unix` in `os`
   --&gt; /home/smarter/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-2.29.0/src/app/parser.rs:662:26
    |
662 |             use std::os::unix::ffi::OsStrExt;
    |                          ^^^^ Could not find `unix` in `os`

error[E0433]: failed to resolve. Could not find `unix` in `os`
 --&gt; /home/smarter/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-2.29.0/src/args/arg.rs:8:14
  |
8 | use std::os::unix::ffi::OsStrExt;
  |              ^^^^ Could not find `unix` in `os`

...
</code></pre>
<p>It might be impossible to actually use clap for anything with the wasm backend right now, but it would be nice if it still managed to build.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-01-09 17:11</div>
            <div class="timeline-body"><p>I agree. I haven't really put any thought into wasm because I can't imagine parsing arguments in the browser, but you're right it'd be nice if it still builds.</p>
<p>This would probably be an easy fix, and if anyone wants to add a non-default cargo feature <code>wasm</code> and do the fixes I'd be happy to mentor it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: enhancement</span> added by @kbknapp on 2018-01-09 17:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> added by @kbknapp on 2018-01-09 17:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by @kbknapp on 2018-01-09 17:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">M: mentored</span> added by @kbknapp on 2018-01-09 17:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @kbknapp on 2018-01-09 17:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rtsao">@rtsao</a> on 2018-01-10 02:50</div>
            <div class="timeline-body"><p>I think the clap use case for the wasm target would be consuming it from Node.js. I guess in theory you could build a CLI entirely in Rust then ship it to npm.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/stevepentland">@stevepentland</a> on 2018-02-10 18:31</div>
            <div class="timeline-body"><p>@kbknapp I'm interested in taking this one on if no one else has started</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-02-11 18:56</div>
            <div class="timeline-body"><p>That would be great! Thanks @stevepentland</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/stevepentland">@stevepentland</a> on 2018-02-11 20:05</div>
            <div class="timeline-body"><p>@kbknapp I need to ask about what you meant with a non-default wasm cargo feature? I've been looking through the code at how to reconcile the changes and could use a little insight from you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-02-11 20:27</div>
            <div class="timeline-body"><p>By non-default I just meant a cargo feature that it's not included in the default features array (and thus opt-in instead of opt-out). However, I now think there are better ways to solve this.</p>
<p>A better solution would be to add some additional OsStrExt traits inside <code>src/osstringext.rs</code> following the OsStrExt3 example for Windows, since Windows is essentially the same problem as wasm.</p>
<p>Actually...now that I think about it, maybe just reusing the OsStrExt3 that Windows uses would work too? That just require changing the cfg statements...hmm I'd try that out first.</p>
<p>So in order of things I'd try:</p>
<ul>
<li>Reusing the OsStrExt3 for Windows and wasn't</li>
<li>Adding a new trait just like OsStrExt3 but for was specifically</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/stevepentland">@stevepentland</a> on 2018-02-11 20:37</div>
            <div class="timeline-body"><p>Alright sounds good, Iâ€™ll start there and see how it goes. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/1187.html">clap-rs/clap#1187</a> on 2018-02-19 04:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/1190.html">clap-rs/clap#1190</a> on 2018-02-23 20:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-02-23 20:59</div>
            <div class="timeline-body"><p>Closed with #1190 thanks to @stevepentland :tada:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2018-02-23 20:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jamesray1">@jamesray1</a> on 2018-05-05 08:09</div>
            <div class="timeline-body"><p>Getting this error with https://github.com/Drops-of-Diamond/diamond_drops/issues/59 with Clap 2.31.2.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1270.html">clap-rs/clap#1270</a> on 2018-05-05 22:18</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:47:04 UTC
    </footer>
</body>
</html>
