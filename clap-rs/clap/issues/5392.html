<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`#[arg(value_delimiter = ':')]` Delimiter isnt displayed in the help message. - clap-rs/clap #5392</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>#[arg(value_delimiter = &#x27;:&#x27;)]</code> Delimiter isnt displayed in the help message.</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/clap-rs/clap/issues/5392">#5392</a>
        opened by <a href="https://github.com/max-ishere">@max-ishere</a>
        on 2024-03-11 13:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/max-ishere">@max-ishere</a></div>
            <div class="timeline-body">Please complete the following tasks
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
Clap Version
<p>4.5.2</p>
Describe your use case
<p>Most of the arguments are already documented by clap, I didnt even have to do anything (nice). However the delimiter doesnt show up in the help message.</p>
<pre><code>    /// Colon-separated list of lock types
    #[arg(required = true, value_delimiter = &#x27;:&#x27;)]
    #[clap(long)]
    what: Vec&lt;InhibitTarget&gt;,
</code></pre>
<pre><code>Options:
      --what &lt;WHAT&gt;  Colon-separated list of lock types [possible values: shutdown, sleep, ...]
</code></pre>
Describe the solution you&#x27;d like
<p>The delimiter should be shown like this:</p>
<pre><code>Options:
      --what &lt;WHAT&gt;  [`:` separated list of: shutdown, sleep, ...]
</code></pre>
Alternatives, if applicable
<p><em>No response</em></p>
Additional Context
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by <a href="https://github.com/max-ishere">@max-ishere</a> on 2024-03-11 13:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-help</span> added by <a href="https://github.com/epage">@epage</a> on 2024-03-11 14:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> added by <a href="https://github.com/epage">@epage</a> on 2024-03-11 14:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-03-11 14:30</div>
            <div class="timeline-body"><p>For #4812, we are looking at including it within the example usage.  I&#x27;d be interested in exploring ways of doing that here as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;`#[arg(value-delimiter = &#x27;:&#x27;)] Delimiter isnt displayed in the help message.&quot; to &quot;`#[arg(value_delimiter = &#x27;:&#x27;)] Delimiter isnt displayed in the help message.&quot; by <a href="https://github.com/max-ishere">@max-ishere</a> on 2024-03-12 07:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;`#[arg(value_delimiter = &#x27;:&#x27;)] Delimiter isnt displayed in the help message.&quot; to &quot;`#[arg(value_delimiter = &#x27;:&#x27;)]` Delimiter isnt displayed in the help message.&quot; by <a href="https://github.com/max-ishere">@max-ishere</a> on 2024-03-12 07:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#5817</a> on 2024-11-14 15:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Aethelflaed">@Aethelflaed</a> on 2024-11-14 16:11</div>
            <div class="timeline-body"><p>Placing it in the usage can be similar to what was done for #1052, but then that&#x27;s only visible when there&#x27;s more than one value name.</p>
<p>I&#x27;m proposing to also add it in the help message of the option/argument</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-11-14 18:01</div>
            <div class="timeline-body"><blockquote>
<p>that&#x27;s only visible when there&#x27;s more than one value name.</p>
</blockquote>
<p>Not quite as that is conflating a couple of features which I realized in seeing  #5817</p>
<p>In that PR,</p>
<pre><code>            arg!(-f --fake &lt;s&gt; &quot;some help&quot;)
                .required(true)
                .required(true)
                .value_names([&quot;some&quot;, &quot;val&quot;])
                .action(ArgAction::Set)
                .value_delimiter(&#x27;:&#x27;),
        )
</code></pre>
<p>gets rendered as</p>
<pre><code>Usage: test [OPTIONS] --fake &lt;some&gt;:&lt;val&gt; --birthday-song &lt;song&gt; --birthday-song-volume &lt;volume&gt;

Options:
  -f, --fake &lt;some&gt;:&lt;val&gt;  some help [value delimiter: &#x27;:&#x27;]
</code></pre>
<p>Seeing that is reminding of the weird interplay of</p>
<ul>
<li><code>value_names</code></li>
<li><code>num_args</code>: gets defaulted by <code>value_names</code></li>
<li><code>value_delimiter</code></li>
</ul>
<p>So <code>--fake</code> actually accepts <code>--fake some1:some2:some3 val1:val2:val3</code>.  This was likely not intended for that test but slipped through the cracks as features changed through v3.  The test was likely trying to get <code>--fake some:val</code> but now we only support unbounded value delimiters.</p>
<p>We have the idea of <code>extra_values</code>
https://github.com/clap-rs/clap/blob/2920fb082c987acb72ed1d1f47991c4d157e380d/clap_builder/src/builder/arg.rs#L4664-L4671</p>
<p>If we used something like that, we could get</p>
<pre><code>  -f, --fake &lt;some&gt;:... &lt;val&gt;:...  some help [value delimiter: &#x27;:&#x27;]
</code></pre>
<p>or</p>
<pre><code>  -f, --fake &lt;some&gt;[:...] &lt;val&gt;[:...]  some help [value delimiter: &#x27;:&#x27;]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-11-14 18:07</div>
            <div class="timeline-body"><blockquote>
<p>I&#x27;m proposing to also add it in the help message of the option/argument</p>
</blockquote>
<p>Currently we do this for</p>
<ul>
<li>default values</li>
<li>env</li>
<li>possible values (#5156 could alleviate this in some cases)</li>
</ul>
<p>Seeing two of those rendered together, we get</p>
<pre><code>Usage: default [OPTIONS]

Options:
      --arg &lt;argument&gt;  Pass an argument to the program. [default: &quot;\n&quot;] [possible values: normal, &quot;
                        &quot;, &quot;\n&quot;, &quot;\t&quot;, other]
  -h, --help            Print help
  -V, --version         Print version
</code></pre>
<p>Overall, I&#x27;m not thrilled with these and don&#x27;t feel like they compose well together, and worry about extending them more.  Also, <em>if</em> we can find ways to include them in the usage, it becomes more natural (like I want to do with possible values).</p>
<p>btw a good test case for one, the other, or both options is to see what Cargo&#x27;s output would look like with changing this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Aethelflaed">@Aethelflaed</a> on 2024-11-19 09:35</div>
            <div class="timeline-body"><blockquote>
<p>So --fake actually accepts --fake some1:some2:some3 val1:val2:val3. This was likely not intended for that test but slipped through the cracks as features changed through v3. The test was likely trying to get --fake some:val but now we only support unbounded value delimiters.</p>
</blockquote>
<p>From what I gathered, there used to be an option to require the delimiter, but without it we&#x27;re left with allowing both the delimiter and the space separated values. I didn&#x27;t think that an issue.</p>
<p>Your idea with the <code>extra_values</code> sounds great, and we could even indicate the delimiter as optional with something like:</p>
<pre><code>  -f, --fake &lt;some&gt;[ : | &#x27; &#x27; ]... &lt;val&gt;[ : | &#x27; &#x27; ]...  some help
</code></pre>
<p>Although it gets a bit hard to read...</p>
<pre><code>  -f, --fake &lt;some&gt;[[ : | &#x27; &#x27; ]...]
</code></pre>
<p>About the <code>[help message]</code> part, if it doesn&#x27;t impact the direct usage (like a default value), then it could only be display in the long<code>--help</code> version to remove?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Aethelflaed">@Aethelflaed</a> on 2024-11-19 09:40</div>
            <div class="timeline-body"><blockquote>
<p>btw a good test case for one, the other, or both options is to see what Cargo&#x27;s output would look like with changing this.</p>
</blockquote>
<p>Any particular cargo command I can try to see interesting result?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-11-19 20:42</div>
            <div class="timeline-body"><blockquote>
<p>From what I gathered, there used to be an option to require the delimiter, but without it we&#x27;re left with allowing both the delimiter and the space separated values. I didn&#x27;t think that an issue.</p>
</blockquote>
<p>That setting was because of a weird interaction between features and became redundant.  Just setting a value delimiter makes it so you only use the value delimiter.  You have to explicitly opt-in to <code>num_args)1..)</code> or similar to have them both active.</p>
<blockquote>
<p><code>  -f, --fake &lt;some&gt;[ : | &#x27; &#x27; ]... &lt;val&gt;[ : | &#x27; &#x27; ]...  some help</code></p>
</blockquote>
<p>If you have both <code>num_args(1..)</code> and <code>value_delimiter(&#x27;:&#x27;)</code>, I&#x27;m not sure how the <code>value_names</code> should be integrated in, whether they should be shown as part of the first <code>std::env::args_os</code> entry (kind of like you showed though yours is also interleaved) or one <code>value_name</code> per entry (like what I showed)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-11-19 20:44</div>
            <div class="timeline-body"><blockquote>
<p>Any particular cargo command I can try to see interesting result?</p>
</blockquote>
<p>Hmm, the only delimited value I&#x27;m remember is <code>--features</code> and we hand-implement that because we have two delimiters.  If we had it showing in the usage, I&#x27;d change it so one of the two was done through clap so it would be rendered.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zaneduffield">@zaneduffield</a> on 2025-02-03 01:23</div>
            <div class="timeline-body"><p>Personally, I&#x27;m a fan of the way that PostgreSQL indicates that something is a comma-separated list.
They append <code>[, ... ]</code> to whatever can be repeated in a list. An example is the docs for <a href="https://www.postgresql.org/docs/17/sql-createtable.html">sql-createtable</a>.</p>
<p>This works nicely because all throughout the PostgreSQL docs <code>[]</code> represents an optional thing, and <code>...</code> is used as a kind of inferred placeholder.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-02-03 17:21</div>
            <div class="timeline-body"><blockquote>
<p>If you have both num_args(1..) and value_delimiter(&#x27;:&#x27;), I&#x27;m not sure how the value_names should be integrated in, whether they should be shown as part of the first std::env::args_os entry (kind of like you showed though yours is also interleaved) or one value_name per entry (like what I showed)</p>
</blockquote>
<p>Our debug asserts do take a stance on this:
https://github.com/clap-rs/clap/blob/349bd3c6bfe4d63a340b25165af29da6d9dee55c/clap_builder/src/builder/debug_asserts.rs#L750-L762</p>
<p>This associates value names with <code>num_args</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-02-03 17:23</div>
            <div class="timeline-body"><blockquote>
<p>Personally, I&#x27;m a fan of the way that PostgreSQL indicates that something is a comma-separated list. They append <code>[, ... ]</code> to whatever can be repeated in a list. An example is the docs for <a href="https://www.postgresql.org/docs/17/sql-createtable.html">sql-createtable</a>.</p>
<p>This works nicely because all throughout the PostgreSQL docs <code>[]</code> represents an optional thing, and <code>...</code> is used as a kind of inferred placeholder.</p>
</blockquote>
<p>Yeah, I was considering that in <a href="https://github.com/clap-rs/clap/issues/5392">clap-rs/clap#5392</a>#issuecomment-2477078558</p>
<p>Might be worth someone trying it out and seeing how it affects the output.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#5995</a> on 2025-05-09 14:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 20:00:06 UTC
    </footer>
</body>
</html>
