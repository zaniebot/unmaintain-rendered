<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`#[arg(value_delimiter = ':')]` Delimiter isnt displayed in the help message. - clap-rs/clap #5392</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>`#[arg(value_delimiter = ':')]` Delimiter isnt displayed in the help message.</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/clap-rs/clap/issues/5392">#5392</a>
        opened by <a href="https://github.com/max-ishere">@max-ishere</a>
        on 2024-03-11 13:12
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/max-ishere">@max-ishere</a> on 2024-03-11 13:12</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>4.5.2</p>
<h3>Describe your use case</h3>
<p>Most of the arguments are already documented by clap, I didnt even have to do anything (nice). However the delimiter doesnt show up in the help message.</p>
<pre><code class="language-rust">    /// Colon-separated list of lock types
    #[arg(required = true, value_delimiter = ':')]
    #[clap(long)]
    what: Vec&lt;InhibitTarget&gt;,
</code></pre>
<pre><code class="language-txt">Options:
      --what &lt;WHAT&gt;  Colon-separated list of lock types [possible values: shutdown, sleep, ...]
</code></pre>
<h3>Describe the solution you'd like</h3>
<p>The delimiter should be shown like this:</p>
<pre><code class="language-txt">Options:
      --what &lt;WHAT&gt;  [`:` separated list of: shutdown, sleep, ...]
</code></pre>
<h3>Alternatives, if applicable</h3>
<p><em>No response</em></p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @max-ishere on 2024-03-11 13:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-help</span> added by @epage on 2024-03-11 14:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> added by @epage on 2024-03-11 14:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-03-11 14:30</div>
            <div class="timeline-body"><p>For #4812, we are looking at including it within the example usage.  I'd be interested in exploring ways of doing that here as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`#[arg(value-delimiter = ':')] Delimiter isnt displayed in the help message." to "`#[arg(value_delimiter = ':')] Delimiter isnt displayed in the help message." by @max-ishere on 2024-03-12 07:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "`#[arg(value_delimiter = ':')] Delimiter isnt displayed in the help message." to "`#[arg(value_delimiter = ':')]` Delimiter isnt displayed in the help message." by @max-ishere on 2024-03-12 07:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5817.html">clap-rs/clap#5817</a> on 2024-11-14 15:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Aethelflaed">@Aethelflaed</a> on 2024-11-14 16:11</div>
            <div class="timeline-body"><p>Placing it in the usage can be similar to what was done for #1052, but then that's only visible when there's more than one value name.</p>
<p>I'm proposing to also add it in the help message of the option/argument</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-11-14 18:01</div>
            <div class="timeline-body"><blockquote>
<p>that's only visible when there's more than one value name.</p>
</blockquote>
<p>Not quite as that is conflating a couple of features which I realized in seeing  #5817</p>
<p>In that PR,</p>
<pre><code class="language-rust">            arg!(-f --fake &lt;s&gt; &quot;some help&quot;)
                .required(true)
                .required(true)
                .value_names([&quot;some&quot;, &quot;val&quot;])
                .action(ArgAction::Set)
                .value_delimiter(':'),
        )
</code></pre>
<p>gets rendered as</p>
<pre><code>Usage: test [OPTIONS] --fake &lt;some&gt;:&lt;val&gt; --birthday-song &lt;song&gt; --birthday-song-volume &lt;volume&gt;

Options:
  -f, --fake &lt;some&gt;:&lt;val&gt;  some help [value delimiter: ':']
</code></pre>
<p>Seeing that is reminding of the weird interplay of</p>
<ul>
<li><code>value_names</code></li>
<li><code>num_args</code>: gets defaulted by <code>value_names</code></li>
<li><code>value_delimiter</code></li>
</ul>
<p>So <code>--fake</code> actually accepts <code>--fake some1:some2:some3 val1:val2:val3</code>.  This was likely not intended for that test but slipped through the cracks as features changed through v3.  The test was likely trying to get <code>--fake some:val</code> but now we only support unbounded value delimiters.</p>
<p>We have the idea of <code>extra_values</code>
https://github.com/clap-rs/clap/blob/2920fb082c987acb72ed1d1f47991c4d157e380d/clap_builder/src/builder/arg.rs#L4664-L4671</p>
<p>If we used something like that, we could get</p>
<pre><code>  -f, --fake &lt;some&gt;:... &lt;val&gt;:...  some help [value delimiter: ':']
</code></pre>
<p>or</p>
<pre><code>  -f, --fake &lt;some&gt;[:...] &lt;val&gt;[:...]  some help [value delimiter: ':']
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-11-14 18:07</div>
            <div class="timeline-body"><blockquote>
<p>I'm proposing to also add it in the help message of the option/argument</p>
</blockquote>
<p>Currently we do this for</p>
<ul>
<li>default values</li>
<li>env</li>
<li>possible values (#5156 could alleviate this in some cases)</li>
</ul>
<p>Seeing two of those rendered together, we get</p>
<pre><code>Usage: default [OPTIONS]

Options:
      --arg &lt;argument&gt;  Pass an argument to the program. [default: &quot;\n&quot;] [possible values: normal, &quot;
                        &quot;, &quot;\n&quot;, &quot;\t&quot;, other]
  -h, --help            Print help
  -V, --version         Print version
</code></pre>
<p>Overall, I'm not thrilled with these and don't feel like they compose well together, and worry about extending them more.  Also, <em>if</em> we can find ways to include them in the usage, it becomes more natural (like I want to do with possible values).</p>
<p>btw a good test case for one, the other, or both options is to see what Cargo's output would look like with changing this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Aethelflaed">@Aethelflaed</a> on 2024-11-19 09:35</div>
            <div class="timeline-body"><blockquote>
<p>So --fake actually accepts --fake some1:some2:some3 val1:val2:val3. This was likely not intended for that test but slipped through the cracks as features changed through v3. The test was likely trying to get --fake some:val but now we only support unbounded value delimiters.</p>
</blockquote>
<p>From what I gathered, there used to be an option to require the delimiter, but without it we're left with allowing both the delimiter and the space separated values. I didn't think that an issue.</p>
<p>Your idea with the <code>extra_values</code> sounds great, and we could even indicate the delimiter as optional with something like:</p>
<pre><code>  -f, --fake &lt;some&gt;[ : | ' ' ]... &lt;val&gt;[ : | ' ' ]...  some help
</code></pre>
<p>Although it gets a bit hard to read...</p>
<pre><code>  -f, --fake &lt;some&gt;[[ : | ' ' ]...]
</code></pre>
<p>About the <code>[help message]</code> part, if it doesn't impact the direct usage (like a default value), then it could only be display in the long<code>--help</code> version to remove?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Aethelflaed">@Aethelflaed</a> on 2024-11-19 09:40</div>
            <div class="timeline-body"><blockquote>
<p>btw a good test case for one, the other, or both options is to see what Cargo's output would look like with changing this.</p>
</blockquote>
<p>Any particular cargo command I can try to see interesting result?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-11-19 20:42</div>
            <div class="timeline-body"><blockquote>
<p>From what I gathered, there used to be an option to require the delimiter, but without it we're left with allowing both the delimiter and the space separated values. I didn't think that an issue.</p>
</blockquote>
<p>That setting was because of a weird interaction between features and became redundant.  Just setting a value delimiter makes it so you only use the value delimiter.  You have to explicitly opt-in to <code>num_args)1..)</code> or similar to have them both active.</p>
<blockquote>
<p><code>  -f, --fake &lt;some&gt;[ : | ' ' ]... &lt;val&gt;[ : | ' ' ]...  some help</code></p>
</blockquote>
<p>If you have both <code>num_args(1..)</code> and <code>value_delimiter(':')</code>, I'm not sure how the <code>value_names</code> should be integrated in, whether they should be shown as part of the first <code>std::env::args_os</code> entry (kind of like you showed though yours is also interleaved) or one <code>value_name</code> per entry (like what I showed)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-11-19 20:44</div>
            <div class="timeline-body"><blockquote>
<p>Any particular cargo command I can try to see interesting result?</p>
</blockquote>
<p>Hmm, the only delimited value I'm remember is <code>--features</code> and we hand-implement that because we have two delimiters.  If we had it showing in the usage, I'd change it so one of the two was done through clap so it would be rendered.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zaneduffield">@zaneduffield</a> on 2025-02-03 01:23</div>
            <div class="timeline-body"><p>Personally, I'm a fan of the way that PostgreSQL indicates that something is a comma-separated list.
They append <code>[, ... ]</code> to whatever can be repeated in a list. An example is the docs for <a href="https://www.postgresql.org/docs/17/sql-createtable.html">sql-createtable</a>.</p>
<p>This works nicely because all throughout the PostgreSQL docs <code>[]</code> represents an optional thing, and <code>...</code> is used as a kind of inferred placeholder.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-02-03 17:21</div>
            <div class="timeline-body"><blockquote>
<p>If you have both num_args(1..) and value_delimiter(':'), I'm not sure how the value_names should be integrated in, whether they should be shown as part of the first std::env::args_os entry (kind of like you showed though yours is also interleaved) or one value_name per entry (like what I showed)</p>
</blockquote>
<p>Our debug asserts do take a stance on this:
https://github.com/clap-rs/clap/blob/349bd3c6bfe4d63a340b25165af29da6d9dee55c/clap_builder/src/builder/debug_asserts.rs#L750-L762</p>
<p>This associates value names with <code>num_args</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-02-03 17:23</div>
            <div class="timeline-body"><blockquote>
<p>Personally, I'm a fan of the way that PostgreSQL indicates that something is a comma-separated list. They append <code>[, ... ]</code> to whatever can be repeated in a list. An example is the docs for <a href="https://www.postgresql.org/docs/17/sql-createtable.html">sql-createtable</a>.</p>
<p>This works nicely because all throughout the PostgreSQL docs <code>[]</code> represents an optional thing, and <code>...</code> is used as a kind of inferred placeholder.</p>
</blockquote>
<p>Yeah, I was considering that in https://github.com/clap-rs/clap/issues/5392#issuecomment-2477078558</p>
<p>Might be worth someone trying it out and seeing how it affects the output.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5995.html">clap-rs/clap#5995</a> on 2025-05-09 14:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:09 UTC
    </footer>
</body>
</html>
