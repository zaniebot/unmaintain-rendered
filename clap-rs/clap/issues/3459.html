<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>value_of_t_or and value_of_t_or_else - clap-rs/clap #3459</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>value_of_t_or and value_of_t_or_else</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/3459">#3459</a>
        opened by <a href="https://github.com/letheed">@letheed</a>
        on 2022-02-12 16:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/letheed">@letheed</a> on 2022-02-12 16:26</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>3.0.14</p>
<h3>Describe your use case</h3>
<p>The use case is the parsing of optional arguments where a default value is provided when there is none.</p>
<p>Currently I’m using this code:</p>
<pre><code class="language-rust">const MY_ARG_DEFAULT = {…};

let my_val = match args.value_of_t(&quot;MY_ARG&quot;) {
        Err(error) if error.kind() == ErrorKind::ArgumentNotFound =&gt; Ok(MY_ARG_DEFAULT),
        result =&gt; result,
    }?;
</code></pre>
<h3>Describe the solution you'd like</h3>
<p>Ideally I would like something like:</p>
<pre><code class="language-rust">let my_val = args.value_of_t_or(&quot;MY_ARG&quot;, MY_ARG_DEFAULT)?;
</code></pre>
<p>and for more expensive values:</p>
<pre><code class="language-rust">let my_val = args.value_of_t_or_else(&quot;MY_ARG&quot;, || &lt;expr&gt;)?;
</code></pre>
<p>I’m actually a bit surprised something like that doesn’t exist because I though the derive feature would use something like that for <code>default_value_t</code> instead of a print/parse roundtrip.</p>
<h3>Alternatives, if applicable</h3>
<p><em>No response</em></p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @letheed on 2022-02-12 16:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-02-13 02:43</div>
            <div class="timeline-body"><blockquote>
<p>I’m actually a bit surprised something like that doesn’t exist because I though the derive feature would use something like that for default_value_t instead of a print/parse roundtrip.</p>
</blockquote>
<p>We've been tracking this with https://github.com/clap-rs/clap/issues/2505</p>
<p>Keep in mind that <code>value_of_t</code> is new in clap 3.0, so our window of feedback has been small.  We just didn't have time to change the API to how it was proposed in there.  Your API proposals offer some alternatives that can be added in the mean time.  Naming between an erroring vs an optional version is unclear (not really seen a pattern for that emerge).</p>
<p>We also will have #2683 impact some of these API choices.</p>
<p>I'm going to close this out in favor of continuing the conversation on #2505</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2022-02-13 02:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-parsing</span> added by @epage on 2022-02-13 02:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-duplicate</span> added by @epage on 2022-02-13 02:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:08 UTC
    </footer>
</body>
</html>
