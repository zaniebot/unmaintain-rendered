<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deprecate Yaml API - clap-rs/clap #3087</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Deprecate Yaml API</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/3087">#3087</a>
        opened by <a href="https://github.com/epage">@epage</a>
        on 2021-12-08 17:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/epage">@epage</a> on 2021-12-08 17:08</div>
            <div class="timeline-body"><p>The YAML API is used for:</p>
<ul>
<li>Fast iteration by changing the CLI without re-compiling</li>
<li>Allowing compsable CLI pieces, like the derive's <code>flatten</code></li>
<li>Allowing end-user customization of the CLI</li>
</ul>
<p>However, this API</p>
<ul>
<li>Defers errors from compile time to runtime. For some users, this has cost a lot of time and money during critical parts because of mismatches between their file and the code</li>
<li>We can't leverage any of the compile time deprecation messages to help users migrate</li>
<li>I have a strong suspicion there are several bugs in it due to our lack of attention to testing this to the same degree as the builder and derive APIs</li>
<li>There is a constant impact on maintaining clap to make sure all of our changes are exposed in YAML correctly with sufficient documentation.  On top of this, the existing documentation was inline with the builder API, adding extra noise for a builder user to have to sift through to get what they needed.</li>
<li>Has few enough users, I suspect who would be burdened by switching to one of the other APIs  that it doesn't justify taking resources away from moving clap forward.</li>
</ul>
<p>If users want to keep the YAML API alive, a suggested path forward</p>
<ul>
<li>Fork YAML support in clap3 as clap_yaml and release it as a 1.0</li>
<li>Pull in changes that were removed from clap3, like<ul>
<li>88fff13e</li>
<li>9031deb8</li>
<li>3f9da047</li>
</ul>
</li>
<li>Release a 2.0</li>
</ul>
<p>See also https://github.com/aobatact/clap-serde</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @epage on 2021-12-08 17:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-08 17:08</div>
            <div class="timeline-body"><p>Deprecated in 6ce9714e</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2021-12-08 17:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1416.html">clap-rs/clap#1416</a> on 2021-12-08 20:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3011.html">clap-rs/clap#3011</a> on 2021-12-08 20:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2409.html">clap-rs/clap#2409</a> on 2021-12-08 20:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1338.html">clap-rs/clap#1338</a> on 2021-12-08 20:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/853.html">clap-rs/clap#853</a> on 2021-12-08 20:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1337.html">clap-rs/clap#1337</a> on 2021-12-08 21:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ilyvion">@ilyvion</a> on 2021-12-09 04:55</div>
            <div class="timeline-body"><p>Why do all the comments in the code say &quot;deprecated in issue #9&quot; when that issue has nothing to do with YAML or deprecation?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../tauri-apps/tauri/pulls/3051.html">tauri-apps/tauri#3051</a> on 2021-12-09 10:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-09 12:43</div>
            <div class="timeline-body"><blockquote>
<p>Why do all the comments in the code say &quot;deprecated in issue #9&quot; when that issue has nothing to do with YAML or deprecation?</p>
</blockquote>
<p>I missed updating those references.  There was work being done in another org for a short period of time.  I'll go update those.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3111.html">clap-rs/clap#3111</a> on 2021-12-09 15:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1630.html">clap-rs/clap#1630</a> on 2021-12-09 16:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../quickwit-oss/quickwit/issues/880.html">quickwit-oss/quickwit#880</a> on 2021-12-10 14:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/HitomiTenshi">@HitomiTenshi</a> on 2021-12-12 03:00</div>
            <div class="timeline-body"><p>Hi, I'm an avid YAML user and am really disappointed that YAML is getting deprecated! ‚òπÔ∏è I would be glad if it could be continued as a separate crate like you suggested @epage</p>
<p>The YAML configuration positives outweigh the negatives for me greatly:</p>
<ul>
<li>Ease of use and fast iterations during development</li>
<li>Clean separation of clap code and actual application logic. (Very important for me!)</li>
<li>The YAML configuration file makes it look like a clean description of all the commands the app provides, while at the same time registering all these commands in one go!</li>
</ul>
<p>I'm all for easy to use, clean and readable code and this is what the YAML configuration provided for me.</p>
<p>Yes, there are a bunch of downsides, but I'm fine with them for the above reasons.</p>
<p>Even though I'm just one developer that uses clap in my own projects (e. g. <a href="https://github.com/HitomiTenshi/dekinai">Dekinai</a>) I hope that you will reconsider supporting YAML in future clap versions. üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-12 03:13</div>
            <div class="timeline-body"><blockquote>
<p>Ease of use and fast iterations during development</p>
</blockquote>
<p>Are you loading the yaml file at compile time or runtime?  The latter offers the faster iteration while the former keeps single-file binaries.  Just wanting to better understand how much faster iteration you are getting.</p>
<blockquote>
<p>Clean separation of clap code and actual application logic. (Very important for me!)
The YAML configuration file makes it look like a clean description of all the commands the app provides, while at the same time registering all these commands in one go!</p>
</blockquote>
<p>What are your thoughts on the Derive API?  I feel like it similarly accomplishes these.</p>
<p>I am interested in hearing more about in which ways you appreciate yaml helping separate clap / app logic and why it is important.  I can make guesses as to what you are referring to but would rather hear what you are actually aiming for than living with assumptions :).`</p>
<blockquote>
<p>I hope that you will reconsider supporting YAML in future clap versions</p>
</blockquote>
<p>Would you be willing to help maintain a <code>clap_yaml</code> or <code>clap_serde</code> crate?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/HitomiTenshi">@HitomiTenshi</a> on 2021-12-12 22:25</div>
            <div class="timeline-body"><blockquote>
<p>Just wanting to better understand how much faster iteration you are getting.</p>
</blockquote>
<p>With fast iterations I actually meant being able to iterate through changes (try out changes) very quickly during development. I'm not too concerned about any performance hits that clap would cause, because these would only affect application start time. I'm using the <code>load_yaml!</code> macro, which loads the <code>yaml</code> file during compile time if I understood correctly. Compilations are so fast (even with <code>load_yaml</code>'s compile time increase), that I didn't have any complaints during development or in production.</p>
<blockquote>
<p>What are your thoughts on the Derive API? I feel like it similarly accomplishes these.</p>
</blockquote>
<p>I've looked through <a href="https://github.com/clap-rs/clap/blob/master/examples/derive_ref/README.md">this documentation</a> and also some examples and I would not use it. My goal is to not clutter <code>.rs</code> files with too much &quot;boilerplate logic&quot;, and anything related to CLI commands / arguments / help falls for me under that category. Most applications need CLI stuff and I'm not a fan of reinventing the wheel everytime I develop a new app, that's why I decided to use <code>clap</code> with the <code>yaml</code> config, as it is as much out of my way as possible.</p>
<p>This is what bugs me about the Derive API:</p>
<ul>
<li>It requires me to create special structs for the CLI stuff</li>
<li>If my structs are logically separated in various files it makes it harder to see the full picture of what the CLI is going to end up displaying.</li>
<li>My structs are harder to read and understand becuase CLI related stuff is above every property.</li>
</ul>
<blockquote>
<p>I am interested in hearing more about in which ways you appreciate <code>yaml</code> helping separate clap / app logic and why it is important.</p>
</blockquote>
<p>I like it because:</p>
<ul>
<li>The whole CLI &quot;boilerplate logic&quot; is contained in one single <code>yaml</code> file.<ul>
<li>All of the CLI logic and what it's going to display can be found in this single file.</li>
</ul>
</li>
<li>The <code>yaml</code> file structure is very easy to read and understand.</li>
<li>I need just a single line to load all of the <code>matches</code> from the CLI arguments:</li>
</ul>
<pre><code class="language-rust">let matches = App::from(load_yaml!(&quot;cli.yaml&quot;)).get_matches();
</code></pre>
<ul>
<li>Even the CLI restrictions (e. g. required arguments, default values, environment variables, etc.) can be declared inside the <code>yaml</code> file.</li>
<li>Once the matches are loaded I can just create my structs from it and I'm already done. All of the checks (e. g. required fields and default values) were already taken care of in the <code>yaml</code> configuration.</li>
</ul>
<p>I over-simplified the last argument, a lot of the times you still have to do checks afterwards (e. g. if you have a directory argument you might need to check if the directory exists), but you have to do these checks with all of the other methods of loading <code>clap</code> matches as well, so overall it's still less &quot;boilerplate logic&quot;.</p>
<blockquote>
<p>Would you be willing to help maintain a clap_yaml or clap_serde crate?</p>
</blockquote>
<p>Unfortunately no. I personally do not want to be a maintainer of public crates. Sorry!</p>
<p>I hope this was enough to answer all of your questions. Maybe it's best if you wait for other people to chime in once everyone gets wind of this change. üòÑ I just got here early because I use the <code>clap</code> master branch on one of my projects.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../AFLplusplus/LibAFL/pulls/420.html">AFLplusplus/LibAFL#420</a> on 2021-12-13 18:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pvshvp-oss">@pvshvp-oss</a> on 2021-12-20 06:57</div>
            <div class="timeline-body"><p>YAML was nice to have. I use it too. It helped me separate out the CLI boilerplate from the main code. I am disappointed to see it go :(</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tshepang">@tshepang</a> on 2021-12-20 07:14</div>
            <div class="timeline-body"><p>I think it works well as a separate component... I always thought it overkill to have it as part of clap.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/HitomiTenshi">@HitomiTenshi</a> on 2021-12-20 13:45</div>
            <div class="timeline-body"><p>@tshepang Well it is behind an optional feature flag in v3 (not part of default features), so you usually wouldn't compile it unless you specifically included it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tshepang">@tshepang</a> on 2021-12-20 14:33</div>
            <div class="timeline-body"><blockquote>
<p>Unfortunately no. I personally do not want to be a maintainer of public crates. Sorry!</p>
</blockquote>
<p>why not</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/HitomiTenshi">@HitomiTenshi</a> on 2021-12-20 14:36</div>
            <div class="timeline-body"><blockquote>
<p>why not</p>
</blockquote>
<p>Because I do not want to do it. It's that simple. No excuses here. üòú</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MitaliBo">@MitaliBo</a> on 2021-12-22 04:35</div>
            <div class="timeline-body"><p>I also liked yaml way of parsing the cli arguments and have you main logic only in .rs file. It was so convenient to read and quickly add a new subcommand and args, even the person do not have much knowledge of rust code can do it . Very disappointed to see that its support is discontinued :( Probably i would like to maintain it as separate crate if i see there are avid users of it like me :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DuckEater54">@DuckEater54</a> on 2022-01-01 18:59</div>
            <div class="timeline-body"><p>Is there any decent crate released for clap with yaml yet? Also, how would you use the clap::Parser trait to parse and run a yaml file for your clap app</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-01-02 01:48</div>
            <div class="timeline-body"><blockquote>
<p>Is there any decent crate released for clap with yaml yet?</p>
</blockquote>
<p>The most I've seen is @MitaliBo posting right before you expressing interest in starting such a crate.</p>
<p>btw something that might be of interest is rustdoc's unstable json output could possibly be used to help seed some code-gen for a yaml parser which could help in keeping yaml support up-to-date.  The main problem with it at the moment is it panics on clap, see https://github.com/crate-ci/cargo-api/issues/3.</p>
<blockquote>
<p>Also, how would you use the clap::Parser trait to parse and run a yaml file for your clap app</p>
</blockquote>
<p>At the moment, there is no integration between <code>clap::Parser</code> and YAML support.  Clap 3's yaml support is nearly exactly what it was for clap 2.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/abakay">@abakay</a> on 2022-01-03 04:20</div>
            <div class="timeline-body"><p>Besides all previous very important points: reduce boilerplate code, easy to read/maintain all command-line options meta info in one clear <code>YAML</code> file, etc. I want to highlight other point. Because it is easy to parse <code>YAML</code> file and get some meta data (like command-line option names, etc.), it was very easy/ergonomic to merge <code>clap</code> parsing results with other parsers from other sources (file, environment variables, etc.). Please see the following crate for examples: <a href="https://crates.io/crates/irx-config">irx-config</a>.</p>
<p>Without programmatic API to get meta info from <code>clap</code> parser, it will greatly increase the amount of boilerplate code and could/will create potential discrepancies if users will have to specify some meta info twice manually vs program will read such meta info from same source (aka <code>YAML</code> file).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-01-03 17:34</div>
            <div class="timeline-body"><blockquote>
<p>Without programmatic API to get meta info from clap parser, it will greatly increase the amount of boilerplate code and could/will create potential discrepancies if users will have to specify some meta info twice manually vs program will read such meta info from same source (aka YAML file).</p>
</blockquote>
<p>You can also read metadata from a <code>clap::App</code> which also works with derives because deriving <code>Parser</code> also derives <code>IntoApp</code> which allows you to call <code>IntoApp::into_app</code> to get a <code>clap::App</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-01-05 18:13</div>
            <div class="timeline-body"><p>Just noticed that tauri has its own serde api on top of clap.  While not the most efficient design (serializes into structs . and then uses the builder), it might be a good starting point for generalizing the API.</p>
<ul>
<li><a href="https://github.com/tauri-apps/tauri/blob/45eba33dc1befa8b3902ae703b5298609e54ccd9/tooling/cli.rs/schema.json">schema</a></li>
<li><a href="https://github.com/tauri-apps/tauri/blob/71ea86a443f2585fa98edd79f2361bd85b380f0c/core/tauri-utils/src/config.rs">serde definitions</a> and <a href="https://github.com/tauri-apps/tauri/blob/62182383de59a6ead275ba8e85f010b2a0704832/tooling/cli.rs/config_definition.rs">and a copy of it</a></li>
<li><a href="https://github.com/tauri-apps/tauri/blob/639fcad3075f555e9abab872a811911a5fd1822e/core/tauri/src/api/cli.rs">convert from serde to builder</a></li>
</ul>
<p>Seems to be using fairly standard licenses.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../jsinger67/parol/issues/10.html">jsinger67/parol#10</a> on 2022-01-06 13:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Licenser">@Licenser</a> on 2022-01-11 11:54</div>
            <div class="timeline-body"><p>I understand the reasoning, but doing an impactful change like deprecating an entire feature with a one day comment period right at the end of a beta before release is quite painful for users :( for future versions could large changes like that be at least announced early on in the beta/RC candidate phase it'd make it easier to deal with for users.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tshepang">@tshepang</a> on 2022-01-11 14:48</div>
            <div class="timeline-body"><p>I would be more sympathetic if this was a removal, but it is a mere deprecation, something that also acts as an honest indicator of where things stand... doing otherwise would be misleading. I also think maintainers should be allowed to break beta releases at any time, and I don't think the deprecation was done 'late' deliberately.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-01-11 15:10</div>
            <div class="timeline-body"><p>A couple of points</p>
<ul>
<li>There were some specific unique circumstances around development in this case<ul>
<li>Most other cases have issues in this repo earlier in the process.  For example, you can see <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+is%3Aopen+label%3AM-breaking-change">all our proposed breaking changes</a> and <a href="https://github.com/clap-rs/clap/milestone/78">what we are considering breaking specifically for 4.0</a></li>
<li>We are still considering the best way to track what our &quot;focus&quot; areas are which will also help people focus their feedback on what is coming soon (tag? project board? not milestones, they are more release-based)</li>
</ul>
</li>
<li>Lines of communication in open source are difficult.  A recent example of this is the Python <code>cryptography</code> package moving to Rust, &quot;breaking&quot; people.  Deprecation messages are our clearest, most complete way of communicating this<ul>
<li>My hope is we can more smoothly go through major releases such that we will have minimal to no beta / RC releases in the future.  Most development should focus on deprecations / feature flags.</li>
</ul>
</li>
<li>We did give 23 days between issue creation and release, the more relevant time window since the release is what locks us in for a period of time.  That 23 days was not even prescribed; we would have held it up if 3.0 was not deemed ready yet due to any outstanding breakages or major regressions.</li>
<li>This is also a fairly special change in that there isn't much room for feedback.  This is a wholly distinct API with its own design, documentation, and stability needs and considerations.  This doesn't belong in clap.  The only alternative on the table is <strong>we</strong> jump start the split out into a new crate.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Licenser">@Licenser</a> on 2022-01-11 16:40</div>
            <div class="timeline-body"><p>Ja, I got that wrong two things overlapped <code>from</code> was turned into <code>from_yaml</code> so that and the deprication warning message made me think this was removed not just depricated :) sorry about that - it was just marked as depricated so my frustration was misplaced .</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../ferjm/opentok-rs/pulls/7.html">ferjm/opentok-rs#7</a> on 2022-01-17 11:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/aobatact">@aobatact</a> on 2022-01-21 13:37</div>
            <div class="timeline-body"><p>I made a crate for deserializing clap. https://crates.io/crates/clap-serde</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-01-21 13:46</div>
            <div class="timeline-body"><p>Sounds great!</p>
<p>I tried to look into the details but it looks like the repo link is broken.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/aobatact">@aobatact</a> on 2022-01-21 15:25</div>
            <div class="timeline-body"><p>Oh I forgot it to make it public...
https://github.com/aobatact/clap-serde</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-01-21 15:50</div>
            <div class="timeline-body"><p>@aobatact I've done a quick pass over it and noted some things.  I've also</p>
<ul>
<li>linked to it from the original issue to help raise visibility</li>
<li>added it to the <a href="https://github.com/clap-rs/clap/blob/master/docs/FAQ.md#how-many-approaches-are-there-to-create-a-parser">list of experimental APIs</a></li>
</ul>
<p>Once you feel its in a good enough state, we can raise the visibility further, like linking to it from the README/docs.rs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3743.html">clap-rs/clap#3743</a> on 2022-05-23 20:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3901.html">clap-rs/clap#3901</a> on 2022-07-11 22:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../immunant/c2rust/issues/395.html">immunant/c2rust#395</a> on 2022-10-13 21:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../glecaros/bf/issues/7.html">glecaros/bf#7</a> on 2023-06-16 16:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:34:44 UTC
    </footer>
</body>
</html>
