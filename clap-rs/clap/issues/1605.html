<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arguments with default values conflict even if not used - clap-rs/clap #1605</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Arguments with default values conflict even if not used</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/1605">#1605</a>
        opened by <a href="https://github.com/0ndorio">@0ndorio</a>
        on 2019-12-09 13:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/0ndorio">@0ndorio</a> on 2019-12-09 13:56</div>
            <div class="timeline-body"><p><strong>Attention:</strong> This is directly related to https://github.com/clap-rs/clap/issues/1071</p>
<p>The original issue was already marked as fixed but it seems like the bug was not fully eliminated.</p>
<hr />
<h3>Rust Version</h3>
<ul>
<li>rustc 1.39.0 (4560ea788 2019-11-04)</li>
</ul>
<h3>Affected Version of clap</h3>
<ul>
<li>v2.33.0</li>
<li>latest master (a2f9fb5f6c2aeeac89c5c638f25dedb9e50bde00)</li>
</ul>
<h3>Expected Behavior Summary</h3>
<p>I expect conflicts to happen only when conflicting arguments are explicitly present on the command line.</p>
<h3>Actual Behavior Summary</h3>
<p>As mentioned in https://github.com/clap-rs/clap/issues/1071 originally it was enough for an argument to have a <code>default_value</code> configured to cause a conflict. This was fixed with 58b5b4be315280888d50d9b15119b91a9028f050 but it seems like the fix only applied to cases where <code>defaults</code> and <code>conflicts_with</code> are present on different arguments. As <code>conflicts_with</code> automatically applies to both related arguments it is also possible to apply the option the argument with the <code>default</code> option.</p>
<p>This again triggers the same error message as the original issue.</p>
<h3>Sample Code or Link to Sample Code</h3>
<pre><code class="language-rust">use clap::{App, Arg}; // 2.33.0

fn main() {
    let result = App::new(&quot;conflict&quot;)
        .arg(Arg::from_usage(&quot;-o, --opt=[opt] 'some opt'&quot;)
            .default_value(&quot;default&quot;)
            .conflicts_with(&quot;flag&quot;))
        .arg(Arg::from_usage(&quot;-f, --flag 'some flag'&quot;)
            .conflicts_with(&quot;opt&quot;))
        .get_matches_from_safe(vec![&quot;myprog&quot;, &quot;-f&quot;]);
        
    eprintln!(&quot;{:#?}&quot;, result);
    
    assert!(result.is_ok());
    let m = result.unwrap();
    
    assert_eq!(m.value_of(&quot;opt&quot;), Some(&quot;default&quot;));
    assert!(m.is_present(&quot;flag&quot;));
}
</code></pre>
<p>https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=9913e0f7a7905f7be0131ae53ef4ec63</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1604.html">clap-rs/clap#1604</a> on 2019-12-09 13:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @CreepySkeleton on 2020-02-01 11:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.0" by @CreepySkeleton on 2020-02-01 11:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v3.0.0-alpha.3" by @CreepySkeleton on 2020-02-01 11:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P1: urgent</span> added by @CreepySkeleton on 2020-02-01 11:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @CreepySkeleton on 2020-02-01 11:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @CreepySkeleton on 2020-02-01 11:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.0.0-beta.2" by @pksunkara on 2020-04-07 13:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @pksunkara on 2020-04-07 13:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> removed by @pksunkara on 2020-04-09 08:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: args</span> added by @pksunkara on 2020-04-09 08:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/1869.html">clap-rs/clap#1869</a> on 2020-04-26 17:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @bors[bot] on 2020-04-26 18:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1906.html">clap-rs/clap#1906</a> on 2020-05-05 19:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../diesel-rs/diesel/pulls/2401.html">diesel-rs/diesel#2401</a> on 2020-10-10 19:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/svenfoo">@svenfoo</a> on 2020-11-05 11:44</div>
            <div class="timeline-body"><p>If I understand the history of this ticket correctly, the bug is <strong>still present in the latest stable release</strong>, which is <code>2.33.3</code> at this point, and <strong>fixed in 3.0</strong>, which is still in <code>beta</code> at this point, right?</p>
<p>Just asking because it seems that I just ran into it using clap 2.33.3.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-11-05 11:53</div>
            <div class="timeline-body"><p>Yes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1586.html">clap-rs/clap#1586</a> on 2021-08-09 02:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../chronicleworks/chronicle/pulls/144.html">chronicleworks/chronicle#144</a> on 2022-12-21 12:15</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:07 UTC
    </footer>
</body>
</html>
