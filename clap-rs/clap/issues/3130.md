```yaml
number: 3130
title: Parse command line on existing config instance
type: issue
state: closed
author: epage
labels:
  - A-derive
assignees: []
created_at: 2021-12-09T16:34:03Z
updated_at: 2021-12-09T16:40:45Z
url: https://github.com/clap-rs/clap/issues/3130
synced_at: 2026-01-10T01:57:46Z
```

# Parse command line on existing config instance

---

_Issue opened by @epage on 2021-12-09 16:34_

<a href="https://github.com/Morganamilo"><img src="https://avatars.githubusercontent.com/u/16593899?v=4" align="left" width="96" height="96" hspace="10"></img></a> **Issue by [Morganamilo](https://github.com/Morganamilo)**
_Saturday Jul 25, 2020 at 10:26 GMT_
_Originally opened as https://github.com/TeXitoi/structopt/issues/416_

----

There have been a couple of issues to allow parsing from a config file.

What I want is something more flexible. Instead of having to do `Config::from_args()`, I would Like to be able to do. `let mut config = Config::new(); config.parse_args()`.

This would allow for config parsing and any other processing to happen before parsing arguments.

```rust
let mut config = Config::new();
config.parse_config(config_file);
config.parse_args();
```


---

_Comment by @epage on 2021-12-09 16:34_

<a href="https://github.com/CreepySkeleton"><img src="https://avatars.githubusercontent.com/u/50968528?v=4" align="left" width="48" height="48" hspace="10"></img></a> **Comment by [CreepySkeleton](https://github.com/CreepySkeleton)**
_Sunday Jul 26, 2020 at 19:34 GMT_

----

Could you please say a few more words? Your comment doesn't give me any useful context or new information. Most importantly, I would appreciate an elaborated explanation of how your request is different from #72 .


---

_Comment by @epage on 2021-12-09 16:34_

<a href="https://github.com/Morganamilo"><img src="https://avatars.githubusercontent.com/u/16593899?v=4" align="left" width="48" height="48" hspace="10"></img></a> **Comment by [Morganamilo](https://github.com/Morganamilo)**
_Sunday Jul 26, 2020 at 19:48 GMT_

----

#72 seems to want to integrate with some config parsing crate.

I simply want the Structopt trait to be able to operate on an already existing struct instance. While `from_args()` creates the struct for  you, I want `parse_args()` to take in `&mut self` instead.

In my example above `parse_config()` is unrelated to structopt and would be a function implemented myself.

```rust
let mut config = Config::new(); // create an instance of my struct that implements Structopt
config.parse_config(config_file); // my own config parsing, make sure we do this before arg parsing so args have priority
config.parse_args(); //  structopt now modifies the struct and applies the arguments on top of the existing values
```


---

_Comment by @epage on 2021-12-09 16:34_

<a href="https://github.com/CreepySkeleton"><img src="https://avatars.githubusercontent.com/u/50968528?v=4" align="left" width="48" height="48" hspace="10"></img></a> **Comment by [CreepySkeleton](https://github.com/CreepySkeleton)**
_Monday Jul 27, 2020 at 05:32 GMT_

----

I see. I don't think I'll ever be working on it (I'm simply not interested), but I'd approve such a PR. 

We will need to decide on the precise specification (update vs replace aka `config[true] + args[false] = false` vs `= true`) and the signature (the `parse_args` takes `enum { Replace, Update }`), but I think we can discuss it when somebody has actually stepped in and volunteered. 

This should also solve #72 as "good enough" solution. 


---

_Comment by @epage on 2021-12-09 16:37_

The new update API I think covers this

---

_Closed by @epage on 2021-12-09 16:37_

---

_Label `A-derive` added by @epage on 2021-12-09 16:40_

---
