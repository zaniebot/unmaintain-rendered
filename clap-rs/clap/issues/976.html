<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support overrides_with(&quot;itself&quot;) - clap-rs/clap #976</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support overrides_with(&quot;itself&quot;)</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/976">#976</a>
        opened by <a href="https://github.com/ericbn">@ericbn</a>
        on 2017-05-29 23:02
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ericbn">@ericbn</a> on 2017-05-29 23:02</div>
            <div class="timeline-body"><p>Suppose I have defined these:</p>
<pre><code>.arg(flag(&quot;foo&quot;).overrides_with(&quot;foo&quot;))
.arg(flag(&quot;bar&quot;).overrides_with(&quot;bar&quot;).takes_value(true).possible_values(&amp;[&quot;0&quot;, &quot;1&quot;, &quot;2&quot;]))</code></pre>
<p>I'd like to allow the options to be able to be defined multiple times, the last one overriding previous ones.</p>
<p>So a call with options <code>--foo --foo --foo --bar=0 --bar=1 --bar=2</code> will not fail with <code>error: The argument '--foo' was provided more than once, but cannot be used multiple times</code> (or the same for <code>--bar</code>), and both foo, and bar with value 2 would be yield (resulting in the same as calling with only <code>--foo --bar=2</code>).</p>
<p>Or even better, maybe a <code>.setting(AppSettings::POSIX)</code> defined once would enable the previous behavior. Why would defining the same option twice or more yield an error? I just played with some command line tools here (<code>git status --short --short --short</code>, <code>ls -l -l -l</code>, <code>vi -R -R -R README.md</code>) and none complains of options provided multiple times...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/970.html">clap-rs/clap#970</a> on 2017-05-29 23:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: parsing</span> added by @kbknapp on 2017-05-30 00:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: intermediate</span> added by @kbknapp on 2017-05-30 00:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> added by @kbknapp on 2017-05-30 00:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @kbknapp on 2017-05-30 00:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @kbknapp on 2017-05-30 00:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-05-30 00:24</div>
            <div class="timeline-body"><p>Thanks! I like the <code>AppSettings</code> idea too as defining all args as overridable by themselves would be handy.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ericbn">@ericbn</a> on 2017-05-30 12:06</div>
            <div class="timeline-body"><p>Cool. Actually the <a href="http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap12.html">POSIX specifications</a> don't state nothing about overriding arguments. But the way the <a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/getopt.html">POSIX implementation</a> usually involves a loop through the arguments, same arguments just get a count increment or override the previous assigned one.</p>
<p>Maybe the AppSettings could be something more explicit than just <code>AppSettings::POSIX</code>...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../BurntSushi/ripgrep/pulls/499.html">BurntSushi/ripgrep#499</a> on 2017-06-01 23:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../BurntSushi/ripgrep/issues/491.html">BurntSushi/ripgrep#491</a> on 2017-06-02 00:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../BurntSushi/ripgrep/issues/553.html">BurntSushi/ripgrep#553</a> on 2017-07-13 02:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../ogham/exa/issues/152.html">ogham/exa#152</a> on 2017-08-04 19:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lilyball">@lilyball</a> on 2017-08-04 19:19</div>
            <div class="timeline-body"><p>There definitely should be an <code>AppSetting</code> for this (<code>POSIX</code> isn't a good name for this, maybe <code>AppSetting::AllowDuplicateFlags</code>?). And I suppose a per-arg setting as well, in case you want to e.g. allow it in general but disallow it on certain flags that take arguments (for example, you'd probably want to allow it on flags that take arguments specifying config values, e.g. sort options, but disallow it on flags that take arguments specifying input files).</p>
<p><a href="https://github.com/ogham/exa/">exa</a> just ran into this issue with its argument parsing (which was getopts), and it looks like their solution is to <a href="https://github.com/ogham/exa/issues/152#issuecomment-320224452">implement a custom argument parser</a>.</p>
<p>And it looks like ripgrep also <a href="https://github.com/BurntSushi/ripgrep/issues/553">hit this limitation</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-02-03 03:22</div>
            <div class="timeline-body"><p><a href="https://twitter.com/burntsushi5/status/959624525368487939">This tweet</a> got me thinking about this issue some more, and I'm thinking that because of the new lazy validation I'm doing this could actually be an easy add, and easily forward portable to the v3-master branch. I'm going to take a look at this tomorrow see and if it's as easy as I think it'll be.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "2.29.3" by @kbknapp on 2018-02-03 03:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/1164.html">clap-rs/clap#1164</a> on 2018-02-05 01:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2018-02-05 03:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1037.html">clap-rs/clap#1037</a> on 2018-02-05 03:30</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:07 UTC
    </footer>
</body>
</html>
