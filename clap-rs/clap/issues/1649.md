```yaml
number: 1649
title: Allow boolean literals as values for flags
type: issue
state: closed
author: emilk
labels:
  - C-enhancement
  - S-waiting-on-decision
  - A-parsing
assignees: []
created_at: 2020-01-31T11:04:32Z
updated_at: 2024-06-03T11:15:32Z
url: https://github.com/clap-rs/clap/issues/1649
synced_at: 2026-01-10T01:57:43Z
```

# Allow boolean literals as values for flags

---

_Issue opened by @emilk on 2020-01-31 11:04_

The behavior of `--flag=false` setting the flag to the value `true` has caused problems for me many times. The problem is that boolean arguments are treated differently than arguments of other types.

As an example, say you have a few arguments to your program being called from someplace like so:

`my_app --name=${name} --age=${age} --alive=${alive}`

The first two will work as expected, but the third will be a bug with no error or warning message. This special case for the boolean type is very annoying. I would advocate a more orthogonal design.

Here is my suggestion for how to parse boolean flags:

| Argument       | Flag value            |
| -------------- | --------------------- |
| empty | `false` |
| `--flag`       | `true`                |
| `--flag=true`  | `true`                |
| `--flag=false` | `false`               |
| `--flag=other` | Helpful error message |


The problem with this comes when considering how to treat other potential ways to express boolean, e.g. `0/1`, `no/yes`, `False/True`. We could add these as well to the above table, or stick to the Rust convention (`true/false`). Either way would work for me.

In summary: the principle of least surprise suggests that if `--int=42` should work the same as `--bool=false`.

---

_Comment by @TeXitoi on 2020-01-31 12:35_

https://github.com/TeXitoi/structopt/issues/212#issuecomment-561093886

---

_Comment by @CreepySkeleton on 2020-02-01 14:27_

@emilk Could you please provide an exact snippet of code you're having the problem with? Along with expected/actual behavior.

---

_Label `T: RFC / question` added by @pksunkara on 2020-02-01 19:30_

---

_Label `C: args` added by @pksunkara on 2020-02-01 19:31_

---

_Renamed from "--flag=false" to "Allow boolean literals as values for flags" by @pksunkara on 2020-02-01 19:31_

---

_Comment by @pksunkara on 2020-02-01 19:34_

Possible solution is to have a setting which allows flags to also allow boolean literals as values.

---

_Added to milestone `3.1` by @pksunkara on 2020-02-01 19:34_

---

_Label `C: args` removed by @CreepySkeleton on 2020-07-07 19:47_

---

_Label `T: RFC / question` removed by @CreepySkeleton on 2020-07-07 19:47_

---

_Label `C: flags` added by @CreepySkeleton on 2020-07-07 19:47_

---

_Label `C: validators` added by @CreepySkeleton on 2020-07-07 19:47_

---

_Label `W: maybe` added by @CreepySkeleton on 2020-07-07 19:47_

---

_Comment by @colemickens on 2020-07-20 08:30_

If there's a workaround someone could share, that would be great (I was wondering if maybe it's possible with the builder, or a custom parser? It seems like structopt has a way, but I can't find such functionality in clap at first glance).

To elaborate on justification for this bug... It *is* more than just surprising behavior. From what I can tell, it actively prevents certain designs. For example, I have a flag that *really* should be on by default (`--create-users`) and I don't want a `--dont-create-users` flag, I really want the user to have to say `--create-users=false` if they are expert enough to opt-out.

---

_Comment by @CreepySkeleton on 2020-07-20 19:00_

You couldn't find this functionality because it doesn't exist.

The key is that flags do not take value in clap, period. Flags that take value are called options. Options can be either present (possibly with a number of values following) or not. There's no notion of "if this option has one value and the value equals `false` then pretend that the option wasn't present". 

`structopt` can do it because it applies postprocessing - conversion - to the values, and what you observe is result of the conversion. It doesn't change the fact that the option was actually present. You can simulate it with 
```rust
// create an option with optional value
Arg::new("pseudo-flag")
    .possible_values(&["true", "false"])
    .long("foo")
    .min_values(0)
    .max_values(1)
    
/// ...

let setting = app.value_of("pseudo-flag") != Some("false");
```

---

_Comment by @colemickens on 2020-07-22 05:35_

Thank you for the detailed explanation @CreepySkeleton, I hadn't quite understood the important distinction between "options" and "flags". It turns out, this also works, since I prefer explicit boolean options over "flags" -- https://github.com/clap-rs/clap/blob/dd5e6b23131f16ef8b090a8482f1b97c6a693498/clap_derive/examples/true_or_false.rs

---

_Comment by @dimo414 on 2021-02-05 07:17_

#815 is related and might eliminate the need for boolean literals.

---

_Referenced in [clap-rs/clap#2539](../../clap-rs/clap/issues/2539.md) on 2021-07-21 15:32_

---

_Referenced in [clap-rs/clap#2619](../../clap-rs/clap/pulls/2619.md) on 2021-07-24 21:39_

---

_Comment by @ldm0 on 2021-07-31 09:11_

I don't think clap needs to do something for this specific behaviour, you can get this behaviour by using `default_missing_value` and parsing later. 

Here is the demo: 
https://github.com/clap-rs/clap/pull/2649/files#diff-cf9f91bfd0a1de87f6e066071af5d05182179587e65ec540ed4cfba30ec1709bR113 

---

_Closed by @pksunkara on 2021-08-01 11:31_

---

_Comment by @rami3l on 2021-08-01 20:56_

@pksunkara Sorry, I changed my PR #2619 description to close another issue other than this, but I didn't reword the commit. Would you mind reopening this one?

---

_Reopened by @pksunkara on 2021-08-01 20:56_

---

_Comment by @epage on 2021-08-02 15:50_

Now that #2619 is merged, we have an example for how to use clap's existing API for accomplishing the request in this Issue (taken taken from a previous comment).

Is this sufficient for resolving the need here or is there still interest in there being some baked in way of getting this behavior (possibly controllable with a `ArgSetting` / `AppSetting`)?

---

_Comment by @rami3l on 2021-08-02 16:47_

@epage In the end, no new examples has been added to the examples folder, so this remains to be a problem.

The thing that I'm considering now is that, for env vars it seems that we almost certainly have to include a string-literal-to-bool mechanism (which I'm currently working on) to replace the presence check, since it's quite a common practice.

Later on, if that's included, in my opinion it's better to do the same with flag literals for the sake of consistency. Of course, it would be better if this behavior is optional, and controlled by a new settings item.

Thus, the previously mentioned methods should only be considered as a workaround to satisfy some very specific needs.

---

_Comment by @ldm0 on 2021-08-02 16:51_

> @epage In the end, no new examples has been added to the examples folder, so this remains to be a problem.
> 
> The thing that I'm considering now is that, for env vars it seems that we almost certainly have to include a string-literal-to-bool mechanism (which I'm currently working on) to replace the presence check, since it's quite a common practice.
> 
> Later on, if that's included, in my opinion it's better to do the same with flag literals for the sake of consistency. Of course, it would be better if this behavior is optional, and controlled by a new settings item.

Please check https://github.com/clap-rs/clap/blob/286fda0b4a243e19d73a254d2dc17c794f4320e5/tests/default_missing_vals.rs#L113-L141

I don't think it's necessary to do this in clap.

---

_Comment by @rami3l on 2021-08-02 17:14_

@ldm0 Thanks for your reference. Surely, I can see that this task can already be handled by the `clap` API with some handwritten validation functions.

I personally accept your solution, but the question that I really want to ask, is what level of API `clap` wants to provide for its users.

I wonder what a new user might guess about this library, and how we can guide them to get the solution that they want. That's all I care about. I chose a battery-included, opinionated approach, but you have the right to disagree, and as long as we keep being user-friendly, I'm satisfied with that outcome.

---

_Comment by @epage on 2021-08-02 17:59_

Sorry, missed that and hadn't caught up with your comment in #2539.

Personally, I see args and envs as separate entities that have their own context from a combination of history and user expectations.  We should be consistent within their context rather than forcing a consistency between things users generally have treated differently.

env vars have historically been C-like in using 0/1 or present/not-present.  More recently I feel like I've seen `true`/`false` used.  Hence the need for a `str2bool`.

For arguments, I've generally seen one of
- Present / not-present
- `--present`, `--no-present`
- `--name <enumeration>` with some being `yes`/`no`, `true`/`false`, `always`/`never`

Only in rare circumstances (`--color`) do I see any of these mixed.  I've also not seen an argument parsing library that has baked in support (default or not) for mixing these without going custom (like the suggested workarounds)

As I've mentioned before, variable number of arguments has been brittle enough that clap warns about it.  We can instead require an equals but I'm concerned about user confusion when some arguments need an `=` while others do not.

This issue and several others have been contributing a sense in me that we might want to re-think clap's API.  Clap's development has been fairly generous in supporting everyone's use cases but the API is designed such that to do so, means it all has to be baked into clap, creating a large API surface and making it harder to get the behavior you need.  After 3.0, I'm interested in exploring ways to allow people to customize the behavior of clap so that clap can be all things to all people without having to support all things out of the box.

---

_Comment by @rami3l on 2021-08-02 17:59_

@ldm0 So at least **something** should be added to the examples, whether it's the demo of a new feature or appropriate use of existing features. Since this is a decision that must be made carefully, it's always nice to have a discussion.

@epage Yeah, I also have the impression that the `clap` codebase is lacking appropriate reorganization. In this sense, I agree that we should make less stuff baked-in. It's always nice to have some good defaults though, even as an external extension.

---

_Comment by @epage on 2021-08-02 18:29_

> It's always nice to have some good defaults though, even as an external extension.

Fully agree.  Having better support for extending clap does not mean we leave it all in the users hands to build it themself.  That slipper slopes lead to there being no clap.

---

_Referenced in [clap-rs/clap#2664](../../clap-rs/clap/pulls/2664.md) on 2021-08-05 19:42_

---

_Comment by @nrdxp on 2021-11-18 19:21_

should this not be closed now that #2664 is merged?

---

_Comment by @hasezoey on 2021-11-18 19:36_

> should this not be closed now that #2264 is merged?

from what i can tell, #2264 is a issue, not a PR and does not look related - do you mean #2664?

---

_Comment by @nrdxp on 2021-11-18 19:53_

yes, was a typo sorry about that :sweat_smile: 

---

_Comment by @pksunkara on 2021-11-18 20:51_

No, that PR only deals with environment variables while this issue is also about converting option values into boolean. With our new direction regarding plugin based architecture post v3, this is a prime candidate for being made a plugin. 

---

_Referenced in [epage/clapng#133](../../epage/clapng/issues/133.md) on 2021-12-06 18:40_

---

_Label `C: validators` removed by @epage on 2021-12-08 20:22_

---

_Label `C: flags` removed by @epage on 2021-12-08 20:22_

---

_Label `A-parsing` added by @epage on 2021-12-08 20:22_

---

_Removed from milestone `3.1` by @epage on 2021-12-09 20:38_

---

_Label `C-enhancement` added by @epage on 2021-12-13 22:44_

---

_Comment by @bernardoaraujor on 2022-06-15 14:57_

the solution I found for this issue was to start using `flag: Option<bool>` instead of just `flag: bool`
that way, `--flag=false` gets the expected outcome and avoids confusion on the user's mind

downside is that I can't derive `default_value` (`error: default_value is meaningless for Option
`), so this workaround is also necessary:
```
let flag = match args.flag {
    Some(f) => f,
    None => false, // default
};
```

---

_Comment by @epage on 2022-06-15 15:46_

With clap 3.2, you can now override the bool behavior with `#[clap(action = ArgAction::Set)]`.

For example, from our test suite:
```rust
#[test]
fn override_implicit_action() {
    #[derive(Parser, PartialEq, Debug)]
    struct Opt {
        #[clap(long, action = clap::ArgAction::Set)]
        arg: bool,
    }

    assert_eq!(
        Opt { arg: false },
        Opt::try_parse_from(&["test", "--arg", "false"]).unwrap()
    );

    assert_eq!(
        Opt { arg: true },
        Opt::try_parse_from(&["test", "--arg", "true"]).unwrap()
    );
}
```

If you had concerns with the rough upgrade to clap 3.2, the deprecations are now off by default, see clap-rs/clap#3830 for details.  When you do start working through the deprecations as part of upgrading to 4.0, we've also improved the warnings for derive users.  See clap-rs/clap#3832 for examples.


---

_Referenced in [clap-rs/clap#3837](../../clap-rs/clap/pulls/3837.md) on 2022-06-15 16:11_

---

_Closed by @epage on 2022-06-15 16:47_

---

_Referenced in [Azure/azure-sdk-for-rust#993](../../Azure/azure-sdk-for-rust/pulls/993.md) on 2022-08-09 15:19_

---

_Referenced in [n0-computer/beetle#156](../../n0-computer/beetle/issues/156.md) on 2022-10-10 10:43_

---

_Comment by @jbtobar on 2022-10-20 23:20_

> ```rust
> action = clap::ArgAction::Set
> ```

this example is incredibly useful. Should probably be better documented. I just spent too long digging through issues, documentation, debugging, etc to achieve the pretty basic `--something=false` functionality on the `Parser` macro.

Thank you!

---

_Referenced in [SeaQL/sea-orm#1420](../../SeaQL/sea-orm/pulls/1420.md) on 2023-01-28 04:58_

---

_Referenced in [googlefonts/fontc#225](../../googlefonts/fontc/pulls/225.md) on 2023-03-30 17:19_

---

_Referenced in [samply/focus#20](../../samply/focus/pulls/20.md) on 2023-05-20 19:59_

---

_Referenced in [static-web-server/static-web-server#209](../../static-web-server/static-web-server/issues/209.md) on 2023-05-29 16:31_

---

_Referenced in [GlareDB/glaredb#1767](../../GlareDB/glaredb/pulls/1767.md) on 2023-09-25 18:51_

---

_Comment by @gibfahn on 2023-12-01 13:55_

I'm a bit confused by the resolution to this issue. I'm looking for something like the original post:

> | Argument  |	Flag value |
> | --- | --- |
> | empty |	`false` |
> | `--flag` |	`true`|
> |`--flag=true`	|`true`|
> |`--flag=false`	|`false`|
> |`--flag=other`	|Helpful error message|

Where the user can provide nothing (defaulting to `true`), or `--flag=true` or `--flag=false`, or not provide the flag at all (defaulting to either `true` or `false`), and the output is a `bool`. Anything else should error.

I can get this to work with `Option<bool>`:

```rust
    #[clap(
        long,
        default_missing_value = "true",
        require_equals = true,
        num_args(0..=1),
    )]
    pub(crate) flag: Option<bool>,
```

but I can't seem to work out how to get this to work with a plain `bool`, e.g.:

```rust
    #[clap(
        long,
        default_missing_value("true"),
        default_value("false"),
        num_args(0..=1),
        require_equals(true),
    )]
    pub(crate) flag: bool,
```

This fails with:

```
assertion `left == right` failed: Argument augment: mismatch between `num_args` (0..=1) and `takes_value`
  left: true
 right: false
```

Seems like there isn't a way to say "require equals or assume no argument passed".

---

__*EDIT:*__  actually if you do this:

```rust
    #[clap(
        long,
        default_missing_value("true"),
        default_value("true"),
        num_args(0..=1),
        require_equals(true),
    )]
    pub(crate) flag: Option<bool>,
```

then you get the default behaviour I'm looking for, so the `flag` value will never be `None`, but rather `Some(true)` if not set. It's a bit odd to have a non-optional option, but it works well enough.

---

_Comment by @epage on 2023-12-01 14:49_

Try
```rust
    #[clap(
        long,
        default_missing_value("true"),
        default_value("true"),
        num_args(0..=1),
        require_equals(true),
        action = ArgAction::Set,
    )]
    pub(crate) flag: bool,
```

---

_Comment by @gibfahn on 2023-12-01 20:42_

Ahh that works, thanks!

---

_Comment by @JasonkayZK on 2023-12-02 11:16_

> Try
> 
> ```rust
>     #[clap(
>         long,
>         default_missing_value("true"),
>         default_value("true"),
>         num_args(0..=1),
>         require_equals(true),
>         action = ArgAction::Set,
>     )]
>     pub(crate) flag: bool,
> ```

Thanks, this works for me. üëç 

And if you want default to be `false`, try this:

```rust
    #[clap(
        long,
        default_missing_value("true"),
        default_value("false"),
        num_args(0..=1),
        require_equals(true),
        action = ArgAction::Set,
    )]
    pub(crate) flag: bool,
```


---

_Referenced in [nrempel/sleek#48](../../nrempel/sleek/pulls/48.md) on 2024-01-20 03:00_

---

_Comment by @ctron on 2024-06-03 06:50_

Is there a way to get this without `require_equals`?

---

_Comment by @hasezoey on 2024-06-03 10:46_

The following works for me for the variations below:

```rust
#[derive(Parser, Debug)]
pub struct CLI {
  #[arg(
        long = "test",
        action = ArgAction::Set,
        default_value_t = true,
        // somehow clap has this option not properly supported in derive, so it needs to be a string
        default_missing_value = "true",
        num_args = 0..=1,
        require_equals = false,
    )]
    pub test: bool,
}
```

```sh
$ binary
test: true
$ binary --test
test: true
$ binary --test=false
test: false
# the following would not be possible with `require_equals = true`
$ binary --test false
test: false
$ binary --test true
test: true
```

clap 4.5.3

---

_Comment by @ctron on 2024-06-03 11:15_

Thanks for the pointer. I got it working the way I wanted it with:

```rust
#[arg(long, default_missing_value="true", num_args=0..=1)]
pub offline: Option<bool>,
```

Which results in:

| Args | Value |
| ---- | ---- |
| | `None` |
| `--offline`  | `Some(true)` |
| `--offline`, `true` | `Some(true)` |
| `--offline`, `false` | `Some(false)` |


---

_Referenced in [futureversecom/trn-seed#852](../../futureversecom/trn-seed/pulls/852.md) on 2024-06-17 02:53_

---

_Referenced in [succinctlabs/sp1#1431](../../succinctlabs/sp1/pulls/1431.md) on 2024-08-29 18:52_

---

_Referenced in [ceramicnetwork/rust-ceramic#562](../../ceramicnetwork/rust-ceramic/pulls/562.md) on 2024-10-21 18:48_

---

_Referenced in [MystenLabs/sui#20783](../../MystenLabs/sui/pulls/20783.md) on 2025-01-05 18:14_

---

_Referenced in [SeaQL/sea-orm#2509](../../SeaQL/sea-orm/pulls/2509.md) on 2025-02-23 22:53_

---

_Referenced in [prefix-dev/pixi#4466](../../prefix-dev/pixi/issues/4466.md) on 2025-08-30 05:06_

---
