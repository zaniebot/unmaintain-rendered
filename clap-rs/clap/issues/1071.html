<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arguments with default values conflict even if not used - clap-rs/clap #1071</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Arguments with default values conflict even if not used</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1071">#1071</a>
        opened by <a href="https://github.com/kornelski">@kornelski</a>
        on 2017-10-19 22:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kornelski">@kornelski</a></div>
            <div class="timeline-body"><h3>Expected Behavior Summary</h3>
<p>I expect conflicts to happen only when conflicting arguments are explicitly present on the command line.</p>
<h3>Actual Behavior Summary</h3>
<p>It's enough for an argument to have a <code>default_value</code> configured to cause a conflict.</p>
<h3>Sample Code or Link to Sample Code</h3>
<pre><code class="language-rust">extern crate clap;
use clap::*;

fn main() {
  App::new(&quot;prog&quot;)
    .arg(Arg::with_name(&quot;default&quot;)
        .takes_value(true)
        .default_value(&quot;default&quot;))
    .arg(Arg::with_name(&quot;exclusive&quot;)
        .long(&quot;exclusive&quot;)
        .conflicts_with(&quot;default&quot;))
    .get_matches_from(vec![
        &quot;prog&quot;, &quot;--exclusive&quot;
    ]);
}
</code></pre>
<p>I'd expect all of <code>prog --exclusive</code>, <code>prog --default</code> and <code>prog</code> (no args, meaning the default is used) to be allowed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-10-24 01:41</div>
            <div class="timeline-body"><p>Default values are provided regardless of whether or not an argument was used, so it's as if the arguments are <em>always</em> used.</p>
<p>Perhaps what your looking for is <a href="https://docs.rs/clap/2.26.2/clap/struct.Arg.html#method.default_value_if">conditional default values</a>?</p>
<p>What you're wanting can be accomplished in user code pretty easily as well.</p>
<pre><code class="language-rust">extern crate clap;
use clap::*;

fn main() {
  let matches = App::new(&quot;prog&quot;)
    .arg(Arg::with_name(&quot;default&quot;)
        .takes_value(true))
        //.default_value(&quot;default&quot;))
    .arg(Arg::with_name(&quot;exclusive&quot;)
        .long(&quot;exclusive&quot;)
        .conflicts_with(&quot;default&quot;))
    .get_matches_from(vec![
        &quot;prog&quot;, &quot;--exclusive&quot;
    ]);

   let default = matches.value_of(&quot;default&quot;).unwrap_or(&quot;default_value&quot;);
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> added by @kbknapp on 2017-10-24 01:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-10-24 01:42</div>
            <div class="timeline-body"><p>Technically speaking it's possible for clap to know if it was a default value or not that was used and simply ignore conflicts if so...but I'd need to hear more arguments for it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kornelski">@kornelski</a> on 2017-10-24 12:01</div>
            <div class="timeline-body"><p>I'm using <code>.default_value()</code> in order to have this value printed in the help screen. I could put that info in my help text and handle defaults myself, but that's a workaround.</p>
<p>I presume from implementation perspective the current behavior is more straightforward, but from user perspective I don't see any argument in favor of it, since a set of flags configured in a way that never works is of no use.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-10-24 12:16</div>
            <div class="timeline-body"><blockquote>
<p>[...]  I don't see any argument in favor of it, since a set of flags configured in a way that never works is of no use.</p>
</blockquote>
<p>I understand that, but I'm more wondering if there is a better way to solve this issue than adding additional logic in clap.</p>
<p>(Note: I'm not insulting your intelligence here because I know you're quite familiar with this project, but just to make sure we're on the same page :smile:) In clap speak:</p>
<ul>
<li>A default value is an argument that is always used, only the user is allowed to manually override the value.</li>
<li>A conflict says, if this particular argument is used, throw and error.</li>
</ul>
<p>I understand that in your case, the conflict should only arise if the user overrides that default value, however that's now how clap is structured at the moment as those two statements are incompatible.</p>
<p>What I meant by &quot;arguments for it&quot; is I haven't had anyone yet talk to me about wanting to conflict with a arg which provides a default value so I'm unsure how common the case is. Are you modeling after a well known CLI that provides some precedence? It's required to add this feature, I'm just curious :wink: I don't know the specifics of the CLI you're designing so it's hard for me to make any suggestions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kornelski">@kornelski</a> on 2017-10-24 14:30</div>
            <div class="timeline-body"><p>My specific case is a CLI that can either be used by specifying arguments individually, or by specifying a JSON file that specifies all of them.</p>
<p>So I have a bunch of options, and a <code>--json</code> option that conflicts with everything else.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-10-24 17:17</div>
            <div class="timeline-body"><p>Makes sense to me. I think this is fairly easily classified as a bug the more I play with it. Thanks for taking the time to file this and hash it out with me :wink:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: parsing</span> added by @kbknapp on 2017-10-24 17:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by @kbknapp on 2017-10-24 17:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P3: want to have</span> added by @kbknapp on 2017-10-24 17:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @kbknapp on 2017-10-24 17:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @kbknapp on 2017-10-24 17:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> removed by @kbknapp on 2017-10-24 17:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2017-10-25 01:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kornelski">@kornelski</a> on 2017-10-25 10:38</div>
            <div class="timeline-body"><p>Thank you! :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1037.html">clap-rs/clap#1037</a> on 2017-11-13 01:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/0ndorio">@0ndorio</a> on 2019-12-09 13:18</div>
            <div class="timeline-body"><p>@kornelski / @kbknapp
Seems like the issue is still present :/ Any chance to resurrect it?</p>
<p>This <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=9913e0f7a7905f7be0131ae53ef4ec63">playground</a> contains a slightly modified version of the test case introduced in f7a695523844962f9c6fda65b139b693a232e18e. The main difference to the original is that I moved the <code>conflicts_with</code> option to the the same argument, which also uses the <code>default</code> option. This should result in the same behavior but instead results in an error as soon as <code>-f</code> or <code>--flag</code> is passed.</p>
<p><strong>Known Workaround</strong>: Split <code>default</code> and <code>conflicts_with</code> between the two arguments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Dylan-DPC-zz">@Dylan-DPC-zz</a> on 2019-12-09 13:42</div>
            <div class="timeline-body"><p>@0ndorio can you test if the issue persists on master branch? If yes then I recommend creating a new issue for visibility</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/0ndorio">@0ndorio</a> on 2019-12-09 13:48</div>
            <div class="timeline-body"><p>This is issue is still present on the latest state of the <code>master</code> branch.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1604.html">clap-rs/clap#1604</a> on 2019-12-09 13:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1605.html">clap-rs/clap#1605</a> on 2019-12-09 13:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:47:01 UTC
    </footer>
</body>
</html>
