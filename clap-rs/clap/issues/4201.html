<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pager for help output - clap-rs/clap #4201</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Pager for help output</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/clap-rs/clap/issues/4201">#4201</a>
        opened by <a href="https://github.com/epage">@epage</a>
        on 2022-09-10 11:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a></div>
            <div class="timeline-body">Please complete the following tasks
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
Clap Version
<p>4.0</p>
Describe your use case
<p>As <a href="https://github.com/clap-rs/clap/issues/4132#issuecomment-1233080816">burntsushi put it</a></p>
<blockquote>
<p>The underlining is nice, but it is pretty common for me to do things like cmd --help | less, in which case, I imagine the underlining will get disabled by default.</p>
</blockquote>
<p>And as <a href="https://github.com/clap-rs/clap/discussions/4200">@phillyphil91 pointed out</a></p>
<blockquote>
<p>when having long help messages that extend over a page, the command syntax is hidden above the fold and a user has to scroll up first.</p>
</blockquote>
Describe the solution you&#x27;d like
<p><a href="https://clig.dev/#output">clig.dev&#x27;s output guidelines suggest</a></p>
<blockquote>
<p>Use a pager (e.g. less) if you are outputting a lot of text. For example, git diff does this by default. Using a pager can be error-prone, so be careful with your implementation such that you don’t make the experience worse for the user. You shouldn’t use a pager if stdin or stdout is not an interactive terminal.</p>
<p>A good sensible set of options to use for less is less -FIRX. This does not page if the content fills one screen, ignores case when you search, enables color and formatting, and leaves the contents on the screen when less quits.</p>
<p>There might be libraries in your language that are more robust than piping to less. For example, <a href="https://github.com/prompt-toolkit/pypager">pypager</a> in Python.</p>
</blockquote>
Alternatives, if applicable
<p><em>No response</em></p>
Additional Context
<p>This was split out of <a href="https://github.com/clap-rs/clap/issues/4132">clap-rs/clap#4132</a>#issuecomment-1242373265</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by <a href="https://github.com/epage">@epage</a> on 2022-09-10 11:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-help</span> added by <a href="https://github.com/epage">@epage</a> on 2022-09-10 11:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-tracking-issue</span> added by <a href="https://github.com/epage">@epage</a> on 2022-09-10 11:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> added by <a href="https://github.com/epage">@epage</a> on 2022-09-10 11:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-09-10 11:22</div>
            <div class="timeline-body"><p>Unsure if there is something newer/fancier but I was looking at the <a href="https://crates.io/crates/pager">pager</a> crate.</p>
<p>We should probably detect if a pager is even needed and only show it if it is.</p>
<p>The one downside is <code>ArgsRequiredElseHelp</code> outputs help to stderr because this is considered an error case and we assume the help output is the error message and not expected user output.  <code>pager</code> only handles it for stdout, so we wouldn&#x27;t get a pager in this case.  <code>ArgsRequiredElseHelp</code> is automatically enabled by derives when a subcommand is required.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-09-10 11:40</div>
            <div class="timeline-body"><p><code>pager</code> is unix-only and falls back to <code>more</code> rather than <code>less</code> which isn&#x27;t great.  <code>bat</code> has a built-in pager but I doubt we want to take that on.   We could use <a href="https://crates.io/crates/minus">minus</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-09-10 11:42</div>
            <div class="timeline-body"><p>We also need to decide if paging should happen on <code>error.print()</code> or just <code>error.exit()</code>.</p>
<p>We don&#x27;t know enough about what the application is doing with <code>error.print()</code> to do paging but some people do use it to recreate <code>exit</code> and there wouldn&#x27;t be a great way to say &quot;page only if needed&quot; with <code>error.print()</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#4132</a> on 2022-09-10 11:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tshepang">@tshepang</a> on 2022-09-10 12:13</div>
            <div class="timeline-body"><blockquote>
<p><code>bat</code> has a built-in pager but I doubt we want to take that on.</p>
</blockquote>
<p>what does <em>take that on</em> mean</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-09-10 21:09</div>
            <div class="timeline-body"><p>Implementing our own pager directly in clap</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>build-trust/ockam#3434</a> on 2022-09-11 18:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;4.x&quot; by <a href="https://github.com/epage">@epage</a> on 2022-09-13 12:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/typecasto">@typecasto</a> on 2022-09-24 01:13</div>
            <div class="timeline-body"><p><a href="https://github.com/markbt/streampager"><code>streampager</code></a> seems relevant here, it seems like it avoids the issues you mention (it can page from an arbitrary file descriptor or anything that <code>impl Read</code>, and it can avoid paging unless the output fills the screen). Like minus, it&#x27;s also usable as a rust library instead of a binary.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-09-24 01:40</div>
            <div class="timeline-body"><p>Looks like <code>streampager</code> has the downside of <code>minus</code>: its the entire pager written in Rust.  I&#x27;d be worried what that would do to build times and code size.</p>
<p>Writing a wrapper around external pagers isn&#x27;t too difficult, I just did it for <a href="https://github.com/epage/git-dive/blob/main/src/git_pager.rs">another project</a>.  Generalizing it into a library will take some finessing though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/typecasto">@typecasto</a> on 2022-09-24 02:57</div>
            <div class="timeline-body"><p>My personal opinion on this issue as a whole is that it&#x27;s not that hard to just use my own pager on the command line. If I want paged output, I just add <code>| sp</code> to the command line. <code>fish</code> even has a shortcut for it, by default (alt+p). Thus, the overhead that comes with adding a pager (or external pager support) is only really justified if it does something more than <code>some_app --help | $PAGER</code> would already do.</p>
<p>My suggestion for that <em>something</em> is color/formatting support. Using an external pager usually turns off formatting, since the application doesn&#x27;t see stdout going to a tty. Handling the pager in clap would allow the nicer output in a paged format. One problem with this is that, while <code>more</code> does handle formatted output, <code>less</code> does not, it just prints the escape codes by default. Building in a pager like streampager sidesteps this completely, making sure users always see the output formatted nicely, in a consistent way, as well as working cross-platform and not having any &quot;external&quot; dependencies.</p>
<p>My suggestion would be adding a <code>paged-help</code> feature to clap that pulls in streampager/minus and uses it to page output. From an application developer perspective it seems pretty ergonomic, if your <code>--help</code> isn&#x27;t likely to use a full page, streampager never gets built and you avoid all that overhead. If in the future if you need one, all you have to do is add the feature flag and then it would &quot;just work&quot;, paging the output if it&#x27;s too tall, and printing it to stderr otherwise.</p>
<p>One drawback I see to this approach is that a &quot;full page&quot; of output isn&#x27;t a consistent unit. What might be a full page for the end user ends up being half a screen on the developer&#x27;s machine, or vice versa, ending up with users needing to scroll the output themselves or having a slightly bigger binary. This also doesn&#x27;t really account for really short terminals, like the ones in vscode, which need paging a lot more than usual. (though this is pretty much mitigated by these terminals having scrollback). It might be good to have a canonical recommendation for when application devs should turn this feature on in terms of lines of output. (might also be possible to have a lint/warning at build time if you have the feature disabled with &gt;40 lines of help, not sure.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-09-26 12:10</div>
            <div class="timeline-body"><blockquote>
<p>My personal opinion on this issue as a whole is that it&#x27;s not that hard to just use my own pager on the command line. If I want paged output, I just add | sp to the command line. fish even has a shortcut for it, by default (alt+p). Thus, the overhead that comes with adding a pager (or external pager support) is only really justified if it does something more than some_app --help | $PAGER would already do.</p>
</blockquote>
<p>For you, maybe.  Not all users use fish and not every user wants to think a priori whether they need to do <code>| less</code> or hit <code>alt+p</code>.</p>
<blockquote>
<p>One problem with this is that, while more does handle formatted output, less does not, it just prints the escape codes by default.</p>
</blockquote>
<p><code>less</code>s defaults aren&#x27;t a problem, we can always override them.  In fact, this is what git does.  See <a href="https://github.com/epage/git-dive/issues/24">epage/git-dive#24</a> for my research notes on this topic.  The code I linked to in my previous reply intends to re-implement the git logic 100%.  I have used it in practice and it works well, much better than more (had problems with some escape codes).</p>
<p>So I&#x27;m still not seeing the benefit of paying the cost of a fully built-in pager, especially one that the developer might not even be using in their application.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nyurik">@nyurik</a> on 2023-02-03 16:21</div>
            <div class="timeline-body"><p>how much of an increase in size are we talking about?  A built-in pager could be an optional feature. A smaller app (fewer clap flags) is likely to be small in binary size, and it won&#x27;t be affected because it won&#x27;t use the feature. The apps with many flags are likely big enough not to notice a tiny size increase due to a built-in pager, so the devs can enable it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-02-03 16:32</div>
            <div class="timeline-body"><p>Right now, I&#x27;m leaning towards delegating to an external pager like git rather than having a rust-implemented pager.  It keeps the binary size and compile times down and doesn&#x27;t run into problems where people want to use a different pager and don&#x27;t want to build two rust-implemented pagers (e.g. one reason ripgrep doesn&#x27;t enable colors is it uses termcolor and clap v2 uses something else)</p>
<p>To show how small this can be, https://github.com/epage/git-dive/blob/main/src/git_pager.rs is a re-implementation of git&#x27;s pager logic.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nyurik">@nyurik</a> on 2023-02-03 16:41</div>
            <div class="timeline-body"><p>Thanks @epage, as long as both paging and colors work at the same time, life is great (i&#x27;m still hoping for v4 to restore color support :)).  And as always, the moment I commented above, Twitter showed that <a href="https://github.com/dandavison/delta">delta</a> (pager) project is trending... not sure if that could be used here, esp if there could ever be some sort of a &quot;stable help syntax&quot; that can be highlighted just like any code file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#4813</a> on 2023-03-31 00:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>sharkdp/bat#2887</a> on 2024-03-08 20:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:59:16 UTC
    </footer>
</body>
</html>
