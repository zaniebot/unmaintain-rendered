<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support multiple arguments writing to the same destination - clap-rs/clap #3146</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support multiple arguments writing to the same destination</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/clap-rs/clap/issues/3146">#3146</a>
        opened by <a href="https://github.com/epage">@epage</a>
        on 2021-12-10 21:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a></div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
<h3>Clap Version</h3>
<p>3.0.0-rc.0</p>
<h3>Describe your use case</h3>
<p>Related issues</p>
<ul>
<li>#1820</li>
<li>#815</li>
</ul>
<h3>Describe the solution you'd like</h3>
<p>In Python's <code>argparse</code>, you can assign the <code>dest</code> (for us, <code>name</code>) for an argument in the <code>Namespace</code> (for us, <code>ArgMatches</code>).  This gives a lot of power.  One example is #1820 with migrating flags.  The thing I used this most frequently for was negations (#815).</p>
<p>The code would look something like</p>
<pre><code class="language-rust">parser.add_argument(&quot;--flag&quot;, dest=&quot;flag&quot;, action=&quot;store_true&quot;)
parser.add_argument(&quot;--no-flag&quot;, dest=&quot;flag&quot;, action=&quot;store_false&quot;)
... some line about setting the default
</code></pre>
<p>This makes it easy to define and handle and gives good semantics (last writer wins)</p>
<p>For now, I'm doing stuff like</p>
<pre><code class="language-rust">fn resolve_bool_arg(yes: bool, no: bool) -&gt; Option&lt;bool&gt; {
    match (yes, no) {
        (true, false) =&gt; Some(true),
        (false, true) =&gt; Some(false),
        (false, false) =&gt; None,
        (_, _) =&gt; unreachable!(&quot;StructOpt should make this impossible&quot;),
    }
}
</code></pre>
<p>https://github.com/epage/git-stack/blob/main/src/bin/git-stack/args.rs#L105</p>
<p>and haven't played with <code>overrides_with</code> to see what a last-writer-wins would look like with clap.</p>
<h3>Alternatives, if applicable</h3>
<p><em>No response</em></p>
<h3>Additional Context</h3>
<p>See #1820 which has several concerns over doing this.  I especially expect problems with</p>
<ul>
<li>Interaction with <code>global(true)</code></li>
<li>Validation rules (they have to be aware of and operate on the dest)</li>
<li>Derives reading the right dest</li>
<li>Derives dealing with multiple &quot;arguments&quot; pointing to the same dest</li>
</ul>
<p>See #3119 for more use cases</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @epage on 2021-12-10 21:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-builder</span> added by @epage on 2021-12-10 21:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-parsing</span> added by @epage on 2021-12-10 21:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-validators</span> added by @epage on 2021-12-10 21:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-experimental</span> added by @epage on 2021-12-10 21:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1820.html">clap-rs/clap#1820</a> on 2021-12-10 21:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3119.html">clap-rs/clap#3119</a> on 2021-12-13 22:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3405.html">clap-rs/clap#3405</a> on 2022-05-09 21:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tmccombs">@tmccombs</a> on 2022-06-27 08:34</div>
            <div class="timeline-body"><p>Is there a good workaround for this? I have a lot of options that are negatable (mostly using <code>no-</code> prefixed options), and it would be really nice to avoid having duplicate boolean fields for all of them that I have to check both of.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ducaale">@ducaale</a> on 2022-06-27 08:47</div>
            <div class="timeline-body"><p>@tmccombs would a workaround like <a href="https://github.com/clap-rs/clap/issues/815#issuecomment-1040848452">this</a> work for your use case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tmccombs">@tmccombs</a> on 2022-06-28 06:45</div>
            <div class="timeline-body"><p>Maybe. In my case I only want these options for a few of the options, and in some cases I the man option starts with <code>--no-</code> and the negating option doesn't have the prefix (or in other words, the option without the <code>--no</code> prefix is the default).</p>
<p>I'm also not really sure what the best way to do that when using the derive api would be.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-06-28 12:42</div>
            <div class="timeline-body"><p>@tmccombs if your interest is in negation flags, be sure to watch the more specific #815.  In it, I do bring up a more unusual <a href="https://github.com/clap-rs/clap/issues/815#issuecomment-1154205312">solution using ArgAction</a> so there is room for solutions outside of this issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tmccombs">@tmccombs</a> on 2022-07-01 07:13</div>
            <div class="timeline-body"><p>Some other use cases for this:</p>
<ul>
<li>having an option that is a shortcut for passing a specific value to another option. For example <code>-1</code> as an alias for <code>--max-results=1</code></li>
<li>Allowing an argument to be passed either as a positional argument or an option</li>
<li>Options that take the same value, but with different meanings. for example <code>--include</code> and <code>--exclude</code> might feed into a single list of filters, where relative order matters, and the difference is just which variant of an enum is used  (or maybe one type is prefixed with some delimiter like &quot;!&quot;).</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../neovide/neovide/pulls/1885.html">neovide/neovide#1885</a> on 2023-06-02 21:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../r0gue-io/pop-cli/pulls/361.html">r0gue-io/pop-cli#361</a> on 2024-12-06 09:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/815.html">clap-rs/clap#815</a> on 2025-09-16 18:43</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:48:18 UTC
    </footer>
</body>
</html>
