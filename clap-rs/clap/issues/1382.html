<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>the --version flag concatenates subcommands - clap-rs/clap #1382</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>the --version flag concatenates subcommands</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/clap-rs/clap/issues/1382">#1382</a>
        opened by <a href="https://github.com/Geal">@Geal</a>
        on 2018-11-15 09:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Geal">@Geal</a></div>
            <div class="timeline-body"><p>Maintainer's notes</p>
<ul>
<li>We hope #1334 will provide a way to resolve this.  This is being left open to ensure this use case isn't lost in case a minimum or full solution doesn't include this</li>
</ul>
<hr />
<h3>Rust Version</h3>
<p><code>rustc 1.31.0-nightly (4bd4e4130 2018-10-25)</code></p>
<h3>Affected Version of clap</h3>
<p>2.32.0</p>
<h3>Bug or Feature Request Summary</h3>
<p>Passing the <code>--version</code> flag after one or more subcommands should not append the subcommand names to the process name</p>
<h3>Expected Behavior Summary</h3>
<pre><code>$ ./target/debug/clap-test --version
claptest 1.0
$ ./target/debug/clap-test test --version
claptest 1.0
$ ./target/debug/clap-test test hello --version
claptest 1.0
</code></pre>
<h3>Actual Behavior Summary</h3>
<pre><code>$ ./target/debug/clap-test --version
claptest 1.0
$ ./target/debug/clap-test test --version
clap-test-test 
$ ./target/debug/clap-test test hello --version
clap-test-test-hello
</code></pre>
<h3>Sample Code or Link to Sample Code</h3>
<pre><code class="language-rust">extern crate clap;
use clap::{Arg, App, SubCommand};

fn main() {
	let matches = App::new(&quot;claptest&quot;)
		.version(&quot;1.0&quot;)
		.arg(Arg::with_name(&quot;config&quot;)
				 .short(&quot;c&quot;)
				 .long(&quot;config&quot;)
				 .value_name(&quot;FILE&quot;)
				 .help(&quot;Sets a custom config file&quot;)
				 .takes_value(true))
		.subcommand(SubCommand::with_name(&quot;test&quot;)
								.help(&quot;print debug information verbosely&quot;)
								.subcommand(SubCommand::with_name(&quot;hello&quot;)
														.help(&quot;hello&quot;)))
		.get_matches();
}
</code></pre>
<h3>Debug output</h3>
<p>Compile clap with cargo features <code>&quot;debug&quot;</code> such as:</p>
<pre><code class="language-toml">[dependencies]
clap = { version = &quot;2&quot;, features = [&quot;debug&quot;] }
</code></pre>
<p>Output for: <code>./target/debug/clap-test test --version</code>:</p>
<details>
<summary> Debug Output </summary>
<pre>
<code>

<p>DEBUG:clap:Parser::add_subcommand: term_w=None, name=hello
DEBUG:clap:Parser::add_subcommand: term_w=None, name=test
DEBUG:clap:Parser::propagate_settings: self=claptest, g_settings=AppFlags(
(empty)
)
DEBUG:clap:Parser::propagate_settings: sc=test, settings=AppFlags(
NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO
), g_settings=AppFlags(
(empty)
)
DEBUG:clap:Parser::propagate_settings: self=test, g_settings=AppFlags(
(empty)
)
DEBUG:clap:Parser::propagate_settings: sc=hello, settings=AppFlags(
NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO
), g_settings=AppFlags(
(empty)
)
DEBUG:clap:Parser::propagate_settings: self=hello, g_settings=AppFlags(
(empty)
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:Parser::create_help_and_version: Building help
DEBUG:clap:Parser::get_matches_with: Begin parsing '&quot;test&quot;' ([116, 101, 115, 116])
DEBUG:clap:Parser::is_new_arg:&quot;test&quot;:NotFound
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: probably value
DEBUG:clap:Parser::is_new_arg: starts_new_arg=false
DEBUG:clap:Parser::possible_subcommand: arg=&quot;test&quot;
DEBUG:clap:Parser::get_matches_with: possible_sc=true, sc=Some(&quot;test&quot;)
DEBUG:clap:Parser::parse_subcommand;
DEBUG:clap:usage::get_required_usage_from: reqs=[], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:Parser::parse_subcommand: About to parse sc=test
DEBUG:clap:Parser::parse_subcommand: sc settings=AppFlags(
NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:Parser::create_help_and_version: Building help
DEBUG:clap:Parser::get_matches_with: Begin parsing '&quot;--version&quot;' ([45, 45, 118, 101, 114, 115, 105, 111, 110])
DEBUG:clap:Parser::is_new_arg:&quot;--version&quot;:NotFound
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: -- found
DEBUG:clap:Parser::is_new_arg: starts_new_arg=true
DEBUG:clap:Parser::possible_subcommand: arg=&quot;--version&quot;
DEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None
DEBUG:clap:ArgMatcher::process_arg_overrides:None;
DEBUG:clap:Parser::parse_long_arg;
DEBUG:clap:Parser::parse_long_arg: Does it contain '='...No
DEBUG:clap:Parser::parse_long_arg: Found valid flag '--version'
DEBUG:clap:Parser::check_for_help_and_version_str;
DEBUG:clap:Parser::check_for_help_and_version_str: Checking if --version is help or version...Version
DEBUG:clap:Parser::_version:
clap-test-test</p>
</code>
</pre>
</details>

<p>this does not look like a critical bug, but it still feels weird :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/EverlastingBugstopper">@EverlastingBugstopper</a> on 2019-10-28 22:19</div>
            <div class="timeline-body"><p>+1 on this. Thought we had a bug in our implementation but it seems to be the way clap handles versions for subcommands. It can be overridden with a <code>.version</code> on each subcommand, but my feeling is that it should default to the parent's version. https://github.com/cloudflare/wrangler/issues/791</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../cloudflare/wrangler-legacy/issues/791.html">cloudflare/wrangler-legacy#791</a> on 2019-10-28 22:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: help message</span> added by @CreepySkeleton on 2020-02-01 15:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: subcommands</span> added by @CreepySkeleton on 2020-02-01 15:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @pksunkara on 2020-04-09 07:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1431.html">clap-rs/clap#1431</a> on 2021-02-22 09:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2564.html">clap-rs/clap#2564</a> on 2021-06-22 14:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/108.html">epage/clapng#108</a> on 2021-12-06 17:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: subcommands</span> removed by @epage on 2021-12-08 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.1" by @epage on 2021-12-08 20:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-08 20:12</div>
            <div class="timeline-body"><p>This seems like a slight variant on https://github.com/clap-rs/clap/issues/1431.  We should probably look at these together.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @epage on 2021-12-09 19:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-09 19:13</div>
            <div class="timeline-body"><p>One other aspect of this is that we can have per-subcommand versions.  In that case, we probably would want to list what the version is relevant for.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> added by @epage on 2021-12-09 19:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-02-03 14:51</div>
            <div class="timeline-body"><p>Updated the code for clap3</p>
<pre><code class="language-rust">use clap::{App, AppSettings, Arg};

fn main() {
    let matches = App::new(&quot;claptest&quot;)
        .setting(AppSettings::PropagateVersion)
        .version(&quot;1.0&quot;)
        .arg(
            Arg::new(&quot;config&quot;)
                .short('c')
                .long(&quot;config&quot;)
                .value_name(&quot;FILE&quot;)
                .help(&quot;Sets a custom config file&quot;)
                .takes_value(true),
        )
        .subcommand(
            App::new(&quot;test&quot;)
                .about(&quot;print debug information verbosely&quot;)
                .subcommand(App::new(&quot;hello&quot;).about(&quot;hello&quot;)),
        )
        .get_matches();
}
</code></pre>
<p><code>PropagateVersion</code> ensures you get</p>
<pre><code class="language-console">$ ./target/debug/clap-test --version
claptest 1.0
$ ./target/debug/clap-test test --version
claptest-test 1.0
$ ./target/debug/clap-test test hello --version
claptest-test-test 1.0
</code></pre>
<p>instead of</p>
<pre><code class="language-console">$ ./target/debug/clap-test --version
claptest 1.0
$ ./target/debug/clap-test test --version
clap-test-test 
$ ./target/debug/clap-test test hello --version
clap-test-test-hello
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-02-03 14:52</div>
            <div class="timeline-body"><p>I feel like what we show could be derived from the work in #1334</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1334.html">clap-rs/clap#1334</a> on 2022-02-03 14:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-design</span> removed by @epage on 2022-02-03 14:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-blocked</span> added by @epage on 2022-02-03 14:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1474.html">clap-rs/clap#1474</a> on 2022-05-04 21:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../dtolnay/cargo-unlock/pulls/8.html">dtolnay/cargo-unlock#8</a> on 2023-08-05 18:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../dtolnay/cargo-expand/pulls/189.html">dtolnay/cargo-expand#189</a> on 2023-08-05 18:16</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../astral-sh/uv/pulls/13109.html">astral-sh/uv#13109</a> on 2025-04-25 16:36</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:47:15 UTC
    </footer>
</body>
</html>
