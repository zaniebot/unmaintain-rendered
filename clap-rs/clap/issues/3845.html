<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consider panicking unconditionally in ArgMatches::get_arg - clap-rs/clap #3845</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Consider panicking unconditionally in ArgMatches::get_arg</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/3845">#3845</a>
        opened by <a href="https://github.com/stepancheg">@stepancheg</a>
        on 2022-06-16 21:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/stepancheg">@stepancheg</a> on 2022-06-16 21:45</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>3.1.8</p>
<h3>Describe your use case</h3>
<p>I've spend some time figuring out why my program did not fail locally, but failed in (very slow) CI.</p>
<p>It was because of this debug-only assertion:</p>
<p>https://github.com/clap-rs/clap/blob/5fdc26ee9ad3edd47b516b27460dec876c09f98e/src/parser/matches/arg_matches.rs#L1263-L1280</p>
<p>This is not perf-critical code, so probably better to make assertion unconditional.</p>
<h3>Describe the solution you'd like</h3>
<p>Unconditional assertion (or deprecated this function and add another which returns error).</p>
<h3>Alternatives, if applicable</h3>
<p><em>No response</em></p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @stepancheg on 2022-06-16 21:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-06-16 21:58</div>
            <div class="timeline-body"><p>Its not just a question of whether the checks add overhead but us tracking state to panic adds overhead</p>
<ul>
<li>In debug builds<ul>
<li>An <code>Id</code> is <code>(u64, String)</code></li>
<li><code>ArgMatches</code> contains a <code>Vec&lt;String&gt;</code> of all of the defined ids</li>
</ul>
</li>
<li>In release builds<ul>
<li>An <code>Id</code> is a <code>u64</code></li>
<li>We do not track all of the defined ids</li>
</ul>
</li>
</ul>
<p>We will be changing the definition of <code>Id</code> in clap 4 but I doubt we will track around the <code>Vec</code> for error reporting purposes.</p>
<p>In addition, clap is generally setup for reporting development errors in debug builds.  It was by happenstance that some of the new panics in 3.2 are in release builds and we may re-evaluate that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2022-06-16 21:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3847.html">clap-rs/clap#3847</a> on 2022-06-17 12:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:34 UTC
    </footer>
</body>
</html>
