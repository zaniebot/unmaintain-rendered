<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Return help message as String for Command - clap-rs/clap #3873</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Return help message as String for Command</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/3873">#3873</a>
        opened by <a href="https://github.com/ychiguer">@ychiguer</a>
        on 2022-06-27 12:22
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ychiguer">@ychiguer</a> on 2022-06-27 12:22</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>3.1.18</p>
<h3>Describe your use case</h3>
<p>The only way I could find to use the help message is to print out it to <code>Stdout</code>. In my use case I would like to get the help message as a String as I intend to not print it to <code>Stdout</code> directly.</p>
<h3>Describe the solution you'd like</h3>
<p>A function that returns the help message as a String.</p>
<h3>Alternatives, if applicable</h3>
<p><em>No response</em></p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @ychiguer on 2022-06-27 12:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3874.html">clap-rs/clap#3874</a> on 2022-06-27 12:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-06-27 19:19</div>
            <div class="timeline-body"><p>We do have <a href="https://docs.rs/clap/latest/clap/builder/struct.App.html#method.write_help">Command::write_help</a> so its possible to do this today.</p>
<p>The interesting part to me is that for help, we have a <code>write</code> function and for usage/version we have a <code>render</code> function. We should be more consistent but to what is the question</p>
<ul>
<li>only <code>render</code> functions</li>
<li>only <code>write</code> functions</li>
<li>both</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ychiguer">@ychiguer</a> on 2022-06-28 07:26</div>
            <div class="timeline-body"><p>Well the question is about <code>render</code> functions and especially rendering help.</p>
<blockquote>
<p>We do have <a href="https://docs.rs/clap/latest/clap/builder/struct.App.html#method.write_help">Command::write_help</a> so its possible to do this today.</p>
<h4>I think this function might work but would require a lot of missing around in my opinion, and for my use case I would like it simply rendered as a String. The thing is, I think there should be a <code>render</code> function for help as well.</h4>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-06-29 03:33</div>
            <div class="timeline-body"><p>To be clear, my point about <code>write_help</code> was in response to the Issue stating that the user can't write to an in-memory structure.  It is possible.  It can still be valid to ask what the API should more generally look like though.</p>
<p>btw a quick example for <code>write_help</code>:</p>
<pre><code class="language-rust">fn main() {
    let mut cmd = clap::Command::new(&quot;myprog&quot;);

    let mut out: Vec&lt;u8&gt; = Vec::new();
    cmd.write_help(&amp;mut out).expect(&quot;failed to write to buffer&quot;);
    let out = String::from_utf8(out).expect(&quot;help is utf-8&quot;);

    dbg!(&amp;out);
}
</code></pre>
<p>Beyond a <code>render</code> variant, this requires:</p>
<ul>
<li>Initializing the buffer</li>
<li>Converting the buffer to a <code>String</code></li>
</ul>
<p>Random thoughts on the proposal to simplify things for people who just want a <code>String</code>:</p>
<ul>
<li>The gap between <code>write</code> and <code>render</code> is small, making this a lower priority for me</li>
<li><code>write</code> reason for existing is more likely an optimization to avoid allocating a medium sized buffer just for someone writing to stdout/stderr.  That optimization is unlikely to have a noticeable impact on any application using it.</li>
<li>We currently offer more <code>render</code> functions so being at least consistent with that for now seems reasonable</li>
<li>We will likely be revisiting all of these API calls when I re-examine colored output in clap 4<ul>
<li>I try to avoid user churn where we add a function just to remove it afterwards.  We do it at times (<code>ArgSetting::MultipleOccurrences</code> -&gt; <code>Arg::multiple_occurrences</code> -&gt; <code>ArgAction::Append</code>) but we didn't predict that.  In this case, we have an expected area of investigation that could have a dramatic impact on the API</li>
<li>However, the cost is the same for someone using one way vs the other when we come out with that new API.  The bigger concern then is if we deprecate a previous API variant but we are unlikely to be doing that here</li>
</ul>
</li>
</ul>
<p>Thinking through that, I think I am fine with moving forward with this as long as the review churn ends up being low.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ychiguer on 2022-07-01 07:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-07-01 14:41</div>
            <div class="timeline-body"><p>@ychiguer how come this is closed?  The related PR isn't merged yet and generally Issues are closed as completed when their PR is merged and github will do this automatically if you use the right syntax.  See https://docs.github.com/en/issues/tracking-your-work-with-issues/linking-a-pull-request-to-an-issue#linking-a-pull-request-to-an-issue-using-a-keyword</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @epage on 2022-07-01 14:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ychiguer">@ychiguer</a> on 2022-07-01 14:45</div>
            <div class="timeline-body"><p>Must have done it by mistake.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4248.html">clap-rs/clap#4248</a> on 2022-09-22 14:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2022-09-22 15:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:35:03 UTC
    </footer>
</body>
</html>
