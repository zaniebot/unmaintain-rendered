<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>When two named arguments takes values, the first named argument will always take the value of the second - clap-rs/clap #2318</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>When two named arguments takes values, the first named argument will always take the value of the second</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/2318">#2318</a>
        opened by <a href="https://github.com/Yuri6037">@Yuri6037</a>
        on 2021-01-29 20:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Yuri6037">@Yuri6037</a></div>
            <div class="timeline-body">Make sure you completed the following tasks
<ul>
<li>[x] Searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[x] Searched the closed issues</li>
</ul>
Code
<p>https://gitlab.com/BlockProject3D/fpkg/-/blob/master/BPXTools/src/main.rs</p>
<p>Line 45</p>
Steps to reproduce the issue
<ol>
<li>Use the definition as given in Line 45 of provided main.rs</li>
<li>Use the tool as <code>./target/debug/bpxdbg -f file.bpx info -d 0 -o test.raw</code></li>
<li>Enjoy the -d argument taking the value of -o</li>
</ol>
Version
<ul>
<li><strong>Rust</strong>: rustc 1.47.0 (18bf6b4f0 2020-10-07)</li>
<li><strong>Clap</strong>: &quot;2.27.0&quot;</li>
</ul>
Actual Behavior Summary
<p>The -d argument takes the value of -o which is bad.</p>
<p><strong>If a project of yours is blocked due to this bug, please, mention it explicitly.</strong></p>
<p>Currently blocking FPKG, BlockProject 3D Framework and by extension the Engine which relies on the Framework itself requiring the FPKG tool.</p>
Expected Behavior Summary
<p>Calling <code>./target/debug/bpxdbg -f file.bpx info -d 0 -o test.raw</code> should result in a file named <code>test.raw</code> generated with the content of the section at index <code>0</code> in the file <code>file.bpx</code>. Currently the argument read by the program for -d is <code>test.raw</code> same for -o.</p>
Additional context
<p>When using the tool as <code>./target/debug/bpxdbg -f file.bpx info -d 0</code> no bug occurs.</p>
Debug output

 Debug Output 
<pre>
<code>
DEBUG:clap:Parser::add_subcommand: term_w=None, name=info
DEBUG:clap:Parser::add_subcommand: term_w=None, name=pack
DEBUG:clap:Parser::add_subcommand: term_w=None, name=unpack
DEBUG:clap:Parser::propagate_settings: self=bpxd, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: sc=info, settings=AppFlags(
    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO,
), g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: self=info, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: sc=pack, settings=AppFlags(
    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO,
), g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: self=pack, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: sc=unpack, settings=AppFlags(
    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO,
), g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::propagate_settings: self=unpack, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:Parser::create_help_and_version: Building help
DEBUG:clap:Parser::get_matches_with: Begin parsing &#x27;&quot;-f&quot;&#x27; ([45, 102])
DEBUG:clap:Parser::is_new_arg:&quot;-f&quot;:NotFound
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: - found
DEBUG:clap:Parser::is_new_arg: starts_new_arg=true
DEBUG:clap:Parser::possible_subcommand: arg=&quot;-f&quot;
DEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None
DEBUG:clap:ArgMatcher::process_arg_overrides:None;
DEBUG:clap:Parser::parse_short_arg: full_arg=&quot;-f&quot;
DEBUG:clap:Parser::parse_short_arg:iter:f
DEBUG:clap:Parser::parse_short_arg:iter:f: Found valid opt
DEBUG:clap:Parser::parse_short_arg:iter:f: p[0]=[], p[1]=[]
DEBUG:clap:Parser::parse_opt; opt=file, val=None
DEBUG:clap:Parser::parse_opt; opt.settings=ArgFlags(REQUIRED | EMPTY_VALS | TAKES_VAL | DELIM_NOT_SET)
DEBUG:clap:Parser::parse_opt; Checking for val...None
DEBUG:clap:ArgMatcher::inc_occurrence_of: arg=file
DEBUG:clap:ArgMatcher::inc_occurrence_of: first instance
DEBUG:clap:Parser::groups_for_arg: name=file
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:Parser::parse_opt: More arg vals required...
DEBUG:clap:Parser:get_matches_with: After parse_short_arg Opt(&quot;file&quot;)
DEBUG:clap:Parser::get_matches_with: Begin parsing &#x27;&quot;file.bpx&quot;&#x27; ([102, 105, 108, 101, 46, 98, 112, 120])
DEBUG:clap:Parser::is_new_arg:&quot;file.bpx&quot;:Opt(&quot;file&quot;)
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: probably value
DEBUG:clap:Parser::is_new_arg: starts_new_arg=false
DEBUG:clap:Parser::add_val_to_arg; arg=file, val=&quot;file.bpx&quot;
DEBUG:clap:Parser::add_val_to_arg; trailing_vals=false, DontDelimTrailingVals=false
DEBUG:clap:Parser::add_single_val_to_arg;
DEBUG:clap:Parser::add_single_val_to_arg: adding val...&quot;file.bpx&quot;
DEBUG:clap:Parser::groups_for_arg: name=file
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:ArgMatcher::needs_more_vals: o=file
DEBUG:clap:Parser::get_matches_with: Begin parsing &#x27;&quot;info&quot;&#x27; ([105, 110, 102, 111])
DEBUG:clap:Parser::is_new_arg:&quot;info&quot;:ValuesDone
DEBUG:clap:Parser::possible_subcommand: arg=&quot;info&quot;
DEBUG:clap:Parser::get_matches_with: possible_sc=true, sc=Some(&quot;info&quot;)
DEBUG:clap:Parser::parse_subcommand;
DEBUG:clap:usage::get_required_usage_from: reqs=[&quot;file&quot;, &quot;file&quot;], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=[&quot;file&quot;]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:Parser::parse_subcommand: About to parse sc=info
DEBUG:clap:Parser::parse_subcommand: sc settings=AppFlags(
    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO,
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:Parser::get_matches_with: Begin parsing &#x27;&quot;-d&quot;&#x27; ([45, 100])
DEBUG:clap:Parser::is_new_arg:&quot;-d&quot;:NotFound
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: - found
DEBUG:clap:Parser::is_new_arg: starts_new_arg=true
DEBUG:clap:Parser::possible_subcommand: arg=&quot;-d&quot;
DEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None
DEBUG:clap:ArgMatcher::process_arg_overrides:None;
DEBUG:clap:Parser::parse_short_arg: full_arg=&quot;-d&quot;
DEBUG:clap:Parser::parse_short_arg:iter:d
DEBUG:clap:Parser::parse_short_arg:iter:d: Found valid opt
DEBUG:clap:Parser::parse_short_arg:iter:d: p[0]=[], p[1]=[]
DEBUG:clap:Parser::parse_opt; opt=section_id, val=None
DEBUG:clap:Parser::parse_opt; opt.settings=ArgFlags(EMPTY_VALS | TAKES_VAL | DELIM_NOT_SET)
DEBUG:clap:Parser::parse_opt; Checking for val...None
DEBUG:clap:ArgMatcher::inc_occurrence_of: arg=section_id
DEBUG:clap:ArgMatcher::inc_occurrence_of: first instance
DEBUG:clap:Parser::groups_for_arg: name=section_id
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:Parser::parse_opt: More arg vals required...
DEBUG:clap:Parser:get_matches_with: After parse_short_arg Opt(&quot;section_id&quot;)
DEBUG:clap:Parser::get_matches_with: Begin parsing &#x27;&quot;0&quot;&#x27; ([48])
DEBUG:clap:Parser::is_new_arg:&quot;0&quot;:Opt(&quot;section_id&quot;)
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: probably value
DEBUG:clap:Parser::is_new_arg: starts_new_arg=false
DEBUG:clap:Parser::add_val_to_arg; arg=section_id, val=&quot;0&quot;
DEBUG:clap:Parser::add_val_to_arg; trailing_vals=false, DontDelimTrailingVals=false
DEBUG:clap:Parser::add_single_val_to_arg;
DEBUG:clap:Parser::add_single_val_to_arg: adding val...&quot;0&quot;
DEBUG:clap:Parser::groups_for_arg: name=section_id
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:ArgMatcher::needs_more_vals: o=section_id
DEBUG:clap:Parser::get_matches_with: Begin parsing &#x27;&quot;-o&quot;&#x27; ([45, 111])
DEBUG:clap:Parser::is_new_arg:&quot;-o&quot;:ValuesDone
DEBUG:clap:Parser::possible_subcommand: arg=&quot;-o&quot;
DEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None
DEBUG:clap:ArgMatcher::process_arg_overrides:Some(&quot;section_id&quot;);
DEBUG:clap:Parser::parse_short_arg: full_arg=&quot;-o&quot;
DEBUG:clap:Parser::parse_short_arg:iter:o
DEBUG:clap:Parser::parse_short_arg:iter:o: Found valid opt
DEBUG:clap:Parser::parse_short_arg:iter:o: p[0]=[], p[1]=[]
DEBUG:clap:Parser::parse_opt; opt=out_file, val=None
DEBUG:clap:Parser::parse_opt; opt.settings=ArgFlags(EMPTY_VALS | TAKES_VAL | DELIM_NOT_SET)
DEBUG:clap:Parser::parse_opt; Checking for val...None
DEBUG:clap:ArgMatcher::inc_occurrence_of: arg=out_file
DEBUG:clap:ArgMatcher::inc_occurrence_of: first instance
DEBUG:clap:Parser::groups_for_arg: name=out_file
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:Parser::parse_opt: More arg vals required...
DEBUG:clap:Parser:get_matches_with: After parse_short_arg Opt(&quot;out_file&quot;)
DEBUG:clap:Parser::get_matches_with: Begin parsing &#x27;&quot;test.raw&quot;&#x27; ([116, 101, 115, 116, 46, 114, 97, 119])
DEBUG:clap:Parser::is_new_arg:&quot;test.raw&quot;:Opt(&quot;out_file&quot;)
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: probably value
DEBUG:clap:Parser::is_new_arg: starts_new_arg=false
DEBUG:clap:Parser::add_val_to_arg; arg=out_file, val=&quot;test.raw&quot;
DEBUG:clap:Parser::add_val_to_arg; trailing_vals=false, DontDelimTrailingVals=false
DEBUG:clap:Parser::add_single_val_to_arg;
DEBUG:clap:Parser::add_single_val_to_arg: adding val...&quot;test.raw&quot;
DEBUG:clap:Parser::groups_for_arg: name=out_file
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:ArgMatcher::needs_more_vals: o=out_file
DEBUG:clap:ArgMatcher::process_arg_overrides:Some(&quot;out_file&quot;);
DEBUG:clap:Parser::remove_overrides:[];
DEBUG:clap:Validator::validate;
DEBUG:clap:Parser::add_defaults;
DEBUG:clap:Parser::add_defaults:iter:section_id: doesn&#x27;t have conditional defaults
DEBUG:clap:Parser::add_defaults:iter:section_id: doesn&#x27;t have default vals
DEBUG:clap:Parser::add_defaults:iter:out_file: doesn&#x27;t have conditional defaults
DEBUG:clap:Parser::add_defaults:iter:out_file: doesn&#x27;t have default vals
DEBUG:clap:Validator::validate_blacklist;
DEBUG:clap:Validator::validate_blacklist:iter:out_file;
DEBUG:clap:Parser::groups_for_arg: name=out_file
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:Validator::validate_blacklist:iter:section_id;
DEBUG:clap:Parser::groups_for_arg: name=section_id
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:Validator::validate_required: required=[];
DEBUG:clap:Validator::validate_matched_args;
DEBUG:clap:Validator::validate_matched_args:iter:out_file: vals=[
    &quot;test.raw&quot;,
]
DEBUG:clap:Validator::validate_arg_num_vals:out_file
DEBUG:clap:Validator::validate_arg_values: arg=&quot;out_file&quot;
DEBUG:clap:Validator::validate_arg_requires:out_file;
DEBUG:clap:Validator::validate_arg_num_occurs: a=out_file;
DEBUG:clap:Validator::validate_matched_args:iter:section_id: vals=[
    &quot;0&quot;,
]
DEBUG:clap:Validator::validate_arg_num_vals:section_id
DEBUG:clap:Validator::validate_arg_values: arg=&quot;section_id&quot;
DEBUG:clap:Validator::validate_arg_requires:section_id;
DEBUG:clap:Validator::validate_arg_num_occurs: a=section_id;
DEBUG:clap:usage::create_usage_with_title;
DEBUG:clap:usage::create_usage_no_title;
DEBUG:clap:usage::get_required_usage_from: reqs=[], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:usage::needs_flags_tag;
DEBUG:clap:usage::needs_flags_tag:iter: f=sht;
DEBUG:clap:Parser::groups_for_arg: name=sht
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:usage::needs_flags_tag:iter: [FLAGS] required
DEBUG:clap:usage::create_help_usage: usage=bpxdbg info [FLAGS] [OPTIONS]
DEBUG:clap:ArgMatcher::process_arg_overrides:Some(&quot;file&quot;);
DEBUG:clap:Parser::remove_overrides:[];
DEBUG:clap:Validator::validate;
DEBUG:clap:Parser::add_defaults;
DEBUG:clap:Parser::add_defaults:iter:file: doesn&#x27;t have conditional defaults
DEBUG:clap:Parser::add_defaults:iter:file: doesn&#x27;t have default vals
DEBUG:clap:Validator::validate_blacklist;
DEBUG:clap:Validator::validate_blacklist:iter:file;
DEBUG:clap:Parser::groups_for_arg: name=file
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:Validator::validate_required: required=[&quot;file&quot;];
DEBUG:clap:Validator::validate_required:iter:file:
DEBUG:clap:Validator::validate_matched_args;
DEBUG:clap:Validator::validate_matched_args:iter:file: vals=[
    &quot;file.bpx&quot;,
]
DEBUG:clap:Validator::validate_arg_num_vals:file
DEBUG:clap:Validator::validate_arg_values: arg=&quot;file&quot;
DEBUG:clap:Validator::validate_arg_requires:file;
DEBUG:clap:Validator::validate_arg_num_occurs: a=file;
DEBUG:clap:usage::create_usage_with_title;
DEBUG:clap:usage::create_usage_no_title;
DEBUG:clap:usage::get_required_usage_from: reqs=[&quot;file&quot;], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=[&quot;file&quot;]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:usage::get_required_usage_from:iter:file:
DEBUG:clap:OptBuilder::fmt:file
DEBUG:clap:usage::needs_flags_tag;
DEBUG:clap:usage::needs_flags_tag:iter: f=hclap_help;
DEBUG:clap:usage::needs_flags_tag:iter: f=vclap_version;
DEBUG:clap:usage::needs_flags_tag: [FLAGS] not required
DEBUG:clap:usage::create_help_usage: usage=bpxdbg --file  
DEBUG:clap:ArgMatcher::get_global_values: global_arg_vec=[]
====&gt; BPX Main Header &lt;====
Type: P
Version: 1
File size: 6220959
Number of sections: 2
====&gt; End &lt;====

<p>Could not parse section index test.raw (invalid digit found in string)
</code>
</pre></p>


</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by <a href="https://github.com/Yuri6037">@Yuri6037</a> on 2021-01-29 20:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-01-29 21:12</div>
            <div class="timeline-body"><p>Needs a minimal reproducible example code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Yuri6037">@Yuri6037</a> on 2021-01-29 21:38</div>
            <div class="timeline-body"><p>I won&#x27;t have time to provide a minimal reproducible example code. You can still build the tool as given in the link. It builds fine.</p>
<p>Example use:</p>
<ul>
<li><code>./target/debug/bpxdbg -f file.bpx pack src</code></li>
<li><code>./target/debug/bpxdbg -f file.bpx info -d 0 -o test.raw</code></li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-01-29 21:45</div>
            <div class="timeline-body"><p>I don&#x27;t want to go spelunking into code I am extremely unfamiliar with to find this bug when I am not even sure if it&#x27;s already been fixed on master or not.</p>
<p>Closing the issue for now. To reopen, please provide a minimal reproducible code after checking with master.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-01-29 21:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Yuri6037">@Yuri6037</a> on 2021-01-29 21:49</div>
            <div class="timeline-body"><p><code>checking with master</code> I can check with master. I won&#x27;t have time for a reproducible example but I can check if it is fixed on master.</p>
<p>EDIT: I just tried on master and I have the exact same issue.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:58:01 UTC
    </footer>
</body>
</html>
