<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document external subcommands - clap-rs/clap #3887</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Document external subcommands</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/3887">#3887</a>
        opened by <a href="https://github.com/epage">@epage</a>
        on 2022-06-30 02:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a></div>
            <div class="timeline-body"><h3>Discussed in https://github.com/clap-rs/clap/discussions/3863</h3>
<div type='discussions-op-text'>

<p><sup>Originally posted by <strong>cd-work</strong> June 22, 2022</sup>
I'd like to write an external subcommand that accepts any parameter and forwards it, however it should also still be documented as subcommand.</p>
<p>I think this is probably a pretty common scenario, since you usually have some way to know which external subcommands are available even if you do not know their exact parameters. I do <strong>not</strong> want to allow just any subcommand, I have a list which I want to accept with generic parameters, everything else should still cause a failure.</p>
<p>I've tried using <code>ignore_errors(true)</code>, but that only seems to work globally and not on the subcommands themselves. Otherwise it could be used to just accept parameters.</p>
<p>I've also used various combinations of allowing hyphen values and multiple values, but none of them seem to allow for the first argument to have two hyphens.</p>
<p>I only care about the subcommands documentation and description on the toplevel, since <code>bin subcommand --help</code> should already be forwarded to the subcommand and not handled by clap. This is also a scenario where built-in subcommands and flags exist already, so it's not <strong>only</strong> external subcommands I'm worried about.</div></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @epage on 2022-06-30 02:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-decision</span> added by @epage on 2022-06-30 02:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-help</span> added by @epage on 2022-06-30 02:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3885.html">clap-rs/clap#3885</a> on 2022-06-30 02:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-06-30 02:15</div>
            <div class="timeline-body"><blockquote>
<p>I only care about the subcommands documentation and description on the toplevel, since <code>bin subcommand --help</code> should already be forwarded to the subcommand and not handled by clap.</p>
</blockquote>
<p>Unless you are disabling it, this still leaves <code>bin help subcommand</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/emersonford">@emersonford</a> on 2022-06-30 04:04</div>
            <div class="timeline-body"><p>just two cents from someone who's been working on something similar w/ external subcommands, I think a more reasonable approach API might be something like <code>treat_flags_as_positional_args</code> or something of that nature, which could essentially just make the <code>bin subcommand -- this --flag is not treated as a flag</code> behavior the default.</p>
<p>specifically, <code>allow_external_subcommands</code> has the side effect of also handling unrecognized positional args (not just subcommands). if we could tell Clap to treat flags just as positional args, <code>allow_external_subcommand</code> would gracefully handle this situation for free.</p>
<p>would also make it clear that <code>bin help subcommand</code> isn't treated as an external subcommand and I feel like it's a bit clearer than <code>ignore_error</code></p>
<p>edit: this approach would also solve #3880</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cd-work">@cd-work</a> on 2022-06-30 11:14</div>
            <div class="timeline-body"><p>The <code>ignore_errors</code> approach just seems like the simplest way to get an acceptable solution without introducing a dedicated API, though I agree that it is not ideal.</p>
<p>If I had to consider an ideal API for my usecase, I think it would be a way to specify a list of <strong>named</strong> external subcommands with a description of what they do, which is used as documentation on the toplevel, but then also informs clap that these are not going to want their own subcommand docs.</p>
<p>The concrete effect this would have on <code>bin help subcommand</code> still isn't straightforward though. While you could transform it to <code>bin subcommand --help</code>, that's pretty hacky so far from ideal. But just erroring out for external subcommands would probably work just fine, I personally think <code>bin subcommand help</code> makes much more sense to use anyway.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4039.html">clap-rs/clap#4039</a> on 2022-08-08 02:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-09-07 12:43</div>
            <div class="timeline-body"><p>I believe with #4187 it should now work to define subcommands and then capture all their values with <code>arg.trailing_var_arg(true).allow_hyphen_values(true)</code>.   You will also need to disable help and version flags on these semi-external subcommands as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2022-09-07 12:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../saveoursecrets/sdk/pulls/98.html">saveoursecrets/sdk#98</a> on 2022-09-08 01:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:48:39 UTC
    </footer>
</body>
</html>
