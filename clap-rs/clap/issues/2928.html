<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Can't set help_heading on flattened arguments in `clap_derive` - clap-rs/clap #2928</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Can't set help_heading on flattened arguments in `clap_derive`</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/2928">#2928</a>
        opened by <a href="https://github.com/epage">@epage</a>
        on 2021-10-23 16:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/epage">@epage</a> on 2021-10-23 16:09</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.55.0 (c8dfcfe04 2021-09-06)</p>
<h3>Clap Version</h3>
<p>master</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">#[test]
fn flattener_set_help_heading() {
    #[derive(Debug, Clone, Parser)]
    struct CliOptions {
        #[clap(flatten)]
        #[clap(help_heading = &quot;HEADING A&quot;)]
        options_a: OptionsA,
    }

    #[derive(Debug, Clone, Args)]
    struct OptionsA {
        #[clap(long)]
        should_be_in_section_a: Option&lt;u32&gt;,
    }

    let app = CliOptions::into_app();

    let should_be_in_section_a = app
        .get_arguments()
        .find(|a| a.get_name() == &quot;should-be-in-section-a&quot;)
        .unwrap();
    assert_eq!(should_be_in_section_a.get_help_heading(), Some(&quot;HEADING A&quot;));
}

</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<p>Add as test and run it</p>
<h3>Actual Behaviour</h3>
<pre><code>---- flattener_set_help_heading stdout ----
thread 'flattener_set_help_heading' panicked at 'assertion failed: `(left == right)`
  left: `None`,
 right: `Some(&quot;HEADING A&quot;)`', clap_derive/tests/help.rs:184:5
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
<h3>Expected Behaviour</h3>
<p>Passes</p>
<h3>Additional Context</h3>
<p>In providing <a href="https://github.com/rust-cli/clap-verbosity-flag">clap-verbosity-flag</a>, I don't want to prescribe for users what help heading my arguments go under.  At the moment, the only way they can set it is if they set it for the entire struct.</p>
<p>Allowing this argument during flattening would be a big help</p>
<h3>Debug Output</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @epage on 2021-10-23 16:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: derive macros</span> added by @epage on 2021-10-23 16:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-10-23 16:12</div>
            <div class="timeline-body"><p>In fixing this, we'll be introducing a different bug, if both the field and flattened-struct provide <code>help_heading</code>, the flattened-struct will win.  We can't fix this without overcomplicating the interface.  I do think allowing to set help_heading when flattening is worth it enough to have that bug.  In general, I'd recommend crates that expose an <code>Args</code> to not set <code>help_heading</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2930.html">clap-rs/clap#2930</a> on 2021-10-23 16:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @bors[bot] on 2021-10-25 00:40</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:33 UTC
    </footer>
</body>
</html>
