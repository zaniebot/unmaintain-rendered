<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Don't suggest `--` in errors if it isn't relevant - clap-rs/clap #2766</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Don't suggest <code>--</code> in errors if it isn't relevant</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/clap-rs/clap/issues/2766">#2766</a>
        opened by <a href="https://github.com/silvioprog">@silvioprog</a>
        on 2021-09-09 18:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/silvioprog">@silvioprog</a></div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
<h3>Clap Version</h3>
<p>3.0.0-beta.4</p>
<h3>Describe your use case</h3>
<p>Hi.</p>
<p>Assuming I have an <code>args.rs</code> file:</p>
<pre><code class="language-rust">use clap::Clap;

#[derive(Debug, Clap)]
pub struct Args {
    #[clap(short)]
    pub metric: bool,
    #[clap(short)]
    pub imperial: bool,
}

</code></pre>
<p>and a <code>main.rs</code>:</p>
<pre><code class="language-rust">use clap::Clap;

mod args;

fn main() {
    let args = args::Args::parse();
    println!(&quot;{:?}&quot;, args);
}
</code></pre>
<p>if I call the executable like this (passing an invalid flag):</p>
<pre><code class="language-bash">./target/debug/teste -d
</code></pre>
<p>it returns this message:</p>
<pre><code>error: Found argument '-d' which wasn't expected, or isn't valid in this context

        If you tried to supply `-d` as a value rather than a flag, use `-- -d`

USAGE:
    teste [FLAGS]

For more information try --help

</code></pre>
<h3>Describe the solution you'd like</h3>
<p>It would be nice any global configuration in Clap to avoid suggestions like <code>-- -x</code>. The message would be like this, which is much clear for the user (since the application contains only two optional flags):</p>
<pre><code>error: Found argument '-d' which wasn't expected, or isn't valid in this context

USAGE:
    teste [FLAGS]

For more information try --help
</code></pre>
<p>or:</p>
<pre><code>error: Found argument '-d' which wasn't expected, or isn't valid

USAGE:
    teste [FLAGS]

For more information try --help
</code></pre>
<p>or even:</p>
<pre><code>error: Found argument '-d' which isn't valid

USAGE:
    teste [FLAGS]

For more information try --help
</code></pre>
<h3>Alternatives, if applicable</h3>
<p><em>No response</em></p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by @silvioprog on 2021-09-09 18:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> removed by @pksunkara on 2021-09-09 19:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: enhancement</span> added by @pksunkara on 2021-09-09 19:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-09-09 19:02</div>
            <div class="timeline-body"><p>@ldm0 Can we skip that if the subcommand we are parsing doesn't have any args with multiple values?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @ldm0 by @ldm0 on 2021-09-10 04:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: errors</span> added by @pksunkara on 2021-09-24 19:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by @pksunkara on 2021-09-24 19:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/206.html">epage/clapng#206</a> on 2021-12-06 21:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: errors</span> removed by @epage on 2021-12-08 20:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-help</span> added by @epage on 2021-12-08 20:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Allow to show less verbose messages or avoid unsupported suggestions" to "Don't suggest `--` in errors if it isn't relevant" by @epage on 2021-12-13 17:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> removed by @epage on 2021-12-13 17:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-medium</span> added by @epage on 2021-12-13 17:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4379.html">clap-rs/clap#4379</a> on 2022-10-13 12:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/matklad">@matklad</a> on 2022-10-13 12:18</div>
            <div class="timeline-body"><p>Two extra points:</p>
<ul>
<li>this is a regression from clap2</li>
<li>subjectively, this is feels like a huge problem:<ul>
<li>it's very easy for the end-user to trigger this behavior (eg, anything with subcommands with non-global optiosn)</li>
<li>wrong error suggestions make it much harder for the end-user to fix their problem</li>
<li>the particular way this plays out is quite frustrating for the end user</li>
</ul>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-10-13 14:03</div>
            <div class="timeline-body"><p>For extra context, #1284 is the original issue and #1514 is the original PR</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-10-13 14:09</div>
            <div class="timeline-body"><p>@matklad could you expand further on those points so that we better balance the different needs when coming up with a solution.</p>
<p>For example</p>
<blockquote>
<p>it's very easy for the end-user to trigger this behavior (eg, anything with subcommands with non-global optiosn)</p>
</blockquote>
<p>I'm assuming the problem is: &quot;When running a subcommand, I assumed some flags were global and put them after the subcommand and it failed, producing this message which doesn't apply to my situation&quot;</p>
<p>If we made the message conditioned on there being positional arguments, that'll make it so we never show it when it isn't applicable but it can still show up in the workflow you mentioned if the subcommand has positional arguments.  This is one of the points I'm trying to understand since by the direction and strength of your comments it sounds like that wouldn't be acceptable but I want to understand why.</p>
<blockquote>
<p>the particular way this plays out is quite frustrating for the end user</p>
</blockquote>
<p>What was it that was so frustrating with it?  If you ended up going down the wrong path, what was it about the message that you went that way?  I'm trying to understand what is so frustrating about this when to me it clearly articulates when the suggestion is relevant.  This doesn't mean that you wrong but that you have a different perspective that we need to incorporate in handling this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/matklad">@matklad</a> on 2022-10-13 14:30</div>
            <div class="timeline-body"><blockquote>
<p>I'm assuming the problem is: &quot;When running a subcommand, I assumed some flags were global and put them after the subcommand and it failed, producing this message which doesn't apply to my situation&quot;</p>
</blockquote>
<p>Yeah. And, in particular, this seems to be a very frequent problem, rather than an obscure edge case. More generally, it seems to me that more or less any mistake in the args leads to &quot;If you tried to supply ...&quot; message (although often with a more relevant suggestion as well), but the probability that I actually indeed meant to pass <code>--</code> is very low. It's a bit like if <code>rustc</code> added &quot;you could try <code>unsafe { &amp;(*x as *const _)}</code>&quot; as a suggestion for &quot;variable does not live long enough&quot; error. There <em>are</em> rare cases where that'd be a correct suggestion, but they are very rare.</p>
<blockquote>
<p>What was it that was so frustrating with it?</p>
</blockquote>
<p>Several things:</p>
<ul>
<li>confident wrong suggestion which sends me down the wrong path</li>
<li>the fact that if I try to follow the suggestion, I got echoed the same advice</li>
</ul>
<pre><code>λ cargo run -p neard -- init --home h
    Finished dev [unoptimized + debuginfo] target(s) in 0.16s
     Running `target/debug/neard init --home h`
error: Found argument '--home' which wasn't expected, or isn't valid in this context

	If you tried to supply `--home` as a value rather than a flag, use `-- --home`

USAGE:
    neard init [OPTIONS]
</code></pre>
<pre><code>λ cargo run -p neard -- init -- --home h
    Finished dev [unoptimized + debuginfo] target(s) in 0.16s
     Running `target/debug/neard init -- --home h`
error: Found argument '--home' which wasn't expected, or isn't valid in this context

	If you tried to supply `--home` as a value rather than a flag, use `-- --home`

USAGE:
    neard init [OPTIONS]

For more information try --help
</code></pre>
<ul>
<li>the realization that not only it's a wrong suggestion for my situation, but that this can't be a correct suggestion at all (because there's nothing to take the value in this particular CLI)</li>
</ul>
<p>More generally, features which make life more complicated with comparison to a hypothetical where such feature did't exist create a feeling of frustration.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-10-13 14:36</div>
            <div class="timeline-body"><blockquote>
<p>confident wrong suggestion which sends me down the wrong path</p>
</blockquote>
<p>It had a condition on the suggestion.  What was unclear about the condition that you thought it applied (since you were trying to pass a flag instead of a value)?  Or is it a case of &quot;scan and just do what it says&quot;, missing the condition?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-10-13 14:37</div>
            <div class="timeline-body"><blockquote>
<p>but the probability that I actually indeed meant to pass -- is very low</p>
</blockquote>
<p>I can understand in this case.  I have personally been in the same situation as #1284 many times and haven't even considered using <code>--</code> and would have found this helpful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/matklad">@matklad</a> on 2022-10-13 14:55</div>
            <div class="timeline-body"><blockquote>
<p>Or is it a case of &quot;scan and just do what it says&quot;, missing the condition?</p>
</blockquote>
<p>Exactly this: I am a user in a hurry, whose mind is occupied by an unrelated problem. I don't have mental space to carefully consider if-then-else clauses. If a tool suggests some solution, my assumption is that that indeed is the most probable fix.</p>
<blockquote>
<p>many times and haven't even considered using -- and would have found this helpful.</p>
</blockquote>
<p>Exactly: there are some <strong>specific</strong> contexts where <code>--</code> is useful, but they are rare in comparison to all the contexts where <code>--</code> is <em>not</em> useful. Off the top of my head, I recall only two instances where I do want to pass <code>--foo</code> as a value:</p>
<ul>
<li>&quot;take the rest of the argumetns to pass through to another binary&quot; (<code>cargo run</code>)</li>
<li>&quot;needle&quot; argument for text searches</li>
</ul>
<p>That's sort of Bayes' rule, baseline probabilities matter.</p>
<p>There's a bunch of ways we can make this more specific:</p>
<ul>
<li>don't suggest if the suggestion is guaranteed to be wrong</li>
<li>suggest only when we do expect a value and miss one (mandatory positional arg or switch)</li>
<li>suggest only in highly-likely situations (trailing args pattern)</li>
<li>add API to flag a specific argument with &quot;hey, the value here might start with <code>-</code>&quot;, which would affect both default help and error messages.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4380.html">clap-rs/clap#4380</a> on 2022-10-13 16:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-10-13 18:27</div>
            <div class="timeline-body"><p>For now, #4380 limits the <code>--</code> suggestion to only if</p>
<ul>
<li><code>--</code> hasn't already been used</li>
<li>positional arguments exist</li>
<li>a short or long was passed in (refinement of existing condition)</li>
</ul>
<p>Something I've also been considering for both clap and cargo is following <a href="https://rustc-dev-guide.rust-lang.org/diagnostics.html#suggestion-style-guide">the rustc diagnostic guidelines</a> of not suggesting things to users but informing users what exist.</p>
<p>EDIT: To be clear, I'm leaving this open to encourage further discussion on the overall direction</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4385.html">clap-rs/clap#4385</a> on 2022-10-13 19:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-10-13 19:05</div>
            <div class="timeline-body"><p>I've created #4385 to tweak the wording of the suggestions.  It could probably use some more work and I'm hesitant in doing a change like this in a patch release as people might design some of their own CLI to match clap and changing it could provide a degraded experience, so we might want to call attention to this by saving it for a minor release.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-10-13 19:13</div>
            <div class="timeline-body"><p>v4.0.15 is released with #4380.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Nemo157">@Nemo157</a> on 2023-06-29 11:04</div>
            <div class="timeline-body"><p>#4380 (or changes since then since that was quite some time ago) doesn't help with subcommands:</p>
<pre><code class="language-console">&gt; sshagmux lis
error: unrecognized subcommand 'lis'

  tip: a similar subcommand exists: 'list'
  tip: to pass 'lis' as a value, use 'sshagmux -- lis'

Usage: sshagmux &lt;COMMAND&gt;

For more information, try '--help'.
</code></pre>
<p>There is nowhere for &quot;values&quot; to go, and in fact trying to use this form emits the exact same error message</p>
<pre><code class="language-console">&gt; sshagmux -- lis
error: unrecognized subcommand 'lis'

  tip: a similar subcommand exists: 'list'
  tip: to pass 'lis' as a value, use 'sshagmux -- lis'

Usage: sshagmux &lt;COMMAND&gt;

For more information, try '--help'.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5033.html">clap-rs/clap#5033</a> on 2023-07-21 19:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-07-21 19:45</div>
            <div class="timeline-body"><p>That is fixed in v4.3.18 by #5033</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5055.html">clap-rs/clap#5055</a> on 2023-08-08 02:38</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:48:04 UTC
    </footer>
</body>
</html>
