<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow defining help heading for help flags - clap-rs/clap #4831</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow defining help heading for help flags</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/4831">#4831</a>
        opened by <a href="https://github.com/paradigm">@paradigm</a>
        on 2023-04-12 10:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/paradigm">@paradigm</a> on 2023-04-12 10:58</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>4.2</p>
<h3>Describe your use case</h3>
<p>My derive-based application has <code>#[clap(global = true)]</code> flags placed under <code>#[clap(help_heading = &quot;Common options&quot;)]</code> and per-subcommand flags placed under per-subcommand <code>help_heading</code>s.  The <code>-h</code>/<code>--help</code> flag should be placed under <code>#[clap(help_heading = &quot;Common options&quot;)]</code>, as it is available irrelevant of subcommand, but there is no straight forward way to define a heading for this flag other than the default <code>Options</code>.</p>
<h3>Describe the solution you'd like</h3>
<p>Something like a <code>#[clap(help_flag_help_heading = &quot;...&quot;]</code> setting available via clap's derive API to define the help flag's <code>help_heading</code>.</p>
<h3>Alternatives, if applicable</h3>
<p><code>#[clap(disable_help_flag = true)]</code> paired with a way to manually add <code>-h</code>/<code>--help</code> via the derive API.  This would in turn require:</p>
<ul>
<li>A way to make flag-like subcommands so <code>::parse()</code> does not exit with the <code>'&lt;executable&gt;' requires subcommand but one was not provided</code> message when <code>-h</code>/<code>--help</code> is provided rather than a subcommand.</li>
<li>A way to <code>print_help()</code> via the derive API, both for the application as a whole and per-subcommand.  I could only find ways to do this via the builder API.</li>
</ul>
<h3>Additional Context</h3>
<p>A very similar situation arises with the version flag.  While I do not use it, others who do may benefit from it being taken into consideration here as well, e.g. by adding a <code>#[clap(version_flag_help_heading = &quot;...&quot;)]</code> or making a <code>print_version()</code> accessible via the derive API.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @paradigm on 2023-04-12 10:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-04-12 13:33</div>
            <div class="timeline-body"><blockquote>
<p>#[clap(disable_help_flag = true)] paired with a way to manually add -h/--help via the derive API. This would in turn require:</p>
</blockquote>
<p>The simplest way to create a custom help flag is to add  <code>#[arg(action = clap::ArgAction::Help)]</code> to a flag field.  Is there a reason your solution requires a help subcommand?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-04-12 13:36</div>
            <div class="timeline-body"><p>For context, clap v2 had various API settings for customizing the built-in help.  At least by clap v3, we had</p>
<ul>
<li>The above settings</li>
<li><code>mut_arg(&quot;help&quot;, |arg| arg)</code> to force creation of <code>help</code> and modify it</li>
<li>Auto-detecting of something looking like help and making it act like help</li>
</ul>
<p>These created a system that &quot;just worked&quot; in some cases but then completely failed in others without a clear reason.  These were also slow at runtime and bloated the binary.  From this, we decided to use the <code>ArgAction</code> work to simplify this all down by requiring more explicit action by the user.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/paradigm">@paradigm</a> on 2023-04-12 16:41</div>
            <div class="timeline-body"><p><code>#[arg(action = clap::ArgAction::Help)]</code> indeed works and is a very elegant solution.  Apologies, my research here missed the fact that this was the proper way to go about things now.</p>
<p>I did try that (amongst other things) before making this GitHub issue but tripped on the necessary associated type.  I initially assumed it should be a <code>bool</code>, as that's what's typically used for <code>--help</code>-like flags that either are or aren't present, but this resulted in a surprising runtime error that the field must be used. [0]  Only after you indicated that this is the correct route did I discover <a href="https://docs.rs/clap/latest/clap/_derive/index.html#arg-types">clap's derive API accepts <code>()</code> fields</a>.</p>
<p>I think additional documentation here, perhaps <a href="https://docs.rs/clap/latest/clap/enum.ArgAction.html">in the ArgAction documentation</a> or in <a href="https://docs.rs/clap/latest/clap/_derive/_tutorial/index.html">the derive tutorial</a> may help ensure others don't trip on the same issue I did.  That said, I recognize it's a delicate balance; making a tutorial too long may inhibit people's desire to consume its entirety.</p>
<p>Many thanks both for your help here and your work on clap in general.</p>
<hr />
<p>[0] A minimal example:</p>
<pre><code>use clap::Parser;

#[derive(Parser)]
#[clap(disable_help_flag = true)]
struct Cli {
    #[arg(short, long, action = clap::ArgAction::Help, required = false)]
    help: bool, // flag is bool, similar to other flags which either are or aren't set
}

fn main() {
    let _ = Cli::parse();
    println!(&quot;arg parsing succeeded&quot;);
}
</code></pre>
<p>resulted in:</p>
<pre><code>$ cargo run
    Finished dev [unoptimized + debuginfo] target(s) in 0.02s
     Running `target/debug/help-flag`
error: The following required argument was not provided: help

Usage: help-flag
</code></pre>
<p>The solution here appears to be to set the type to <code>()</code>, which makes it clear to clap that no value is expected.  Careful reading of the documentation indicates the ArgAction triggers when the argument is <em>encountered</em>, irrelevant of its <em>value</em>.  This:</p>
<pre><code>use clap::Parser;

#[derive(Parser)]
#[clap(disable_help_flag = true)]
struct Cli {
    #[arg(short, long, action = clap::ArgAction::Help, required = false)]
    help: (), // flag is (), indicating we don't care about the value, only if the arg is encountered
}

fn main() {
    let _ = Cli::parse();
    println!(&quot;arg parsing succeeded&quot;);
}
</code></pre>
<p>resulted in the expected behavior:</p>
<pre><code>$ cargo run
    Finished dev [unoptimized + debuginfo] target(s) in 0.02s
     Running `target/debug/help-flag`
error: The following required argument was not provided: help

arg parsing succeeded
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @paradigm on 2023-04-12 16:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-04-12 17:48</div>
            <div class="timeline-body"><p>Not working with <code>bool</code> is being tracked in #4367</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:09 UTC
    </footer>
</body>
</html>
