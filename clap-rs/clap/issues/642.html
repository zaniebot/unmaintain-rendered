<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panicking default_value due to converting YAML Real to String - clap-rs/clap #642</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Panicking default_value due to converting YAML Real to String</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/642">#642</a>
        opened by <a href="https://github.com/SuperFluffy">@SuperFluffy</a>
        on 2016-09-01 15:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/SuperFluffy">@SuperFluffy</a> on 2016-09-01 15:07</div>
            <div class="timeline-body"><p>Given the minimal example below, I get the following error message:</p>
<pre><code>thread 'main' panicked at 'failed to convert YAML Real(&quot;0.1&quot;) value to a string'
</code></pre>
<p>Any idea what's going on here?</p>
<p><code>main.rs</code>:</p>
<pre><code class="language-rust">#[macro_use] extern crate clap;

use clap::App;

fn main() {
    let yml = load_yaml!(&quot;cli.yml&quot;);
    let matches = App::from_yaml(yml)
        .get_matches();
}
</code></pre>
<p><code>cli.yml</code>:</p>
<pre><code class="language-yaml">name: Clap Yaml Scrap

args:
    - test:
        takes_value: true
        default_value: 0.1
</code></pre>
<p><code>Cargo.toml</code>:</p>
<pre><code class="language-toml">[package]
name = &quot;clap-yaml-scrap&quot;
version = &quot;0.1.0&quot;
authors = [&quot;SuperFluffy&quot;]

[dependencies]

[dependencies.clap]
version = &quot;2.11&quot;
features = [&quot;yaml&quot;]
</code></pre>
<p><strong>EDIT:</strong> Alright, I figure the issue comes from <a href="https://github.com/kbknapp/clap-rs/blob/b7793a2f4d1132f29b3e7858d4ebbb1027f31d39/src/args/macros.rs#L25">this macro</a>. It's calling <code>as_str()</code> on the <code>Yaml::Real</code>, which is not defined. <code>as_str()</code> is only defined for <code>Yaml::String</code>, as you can see <a href="https://github.com/chyh1990/yaml-rust/blob/f7d2897bc0621ef38d7f6d844c6402d64dcbee23/src/yaml.rs#L232">here</a>.</p>
<p><code>Yaml::Real</code> only has <code>as_f64()</code> defined, which however we cannot a priori invoke as we don't know whether or not <code>default_value</code> is a <code>f64</code> or something else entirely.</p>
<p>I guess the only way to work around this is by demanding that <code>default_value</code> be set to a string in the <code>Yaml</code>, i.e. <code>default_value: &quot;0.1&quot;</code>.</p>
<p><strong>EDIT:</strong> Of course, this applies to <code>Yaml::Integer</code> as well. Basically, <code>default_value</code> <em>has</em> to take a string.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Panicking when converting YAML Real to String" to "Panicking default_value due to converting YAML Real to String" by @SuperFluffy on 2016-09-02 07:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-09-05 17:49</div>
            <div class="timeline-body"><p>This is partly due to that clap deals in strings, i.e. the default value will be the string <code>&quot;0.1&quot;</code> not the integer <code>0.1</code>. To fix this, use <code>default_value: &quot;0.1&quot;</code> and then in the user code convert that string to an integer (via <code>parse::&lt;f32&gt;()</code> or whichever is appropriate.</p>
<p>I agree it's confusing, and less than optimal, but logically all command line arguments are strings, and it's the consumer code that does the conversions.</p>
<p>There may be a better way to represent this in the docs/training. Of course I'd love to have <code>clap</code> automatically parse out to the correct number type, but at this time that's not quite doable on a large scale and thus gets left to consumer code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> added by @kbknapp on 2016-09-05 17:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SuperFluffy">@SuperFluffy</a> on 2016-09-07 13:01</div>
            <div class="timeline-body"><p>Maybe this should be made explicit in one of the docs? At first, I was expecting the <code>0.1</code> to be simply parsed as a string just like all the other values in the Yaml.</p>
<p>Since I suspect there is no way of making <code>yaml-rust</code> treat all values as strings (due to the spec), maybe this should be made explicit in the docs?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2016-10-21 20:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:18 UTC
    </footer>
</body>
</html>
