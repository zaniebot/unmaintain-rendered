<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bug: Bash completion is broken when sub-command names have hyphens - clap-rs/clap #1129</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Bug: Bash completion is broken when sub-command names have hyphens</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1129">#1129</a>
        opened by <a href="https://github.com/fluffysquirrels">@fluffysquirrels</a>
        on 2017-12-16 11:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/fluffysquirrels">@fluffysquirrels</a></div>
            <div class="timeline-body"><h3>Rust Version</h3>
<p><code>rustc 1.22.1 (05e2e1c41 2017-11-22)</code></p>
<h3>Affected Version of clap</h3>
<p><code>master</code> at time of discovery (e0f8479e0f6522af24484abc79aee24d60b939d2)</p>
<h3>Expected Behavior Summary</h3>
<p>Bash completion should suggest parameters for a sub-command with a name that contains hypens.</p>
<h3>Actual Behavior Summary</h3>
<p>Bash completion suggests parameters for a higher level sub-command, or none at all.</p>
<h3>Steps to Reproduce the issue</h3>
<ul>
<li>Create a crate that uses clap and contains an App with sub-commands that have hyphens in their name, and also some arguments of their own.</li>
<li>Generate the bash completion script for the App and source it into a bash shell.</li>
<li>If you press tab after typing the sub-command name with a hyphen, the completion list should contain that sub-command's arguments, but it does not.</li>
</ul>
<h3>Sample Code or Link to Sample Code</h3>
<p>Here's a sample app definition from the test I've written in my fork:</p>
<pre><code class="language-rust">fn build_app_with_name(s: &amp;'static str) -&gt; App&lt;'static, 'static&gt; {
    App::new(s)
        .about(&quot;Tests completions&quot;)
        .arg(Arg::with_name(&quot;file&quot;).help(&quot;some input file&quot;))
        .subcommand(SubCommand::with_name(&quot;test&quot;)
            .about(&quot;tests things&quot;)
            .arg(Arg::with_name(&quot;case&quot;)
                .long(&quot;case&quot;)
                .takes_value(true)
                .help(&quot;the case to test&quot;)))
}

/// This is the sample app that displays the issue.
fn build_app_special_commands() -&gt; App&lt;'static, 'static&gt; {
    build_app_with_name(&quot;my_app&quot;)
        .subcommand(SubCommand::with_name(&quot;some_cmd&quot;)
                    .about(&quot;tests other things&quot;)
                    .arg(Arg::with_name(&quot;config&quot;)
                         .long(&quot;--config&quot;)
                         .takes_value(true)
                         .help(&quot;the other case to test&quot;)))
        .subcommand(SubCommand::with_name(&quot;some-cmd-with-hypens&quot;))
}
</code></pre>
<hr />
<p>I have fixed this in my fork already and will add a pull request in a moment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/1130.html">clap-rs/clap#1130</a> on 2017-12-16 11:48</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Bug: Bash completion is broken when sub-commands have hypens" to "Bug: Bash completion is broken when sub-commands have hyphens" by @fluffysquirrels on 2017-12-16 11:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Bug: Bash completion is broken when sub-commands have hyphens" to "Bug: Bash completion is broken when sub-command names have hyphens" by @fluffysquirrels on 2017-12-16 11:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ghost">@ghost</a> on 2017-12-20 19:54</div>
            <div class="timeline-body"><pre><code class="language-rust">clap_app!(gist =&gt;
            (version: &quot;0.1.0&quot;)
            (about: DESC)
            (@arg FORMAT: +required &quot;pretty-printing format specification&quot;)
            (@arg path: -p --path +takes_value &quot;path to test&quot;)
            (@subcommand is-repo =&gt;
                (about: &quot;Determine if given path is a git repository&quot;)
                (@arg path: -p --path +takes_value &quot;path to test [default \&quot;.\&quot;]&quot;)
            )
        ).get_matches();
</code></pre>
<p>Hyphens also fail when using the <code>clap_app!</code> macro.</p>
<pre><code>error: no rules expected the token `app`
  --&gt; src/main.rs:78:23
   |
78 |           let matches = clap_app!(gist =&gt;
   |  _______________________^
79 | |             (version: &quot;0.1.0&quot;)
80 | |             (about: DESC)
...  |
87 | |             )
88 | |         ).get_matches();
   | |_________^
   |
   = note: this error originates in a macro outside of the current crate

</code></pre>
<p>Removing the hyphen works as expected.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2018-01-09 15:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jeremymv2">@jeremymv2</a> on 2018-05-01 13:29</div>
            <div class="timeline-body"><p>@kbknapp</p>
<p>Is there anything special I need to do in order to use the macro with subcommand containing a hyphen?</p>
<p>With version 2.31.2 and this block, I still get an error:</p>
<pre><code>206         (@subcommand gather-logs =&gt;
207             (about: &quot;Gather important rumor, spec, log and other files for troubleshooting&quot;)
208             (aliases: &amp;[&quot;gl&quot;])
209         )
</code></pre>
<pre><code>133 | /     clap_app!((&quot;hab-sup&quot;) =&gt;
134 | |         (about: &quot;The Habitat Supervisor&quot;)
135 | |         (version: VERSION)
136 | |         (author: &quot;\nAuthors: The Habitat Maintainers &lt;humans@habitat.sh&gt;\n&quot;)
...   |
209 | |         )
210 | |     )
    | |_____^
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../habitat-sh/habitat/pulls/5019.html">habitat-sh/habitat#5019</a> on 2018-05-02 16:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:47:03 UTC
    </footer>
</body>
</html>
