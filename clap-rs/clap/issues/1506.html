<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium typed arguments support - clap-rs/clap #1506</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Premium typed arguments support</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/1506">#1506</a>
        opened by <a href="https://github.com/ColinPitrat">@ColinPitrat</a>
        on 2019-06-23 07:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/ColinPitrat">@ColinPitrat</a> on 2019-06-23 07:53</div>
            <div class="timeline-body"><p>One of the main features I'd expect from clap is to be able to specify the type of an argument, typically int, and have it provide an helpful error message is the argument cannot be parsed properly.</p>
<p>Currently, either one has to parse the argument string and provide an error message or move the logic to a custom validator that tries to parse and display a helpful message if it fails, but still need to parse after that (but can unwrap() as the validator already ensure the value is convertible).</p>
<p>I see two main options to do that:</p>
<ul>
<li>provide &quot;standard&quot; generic validators like is_type<T>() or is_type_between<T>(min: T, max: T). Then the user still has to parse but can be sure it will succeed (so unwrap()) and knows, if needed, some value checks have been done already</li>
<li>provide a new type() method to the builder. The args would be checked in a similar ways as validator do (to provide a helpful message) but on top of that, a generic typed_value_of method<T> would return the arg with the proper type provided. It would panic if the type T is not the same as the one provided for the argument.</li>
</ul>
<p>Ideally this would also cover flags like enum, vectors (e.g comma separated) as long as the proper trait is provided (typically TryFrom/TryInto) etc...</p>
<p>What do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ColinPitrat">@ColinPitrat</a> on 2019-06-23 08:16</div>
            <div class="timeline-body"><p>Currently, what I do when I need this:</p>
<pre><code>fn is_type&lt;T: FromStr&gt;(val: String) -&gt; Result&lt;(), String&gt;
where &lt;T as std::str::FromStr&gt;::Err : std::string::ToString
{
    match val.parse::&lt;T&gt;() {
        Ok(_) =&gt; Ok(()),
        Err(m) =&gt; Err(m.to_string()),
    }
}
</code></pre>
<p>Used like this:</p>
<pre><code>        .arg(Arg::with_name(&quot;some_uint&quot;)
                .required(true)
                (...)
                .validator(is_type::&lt;u32&gt;))
(...)

    let some_uint = match matches.value_of(&quot;some_uint&quot;).parse::&lt;u32&gt;().unwrap();
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/omarabid">@omarabid</a> on 2019-07-17 18:44</div>
            <div class="timeline-body"><p>I know it doesn't solve your problem but: https://github.com/clap-rs/clap_derive/issues/4</p>
<p>I think it's better to get the CustomDerive done by now. It could enable a bunch of stuff: Like handling configuration through clap-rs</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">clap-derive-related</span> added by @CreepySkeleton on 2020-02-01 13:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: derive macros</span> added by @pksunkara on 2020-02-03 09:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">clap-derive-related</span> removed by @pksunkara on 2020-02-03 09:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-09 08:03</div>
            <div class="timeline-body"><p>You should be able to achieve this with <code>clap_derive</code> now. For normal clap use, this issue about feature request to add some helpers.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: derive macros</span> removed by @pksunkara on 2020-04-09 08:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: validators</span> added by @pksunkara on 2020-04-09 08:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: medium</span> added by @pksunkara on 2020-04-09 08:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> added by @pksunkara on 2020-04-09 08:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by @pksunkara on 2020-04-09 08:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-11-04 16:12</div>
            <div class="timeline-body"><p>Didn't know we had this issue.  We've started requirements gathering and high level design of this at https://github.com/clap-rs/clap/issues/2683 which we are hoping to implement for clap 4.</p>
<p>Closing this out in favor of https://github.com/clap-rs/clap/issues/2683</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2021-11-04 16:12</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:32 UTC
    </footer>
</body>
</html>
