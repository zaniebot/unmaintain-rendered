<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Have `help` subcommand show help for other subcommands - clap-rs/clap #416</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Have <code>help</code> subcommand show help for other subcommands</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/416">#416</a>
        opened by <a href="https://github.com/crumblingstatue">@crumblingstatue</a>
        on 2016-02-04 18:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/crumblingstatue">@crumblingstatue</a></div>
            <div class="timeline-body"><p>Right now, the auto generated help subcommand seems to ignore trailing arguments, even if
they are names of other subcommands.</p>
<p>What I expect is that it would show the help for the subcommand provided as an argument.
This is how for example Cargo (<code>cargo help build</code>) or Git (<code>git help commit</code>) work.</p>
Example
<p>A simple mock cargo</p>
<pre><code>extern crate clap;

use clap::{App, AppSettings, SubCommand};

fn main() {
    App::new(&quot;cargo&quot;)
        .setting(AppSettings::SubcommandRequiredElseHelp)
        .about(&quot;Rust&#x27;s mock package manager&quot;)
        .subcommand(SubCommand::with_name(&quot;build&quot;)
                        .about(&quot;Compile the current project&quot;)
                        .after_help(&quot;This is a mock cargo-build command.\nNot real.&quot;))
        .get_matches();
}
</code></pre>
<p>Help invocation</p>
<pre><code>$ cargo-mock help
cargo 
Rust&#x27;s mock package manager

USAGE:
    cargo-mock [FLAGS] [SUBCOMMAND]

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

SUBCOMMANDS:
    build    Compile the current project
    help     Prints this message
</code></pre>
<p>I want to know more about the build subcommand. The instinctive action is to invoke help with the subcommand name as the argument.</p>
<pre><code>$ cargo-mock help build
cargo 
Rust&#x27;s mock package manager

USAGE:
    cargo-mock [FLAGS] [SUBCOMMAND]

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

SUBCOMMANDS:
    build    Compile the current project
    help     Prints this message
</code></pre>
<p>Strange. It just prints the same thing as before.</p>
<p>What I expect to happen instead:</p>
<pre><code>$ cargo-mock help build # (output was generated by cargo-mock build --help)
cargo-mock-build 
Compile the current project

USAGE:
    cargo-mock build [FLAGS]

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

This is a mock cargo-build command.
Not real.

</code></pre>
<p>If possible, it would be nice if it would error if an invalid subcommand was provided as an argument.
Cargo example:</p>
<pre><code>$ cargo help biuld
no such subcommand

    Did you mean `build`?

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-02-04 20:11</div>
            <div class="timeline-body"><p>Thanks for taking the time to file this!</p>
<p>This was actually a by-design decision. What you&#x27;re looking for is implemented in reverse, i.e.</p>
<p>These two are identical</p>
<pre><code>$ cargo-mock build help
$ cargo-mock build --help
</code></pre>
<p>While it would be possible to implement a setting to switch this, or allow switching to</p>
<pre><code>$ cargo-mock help build
</code></pre>
<p>But I&#x27;d prefer that be an opt-in setting and not the default. This is what I&#x27;m thinking of in order to implement what you&#x27;re talking about:</p>
<pre><code>extern crate clap;

use clap::{App, AppSettings, SubCommand};

fn main() {
    App::new(&quot;cargo&quot;)
        .setting(AppSettings::SubcommandRequiredElseHelp)
        .setting(AppSettings::ReverseHelpSubcommand)
        .about(&quot;Rust&#x27;s mock package manager&quot;)
        .subcommand(SubCommand::with_name(&quot;build&quot;)
                        .about(&quot;Compile the current project&quot;)
                        .after_help(&quot;This is a mock cargo-build command.\nNot real.&quot;))
        .get_matches();
}
</code></pre>
<p>The downside to this that while matching, once <code>help</code> is matched, you then half to consume the next argument and see if that matches an existing subcommand or not. It&#x27;s not impossible, and it&#x27;d actually be pretty easy to implement, just something to consider.</p>
<p>We would also need to implement an appropriate error in case someone did</p>
<pre><code>$ cargo-mock help
</code></pre>
<p>Which now that I&#x27;m thinking out loud about it would be simple - if <code>ReverseHelpSubcommand</code> (or whatever it gets called) is set, the <code>help</code> subcommand will get one required argument  which must match a list of all given subcommands. Should be simple.</p>
<p>I&#x27;ll mark this as new-setting, and play with some implementations.</p>
<p>Thanks again :+1:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-02-04 20:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: subcommands</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-02-04 20:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-02-04 20:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: parsing</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-02-04 20:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-02-04 20:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">M: mentored</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-02-04 20:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: settings</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-02-04 20:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new setting</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-02-04 20:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-02-05 08:33</div>
            <div class="timeline-body"><p>Other names for settings could be <code>GlobalHelpSubcommand</code></p>
<p>Because what I imagine (and I&#x27;d be curious to hear your input) would be that the top level <code>help</code> would also essentially call the <code>--help</code> of <em>any</em> subcommand regardless of depth.</p>
<p>i.e. Imagine the following fictional subcommand structure</p>
<pre><code>         cargo-mock
      /    |        \
 subcmd   help    do-stuff
 /   \               |
add   filter       list
</code></pre>
<p>~~Calling any of these would be valid~~:</p>
<pre><code>$ cargo-mock help subcmd
$ cargo-mock help list
$ cargo-mock help filter
$ carg-mock help do-stuff
[ .. etc. ]
</code></pre>
<p>Or would you expect something like</p>
<pre><code>$ cargo-mock help subcmd
$ cargo-mock help do-stuff list
$ cargo-mock help subcmd filter
$ carg-mock help do-stuff
[ .. etc. ]
</code></pre>
<p>~~Finally a third option is (which I dont&#x27; like as much)~~</p>
<pre><code>$ cargo-mock help subcmd
$ cargo-mock do-stuff help list
$ cargo-mock subcmd help filter
$ carg-mock help do-stuff
[ .. etc. ]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/crumblingstatue">@crumblingstatue</a> on 2016-02-05 12:42</div>
            <div class="timeline-body"><blockquote>
<p>Because what I imagine (and I&#x27;d be curious to hear your input) would be that the top level help would also essentially call the --help of any subcommand regardless of depth.</p>
</blockquote>
<p>Wouldn&#x27;t that cause ambiguities if there are multiple subcommands of the same name?</p>
<p>e.g.</p>
<pre><code>         cargo-mock
      /    |        \
 subcmd   help    do-stuff
 /   \               |
add   list         list
</code></pre>
<p>Another problem with postfix help subcommand is that subcommands can take positional arguments.</p>
<p>e.g. <code>git rm help</code> would remove a file called <code>help</code> instead of showing help, while <code>git help rm</code> works, and it&#x27;s unambiguous.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-02-05 20:59</div>
            <div class="timeline-body"><p>Yes, you&#x27;re correct option 1 wouldn&#x27;t work. I realized that after posting it.</p>
<p>Post fix such as <code>git rm help</code> is already implemented and works today. It work by first checking if args match a subcommand, then accept them as arguments if they don&#x27;t. So in order to pass a argument that <em>also</em> matches a subcommand, such as removing a file called <code>help</code> you&#x27;d have to do <code>git rm -- help</code></p>
<p>I <em>do</em> however like the option of adding option 2 as an opt-in setting (only because the default is already set to postfix and changing it would be a breaking change). So <code>git help subcmd list</code> would be different from <code>git help do-stuff list</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#445</a> on 2016-03-10 16:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-03-10 16:36</div>
            <div class="timeline-body"><p>@Fiedzia Comments from #445</p>
<blockquote>
<p>Having &quot;list&quot; subcommand, I&#x27;d like to display help for it when called as &quot;help list&quot;
(./prog help list). Currently it displays help for all available options and subcommands.
There seem to be settings NeedsSubcommandHelp for that, but its not documented, so I am not sure what it is supposed to do.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-03-10 16:38</div>
            <div class="timeline-body"><blockquote>
<p>There seem to be settings NeedsSubcommandHelp for that, but its not documented, so I am not sure what it is supposed to do</p>
</blockquote>
<p>@Fiedzia that is an internal setting which isn&#x27;t really intended to be used by end users. I have a few other features to implement as well as this one, but I do plan on adding another setting to give the desired effect you&#x27;re looking for :wink: Subscribe to this issue for updates on the feature.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#450</a> on 2016-03-15 02:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/homu">@homu</a> on 2016-03-15 20:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>lurk-lab/lurk-beta#555</a> on 2023-08-11 21:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:56:21 UTC
    </footer>
</body>
</html>
