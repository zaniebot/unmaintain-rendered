<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cannot order options versus positional arguments - clap-rs/clap #1291</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Cannot order options versus positional arguments</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/1291">#1291</a>
        opened by <a href="https://github.com/gcp">@gcp</a>
        on 2018-06-08 21:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/gcp">@gcp</a> on 2018-06-08 21:32</div>
            <div class="timeline-body"><h3>Affected Version of clap</h3>
<p>version = &quot;2.31.2&quot;</p>
<h3>Expected Behavior Summary</h3>
<pre><code>    let matches = App::new(&quot;foo)
        .version(crate_version!())
        .about(env!(&quot;CARGO_PKG_DESCRIPTION&quot;))
        .author(crate_authors!())
        .setting(AppSettings::TrailingVarArg)
        .arg(
            Arg::with_name(&quot;fd&quot;)
                .long(&quot;fd&quot;)
                .help(&quot;Starts as server communicating on fd#&quot;)
                .takes_value(true)
                .number_of_values(1)
                .required(true)
                .display_order(1)
                .conflicts_with(&quot;target&quot;),
        )
        .arg(
            Arg::with_name(&quot;target&quot;)
                .help(&quot;Launches the target program&quot;)
                .index(1)
                .required(true)
                .conflicts_with(&quot;fd&quot;),
        )
        .arg(
            Arg::with_name(&quot;target_args&quot;)
                .help(&quot;Arguments for the target program&quot;)
                .index(2)
                .multiple(true)
                .requires(&quot;target&quot;),
        )
        .get_matches();
</code></pre>
<p>This prints:</p>
<pre><code>USAGE:
    foo &lt;target&gt; --fd &lt;fd&gt; [target_args]...
</code></pre>
<p>It's not possible to order the &quot;fd&quot; argument before the positional ones in usage (display order 1 for fd vs default display order for target/target_args). DeriveDisplayOrder does not help either.</p>
<p>Because fd and target are exclusive, but target_args requires target, it is annoying that USAGE prints fd in-between target and target_args.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-06-10 18:54</div>
            <div class="timeline-body"><p>The best way to do this is with an <a href="https://docs.rs/clap/2.31.2/clap/struct.ArgGroup.html"><code>ArgGroup</code></a>. It's usually not advised to have two required arguments which are mutually exclusive. The preferred method is to add both mutually exclusive args to an <code>ArgGroup</code> and make that group required.</p>
<pre><code class="language-rust">    let matches = App::new(&quot;foo&quot;)
        .version(crate_version!())
        .about(env!(&quot;CARGO_PKG_DESCRIPTION&quot;))
        .author(crate_authors!())
        .setting(AppSettings::TrailingVarArg)
        .arg(
            Arg::with_name(&quot;fd&quot;)
                .long(&quot;fd&quot;)
                .help(&quot;Starts as server communicating on fd#&quot;)
                .takes_value(true)
                .number_of_values(1)
                .display_order(1)
                .conflicts_with(&quot;target&quot;),
        )
        .arg(
            Arg::with_name(&quot;target&quot;)
                .help(&quot;Launches the target program&quot;)
                .index(1)
                .conflicts_with(&quot;fd&quot;),
        )
        .arg(
            Arg::with_name(&quot;target_args&quot;)
                .help(&quot;Arguments for the target program&quot;)
                .index(2)
                .multiple(true)
                .requires(&quot;target&quot;),
        )
        .group(
            ArgGroup::with_name(&quot;target_fd&quot;)
                .arg(&quot;fd&quot;)
                .arg(&quot;target&quot;)
                .required(true)
        )
        .get_matches();
</code></pre>
<p>However, this points out a different bug in the usage string printer :stuck_out_tongue_winking_eye:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2018-06-10 18:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-06-10 18:54</div>
            <div class="timeline-body"><p>I'm going to close this issue, and open a new one for the bug this pointed out</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-06-10 19:05</div>
            <div class="timeline-body"><p>See #1292</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gcp">@gcp</a> on 2018-06-21 15:21</div>
            <div class="timeline-body"><p>I'm testing this suggestion now, but (aside from the printing issue), it does not work. I wonder if I didn't manage to explain the expected behavior well enough.</p>
<p>There are two uses for my program:</p>
<p><code>foo --fd 5</code></p>
<p>or</p>
<p><code>foo vim file.txt</code></p>
<p>This works as intended, except for the argument printing order in the help or usage suggestion not being modifiable (and awkward by default). If I follow your suggestion, I'll get an error like <code>error: The argument '--fd &lt;fd&gt;' cannot be used with one or more of the other specified arguments</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gcp">@gcp</a> on 2018-06-21 15:25</div>
            <div class="timeline-body"><p>That is, the code I pasted works as expected, but prints:</p>
<pre><code>USAGE:
    foo &lt;target&gt; --fd &lt;fd&gt; [target_args]...
</code></pre>
<p>Trying to modify the argument order to make it read:</p>
<pre><code>USAGE:
    foo --fd &lt;fd&gt; &lt;target&gt; [target_args]...
</code></pre>
<p>Does not work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-06-22 15:47</div>
            <div class="timeline-body"><p>You can also specify a usage string manually with <code>App::usage</code> which then ignores the autogenerated one.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:32 UTC
    </footer>
</body>
</html>
