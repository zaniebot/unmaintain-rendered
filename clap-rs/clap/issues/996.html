<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How does one pass a dynamic `String` to the `version` function? - clap-rs/clap #996</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>How does one pass a dynamic `String` to the `version` function?</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/996">#996</a>
        opened by <a href="https://github.com/TomasTomecek">@TomasTomecek</a>
        on 2017-07-07 09:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/TomasTomecek">@TomasTomecek</a> on 2017-07-07 09:26</div>
            <div class="timeline-body"><h3>Rust Version</h3>
<p>rustc 1.18.0</p>
<h3>Affected Version of clap</h3>
<pre><code class="language-toml">[[package]]
name = &quot;clap&quot;
version = &quot;2.20.5&quot;
source = &quot;registry+https://github.com/rust-lang/crates.io-index&quot;
dependencies = [
 &quot;bitflags 0.7.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
 &quot;unicode-segmentation 1.1.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
 &quot;unicode-width 0.1.4 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
 &quot;vec_map 0.6.0 (registry+https://github.com/rust-lang/crates.io-index)&quot;,
]
</code></pre>
<h3>Actual Behavior Summary</h3>
<p>I am getting a compilation failure due to lifetimes mismatch. I am trying to
add commit hash from an environment variable and pass it to <code>version</code> function
of <code>App</code>.</p>
<h3>Sample Code or Link to Sample Code</h3>
<pre><code class="language-rust">use clap::{App,Arg,SubCommand};

fn get_version_str() -&gt; String {
    let version: Option&lt;&amp;'static str&gt; = option_env!(&quot;CARGO_PKG_VERSION&quot;);
    let commit: Option&lt;&amp;'static str&gt; = option_env!(&quot;TRAVIS_COMMIT&quot;);
    let mut result: String;
    match version {
        Some(v) =&gt; result = String::from(v),
        None =&gt; result = String::from(&quot;&lt;version undefined&gt;&quot;),
    };
    if let Some(v) = commit {
        result += &amp;format!(&quot; ({})&quot;, &amp;v);
    }
    result
}


pub fn cli&lt;'a, 'b&gt;() -&gt; App&lt;'a, 'b&gt; {
    let version = get_version_str();
    let version_ref: &amp;'b str = version.as_str();
    App::new(&quot;pretty-git-prompt&quot;)
        .version(version_ref)
</code></pre>
<h3>Output</h3>
<pre><code class="language-rust">error[E0495]: cannot infer an appropriate lifetime due to conflicting requirements
  --&gt; src/cli.rs:26:18
   |
26 |         .version(version_ref)
   |                  ^^^^^^^^^^^
   |
note: first, the lifetime cannot outlive the lifetime 'b as defined on the body at 20:36...
  --&gt; src/cli.rs:20:37
   |
20 |   pub fn cli&lt;'a, 'b&gt;() -&gt; App&lt;'a, 'b&gt; {
   |  _____________________________________^
21 | |     // FIXME: populate about with this
22 | |     // let ref def_conf_desc = format!(&quot;Create default config at \&quot;{}\&quot;.&quot;, get_default_config_path().to_str().unwrap());
23 | |     let version = get_version_str();
...  |
39 | |              .help(&quot;Print debug messages, useful for identifying issues.&quot;))
40 | | }
   | |_^
note: ...so that expression is assignable (expected &amp;str, found &amp;'b str)
  --&gt; src/cli.rs:26:18
   |
26 |         .version(version_ref)
   |                  ^^^^^^^^^^^
note: but, the lifetime must be valid for the lifetime 'a as defined on the body at 20:36...
  --&gt; src/cli.rs:20:37
   |
20 |   pub fn cli&lt;'a, 'b&gt;() -&gt; App&lt;'a, 'b&gt; {
   |  _____________________________________^
21 | |     // FIXME: populate about with this
22 | |     // let ref def_conf_desc = format!(&quot;Create default config at \&quot;{}\&quot;.&quot;, get_default_config_path().to_str().unwrap());
23 | |     let version = get_version_str();
...  |
39 | |              .help(&quot;Print debug messages, useful for identifying issues.&quot;))
40 | | }
   | |_^
note: ...so that expression is assignable (expected clap::App&lt;'a, 'b&gt;, found clap::App&lt;'_, '_&gt;)
  --&gt; src/cli.rs:25:5
   |
25 | /     App::new(&quot;pretty-zsh-prompt&quot;)
26 | |         .version(version_ref)
27 | |         .author(&quot;Tomas Tomecek &lt;tomas@tomecek.net&gt;&quot;)
28 | |         .about(&quot;Get `git status` inside your shell prompt.&quot;)
...  |
38 | |              .long(&quot;debug&quot;)
39 | |              .help(&quot;Print debug messages, useful for identifying issues.&quot;))
   | |___________________________________________________________________________^

error: aborting due to previous error

error: Could not compile `pretty-git-prompt`.
</code></pre>
<p>Can I get some help here please?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TomasTomecek">@TomasTomecek</a> on 2017-07-16 17:20</div>
            <div class="timeline-body"><p>I managed to figure this out by not meddling with lifetimes and have one single function which contains <code>App</code> instance and it's not passed anywhere else.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @TomasTomecek on 2017-07-16 17:20</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:32 UTC
    </footer>
</body>
</html>
