<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Using -? for help in addition to -h - clap-rs/clap #1127</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Using -? for help in addition to -h</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/1127">#1127</a>
        opened by <a href="https://github.com/kkayal">@kkayal</a>
        on 2017-12-12 10:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/kkayal">@kkayal</a> on 2017-12-12 10:45</div>
            <div class="timeline-body"><!--
Please use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`
-->

<h3>Rust Version</h3>
<p>rustc 1.22.1 (05e2e1c41 2017-11-22)</p>
<h3>Affected Version of clap</h3>
<p>2.28.0</p>
<h3>Expected Behavior Summary</h3>
<p>The -h option has a good built-in behaviour. It is desireable that -? would do exactly the same.</p>
<h3>Actual Behavior Summary</h3>
<p>-? is not recognised as a built-in option as -h. Calling the hello world example with <code>hello -?</code> produces an error message:</p>
<pre><code>error: Found argument '-?' which wasn't expected, or isn't valid in this context

USAGE:
    hello.exe [FLAGS] [OPTIONS] &lt;INPUT&gt; [SUBCOMMAND]

For more information try --help
error: process didn't exit successfully: `target\debug\hello.exe -?` (exit code: 1)
</code></pre>
<h3>Steps to Reproduce the issue</h3>
<p>Create a new minimal crate using the example code clap's own documentation, build the executable and run it with the -? option.</p>
<h3>Sample Code or Link to Sample Code</h3>
<p>https://docs.rs/clap/2.29.0/clap/index.html</p>
<h3>Debug output</h3>
<p>Not needed</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-01-09 17:06</div>
            <div class="timeline-body"><p>There's no reason you can't use <code>-?</code> as the help short, <a href="https://docs.rs/clap/2.29.0/clap/struct.App.html#method.help_short">by changing the default help short of <code>-h</code></a>. If you want to use <em>both</em> <code>-h</code> and <code>-?</code> <a href="https://docs.rs/clap/2.29.0/clap/struct.App.html#method.print_help">that's also possible manually</a>. However, I don't really want to add <code>-?</code> as a default alias to <code>-h</code> because there are people who use <code>-?</code> for other purposes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> added by @kbknapp on 2018-01-09 17:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kkayal">@kkayal</a> on 2018-01-11 13:08</div>
            <div class="timeline-body"><p>Thanks, but I was unable to add -? as a new option properly. Maybe I miss something else.
I took the quick example from documentation, replaced the argument &quot;config&quot; with the following:</p>
<pre><code>                      ...
                      .about(&quot;Does awesome things&quot;)
                      .arg(Arg::with_name(&quot;question_mark&quot;)
                           .short(&quot;?&quot;)
                           .help(&quot;Shows a short help message&quot;))
                      .arg(Arg::with_name(&quot;INPUT&quot;)
                      ...</code></pre>
<p>when I compile this as <code>foo.rs</code> and execute <code>foo -?</code> I get the following error message:</p>
<pre><code>error: The following required arguments were not provided:
    &lt;INPUT&gt;

USAGE:
    foo &lt;INPUT&gt; -?

For more information try --help
</code></pre>
<p>When I type <code>foo -h</code>, I get no errors, just the expected help message. So it seems the -h has higher priority than the mandatory <code>&lt;INPUT&gt;</code>, which is good, but is it possible to give -? the same privilege as the -h option?</p>
<p>Second question: Assuming the above can be solved, how would I connect the -? option with the print_help function?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-01-15 17:16</div>
            <div class="timeline-body"><p>Which shell are you using? In ZSH <code>?</code> is used to match a single character and thus you have to do <code>$ program -\?</code></p>
<p>For example on my machine:</p>
<pre><code class="language-rust">extern crate clap;

use clap::App;

fn main() {
    let matches = App::new(&quot;prog&quot;)
        .help_short(&quot;?&quot;)
        .get_matches();
}
</code></pre>
<p>Then:</p>
<pre><code>$ prog -\?
prog 

USAGE:
    prog

FLAGS:
    -?, --help       Prints help information
    -V, --version    Prints version information
</code></pre>
<p>It's the same if you simply want to add a flag which prints the help too (as in your example).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kkayal">@kkayal</a> on 2018-01-19 13:08</div>
            <div class="timeline-body"><p>Thanks, I just tried .help_short(&quot;?&quot;). It works as desired, but unfortunately, the -h option becomes an invalid one.</p>
<p>I have no experience with zsh. I use bash as well as the standard os-x and windows 7 terminals. My examples are tar and python. tar understands  -? and it doesn't even understand -h. Python supports both. That shows to me that -? or -h is just a preference of the developer. I would like to be able to support both.</p>
<p>In case a shell such as zsh gives the -? a special meaning, that is fair enough, but I am sure the ones that I use would not prevent me from using -? directly.</p>
<p>Actually, bash has the same special meaning for ? For example if I have a file called <code>abc</code> and then do <code>ls a?c</code> I get <code>abc</code> as expected. But this doesn't mean it has a special meaning for -? When I type <code>ls -?</code> it returns <code>invalid option</code>. In other words bash passes <code>-?</code> very well to ls. It is just ls, which doesn't understand the -? option.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-01-23 13:29</div>
            <div class="timeline-body"><p>If you want to use <em>both</em> <code>-h</code> and <code>-?</code></p>
<pre><code class="language-rust">extern crate clap;

use std::env;
use std::process;

use clap::{Arg, App};

fn main() {

	// We build the App instance and save it, so we can
	// use it later if needed
    let mut app = App::new(&quot;prog&quot;)
		.arg(Arg::with_name(&quot;help&quot;)
			.short(&quot;?&quot;)
			.help(&quot;Also prints the help message&quot;));

	// We call this method which will do all the
	//parsing, but not consume our App instance
	let res = app.get_matches_from_safe_borrow(env::args_os());

	// This calls all the normal clap error messages
	// if one should exist
	let matches = res.unwrap_or_else(|e| e.exit());

	// Now we check for ?
	if matches.is_present(&quot;help&quot;) {
		let _ = app.print_help();
                println!(&quot;&quot;); // adds a newline
		process::exit(0);
	}

	// Now we can use matches like normal...
}

</code></pre>
<pre><code>kevin@beefcake: ~/Projects/prog 
➜ ./target/debug/prog -h
prog 

USAGE:
    prog [FLAGS]

FLAGS:
    -h, --help       Prints help information
    -?               Also prints the help message
    -V, --version    Prints version information

kevin@beefcake: ~/Projects/fake 
➜ ./target/debug/prog -\?
prog 

USAGE:
    prog [FLAGS]

FLAGS:
    -h, --help       Prints help information
    -?               Also prints the help message
    -V, --version    Prints version information
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kkayal">@kkayal</a> on 2018-01-23 20:57</div>
            <div class="timeline-body"><p>Thanks! This is exactly what I was looking for.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kkayal on 2018-01-23 20:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../ProvableHQ/leo/pulls/565.html">ProvableHQ/leo#565</a> on 2021-01-22 11:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SUPERCILEX">@SUPERCILEX</a> on 2022-08-05 01:24</div>
            <div class="timeline-body"><p>@epage is there documentation on how to do this with modern clap (derive specifically)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-08-05 05:16</div>
            <div class="timeline-body"><p>As of clap v3, there are two ways of doing this</p>
<ol>
<li>Modify the existing help item</li>
</ol>
<pre><code class="language-rust">#[derive(Parser)]
#[clap(mut_arg(&quot;help&quot;, |arg| arg.short_alias('?')))]
struct Cli {
   ...
}
</code></pre>
<p>(You'd just as easily use <code>short_visible_alias</code> or <code>short</code>, depending on your need)</p>
<ol start="2">
<li>Supplying your own help item</li>
</ol>
<pre><code class="language-rust">#[derive(Parser)]
struct Cli {
    #[clap(short, long, short_alias = '?', action = ArgAction::Help, help = &quot;Print help information&quot;)]
    help: bool,
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SUPERCILEX">@SUPERCILEX</a> on 2022-08-05 23:53</div>
            <div class="timeline-body"><p>That's perfect, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SUPERCILEX">@SUPERCILEX</a> on 2022-09-30 03:20</div>
            <div class="timeline-body"><p>@epage How do you do this in v4?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-09-30 13:31</div>
            <div class="timeline-body"><pre><code class="language-rust">#[derive(Parser)]
#[command(disable_help_flag = true)]
struct Cli {
    #[arg(short, long, short_alias = '?', action = ArgAction::Help, help = &quot;Print help information&quot;)]
    help: bool,
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SUPERCILEX">@SUPERCILEX</a> on 2022-09-30 17:02</div>
            <div class="timeline-body"><p>Thanks! Needs <code>global = true</code> as well, but that seems to work.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SUPERCILEX">@SUPERCILEX</a> on 2022-09-30 19:39</div>
            <div class="timeline-body"><p>Also needs to be <code>Option&lt;bool&gt;</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fpagliughi">@fpagliughi</a> on 2022-12-07 20:21</div>
            <div class="timeline-body"><p>It would be awesome for this information to make it into the docs/tutorial/examples for both the Derive and Builder patterns. My company standardized on '-?' for help and '-v' for version. So I've spent the last few hours trying to figure how to upgrade all my clap 2.34 apps to v4.0.</p>
<p>I was pulling my hair out until I stumbled on this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-01-03 19:54</div>
            <div class="timeline-body"><p>Trying to think of the best way to integrate this into the docs</p>
<ul>
<li>This seems too specialized/advanced to be in the tutorial.</li>
<li>I'd prefer the examples not to be inundated with a small example for each person's topic of interest.  One way we solve this is by covering multiple topics under a reproduction of a real world program people are likely familiar with, like <code>git</code> or <code>pacman</code>.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/LeoniePhiline">@LeoniePhiline</a> on 2023-02-09 16:07</div>
            <div class="timeline-body"><blockquote>
<p>This seems too specialized/advanced to be in the tutorial.</p>
</blockquote>
<p>Maybe it's not actually that specialized.</p>
<p>Whenever someone creates an <code>#[arg(short, long)]</code> for a struct member starting with <code>h</code>, they will stumble upon this.</p>
<p>I suppose args starting with <code>h</code> are going to be quite common, and it took me far too long to figure out how to fix it in clap 4.</p>
<p><strong>A certainly common example:</strong> Args to connect to a database:</p>
<pre><code class="language-rust">use clap::{arg, Parser};

#[derive(Debug, Parser)]
#[command(author, version, about)]
pub struct Args {
    /// Database host
    #[arg(short, long)]
    pub host: String, // &lt;-- Will cause trouble

    /// Database port
    #[arg(short = 'P', long, default_value_t = 3306)]
    pub port: usize,

    /// Database user
    #[arg(short, long)]
    pub user: String,

    /// Database password. Pass &quot;-&quot; to read from stdin.
    #[arg(short, long)]
    pub password: String,

    /// Database name
    #[arg(short, long)]
    pub database: String,
}

</code></pre>
<p>In the end, I opted to go for <code>#[arg(short = 'H', long)]</code> on the host, but I wasted time trying to go with <code>-?/--help</code> or just <code>--help</code> for help.</p>
<p>This used to be easier, especially when using <code>clap_derive</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-02-09 16:27</div>
            <div class="timeline-body"><blockquote>
<p>Maybe it's not actually that specialized.</p>
</blockquote>
<p>For a tutorial, yes it is.  This is where we are showing people how to create an argument in the first place; we shouldn't be covering all the various special cases.  There are other places this might fit, like the cookbook, but its a problem of finding the right way  to include it so it is discoverable without contributing to the docs being overwhelming.  We could have a cookbook item just about this but its better when we can (1) have a concrete example we are mimicing (I want to do &quot;X&quot; like <code>git</code> does) and (2) when that concrete example is able to pull its weight by showing several things (e.g. <code>git</code>) or a complex interaction (e.g. the REPL example)</p>
<blockquote>
<p>Whenever someone creates an #[arg(short, long)] for a struct member starting with h, they will stumble upon this.</p>
</blockquote>
<p>While I am sympathetic to the struggles of figuring out how to do it, I feel like this use case is a good example for why I think the current behavior is important.  Besides anything else I get into below, making <code>-h</code> anything but help should be the exception case with a very deliberate decision.  The default behavior should be to steer people away from doing it so they fall into a pit of success for their UI design.  Granted, how they get there is a mountain of success because we can't automatically report this problem at compile time and have to wait until test-time at best and runtime at worst.</p>
<blockquote>
<p>This used to be easier, especially when using clap_derive.</p>
</blockquote>
<p>I assume you are referring to clap automatically disabling <code>-h</code> for help when the user uses it.  That came with its own implementation complexity which got pushed onto users as some unpredictable behavior and doubled the time it took for clap to run in the benchmark I used when releasing clap v4.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/fpagliughi">@fpagliughi</a> on 2023-02-10 15:29</div>
            <div class="timeline-body"><p>I hold to my initial request :smiley:</p>
<p>The behavior for this changed in recent versions, and for people upgrading that need to maintain backward compatibility for their apps, it can be a little frustrating how to do it with the new versions. The new way is certainly more flexible, so documenting it would also help explain the new power at hand.</p>
<p>If the vagueness of the existing docs are a subtle way to guide users to a default, uniform behavior, then keep in mind the huge number of different areas this library may be used in. I use this a lot for networking and MQTT utilities, and in that space, <code>-h &lt;hostname&gt;</code> is universally used to indicate the network host name of the server/broker.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:07 UTC
    </footer>
</body>
</html>
