```yaml
number: 5471
title: "Hidden subcommands shown when \"requires a subcommand but one was not provided\""
type: issue
state: open
author: devjgm
labels:
  - C-bug
  - S-waiting-on-decision
  - A-help
assignees: []
created_at: 2024-04-22T21:22:02Z
updated_at: 2024-04-23T20:34:40Z
url: https://github.com/clap-rs/clap/issues/5471
synced_at: 2026-01-10T01:57:49Z
```

# Hidden subcommands shown when "requires a subcommand but one was not provided"

---

_Issue opened by @devjgm on 2024-04-22 21:22_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Rust Version

rustc 1.74.0 (79e9716c9 2023-11-13)

### Clap Version

4.5.4

### Minimal reproducible code

```rust
use clap::{Parser, Subcommand};

#[derive(Parser, Debug)]
#[clap(version, about)]
struct Cli {
    #[clap(subcommand)]
    command: Command,

    #[clap(long)]
    message: String,
}

#[derive(Subcommand, Debug)]
enum Command {
    Hello,
    #[clap(hide = true)]
    Secret,  // <------ This subcommand is marked hidden and shouldn't be suggested to the user
}

fn main() {
    let cli = Cli::parse();
    match cli.command {
        Command::Hello => println!("Hello {}", cli.message),
        Command::Secret => println!("Secret {}", cli.message),
    }
}
```


### Steps to reproduce the bug with the above code

```console
$ cargo run -- --message foo
    Finished dev [unoptimized + debuginfo] target(s) in 0.03s
     Running `target/debug/clap-repro --message foo`
error: 'clap-repro' requires a subcommand but one was not provided
  [subcommands: hello, secret, help]

Usage: clap-repro --message <MESSAGE> <COMMAND>

For more information, try '--help'.
```





### Actual Behaviour

The problem is that the `secret` subcommand is marked as hidden, yet it is suggested as one of the possible subcommands in the list `[subcommands: hello, secret, help]`

### Expected Behaviour

Since the `secret` subcommand is marked as hidden, it should not be suggested to the user in the list of possible subcommands. So
Actual: `[subcommands: hello, secret, help]`
Expected: `[subcommands: hello, help]`

### Additional Context

The `--message` flag in the repro case seems to be important. If I remove it and omit the subcommand, it sees that _no_ arguments are provided and simply displays the normal help message, which correctly omits the hidden subcommand.

### Debug Output

_No response_

---

_Label `C-bug` added by @devjgm on 2024-04-22 21:22_

---

_Label `A-help` added by @epage on 2024-04-23 20:33_

---

_Label `S-waiting-on-decision` added by @epage on 2024-04-23 20:34_

---

_Comment by @epage on 2024-04-23 20:34_

FYI #4853 is a different place hidden subcommands can show up in errors

---
