<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arguments with takes_value(false) still accept &quot;compact&quot;-style arguments - clap-rs/clap #1543</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Arguments with takes_value(false) still accept &quot;compact&quot;-style arguments</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/1543">#1543</a>
        opened by <a href="https://github.com/sfackler">@sfackler</a>
        on 2019-09-04 20:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/sfackler">@sfackler</a> on 2019-09-04 20:57</div>
            <div class="timeline-body"><h1>Rust Version</h1>
<ul>
<li>1.37.0</li>
</ul>
<h3>Affected Version of clap</h3>
<ul>
<li>2.33.0</li>
</ul>
<h3>Bug or Feature Request Summary</h3>
<p>Arguments configured to not take a value still successfully parse from the <code>--key=value</code> form.</p>
<h3>Expected Behavior Summary</h3>
<p>The command line should fail to validate (or only accept <code>--key=true</code> or <code>--key=false</code>.</p>
<h3>Actual Behavior Summary</h3>
<p>The command line successfully validates as if it just contained <code>--key</code>.</p>
<h3>Sample Code or Link to Sample Code</h3>
<pre><code class="language-rust">use clap::*;

fn main() {
    let matches = App::new(&quot;foo&quot;)
        .arg(Arg::with_name(&quot;foobar&quot;).long(&quot;foobar&quot;).takes_value(false).multiple(false))
        .get_matches_from([&quot;foo&quot;, &quot;--foobar=false&quot;].iter());
    println!(&quot;{:?}&quot;, matches)
}
</code></pre>
<p>https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=d08679674fa982b892dcc26d8ed8bb25</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: options</span> added by @CreepySkeleton on 2020-02-01 12:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> added by @CreepySkeleton on 2020-02-01 12:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @CreepySkeleton on 2020-02-01 12:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @CreepySkeleton on 2020-02-01 12:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @CreepySkeleton on 2020-02-01 12:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.0" by @pksunkara on 2020-04-09 08:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @pksunkara on 2020-04-09 08:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../sharkdp/hexyl/issues/109.html">sharkdp/hexyl#109</a> on 2020-10-24 18:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> removed by @pksunkara on 2020-10-26 07:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../sharkdp/fd/issues/727.html">sharkdp/fd#727</a> on 2021-02-13 21:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2484.html">clap-rs/clap#2484</a> on 2021-05-18 01:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2646.html">clap-rs/clap#2646</a> on 2021-07-30 19:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2619.html">clap-rs/clap#2619</a> on 2021-07-30 20:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @pksunkara on 2021-08-01 11:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/haxpor">@haxpor</a> on 2022-03-21 11:18</div>
            <div class="timeline-body"><p>Can we reopen this issue? I tested this from the tip of the git tree and the problem is still happening, also I faced the same issue on my own code using <code>3.1.6</code>.</p>
<p>Modify <code>tests/builder/multiple_occurrences.rs</code> (just for the sake of quick dirty test)</p>
<pre><code class="language-rust">#[cfg(feature = &quot;env&quot;)]
#[test]
fn multiple_occurrences_of_before_env() {
    let cmd = Command::new(&quot;mo_before_env&quot;).arg(
        Arg::new(&quot;verbose&quot;)
            .env(&quot;VERBOSE&quot;)
            .short('v')
            .long(&quot;verbose&quot;)
            .takes_value(false)
            .multiple_occurrences(true),
    );

    let m = cmd.clone().try_get_matches_from(vec![&quot;&quot;]);
    assert!(m.is_ok(), &quot;{}&quot;, m.unwrap_err());
    assert_eq!(m.unwrap().occurrences_of(&quot;verbose&quot;), 0);

    let m = cmd.clone().try_get_matches_from(vec![&quot;&quot;, &quot;-v&quot;]);
    assert!(m.is_ok(), &quot;{}&quot;, m.unwrap_err());
    assert_eq!(m.unwrap().occurrences_of(&quot;verbose&quot;), 1);

    let m = cmd.clone().try_get_matches_from(vec![&quot;&quot;, &quot;-vv&quot;]);
    assert!(m.is_ok(), &quot;{}&quot;, m.unwrap_err());
    assert_eq!(m.unwrap().occurrences_of(&quot;verbose&quot;), 2);
    let m = cmd.clone().try_get_matches_from(vec![&quot;&quot;, &quot;-vvv&quot;]);
    assert!(m.is_ok(), &quot;{}&quot;, m.unwrap_err());
    assert_eq!(m.unwrap().occurrences_of(&quot;verbose&quot;), 3);

    // this chunk of code is added to test
    // notice `-vvv=false`, test result is fine, no error out
    let m = cmd.clone().try_get_matches_from(vec![&quot;&quot;, &quot;-vvv=false&quot;]);
    assert!(m.is_ok(), &quot;{}&quot;, m.unwrap_err());
    assert_eq!(m.unwrap().occurrences_of(&quot;verbose&quot;), 3);
}
</code></pre>
<p>as well I didn't see relevant changes that fix this issue in #2619.
My apology if I'm wrong nor missing something.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-03-21 16:34</div>
            <div class="timeline-body"><p>I just tried reproducing with the code sample you gave and it failed</p>
<pre><code>thread 'multiple_occurrences::multiple_occurrences_of_before_env' panicked at 'error: Found argument '-=' which wasn't expected, or isn't valid in this context

        If you tried to supply `-=` as a value rather than a flag, use `-- -=`

USAGE:
    mo_before_env [OPTIONS]

For more information try --help
', tests/builder/multiple_occurrences.rs:128:5
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../solana-labs/solana-program-library/issues/4511.html">solana-labs/solana-program-library#4511</a> on 2023-06-08 23:26</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:32 UTC
    </footer>
</body>
</html>
