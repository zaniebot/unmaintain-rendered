```yaml
number: 5828
title: "next_help_heading doesn't seem to work with subcommands"
type: issue
state: closed
author: nwalfield
labels:
  - C-bug
assignees: []
created_at: 2024-11-26T14:12:30Z
updated_at: 2024-11-26T16:57:25Z
url: https://github.com/clap-rs/clap/issues/5828
synced_at: 2026-01-10T01:57:49Z
```

# next_help_heading doesn't seem to work with subcommands

---

_Issue opened by @nwalfield on 2024-11-26 14:12_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Rust Version

rustc 1.82.0 (f6e511eec 2024-10-15)

### Clap Version

4.5.21

### Minimal reproducible code

```rust
use clap::CommandFactory;
use clap::Parser;
use clap::Subcommand;

#[derive(Parser)]
struct Cli {
    #[clap(subcommand)]
    pub subcommand: Subcommands,
}

#[derive(Debug, Subcommand)]
pub enum Subcommands {
    #[clap(next_help_heading = "foo")]
    A(ACommand),
    #[clap(next_help_heading = "bar")]
    B(BCommand),
}

#[derive(Parser, Debug)]
#[clap(
    name = "a",
    about = "a it",
)]
pub struct ACommand {
}

#[derive(Parser, Debug)]
#[clap(
    name = "b",
    about = "b it",
)]
pub struct BCommand {
}

fn main() {
    let cli = Cli::command();
    cli.get_matches();
}
```


### Steps to reproduce the bug with the above code

```
$ cargo run -- --help
   Compiling clap-issue v0.1.0 (/tmp/clap-issue)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.17s
     Running `target/debug/clap-issue --help`
Usage: clap-issue <COMMAND>

Commands:
  a     a it
  b     b it
  help  Print this message or the help of the given subcommand(s)

Options:
  -h, --help  Print help
```

### Actual Behaviour

The `a` and `b` commands are under the `Commands` header.

### Expected Behaviour

The `a` command should under the `foo` header and the `b` command should be under the `bar` header.

### Additional Context

In `sq`, we have some subcommands with a mix of commands and subcommands, e.g.,

```
$ sq key -h
Manage keys

Usage: sq key <COMMAND>

Commands:
  list       List keys managed by the key store
  generate   Generate a new key
  import     Import keys into the key store
  export     Export keys from the key store
  delete     Delete a certificate's secret key material
  password   Change the password protecting secret key material
  expire     Change a certificate's expiration time
  revoke     Revoke a certificate
  userid     Manage User IDs
  subkey     Manage subkeys
  approvals  Manages certification approvals

Options:
  -h, --help  Print help (see more with '--help')
```

We want to have multiple headers to make it easier for the user to find what they are looking for.  Like this:

```
$ sq key -h
Manage keys

Usage: sq key <COMMAND>

Commands:
  list       List keys managed by the key store
  generate   Generate a new key
  import     Import keys into the key store
  export     Export keys from the key store
  delete     Delete a certificate's secret key material
  password   Change the password protecting secret key material
  expire     Change a certificate's expiration time
  revoke     Revoke a certificate

Command Groups:
  userid     Manage User IDs
  subkey     Manage subkeys
  approvals  Manages certification approvals

Options:
  -h, --help  Print help (see more with '--help')
```

https://docs.rs/clap/latest/clap/_derive/index.html seems to suggest that this should work for subcommands, but it doesn't seem to.

I apologize if this isn't a bug, and I'm only holding it wrong.

### Debug Output

_No response_

---

_Label `C-bug` added by @nwalfield on 2024-11-26 14:12_

---

_Comment by @epage on 2024-11-26 16:57_

This looks to be a duplicate of #1553 and closing in favor of that.  If there is something I missed, let us know!

---

_Closed by @epage on 2024-11-26 16:57_

---
