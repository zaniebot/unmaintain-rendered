<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unexpected interaction between .default_value() and .required_unless_one() - clap-rs/clap #1229</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Unexpected interaction between .default_value() and .required_unless_one()</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1229">#1229</a>
        opened by <a href="https://github.com/longborough">@longborough</a>
        on 2018-03-23 16:25
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/longborough">@longborough</a></div>
            <div class="timeline-body"><p>Hi. Thank you for clap. I&#x27;m a complete Rust newbie, and struggling; clap made things a lot easier and I appreciate it!</p>
Rust Version
<ul>
<li>rustc 1.26.0-nightly (a04b88d19 2018-03-19)</li>
</ul>
Affected Version of clap
<ul>
<li>name = &quot;clap&quot;</li>
<li>version = &quot;2.31.2&quot;</li>
</ul>
Expected Behavior Summary
<p>When a default_value is provided for an Arg and the Arg is required unless another Arg is present, then I think the absence of both should be signalled as  the message:</p>
<p>error: The following required arguments were not provided</p>
Actual Behavior Summary
<p>Currently, if an Arg has a default_value, the required_unless_one() option is ignored, and the default value always provided.</p>
<p>The behaviour also occurs when the multiple_values flag is set.</p>
Steps to Reproduce the issue
<p>Run the code below with no command line parameters. I would expect it to fail, not provide the default.</p>
Sample Code or Link to Sample Code
<pre><code>extern crate clap ;
use self::clap::{Arg, App} ;
fn main() {
    let matches = App::new(&quot;mwe&quot;)
        .version(&quot;0.0.1&quot;)
        .arg(Arg::with_name(&quot;reverse&quot;)
             .short(&quot;r&quot;)
             .takes_value(false))
        .arg(Arg::with_name(&quot;list&quot;)
             .takes_value(true)
             .default_value(&quot;Breakfast&quot;)
             .required_unless_one(&amp;[&quot;reverse&quot;,]))
        .get_matches() ;
    println!(&quot;{:?}&quot;,matches)
}
</code></pre>
Debug output (lines split to prettify)
<pre><code>D:\Development\Rust\mwe&gt;target\debug\mwe
ArgMatches { args: {&quot;list&quot;: MatchedArg { occurs: 0, indices: [1], vals: [&quot;Breakfast&quot;] }}, 
subcommand: None, 
usage: Some(&quot;USAGE:\n    mwe [FLAGS] &lt;list&gt;...&quot;) }

D:\Development\Rust\mwe&gt;target\debug\mwe -r
ArgMatches { args: {&quot;list&quot;: MatchedArg { occurs: 0, indices: [2], vals: [&quot;Breakfast&quot;] }, 
&quot;reverse&quot;: MatchedArg { occurs: 1, indices: [1], vals: [] }}, 
subcommand: None, 
usage: Some(&quot;USAGE:\n    mwe [FLAGS] &lt;list&gt;...&quot;) }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/longborough">@longborough</a> on 2018-03-23 16:34</div>
            <div class="timeline-body"><p>I&#x27;m so sorry. I&#x27;ve just seen the .default_value_if construct. I&#x27;ve closed this issue for now; if need be, I may open it again.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/longborough">@longborough</a> on 2018-03-23 16:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-03-23 17:13</div>
            <div class="timeline-body"><p>No problems! Feel free to re-open if you need to.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:57:08 UTC
    </footer>
</body>
</html>
