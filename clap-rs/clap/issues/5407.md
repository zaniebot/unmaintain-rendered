```yaml
number: 5407
title: "Cannot use non-literal expressions for `name` attribute"
type: issue
state: closed
author: mwu-tow
labels:
  - C-bug
assignees: []
created_at: 2024-03-20T23:53:49Z
updated_at: 2024-03-25T21:07:16Z
url: https://github.com/clap-rs/clap/issues/5407
synced_at: 2026-01-10T01:57:49Z
```

# Cannot use non-literal expressions for `name` attribute

---

_Issue opened by @mwu-tow on 2024-03-20 23:53_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Rust Version

rustc 1.76.0 (07dca489a 2024-02-04)

### Clap Version

4.5.3

### Minimal reproducible code

```rust
use clap::Parser;

pub trait HasName {
    const NAME: &'static str;
}

pub struct Foo;

impl HasName for Foo {
    const NAME: &'static str = "foo";
}

/// Simple program to greet a person
#[derive(Parser, Debug)]
struct Args<T: HasName> {
    /// Name of the person to greet
    #[clap(name = T::NAME, short, long)]
    name: String,

    #[clap(skip)]
    phantom: std::marker::PhantomData<T>,
}

fn main() {
    Args::<Foo>::parse();
}
```

### Steps to reproduce the bug with the above code

`cargo build`

### Actual Behaviour

Build error:
```
error: expected a literal
  --> src\main.rs:17:19
   |
17 |     #[clap(name = T::NAME, short, long)]
   |                   ^^^^^^^
   |
   = note: only literals (like `"foo"`, `-42` and `3.14`) can be passed to `concat!()`
```

### Expected Behaviour

This code worked in clap `3.2.25` and was not documented as a change, so I think it still should work.

Also, [the documentation](https://docs.rs/clap/4.5.2/clap/_derive/index.html#command-attributes) says that the `name` attribute argument is an expression, so I would expect it to work. Especially since there is no restriction on the [Command::name](https://docs.rs/clap/4.5.2/clap/struct.Command.html#method.name) API. I don't think there are similar restrictions on other attributes.

### Additional Context

This blocks me from migrating to clap v4. I relied on this pattern to reuse the same structure definition, while avoiding the name collisions.

### Debug Output

_No response_

---

_Label `C-bug` added by @mwu-tow on 2024-03-20 23:53_

---

_Referenced in [enso-org/enso#9517](../../enso-org/enso/pulls/9517.md) on 2024-03-22 15:31_

---

_Comment by @epage on 2024-03-25 19:30_

This was broken in #4947.  Looking to see if we can better detect when to use one or the other.

---

_Referenced in [clap-rs/clap#5425](../../clap-rs/clap/pulls/5425.md) on 2024-03-25 19:42_

---

_Closed by @epage on 2024-03-25 21:07_

---

_Referenced in [enso-org/enso#9595](../../enso-org/enso/pulls/9595.md) on 2024-04-02 11:35_

---
