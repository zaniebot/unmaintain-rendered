<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deprecate cargo macros - clap-rs/clap #2840</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Deprecate cargo macros</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/clap-rs/clap/issues/2840">#2840</a>
        opened by <a href="https://github.com/kbknapp">@kbknapp</a>
        on 2021-10-09 17:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/kbknapp">@kbknapp</a> on 2021-10-09 17:32</div>
            <div class="timeline-body"><p>Maintainer's notes</p>
<p>Path forward</p>
<ol>
<li>Create a crate with these, and other related cargo env variables</li>
<li>Port clap over to this crate</li>
<li>Deprecate the <code>crate_*</code> macros, pointing people to that crate</li>
</ol>
<hr />
<h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
<h3>Clap Version</h3>
<p>3.0.0-beta.4</p>
<h3>Describe your use case</h3>
<p>I'm proposing removing the convenience macros for getting information from <code>cargo</code> at build time. Specifically:</p>
<ul>
<li><code>crate_license</code></li>
<li><code>crate_version</code></li>
<li><code>crate_authors</code></li>
<li><code>crate_description</code></li>
<li><code>crate_name</code></li>
</ul>
<p>None of these utilize anything inside of <code>clap</code> and simply call out to checking environment variables that <code>cargo</code> populates at compile time.</p>
<h3>Describe the solution you'd like</h3>
<p>These would be prime candidates for spinning off into a crate dedicated to such information about Cargo. I'd actually be kind of surprised if a crate with this functionality doesn't already exist. If one doesn't exist, I'm not against hosting one inside the clap-rs org, but being that it's not actually clap related this repository is probably a bad fit.</p>
<p>I propose we deprecate for v3, and remove for v4. That gives us time to either find a crate to suggest or pull these macros into one ourselves.</p>
<h3>Alternatives, if applicable</h3>
<ul>
<li>We keep these macros unchanged as they're small and self contained</li>
</ul>
<h3>Additional Context</h3>
<p>I'm open to suggestions and thoughts on the matter.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> added by @kbknapp on 2021-10-09 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E: breaking change</span> added by @kbknapp on 2021-10-09 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @kbknapp on 2021-10-09 17:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-10-09 18:02</div>
            <div class="timeline-body"><p>I would agree but we use them in <code>app_from_crate!</code> and as far as I understand from looking at people creating issues about this part of the code these are really widely used for most the non-popular clis.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2021-10-09 18:55</div>
            <div class="timeline-body"><p><code>app_from_crate!</code> could use whatever crate these would get spun off into so I'm not too concerned from that angle.</p>
<p>I'm more worried that because these aren't clap related, what if people want more cargo metadata exposed? These started as just <code>crate_version!</code> but have since grown to a few more. Sure they're not big or complex, but I think they'd fit better into a crate dedicated to that functionality.</p>
<p>I also agree they're pretty widely used which I think adds support to us taking it slow <em>if</em> we move forward (deprecate for a while, remove in a future major release), and also adds support to us creating the crate in our org with an identical API to make the transition painless.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Remove / Deprecate cargo macros" to "Deprecate cargo macros" by @pksunkara on 2021-10-09 19:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> removed by @pksunkara on 2021-10-09 19:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E: breaking change</span> removed by @pksunkara on 2021-10-09 19:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: other</span> added by @pksunkara on 2021-10-09 19:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-10-09 19:15</div>
            <div class="timeline-body"><p>I can understand the desire to spin things off.  I've wanted <code>arg_enum!</code> in non-clap settings.</p>
<p>I agree that the right route forward is a crate we delegate to but still provide a convenience for clap users.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-10-09 19:15</div>
            <div class="timeline-body"><p>Since a deprecation is not a breaking change, should we move this out of the 3.0 milestone?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-10-09 19:25</div>
            <div class="timeline-body"><p>It is in 3.0 milestone similar to #2835 because we need to add deprecation warnings.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-10-09 19:29</div>
            <div class="timeline-body"><p>We should not be deprecating anything without having a replacement to point people towards.  Unless we are creating the crate now, we shouldn't do this.</p>
<p>With #2835, we have replacements (builder, derive, from usage) that we can point people to as the recommended approach.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2021-10-10 01:08</div>
            <div class="timeline-body"><blockquote>
<p>Since a deprecation is not a breaking change, should we move this out of the 3.0 milestone?</p>
</blockquote>
<p>Good point. My point was just to deprecate for 3.0 like @pksunkara mentioned, but you're correct we could deprecate anywhere in the 3.x lifetime. I'll place this at the 3.1 milestone as a placeholder for &quot;decide on this sometime in 3.x&quot;</p>
<p>And of course we're not locked into spinning these out, I'm open to suggestions and opinions on the matter too.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.0" by @kbknapp on 2021-10-10 01:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @kbknapp on 2021-10-10 01:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/joshtriplett">@joshtriplett</a> on 2021-10-11 09:29</div>
            <div class="timeline-body"><p>I think it'd be perfectly reasonable to just make these non-public before 3.0, as long as the top-level app_from_crate macro still exists.</p>
<p>I don't think we have to provide a replacement first. These macros just existed to pass to the appropriate clap functions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-10-11 14:05</div>
            <div class="timeline-body"><blockquote>
<p>I think it'd be perfectly reasonable to just make these non-public before 3.0, as long as the top-level app_from_crate macro still exists.</p>
</blockquote>
<p>For context, I'm recommending in https://github.com/clap-rs/clap/issues/2617 that we provide built-in transition paths for users via deprecations to streamline the upgrade process.  We can do breaking changes but ideally we have a deprecation windows first</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-10-11 14:10</div>
            <div class="timeline-body"><blockquote>
<p>I think it'd be perfectly reasonable to just make these non-public before 3.0, as long as the top-level app_from_crate macro still exists.</p>
</blockquote>
<p>IIRC, people actually use those underlying macros directly instead of <code>app_from_crate!</code> and created some issues around them.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/213.html">epage/clapng#213</a> on 2021-12-06 22:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: other</span> removed by @epage on 2021-12-08 20:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-builder</span> added by @epage on 2021-12-08 20:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @epage on 2021-12-13 21:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-easy</span> added by @epage on 2021-12-13 21:23</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-02-02 19:48</div>
            <div class="timeline-body"><p>Random notes:</p>
<ul>
<li>I recommend the <code>crate-ci</code> org for this</li>
<li>We should cross-link with <a href="https://github.com/ALinuxPerson/build_script">build_script</a> and <a href="https://crates.io/crates/shadow-rs">shadow</a> for other cargo related APIs</li>
<li><code>build-env</code> and <code>cargo-env</code> names are taken.  The next best I can think of is <code>pkg-env</code>.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../baoyachi/shadow-rs/issues/69.html">baoyachi/shadow-rs#69</a> on 2022-02-22 02:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.x" by @epage on 2022-06-08 16:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "4.x" by @epage on 2022-06-08 16:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4514.html">clap-rs/clap#4514</a> on 2022-11-27 16:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:34:39 UTC
    </footer>
</body>
</html>
