<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bash completion filename is different then others - clap-rs/clap #2550</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>bash completion filename is different then others</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/2550">#2550</a>
        opened by <a href="https://github.com/XyLyXyRR">@XyLyXyRR</a>
        on 2021-06-18 04:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/XyLyXyRR">@XyLyXyRR</a></div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.52.1 (9bc8c42bb 2021-05-09)</p>
<h3>Clap Version</h3>
<p>3.0.0-beta.2</p>
<h3>Minimal reproducible code</h3>
<p><code>build.rs</code></p>
<pre><code class="language-rust">use clap::{Clap, IntoApp};
use clap_generate::{generate_to, generators::*};
use std::env;

#[derive(Clap)]
#[clap(bin_name=env!(&quot;CARGO_PKG_NAME&quot;))]
struct Cli {}

fn main() {
    let mut app = Cli::into_app();
    let bin_name = &amp;env::var(&quot;CARGO_PKG_NAME&quot;)
        .unwrap()
        .strip_suffix(&quot;-bin&quot;)
        .map(|x| x.to_string())
        .expect(&quot;strip '-bin' failed&quot;);
    let out_dir = &quot;target/completions&quot;;
    std::fs::create_dir_all(out_dir).unwrap();

    generate_to::&lt;Bash, _, _&gt;(&amp;mut app, bin_name, out_dir.clone());
    generate_to::&lt;Elvish, _, _&gt;(&amp;mut app, bin_name, out_dir.clone());
    generate_to::&lt;Fish, _, _&gt;(&amp;mut app, bin_name, out_dir.clone());
    generate_to::&lt;PowerShell, _, _&gt;(&amp;mut app, bin_name, out_dir.clone());
    generate_to::&lt;Zsh, _, _&gt;(&amp;mut app, bin_name, out_dir);
}
</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<ul>
<li><code>cargo build</code></li>
</ul>
<h3>Actual Behaviour</h3>
<p><code>ls target/completions -1</code>:</p>
<pre><code>_one
_one.ps1
one-bin.bash
one.elv
one.fish
</code></pre>
<h3>Expected Behaviour</h3>
<p><code>ls target/completions -1</code>:</p>
<pre><code>_one
_one.ps1
one.bash
one.elv
one.fish
</code></pre>
<h3>Additional Context</h3>
<p><em>No response</em></p>
<h3>Debug Output</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @XyLyXyRR on 2021-06-18 04:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @pksunkara on 2021-07-07 02:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: generator</span> added by @pksunkara on 2021-07-07 02:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-07-07 02:23</div>
            <div class="timeline-body"><p>Are there any conventions regarding these filenames? How does other tools name them?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/XyLyXyRR">@XyLyXyRR</a> on 2021-07-07 06:18</div>
            <div class="timeline-body"><p>I don't know.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-07-21 20:29</div>
            <div class="timeline-body"><p>I default to ripgrep as my guide since its had a lot of eyes.  Its behavior is what is expected in this Issue.</p>
<p>See https://github.com/BurntSushi/ripgrep/blob/master/.github/workflows/release.yml#L161</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-07-21 20:37</div>
            <div class="timeline-body"><p>I tried to reproduce this but couldn't</p>
<p><code>Cargo.toml</code>:</p>
<pre><code class="language-toml">[package]
name = &quot;foo-bin&quot;
version = &quot;0.1.0&quot;
edition = &quot;2018&quot;

# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html

[dependencies]
clap = { path = &quot;../clap&quot; }
clap_generate = { path = &quot;../clap/clap_generate&quot; }
</code></pre>
<p><code>src/main.rs</code>:</p>
<pre><code class="language-rust">use clap::{Clap, IntoApp};
use clap_generate::{generate_to, generators::*};
use std::env;

#[derive(Clap)]
#[clap(bin_name=env!(&quot;CARGO_PKG_NAME&quot;))]
struct Cli {}

fn main() {
    let mut app = Cli::into_app();
    let bin_name = &amp;env::var(&quot;CARGO_PKG_NAME&quot;)
        .unwrap()
        .strip_suffix(&quot;-bin&quot;)
        .map(|x| x.to_string())
        .expect(&quot;strip '-bin' failed&quot;);
    let out_dir = &quot;target/completions&quot;;
    std::fs::create_dir_all(out_dir).unwrap();

    generate_to::&lt;Bash, _, _&gt;(&amp;mut app, bin_name, out_dir.clone());
    generate_to::&lt;Elvish, _, _&gt;(&amp;mut app, bin_name, out_dir.clone());
    generate_to::&lt;Fish, _, _&gt;(&amp;mut app, bin_name, out_dir.clone());
    generate_to::&lt;PowerShell, _, _&gt;(&amp;mut app, bin_name, out_dir.clone());
    generate_to::&lt;Zsh, _, _&gt;(&amp;mut app, bin_name, out_dir);
}
</code></pre>
<p>Commands:</p>
<pre><code class="language-bash">$ cargo run
$ ls target/completions/ -1
_foo
_foo.ps1
foo.bash
foo.elv
foo.fish
</code></pre>
<p>I also tried switching my <code>main.rs</code> to a <code>build.rs</code> and got the same</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/XyLyXyRR">@XyLyXyRR</a> on 2021-07-21 23:21</div>
            <div class="timeline-body"><p>This is already fixed in master,  although I didn't find that fixed commit.</p>
<p>Use the version on crates.io will reproduce.</p>
<pre><code class="language-Cargo.toml">[build-dependencies]
# clap = { path = &quot;./clap&quot; }
# clap_generate = { path = &quot;./clap/clap_generate&quot; }
clap = &quot;3.0.0-beta.2&quot;
clap_generate = &quot;3.0.0-beta.2&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @XyLyXyRR on 2021-07-21 23:31</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:47:57 UTC
    </footer>
</body>
</html>
