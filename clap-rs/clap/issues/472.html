<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Help message prints argument name twice if no value name was given - clap-rs/clap #472</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Help message prints argument name twice if no value name was given</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/472">#472</a>
        opened by <a href="https://github.com/klingtnet">@klingtnet</a>
        on 2016-04-01 11:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/klingtnet">@klingtnet</a></div>
            <div class="timeline-body"><p>Argument names are printed as values in the help message if no <code>value_name</code> of <code>value_names</code> was given for the CLI argument. The problem is located in <a href="https://github.com/kbknapp/clap-rs/blob/master/src/args/help_writer.rs#L117"><code>src/args/help_writer.rs</code> line 117</a>. I tried to replace the line with: <code>try!(write!(w, &quot;&lt;{}&gt;&quot;, self.a.name()));</code> but this breaks some other tests.
If no <code>value_name</code> was set the <code>long</code> or <code>short</code> argument name is printed twice before the arguments value.</p>
<pre><code>extern crate clap;

fn main() {
    let addr = clap::Arg::with_name(&quot;address&quot;)
                   .long(&quot;address&quot;)
                   .short(&quot;a&quot;)
                   .takes_value(true)
                   .default_value(&quot;0.0.0.0&quot;)
                   .group(&quot;osc&quot;)
                   .help(&quot;Address to listen on for OSC messages.&quot;);
    let sr = clap::Arg::with_name(&quot;sample-rate&quot;)
                 .long(&quot;sample-rate&quot;)
                 .short(&quot;s&quot;)
                 .takes_value(true)
                 .default_value(&quot;48000&quot;)
                 .possible_values(&amp;[&quot;44100&quot;, &quot;48000&quot;, &quot;88200&quot;, &quot;96000&quot;])
                 .help(&quot;Playback sample-rate&quot;);
    let ports = clap::Arg::with_name(&quot;ports&quot;)
                    .long(&quot;ports&quot;)
                    .short(&quot;p&quot;)
                    .required(true)
                    .takes_value(true)
                    .number_of_values(2)
                    .value_names(&amp;[&quot;in&quot;, &quot;out&quot;])
                    .group(&quot;osc&quot;)
                    .help(&quot;OSC listening and send port.&quot;);
    let args = clap::App::new(&quot;ytterbium&quot;)
                   .version(&quot;0.1.0&quot;)
                   .author(&quot;Andreas Linz &lt;klingt.net@gmail.com&gt;&quot;)
                   .arg(addr)
                   .arg(ports)
                   .arg(sr);
    let mut buf: Vec&lt;u8&gt; = Vec::with_capacity(128);
    let mut out = ::std::io::stdout();
    args.write_help(&amp;mut out);
}
</code></pre>
<p>This prints the following <em>help</em> message:</p>
<pre><code>ytterbium 0.1.0
Andreas Linz &lt;klingt.net@gmail.com&gt;

USAGE:
    ytterbium [FLAGS] [OPTIONS] --ports &lt;in&gt; &lt;out&gt;

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

OPTIONS:
    -a, --address --address &lt;address&gt;            Address to listen on for OSC messages. [default: 0.0.0.0] 
    -p, --ports &lt;in&gt; &lt;out&gt;             OSC listening and send port.
    -s, --sample-rate --sample-rate &lt;sample-rate&gt;    Playback sample-rate [default: 48000]  [values: 44100, 48000, 88200, 96000]
</code></pre>
<p>If you look at the <code>OPTIONS</code> you can see that <code>--address</code> is printed twice as well as <code>--sample-rate</code>.
Adding <code>value_name</code>s fixes the problem:</p>
<pre><code>    let addr = clap::Arg::with_name(&quot;address&quot;)
// ...
                   .takes_value(true)
                   .value_name(&quot;ip-address&quot;)
// ...
    let sr = clap::Arg::with_name(&quot;sample-rate&quot;)
// ...
                 .takes_value(true)
                 .value_name(&quot;sample-rate&quot;)
// ...
</code></pre>
<pre><code>...
OPTIONS:
    -a, --address &lt;ip-address&gt;         Address to listen on for OSC messages. [default: 0.0.0.0] 
    -p, --ports &lt;in&gt; &lt;out&gt;             OSC listening and send port.
    -s, --sample-rate &lt;sample-rate&gt;    Playback sample-rate [default: 48000]  [values: 44100, 48000, 88200, 96000]
</code></pre>
<p>If this is intended behavior then please add a note in the documentation that setting <code>value_name</code>s is mandatory for arguments that <code>takes_value</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-04-03 04:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P1: urgent</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-04-03 04:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: args</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-04-03 04:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: help message</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-04-03 04:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-04-03 04:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-04-03 04:15</div>
            <div class="timeline-body"><p>This is a bug, thanks for pointing it out! I&#x27;ll get it fixed real quick and put out the updated version. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-04-03 04:52</div>
            <div class="timeline-body"><p>Once #474 merges I&#x27;ll put out the new version on crates.io</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/klingtnet">@klingtnet</a> on 2016-04-03 13:26</div>
            <div class="timeline-body"><p>Thank you for the quick fix!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/klingtnet">@klingtnet</a> on 2016-04-03 13:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>TeXitoi/structopt#173</a> on 2019-06-26 05:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:56:23 UTC
    </footer>
</body>
</html>
