<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conflicting with a positional should allow users to skip it, passing in another positional instead - clap-rs/clap #1794</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Conflicting with a positional should allow users to skip it, passing in another positional instead</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/clap-rs/clap/issues/1794">#1794</a>
        opened by <a href="https://github.com/nayeemrmn">@nayeemrmn</a>
        on 2020-04-08 13:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/nayeemrmn">@nayeemrmn</a> on 2020-04-08 13:18</div>
            <div class="timeline-body"><!-- Issuehunt Badges -->

<p><a href="https://issuehunt.io/r/clap-rs/clap/issues/1794"><img alt="Issuehunt badges" src="https://img.shields.io/badge/IssueHunt-%2420%20Funded-%2300A156.svg" /></a></p>
<!-- /Issuehunt Badges -->

<!--
Please use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`
-->

<h3>Rust Version</h3>
<p><code>rustc 1.42.0 (b8cedc004 2020-03-09)</code></p>
<h3>Code</h3>
<pre><code class="language-rust">use clap;
use clap::Arg;
use clap::ArgGroup;

fn main() {
  let app = clap::App::new(&quot;hello&quot;)
    .bin_name(&quot;deno&quot;)
    .arg(
      Arg::with_name(&quot;option1&quot;)
        .long(&quot;option1&quot;)
        .takes_value(false),
    )
    .arg(
      Arg::with_name(&quot;pos1&quot;)
        .takes_value(true),
    )
    .group(
      ArgGroup::with_name(&quot;arg1&quot;)
        .args(&amp;[&quot;pos1&quot;, &quot;option1&quot;])
        .required(true),
    )
    .arg(
      Arg::with_name(&quot;pos2&quot;)
        .takes_value(true)
    );

    match app.get_matches_from_safe(std::env::args().collect::&lt;Vec&lt;String&gt;&gt;()) {
      Ok(_) =&gt; (),
      Err(err) =&gt; err.exit(),
    }
}
</code></pre>
<h3>Steps to reproduce the issue</h3>
<p><code>cargo run -- -h</code></p>
<h3>Affected Version of <code>clap*</code></h3>
<p>2.33.0</p>
<h3>Actual Behavior Summary</h3>
<pre><code>USAGE:
    deno &lt;pos1|--option1&gt; [pos1]
</code></pre>
<p><code>cargo run -- --option1 abcd</code> binds <code>abcd</code> to <code>pos1</code> and complains about conflict between <code>option1</code> and <code>pos1</code></p>
<p>Blocks https://github.com/denoland/deno/pull/4635, ref https://github.com/denoland/deno/pull/4635#issuecomment-610548655.</p>
<h3>Expected Behavior Summary</h3>
<pre><code>USAGE:
    deno &lt;pos1|--option1&gt; [pos2]
</code></pre>
<p><code>cargo run -- --option1 abcd</code> should bind <code>abcd</code> to <code>pos2</code>. In other words, it should detect <code>--option1</code> having been given as an option and accordingly skip <code>pos1</code> which <code>--option1</code> is grouped with.</p>
<p>--</p>
<p>If this is actually intended I welcome suggestions as to how I can get the above behaviour. But what else should be the semantics of grouping positional args with options?</p>
<!-- Issuehunt content -->

<hr />
<details>
<summary>
<b>IssueHunt Summary</b>
</summary>

<h3>Backers (Total: $20.00)</h3>
<ul>
<li><a href="https://issuehunt.io/u/pksunkara"><img src='https://avatars.githubusercontent.com/u/174703?v=4' alt='pksunkara' width=24 height=24> pksunkara</a> ($20.00)</li>
</ul>
<h4><a href="https://issuehunt.io/r/clap-rs/clap/issues/1794">Become a backer now!</a></h4>
<h4><a href="https://issuehunt.io/r/clap-rs/clap/issues/1794">Or submit a pull request to get the deposits!</a></h4>
<h3>Tips</h3>
<ul>
<li>Checkout the <a href="https://issuehunt.io/r/clap-rs/clap/">Issuehunt explorer</a> to discover more funded issues.</li>
<li>Need some help from other developers? <a href="https://issuehunt.io/r/new">Add your repositories</a> on IssueHunt to raise funds.</details>

</li>
</ul>
<!-- /Issuehunt content-->

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @nayeemrmn on 2020-04-08 13:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: arg groups</span> added by @pksunkara on 2020-04-09 08:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: args</span> added by @pksunkara on 2020-04-09 08:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @pksunkara on 2020-04-09 08:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-09 08:38</div>
            <div class="timeline-body"><p>Yeah, this definitely looks like a bug. cc @CreepySkeleton</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../denoland/deno/pulls/4635.html">denoland/deno#4635</a> on 2020-04-09 11:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">M: work in progress</span> added by @CreepySkeleton on 2020-04-21 11:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-04-21 11:34</div>
            <div class="timeline-body"><p>Yes. I would expect all of the following to be valid invocations:</p>
<pre><code>app pos1 pos2
app --option1=val
app --option1 val pos2 &lt;- THIS FAILS
</code></pre>
<p>Working on the fix, might take a while.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nayeemrmn">@nayeemrmn</a> on 2020-04-21 11:39</div>
            <div class="timeline-body"><blockquote>
<pre><code>app --option1=val
app --option1 val pos2 &lt;- THIS FAILS
</code></pre>
</blockquote>
<p>Small correction that <code>--option1</code> doesn't take a value in my example but that would make for a better one.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/1856.html">clap-rs/clap#1856</a> on 2020-04-23 17:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">M: work in progress</span> removed by @CreepySkeleton on 2020-04-23 17:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @bors[bot] on 2020-04-24 11:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ldm0">@ldm0</a> on 2020-11-09 18:27</div>
            <div class="timeline-body"><p>Should be reopen. The usage output is still not correct.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @pksunkara on 2020-11-09 19:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2245.html">clap-rs/clap#2245</a> on 2020-12-08 17:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @pksunkara on 2020-12-08 17:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-01-16 14:08</div>
            <div class="timeline-body"><p>@ldm0 You were saying that the original fix is wrong. Can you point out a test case why it is wrong?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2297.html">clap-rs/clap#2297</a> on 2021-01-17 14:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ldm0">@ldm0</a> on 2021-01-19 19:11</div>
            <div class="timeline-body"><p>@pksunkara  Check this:</p>
<pre><code class="language-rust">let m = clap::App::new(&quot;hello&quot;)
    .bin_name(&quot;deno&quot;)
    .arg(Arg::new(&quot;pos1&quot;).takes_value(true))
    .arg(Arg::new(&quot;option2&quot;).long(&quot;option2&quot;).takes_value(false))
    .arg(Arg::new(&quot;pos2&quot;).takes_value(true))
    .group(
        ArgGroup::new(&quot;arg2&quot;)
            .args(&amp;[&quot;pos2&quot;, &quot;option2&quot;])
            .required(true),
    )
    .try_get_matches();

dbg!(m);
</code></pre>
<p>with:</p>
<pre><code>cargo run -- --option2 abcd
</code></pre>
<p>You will notice it complains about conflict between <code>option2</code> and <code>pos2</code>. However the abcd should be placed in pos1.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2309.html">clap-rs/clap#2309</a> on 2021-01-23 07:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @pksunkara on 2021-01-27 18:48</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/issuehunt-oss[bot]">@issuehunt-oss[bot]</a> on 2021-01-27 18:50</div>
            <div class="timeline-body"><p><a href="https://issuehunt.io/u/pksunkara">@pksunkara</a> has funded $20.00 to this issue.</p>
<hr />
<ul>
<li>Submit pull request via <a href="https://issuehunt.io/repos/31315121/issues/1794">IssueHunt</a> to receive this reward.</li>
<li>Want to contribute? Chip in to this issue via <a href="https://issuehunt.io/repos/31315121/issues/1794">IssueHunt</a>.</li>
<li>Checkout the <a href="https://issuehunt.io/issues">IssueHunt Issue Explorer</a> to see more funded issues.</li>
<li>Need help from developers? <a href="https://issuehunt.io/r/new">Add your repository</a> on IssueHunt to raise funds.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">:dollar: Funded on Issuehunt</span> added by @issuehunt-oss[bot] on 2021-01-27 18:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Assigned to @ldm0 by @pksunkara on 2021-02-08 05:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dmaahs2017">@dmaahs2017</a> on 2021-02-16 04:57</div>
            <div class="timeline-body"><p>Is this issue solved?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ldm0">@ldm0</a> on 2021-02-16 04:58</div>
            <div class="timeline-body"><blockquote>
<p>Is this issue solved?</p>
</blockquote>
<p>Nope, currently.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-05-26 11:13</div>
            <div class="timeline-body"><p>@ldm0 Can we focus on finishing this first? Or is it blocked by other stuff?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rami3l">@rami3l</a> on 2021-08-05 22:37</div>
            <div class="timeline-body"><p>@pksunkara @ldm0 The example above now passes on <code>master</code> with <code>AppSettings::AllowMissingPositional</code>:</p>
<pre><code class="language-rs">/// Test for https://github.com/clap-rs/clap/issues/1794.
#[test]
fn positional_args_with_options() {
    let app = clap::App::new(&quot;hello&quot;)
        .bin_name(&quot;deno&quot;)
        .setting(AppSettings::AllowMissingPositional)
        .arg(Arg::new(&quot;option1&quot;).long(&quot;option1&quot;).takes_value(false))
        .arg(Arg::new(&quot;pos1&quot;).takes_value(true))
        .group(
            ArgGroup::new(&quot;arg1&quot;)
                .args(&amp;[&quot;pos1&quot;, &quot;option1&quot;])
                .required(true),
        )
        .arg(Arg::new(&quot;pos2&quot;).takes_value(true));

    let m = app.get_matches_from(&amp;[&quot;deno&quot;, &quot;--option1&quot;, &quot;abcd&quot;]);
    assert!(m.is_present(&quot;option1&quot;));
    assert!(!m.is_present(&quot;pos1&quot;));
    assert!(m.is_present(&quot;pos2&quot;));
    assert_eq!(m.value_of(&quot;pos2&quot;), Some(&quot;abcd&quot;));
}
</code></pre>
<p>And the usage is correctly shown as:</p>
<pre><code class="language-yml">USAGE:
    deno &lt;pos1|--option1&gt; [pos2]
</code></pre>
<p>This <code>AppSettings</code> option is required due to the logic here, which indicates that a <code>pos_counter</code> bump is only available under certain conditions (which is needed for the example to work):</p>
<p>https://github.com/clap-rs/clap/blob/8b6034e668de0933ab0f88ad14a60a8f1d79a172/src/parse/parser.rs#L483-L484</p>
<p>Is this intended?</p>
<ul>
<li>If so, I can make a PR to add this test and finally close this issue.</li>
<li>If not, maybe we should change the API to allow this special case of <code>skipping</code> certain pos args?</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2665.html">clap-rs/clap#2665</a> on 2021-08-05 23:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-08-06 10:02</div>
            <div class="timeline-body"><p>@ldm0 what do you think?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ldm0">@ldm0</a> on 2021-08-07 18:05</div>
            <div class="timeline-body"><p>This works:</p>
<pre><code class="language-rust">use clap;
use clap::Arg;
use clap::ArgGroup;
use clap::AppSettings;

fn main() {
    let app = clap::App::new(&quot;hello&quot;)
        .bin_name(&quot;deno&quot;)
        .setting(AppSettings::AllowMissingPositional)
        .arg(Arg::new(&quot;option1&quot;).long(&quot;option1&quot;).takes_value(false))
        .arg(Arg::new(&quot;pos1&quot;).takes_value(true))
        .arg(Arg::new(&quot;pos2&quot;).takes_value(true))
        .group(
            ArgGroup::new(&quot;arg1&quot;)
                .args(&amp;[&quot;pos1&quot;, &quot;option1&quot;])
                .required(true),
        )
        .get_matches();
}
</code></pre>
<p>But this is not:</p>
<pre><code class="language-rust">use clap;
use clap::Arg;
use clap::ArgGroup;
use clap::AppSettings;

fn main() {
    let app = clap::App::new(&quot;hello&quot;)
        .bin_name(&quot;deno&quot;)
        .setting(AppSettings::AllowMissingPositional)
        .arg(Arg::new(&quot;option1&quot;).long(&quot;option1&quot;).takes_value(false))
        .arg(Arg::new(&quot;pos1&quot;).takes_value(true))
        .arg(Arg::new(&quot;pos2&quot;).takes_value(true))
        .arg(Arg::new(&quot;pos3&quot;).takes_value(true))
        .group(
            ArgGroup::new(&quot;arg1&quot;)
                .args(&amp;[&quot;pos1&quot;, &quot;pos2&quot;, &quot;option1&quot;])
                .required(true),
        )
        .get_matches();
}
</code></pre>
<pre><code class="language-rust">error: The argument '--option1' cannot be used with '&lt;pos1&gt;'

USAGE:
    deno [pos3] &lt;pos1|pos2|--option1&gt;

For more information try --help
</code></pre>
<p>I don't think this issue can be closed now.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.0" by @epage on 2021-10-16 18:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @epage on 2021-10-16 18:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/151.html">epage/clapng#151</a> on 2021-12-06 20:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: args</span> removed by @epage on 2021-12-08 19:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: arg groups</span> removed by @epage on 2021-12-08 19:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-help</span> added by @epage on 2021-12-08 19:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-medium</span> added by @epage on 2021-12-09 22:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-medium</span> removed by @epage on 2022-04-29 13:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-hard</span> added by @epage on 2022-04-29 13:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-04-29 13:50</div>
            <div class="timeline-body"><p>I'm torn on this.  <code>AllowMissingPositional</code> is very limited solution.  The right way of doing this is to check for conflicts for positionals and skip them.  Right now, conflicts are only a validation concern and not a parse concern and I was hoping to keep it that way for our modularization work.  However, being able to control when to skip positionals in this ways is also associated with our desire to make clap more flexible.</p>
<p>Going to put this back in the design/decision status and going to remove the milestone.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.x" by @epage on 2022-04-29 13:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-hard</span> removed by @epage on 2022-04-29 13:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-decision</span> added by @epage on 2022-04-29 13:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../spkenv/spk/pulls/775.html">spkenv/spk#775</a> on 2023-06-29 17:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Unassigned @ldm0 by @pksunkara on 2025-05-30 12:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">:dollar: Funded on Issuehunt</span> removed by @pksunkara on 2025-05-30 12:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Bug when grouping positional args with options" to "Conflicting with a positional should allow users to skip it, passing in another positional instead" by @epage on 2025-08-15 13:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-parsing</span> added by @epage on 2025-08-15 13:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/6105.html">clap-rs/clap#6105</a> on 2025-08-15 13:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:32 UTC
    </footer>
</body>
</html>
