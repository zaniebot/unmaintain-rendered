```yaml
number: 4715
title: "`required` conflicts with `required_unless*`"
type: issue
state: closed
author: Ciubix8513
labels:
  - C-bug
assignees: []
created_at: 2023-02-18T17:21:12Z
updated_at: 2023-02-19T01:49:44Z
url: https://github.com/clap-rs/clap/issues/4715
synced_at: 2026-01-10T01:57:48Z
```

# `required` conflicts with `required_unless*`

---

_Issue opened by @Ciubix8513 on 2023-02-18 17:21_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the [open](https://github.com/clap-rs/clap/issues) and [rejected](https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed) issues

### Rust Version

1.67.1

### Clap Version

4.1.6

### Minimal reproducible code

```rust
use clap::{Parser};

#[derive(Parser,Debug)]
struct Args{
    #[arg(short)]
    a: bool,
    #[arg(required_unless_present("a"))]
    test: String, 
}

fn main() {
    let args = Args::parse();
}
```


### Steps to reproduce the bug with the above code

cargo run

### Actual Behaviour

'main' panicked at 'Argument test: `required` conflicts with `required_unless*`', /home/luna/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-4.1.6/src/builder/debug_asserts.rs:186:13


### Expected Behaviour

`required_unless*` should automatically infer remove `required` and the code example should run normally 

### Additional Context

Currently to fix this issue you need to add `default_value` to the arg definition, and then it works as expected 

### Debug Output

_No response_

---

_Label `C-bug` added by @Ciubix8513 on 2023-02-18 17:21_

---

_Renamed from "required conflicts with required_unless* " to "`required` conflicts with `required_unless*`" by @Ciubix8513 on 2023-02-18 17:22_

---

_Comment by @epage on 2023-02-19 00:25_

Even if we resolved things to prevent that assert, it would then fail at runtime.  If the "unless" case happens, clap will have nothing to put into that field and will report an error.

You either need to make the argument optional  by changing the type from `String` to `Option<String>` or provide a default.  

---

_Comment by @Ciubix8513 on 2023-02-19 01:45_

Yea, that makes sense. 
But wouldn't it be possible that the compiler gives an error saying that `required_unless*`  requires the argument to be `Option<>` or have a defualt value? 
I'm not quite sure if that's possible (I'm pretty new to rust), but that would make it less confusing, to people who are not as familiar with Clap or Rust.

---

_Comment by @epage on 2023-02-19 01:49_

Yes, ideally, more of our checks would be done at compile-time.  A couple of challenges with that
- We support merging structs and the compiler doesn't tell us anything about the other struct
- There are a lot of corner cases for how these arguments interact that it would be complex and brittle, especially because...
- This would be hard to maintain as we'd have to have a copy of all of the rules available at both compile time and runtime.

See also #3133

---

_Comment by @epage on 2023-02-19 01:49_

As it seems this direct issue is resolved, I'm going to go ahead and close thos

---

_Closed by @epage on 2023-02-19 01:49_

---
