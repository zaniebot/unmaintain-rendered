<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add default missing values of `Arg` to help message - clap-rs/clap #6109</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Add default missing values of `Arg` to help message</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/clap-rs/clap/issues/6109">#6109</a>
        opened by <a href="https://github.com/tvercruyssen">@tvercruyssen</a>
        on 2025-08-23 23:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/tvercruyssen">@tvercruyssen</a> on 2025-08-23 23:28</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[x] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[x] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>master</p>
<h3>Describe your use case</h3>
<p>Command line options with a <code>default_missing_value</code> can be used as flags and then take on a specified default value. This behavior is quite useful. However, the user discoverability of it seems to be non-existent? As in, based on the help output a user couldn't know whether an option has a <code>default_missing_value</code>. E.g.:</p>
<pre><code class="language-console">Usage: clap-6109 [OPTIONS]

Options:
      --color [&lt;COLOR&gt;]  [default: auto] [possible values: auto, always, never]
  -h, --help             Print help
  -V, --version          Print version
</code></pre>
<details>
<summary>Source code</summary>

<pre><code class="language-rust">#!/usr/bin/env nargo
---
[dependencies]
clap = { version = &quot;4&quot;, features = [&quot;derive&quot;] }
---

use clap::Parser;

#[derive(Parser, Debug)]
#[command(version, about, long_about = None)]
struct Cli {
    #[arg(
        long,
        value_parser = [&quot;auto&quot;, &quot;always&quot;, &quot;never&quot;],
        default_value = &quot;auto&quot;,
        default_missing_value = &quot;always&quot;,
        num_args = 0..=1,
    )]
    color: String,
}

fn main() {
    let cli = Cli::parse();
    println!(&quot;{cli:#?}&quot;);
}

</code></pre>
</details>

<h3>Describe the solution you'd like</h3>
<p>Add default missing values to the generated help message. If included/displayed the same way as default values, it would look like:</p>
<pre><code class="language-console">Usage: clap-6109 [OPTIONS]

Options:
      --color [&lt;COLOR&gt;]  [default: auto] [default missing value: always] [possible values: auto, always, never]
  -h, --help             Print help
  -V, --version          Print version
</code></pre>
<p>Potentially, this should be behind a flag and not the default behavior to include these. Moreover, I have no preference on the format and welcome discussion about it. It seems sensible enough to adopt the already used format for this, hence the proposal.</p>
<h3>Alternatives, if applicable</h3>
<p>The only way I see a user discovering this behavior is through the help message</p>
<h3>Additional Context</h3>
<p>This is my first feature request, please point out any mistakes I made ü•∫ .</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @tvercruyssen on 2025-08-23 23:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/6110.html">clap-rs/clap#6110</a> on 2025-08-23 23:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-help</span> added by @epage on 2025-08-25 14:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-decision</span> added by @epage on 2025-08-25 14:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-08-25 14:41</div>
            <div class="timeline-body"><pre><code class="language-console">Usage: n --ex1 &lt;EXAMPLE&gt; --ex2 &lt;EXAMPLE2&gt;

Options:
      --ex1 &lt;EXAMPLE&gt;   Ex1
      --ex2 &lt;EXAMPLE2&gt;  Ex2
  -h, --help            Print help
  -V, --version         Print version
</code></pre>
<pre><code class="language-rust">use clap::Parser;

#[derive(Parser)]
#[command(version, about, long_about = None)]
struct Cli {
    /// Ex1
    #[arg(long = &quot;ex1&quot;)]
    example: String,

    /// Ex2
    #[arg(long = &quot;ex2&quot;, default_missing_value = &quot;some_value&quot;)]
    example2: String,
}

fn main() {
    Cli::parse();
}
</code></pre>
<p>Note that there is a bug in this program, <code>--ex2</code> always requires a value, despite <code>default_missing_value</code> being set.</p>
<p>I'll update the included examples to fix the bug and to be more real-world</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-08-25 14:50</div>
            <div class="timeline-body"><p>The <code>[]</code> context / specs have never really sat right with me and the more we add, the worse I feel the overall experience is.</p>
<p>Take the updated example where we have three pieces of context and how it overwhelms things.</p>
<pre><code class="language-console">$ ./clap-6109.rs --help
Usage: clap-6109 [OPTIONS]

Options:
      --color [&lt;COLOR&gt;]  [default: auto] [default missing value: always] [possible values: auto, always, never]
  -h, --help             Print help
  -V, --version          Print version

$ ./clap-6109.rs
Cli {
    color: &quot;auto&quot;,
}

$ ./clap-6109.rs --color
Cli {
    color: &quot;always&quot;,
}

$ ./clap-6109.rs --color never
Cli {
    color: &quot;never&quot;,
}
</code></pre>
<p>#5156 might see us move <code>possible values</code> out.</p>
<p>In the case of <code>--color</code>, I feel like the <code>default_missing_value</code>s meaning is clear.  I suspect that should be the case for all uses of it or else its crossing over into cute-but-not-helpful territory.  If my suspicion is correct, then adding a <code>[default missing value]</code> context becomes redundant.</p>
<p>Could you help me understand what it is that you see where showing this information would be helpful and outweigh the costs?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tvercruyssen">@tvercruyssen</a> on 2025-08-26 18:35</div>
            <div class="timeline-body"><p>The real-world use case is a toy app that removes (neo)vim undofiles:</p>
<pre><code class="language-rust">#!/usr/bin/env nargo
---
[dependencies]
clap = { version = &quot;4&quot;, features = [&quot;derive&quot;] }
---

use clap::Parser;

#[derive(Parser, Debug)]
#[command(version, about, long_about = None)]
pub struct Cli {
    // &lt;SNIP/&gt;

    /// Purge files with an older modified date
    #[arg(short = 'l', long, default_missing_value = &quot;90d&quot;, num_args = 0..=1,)]
    modified_date_limit: Option&lt;String&gt;, // Option&lt;humantime::Duration&gt;
}

fn main() {
    let cli = Cli::parse();
    println!(&quot;{cli:#?}&quot;);
}
</code></pre>
<p>Where the <code>default_missing_value</code> isn't necessarily obvious, but it did seem useful that the user could use the 'recommended' default threshold. And be easily informed about what it is. However, maybe I'm misusing the option, in which case by all means feel free to close this issue/associated MR.
If, however, you feel this is a valid use case, I admit that it is still rather niche and the default should potentially stay as is. I.e. no inclusion of <code>default_missing_value</code> in help messages.</p>
<p>Regarding the output, I don't really have an opinion on how it shows up, as long as the user understands it. But I will agree that it is currently a bit cluttery.</p>
<p>One option could be:</p>
<pre><code>$ ./clap-6109.rs --help
Usage: clap-6109 [OPTIONS]

Options:
      --color [&lt;COLOR&gt;|'always']  [default: auto] [possible values: auto, always, never]
  -h, --help             Print help
  -V, --version          Print version
</code></pre>
<p>Tho I'm not sure whether that is unambiguous, i.e. whether the user understands <code>&lt;COLOR&gt;</code> is their input and <code>always</code> is the default if not given. But it does reduce clutter. And I think it illustrates the idea of inlining/using symbols/context to indicate the meaning rather than the full term <code>default_missing_value</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-08-26 18:49</div>
            <div class="timeline-body"><blockquote>
<p>The real-world use case is a toy app that removes (neo)vim undofiles:</p>
</blockquote>
<p>Thanks for that example!  I'll have to think on this</p>
<blockquote>
<p>One option could be:</p>
<p>Tho I'm not sure whether that is unambiguous</p>
</blockquote>
<p>imo it is.  Its saying &quot;if a value is present, it can be one of <code>COLOR</code> or the literal string <code>always</code>&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tvercruyssen">@tvercruyssen</a> on 2025-08-26 19:11</div>
            <div class="timeline-body"><p>Hmm, perhaps</p>
<pre><code class="language-console">$ ./clap-6109.rs --help
Usage: clap-6109 [OPTIONS]

Options:
      --color [&lt;COLOR&gt;=always]  [default: auto] [possible values: auto, always, never]
  -h, --help             Print help
  -V, --version          Print version
</code></pre>
<p>I.e. <code>=</code> instead of <code>|</code>. Tho this seems more ambiguous in that it may indicate that no user input can be given...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/carlocorradini">@carlocorradini</a> on 2025-10-24 14:36</div>
            <div class="timeline-body"><p>Hey, this is super useful üòç
Any update? üôå</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:35 UTC
    </footer>
</body>
</html>
