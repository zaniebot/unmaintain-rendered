<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`min_values(0)` still complains about no value when combining short versions - clap-rs/clap #2624</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>min_values(0)</code> still complains about no value when combining short versions</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/2624">#2624</a>
        opened by <a href="https://github.com/miDeb">@miDeb</a>
        on 2021-07-26 14:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/miDeb">@miDeb</a></div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.56.0-nightly (9c25eb7aa 2021-07-25)</p>
<h3>Clap Version</h3>
<p>2.33</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">use clap::{App, Arg};

fn main() {
    let matches = App::new(&quot;foo&quot;)
        .arg(
            Arg::with_name(&quot;check&quot;)
                .short(&quot;c&quot;)
                .long(&quot;check&quot;)
                .takes_value(true)
                .require_equals(true)
                .min_values(0)
                .possible_values(&amp;[&quot;silent&quot;, &quot;quiet&quot;, &quot;diagnose-first&quot;])
                .help(&quot;check for sorted input; do not sort&quot;),
        )
        .arg(
            Arg::with_name(&quot;unique&quot;)
                .short(&quot;u&quot;)
                .long(&quot;unique&quot;)
                .help(&quot;output only the first of an equal run&quot;),
        )
        .get_matches();
    assert!(matches.is_present(&quot;check&quot;));
    assert!(matches.is_present(&quot;unique&quot;));
}

</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<p>cargo r -- -cu</p>
<h3>Actual Behaviour</h3>
<pre><code class="language-plaintext">error: The argument '--check=&lt;check&gt;' requires a value but none was supplied

USAGE:
    clap-bug [FLAGS] [OPTIONS]

For more information try --help
</code></pre>
<h3>Expected Behaviour</h3>
<p>The same thing that happens when invoking the program like this: <code>cargo r -- -u -c</code>, which should be synomymous to <code>-cu</code>.
The program would succeed and produce no output.</p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
<h3>Debug Output</h3>
<pre><code class="language-plaintext">DEBUG:clap:Parser::propagate_settings: self=foo, g_settings=AppFlags(
    (empty),
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:Parser::get_matches_with: Begin parsing '&quot;-cu&quot;' ([45, 99, 117])
DEBUG:clap:Parser::is_new_arg:&quot;-cu&quot;:NotFound
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: - found
DEBUG:clap:Parser::is_new_arg: starts_new_arg=true
DEBUG:clap:Parser::possible_subcommand: arg=&quot;-cu&quot;
DEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None
DEBUG:clap:ArgMatcher::process_arg_overrides:None;
DEBUG:clap:Parser::parse_short_arg: full_arg=&quot;-cu&quot;
DEBUG:clap:Parser::parse_short_arg:iter:c
DEBUG:clap:Parser::parse_short_arg:iter:c: Found valid opt
DEBUG:clap:Parser::parse_short_arg:iter:c: p[0]=[], p[1]=[117]
DEBUG:clap:Parser::parse_short_arg:iter:c: val=[117] (bytes), val=&quot;u&quot; (ascii)
DEBUG:clap:Parser::parse_opt; opt=check, val=Some(&quot;u&quot;)
DEBUG:clap:Parser::parse_opt; opt.settings=ArgFlags(TAKES_VAL | DELIM_NOT_SET | REQUIRE_EQUALS)
DEBUG:clap:Parser::parse_opt; Checking for val...Found Empty - Error
DEBUG:clap:usage::create_usage_with_title;
DEBUG:clap:usage::create_usage_no_title;
DEBUG:clap:usage::get_required_usage_from: reqs=[], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:usage::needs_flags_tag;
DEBUG:clap:usage::needs_flags_tag:iter: f=unique;
DEBUG:clap:Parser::groups_for_arg: name=unique
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:usage::needs_flags_tag:iter: [FLAGS] required
DEBUG:clap:usage::create_help_usage: usage=clap-bug [FLAGS] [OPTIONS]
DEBUG:clap:Parser::color;
DEBUG:clap:Parser::color: Color setting...Auto
DEBUG:clap:is_a_tty: stderr=true
DEBUG:clap:Colorizer::error;
DEBUG:clap:OptBuilder::fmt:check
DEBUG:clap:Colorizer::warning;
DEBUG:clap:Colorizer::good;
error: The argument '--check=&lt;check&gt;' requires a value but none was supplied

USAGE:
    clap-bug [FLAGS] [OPTIONS]

For more information try --help
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @miDeb on 2021-07-26 14:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-07-26 15:31</div>
            <div class="timeline-body"><p>Looks to be an ordering issue.  We pull out the value before checking <code>RequireEquals</code></p>
<p>I feel like this is something that would be made easier to fix once we've refactored to having a dedicated lexer, see https://github.com/clap-rs/clap/discussions/2615</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../uutils/coreutils/pulls/2520.html">uutils/coreutils#2520</a> on 2021-07-26 16:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ldm0">@ldm0</a> on 2021-07-26 16:07</div>
            <div class="timeline-body"><p>Current master behaviour:</p>
<pre><code class="language-rust">use clap::{App, Arg};
fn main() {
    let matches = App::new(&quot;foo&quot;)
        .arg(
            Arg::new(&quot;check&quot;)
                .short('c')
                .long(&quot;check&quot;)
                .require_equals(true)
                .min_values(0)
                .possible_values(&amp;[&quot;silent&quot;, &quot;quiet&quot;, &quot;diagnose-first&quot;]),
        )
        .arg(
            Arg::new(&quot;unique&quot;)
                .short('u')
                .long(&quot;unique&quot;)
        )
        .get_matches();
    assert!(matches.is_present(&quot;check&quot;));
    assert!(matches.is_present(&quot;unique&quot;));
}

</code></pre>
<pre><code class="language-rust">error: &quot;u&quot; isn't a valid value for '--check=&lt;check&gt;...'
        [possible values: diagnose-first, quiet, silent]

USAGE:
    rust_test2 --check=&lt;check&gt;...

For more information try --help
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/miDeb">@miDeb</a> on 2021-07-26 16:08</div>
            <div class="timeline-body"><p>This looks like it doesn't take <code>require_equals(true)</code> into account on current master.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2643.html">clap-rs/clap#2643</a> on 2021-07-30 04:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @pksunkara on 2021-07-30 09:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:47:59 UTC
    </footer>
</body>
</html>
