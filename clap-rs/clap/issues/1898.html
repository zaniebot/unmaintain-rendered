<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>generate_to ignores given argument and derives its own - clap-rs/clap #1898</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>generate_to ignores given argument and derives its own</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1898">#1898</a>
        opened by <a href="https://github.com/alerque">@alerque</a>
        on 2020-05-02 22:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/alerque">@alerque</a></div>
            <div class="timeline-body"><p>Trying to get shell completion generators working on my app (porting from StructOpt) I ran into trouble using the <code>generate_to()</code> function.</p>
<p>https://github.com/clap-rs/clap/blob/306dc830361438fbe140e55863b75924bff1b74c/clap_generate/src/lib.rs#L124-L139</p>
<p>Even with code pretty much copied out of the docs (marked as ignore):</p>
<pre><code class="language-rust">let outdir = match env::var_os(&quot;OUT_DIR&quot;) {
    None =&gt; return,
    Some(outdir) =&gt; outdir,
};

let mut app = build_cli();
generate_to::&lt;Bash, _, _&gt;(
    &amp;mut app,     // We need to specify what generator to use
    &quot;myapp&quot;,      // We need to specify the bin name manually
    outdir,       // We need to specify where to write to
);
</code></pre>
<p>This code explicitly passes a value for <code>bin_name</code>, yet it is unused. L130 of the function above is fetching the bin name out of the app definition and using that to build a file path, ignoring the value we passed.</p>
<p>Furthermore if the app doesn't happen to have a bin_name set already, the code will panic!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @pksunkara on 2020-05-03 07:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @pksunkara on 2020-05-03 07:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-05-03 07:02</div>
            <div class="timeline-body"><p>Thanks for reporting. This actually ties into https://github.com/clap-rs/clap/issues/1764. We might want just one file name but different bin names.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2020-05-04 16:52</div>
            <div class="timeline-body"><p>I'm trying to remember exactly, but I <em>think</em> the reason I originally had the user pass in the binary name was because the <code>App</code>'s <code>bin_name</code> doesn't get determined until runtime, however many shell completion script generations happen in a <code>build.rs</code> at compile time. So we need a way to tell the generating code what the binary would be called.</p>
<p>Of course this can be fixed by making <code>App::bin_name</code> or <code>App::set_bin_name</code> mandatory (side note we should fix the naming of those methods so they're less confusing. I know they one is <code>&amp;self</code> and returns <code>Sefl</code> while other is just <code>&amp;mut self</code>...I think the Rust idiom here is to make the <code>&amp;mut  self</code>'s method name end in <code>_mut</code>...but I digress). But that should be well documented, or this invariant should be checked inside <code>genereate_*</code> methods via <code>assert!</code>s.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: generator</span> added by @CreepySkeleton on 2020-06-30 09:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/saecki">@saecki</a> on 2021-02-15 15:47</div>
            <div class="timeline-body"><p>So just a follow up as I encountered this myself. How about using the passed bin_name as a file name if the app doesn't have one. Or providing a more helpful error message with <code>expect</code> instead of <code>unwrap</code> that says &quot;App is missing a bin_name, consider adding one by using App::bin_name&quot; or something similar.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @pksunkara on 2021-04-06 08:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:47:39 UTC
    </footer>
</body>
</html>
