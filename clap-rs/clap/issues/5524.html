<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arg::new(&quot;set-import&quot;).num_args(3).value_names([&quot;asdf&quot;]) are listed 3 times in --help; should only list once - clap-rs/clap #5524</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Arg::new(&quot;set-import&quot;).num_args(3).value_names([&quot;asdf&quot;]) are listed 3 times in --help; should only list once</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/5524">#5524</a>
        opened by <a href="https://github.com/qknight">@qknight</a>
        on 2024-06-10 10:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/qknight">@qknight</a></div>
            <div class="timeline-body">Please complete the following tasks
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
Rust Version
<p>1.78.0</p>
Clap Version
<p>4.3.24</p>
Minimal reproducible code
issue
<p>the --help for set-import should look like:</p>
<pre><code>--set-import &lt;file&gt; &lt;from&gt; &lt;to&gt;</code></pre>
<p>but instead it looks like:</p>
<pre><code>--set-import &lt;asdf&gt; &lt;asdf&gt; &lt;asdf&gt;</code></pre>
<p>It will always just repeat what i put into</p>
<pre><code>.num_args(3).value_names([&quot;asdf&quot;])</code></pre>
<p>or</p>
<pre><code>.num_args(3).value_name(&quot;file from to&quot;)</code></pre>
<p>I also tried subcommand and browsed through all the examples but I couldn&#x27;t find a mention for a command line option with 3 arguments.</p>
the --help run
<pre><code>(base) PS C:\Users\joschie\Desktop\Projects\fixPath\target\debug&gt; .\fixPath.exe --help
&gt;&gt;&gt; fixPath to modify FS locations of linked DLLs in an PE executable &lt;&lt;&lt;

Usage: fixPath.exe &lt;--version|--list-imports &lt;FILENAME&gt;|--set-import &lt;asdf&gt; &lt;asdf&gt; &lt;asdf&gt;&gt;

Options:
      --version                          Prints the version
      --list-imports &lt;FILENAME&gt;          Calls the list_imports function with a filename
      --set-import &lt;asdf&gt; &lt;asdf&gt; &lt;asdf&gt;  Updates DLL bindings for &lt;from&gt; so it points to &lt;to&gt;
  -h, --help                             Print help
</code></pre>
replit
<p>The code is at:
https://replit.com/@qknight/test</p>
the code
<pre><code>use clap::{value_parser, Arg, ArgAction, Command};
use std::{env, fs, process};

fn main() {
    let matches = Command::new(&quot;fixPath&quot;)
        .about(&quot;&gt;&gt;&gt; fixPath to modify FS locations of linked DLLs in an PE executable &lt;&lt;&lt;&quot;)
        .arg(
            Arg::new(&quot;version&quot;)
                .long(&quot;version&quot;)
                .help(&quot;Prints the version&quot;)
                .action(ArgAction::SetTrue),
        )
        .arg(
            Arg::new(&quot;list-imports&quot;)
                .long(&quot;list-imports&quot;)
                .help(&quot;Calls the list_imports function with a filename&quot;)
                .value_name(&quot;FILENAME&quot;),
        )
        .arg(
            Arg::new(&quot;set-import&quot;)
                .long(&quot;set-import&quot;)
                .help(&quot;Updates DLL bindings for &lt;from&gt; so it points to &lt;to&gt;&quot;)
                .num_args(3)
                .value_names([&quot;asdf&quot;]) // FIXME is printed 3 times in --help, why?!
                .required(false),
        )
        .group(
            clap::ArgGroup::new(&quot;commands&quot;)
                .args(&amp;[&quot;version&quot;, &quot;list-imports&quot;, &quot;set-import&quot;])
                .required(true)
                .multiple(false),
        )
        .get_matches();

    if matches.get_flag(&quot;version&quot;) {
        println!(&quot;fixPath version 1.0&quot;); // FIXME read from cargo.toml
    } else if let Some(filename) = matches.get_one::&lt;String&gt;(&quot;list-imports&quot;) {
        println!(&quot;{}&quot;, filename);
    } else if let Some(values) = matches.get_many::&lt;String&gt;(&quot;set-import&quot;) {
        let args: Vec&lt;&amp;str&gt; = values.map(|s| s.as_str()).collect();
        println!(&quot;set-import: {}, {}, {}&quot;, args[0], args[1], args[2]);
    }
}
</code></pre>
Steps to reproduce the bug with the above code
<p>Use replit or simply copy the contents into a main.rs and use:</p>
<pre><code>[package]
name = &quot;fixPath&quot;
version = &quot;0.1.0&quot;
edition = &quot;2021&quot;

[dependencies]
clap = { version = &quot;4.3.24&quot;, features = [&quot;derive&quot;] }
</code></pre>
Actual Behaviour
<p>It shows:</p>
<p>--set-import   </p>
Expected Behaviour
<p>Should show:</p>
<p>--set-import   </p>
Additional Context
<p><em>No response</em></p>
Debug Output
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by <a href="https://github.com/qknight">@qknight</a> on 2024-06-10 10:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-06-10 14:43</div>
            <div class="timeline-body"><p>I&#x27;m a bit confused by this issue.  Its not clear how the following argument:</p>
<pre><code>        .arg(
            Arg::new(&quot;set-import&quot;)
                .long(&quot;set-import&quot;)
                .help(&quot;Updates DLL bindings for &lt;from&gt; so it points to &lt;to&gt;&quot;)
                .num_args(3)
                .value_names([&quot;asdf&quot;]) // FIXME is printed 3 times in --help, why?!
                .required(false),
        )
</code></pre>
<p>is supposed to produce the following help output</p>
<pre><code>--set-import &lt;file&gt; &lt;from&gt; &lt;to&gt;
</code></pre>
<p>Either (or both)</p>
<ul>
<li>The example should be updated to match the expected output</li>
<li>The expected output should be updated for what is expected from the example</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-help</span> added by <a href="https://github.com/epage">@epage</a> on 2024-06-10 14:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/qknight">@qknight</a> on 2024-06-10 20:07</div>
            <div class="timeline-body"><p>@epage I don&#x27;t know how I could be more clear.</p>
<p>All I want is that the help page reads:</p>
<pre><code>(base) PS C:\Users\joschie\Desktop\Projects\fixPath\target\debug&gt; .\fixPath.exe --help
&gt;&gt;&gt; fixPath to modify FS locations of linked DLLs in an PE executable &lt;&lt;&lt;

Usage: fixPath.exe &lt;--version|--list-imports &lt;FILENAME&gt;|--set-import &lt;asdf&gt; &lt;asdf&gt; &lt;asdf&gt;&gt;

Options:
      --version                          Prints the version
      --list-imports &lt;file&gt;          Calls the list_imports function with a filename
      --set-import &lt;file&gt; &lt;from&gt; &lt;to&gt;  Updates &lt;file&gt; DLL bindings for &lt;from&gt; so it points to &lt;to&gt;
  -h, --help                             Print help
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-06-10 20:57</div>
            <div class="timeline-body"><p>Can you provide a reproduction example that attempts that?  As I said, the reproduction case in the issue does not.  <code>asdf</code> has nothign to do with <code>file</code>, <code>from</code>, or <code>to</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/qknight">@qknight</a> on 2024-06-10 21:13</div>
            <div class="timeline-body"><p>I think we are done here, thanks anyway.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/qknight">@qknight</a> on 2024-06-10 21:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/qknight">@qknight</a> on 2024-06-10 22:15</div>
            <div class="timeline-body"><p>For those who read this issue, my solution is now:</p>
<pre><code>        .arg(
            Arg::new(&quot;set-import&quot;)
                .long(&quot;set-import&quot;)
                .short(&#x27;s&#x27;)
                .help(&quot;Updates DLL &lt;file&gt; bindings for &lt;from&gt; so it points to &lt;to&gt;, ./fixPath test.exe foo.dll c:\\foo.dll&quot;)
                .value_name(&quot;arg&quot;)
                .num_args(3)
                .required(false),
        )
</code></pre>
<p>And the help is then:</p>
<pre><code>Usage: fixPath.exe &lt;--version|--list-imports &lt;arg&gt;|--set-import &lt;arg&gt; &lt;arg&gt; &lt;arg&gt;&gt;

Options:
      --version                       Prints the version
  -l, --list-imports &lt;arg&gt;            Lists DLL &lt;file&gt; the list_imports function with a filename
  -s, --set-import &lt;arg&gt; &lt;arg&gt; &lt;arg&gt;  Updates DLL &lt;file&gt; bindings for &lt;from&gt; so it points to &lt;to&gt;, ./fixPath test.exe foo.dll c:\foo.dll
  -h, --help                          Print help
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 20:00:11 UTC
    </footer>
</body>
</html>
