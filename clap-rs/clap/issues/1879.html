<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flag implies other flags - clap-rs/clap #1879</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Flag implies other flags</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/1879">#1879</a>
        opened by <a href="https://github.com/camsteffen">@camsteffen</a>
        on 2020-04-29 15:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/camsteffen">@camsteffen</a> on 2020-04-29 15:20</div>
            <div class="timeline-body"><h3>Make sure you completed the following tasks</h3>
<ul>
<li>[x] Searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[x] Searched the closed issues</li>
</ul>
<h3>Describe your use case</h3>
<p>I have an application that generates a bunch of files depending on several flags. I want to have a &quot;save-all&quot; flag that <strong>implies</strong> all of the more granular &quot;save-x&quot; flags. I'm surprised that I can't find any similar request through searching.</p>
<p>Here is an example: (simplified for this post)</p>
<pre><code class="language-rust">App::new(&quot;MyApp&quot;)
    .arg(Arg::with_name(&quot;save_all&quot;)
        .long(&quot;save-all&quot;)
// *** this is what I want to do *** //
        .implies_all(&amp;[&quot;save_image&quot;, &quot;save_stats&quot;, &quot;save_text&quot;]))
    .arg(Arg::with_name(&quot;save_image&quot;)
        .long(&quot;save-image&quot;))
    .arg(Arg::with_name(&quot;save_stats&quot;)
        .long(&quot;save-stats&quot;))
    .arg(Arg::with_name(&quot;save_text&quot;)
        .long(&quot;save-text&quot;))
</code></pre>
<h3>Describe the solution you'd like</h3>
<p>An <code>implies_all</code> option for <code>Arg</code> is what I'm interested in. But I would also add <code>implies</code> (singular) and <code>implied_by</code>. I believe this is similar to <code>default_value_if</code> except that it is for flags.</p>
<h3>Alternatives, if applicable</h3>
<p>I don't know of another convenient way to do this. Am I missing something?</p>
<p>Perhaps it should be named similarly to <code>default_value_*</code>? The <code>default_value_*</code> functions imply <code>takes_value</code>. Changing this is probably not an option. So it seems to me that the <code>default_value_*</code> space is too different. The word &quot;implies&quot; is intuitive to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by @camsteffen on 2020-04-29 15:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-29 15:33</div>
            <div class="timeline-body"><p>On master branch, you should be able to do this with the following:</p>
<pre><code class="language-rust">App::new(&quot;MyApp&quot;)
    .replace(&quot;--save-all&quot;, &amp;[&quot;--save-image&quot;, &quot;--save-stats&quot;, &quot;--save-text&quot;])
    .arg(Arg::with_name(&quot;save_all&quot;)
        .long(&quot;save-all&quot;))
    .arg(Arg::with_name(&quot;save_image&quot;)
        .long(&quot;save-image&quot;))
    .arg(Arg::with_name(&quot;save_stats&quot;)
        .long(&quot;save-stats&quot;))
    .arg(Arg::with_name(&quot;save_text&quot;)
        .long(&quot;save-text&quot;))
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2020-04-29 15:42</div>
            <div class="timeline-body"><p>@camsteffen once you can confirm the proposed solution works for you and meats your intent we can close the issue :smile:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/camsteffen">@camsteffen</a> on 2020-04-29 19:12</div>
            <div class="timeline-body"><p>Interesting, that might work. Just some minor concerns.</p>
<p>The example given in the <a href="https://github.com/clap-rs/clap/blame/5b9dbee5db540f44c336c2db54ece444624c30ef/src/build/app/mod.rs#L861-L877">docs</a> for <code>replace</code> is to create what I would call a &quot;subcommand alias&quot; where &quot;install&quot; is an alias for &quot;module install&quot;. For a &quot;subcommand alias&quot; I would expect it to only work when the alias is the <em>first</em> or <em>only</em> argument. But for my use case, &quot;save-all&quot; can appear anywhere in the arguments. This should be considered and documented better.</p>
<p>I would expect my use case to be possible at the <code>Arg</code> level instead of <code>App</code>, but oh well.</p>
<p>Ideally, I would like the <code>implies</code> functionality to show in the help text for that Arg. But again, this is less important.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2020-04-29 19:40</div>
            <div class="timeline-body"><p>@camsteffen we're in the process of going through all docs, so I'll make sure that one gets some additional explanation to make it clear that it's not just for subcommands. You can think of it literally replacing/inserting the left hand side item (<code>--save-all</code>) with all of the right hand side items (<code>--save-image --save-stats --save-text</code>)prior to parsing.</p>
<p>So the CLI invocation goes from:</p>
<pre><code>$ app --save-all

  # TO

$ app ---save-image --save-stats --save-text
</code></pre>
<p>You're correct it doesn't automatically add verbiage to the help message of <code>--save-all</code> that it sets the others, for now that is left up to the consumer to add.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/camsteffen">@camsteffen</a> on 2020-04-29 21:34</div>
            <div class="timeline-body"><p>@kbknapp Sounds good.</p>
<p>I'm still wondering about the example for <code>replace</code> though. Should <code>app module install</code> become <code>app module module install</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2020-04-30 01:17</div>
            <div class="timeline-body"><p><code>replace</code> is not an alias function. We will find a better way to word the example, but the example isn't creating an alias, it's creating a &quot;shortcut&quot; so to speak.</p>
<p>Imagine <code>app</code> has one subcommand <code>module</code>, and <code>app module</code> has a subcommand <code>install</code>. What the example is doing is creating a fake second subcommand of <code>app</code> called <code>install</code> which actually invokes the <code>app module install</code> subcommand. <code>rustup</code> does something similar, just without the <code>replace</code> functionality. While it's similar to an alias, aliases don't let you inject and thus invoke further into the CLI. Aliases only let you refer to a subcommand <em>on the same level</em> by a different name. For example, in our <code>app</code> example, if we gave the <code>module</code> subcommand and alias of <code>mod</code>, it would  mean both of these are functionally equivalent:</p>
<pre><code>$ app module install
$ app mod install
</code></pre>
<p>Likewise, if <em>instead of</em> <code>replace</code> we'd used an alias, and gave <code>module</code> an alias of <code>install</code>, the following would be functionally equivalent (although nonsensical):</p>
<pre><code>$ app module install
$ app install install
</code></pre>
<p>Hopefully this clears it up a little more.</p>
<p>I'm going to close this issue, but feel free to continue asking questions if you need more explanation :wink:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2020-04-30 01:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-30 02:51</div>
            <div class="timeline-body"><blockquote>
<p>Ideally, I would like the implies functionality to show in the help text for that Arg.</p>
</blockquote>
<blockquote>
<p>You're correct it doesn't automatically add verbiage to the help message of --save-all that it sets the others, for now that is left up to the consumer to add.</p>
</blockquote>
<p>That's true for for all the other conditions too. <code>requires*</code>, <code>conflicts*</code> similarly doesn't set any help text.</p>
<blockquote>
<p>replacing/inserting the left hand side item with all of the right hand side items prior to parsing.</p>
</blockquote>
<p>It does the replacing during parsing which allows to let it work only on certain apps (or subcommands)</p>
<p><code>app module install</code> would not change because replacer is checking for <code>install</code> on the <code>app</code> <code>App</code>. Here <code>install</code> appears at the <code>module</code> subcommand <code>App</code>.</p>
<p>I am actually using it like the below in one of the CLI tools I am working on.</p>
<pre><code class="language-rust">App::new(&quot;app&quot;)
    .replace(&quot;ll&quot;, &amp;[&quot;ls&quot;, &quot;-l&quot;])
    .replace(&quot;la&quot;, &amp;[&quot;ls&quot;, &quot;-a&quot;])
    .subcommand(App::new(&quot;ls&quot;)
        .arg(Arg::new(&quot;all&quot;).short('a'))
        .arg(Arg::new(&quot;long&quot;).short('l'))
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/camsteffen">@camsteffen</a> on 2020-04-30 13:51</div>
            <div class="timeline-body"><blockquote>
<p>That's true for for all the other conditions too. <code>requires*</code>, <code>conflicts*</code> similarly doesn't set any help text.</p>
</blockquote>
<p>Ok, makes sense.</p>
<blockquote>
<p><code>app module install</code> would not change because replacer is checking for <code>install</code> on the <code>app</code> <code>App</code>. Here <code>install</code> appears at the <code>module</code> subcommand <code>App</code>.</p>
</blockquote>
<p>Ah, that answers my question!</p>
<p>Ok, I'm happy with <code>replace</code> ðŸ˜ƒ. Will it be in a release soon?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2020-04-30 15:41</div>
            <div class="timeline-body"><blockquote>
<p>Will it be in a release soon?</p>
</blockquote>
<p>You can already use it via <a href="https://doc.rust-lang.org/cargo/reference/specifying-dependencies.html#specifying-dependencies-from-git-repositories">git dependency</a> in Cargo.toml</p>
<pre><code>[dependencies]
clap = { git = &quot;https://github.com/clap-rs/clap&quot; }
</code></pre>
<p>You can specify by branch or version (<code>replace</code> is in version <code>3.0.0-beta.1</code>). Once we finish up the 3.0 release, it will be uploaded to crates.io as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/camsteffen">@camsteffen</a> on 2020-04-30 16:10</div>
            <div class="timeline-body"><p>Alas, I finally tried it and it did not work as expected.</p>
<pre><code class="language-rust">let matches = clap::App::new(&quot;MyApp&quot;)
    .replace(&quot;--save-all&quot;, &amp;[&quot;--save-a&quot;, &quot;--save-b&quot;])
    .arg(Arg::with_name(&quot;flag&quot;).short('f'))
    .arg(Arg::with_name(&quot;save_all&quot;).long(&quot;save-all&quot;))
    .arg(Arg::with_name(&quot;save_a&quot;).long(&quot;save-a&quot;))
    .arg(Arg::with_name(&quot;save_b&quot;).long(&quot;save-b&quot;))
    .get_matches_from(&amp;[&quot;-f&quot;, &quot;--save-all&quot;]);
assert!(matches.is_present(&quot;flag&quot;)); // fails here
assert!(matches.is_present(&quot;save_a&quot;));
assert!(matches.is_present(&quot;save_b&quot;));
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2020-04-30 16:13</div>
            <div class="timeline-body"><p>You're missing the binary name. It should be:</p>
<pre><code class="language-rust">    .get_matches_from(&amp;[&quot;myapp&quot;, &quot;-f&quot;, &quot;--save-all&quot;]);
</code></pre>
<p>If you don't want to include a binary name you must use <a href="https://docs.rs/clap/2.33.0/clap/enum.AppSettings.html#variant.NoBinaryName"><code>AppSettings::NoBinaryName</code></a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/camsteffen">@camsteffen</a> on 2020-04-30 16:40</div>
            <div class="timeline-body"><p>ðŸ¤¦</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:32 UTC
    </footer>
</body>
</html>
