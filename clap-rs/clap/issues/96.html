<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>clap-rs 0.7.1: dynamic usage strings seem 'inverted' - clap-rs/clap #96</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>clap-rs 0.7.1: dynamic usage strings seem 'inverted'</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/96">#96</a>
        opened by <a href="https://github.com/Byron">@Byron</a>
        on 2015-05-02 07:20
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Byron">@Byron</a></div>
            <div class="timeline-body"><p>With a program exhibiting the following grammar ...</p>
<pre><code class="language-Bash">$ groupsmigration1 archive insert --help`
groupsmigration1-archive-insert
Inserts a new mail into the archive of the Google group.

USAGE:
    groupsmigration1 archive insert &lt;group-id&gt;  [FLAGS] [OPTIONS] [ -u &lt;mode&gt; &lt;file&gt; ]

FLAGS:
    -h, --help       Prints help information
    -v, --version    Prints version information

OPTIONS:
    -m &lt;mime&gt;          The file's mime time, like 'application/octet-stream'
    -u &lt;mode&gt; &lt;file&gt;        Specify the upload protocol (simple|resumable) and the file to upload
    -o &lt;out&gt;           Specify the file into which to write the programs output
    -p &lt;v&gt;...          Set various fields of the request structure

POSITIONAL ARGUMENTS:
    group-id    The group ID
</code></pre>
<p>... I would expect a partial invocation like <code>groupsmigration1 archive insert</code> to yield a usage more along the lines of ...</p>
<pre><code class="language-bash">One or more required arguments were not supplied: &lt;group-id&gt;, '-u &lt;mode&gt; &lt;file&gt;'
USAGE:
    groupsmigration1 archive insert &lt;group-id&gt; -u &lt;mode&gt; &lt;file&gt;
For more information try --help
</code></pre>
<p>... but what you get is just as follows:</p>
<pre><code class="language-bash">One or more required arguments were not supplied
USAGE:
    groupsmigration1 archive insert
For more information try --help
</code></pre>
<p>Another example for missing required parameters is <code>groupsmigration1 archive insert -u simple README.md</code> where <code>&lt;group-id&gt;</code> is missing. However, this is not actually said in the resulting usage text:</p>
<pre><code class="language-bash">$ groupsmigration1 archive insert -u simple README.md
One or more required arguments were not supplied
USAGE:
    groupsmigration1 archive insert    [ -u &lt;mode&gt; &lt;file&gt; ]
For more information try --help
</code></pre>
<p>What I would expect here is something like this:</p>
<pre><code class="language-bash">One or more required arguments were not supplied: &lt;group-id&gt;
USAGE:
    groupsmigration1 archive insert &lt;group-id&gt; -u simple README.md
For more information try --help
</code></pre>
<p>In a call like <code>groupsmigration1 archive insert group</code> one will see a usage string like this:</p>
<pre><code class="language-bash">One or more required arguments were not supplied
USAGE:
    groupsmigration1 archive insert  &lt;group-id&gt;
For more information try --help
</code></pre>
<p>and I think think it would be much better to get something like that:</p>
<pre><code class="language-bash">One or more required arguments were not supplied: -u &lt;mode&gt; &lt;file&gt;
USAGE:
    groupsmigration1 archive insert group -u &lt;mode&gt; &lt;file&gt;
For more information try --help
</code></pre>
<p>Once the usage is improved, <code>clap</code> will finally be top-of-the-line when it comes to usability I think, and I really want it to be there :).
Thanks for taking care.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../Byron/google-apis-rs/issues/92.html">Byron/google-apis-rs#92</a> on 2015-05-02 07:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/88.html">clap-rs/clap#88</a> on 2015-05-02 07:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2015-05-02 15:27</div>
            <div class="timeline-body"><p>Thanks for the detailed report! I agree, as I was thinking about this last night, it should state which arguments were missing such as your last:</p>
<pre><code>One or more required arguments were not supplied: -u &lt;mode&gt; &lt;file&gt;
USAGE:
    groupsmigration1 archive insert group -u &lt;mode&gt; &lt;file&gt;
For more information try --help
</code></pre>
<p>This should be a decently simple change. I'll start working on this today.</p>
<p>Also, as for why <code>&lt;group-id&gt;</code> is getting dropped from the requirements list, this could be a bug. Could you show me where the argument definitions for the <code>insert</code> subcommand are located?</p>
<p>One last kind of side note, the <code>[</code> and <code>]</code> around the <code>-u &lt;mode&gt; &lt;file&gt;</code> I'm on the fence about if I should take them out or not (for the usage string only, not for the new &quot;missing required&quot; error message). I was originally worried that if I user saw:</p>
<pre><code>groupsmigration1 archive insert &lt;group-id&gt; -u &lt;mode&gt; &lt;file&gt;
</code></pre>
<p>They may mistakenly think <code>&lt;file&gt;</code> is not part of <code>-u</code> until they see the full help message. If a program had more than one positional argument, and some of which were optional, they could mistakenly do something like</p>
<pre><code>groupsmigration1 archive insert &lt;group-id&gt; &lt;file&gt; -u &lt;mode&gt; &lt;some_other_positional&gt;
</code></pre>
<p>I'll post back here once I've got fixes!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @kbknapp on 2015-05-02 15:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2015-05-02 16:39</div>
            <div class="timeline-body"><p>I was able to reproduce the bug with this snippet, but if you have a link to your source I'd still like to see that to see how exactly your requirements are set up so I don't fix the bug in my test case, but not in your real case.</p>
<pre><code class="language-rust">let u_names = [&quot;mode&quot;, &quot;file&quot;];
let matches = App::new(&quot;MyApp&quot;)
                    .arg(Arg::from_usage(&quot;-f [f]... 'some value'&quot;)
                              .value_names(&amp;u_names)
                              .required(true))
                    .arg(Arg::from_usage(&quot;&lt;gid&gt; 'other value'&quot;))
                    .get_matches();
</code></pre>
<p>Which produces grammarr:</p>
<pre><code class="language-sh">fake 

USAGE:
    fake &lt;gid&gt;  [FLAGS] [ -f &lt;mode&gt; &lt;file&gt; ] 

FLAGS:
    -h, --help       Prints help information
    -v, --version    Prints version information

OPTIONS:
    -f &lt;mode&gt; &lt;file&gt;        some value

POSITIONAL ARGUMENTS:
    gid    other value
</code></pre>
<p>And when run with incomplete <code>$ fake</code>:</p>
<pre><code class="language-sh">One or more required arguments were not supplied
USAGE:
    fake    
For more information try --help
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2015-05-03 04:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2015-05-03 04:47</div>
            <div class="timeline-body"><p>Take a look at the latest version (0.7.2 on crates.io) or master here and let me know if that works for you. It now tells you exactly which arguments you're missing (if any), along some visual clean up (spaces between arguments). I still need to fix the tab alignment in the help info, but I may wait on that as it's minor right now.</p>
<p>Also, the requirements all should be working, i.e. you can make an argument required by default, and if it requires other arguments, those arguments will be listed in the default usage string as well...kind of &quot;required by proxy&quot;</p>
<p>One other visual thing I changed was the <code>[</code> and <code>]</code> around arguments with named values, those have been removed because with the new requirements error messages it's quite explicit about what belongs with what. And the square brackets make an argument look &quot;optional&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Byron">@Byron</a> on 2015-05-05 07:09</div>
            <div class="timeline-body"><p>I finally got around to testing the modifications (with v0.7.5 actually), and must say that the help and usage strings now seems perfect. I'd have nothing to add here, except for saying thanks !</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:46:19 UTC
    </footer>
</body>
</html>
