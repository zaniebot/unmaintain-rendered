<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panic for std::os::unix::ffi::OsStrExt on windows - clap-rs/clap #948</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Panic for std::os::unix::ffi::OsStrExt on windows</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/948">#948</a>
        opened by <a href="https://github.com/Dragonrun1">@Dragonrun1</a>
        on 2017-05-07 15:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Dragonrun1">@Dragonrun1</a> on 2017-05-07 15:53</div>
            <div class="timeline-body"><h3>Rust Version</h3>
<p>rustc 1.19.0-nightly (06fb4d256 2017-04-30)</p>
<h3>Affected Version of clap</h3>
<p>clap-2.23.3</p>
<h3>Expected Behavior Summary</h3>
<p>Not panic with using my '-n' option.</p>
<h3>Actual Behavior Summary</h3>
<p>thread 'main' panicked at 'Fatal internal error. Please consider filing a bug repor
t at https://github.com/kbknapp/clap-rs/issues', src\libcore\option.rs:794
stack backtrace:
0: std::sys_common::backtrace::_print
1: std::panicking::default_hook::{{closure}}
2: std::panicking::default_hook
3: std::panicking::rust_panic_with_hook
4: std::panicking::begin_panic
5: std::panicking::begin_panic_fmt
6: rust_begin_unwind
7: core::panicking::panic_fmt
8: core::option::expect_failed
9: &lt;core::option::Option<T>&gt;::expect
at C:\projects\rust\src\libcore/option.rs:297
10: clap::app::parser::Parser::parse_short_arg
at C:\Users\Dragonaire.cargo\registry\src\github.com-1ecc6299db9ec823
\clap-2.23.3\src\app/parser.rs:1438
11: clap::app::parser::Parser::get_matches_with
at C:\Users\Dragonaire.cargo\registry\src\github.com-1ecc6299db9ec823
\clap-2.23.3\src\app/parser.rs:829
12: clap::app::App::get_matches_from_safe_borrow
at C:\Users\Dragonaire.cargo\registry\src\github.com-1ecc6299db9ec823
\clap-2.23.3\src\app/mod.rs:1615
13: clap::app::App::get_matches_from
at C:\Users\Dragonaire.cargo\registry\src\github.com-1ecc6299db9ec823
\clap-2.23.3\src\app/mod.rs:1500
14: clap::app::App::get_matches
at C:\Users\Dragonaire.cargo\registry\src\github.com-1ecc6299db9ec823
\clap-2.23.3\src\app/mod.rs:1443
15: rhp_cli::main
at src/rhp-cli.rs:35
16: _rust_maybe_catch_panic
17: std::rt::lang_start
18: main
19: _tmainCRTStartup
20: mainCRTStartup
21: unit_addrs_search
error: process didn't exit successfully: <code>target\debug\rhp-cli.exe -n -f junk.php</code>
(exit code: 101)</p>
<h3>Steps to Reproduce the issue</h3>
<p>cargo run --bin rhp-cli -- -n -f junk.php</p>
<p>Only seems to do it with my '-n' option and none of the others so far.</p>
<h3>Sample Code or Link to Sample Code</h3>
<p>https://pastebin.com/PEBzYxmP</p>
<h3>Debug output</h3>
<p>Compile clap with cargo features <code>&quot;debug&quot;</code> such as:</p>
<p>Compiling clap v2.23.3
Compiling rhp v0.0.1 (file:///C:/repos/local/rustyhp)
error[E0432]: unresolved import <code>std::os::unix::ffi::OsStrExt</code>
--&gt; C:\Users\Dragonaire.cargo\registry\src\github.com-1ecc6299db9ec823\clap-2.23.
3\src\app\parser.rs:7:5
|
7 | use std::os::unix::ffi::OsStrExt;
|     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ Could not find <code>unix</code> in <code>os</code></p>
<p>error: no method named <code>as_bytes</code> found for type <code>std::ffi::OsString</code> in the curren
t scope
--&gt; C:\Users\Dragonaire.cargo\registry\src\github.com-1ecc6299db9ec823\clap-2.2
3.3\src\app\parser.rs:780:31
|
780 |                      &amp;*arg_os.as_bytes());
|                               ^^^^^^^^
|
= help: items from traits can only be used if the trait is in scope; the follow
ing trait is implemented but not in scope, perhaps add a <code>use</code> for it:
= help: candidate #1: <code>use osstringext::OsStrExt3;</code></p>
<p>error: no method named <code>as_bytes</code> found for type <code>&amp;std::ffi::OsStr</code> in the current
scope
--&gt; C:\Users\Dragonaire.cargo\registry\src\github.com-1ecc6299db9ec823\clap-2.
23.3\src\app\parser.rs:1412:51
|
1412 |                              arg_os.split_at(i).1.as_bytes(),
|                                                   ^^^^^^^^
|
= help: items from traits can only be used if the trait is in scope; the follo
wing trait is implemented but not in scope, perhaps add a <code>use</code> for it:
= help: candidate #1: <code>use osstringext::OsStrExt3;</code></p>
<p>error: aborting due to 2 previous errors</p>
<p>error: Could not compile <code>clap</code>.</p>
<p>To learn more, run the command again with --verbose.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Dragonrun1">@Dragonrun1</a> on 2017-05-07 17:09</div>
            <div class="timeline-body"><p>Just updated to the latest Rust nightly and clap v2.24.1 still has same issue. After some more testing it does seem to only happen with the '-n' option.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-05-07 19:39</div>
            <div class="timeline-body"><p>Thanks for filing! I'll look into this and should have it fixed shortly.</p>
<p>Also, side note, you can use <a href="https://docs.rs/clap/2.24.1/clap/enum.AppSettings.html#variant.DeriveDisplayOrder"><code>AppSettings::DeriveDisplayOrder</code></a> instead of manually doing <code>Arg::display_order</code> for each arg.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-05-07 19:49</div>
            <div class="timeline-body"><p>Alright, so this might be a double issue. The first the issue is your <code>-n</code> defines <code>overrides_with(&quot;config&quot;)</code> (line 105) but there is no arg named <code>config</code>.</p>
<p>By adding an arg named <code>config</code> does this fix the issue for you?</p>
<p>The debug compilation issue may be a different issue and I'll have to test it on my windows box when I get a chance.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> added by @kbknapp on 2017-05-07 19:49</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Dragonrun1">@Dragonrun1</a> on 2017-05-08 17:09</div>
            <div class="timeline-body"><p>Your right about the name I forgot I'd changed it above but what I've noticed is even without the override line it seems to just not like '-n' for some reason but I'll fix my oops and see if it helps.</p>
<p>Edit: Fixing my typo solved my problem still interesting that the debug came up with the other error. I really should have noticed I'd missed renaming it every where. Might be worth looking at improving things so it offers hint in panic message that it couldn't find the option would have save us both a little time ;) but not found the other interesting stuff so guess not so bad in the end :D</p>
<p>Edit 2: Thanks for the tip on DeriveDisplayOrder I'm still playing around with how I want stuff to look and that should make it easier. I actually like the simple alphabetical way with the grouping myself but I may decided to go with an order that looks more like the original help they used as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2017-11-06 03:42</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:31 UTC
    </footer>
</body>
</html>
