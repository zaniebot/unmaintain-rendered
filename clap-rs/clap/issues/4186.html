<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support externally supplying a terminal width when running outside a tty - clap-rs/clap #4186</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Support externally supplying a terminal width when running outside a tty</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/4186">#4186</a>
        opened by <a href="https://github.com/Nemo157">@Nemo157</a>
        on 2022-09-06 21:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Nemo157">@Nemo157</a> on 2022-09-06 21:31</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>v3.2.20</p>
<h3>Describe your use case</h3>
<p>I am attempting to verify my readme contains the latest version of the help text from my utility. To do so I need an appropriately widthed help text to compare against (and auto-update from).</p>
<h3>Describe the solution you'd like</h3>
<p>I'm not sure what the best interface for this would be. One thought I had was to obey the <code>COLUMNS</code> variable if that is set and the output is not a tty, that would make <code>text=&quot;$(COLUMNS=60 cargo run -- --help)&quot;</code> work fine.</p>
<h3>Alternatives, if applicable</h3>
<p>Locally I found a way to get a sub-tty with a limited width</p>
<pre><code class="language-sh">script -q -c 'sh -c &quot;stty cols 60 &amp;&amp; cargo run -q -- --help&quot;' $(mktemp)
</code></pre>
<p>but unfortunately that doesn't work in GitHub Actions for some unknown reason.</p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @Nemo157 on 2022-09-06 21:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-09-06 21:43</div>
            <div class="timeline-body"><p>Already <a href="https://docs.rs/terminal_size/latest/terminal_size/fn.terminal_size.html">terminal_size</a> doesn't do detection if STDOUT is not a tty:</p>
<blockquote>
<p>Another option is to not use If STDOUT is not a tty, returns <code>None</code></p>
</blockquote>
<p>Is that sufficient or something going wrong with it?  Or are you wanting a different fallback terminal width?</p>
<p>Also, as a workaround, you can implement this all yourself by calling <code>terminal_size</code> directly and setting <code>term_width</code> under the specific circumstances for your app.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Nemo157">@Nemo157</a> on 2022-09-06 22:01</div>
            <div class="timeline-body"><blockquote>
<p>Or are you wanting a different fallback terminal width?</p>
</blockquote>
<p>Yes, this; I want to override the fallback terminal width in my script to have a consistent width no matter what terminal I'm running under.</p>
<blockquote>
<p>Also, as a workaround, you can implement this all yourself</p>
</blockquote>
<p>Yep, it doesn't seem <em>too</em> hard (just misses out on a lot of the <code>Parser</code> nicities to be able to override the derive). I just feel like it's pretty common to include <code>--help</code> output into a readme, where the default 100 column fallback is far too wide, so surely there must be other people running into this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-09-12 12:33</div>
            <div class="timeline-body"><blockquote>
<p>Yes, this; I want to override the fallback terminal width in my script to have a consistent width no matter what terminal I'm running under.</p>
</blockquote>
<p>In my initial research on this, it sounded like <code>COLUMNS</code> isn't actually env-variable but is instead something built directly into some shells that some users forward on to the environment and that application support is very half-hazard.  This made me less interested in supporting it.</p>
<p>Then I saw it suggested in https://clig.dev and saw it used in git which makes me feel more comfortable in supporting it.</p>
<p>The question is what should the level of precedence be?</p>
<ol>
<li>COLUMNS</li>
<li>`terminal_size``</li>
<li>default</li>
</ol>
<p>or</p>
<ol>
<li>`terminal_size``</li>
<li>COLUMNS</li>
<li>default</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-09-12 12:33</div>
            <div class="timeline-body"><p>Also, I feel safer putting this into clap v4 rather than clap v3 (if we make the release window)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4208.html">clap-rs/clap#4208</a> on 2022-09-13 01:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2022-09-13 02:18</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:34 UTC
    </footer>
</body>
</html>
