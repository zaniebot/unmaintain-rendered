<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`unused_qualifications` complains - clap-rs/clap #4951</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>unused_qualifications</code> complains</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/4951">#4951</a>
        opened by <a href="https://github.com/tyranron">@tyranron</a>
        on 2023-06-05 15:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tyranron">@tyranron</a></div>
            <div class="timeline-body">Please complete the following tasks
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
Rust Version
<p>rustc 1.70.0 (90c541806 2023-05-31)</p>
Clap Version
<p>4.3.1</p>
Minimal reproducible code
<pre><code>#![deny(unused_qualifications)]

use clap::Args;

#[derive(Args, Clone, Copy, Debug, Default)]
#[group(skip)]
pub struct Compose&lt;L: Args&gt; {
    #[command(flatten)]
    pub left: L,
}

fn main() {} 
</code></pre>
<p><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=fa1c15f5e1652d03974294c7bb6c9ecd">Playground</a></p>
Steps to reproduce the bug with the above code
<p>cargo check</p>
Actual Behaviour
<pre><code>error: unnecessary qualification
 --&gt; src/main.rs:8:15
  |
8 |     #[command(flatten)]
  |               ^^^^^^^
  |
note: the lint level is defined here
 --&gt; src/main.rs:1:9
  |
1 | #![deny(unused_qualifications)]
  |         ^^^^^^^^^^^^^^^^^^^^^
</code></pre>
Expected Behaviour
<p>Compiles OK.</p>
Additional Context
<p>Appears starting from 1.70 Rust. On 1.69 Rust everything is OK.</p>
Debug Output
<p>If we run <code>cargo expand</code> on <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=fa1c15f5e1652d03974294c7bb6c9ecd">Playground</a>, we would see the expansion like this:</p>
<pre><code>#[allow(dead_code, unreachable_code, unused_variables, unused_braces)]
#[allow(clippy :: style, clippy :: complexity, clippy :: pedantic, clippy ::
restriction, clippy :: perf, clippy :: deprecated, clippy :: nursery, clippy
:: cargo, clippy :: suspicious_else_formatting, clippy :: almost_swapped,)]
impl&lt;L: Args&gt; clap::FromArgMatches for Compose&lt;L&gt; {
    // etc...
}
</code></pre>
<p>It seems, that starting from 1.70 Rust, the <code>unused_qualifications</code> became more clever and covers more code paths than it had done before. I wonder why the <a href="https://stackoverflow.com/questions/51481551/what-does-automatically-derived-mean"><code>#[automatically_derived]</code> attribute</a> is not used in the macro expansions, which is used to handle most of such situations (modulo lint bugs)?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by <a href="https://github.com/tyranron">@tyranron</a> on 2023-06-05 15:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-06-05 17:12</div>
            <div class="timeline-body"><p>Never heard of <code>#[automatically_derived]</code> before.  In Veykril/tlborm#93, I suggested it gets covered in the Little Book of Macros.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#4952</a> on 2023-06-05 17:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/epage">@epage</a> on 2023-06-05 18:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>enso-org/enso#7109</a> on 2023-06-22 12:31</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:59:47 UTC
    </footer>
</body>
</html>
