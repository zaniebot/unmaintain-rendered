<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incorrect default value behavior with require_equals and min_values(0) - clap-rs/clap #1047</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Incorrect default value behavior with require_equals and min_values(0)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1047">#1047</a>
        opened by <a href="https://github.com/jonhoo">@jonhoo</a>
        on 2017-09-14 15:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/jonhoo">@jonhoo</a> on 2017-09-14 15:01</div>
            <div class="timeline-body"><h3>Rust Version</h3>
<p>rustc 1.22.0-nightly (ddd123ed9 2017-09-09)</p>
<h3>Affected Version of clap</h3>
<p>2.26.1</p>
<h3>Expected Behavior Summary</h3>
<p>When a <code>require_equals</code> + <code>min_values(0)</code> argument is given on the command line without a value, the default value should be set as its value in matches.</p>
<h3>Actual Behavior Summary</h3>
<p>If the argument is given without a value, <code>occurs</code> is 1, but <code>vals</code> is <code>[]</code>.</p>
<h3>Steps to Reproduce the issue</h3>
<p>Using the code below, try the following command lines:</p>
<pre><code class="language-console">$ foo
occurs: 0
value: Some(&quot;,&quot;)
$ foo -d=@
occurs: 1
value: Some(&quot;@&quot;)
$ foo -d
occurs: 1
value: None
</code></pre>
<p>Notice that in the last case, <code>value</code> should be <code>Some(&quot;,&quot;)</code>.</p>
<h3>Sample Code or Link to Sample Code</h3>
<pre><code class="language-rust">extern crate clap;

use clap::{App, Arg};
fn main() {
    let m = App::new(&quot;foo&quot;)
        .arg(
            Arg::with_name(&quot;delimiter&quot;)
                .short(&quot;d&quot;)
                .long(&quot;delimiter&quot;)
                .takes_value(true)
                .require_equals(true)
                .min_values(0)
                .default_value(&quot;,&quot;),
        )
        .get_matches();
    println!(&quot;occurs: {}&quot;, m.occurrences_of(&quot;delimiter&quot;));
    println!(&quot;value: {:?}&quot;, m.value_of(&quot;delimiter&quot;));
}
</code></pre>
<h3>Debug output</h3>
<p>For the <code>-d</code> case:</p>
<pre><code class="language-console">DEBUG:clap:Parser::propogate_settings: self=time, g_settings=AppFlags(
    NEEDS_LONG_HELP | NEEDS_LONG_VERSION | NEEDS_SC_HELP | UTF8_NONE | COLOR_AUTO
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:Parser::get_matches_with: Begin parsing '&quot;-d&quot;' ([45, 100])
DEBUG:clap:Parser::is_new_arg: arg=&quot;-d&quot;, Needs Val of=NotFound
DEBUG:clap:Parser::is_new_arg: Arg::allow_leading_hyphen(false)
DEBUG:clap:Parser::is_new_arg: - found
DEBUG:clap:Parser::is_new_arg: starts_new_arg=true
DEBUG:clap:Parser::possible_subcommand: arg=&quot;-d&quot;
DEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None
DEBUG:clap:Parser::parse_short_arg: full_arg=&quot;-d&quot;
DEBUG:clap:Parser::parse_short_arg:iter:d
DEBUG:clap:Parser::parse_short_arg:iter:d: Found valid opt
DEBUG:clap:Parser::parse_short_arg:iter:d: p[0]=[], p[1]=[]
DEBUG:clap:Parser::parse_opt; opt=delimiter, val=None
DEBUG:clap:Parser::parse_opt; opt.settings=ArgFlags(TAKES_VAL | DELIM_NOT_SET | REQUIRE_EQUALS)
DEBUG:clap:Parser::parse_opt; Checking for val...None
DEBUG:clap:ArgMatcher::inc_occurrence_of: arg=delimiter
DEBUG:clap:ArgMatcher::inc_occurrence_of: first instance
DEBUG:clap:Parser::groups_for_arg: name=delimiter
DEBUG:clap:Parser::groups_for_arg: No groups defined
DEBUG:clap:Parser::parse_opt: More arg vals not required...
DEBUG:clap:arg_post_processing!;
DEBUG:clap:OptBuilder::fmt:delimiter
DEBUG:clap:arg_post_processing!: Is '--delimiter=&lt;delimiter&gt;' in overrides...No
DEBUG:clap:OptBuilder::fmt:delimiter
DEBUG:clap:arg_post_processing!: Does '--delimiter=&lt;delimiter&gt;' have overrides...No
DEBUG:clap:OptBuilder::fmt:delimiter
DEBUG:clap:arg_post_processing!: Does '--delimiter=&lt;delimiter&gt;' have conflicts...No
DEBUG:clap:OptBuilder::fmt:delimiter
DEBUG:clap:arg_post_processing!: Does '--delimiter=&lt;delimiter&gt;' have requirements...No
DEBUG:clap:_handle_group_reqs!;
DEBUG:clap:Parser:get_matches_with: After parse_short_arg ValuesDone
DEBUG:clap:Validator::validate;
DEBUG:clap:Validator::validate_blacklist: blacklist=[]
DEBUG:clap:Validator::validate_required: required=[];
DEBUG:clap:Validator::validate_matched_args;
DEBUG:clap:Validator::validate_matched_args:iter:delimiter: vals=[]
DEBUG:clap:Validator::validate_arg_num_vals;
DEBUG:clap:Validator::validate_arg_num_vals: min_vals set: 0
DEBUG:clap:Validator::validate_values: arg=&quot;delimiter&quot;
DEBUG:clap:Validator::validate_arg_requires;
DEBUG:clap:Validator::validate_arg_num_occurs: a=delimiter;
DEBUG:clap:usage::create_usage_with_title;
DEBUG:clap:usage::create_usage_no_title;
DEBUG:clap:usage::get_required_usage_from: reqs=[], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:usage::needs_flags_tag;
DEBUG:clap:usage::needs_flags_tag:iter: f=hclap_help;
DEBUG:clap:usage::needs_flags_tag:iter: f=vclap_version;
DEBUG:clap:usage::needs_flags_tag: [FLAGS] not required
DEBUG:clap:usage::create_help_usage: usage=x [OPTIONS]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: options</span> added by @kbknapp on 2017-09-14 15:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: parsing</span> added by @kbknapp on 2017-09-14 15:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by @kbknapp on 2017-09-14 15:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> added by @kbknapp on 2017-09-14 15:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @kbknapp on 2017-09-14 15:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @kbknapp on 2017-09-14 15:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jonhoo">@jonhoo</a> on 2017-09-14 15:03</div>
            <div class="timeline-body"><p>And because @kbknapp raised it during discussion: adding another dummy argument and passing it after <code>-d</code> (as in <code>-d -x</code>) does not change this outcome.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1037.html">clap-rs/clap#1037</a> on 2017-09-14 17:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2017-09-15 18:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2172.html">clap-rs/clap#2172</a> on 2020-10-14 07:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:38 UTC
    </footer>
</body>
</html>
