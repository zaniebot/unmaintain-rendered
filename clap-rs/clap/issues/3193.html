<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Next-line help is always used despite no long-help being shown (despite `long_about` being set on a subcommand) - clap-rs/clap #3193</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Next-line help is always used despite no long-help being shown (despite <code>long_about</code> being set on a subcommand)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/3193">#3193</a>
        opened by <a href="https://github.com/epage">@epage</a>
        on 2021-12-17 02:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a></div>
            <div class="timeline-body">Discussed in https://github.com/clap-rs/clap/discussions/3178
clap version
<p><code>master</code></p>
rust version
<p><code>rustc 1.59.0-nightly (404c8471a 2021-12-14)</code></p>
Minimal Reproducible Code
<pre><code>use clap::StructOpt;

#[derive(StructOpt, Debug)]
pub struct Opts {
    #[structopt(subcommand)]
    pub subcmd: SubCommand,
}

#[derive(StructOpt, Debug)]
pub struct SampleSubcmd {
    testopt: Option&lt;String&gt;,
}

#[derive(StructOpt, Debug)]
pub enum SubCommand {
    /// With just this line everything renders normally
    ///
    /// THIS NEW PARAGRAPH CHANGES FORMATTING
    Subcmd(SampleSubcmd),
}

fn main() {
    let _opts = Opts::from_args();
}
</code></pre>
Reproduction steps
<pre><code>$ cargo run -- --help
</code></pre>
Expected Behavior
<pre><code>test-clap 0.1.0

USAGE:
    test-clap &lt;SUBCOMMAND&gt;

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

SUBCOMMANDS:
    help      Prints this message or the help of the given subcommand(s)
    subcmd    With just this line everything renders normally
</code></pre>
Actual Behavior
<pre><code>test-clap 

USAGE:
    test-clap &lt;SUBCOMMAND&gt;

OPTIONS:
    -h, --help
            Print help information

SUBCOMMANDS:
    help
            Print this message or the help of the given subcommand(s)
    subcmd
            With just this line everything renders normally
</code></pre>
Context
<p>clap2 shows args on next line but not subcommands.</p>
<p>Note that <code>long_about</code> is being set but isn&#x27;t being shown.</p>
<p>Looks like this is a bug in clap3.</p>
<p>This has levels of fixes</p>
<ol>
<li>Ignore <code>next_line_help</code> for subcommands to get to clap2&#x27;s behavior</li>
<li>Ignore subcommands when calculating whether to use <code>next_line_help</code> since short help has precedence over long help (fixes the issue reported here)</li>
<li>Actually respect short vs long with subcommands and show &quot;THIS NEW PARAGRAPH CHANGES FORMATTING&quot; (I worry there is a reason this wasn&#x27;t done that is eluding me)</li>
</ol>
<p>The next part to consider is whether</p>
<ul>
<li>args and subcommands should infer <code>next_line_help</code> separately</li>
<li>whether we should stop doing global <code>next_line_help</code> inferring and leave it to the individual args</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by <a href="https://github.com/epage">@epage</a> on 2021-12-17 02:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-decision</span> added by <a href="https://github.com/epage">@epage</a> on 2021-12-17 02:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-help</span> added by <a href="https://github.com/epage">@epage</a> on 2021-12-17 02:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-17 02:10</div>
            <div class="timeline-body"><p>@pksunkara wanted to check in in case you had any extra context on</p>
<ul>
<li>why subcommands give precedence to <code>about</code> on <code>--help</code>, unlike args</li>
<li>why <code>next_line_help</code> is being used by subcommands even if we don&#x27;t show <code>long_about</code></li>
</ul>
<p>If curious, you can see my <a href="https://github.com/clap-rs/clap/discussions/3178#discussioncomment-1830573">comment in the discussion</a> for what this looks like in clap2 and clap3 with and without <code>long_about</code> being set (<code>about</code> is always set)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;3.0&quot; by <a href="https://github.com/epage">@epage</a> on 2021-12-17 02:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Always newline when long_about is set - feature or bug?&quot; to &quot;Next-line help is always used despite no long-help being shown (despite `long_about` being set on a subcommand)&quot; by <a href="https://github.com/epage">@epage</a> on 2021-12-17 02:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-17 02:44</div>
            <div class="timeline-body"><p>I guess the reason to unconditionally give precedence to <code>about</code> over <code>long_about</code> in <code>--help</code> is that the subcommands are just giving you a hint of the help and its expected that you then call <code>--help</code> on that subcommand.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#3196</a> on 2021-12-17 15:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/epage">@epage</a> on 2021-12-17 15:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#3215</a> on 2021-12-24 18:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>clap-rs/clap#3232</a> on 2021-12-30 18:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>informalsystems/hermes#2275</a> on 2022-06-28 09:49</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:58:38 UTC
    </footer>
</body>
</html>
