<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reduce compilation time - clap-rs/clap #2037</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Reduce compilation time</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/2037">#2037</a>
        opened by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a>
        on 2020-07-28 11:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/CreepySkeleton">@CreepySkeleton</a></div>
            <div class="timeline-body"><p><a href="https://gistpreview.github.io/?8ee8a91bfe081221672908eb57fcf723">All features</a>
<a href="https://gistpreview.github.io/?2e3e54008f987749cd1cbf31f8f1f0e9">No features</a></p>
<p>The <code>clap</code> crate (not counting dependencies) takes about 11 seconds to compile. All dependencies put together take roughly the same amount of time.</p>
<p>I have a few thoughts on how to improve the situation. Generally, compile time wins these days are accomplished through &quot;compile less code&quot;, hence:</p>
<ul>
<li>[ ] Feature-gate <code>#[derive(Clone, Copy, Eq...]</code>. The features should probably be fine-grained, like <code>impl-traits-eq</code> enables <code>Eq + PartialEq</code>. Plus the &quot;enable everything&quot; <code>impl-traits</code> feature that implies all the traits.<ul>
<li>[ ] Avoid using derives and use some sort of <code>STRUCT!</code> macro as shown <a href="https://github.com/retep998/winapi-rs/issues/218#issuecomment-145988469">here</a>. It turns out that even built-in derives have impact on compilation time when you have lots of them, and <em>every</em> struct here has <code>#[derive(Debug)]</code>.</li>
</ul>
</li>
<li>[x] Optimize <code>proc-macro-error</code> (drop <code>syn-mid</code> dep). I had already done that but decided to play around a bit more and then forgot about it. Oops.</li>
<li>[ ] Make clap modular so developers could choose exactly the set of features they need and avoid compile the others. I'll crate a separate issue a bit later.</li>
</ul>
<p>The list is probably not exhaustive...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> added by @CreepySkeleton on 2020-07-28 11:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: meta</span> added by @CreepySkeleton on 2020-07-28 11:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: other</span> added by @CreepySkeleton on 2020-07-28 11:47</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/2038.html">clap-rs/clap#2038</a> on 2020-07-29 02:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mainrs">@mainrs</a> on 2020-07-30 11:31</div>
            <div class="timeline-body"><p>Hey!
If you want I can tackle down the trait implementation features :) How fine-grained do you want it to be though?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-07-31 12:24</div>
            <div class="timeline-body"><p>Sure, you can try, but keep in mind that the real goal is to reduce compilation time. If the measurements will show no real difference (at least half second, everything below the threshold is noise), I will say &quot;well we tried&quot; and move on to other ideas.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mainrs">@mainrs</a> on 2020-07-31 13:35</div>
            <div class="timeline-body"><p>Sure thing! Could you tell me how to managed to time the compilation? And create the visuals for it as well :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-07-31 14:23</div>
            <div class="timeline-body"><p>The invocation was</p>
<pre><code class="language-sh">cargo clean # make sure the we build from scratch
cargo +nightly build -Z timings -p clap:3.0.0-beta.1 --features &quot;yaml unstable&quot;
</code></pre>
<p>This will create <code>cargo-timing-&lt;HASH&gt;.html</code> file that you can open in your web browser and see the adorable stats you were so excited about :) Then I uploaded the raw html on <code>gist.github.com</code> and linked it through <code>gistpreview.github.io</code> so you see the rendered version instead of raw HTML guts.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/161.html">epage/clapng#161</a> on 2021-12-06 20:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: other</span> removed by @epage on 2021-12-08 20:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> removed by @epage on 2021-12-08 21:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @epage on 2021-12-08 21:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-mentor</span> added by @epage on 2021-12-10 21:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4065.html">clap-rs/clap#4065</a> on 2022-08-11 19:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4096.html">clap-rs/clap#4096</a> on 2022-08-19 16:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/4114.html">clap-rs/clap#4114</a> on 2022-08-25 18:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4191.html">clap-rs/clap#4191</a> on 2022-09-07 19:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mgeisler">@mgeisler</a> on 2022-09-14 09:24</div>
            <div class="timeline-body"><blockquote>
<p>The <code>clap</code> crate (not counting dependencies) takes about 11 seconds to compile</p>
</blockquote>
<p>Hi @CreepySkeleton, I suppose this is a &quot;cold&quot; compilation of a small Hello World-style program which depends on Clap? As a developer, I would be interested in the <em>incremental</em> compilation time when I change my application by, e.g., adding a new command line flag.</p>
<p>Could you perhaps measure that as well?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4218.html">clap-rs/clap#4218</a> on 2022-09-15 15:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4679.html">clap-rs/clap#4679</a> on 2023-01-27 19:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4682.html">clap-rs/clap#4682</a> on 2023-02-23 21:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4793.html">clap-rs/clap#4793</a> on 2023-03-27 18:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4956.html">clap-rs/clap#4956</a> on 2023-06-09 15:13</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5657.html">clap-rs/clap#5657</a> on 2024-08-10 12:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2025-01-28 17:21</div>
            <div class="timeline-body"><p>I'm going to go ahead and close this.  While this is still a priority, we've taken care of a lot of low hanging fruit.  If we people have ideas for further improvements, we should create specific issues/PRs for those.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2025-01-28 17:21</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:47:43 UTC
    </footer>
</body>
</html>
