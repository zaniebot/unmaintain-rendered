<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add simple prompts - clap-rs/clap #1634</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add simple prompts</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/clap-rs/clap/issues/1634">#1634</a>
        opened by <a href="https://github.com/mayabyte">@mayabyte</a>
        on 2020-01-10 20:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/mayabyte">@mayabyte</a> on 2020-01-10 20:18</div>
            <div class="timeline-body"><p>Maintainer's notes</p>
<ul>
<li>Blocked on #4793 and the general move to https://github.com/clap-rs/clap/discussions/2832</li>
</ul>
<hr />
<h2>Why?</h2>
<p>Let's say you want to write a CLI program that requires the user to log in with a username and password, e.g. a CLI API for some web service. This is perfectly doable with arguments, but it may be preferred to prompt the user to supply these when they start the program, as follows:</p>
<pre><code>$ example_program
&gt; username: beepboop
&gt; password: 
Successfully logged in!
</code></pre>
<p>Or, let's say you have an option that can be dangerous to enable in certain circumstances, and you want to ask the user if they're sure (like <code>rm -rf</code> does):</p>
<pre><code>$ example_program --danger
&gt; Are you sure you want to do the dangerous thing? [y/N] 
</code></pre>
<p>It's not hard to write this logic on your own, but given that these are rather common use-cases, it would be convenient to include this functionality within Clap.</p>
<h2>What?</h2>
<p>I propose adding a few simple prompting functions for handling common prompting situations. Here's a rough list:</p>
<ul>
<li><code>prompt_if_absent(prompt: &amp;str)</code>: Asks the user to supply a value for this argument if they didn't at run time. Displays <code>prompt</code> on the line where they type; in the first example above, the <code>prompt</code>s would have been <code>&quot;&gt; username: &quot;</code> and <code>&quot;&gt; password: &quot;</code> respectively.</li>
<li><code>suggest_if_absent(prompt: &amp;str, default: Fn() -&gt; Option&lt;String&gt;)</code>: Like <code>prompt_if_absent</code>, but takes a function that can try to find a sensible default to suggest to the user, which can then be chosen by pressing enter without typing. Useful when you're not sure the default makes sense (e.g. if it's found from an envar or something), so you want to run it by the user to make sure.</li>
<li><code>ensure_if(prompt: &amp;str, arg_id: Key, val: &amp;str, default: Yes/No/None)</code> and similar <code>ensure_ifs</code>: Asks the user if they're sure when they've set <code>val</code>(s) with a <code>[y/n]</code> prompt. The user can select the default option by just pressing enter.</li>
<li><code>prompt_secret(prompt: &amp;str)</code>: like <code>prompt_if_absent</code> but doesn't show what you're typing</li>
</ul>
<p>These can all be gated behind a <code>prompts</code> feature or something to keep the core functionality simple.</p>
<p>I realise there's been a little pushback on stuff like this in the past (~a few years ago?), but I do genuinely think it would be a nice addition. A lot of great CLI building tools in other languages include prompting functionality, so adding a few convenience methods for it reduces the friction required to port existing things over to Rust.</p>
<p>I'm happy to implement this myself if there's interest.</p>
<p>(Note: I'm aware of https://github.com/clap-rs/clap/issues/1471, but the changes they suggest are much more significant and have potentially quite wide implications, so I consider it a separate matter. I'd love to see that get added though :P)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danieleades">@danieleades</a> on 2020-01-11 13:22</div>
            <div class="timeline-body"><p>actually i think this is proposing a much more significant change than #1471.
you could resolve #1471 simply by adding a hook that takes a closure-</p>
<pre><code>Arg::default_with&lt;F, S&gt;(mut self, fun: F) -&gt; Self
    where
    F: FnOnce -&gt; S,
    S: AsRef&lt;str&gt;,
</code></pre>
<p>then parsing your prompt function into this method</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mayabyte">@mayabyte</a> on 2020-01-11 13:38</div>
            <div class="timeline-body"><p>Ah, that's true I suppose. Their suggestion of adding a <code>get_matches_from_fns</code> is definitely larger though.</p>
<p>Something like <code>default_with</code> would be pretty nice to have as well. You can kinda already fudge something like that with <code>default_value</code> and a closure full of prompting (or whatever else) code, but <code>default_with</code> could be lazily-evaluated which makes it nicer imo.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danieleades">@danieleades</a> on 2020-01-11 13:41</div>
            <div class="timeline-body"><p>if you're prompting for user input it <em>must</em> be lazily evaluated, right?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mayabyte">@mayabyte</a> on 2020-01-11 14:06</div>
            <div class="timeline-body"><p>Yeah, but <code>default_with</code> could be used for other things besides prompting. I was porting a tool the other day that set the default of a field with the output of another program, so in that case <code>default_with</code> would be noticeably better than <code>default_value</code> due to laziness</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-01-18 10:20</div>
            <div class="timeline-body"><p>Copying my response from #1471</p>
<p>I have worked on https://github.com/termapps/enquirer this week. Either a hook fn or a matches fn, this library can easily provide them. IMO, the prompts shouldn't be in the core. Hooks? yes but not prompts.</p>
<h4>Implementation plan</h4>
<ul>
<li>If a required option is missing, and a <code>default_with</code> exists, then prompt happens.</li>
<li>If a flag is marked <code>confirm_with</code>, then when the flag is used, the prompt can confirm</li>
</ul>
<p>It should cover all the use cases @mayabyte wanted since the type of prompts are irrelevant when we abstract them out as hooks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-01-18 12:11</div>
            <div class="timeline-body"><p>Also, should we decide to go on the way of hooks, they would be impossible to serialize/deserialize since... well, how do you serialize a function ðŸ˜„ ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danieleades">@danieleades</a> on 2020-01-18 14:25</div>
            <div class="timeline-body"><blockquote>
<p>Also, should we decide to go on the way of hooks, they would be impossible to serialize/deserialize since... well, how do you serialize a function  ?</p>
</blockquote>
<p>Yeah it's not the easiest...</p>
<p>This exists- https://docs.rs/serde_closure/0.2.9/serde_closure/
But I suppose in general you could only use these hooks with programmatic argument building.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-01-18 14:43</div>
            <div class="timeline-body"><blockquote>
<p>This exists- https://docs.rs/serde_closure/0.2.9/serde_closure/</p>
</blockquote>
<p>...which generally serializes/deserializes the code as <strong>plain text</strong>. It  brings in all the problems of <code>eval</code> in some languages, let alone the fact it allows a malicious user/attacker <strong>inject arbitrary code and execute it</strong>!</p>
<p>I'm really, totally, absolutely not OK with this approach.</p>
<blockquote>
<p>But I suppose in general you could only use these hooks with programmatic argument building.</p>
</blockquote>
<p>This sounds good.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by @pksunkara on 2020-02-01 07:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> added by @pksunkara on 2020-02-01 07:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: args</span> added by @pksunkara on 2020-02-01 07:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: intermediate</span> added by @pksunkara on 2020-02-01 07:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: parsing</span> added by @pksunkara on 2020-02-01 07:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by @pksunkara on 2020-02-01 07:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @pksunkara on 2020-02-01 07:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1471.html">clap-rs/clap#1471</a> on 2020-02-01 13:50</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1453.html">clap-rs/clap#1453</a> on 2020-02-01 19:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Dylan-DPC-zz">@Dylan-DPC-zz</a> on 2020-02-02 01:12</div>
            <div class="timeline-body"><p>I think this is beyond the scope of clap. You could use <code>enquirer</code> or I'd tackled a similar problem in <code>clim</code> which I never completed ðŸ˜„</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-02-02 05:59</div>
            <div class="timeline-body"><p>Definitely, I am just keeping this issue open as a placeholder for hooks feature.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-02 06:08</div>
            <div class="timeline-body"><blockquote>
<p>I think this is beyond the scope of clap.</p>
</blockquote>
<p>I wouldn't be so categorical. Maybe not <em>hooks</em>, but some sort of prompt support would be pretty useful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-02-02 06:20</div>
            <div class="timeline-body"><p>I would say <em>prompts</em> are beyond the scope of main clap.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1777.html">clap-rs/clap#1777</a> on 2020-04-07 15:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-04-29 08:44</div>
            <div class="timeline-body"><p>Wanted to note that I am now a maintainer of https://github.com/mitsuhiko/dialoguer which means it will be easy to add compatibility for clap if needed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2020-04-29 16:29</div>
            <div class="timeline-body"><p>I'd second the prompts being too far out of scope for clap. A hook I think is OK.</p>
<p>As for the serialization problem, I'm fine with just saying, &quot;This one feature can't be serialized&quot; to avoid the <code>eval</code> type issues, just like validators.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tech6hutch">@tech6hutch</a> on 2020-05-19 21:54</div>
            <div class="timeline-body"><p>Is there currently any way to make prompts in Clap, manually if necessary? I just don't want to repeat myself with arg parsing and error messages.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danieleades">@danieleades</a> on 2020-05-20 06:03</div>
            <div class="timeline-body"><blockquote>
<p>Is there currently any way to make prompts in Clap, manually if necessary? I just don't want to repeat myself with arg parsing and error messages.</p>
</blockquote>
<p>Negative. But it looks like there's a reasonable concensus as to how to fit the pieces together.</p>
<p>Clap can add hooks which allow you to populate fields using a function. Then crates like <code>dialoguer</code> can handle the prompt. This might involve some interior mutability to lazily populate the value.</p>
<p>But then you run into questions like</p>
<ul>
<li>if interactive prompts, why not config files too?</li>
<li>what is the <em>precedence</em> of config values (and how can I customise it)?</li>
</ul>
<p>The design probably needs to consider these extensions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danieleades">@danieleades</a> on 2020-05-20 06:10</div>
            <div class="timeline-body"><p>@tech6hutch if you absolutely <em>must</em> have interactive prompts, you can try an approach I used. (I used <a href="https://github.com/TeXitoi/structopt">structopt</a>).</p>
<ul>
<li>define an <code>Args</code> struct</li>
<li>define a <code>PartialArgs</code> struct (derive <code>StructOpt</code>) which is the same as the <code>Args</code> struct, but with <code>Option</code>al fields</li>
<li>implement <code>From&lt;PartialArgs&gt; for Args</code> with a bunch of <code>unwrap_or_else(|| //prompt user)</code> calls</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2570.html">clap-rs/clap#2570</a> on 2021-07-06 11:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> removed by @pksunkara on 2021-08-13 10:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-11-17 21:39</div>
            <div class="timeline-body"><p>This can be made a plugin when #3008 is done.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/132.html">epage/clapng#132</a> on 2021-12-06 18:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: args</span> removed by @epage on 2021-12-08 20:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.1" by @epage on 2021-12-08 20:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> removed by @epage on 2021-12-08 21:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @epage on 2021-12-08 21:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> removed by @epage on 2021-12-09 20:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: medium</span> removed by @epage on 2021-12-09 20:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-blocked</span> added by @epage on 2021-12-09 20:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cbzehner">@cbzehner</a> on 2022-02-28 05:05</div>
            <div class="timeline-body"><p>~I recently wanted this functionality in a CLI tool and built on top of the suggestion @danieleades made above.~</p>
<p>~Here's a <a href="https://gist.github.com/cbzehner/dede31dc0b4617fd4abaff9e03b15f9e">greeting example</a> that uses the <code>default_value_t</code> from <code>clap_derive</code> to prompt the user when a value is missing.~</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-02-28 13:45</div>
            <div class="timeline-body"><p>A recent discussion <a href="https://github.com/clap-rs/clap/discussions/3476#discussioncomment-2185709">explores a potential API to allow designing prompt support</a>.</p>
<blockquote>
<p>Here's a <a href="https://gist.github.com/cbzehner/dede31dc0b4617fd4abaff9e03b15f9e">greeting example</a> that uses the default_value_t from clap_derive to prompt the user when a value is missing.</p>
</blockquote>
<p>That works?  We should be evaluating <code>default_value_t</code> independent of whether a default value is needed or not.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cbzehner">@cbzehner</a> on 2022-02-28 14:20</div>
            <div class="timeline-body"><p>Nope ðŸ™ƒ Thanks Ed, Ah, I didn't realize we were evaluating it regardless - you're right that it doesn't work. It seems like it does from a happy-path example but it just evaluates every time rather than taking into account the arguments actually passed into Clap.</p>
<p>Back to the drawing board!</p>
<p><em>Edit: Here's a <a href="https://gist.github.com/cbzehner/dede31dc0b4617fd4abaff9e03b15f9e">an example</a> of the workaround using exactly the pattern suggested above</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4395.html">clap-rs/clap#4395</a> on 2022-10-17 16:56</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/4793.html">clap-rs/clap#4793</a> on 2023-03-27 18:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/beautyfree">@beautyfree</a> on 2023-10-09 22:51</div>
            <div class="timeline-body"><p>I really miss this kind of functionality https://typer.tiangolo.com/tutorial/options/prompt/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/beautyfree">@beautyfree</a> on 2023-10-09 23:46</div>
            <div class="timeline-body"><p>Also prompts it's a better way to ask credentials/passwords (which with clap will be saved in history now)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../jj-vcs/jj/issues/2621.html">jj-vcs/jj#2621</a> on 2023-11-23 04:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gabry-lab">@gabry-lab</a> on 2023-12-19 06:41</div>
            <div class="timeline-body"><p>any updates here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/6036.html">clap-rs/clap#6036</a> on 2025-06-16 20:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:34:04 UTC
    </footer>
</body>
</html>
