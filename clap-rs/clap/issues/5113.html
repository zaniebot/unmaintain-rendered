<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clap doesn't show help when env variable exists - clap-rs/clap #5113</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Clap doesn't show help when env variable exists</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/5113">#5113</a>
        opened by <a href="https://github.com/coltonhurst">@coltonhurst</a>
        on 2023-09-06 15:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/coltonhurst">@coltonhurst</a> on 2023-09-06 15:56</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.71.1</p>
<h3>Clap Version</h3>
<p>4.4.2</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">use clap::{Parser, Subcommand};

#[derive(Parser)]
#[command(author, version, about, long_about = None)]
#[command(propagate_version = true)]
struct Cli {
    #[command(subcommand)]
    command: Command,

    #[arg(short = 't', long, global = true, env = &quot;ACCESS_TOKEN&quot;)]
    access_token: Option&lt;String&gt;,
}

#[derive(Subcommand)]
enum Command {
    #[command(long_about = &quot;Commands related to employees&quot;)]
    Employee {
        #[command(subcommand)]
        cmd: EmployeeCommand,
    },
    #[command(long_about = &quot;Commands related to emails&quot;)]
    Email {
        #[command(subcommand)]
        cmd: EmailCommand,
    },
}

#[derive(Subcommand)]
enum EmployeeCommand {
    Get { id: u32 },
    Create { name: String },
}

#[derive(Subcommand)]
enum EmailCommand {
    List { id: u32 },
    Create { name: String },
}

fn main() {
    let cli = Cli::parse();

    match &amp;cli.command {
        Command::Employee { cmd } =&gt; match cmd {
            EmployeeCommand::Create { name } =&gt; {
                println!(&quot;Create the employee with the name: {}&quot;, name);
            }
            EmployeeCommand::Get { id } =&gt; {
                println!(&quot;Get the employee with the id: {}&quot;, id);
            }
        },
        Command::Email { cmd } =&gt; match cmd {
            EmailCommand::Create { name } =&gt; {
                println!(&quot;Create an email with the name: {}&quot;, name);
            }
            EmailCommand::List { id } =&gt; {
                println!(&quot;List the email with the id: {}&quot;, id);
            }
        },
    }

    match &amp;cli.access_token {
        Some(value) =&gt; println!(&quot;Access token provided: {}&quot;, value),
        None =&gt; println!(&quot;No access token provided&quot;),
    }
}
</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<ol>
<li><code>cargo build</code></li>
<li><code>export ACCESS_TOKEN=&quot;12345&quot;</code></li>
<li><code>./target/debug/clap-env-test</code></li>
</ol>
<h3>Actual Behaviour</h3>
<p>When an environment variable is set that clap expects, help text is not printed when no options are passed.</p>
<h3>Expected Behaviour</h3>
<p>Help text should be printed when options are not passed. This works, except when an environment variable that clap expects is defined. Despite any environment variables set, the help text should still print when no options are provided.</p>
<h3>Additional Context</h3>
<p>Credit to <a href="https://github.com/tangowithfoxtrot">tangowithfoxtrot</a> for discovering the bug.</p>
<p>In case it's helpful, I have created a repository around the example provided above with more context and detail here: <a href="https://github.com/coltonhurst/clap-env-test">https://github.com/coltonhurst/clap-env-test</a></p>
<h3>Debug Output</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @coltonhurst on 2023-09-06 15:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-09-06 16:05</div>
            <div class="timeline-body"><p>Closing in favor of #3572</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2023-09-06 16:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5673.html">clap-rs/clap#5673</a> on 2024-08-14 05:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:35:29 UTC
    </footer>
</body>
</html>
