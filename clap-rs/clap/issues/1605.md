```yaml
number: 1605
title: Arguments with default values conflict even if not used
type: issue
state: closed
author: 0ndorio
labels:
  - C-bug
assignees: []
created_at: 2019-12-09T13:56:03Z
updated_at: 2020-11-10T16:04:44Z
url: https://github.com/clap-rs/clap/issues/1605
synced_at: 2026-01-10T01:57:43Z
```

# Arguments with default values conflict even if not used

---

_Issue opened by @0ndorio on 2019-12-09 13:56_

**Attention:** This is directly related to https://github.com/clap-rs/clap/issues/1071

The original issue was already marked as fixed but it seems like the bug was not fully eliminated.

---

### Rust Version

* rustc 1.39.0 (4560ea788 2019-11-04)

### Affected Version of clap

* v2.33.0
* latest master (a2f9fb5f6c2aeeac89c5c638f25dedb9e50bde00)

### Expected Behavior Summary

I expect conflicts to happen only when conflicting arguments are explicitly present on the command line.

### Actual Behavior Summary

As mentioned in https://github.com/clap-rs/clap/issues/1071 originally it was enough for an argument to have a `default_value` configured to cause a conflict. This was fixed with 58b5b4be315280888d50d9b15119b91a9028f050 but it seems like the fix only applied to cases where `defaults` and `conflicts_with` are present on different arguments. As `conflicts_with` automatically applies to both related arguments it is also possible to apply the option the argument with the `default` option.

This again triggers the same error message as the original issue.

### Sample Code or Link to Sample Code

```rust
use clap::{App, Arg}; // 2.33.0

fn main() {
    let result = App::new("conflict")
        .arg(Arg::from_usage("-o, --opt=[opt] 'some opt'")
            .default_value("default")
            .conflicts_with("flag"))
        .arg(Arg::from_usage("-f, --flag 'some flag'")
            .conflicts_with("opt"))
        .get_matches_from_safe(vec!["myprog", "-f"]);
        
    eprintln!("{:#?}", result);
    
    assert!(result.is_ok());
    let m = result.unwrap();
    
    assert_eq!(m.value_of("opt"), Some("default"));
    assert!(m.is_present("flag"));
}
```

https://play.rust-lang.org/?version=stable&mode=debug&edition=2018&gist=9913e0f7a7905f7be0131ae53ef4ec63

---

_Referenced in [clap-rs/clap#1604](../../clap-rs/clap/issues/1604.md) on 2019-12-09 13:57_

---

_Added to milestone `3.0` by @CreepySkeleton on 2020-02-01 11:07_

---

_Removed from milestone `3.0` by @CreepySkeleton on 2020-02-01 11:07_

---

_Added to milestone `v3.0.0-alpha.3` by @CreepySkeleton on 2020-02-01 11:07_

---

_Label `P1: urgent` added by @CreepySkeleton on 2020-02-01 11:08_

---

_Label `T: bug` added by @CreepySkeleton on 2020-02-01 11:08_

---

_Label `W: 2.x` added by @CreepySkeleton on 2020-02-01 11:08_

---

_Removed from milestone `3.0.0-beta.2` by @pksunkara on 2020-04-07 13:59_

---

_Added to milestone `3.0` by @pksunkara on 2020-04-07 13:59_

---

_Label `W: 2.x` removed by @pksunkara on 2020-04-09 08:12_

---

_Label `C: args` added by @pksunkara on 2020-04-09 08:12_

---

_Referenced in [clap-rs/clap#1869](../../clap-rs/clap/pulls/1869.md) on 2020-04-26 17:55_

---

_Closed by @bors[bot] on 2020-04-26 18:53_

---

_Referenced in [clap-rs/clap#1906](../../clap-rs/clap/issues/1906.md) on 2020-05-05 19:03_

---

_Referenced in [diesel-rs/diesel#2401](../../diesel-rs/diesel/pulls/2401.md) on 2020-10-10 19:14_

---

_Comment by @svenfoo on 2020-11-05 11:44_

If I understand the history of this ticket correctly, the bug is **still present in the latest stable release**, which is `2.33.3` at this point, and **fixed in 3.0**, which is still in `beta` at this point, right?

Just asking because it seems that I just ran into it using clap 2.33.3.

---

_Comment by @pksunkara on 2020-11-05 11:53_

Yes.

---

_Referenced in [clap-rs/clap#1586](../../clap-rs/clap/issues/1586.md) on 2021-08-09 02:11_

---

_Referenced in [chronicleworks/chronicle#144](../../chronicleworks/chronicle/pulls/144.md) on 2022-12-21 12:15_

---
