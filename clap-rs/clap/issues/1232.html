<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic completion support - clap-rs/clap #1232</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Dynamic completion support</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/1232">#1232</a>
        opened by <a href="https://github.com/Manishearth">@Manishearth</a>
        on 2018-03-26 21:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Manishearth">@Manishearth</a> on 2018-03-26 21:39</div>
            <div class="timeline-body"><p>Maintainers notes:</p>
<ul>
<li>Assuming this is custom completion on top of clap-driven completion, this is blocked on #3166</li>
<li>Open question: does the completion function accept just the arg and current value or does it have access to <code>ArgMatches</code> for completing based on other data like in #1910</li>
</ul>
<p>Like with <code>PossibleValue::help</code>, we should support <a href="https://github.com/clap-rs/clap/discussions/3622">help text</a></p>
<hr />
<p>Currently clap does basic completion of arguments, however it can't be used to do things like the dynamic completion of <code>git checkout &lt;branch&gt;</code>.</p>
<p>It would be really neat if this could be handled by clap itself -- AFAICT nothing like this currently exists for any language and it would just be magical since you can then do everything in Rust code.</p>
<p>The rough idea is that the <code>Arg</code>/<code>Subcommand</code> builder can take a <code>.with_completion(|args, str|  ... )</code> closure. We pass the
closure the partial parsed list of other args, and the partial string being completed for this arg (may be empty). The closure returns a list of completions.</p>
<p>When you attempt to do something like <code>git branch -D foo&lt;tab&gt;</code>, the completion script will call <code>git --secret-completion-param 10 -- branch -D foo</code>, where 10 is the index in the arguments of where <code>&lt;tab&gt;</code> was pressed, and after the <code>--</code> we pass all the arguments. Clap parses these arguments except the partial one, and passes this down to the <code>with_completion</code> closure, which will return a list of completions which we print out (and feed back to bash or whatever).</p>
<p>A simpler version doesn't handle parsing all the other arguments, instead your closure just takes the partial string, so you just provide a closure operating on a string.</p>
<p>If this could be made to work neatly, it would be pretty great.</p>
<p>cc @killercup</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2018-03-30 01:22</div>
            <div class="timeline-body"><p>Sorry for the late reply, it's been a busy week!</p>
<p>This is related to #568 and something I very much want. The implementation you've outlined is pretty close to what we're thinking in #568 and probably almost exactly what will end up being implemented. I haven't worked out the final details yet as I've had other issues as as priority and the v3 release is a prerequisite for me to implement this (although I want this, or an initial implementation in the v3-alpha1 release).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1037.html">clap-rs/clap#1037</a> on 2018-03-30 01:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> added by @kbknapp on 2018-04-01 03:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: hard</span> added by @kbknapp on 2018-04-01 03:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P3: want to have</span> added by @kbknapp on 2018-04-01 03:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by @kbknapp on 2018-04-01 03:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: completion gen</span> added by @kbknapp on 2018-04-01 03:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sportfloh">@sportfloh</a> on 2018-05-30 16:34</div>
            <div class="timeline-body"><p>hey, I was recently looking for such a feature and stumbled over clangs autocompletion feature (http://blog.llvm.org/2017/09/clang-bash-better-auto-completion-is.html).  Maybe their solution is somehow inspiring.
Can I help with this issue?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1269.html">clap-rs/clap#1269</a> on 2018-06-05 01:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../matthias-t/workspace/issues/17.html">matthias-t/workspace#17</a> on 2018-07-31 13:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../rust-lang/rustup/issues/2268.html">rust-lang/rustup#2268</a> on 2020-03-29 08:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kinnison">@kinnison</a> on 2020-03-29 08:09</div>
            <div class="timeline-body"><p>To reiterate a call for this, we'd <em>love</em> to have this in <code>rustup</code> so we could offer more localised completions (e.g. for <code>+foo</code> to complete over installed toolchains).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.0" by @CreepySkeleton on 2020-03-29 09:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P3: want to have</span> removed by @CreepySkeleton on 2020-03-29 09:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> added by @CreepySkeleton on 2020-03-29 09:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.0" by @pksunkara on 2020-04-09 07:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @pksunkara on 2020-04-09 07:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1880.html">clap-rs/clap#1880</a> on 2020-04-29 15:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/woodruffw">@woodruffw</a> on 2020-06-02 04:06</div>
            <div class="timeline-body"><p>I'd also like to register interest in this. It's not as conceptually clean, but an approach that injects the results of a subshell would be sufficient for many CLIs.</p>
<p>Borrowing the <code>with_completion</code> terminology above:</p>
<pre><code class="language-rust">subcommand(
  App::new(&quot;dump&quot;)
  .arg(
    Arg::with_name(&quot;thing&quot;)
        .with_completion(&quot;foobar list&quot;)
  )
)
</code></pre>
<p>would go from something like this in the <code>bash</code> completions:</p>
<pre><code class="language-bash">opts=&quot; -h -V  --help --version  &lt;thing&gt; &quot;
</code></pre>
<p>to this:</p>
<pre><code class="language-bash">opts=&quot; -h -V  --help --version  $(foobar list) &quot;
</code></pre>
<p>(N.B. that this approach applies to <code>Arg</code>s and not the subcommands themselves).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../woodruffw/kbs2/issues/32.html">woodruffw/kbs2#32</a> on 2020-06-02 04:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-06-02 06:21</div>
            <div class="timeline-body"><p>I must admit I like the &quot;special option to autocomplete&quot; approach <em>very</em> much, but I've also came up with a number of tricky questions.</p>
<p>Let me summarize the prior discussion and outline the desired solution that <em>should</em> work and satisfy everybody.</p>
<p>We want this facility <em>somewhere</em> in clap:</p>
<pre><code class="language-rust">fn dynamic_completion&lt;F&gt;(hook: F) -&gt; Variants 
where 
    F: FnOnce(Input) -&gt; Variants;
</code></pre>
<p>Where to squeeze the <code>fn</code> in? I believe it should be a method in <code>App</code>, and this method should only affect the current subcommand by default. Developers are supposed to call this method for every subcommand separately. We may also provide a &quot;global&quot; variant.</p>
<p>The <code>hook</code> here is effectively a piece of developer-written code whose job is to look at the args that have already been supplied and provide the completion variants back to clap.</p>
<p>How it works: presence of this kind of hook tells clap to generate a special <code>--autocomplete</code> option. The binary simply prints the completion variants, one per line (see example below).</p>
<p>How does clap supply the variants back to the shell so the later can use it? It doesn't. What it does is printing the values to stdin. This option is supposed to be called from inside the completions script, <a href="https://github.com/llvm-mirror/clang/blob/aa231e4be75ac4759c236b755c57876f76e3cf05/utils/bash-autocomplete.sh#L42">like that</a>. The script will handle the rest in a shell-specific way.</p>
<p>What does <code>Variants</code> look like and why not using simple <code>Vec&lt;OsString&gt;</code>? Because we need to leave the ability for devs to fall back to the default completion script, see also https://github.com/clap-rs/clap/pull/1793 to get what I mean by &quot;default completion&quot;.</p>
<pre><code class="language-rust">// we may want to extend the system in future
#[non_exhaustive]
enum Variants {
    /// Return this when the completion hook couldn't decide on the completion.
    /// This will fall back to the default completion system which should work sensibly.
    Fallback,
    
    /// Return when the hook did found some good options to complete.
    Success(Vec&lt;OsString&gt;) 
}
</code></pre>
<p>Some examples:</p>
<pre><code class="language-sh"># What user does
cargo +&lt;TAB&gt;

# the call 
cargo --autocompletion 1 '+'

# the output (OK, pack the values and return early)
SUCSESS
nightly
stable
beta

# ATTENTION! There's a space between `+` and `&lt;TAB&gt; 
cargo + &lt;TAB&gt;

# the call
cargo --autocompletion 2 '+' 

# the output (Oops, let's just cross fingers and let the script handle the rest)
FALLBACK
</code></pre>
<p>The next question is: what is <code>Input</code>. Well, we need to</p>
<ol>
<li>Allow devs to specify the name of the long option</li>
<li>Trim everything prior to the actual args for the current subcommand, if any</li>
<li>Tell user if there was a space between the last arg and TAB</li>
</ol>
<pre><code class="language-rust">fn dynamic_completion&lt;F&gt;(name: &amp;str, hook: F) -&gt; Variants 
where 
    F: FnOnce(bool, &amp;[OsString]) -&gt; Variants;

.dynamic_completion(|has_space, args| { /* ... */ })

// alternatively, see |args, str| design in the first comment
</code></pre>
<p>Does everybody agree with this design? Any unresolved questions?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Manishearth">@Manishearth</a> on 2020-06-02 14:16</div>
            <div class="timeline-body"><p>Yeah, this is essentially what I proposed above, with the small tweak that I was using <code>--</code> as an argument separator instead of quoting the entire thing (I find quoting to just be very messy), and also I was havng the completion function live on the <code>Arg</code>. I do think having a completion function on the <code>Arg</code> (<em>and</em> one that lives on the whole command) is good: this way it is very easy to write dynamic completion for <em>just one argument</em>, but you can also write it for the whole function if you want.</p>
<p>I'm less fond of the <code>has_space, args</code> approach because the user needs to reparse the args in this case. IMO we should parse the rest of the args and surface them to the user in a structured way, and then surface the partial string being tab-completed.</p>
<blockquote>
<p>Trim everything prior to the actual args for the current subcommand, if any</p>
</blockquote>
<p>I think it should be all args except the one currently being tabbed. It should be okay to tab-complete in the middle of an arg list</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-06-02 20:16</div>
            <div class="timeline-body"><blockquote>
<p>instead of quoting the entire thing</p>
</blockquote>
<p>No quoting the <em>entire</em> string here (we simply don't know what the string was with most shells). We pass the args array as is, quoting each arg to guard against spaces. But using <code>--</code> is probably a good idea so, if user used <code>--</code> on his own, it would be accounted for.</p>
<pre><code class="language-sh"># what we do
app arg1 --flag --opt1 val1 'val 2' -- something &lt;TAB&gt;

# what we get
app --autocomplete 7 -- '--flag' '--opt' 'val1' 'val 2' '--' 'something'
</code></pre>
<blockquote>
<p>user needs to reparse the args in this case</p>
</blockquote>
<p>User needs to reparse all args in any case. The &quot;partial parsing&quot; problem was reported as https://github.com/clap-rs/clap/issues/1880, and I think <a href="https://github.com/clap-rs/clap/issues/1880#issuecomment-637779787">this</a> could work as a viable option. But anyway, the hook should work on top of bare strings and expect <code>partially_parsed_matches</code> to be incomplete and/or not quite correct.</p>
<p>So, maybe:</p>
<pre><code class="language-rust">// or maybe index instead of has_space?
.dynamic_completion(|has_space, partially_parsed_matches, args_as_os_strings| { /* ... */ })
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kenoss">@kenoss</a> on 2020-07-15 22:20</div>
            <div class="timeline-body"><p>A few weeks ago I saw completion approaches of <code>git</code>, <code>kubectl</code>, <code>pyenv</code> and <code>clap_generate</code> and I found that dynamic completion will be suitable for clap.</p>
<p>I agree with th CreepySkeleton's first observation.  But, I vote Manishearth's point.  I prefer the completion function live on the <code>Arg</code>.
I think forcing users to parse args themselves decrease clarity of clap.  We should provide structural way if we can.</p>
<p>I expect <a href="https://github.com/clap-rs/clap/issues/1880#issuecomment-658980976">normalization</a> works for #1880 .</p>
<p>Is there a case one have to parse raw string?  Let me classify the cases.</p>
<p>Simple cases.</p>
<pre><code># Candidates are options of `branch` subcommand.  `App(&quot;branch&quot;)` is responsible for completion.
$ git branch -&lt;TAB&gt;

# Candidates are short options of `branch` subcommand.  `App(&quot;branch&quot;)` is responsible.
$ git branch -a&lt;TAB&gt;

# Candidates are branches.  `Arg` with index of `App(&quot;branch&quot;)` is responsible.
$ git branch -a &lt;TAB&gt;

# No candidates.  `Arg` with short name `m` is responsible.
$ git commit -m &lt;TAB&gt;
</code></pre>
<p>More complex cases.
Note that <a href="https://github.com/git/git/blob/master/contrib/completion/git-completion.bash#L3519">completion of git 4 uses variables</a>:</p>
<ul>
<li><code>cur</code>: current word, word arround <TAB></li>
<li><code>prev</code>: previous word</li>
<li><code>words</code>: array of arguments</li>
<li><code>cword</code>: num of arguments</li>
</ul>
<pre><code># `--strategy` and `--strategy-option`
$ git cherry-pick --strategy&lt;TAB&gt;

# Candidates are strategies.  `--strategy` is responsible.
$ git cherry-pick --strategy &lt;TAB&gt;
$ git cherry-pick --strategy=&lt;TAB&gt;
$ git cherry-pick --strategy &lt;TAB&gt; foo
$ git cherry-pick --strategy=&lt;TAB&gt; foo
</code></pre>
<p>The code is <a href="https://github.com/git/git/blob/master/contrib/completion/git-completion.bash#L1061">here</a>.
This uses <code>cur</code> and <code>prev</code>.</p>
<p>Clap version will be done easily because parser will remove ambiguity of <code> </code> and <code>=</code> and we get candidates by asking <code>Arg(&quot;strategy&quot;)</code>.</p>
<pre><code>$ git fetch &lt;TAB&gt;
benches/        clap_derive/    etc/            ip6-localhost   localhost       src/            tests/          upstream
clap-perf/      clap_generate/  examples/       ip6-loopback    origin          target/         trochilidae

$ git fetch --mirror &lt;TAB&gt;
cow          destringify  master-orig  staging      trying       v2-master
debug        master       release      staging.tmp  v1-master    v3-dev

$ git fetch origin:
(nothing)

$ git fetch --mirror origin:
HEAD    debug   master
</code></pre>
<p>The code is <a href="https://github.com/git/git/blob/master/contrib/completion/git-completion.bash#L987">here</a>.
This uses subcommand's name and investigates its options.  Note that <code>git</code> has subcommands at most depth 1.</p>
<p>Consider the last case.  Clap version will be done by querying subcommand's name and options from <code>Arg</code>.</p>
<hr />
<p>Seeing git's cases, I feel parsing by clap + <code>Arg.with_completion</code> + some query mechanism is sufficiently powerful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kenoss">@kenoss</a> on 2020-07-15 22:22</div>
            <div class="timeline-body"><p>Note that clap can automatically derive completion for short/long options in many cases, i.e., if one doesn't need special treatment.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/1910.html">clap-rs/clap#1910</a> on 2020-08-05 17:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2396.html">clap-rs/clap#2396</a> on 2021-03-09 16:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/PoignardAzur">@PoignardAzur</a> on 2021-03-19 19:11</div>
            <div class="timeline-body"><p>Is there progress on this issue? The approach suggested by @CreepySkeleton seems pretty good to me.</p>
<p>If the issue is stalled for need of a contributor, I'd be interested in spending a few days on it (especially if I can get some mentoring). I'd really like to improve cargo's autocompletion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../rust-lang/cargo/pulls/9288.html">rust-lang/cargo#9288</a> on 2021-03-19 19:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-03-19 19:48</div>
            <div class="timeline-body"><p>This is still in design phase. According to the current suggested design, this needs more foundational work regarding partial parsing (#1880).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../hyperledger-archives/grid/pulls/607.html">hyperledger-archives/grid#607</a> on 2021-03-26 15:10</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../pimalaya/himalaya/issues/101.html">pimalaya/himalaya#101</a> on 2021-05-03 22:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kolloch">@kolloch</a> on 2021-05-13 19:18</div>
            <div class="timeline-body"><p>@CreepySkeleton I've been playing around with the code and I think we could get it to work to support dynamic completion of a simple flag value. I haven't looked at the shell completion logic but I am thinking in the direction of only calling <code>your_app --autocomplete 7 ...</code> if we are at a flag position with automatic expansion.</p>
<p>It would be super cool, to reduce all shell autocomplete logic to calling out to your prog with the <code>--autocomplete</code> argument but that would probably require a different parser or a lot more work.</p>
<p>Anyways, if we use the <code>--autocomplete</code> &quot;API&quot;, we can step by step expand it to cover more use cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2488.html">clap-rs/clap#2488</a> on 2021-07-06 13:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/568.html">clap-rs/clap#568</a> on 2021-07-22 14:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/blaggacao">@blaggacao</a> on 2021-08-05 03:55</div>
            <div class="timeline-body"><p>how cobra does it:</p>
<ul>
<li>https://github.com/spf13/cobra/blob/master/bash_completionsV2.go</li>
<li>https://github.com/spf13/cobra/blob/master/zsh_completions.go</li>
<li>https://github.com/spf13/cobra/blob/master/shell_completions.go</li>
<li>https://github.com/spf13/cobra/blob/master/powershell_completions.go</li>
<li>https://github.com/spf13/cobra/blob/master/fish_completions.go</li>
</ul>
<p>and here is the 'hidden' command:</p>
<p>https://github.com/spf13/cobra/blob/56060d19f88533a20f635116f64aff2065cf260a/completions.go#L148</p>
<p>looks like this is becoming a 'copy paste' task</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/nrdxp">@nrdxp</a> on 2021-08-06 17:10</div>
            <div class="timeline-body"><p>I would really appreciate this feature. Right now my app has a Struct describing what are basically inputs to all of my cli subcommands. It would be super great to use this information in completions. I was a bit surprised when I found out it may not be possible :disappointed:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sergiimk">@sergiimk</a> on 2021-08-06 19:03</div>
            <div class="timeline-body"><p>As a long-time watcher of this issue thought I'd share my solution.</p>
<p>The CLI tool I'm working on deals with a lot of different kinds of entities that have long names (think <code>kubectl</code>), so dynamic completions were essential for usability.</p>
<p>The solution pieces are:</p>
<ul>
<li>Bash / Zsh completions <a href="https://github.com/kamu-data/kamu-cli/blob/7be4742d764bf9bfc4f908e17037a7119bf20856/kamu-cli/src/commands/completions_command.rs#L3-L14">delegate all work</a> to <code>myapp complete -- &lt;words&gt; &lt;position&gt;</code> sub-command</li>
<li>The <a href="https://github.com/kamu-data/kamu-cli/blob/7be4742d764bf9bfc4f908e17037a7119bf20856/kamu-cli/src/commands/complete_command.rs#L140"><code>complete</code> command</a> combines the input and a regular <a href="https://github.com/kamu-data/kamu-cli/blob/7be4742d764bf9bfc4f908e17037a7119bf20856/kamu-cli/src/cli_parser.rs#L72"><code>clap::App</code> definition</a> to establish the context (which sub-command we're on, are we completing a positional or a named argument etc.)</li>
<li>Using completions is as simple <a href="https://github.com/kamu-data/kamu-cli/blob/7be4742d764bf9bfc4f908e17037a7119bf20856/kamu-cli/src/cli_parser.rs#L140-L162">as this</a></li>
</ul>
<p>It's not perfect (e.g. has troubles with multiple positional arguments of different kinds, and I struggled to make it work with <code>fish</code>) but satisfies 90% of what I need and can be extended.</p>
<p>For Rust apps that are very fast to start I really can't think of a good reason to generate completion scripts instead of delegating the entire work to the app itself in all cases. Dealing with completion differences between various shells is no fun.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Removed from milestone "3.1" by @pksunkara on 2021-08-13 10:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> removed by @pksunkara on 2021-08-13 10:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chisui">@chisui</a> on 2021-09-07 11:29</div>
            <div class="timeline-body"><p>Haskells <a href="https://hackage.haskell.org/package/optparse-applicative-0.16.1.0#bash-zsh-and-fish-completions"><code>optparse-applicative</code></a> has builtin completion support. Maybe a look at it's implementation is helpful.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../databendlabs/databend/issues/2172.html">databendlabs/databend#2172</a> on 2021-10-10 04:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../atomicdata-dev/atomic-server/issues/188.html">atomicdata-dev/atomic-server#188</a> on 2021-10-18 15:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/woodruffw">@woodruffw</a> on 2021-10-21 23:33</div>
            <div class="timeline-body"><p>This isn't a catch-all solution, but: perhaps <a href="https://docs.rs/clap/3.0.0-beta.5/clap/enum.ValueHint.html"><code>clap::ValueHint</code></a> could be extended to include a variant that enables dynamism through a subprocess?</p>
<p>What I'm thinking of is something like <code>ValueHint::Process(String)</code>, where the variant value would be something like <code>&quot;foo --bar&quot;</code> and the shell completion generator would be responsible for emitting something like <code>$(foo --bar)</code> and correctly splitting and wrangling the resulting output into a completion set.</p>
<p>This would be a reasonable solution for many CLIs, and requires relatively little complexity on <code>clap</code>'s side (it's just another variant, and generators would be responsible for emitting it or a fallback appropriately.</p>
<p>Thoughts?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/3022.html">clap-rs/clap#3022</a> on 2021-11-14 01:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-11-15 14:31</div>
            <div class="timeline-body"><p>#3022 was a tipping point for me in realizing that maybe our current approach to completions doesn't work.  We effectively have to implement a mostly-untested parser within each shell.  Examples of other problems that seem to stem from this:</p>
<ul>
<li>https://github.com/clap-rs/clap/issues/2729</li>
<li>https://github.com/clap-rs/clap/issues/2750</li>
<li>https://github.com/clap-rs/clap/issues/2145</li>
<li>https://github.com/clap-rs/clap/issues/1822</li>
<li>https://github.com/clap-rs/clap/issues/1764</li>
</ul>
<p>If we take the approach of <a href="https://pypi.org/project/argcomplete/">argcomplete</a> where we do the parsing in our core code, rather than in each completion script, this will help us share parsing logic between shell, share some or all parsing logic with clap itself, and make a subset of the logic more testable.</p>
<p>In my mind, this is raising the priority of this issue.</p>
<p>This doesn't mean we'll work on it immediately though.  We need to first get clap3 out and some work that is spilling out of clap3.  We also need to decide whether to morph the existing parser into supporting this or create a custom parser (since the needs are pretty special).  If we do a custom parser, we should probably do https://github.com/clap-rs/clap/issues/2915 first so we can reuse lexing logic between clap and the completion generation.  I've also been considering https://github.com/clap-rs/clap/issues/2912 which would allow reusing the completion logic with any CLI parser.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../kube-rs/kopium/pulls/15.html">kube-rs/kopium#15</a> on 2021-11-28 19:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../kube-rs/kopium/issues/6.html">kube-rs/kopium#6</a> on 2021-11-28 19:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/92.html">epage/clapng#92</a> on 2021-12-06 17:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/156.html">epage/clapng#156</a> on 2021-12-06 20:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/157.html">epage/clapng#157</a> on 2021-12-06 20:15</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/187.html">epage/clapng#187</a> on 2021-12-06 21:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/238.html">epage/clapng#238</a> on 2021-12-06 22:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: new feature</span> removed by @epage on 2021-12-08 21:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @epage on 2021-12-08 21:17</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P2: need to have</span> removed by @epage on 2021-12-09 16:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-hard</span> removed by @epage on 2021-12-09 16:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-blocked</span> added by @epage on 2021-12-09 16:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../tranzystorekk/pakr/issues/1.html">tranzystorekk/pakr#1</a> on 2021-12-13 18:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../leftwm/leftwm-theme/issues/45.html">leftwm/leftwm-theme#45</a> on 2022-01-10 07:18</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../foundry-rs/foundry/pulls/425.html">foundry-rs/foundry#425</a> on 2022-01-11 21:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../tealdeer-rs/tealdeer/pulls/256.html">tealdeer-rs/tealdeer#256</a> on 2022-01-15 22:36</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../It4innovations/hyperqueue/issues/323.html">It4innovations/hyperqueue#323</a> on 2022-01-18 07:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../casey/just/issues/1084.html">casey/just#1084</a> on 2022-02-04 00:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../planus-org/planus/pulls/89.html">planus-org/planus#89</a> on 2022-02-06 14:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../zellij-org/zellij/issues/1169.html">zellij-org/zellij#1169</a> on 2022-03-04 08:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../denoland/deno/issues/14039.html">denoland/deno#14039</a> on 2022-03-19 22:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../nextuponstream/todo/issues/34.html">nextuponstream/todo#34</a> on 2022-04-03 15:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../rust-lang/cargo/pulls/10472.html">rust-lang/cargo#10472</a> on 2022-04-06 15:11</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AndreasBackx">@AndreasBackx</a> on 2022-04-09 21:49</div>
            <div class="timeline-body"><p>Hey @epage, I noticed your brainstorm #3476 and relevant issues about the modularisation of Clap, and also your comment on rust-lang/cargo#10472 about perhaps making this your next Clap priority. I would love to help out with maybe an RFC or implementation, though maybe it's better to ask where a newcomer could be helping out with this issue? Let me know whether you already have any ideas and I (and others) could perhaps share some ideas as well, like already done above.</p>
<p>Additionally, are there any other communication channels that are more direct? The old Gitter chat does not seem to be active, there doesn't happen to be some chat channel elsewhere?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-04-09 22:05</div>
            <div class="timeline-body"><p>The first step is pulling out the lexer for reuse in the completions.  I'm working on that now.  Once thats in a good enough state, I can pull it out into a crate and we can create a proof of concept for this.  At that point, its filling out features which will be easy for anyone to contribute to.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/3635.html">clap-rs/clap#3635</a> on 2022-04-15 17:59</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../rust-lang/cargo/issues/6645.html">rust-lang/cargo#6645</a> on 2022-04-21 15:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-04-27 21:21</div>
            <div class="timeline-body"><p>@AndreasBackx I've got the start for #3166 in #3656.  Once I have it merged, want to take over flushing it out so it sufficient for existing shell completions (cargo's handwritten or existing <code>clap_complete</code> users)?  Once we are at that point, we can look at resolving this issue.</p>
<blockquote>
<p>Additionally, are there any other communication channels that are more direct? The old Gitter chat does not seem to be active, there doesn't happen to be some chat channel elsewhere?</p>
</blockquote>
<p>Sorry, forgot to respond to this one.   We do have a zulip instance that we've not really advertised past the maintainers yet.  I can also be reached on the rust-lang zulip strean &quot;wg-cli&quot;.  I'm also on both rust related discord instances but I tend to miss notifications there.</p>
<p>EDIT: I've also gone ahead and joined &quot;kbknapp/clap-rs&quot; on gitter</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../MatteoNardi/again/issues/1.html">MatteoNardi/again#1</a> on 2022-06-23 07:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../Anomalocaridid/handlr-regex/issues/2.html">Anomalocaridid/handlr-regex#2</a> on 2022-06-26 03:03</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../beatbrot/trackie/pulls/79.html">beatbrot/trackie#79</a> on 2022-07-12 12:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../stackabletech/stackablectl/pulls/54.html">stackabletech/stackablectl#54</a> on 2022-07-21 06:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../rust-lang/cargo/issues/11052.html">rust-lang/cargo#11052</a> on 2022-09-23 20:04</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../chshersh/tool-sync/issues/133.html">chshersh/tool-sync#133</a> on 2022-10-10 12:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../LucasPickering/env-select/issues/6.html">LucasPickering/env-select#6</a> on 2022-11-15 11:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../jj-vcs/jj/issues/879.html">jj-vcs/jj#879</a> on 2022-12-31 21:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../jj-vcs/jj/issues/1217.html">jj-vcs/jj#1217</a> on 2023-02-08 02:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../facebook/buck2/issues/169.html">facebook/buck2#169</a> on 2023-04-17 17:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../astral-sh/rye/issues/213.html">astral-sh/rye#213</a> on 2023-05-24 15:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../GitoxideLabs/gitoxide/issues/877.html">GitoxideLabs/gitoxide#877</a> on 2023-05-29 17:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../RaphGL/Tuckr/issues/19.html">RaphGL/Tuckr#19</a> on 2023-06-17 11:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../Neptune-Crypto/neptune-core/pulls/44.html">Neptune-Crypto/neptune-core#44</a> on 2023-09-19 22:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5157.html">clap-rs/clap#5157</a> on 2023-10-03 14:30</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../prefix-dev/pixi/issues/383.html">prefix-dev/pixi#383</a> on 2023-10-09 13:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../brocode/fw/issues/226.html">brocode/fw#226</a> on 2023-11-30 18:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5283.html">clap-rs/clap#5283</a> on 2024-01-05 03:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../kingwingfly/fav/issues/1.html">kingwingfly/fav#1</a> on 2024-02-05 19:19</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../tonarino/innernet/issues/302.html">tonarino/innernet#302</a> on 2024-02-25 16:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../prefix-dev/pixi/issues/778.html">prefix-dev/pixi#778</a> on 2024-02-29 10:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5424.html">clap-rs/clap#5424</a> on 2024-03-25 15:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5427.html">clap-rs/clap#5427</a> on 2024-03-26 16:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/5449.html">clap-rs/clap#5449</a> on 2024-04-09 03:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../pants721/skely/issues/2.html">pants721/skely#2</a> on 2024-04-13 16:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../casey/just/pulls/2113.html">casey/just#2113</a> on 2024-05-30 17:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../siketyan/ghr/issues/382.html">siketyan/ghr#382</a> on 2024-06-24 11:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../a-kenji/flake-edit/issues/85.html">a-kenji/flake-edit#85</a> on 2024-07-26 10:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5618.html">clap-rs/clap#5618</a> on 2024-08-02 15:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5621.html">clap-rs/clap#5621</a> on 2024-08-02 16:51</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../eclipse-ankaios/ankaios/pulls/348.html">eclipse-ankaios/ankaios#348</a> on 2024-08-09 12:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2024-08-10 00:33</div>
            <div class="timeline-body"><p>We have an initial version as <a href="https://docs.rs/clap_complete/latest/clap_complete/dynamic/struct.ArgValueCompleter.html"><code>clap_complete::dynamic::ArgValueCompleter</code></a></p>
<p>For tracking stabilization, see #3166</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2024-08-10 00:35</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../rust-lang/rustup/issues/3156.html">rust-lang/rustup#3156</a> on 2024-09-09 12:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../pimalaya/himalaya/issues/473.html">pimalaya/himalaya#473</a> on 2024-09-10 08:21</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../autobib/autobib/pulls/66.html">autobib/autobib#66</a> on 2024-10-04 17:05</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../wasmCloud/wasmCloud/issues/3258.html">wasmCloud/wasmCloud#3258</a> on 2024-10-21 08:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../nix-community/nh/issues/162.html">nix-community/nh#162</a> on 2024-10-24 07:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../GitoxideLabs/gitoxide/issues/1655.html">GitoxideLabs/gitoxide#1655</a> on 2024-11-06 10:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../work-spaces/spaces/issues/82.html">work-spaces/spaces#82</a> on 2025-10-11 22:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:32 UTC
    </footer>
</body>
</html>
