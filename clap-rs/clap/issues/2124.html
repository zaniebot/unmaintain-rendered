<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>required_unless not working with yaml - clap-rs/clap #2124</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>required_unless not working with yaml</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/2124">#2124</a>
        opened by <a href="https://github.com/grm">@grm</a>
        on 2020-09-05 14:32
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/grm">@grm</a></div>
            <div class="timeline-body">Make sure you completed the following tasks
<ul>
<li>[X] Searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] Searched the closed issues</li>
</ul>
Actual Behavior Summary
<p>I cannot make required_unless work with a yaml function !</p>
<p>Here is an extract f the yaml used:</p>
<pre><code>  - register:
        short: r
        long: register
        help: Asks rdss to register the files
        required_unless: stack
  - stack:
        short: s
        long: stack
        help: Asks rdss to stack the files
</code></pre>
<p>When i execute my program, here is the output i obtain :</p>
<pre><code>$ /target/debug/rdss-cli --stack
error: The following required arguments were not provided:
    --register
</code></pre>
<p>I am not sur I am using the <em>required_unless</em> he right way in yaml
I tried by using strings (e.g. double quotes) in the yaml file with no success.</p>
<p>Does someone mange to make ti work in yaml ?</p>
<p>Thanks for your help,
Jérémie</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by <a href="https://github.com/grm">@grm</a> on 2020-09-05 14:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">:money_with_wings: $5</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-10-05 15:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: yaml parser</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-10-05 15:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">Z: good first issue</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-10-05 15:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-10-05 15:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thiagoarrais">@thiagoarrais</a> on 2020-10-08 17:24</div>
            <div class="timeline-body"><p>I have tried to reproduce this but couldn&#x27;t. What version are you using, @grm?</p>
<p>I have made a <code>cli.yaml</code> based on your example and created a simple program that simply outputs if the <code>stack</code> flag was used. Here&#x27;s what I get when using <code>v2.33.3</code> (latest in v2 series AFAIK):</p>
<pre><code>$ ./target/debug/myclap        
error: The following required arguments were not provided:
    --register

USAGE:
    myclap [FLAGS] --register

For more information try --help
$ ./target/debug/myclap --stack
--stack was used
</code></pre>
<p>And here&#x27;s what I get with both the current main branch tip (9163374) and <code>v3.0.0-beta.2</code></p>
<pre><code>$ ./target/debug/myclap
thread &#x27;main&#x27; panicked at &#x27;Unknown Arg setting &#x27;required_unless&#x27; in YAML file for arg &#x27;register&#x27;&#x27;, /path/to/clap/src/build/arg/mod.rs:4426:22
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
<p>But this can be fixed if you use <code>required_unless_present</code> instead of <code>required_unless</code>:</p>
<pre><code>$ ./target/debug/myclap
error: The following required arguments were not provided:
    --register

USAGE:
    myclap --register

For more information try --help
$ ./target/debug/myclap --stack
--stack was used
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-10-09 16:36</div>
            <div class="timeline-body"><p>Thanks for looking into this @thiagoarrais.</p>
<p>@grm I am closing this for now and please comment with a clear failing example if you want me to open this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/pksunkara">@pksunkara</a> on 2020-10-09 16:36</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:57:54 UTC
    </footer>
</body>
</html>
