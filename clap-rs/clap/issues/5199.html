<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document how to use ArgGroups from derive API - clap-rs/clap #5199</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Document how to use ArgGroups from derive API</h1>

    <div class="meta">
        <span class="state state-open">Open</span>
        <a href="https://github.com/clap-rs/clap/issues/5199">#5199</a>
        opened by <a href="https://github.com/kpreid">@kpreid</a>
        on 2023-11-07 18:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/kpreid">@kpreid</a> on 2023-11-07 18:50</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>4.4.7</p>
<h3>Describe your use case</h3>
<p>Context:</p>
<ul>
<li>I want to make a set of mutually exclusive options</li>
<li>I understand that <code>ArgGroup</code>s serve this purpose</li>
<li>I am using <code>derive(clap::Parser)</code></li>
</ul>
<p>Problem:</p>
<p>The documentation does not contain any examples how to achieve this or describe the full picture. The only discussion of is the &quot;<a href="https://docs.rs/clap/4.4.7/clap/_derive/index.html#arggroup-attributes">ArgGroup Attributes</a>&quot; which mentions in passing that &quot;These correspond to the <code>ArgGroup</code> which is implicitly created for each Args derive.&quot;, from which I can infer that the solution is likely to create a nested struct for the group (and I later determined this succeeded).</p>
<p>I tried <code>#[arg(group = &quot;action&quot;, conflicts_with = &quot;action&quot;)]</code> on each arg to see if that worked, but (not too surprisingly) it made the args conflict with themselves.</p>
<h3>Describe the solution you'd like</h3>
<ul>
<li>Provide at least one discoverable example of using <code>ArgGroup</code> features such as mutual exclusion in a derive-only program.</li>
<li>Clarify in reference documentation that in order to make a configured group via derive, you <em>must</em> make a <code>derive(Parser)</code> struct for that group.</li>
</ul>
<h3>Alternatives, if applicable</h3>
<p><em>No response</em></p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @kpreid on 2023-11-07 18:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kpreid">@kpreid</a> on 2023-11-07 19:11</div>
            <div class="timeline-body"><p>Also, the <code>ArgGroup</code> documentation says that <a href="https://docs.rs/clap/4.4.7/clap/struct.ArgGroup.html"><code>multiple = false</code> is the default</a>, but the <code>derive(Parser)</code> implicit group defaults to <code>multiple = true</code> and the derive reference does not mention this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5200.html">clap-rs/clap#5200</a> on 2023-11-07 19:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-11-07 19:49</div>
            <div class="timeline-body"><p>A part of the tutorial does cover <a href="https://docs.rs/clap/latest/clap/_derive/_tutorial/chapter_3/index.html#argument-relations">mutually exclusive arg group</a>.</p>
<p>#5200 documents the implicit behavior.</p>
<p>Ideally we'd have #2621 which would make this more natural.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kpreid">@kpreid</a> on 2023-11-08 04:59</div>
            <div class="timeline-body"><blockquote>
<p>A part of the tutorial does cover <a href="https://docs.rs/clap/latest/clap/_derive/_tutorial/chapter_3/index.html#argument-relations">mutually exclusive arg group</a>.</p>
</blockquote>
<p>Ah. To give more detail: only when writing up this issue did I discover that the tutorial even <em>had</em> multiple chapters, and while I did skim through them I didn't search every chapter thoroughly (and to my thought process, &quot;validation&quot; meant &quot;of values&quot;, not &quot;of all states args can be in&quot;). And, when I'm trying to solve a problem, I generally don't go for tutorials first, but for API-documentation (in the sense of the kind of thing rustdoc is mainly used for).</p>
<p>I still think that it would be an improvement if searching the derive reference page for “ArgGroup” turned up a sentence that communicated that the <em>only</em> way to create groups, that have nondefault options and don't contain every arg, is with a separate struct.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-11-08 19:08</div>
            <div class="timeline-body"><blockquote>
<p>Ah. To give more detail: only when writing up this issue did I discover that the tutorial even had multiple chapters, and while I did skim through them I didn't search every chapter thoroughly (and to my thought process, &quot;validation&quot; meant &quot;of values&quot;, not &quot;of all states args can be in&quot;).</p>
</blockquote>
<p>It was originally all in one page and people were overwhelmed by it and complaining.  #5163 is about starting it on the table of contents rather than the first page.</p>
<blockquote>
<p>I still think that it would be an improvement if searching the derive reference page for “ArgGroup” turned up a sentence that communicated that the only way to create groups, that have nondefault options and don't contain every arg, is with a separate struct.</p>
</blockquote>
<p>You can always create a group manually (<code>#[command(group = ArgGroup::new(...)...)]</code>).  That is covered by <a href="https://docs.rs/clap/4.4.7/clap/_derive/index.html#command-attributes">explaining raw attributes and linking to the API</a>.</p>
<p>In the <a href="https://docs.rs/clap/4.4.7/clap/_derive/index.html#overview">overview</a>, we do show a separate struct with <code>#[group]</code> attributes.</p>
<p>When discussing <a href="https://docs.rs/clap/4.4.7/clap/_derive/index.html#arggroup-attributes">ArgGroup</a>, we do have this</p>
<blockquote>
<p>These correspond to the <a href="https://docs.rs/clap/4.4.7/clap/struct.ArgGroup.html">ArgGroup</a> which is implicitly created for each Args derive.</p>
</blockquote>
<p>Maybe examples would help?  I don't want to commit to examples for everything (see #4090).  Maybe linking to a part in the tutorial that is most relevant for each type of attribute?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kpreid">@kpreid</a> on 2023-11-08 19:26</div>
            <div class="timeline-body"><p>I think an example would help (and I'd justify writing one with &quot;groups are not just a single option but an entire kind of entity&quot;), and cross-references to the tutorial would help.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/5229.html">clap-rs/clap#5229</a> on 2023-11-27 22:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-11-27 22:21</div>
            <div class="timeline-body"><p>#5229 adds links for each attribute type to the relevant tutorial sections.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:34 UTC
    </footer>
</body>
</html>
