<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>When the root command has a required argument, it is not output to the subcommand help. - clap-rs/clap #3606</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>When the root command has a required argument, it is not output to the subcommand help.</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/3606">#3606</a>
        opened by <a href="https://github.com/mondy">@mondy</a>
        on 2022-04-03 00:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mondy">@mondy</a></div>
            <div class="timeline-body">Please complete the following tasks
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
Rust Version
<p>rustc 1.59.0 (9d1b2106e 2022-02-23)</p>
Clap Version
<p>clap = { version = &quot;3.1.7&quot;, features = [&quot;derive&quot;] }</p>
Minimal reproducible code
<pre><code>use clap::{Parser, Subcommand};

#[derive(Parser)]
#[clap(author, version)]
struct Cli {
    name: String,

    #[clap(subcommand)]
    command: Option&lt;Commands&gt;,
}

#[derive(Subcommand)]
enum Commands {
    Test {},
}

fn main() {
    let cli = Cli::parse();

    println!(&quot;Value for name: {}&quot;, cli.name);
}

</code></pre>
Steps to reproduce the bug with the above code
<p>Execute <code>cargo run help test</code>.</p>
Actual Behaviour
<p>The following is output.</p>
<pre><code>excmd.exe-test

USAGE:
    excmd.exe test

OPTIONS:
    -h, --help    Print help information
</code></pre>
Expected Behaviour
<pre><code>excmd.exe-test

USAGE:
    excmd.exe &lt;NAME&gt; test

OPTIONS:
    -h, --help    Print help information
</code></pre>
Additional Context
<p>If you try to execute <code>cargo run test</code>, it requires the NAME argument as follows.</p>
<pre><code>error: The following required arguments were not provided:
    &lt;NAME&gt;

USAGE:
    excmd.exe &lt;NAME&gt; [SUBCOMMAND]

For more information try --help
error: process didn&#x27;t exit successfully: `target\debug\excmd.exe test` (exit code: 2)
</code></pre>
<p>Execute <code>cargo run test --help</code> produces the expected output.</p>
<pre><code>excmd.exe-test

USAGE:
    excmd.exe &lt;NAME&gt; test

OPTIONS:
    -h, --help    Print help information
</code></pre>
<p>As an additional preference, it would be easier to understand if it could be executed in a sequence such as <code>excmd.exe test &lt;NAME&gt;</code>.</p>
<p>Also, it would be easier to understand if the subcommand takes over only when specified as follows.</p>
<pre><code>struct Cli {
    #[clap(global = true)]
    name: String,
}
</code></pre>
Debug Output
<p>Execute <code>cargo run help test</code>.</p>
<pre><code>[        clap::build::command]  App::_do_parse
[        clap::build::command]  App::_build
[        clap::build::command]  App::_propagate:excmd
[        clap::build::command]  App::_check_help_and_version: excmd
[        clap::build::command]  App::_check_help_and_version: Building help subcommand
[        clap::build::command]  App::_propagate_global_args:excmd
[        clap::build::command]  App::_derive_display_order:excmd
[        clap::build::command]  App::_derive_display_order:test
[        clap::build::command]  App::_derive_display_order:help
[  clap::build::debug_asserts]  Command::_debug_asserts
[  clap::build::debug_asserts]  Arg::_debug_asserts:help
[  clap::build::debug_asserts]  Arg::_debug_asserts:version
[  clap::build::debug_asserts]  Arg::_debug_asserts:name
[  clap::build::debug_asserts]  Command::_verify_positionals
[         clap::parse::parser]  Parser::get_matches_with
[         clap::parse::parser]  Parser::get_matches_with: Begin parsing &#x27;RawOsString(&quot;help&quot;)&#x27; ([104, 101, 108, 112])
[         clap::parse::parser]  Parser::get_matches_with: Positional counter...1
[         clap::parse::parser]  Parser::get_matches_with: Low index multiples...false
[         clap::parse::parser]  Parser::possible_subcommand: arg=RawOsStr(&quot;help&quot;)
[         clap::parse::parser]  Parser::get_matches_with: sc=Some(&quot;help&quot;)
[         clap::parse::parser]  Parser::parse_help_subcommand
[        clap::build::command]  App::_build
[        clap::build::command]  App::_propagate:test
[        clap::build::command]  App::_check_help_and_version: test
[        clap::build::command]  App::_check_help_and_version: Removing generated version
[        clap::build::command]  App::_propagate_global_args:test
[        clap::build::command]  App::_derive_display_order:test
[  clap::build::debug_asserts]  Command::_debug_asserts
[  clap::build::debug_asserts]  Arg::_debug_asserts:help
[  clap::build::debug_asserts]  Command::_verify_positionals
[         clap::parse::parser]  Parser::use_long_help
[         clap::parse::parser]  Parser::help_err: use_long=false
[         clap::parse::parser]  Parser::use_long_help
[        clap::build::command]  App::color: Color setting...
[        clap::build::command]  Auto
[          clap::output::help]  Help::new
[          clap::output::help]  Help::write_help
[          clap::output::help]  should_show_arg: use_long=false, arg=help
[          clap::output::help]  Help::write_templated_help
[          clap::output::help]  Help::write_before_help
[          clap::output::help]  Help::write_bin_name
[         clap::output::usage]  Usage::create_usage_no_title
[         clap::output::usage]  Usage::create_help_usage; incl_reqs=true
[         clap::output::usage]  Usage::get_required_usage_from: incls=[], matcher=false, incl_last=false
[         clap::output::usage]  Usage::get_required_usage_from: unrolled_reqs={}
[         clap::output::usage]  Usage::get_required_usage_from: ret_val=[]
[         clap::output::usage]  Usage::needs_options_tag
[         clap::output::usage]  Usage::needs_options_tag:iter: f=help
[         clap::output::usage]  Usage::needs_options_tag:iter Option is built-in
[         clap::output::usage]  Usage::needs_options_tag: [OPTIONS] not required
[         clap::output::usage]  Usage::create_help_usage: usage=excmd.exe test
[          clap::output::help]  Help::write_all_args
[          clap::output::help]  should_show_arg: use_long=false, arg=help
[          clap::output::help]  Help::write_args
[          clap::output::help]  should_show_arg: use_long=false, arg=help
[          clap::output::help]  Help::write_args: Current Longest...2
[          clap::output::help]  Help::write_args: New Longest...6
[          clap::output::help]  should_show_arg: use_long=false, arg=help
[          clap::output::help]  Help::spec_vals: a=--help
[          clap::output::help]  Help::spec_vals: a=--help
[          clap::output::help]  Help::short
[          clap::output::help]  Help::long
[          clap::output::help]  Help::val: arg=help
[          clap::output::help]  Help::align_to_about: arg=help
[          clap::output::help]  Help::align_to_about: Has switch...
[          clap::output::help]  Yes
[          clap::output::help]  Help::align_to_about: nlh...false
[          clap::output::help]  Help::help
[          clap::output::help]  Help::help: Next Line...false
[          clap::output::help]  Help::help: Too long...
[          clap::output::help]  No
[          clap::output::help]  Help::write_after_help
[        clap::build::command]  App::color: Color setting...
[        clap::build::command]  Auto
excmd.exe-test

USAGE:
    excmd.exe test

OPTIONS:
    -h, --help    Print help information
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by <a href="https://github.com/mondy">@mondy</a> on 2022-04-03 00:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-04-03 00:58</div>
            <div class="timeline-body"><p>For the specific issue covered in here, what we are doing is not correct but its also a low priority to me for addressing (and the fix just maybe not be worth the complexity) because I believe its generally expected that top-level args are either exclusive with the subcommand or  are global.  For global required, we have <a href="https://github.com/clap-rs/clap/issues/1546">clap-rs/clap#1546</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">A-help</span> added by <a href="https://github.com/epage">@epage</a> on 2022-04-03 00:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-medium</span> added by <a href="https://github.com/epage">@epage</a> on 2022-04-03 00:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-04-29 15:53</div>
            <div class="timeline-body"><p>I missed that this does work with <code>sub --help</code> but not <code>help sub</code>.  We have the code for this feature, we just are inconsistently using it.  This should be rather trivial to fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-medium</span> removed by <a href="https://github.com/epage">@epage</a> on 2022-04-29 15:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">E-easy</span> added by <a href="https://github.com/epage">@epage</a> on 2022-04-29 15:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone &quot;3.x&quot; by <a href="https://github.com/epage">@epage</a> on 2022-04-29 15:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2022-04-30 11:41</div>
            <div class="timeline-body"><p>This was fixed in #3667 and should be available in v3.1.13</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/epage">@epage</a> on 2022-04-30 11:41</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:58:55 UTC
    </footer>
</body>
</html>
