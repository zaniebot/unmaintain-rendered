<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unable to pass a negative number as an argument - clap-rs/clap #385</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../index.html">Back to index</a>
    </div>

    <h1>Unable to pass a negative number as an argument</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/385">#385</a>
        opened by <a href="https://github.com/amandasaurus">@amandasaurus</a>
        on 2016-01-25 15:01
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/amandasaurus">@amandasaurus</a> on 2016-01-25 15:01</div>
            <div class="timeline-body"><p>Here's a simple programme:</p>
<pre><code>extern crate clap;
use clap::{App, Arg};

fn main() {
    let matches = App::new(&quot;myapp&quot;)
                    .arg(Arg::with_name(&quot;x&quot;).short(&quot;x&quot;).required(true).takes_value(true))
                  .get_matches();

    let x = matches.value_of(&quot;x&quot;).unwrap();
    println!(&quot;Value of x is {}&quot;, x);
}
</code></pre>
<p>It can run when you pass in <code>10</code> as an argument:</p>
<pre><code>$ cargo run -- -x 10
     Running `target/debug/myapp -x 10`
Value of x is 10
</code></pre>
<p>However not if you pass in <code>-10</code> as an argument:</p>
<pre><code>$ cargo run -- -x -10
     Running `target/debug/myapp -x -10`
error: The argument '-1' isn't valid
USAGE:
    myapp [FLAGS] -x &lt;x&gt;

For more information try --help
An unknown error occurred

To learn more, run the command again with --verbose.
</code></pre>
<p>Clearly if the argument (<code>x</code>) takes a value, then the next string in the command line should be treated as that value, and not attempted to be parsed as a argument in it's own right.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-01-25 15:08</div>
            <div class="timeline-body"><p>Thanks for taking the time to file this!</p>
<p>Try it without using <code>cargo run</code>. Such as <code>./target/debug/myapp -- -x 10</code>. It was actually news to me, but in #384 we found out that <code>cargo run</code> actually &quot;eats&quot; the <code>--</code> and therefore <code>clap</code> never sees it so it's as if you're passing <code>myapp -x 10</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> added by @kbknapp on 2016-01-25 15:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/amandasaurus">@amandasaurus</a> on 2016-01-25 15:48</div>
            <div class="timeline-body"><p>I ran it as &quot;./target/debug/myapp -x -10` and got the same result.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-01-25 16:21</div>
            <div class="timeline-body"><p>Ah ok I misunderstood at first. This is a bug. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by @kbknapp on 2016-01-25 16:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: args</span> added by @kbknapp on 2016-01-25 16:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">D: easy</span> added by @kbknapp on 2016-01-25 16:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P3: want to have</span> added by @kbknapp on 2016-01-25 16:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: parsing</span> added by @kbknapp on 2016-01-25 16:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @kbknapp on 2016-01-25 16:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: RFC / question</span> removed by @kbknapp on 2016-01-25 16:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-01-25 16:26</div>
            <div class="timeline-body"><p>Also, for my curiosity did you run it as <code>myapp -x &quot;-10&quot;</code>? Because the difficulty comes in from the way <code>clap</code> determines if it's done parsing an options values is by looking for the leading <code>-</code>, this comes in to play when parsing multiple values such as <code>-x val1 val2 val3 -y val4</code></p>
<p>The way I could fix this bug is by having something like if you set <code>arg.num_values(1)</code> it will parse the next value as it's value no matter what (regardless of leading hyphen). The downside is if someone makes a typo and forgets the value <code>-x -y val2</code> instead of <code>-x val1 -y val2</code> they will get a strange(r) error message about not expecting <code>val2</code> vs the normal message of <code>-x</code> missing a value.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/amandasaurus">@amandasaurus</a> on 2016-01-25 16:55</div>
            <div class="timeline-body"><blockquote>
<p>Also, for my curiosity did you run it as <code>myapp -x &quot;-10&quot;</code>?</p>
</blockquote>
<p>Just tried that. Same buggy outcome. Even if that worked it would be a bug. However wrapping things in <code>&quot;</code> is probably pointless, because shells like bash will strip that before calling the programme.</p>
<p>If I ran it with <code>-x &quot;\&quot;-10\&quot;&quot;</code> it parsed, but it set the value of <code>x</code> to <code>&quot;-10&quot;</code>, not <code>-10</code>, so it's not the same thing at all.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-01-25 17:59</div>
            <div class="timeline-body"><p>Ok good to know. Also, it'll always parse values to a string, it's up to the consumer to do otherwise. So <code>10</code> will always be <code>&quot;10&quot;</code> (same with negative numbers) because parsing to numbers isn't something everyone needs or wants to spend cycles on. Plus some may one <code>u8</code> some may want <code>i64</code>, etc.</p>
<p>If you want to pull a number out of a value there is a macro to remove the boiler plate called <code>value_t!</code> which returns a <code>Result&lt;T&gt;</code>. So something like, <code>value_t!(m.value_of(&quot;x&quot;), i64);</code>. Also if you'd like to exit with an error message upon a failed parse you can just append <code>.unwrap_or_else(|e| e.exit());</code> (Note, v2 soon to be release provides a better macro calling convention of <code>value_t!(m, &quot;x&quot;, i64);</code> which still returns a <code>Result&lt;T&gt;</code>).</p>
<p>I'll play with some ideas about this bug though and post back with any updates.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "v2.0" by @kbknapp on 2016-01-25 18:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../pulls/390.html">clap-rs/clap#390</a> on 2016-01-26 15:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2016-01-26 15:19</div>
            <div class="timeline-body"><p>Closed with #390 (This will be available shortly on 2.x release)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @kbknapp on 2016-01-26 15:19</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:28:31 UTC
    </footer>
</body>
</html>
