<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fails to compile clap 2.33.3 -- `'if' is not allowed in a 'const fn'` - clap-rs/clap #2734</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>fails to compile clap 2.33.3 -- <code>&#x27;if&#x27; is not allowed in a &#x27;const fn&#x27;</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/2734">#2734</a>
        opened by <a href="https://github.com/jtmoon79">@jtmoon79</a>
        on 2021-08-22 03:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jtmoon79">@jtmoon79</a></div>
            <div class="timeline-body">Please complete the following tasks
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
Rust Version
<p>1.42.1</p>
<p>Specifically <code>rustc</code> version <code>1.41.1</code> and <code>cargo</code> version <code>1.42.1</code>.</p>
Clap Version
<p>2.33.3</p>
Minimal reproducible code
<p><code>src/main.rs</code></p>
<pre><code>// src/main.rs
fn main() {}
</code></pre>
<p><code>Cargo.toml</code></p>
<pre><code>[package]
name = &quot;cargo1&quot;
version = &quot;0.0.1&quot;

[dependencies]
clap = &quot;2.33.3&quot;
</code></pre>
Steps to reproduce the bug with the above code
<p><code>cargo build</code></p>
Actual Behaviour
<pre><code>$ cargo build
   Compiling clap v2.33.3
error[E0658]: `if` is not allowed in a `const fn`
  --&gt; /home/user1/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-2.33.3/src/app/settings.rs:7:1
   |
7  | / bitflags! {
8  | |     struct Flags: u64 {
9  | |         const SC_NEGATE_REQS       = 1;
10 | |         const SC_REQUIRED          = 1 &lt;&lt; 1;
...  |
51 | |     }
52 | | }
   | |_^
   |
   = note: for more information, see <a href="https://github.com/rust-lang/rust/issues/49146">rust-lang/rust#49146</a>
   = note: this error originates in a macro outside of the current crate (in Nightly builds, run with -Z external-macro-backtrace for more info)

error[E0658]: `if` is not allowed in a `const fn`
  --&gt; /home/user1/.cargo/registry/src/github.com-1ecc6299db9ec823/clap-2.33.3/src/args/settings.rs:6:1
   |
6  | / bitflags! {
7  | |     struct Flags: u32 {
8  | |         const REQUIRED         = 1;
9  | |         const MULTIPLE         = 1 &lt;&lt; 1;
...  |
28 | |     }
29 | | }
   | |_^
   |
   = note: for more information, see <a href="https://github.com/rust-lang/rust/issues/49146">rust-lang/rust#49146</a>
   = note: this error originates in a macro outside of the current crate (in Nightly builds, run with -Z external-macro-backtrace for more info)

error: aborting due to 2 previous errors

For more information about this error, try `rustc --explain E0658`.
error: could not compile `clap`.
</code></pre>
Expected Behaviour
<pre><code>$ cargo build

   Compiling cargo1 v0.0.1 (/tmp/project1)
    Finished dev [unoptimized + debuginfo] target(s) in 2.34s
</code></pre>
Additional Context
<p>Run on Debian 9 Linux.</p>
Debug Output
<p>No difference in <code>cargo build</code> output.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: bug</span> added by <a href="https://github.com/jtmoon79">@jtmoon79</a> on 2021-08-22 03:37</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;fails to compile clap 2.33.3 -- `if` is not allowed in a `const fn`&quot; to &quot;fails to compile clap 2.33.3 -- `&#x27;if&#x27; is not allowed in a &#x27;const fn&#x27;`&quot; by <a href="https://github.com/jtmoon79">@jtmoon79</a> on 2021-08-22 03:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;fails to compile clap 2.33.3 -- `&#x27;if&#x27; is not allowed in a &#x27;const fn&#x27;`&quot; to &quot;fails to build clap 2.33.3 -- `&#x27;if&#x27; is not allowed in a &#x27;const fn&#x27;`&quot; by <a href="https://github.com/jtmoon79">@jtmoon79</a> on 2021-08-22 03:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;fails to build clap 2.33.3 -- `&#x27;if&#x27; is not allowed in a &#x27;const fn&#x27;`&quot; to &quot;fails to compile clap 2.33.3 -- `&#x27;if&#x27; is not allowed in a &#x27;const fn&#x27;`&quot; by <a href="https://github.com/jtmoon79">@jtmoon79</a> on 2021-08-22 03:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jtmoon79">@jtmoon79</a> on 2021-08-22 03:49</div>
            <div class="timeline-body"><p>The same minimal reproduction setup <em>passes</em> when using <code>cargo</code> version <code>1.51.0</code> and <code>rustc</code> version <code>1.51.0</code> on Ubuntu 20.04.</p>
<p>The versions reported <code>1.42.1</code> and <code>1.41.1</code> are the supported versions in Debian 9 which is <a href="https://wiki.debian.org/LTS">supported by Debian until July 2022</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-08-23 13:29</div>
            <div class="timeline-body"><p>This is a duplicate of #2691.  Users are subject to how the dependency resolver selects all crates and how that impacts MSRV.  By default, it will pick the latest for everything, so with a new <code>bitflags</code> changing its MSRV, people are now picking that up.  The flag <code>-Z minimal-versions</code> is an option to get around this but the challenge is not everyone tests with it, so people will have too-low of dependencies.     The other option is to patch dependencies.</p>
<p>What clap shouldn&#x27;t do is constrain the dependency for everyone for the sake of MSRV.  That would be inaccurate and can lead to other problems like <a href="https://www.reddit.com/r/rust/comments/p8clcx/how_to_fix_cargo_dependency_issue/">what happened to nom</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/pksunkara">@pksunkara</a> on 2021-08-31 10:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>foresterre/cargo-msrv#312</a> on 2022-02-22 15:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>rcore-os/rCore-Tutorial#151</a> on 2022-06-10 07:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a>rust-lang/cargo#9930</a> on 2023-03-30 12:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 19:58:16 UTC
    </footer>
</body>
</html>
