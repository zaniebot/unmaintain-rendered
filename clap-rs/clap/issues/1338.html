<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YAML not parsed when name, version, author, about not specified in it - clap-rs/clap #1338</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>YAML not parsed when name, version, author, about not specified in it</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/clap-rs/clap/issues/1338">#1338</a>
        opened by <a href="https://github.com/Hellseher">@Hellseher</a>
        on 2018-09-06 23:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/Hellseher">@Hellseher</a> on 2018-09-06 23:45</div>
            <div class="timeline-body"><!--
Please use the following template to assist with creating an issue and to ensure a speedy resolution. If an area is not applicable, feel free to delete the area or mark with `N/A`
-->

<h3>Rust Version</h3>
<p><code>rustc 1.28.0 (9634041f0 2018-07-30)</code></p>
<h3>Affected Version of clap</h3>
<p>[dependencies.clap]
version = &quot;2.31.2&quot;
features = [ &quot;yaml&quot;]</p>
<h3>Bug or Feature Request Summary</h3>
<h3>Expected Behavior Summary</h3>
<p>By using method and macros build arguments from yml file where that filed not specified.</p>
<pre><code>    .about(crate_description!())
    .name(crate_name!())
    .author(crate_authors!())
    .version(crate_version!())</code></pre>
<h3>Actual Behavior Summary</h3>
<p>Arguments list is ignored completely</p>
<h3>Steps to Reproduce the issue</h3>
<h3>Sample Code or Link to Sample Code</h3>
<p><strong>cli.yml</strong></p>
<pre><code class="language-name:">version:
author:
about:
args:
  - harware:
      short: H
      long: hardware
      help: Show system hardware specification
  - config:
      short: c
      long: config
      value_name: FILE
      help: Sets a custom config file
      takes_value: true
  - INPUT:
      help: Sets the input file to use
      required: true
      index: 1
  - verbose:
      short: v
      multiple: true
      help: Sets the level of verbosity
</code></pre>
<p><strong>main.rs</strong></p>
<pre><code class="language-#[macro_use]">extern crate clap;

use clap::App;

fn main() {
    let cli_yaml = load_yaml!(&quot;cli.yml&quot;);
    let matches = App::from_yaml(cli_yaml)
        .about(crate_description!())
        .name(crate_name!())
        .author(crate_authors!())
        .version(crate_version!())
        .get_matches();

    let config = matches.value_of(&quot;config&quot;).unwrap_or(&quot;default.conf&quot;);
    println!(&quot;Value for config: {}&quot;, config);
}
// End of main.rs
</code></pre>
<h3>Debug output</h3>
<details>
<summary> Debug Output </summary>
<pre>
<code>
DEBUG:clap:Parser::propagate_settings: self=stem, g_settings=AppFlags(
    (empty)
)
DEBUG:clap:Parser::get_matches_with;
DEBUG:clap:Parser::create_help_and_version;
DEBUG:clap:Parser::create_help_and_version: Building --help
DEBUG:clap:Parser::create_help_and_version: Building --version
DEBUG:clap:Parser::get_matches_with: Begin parsing '"--help"' ([45, 45, 104, 101, 108, 112])
DEBUG:clap:Parser::is_new_arg:"--help":NotFound
DEBUG:clap:Parser::is_new_arg: arg_allows_tac=false
DEBUG:clap:Parser::is_new_arg: -- found
DEBUG:clap:Parser::is_new_arg: starts_new_arg=true
DEBUG:clap:Parser::possible_subcommand: arg="--help"
DEBUG:clap:Parser::get_matches_with: possible_sc=false, sc=None
DEBUG:clap:ArgMatcher::process_arg_overrides:None;
DEBUG:clap:Parser::parse_long_arg;
DEBUG:clap:Parser::parse_long_arg: Does it contain '='...No
DEBUG:clap:Parser::parse_long_arg: Found valid flag '--help'
DEBUG:clap:Parser::check_for_help_and_version_str;
DEBUG:clap:Parser::check_for_help_and_version_str: Checking if --help is help or version...Help
DEBUG:clap:Parser::_help: use_long=true
DEBUG:clap:Help::write_parser_help;
DEBUG:clap:Help::write_parser_help;
DEBUG:clap:Parser::color;
DEBUG:clap:Parser::color: Color setting...Auto
DEBUG:clap:is_a_tty: stderr=false
DEBUG:clap:Help::new;
DEBUG:clap:Help::write_help;
DEBUG:clap:Help::write_default_help;
DEBUG:clap:Help::write_bin_name;
DEBUG:clap:Help::write_version;
DEBUG:clap:Help::write_default_help: writing about
DEBUG:clap:usage::create_usage_no_title;
DEBUG:clap:usage::get_required_usage_from: reqs=[], extra=None
DEBUG:clap:usage::get_required_usage_from: after init desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: no more children
DEBUG:clap:usage::get_required_usage_from: final desc_reqs=[]
DEBUG:clap:usage::get_required_usage_from: args_in_groups=[]
DEBUG:clap:usage::needs_flags_tag;
DEBUG:clap:usage::needs_flags_tag:iter: f=hclap_help;
DEBUG:clap:usage::needs_flags_tag:iter: f=vclap_version;
DEBUG:clap:usage::needs_flags_tag: [FLAGS] not required
DEBUG:clap:usage::create_help_usage: usage=stem
DEBUG:clap:Help::write_all_args;
DEBUG:clap:Help::write_args;
DEBUG:clap:Help::write_args: Current Longest...2
DEBUG:clap:Help::write_args: New Longest...6
DEBUG:clap:Help::write_args: Current Longest...6
DEBUG:clap:Help::write_args: New Longest...9
DEBUG:clap:Help::write_arg;
DEBUG:clap:Help::short;
DEBUG:clap:Help::long;
DEBUG:clap:Help::val: arg=--help
DEBUG:clap:Help::spec_vals: a=--help
DEBUG:clap:Help::val: Has switch...Yes
DEBUG:clap:Help::val: force_next_line...false
DEBUG:clap:Help::val: nlh...false
DEBUG:clap:Help::val: taken...21
DEBUG:clap:Help::val: help_width > (width - taken)...23 > (120 - 21)
DEBUG:clap:Help::val: longest...9
DEBUG:clap:Help::val: next_line...No
DEBUG:clap:write_spaces!: num=7
DEBUG:clap:Help::help;
DEBUG:clap:Help::help: Next Line...false
DEBUG:clap:Help::help: Too long...No
DEBUG:clap:Help::write_arg;
DEBUG:clap:Help::short;
DEBUG:clap:Help::long;
DEBUG:clap:Help::val: arg=--version
DEBUG:clap:Help::spec_vals: a=--version
DEBUG:clap:Help::val: Has switch...Yes
DEBUG:clap:Help::val: force_next_line...false
DEBUG:clap:Help::val: nlh...false
DEBUG:clap:Help::val: taken...21
DEBUG:clap:Help::val: help_width > (width - taken)...26 > (120 - 21)
DEBUG:clap:Help::val: longest...9
DEBUG:clap:Help::val: next_line...No
DEBUG:clap:write_spaces!: num=4
DEBUG:clap:Help::help;
DEBUG:clap:Help::help: Next Line...false
DEBUG:clap:Help::help: Too long...No
stem 0.1.0
Sharlatan <sharlatanus@gmail.com>
Collecting system level information such as hardware and OS stats.

<p>USAGE:
stem</p>
<p>FLAGS:
-h, --help       Prints help information
-V, --version    Prints version information</p>
</code>
</pre>
</details>

</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "YAML not parsed when when name, version, author, about not specified in it" to "YAML not parsed when name, version, author, about not specified in it" by @Hellseher on 2018-09-07 18:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/evanjs">@evanjs</a> on 2019-03-22 16:24</div>
            <div class="timeline-body"><p>I was able to work around this by specifying <em>only</em> the name in yml and the remaining properties via the crate! macros.
Not sure what other combinations work, but I feel like what is happening should at least be more clear.  Between this and the <a href="https://github.com/chyh1990/yaml-rust/issues/101">indentation thing</a> I've spent quite some time confused as the app compiles fine but the yml might completely be ignored.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-02-02 05:42</div>
            <div class="timeline-body"><p>I would say this is how it's supposed to work.</p>
<ul>
<li>No field - no version/auther/about/etc at all</li>
<li><code>version: crate_version!()</code> - derive it from Cargo.toml</li>
<li>The <code>name</code> field is mandatory, you can't omit it. Full stop. If you want it to be derived - use <code>name: crate_name!()</code></li>
</ul>
<p>But I agree this should be documented better.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: docs</span> added by @CreepySkeleton on 2020-02-02 05:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C: yaml parser</span> added by @CreepySkeleton on 2020-02-02 05:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">good first issue</span> added by @CreepySkeleton on 2020-02-02 05:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @CreepySkeleton on 2020-02-02 05:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">P4: nice to have</span> added by @CreepySkeleton on 2020-02-02 05:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">T: enhancement</span> added by @CreepySkeleton on 2020-02-02 05:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> added by @CreepySkeleton on 2020-02-02 05:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> added by @CreepySkeleton on 2020-02-02 05:43</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Added to milestone "3.1" by @CreepySkeleton on 2020-02-02 05:43</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ilyvion">@ilyvion</a> on 2020-04-17 18:30</div>
            <div class="timeline-body"><p>I'm in a somewhat similar situation, didn't feel different enough to create a whole new issue. I do this in my code:</p>
<pre><code class="language-rust">let matches = App::from_yaml(yaml)
    .name(Game::GAME_ID)
    .version(Game::VERSION)
    .author(Game::AUTHOR)
    .about(Game::DESCRIPTION)
    .get_matches();
</code></pre>
<p>Since I set all those there, I figured I could leave them out of the YAML file. But no. <code>name</code> is mandatory in the YAML, <em>even if</em> you provide it some other way. So for now, my YAML file looks like this:</p>
<pre><code class="language-yaml">name: required_for_some_reason_even_though_it_is_defined_in_code
args:
  - ...
</code></pre>
<p>ðŸ˜œ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/CreepySkeleton">@CreepySkeleton</a> on 2020-04-18 02:11</div>
            <div class="timeline-body"><p>@alexschrod Well, this is inevitable. <code>clap::App</code> needs a name because it's a central concept - there's no application without a name. So, in order to being able to create an <code>App</code>, the YAML loader needs a name. There's also no way for it to know that you are going to override it in your code one line below.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 2.x</span> removed by @pksunkara on 2020-10-26 07:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../issues/2378.html">clap-rs/clap#2378</a> on 2021-03-02 17:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">W: 3.x</span> removed by @pksunkara on 2021-05-31 18:25</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Referenced in <a href="../../epage/clapng/issues/102.html">epage/clapng#102</a> on 2021-12-06 17:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-08 20:01</div>
            <div class="timeline-body"><p>We have decided to deprecate the YAML API.  For more details, see https://github.com/clap-rs/clap/issues/3087.  If there is interest in a YAML API, it will likely be broken out into a <code>clap_yaml</code> and developed independent from the core of clap.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2021-12-08 20:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:33:51 UTC
    </footer>
</body>
</html>
