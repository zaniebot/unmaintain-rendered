<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mutual exclusion of groups of args - clap-rs/clap #5253</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Mutual exclusion of groups of args</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/clap-rs/clap/issues/5253">#5253</a>
        opened by <a href="https://github.com/johnrichardrinehart">@johnrichardrinehart</a>
        on 2023-12-08 23:53
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/johnrichardrinehart">@johnrichardrinehart</a> on 2023-12-08 23:53</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/issues">open</a> and <a href="https://github.com/clap-rs/clap/issues?q=is%3Aissue+label%3AS-wont-fix+is%3Aclosed">rejected</a> issues</li>
</ul>
<h3>Clap Version</h3>
<p>4.4.8</p>
<h3>Describe your use case</h3>
<p>I'm building an app which compares two commits on a GitHub repo. I want to support users either passing <code>rev1</code> and <code>rev2</code> for comparison or I want them to be able to pass the <code>pr</code> number. So, in terms of <code>clap</code> Usage text I'd have something like</p>
<pre><code>&lt;--rev1 &lt;REV1&gt; --rev2 &lt;REV2&gt; | --pr &lt;PR&gt;&gt;
</code></pre>
<h3>Describe the solution you'd like</h3>
<p>I'd like to be able to combine <code>ArgGroup</code> and <code>required</code> statements in such a way as to accomplish the above.</p>
<h3>Alternatives, if applicable</h3>
<p><em>No response</em></p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-enhancement</span> added by @johnrichardrinehart on 2023-12-08 23:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-12-11 16:44</div>
            <div class="timeline-body"><p>I believe this is a duplicate of #5041.  Closing in favor of that.  If there is something I missed, let us know!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2023-12-11 16:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/johnrichardrinehart">@johnrichardrinehart</a> on 2023-12-16 02:34</div>
            <div class="timeline-body"><p>Thanks, @epage . My concern is a bit different than #5041 . My concern is around the generated usage text, not the runtime evaluation of the provided arguments.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @epage on 2023-12-17 01:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2023-12-17 01:14</div>
            <div class="timeline-body"><p>Could you add a minimal reproduction case of the situation you are interested in and contrast the existing behavior with the behavior you would want?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/imp">@imp</a> on 2025-08-29 09:22</div>
            <div class="timeline-body"><p>I think I am hitting the same issue: mutual exclusion works great for a group of args, but doesn't work for a nested group.</p>
<p>See below the code that demonstrates the problem with latest clap (4.5.46 as of this writing).</p>
<pre><code class="language-Rust">use clap::{Args, CommandFactory, Parser};

#[derive(Debug, Parser)]
struct Cli1 {
    #[command(flatten)]
    arg: ArgGroup,
}

#[derive(Debug, Args)]
#[group(multiple = false, required = true)]
struct ArgGroup {
    #[arg(long)]
    foo: String,
    #[arg(long)]
    bar: String,
}

#[derive(Debug, Parser)]
struct Cli2 {
    #[command(flatten)]
    arg: ArgSuperGroup,
}

#[derive(Debug, Args)]
#[group(multiple = false, required = true)]
struct ArgSuperGroup {
    #[command(flatten)]
    arg1: ArgGroup1,
    #[command(flatten)]
    arg2: ArgGroup2,
}

#[derive(Debug, Args)]
struct ArgGroup1 {
    #[arg(long)]
    foo: String,
    #[arg(long)]
    bar: String,
}

#[derive(Debug, Args)]
struct ArgGroup2 {
    #[arg(long)]
    baz: String,
    #[arg(long)]
    qux: String,
}

fn main() {
    println!(&quot;{}&quot;, Cli1::command().render_usage());
    println!(&quot;{}&quot;, Cli2::command().render_usage());
}

</code></pre>
<p>running it produces:</p>
<pre><code>Usage: demo &lt;--foo &lt;FOO&gt;|--bar &lt;BAR&gt;&gt;
Usage: demo --foo &lt;FOO&gt; --bar &lt;BAR&gt; --baz &lt;BAZ&gt; --qux &lt;QUX&gt; &lt;&gt;
</code></pre>
<p>So for the <code>Cli1</code> it groks correctly that <code>foo</code> and <code>bar</code> args are mutually exclusive parts of the group. However, if I want to have a group of mutually exclusive arguments - that doesn't work.
I.e. I was expecting to get something like</p>
<pre><code>Usage: demo &lt;--foo &lt;FOO&gt; --bar &lt;BAR&gt;&gt;|&lt;--baz &lt;BAZ&gt; --qux &lt;QUX&gt;&gt;
</code></pre>
<p>(Also note there is spurious <code>&lt;&gt;</code> at the end of the generated usage text in the second case)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-10 01:35:32 UTC
    </footer>
</body>
</html>
