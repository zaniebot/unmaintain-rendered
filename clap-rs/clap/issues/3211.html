<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regression: Subcommand attribute not supported for unit type - clap-rs/clap #3211</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Regression: Subcommand attribute not supported for unit type</h1>

    <div class="meta">
        <span class="state state-closed">Closed</span>
        <a href="https://github.com/clap-rs/clap/issues/3211">#3211</a>
        opened by <a href="https://github.com/dunnock">@dunnock</a>
        on 2021-12-23 16:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header">Issue opened by <a href="https://github.com/dunnock">@dunnock</a> on 2021-12-23 16:16</div>
            <div class="timeline-body"><h3>Please complete the following tasks</h3>
<ul>
<li>[X] I have searched the <a href="https://github.com/clap-rs/clap/discussions">discussions</a></li>
<li>[X] I have searched the existing issues</li>
</ul>
<h3>Rust Version</h3>
<p>rustc 1.57.0 (f1edd0429 2021-11-29)</p>
<h3>Clap Version</h3>
<p>3.0.0-rc.7</p>
<h3>Minimal reproducible code</h3>
<pre><code class="language-rust">use clap::{Parser, Subcommand};                                                                                                                        
  
  #[derive(Parser)]                                                                                                                        
  struct Opt {                                                            
      #[clap(subcommand)]                                                 
      cmd: CmdOptions,
  }                                                                       
                                                              
 #[derive(Subcommand)]   //  ■ proc-macro derive produced unparseable tokens                                                                                                                        
  enum CmdOptions {
      CmdStruct {          
          #[clap(subcommand)]                                                                                                                                                                                                               
          cmd: Cmd2      
      },                                                                                                                                                                                                                 
     CmdUnit(#[clap(subcommand)] Cmd2)   //  ■ expected type, found `#`  expected type                                                                                                                               
  }                                                                  
                                                                                                                                                                                              
  #[derive(Subcommand)]                                              
  enum Cmd2 {                                                                                                                        
      Command
  }

fn main() {}
</code></pre>
<h3>Steps to reproduce the bug with the above code</h3>
<p>cargo build produces compilation errors</p>
<h3>Actual Behaviour</h3>
<pre><code>❯ cargo build
   Compiling clap-derive-bug v0.1.0 (/home/maxim/src/rust/clap-derive-bug)
error: expected type, found `#`
  --&gt; src/main.rs:15:13
   |
15 |     CmdUnit(#[clap(subcommand)] Cmd2)
   |             ^ expected type

error: proc-macro derive produced unparseable tokens
 --&gt; src/main.rs:9:10
  |
9 | #[derive(Subcommand)]
  |          ^^^^^^^^^^

error: could not compile `clap-derive-bug` due to 2 previous errors
</code></pre>
<h3>Expected Behaviour</h3>
<p>#[clap(subcommand)] macro is supported for unit structs according to https://github.com/clap-rs/clap/discussions/3094</p>
<h3>Additional Context</h3>
<p><em>No response</em></p>
<h3>Debug Output</h3>
<p><em>No response</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">C-bug</span> added by @dunnock on 2021-12-23 16:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-23 16:28</div>
            <div class="timeline-body"><p>We support the attribute on the variant, not on the tuple's element, similar to <code>flatten</code>.</p>
<p>This was missing from the derive reference but I just added it, see https://github.com/clap-rs/clap/blob/master/examples/derive_ref/README.md#app-attributes</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-23 16:28</div>
            <div class="timeline-body"><p>Also, that linked discussion links out to a PR with an example: https://github.com/clap-rs/clap/pull/2587</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">S-waiting-on-author</span> added by @epage on 2021-12-23 16:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2021-12-27 16:29</div>
            <div class="timeline-body"><p>I'm assuming what I point to resolves this and am closing this out.  Feel free to say otherwise!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @epage on 2021-12-27 16:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-09 23:35:08 UTC
    </footer>
</body>
</html>
