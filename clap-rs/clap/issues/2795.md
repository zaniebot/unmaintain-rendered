```yaml
number: 2795
title: Arguments that allow multiple_occurrences(true) do not align properly with other arguments
type: issue
state: closed
author: 0x7FFFFFFFFFFFFFFF
labels:
  - C-bug
  - A-help
assignees: []
created_at: 2021-09-27T08:40:57Z
updated_at: 2021-10-09T00:01:27Z
url: https://github.com/clap-rs/clap/issues/2795
synced_at: 2026-01-10T01:57:45Z
```

# Arguments that allow multiple_occurrences(true) do not align properly with other arguments

---

_Issue opened by @0x7FFFFFFFFFFFFFFF on 2021-09-27 08:40_

### Please complete the following tasks

- [X] I have searched the [discussions](https://github.com/clap-rs/clap/discussions)
- [X] I have searched the existing issues

### Rust Version

rustc 1.54.0 (a178d0322 2021-07-26)

### Clap Version

clap = "3.0.0-beta.4"

### Minimal reproducible code

```rust
use clap::{App, Arg};

fn main() {
    let matches = App::new("test clap")
        .arg(Arg::new("seconds")
            .short('s')
            .long("seconds")
            .value_name("A NUMBER")
            .about("Produce a n-second video for testing purposes.")
            .takes_value(true)
        )
        .arg(Arg::new("minutes")
            .short('m')
            .long("minutes")
            .value_name("A NUMBER")
            .about("Produce a n-minute video for testing purposes.")
            .takes_value(true)
        )
        .arg(Arg::new("input")
            .short('i')
            .long("input")
            .value_name("INPUT")
            .about("This parameter is similar to ffmpeg's -i option")
            .takes_value(true)
            .multiple_occurrences(true)
        )
        .get_matches();
}
```


### Steps to reproduce the bug with the above code

`cargo run -- -h`

### Actual Behaviour

```
PS C:\my_projects\test\test_clap> cargo run -- -h
   Compiling test_clap v0.1.0 (C:\my_projects\test\test_clap)
    Finished dev [unoptimized + debuginfo] target(s) in 0.31s
     Running `target\debug\test_clap.exe -h`
test clap

USAGE:
    test_clap.exe [OPTIONS]

FLAGS:
    -h, --help       Print help information
    -V, --version    Print version information

OPTIONS:
    -i, --input <INPUT>...         This parameter is similar to ffmpeg's -i option
    -m, --minutes <A NUMBER>    Produce a n-minute video for testing purposes.
    -s, --seconds <A NUMBER>    Produce a n-second video for testing purposes.
PS C:\my_projects\test\test_clap>
```

### Expected Behaviour

```
PS C:\my_projects\test\test_clap> cargo run -- -h
   Compiling test_clap v0.1.0 (C:\my_projects\test\test_clap)
    Finished dev [unoptimized + debuginfo] target(s) in 0.31s
     Running `target\debug\test_clap.exe -h`
test clap

USAGE:
    test_clap.exe [OPTIONS]

FLAGS:
    -h, --help       Print help information
    -V, --version    Print version information

OPTIONS:
    -i, --input <INPUT>...      This parameter is similar to ffmpeg's -i option
    -m, --minutes <A NUMBER>    Produce a n-minute video for testing purposes.
    -s, --seconds <A NUMBER>    Produce a n-second video for testing purposes.
PS C:\my_projects\test\test_clap>
```

### Additional Context

_No response_

### Debug Output

```
PS C:\my_projects\test\test_clap> cargo run -- -h
   Compiling clap_derive v3.0.0-beta.4
   Compiling clap v3.0.0-beta.4
   Compiling test_clap v0.1.0 (C:\my_projects\test\test_clap)
    Finished dev [unoptimized + debuginfo] target(s) in 6.04s
     Running `target\debug\test_clap.exe -h`
[            clap::build::app]  App::_do_parse
[            clap::build::app]  App::_build
[            clap::build::app]  App::_propagate:test clap
[            clap::build::app]  App::_check_help_and_version
[            clap::build::app]  App::_propagate_global_args:test clap
[            clap::build::app]  App::_derive_display_order:test clap
[clap::build::app::debug_asserts]       App::_debug_asserts
[clap::build::arg::debug_asserts]       Arg::_debug_asserts:help
[clap::build::arg::debug_asserts]       Arg::_debug_asserts:version
[clap::build::arg::debug_asserts]       Arg::_debug_asserts:seconds
[clap::build::arg::debug_asserts]       Arg::_debug_asserts:minutes
[clap::build::arg::debug_asserts]       Arg::_debug_asserts:input
[         clap::parse::parser]  Parser::get_matches_with
[         clap::parse::parser]  Parser::_build
[         clap::parse::parser]  Parser::_verify_positionals
[         clap::parse::parser]  Parser::get_matches_with: Begin parsing '"-h"' ([45, 104])
[         clap::parse::parser]  Parser::get_matches_with: Positional counter...1
[         clap::parse::parser]  Parser::get_matches_with: Low index multiples...false
[         clap::parse::parser]  Parser::possible_subcommand: arg="-h"
[         clap::parse::parser]  Parser::get_matches_with: sc=None
[         clap::parse::parser]  Parser::parse_short_arg: full_arg="-h"
[         clap::parse::parser]  Parser::parse_short_arg:iter:h
[         clap::parse::parser]  Parser::parse_short_arg:iter:h: cur_idx:=1
[         clap::parse::parser]  Parser::parse_short_arg:iter:h: Found valid opt or flag
[         clap::parse::parser]  Parser::check_for_help_and_version_char
[         clap::parse::parser]  Parser::check_for_help_and_version_char: Checking if -h is help or version...
[         clap::parse::parser]  Help
[         clap::parse::parser]  Parser::get_matches_with: After parse_short_arg HelpFlag
[         clap::parse::parser]  Parser::help_err: use_long=false
[         clap::parse::parser]  Parser::color_help
[          clap::output::help]  Help::new
[          clap::output::help]  Help::write_help
[          clap::output::help]  should_show_arg: use_long=false, arg=help
[          clap::output::help]  should_show_arg: use_long=false, arg=seconds
[          clap::output::help]  Help::write_templated_help
[          clap::output::help]  Help::write_before_help
[          clap::output::help]  Help::write_bin_name
[         clap::output::usage]  Usage::create_usage_no_title
[         clap::output::usage]  Usage::create_help_usage; incl_reqs=true
[         clap::output::usage]  Usage::get_required_usage_from: incls=[], matcher=false, incl_last=false
[         clap::output::usage]  Usage::get_required_usage_from: unrolled_reqs=[]
[         clap::output::usage]  Usage::get_required_usage_from: ret_val=[]
[         clap::output::usage]  Usage::needs_flags_tag
[         clap::output::usage]  Usage::needs_flags_tag:iter: f=help
[         clap::output::usage]  Usage::needs_flags_tag:iter: f=version
[         clap::output::usage]  Usage::needs_flags_tag: [FLAGS] not required
[         clap::output::usage]  Usage::create_help_usage: usage=test_clap.exe [OPTIONS]
[          clap::output::help]  Help::write_all_args
[          clap::output::help]  should_show_arg: use_long=false, arg=help
[          clap::output::help]  should_show_arg: use_long=false, arg=version
[          clap::output::help]  should_show_arg: use_long=false, arg=seconds
[          clap::output::help]  should_show_arg: use_long=false, arg=minutes
[          clap::output::help]  should_show_arg: use_long=false, arg=input
[          clap::output::help]  Help::write_args
[          clap::output::help]  should_show_arg: use_long=false, arg=help
[          clap::output::help]  Help::write_args: Current Longest...2
[          clap::output::help]  Help::write_args: New Longest...6
[          clap::output::help]  should_show_arg: use_long=false, arg=version
[          clap::output::help]  Help::write_args: Current Longest...6
[          clap::output::help]  Help::write_args: New Longest...9
[          clap::output::help]  should_show_arg: use_long=false, arg=help
[          clap::output::help]  Help::spec_vals: a=--help
[          clap::output::help]  should_show_arg: use_long=false, arg=version
[          clap::output::help]  Help::spec_vals: a=--version
[          clap::output::help]  Help::spec_vals: a=--help
[          clap::output::help]  Help::short
[          clap::output::help]  Help::long
[          clap::output::help]  Help::val: arg=help
[          clap::output::help]  Help::val: Has switch...
[          clap::output::help]  Yes
[          clap::output::help]  Help::val: nlh...false
[          clap::output::help]  Help::help
[          clap::output::help]  Help::help: Next Line...false
[          clap::output::help]  Help::help: Too long...
[          clap::output::help]  No
[          clap::output::help]  Help::spec_vals: a=--version
[          clap::output::help]  Help::short
[          clap::output::help]  Help::long
[          clap::output::help]  Help::val: arg=version
[          clap::output::help]  Help::val: Has switch...
[          clap::output::help]  Yes
[          clap::output::help]  Help::val: nlh...false
[          clap::output::help]  Help::help
[          clap::output::help]  Help::help: Next Line...false
[          clap::output::help]  Help::help: Too long...
[          clap::output::help]  No
[          clap::output::help]  Help::write_args
[          clap::output::help]  should_show_arg: use_long=false, arg=seconds
[          clap::output::help]  Help::write_args: Current Longest...2
[          clap::output::help]  Help::write_args: New Longest...20
[          clap::output::help]  should_show_arg: use_long=false, arg=minutes
[          clap::output::help]  Help::write_args: Current Longest...20
[          clap::output::help]  Help::write_args: New Longest...20
[          clap::output::help]  should_show_arg: use_long=false, arg=input
[          clap::output::help]  Help::write_args: Current Longest...20
[          clap::output::help]  Help::write_args: New Longest...20
[          clap::output::help]  should_show_arg: use_long=false, arg=seconds
[          clap::output::help]  Help::spec_vals: a=--seconds <A NUMBER>
[          clap::output::help]  should_show_arg: use_long=false, arg=minutes
[          clap::output::help]  Help::spec_vals: a=--minutes <A NUMBER>
[          clap::output::help]  should_show_arg: use_long=false, arg=input
[          clap::output::help]  Help::spec_vals: a=--input <INPUT>
[          clap::output::help]  Help::spec_vals: a=--input <INPUT>
[          clap::output::help]  Help::short
[          clap::output::help]  Help::long
[          clap::output::help]  Help::val: arg=input
[          clap::output::help]  Help::val: Has switch...
[          clap::output::help]  Yes
[          clap::output::help]  Help::val: nlh...false
[          clap::output::help]  Help::help
[          clap::output::help]  Help::help: Next Line...false
[          clap::output::help]  Help::help: Too long...
[          clap::output::help]  No
[          clap::output::help]  Help::spec_vals: a=--minutes <A NUMBER>
[          clap::output::help]  Help::short
[          clap::output::help]  Help::long
[          clap::output::help]  Help::val: arg=minutes
[          clap::output::help]  Help::val: Has switch...
[          clap::output::help]  Yes
[          clap::output::help]  Help::val: nlh...false
[          clap::output::help]  Help::help
[          clap::output::help]  Help::help: Next Line...false
[          clap::output::help]  Help::help: Too long...
[          clap::output::help]  No
[          clap::output::help]  Help::spec_vals: a=--seconds <A NUMBER>
[          clap::output::help]  Help::short
[          clap::output::help]  Help::long
[          clap::output::help]  Help::val: arg=seconds
[          clap::output::help]  Help::val: Has switch...
[          clap::output::help]  Yes
[          clap::output::help]  Help::val: nlh...false
[          clap::output::help]  Help::help
[          clap::output::help]  Help::help: Next Line...false
[          clap::output::help]  Help::help: Too long...
[          clap::output::help]  No
[          clap::output::help]  Help::write_after_help
[           clap::output::fmt]  is_a_tty: stderr=false
test clap

USAGE:
    test_clap.exe [OPTIONS]

FLAGS:
    -h, --help       Print help information
    -V, --version    Print version information

OPTIONS:
    -i, --input <INPUT>...         This parameter is similar to ffmpeg's -i option
    -m, --minutes <A NUMBER>    Produce a n-minute video for testing purposes.
    -s, --seconds <A NUMBER>    Produce a n-second video for testing purposes.
PS C:\my_projects\test\test_clap>
```

---

_Label `T: bug` added by @0x7FFFFFFFFFFFFFFF on 2021-09-27 08:40_

---

_Added to milestone `3.0` by @ldm0 on 2021-09-27 08:51_

---

_Comment by @pksunkara on 2021-10-01 00:19_

@ldm0 Why is this 3.0? It's just help message bug which is non-breaking.

---

_Label `:money_with_wings: $5` added by @pksunkara on 2021-10-01 00:20_

---

_Label `C: help message` added by @pksunkara on 2021-10-01 00:20_

---

_Removed from milestone `3.0` by @pksunkara on 2021-10-01 00:20_

---

_Comment by @epage on 2021-10-01 13:57_

Did this work before https://github.com/clap-rs/clap/pull/2701?  I could see keeping this in 3.0 if its a regression

---

_Comment by @pksunkara on 2021-10-01 14:09_

We can always do a follow-up as a patch/minor release.

---

_Comment by @epage on 2021-10-01 14:18_

Yes, we can.  If this is a regression, we just need to decide what level of rough edges is acceptable or not.

---

_Comment by @epage on 2021-10-04 17:21_

Yes, this is a regression
```rust
use clap::{App, Arg};

fn main() {
    let matches = App::new("test clap")
        .arg(
            Arg::with_name("seconds")
                .short("s")
                .long("seconds")
                .value_name("A NUMBER")
                .help("Produce a n-second video for testing purposes.")
                .takes_value(true),
        )
        .arg(
            Arg::with_name("minutes")
                .short("m")
                .long("minutes")
                .value_name("A NUMBER")
                .help("Produce a n-minute video for testing purposes.")
                .takes_value(true),
        )
        .arg(
            Arg::with_name("input")
                .short("i")
                .long("input")
                .value_name("INPUT")
                .help("This parameter is similar to ffmpeg's -i option")
                .takes_value(true)
                .multiple(true),
        )
        .get_matches();
}
```
```
test clap 

USAGE:
    bar [OPTIONS]

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

OPTIONS:
    -i, --input <INPUT>...      This parameter is similar to ffmpeg's -i option
    -m, --minutes <A NUMBER>    Produce a n-minute video for testing purposes.
    -s, --seconds <A NUMBER>    Produce a n-second video for testing purposes.
```

---

_Comment by @epage on 2021-10-04 17:43_

Oh, I forgot #2701  wasn't in beta.4.  That fixed this problem.  We had two different locations where the logic existed and one said `...` shouldn't be used for `multiple_occurrences` but the other one said it should be used which led to the discrepancy.  #2701 consolidated these code paths so our logic consistently knows multiple_occurrences should not have `...`.

---

_Closed by @epage on 2021-10-04 17:43_

---

_Label `:money_with_wings: $5` removed by @pksunkara on 2021-10-09 00:01_

---
