<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support file substitutions - zanieb/rooster #73</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support file substitutions</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/zanieb/rooster/pull/73">#73</a>
        opened by <a href="https://github.com/samypr100">@samypr100</a>
        on 2025-08-12 01:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/samypr100">@samypr100</a></div>
            <div class="timeline-body"><p>In order to support https://github.com/astral-sh/uv/pull/15196</p>
<p>This adds initial support to rooster for file substitutions.</p>
<p>Replace old version with new version in README.md using the special substitution string <code>rooster.previous</code>.</p>
<pre><code class="language-toml">[tool.rooster]
...
substitution_files = { &quot;README.md&quot;  = [&quot;rooster.previous&quot;] }
</code></pre>
<p>or</p>
<p>Replace FOO and BAR with the new version on all md files.</p>
<pre><code class="language-toml">[tool.rooster]
...
substitution_files = { &quot;**/*.md&quot;  = [&quot;FOO&quot;, &quot;BAR&quot;] }
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-12 02:26</div>
            <div class="timeline-body"><p>I might prefer something like</p>
<pre><code>substitution-files = [&quot;README.md&quot;, {file = &quot;**/*.md&quot;, replace = &quot;foo&quot;}]
</code></pre>
<p>So we don't need to add the special <code>rooster.previous</code> string? wdyt?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2025-08-12 02:45</div>
            <div class="timeline-body"><blockquote>
<p>I might prefer something like</p>
<pre><code>substitution-files = [&quot;README.md&quot;, {file = &quot;**/*.md&quot;, replace = &quot;foo&quot;}]
</code></pre>
<p>So we don't need to add the special <code>rooster.previous</code> string? wdyt?</p>
</blockquote>
<p>We can also assume the behavior of &quot;rooster.previous&quot; if the substitution array is empty? Since right now this also works:</p>
<pre><code class="language-toml">[tool.rooster]
...
substitution_files = { &quot;**/*.md&quot;  = [&quot;rooster.previous&quot;, &quot;FOO&quot;, &quot;BAR&quot;], &quot;README.md&quot;  = [&quot;BAZ&quot;] }
</code></pre>
<p>I didn't add single file support because I feel that's covered by <code>version_files</code>, or is your intent to supersede it by this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2025-08-12 02:48</div>
            <div class="timeline-body"><p>I do get <code>rooster.previous</code> may feel weird though ðŸ˜…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zanieb">@zanieb</a> on 2025-08-12 02:53</div>
            <div class="timeline-body"><p>Oh I see â€” sorry I don't know my own APIs here. Yeah, I think I'd replace <code>version_files</code>? Or at least, I wouldn't have two settings that do such similar things. I think if we did a generic substitution I'd expect more like..</p>
<pre><code>substitutions = [ {find = &quot;rooster.previous&quot;, replace = &quot;rooster.next&quot;, files = &quot;**/*.md&quot;} ]
</code></pre>
<p>I don't know if I really want that yet though, so maybe we should just add some functionality to <code>version_files</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2025-08-12 03:19</div>
            <div class="timeline-body"><p>I ended up going ahead and adding support to replacements to the existing <code>version_files</code> like you proposed originally.</p>
<p>This will work now:</p>
<pre><code class="language-toml">version_files = [ 
    &quot;README.md&quot;, # Existing functionality
    { target = &quot;**/*.md&quot; },  # Replaces all prev versions with new version on all matches
    { target = &quot;**/*.md&quot;, replace = &quot;FOO&quot; } # Replaces all instances of FOO with new version on all matches
]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2025-08-13 02:31</div>
            <div class="timeline-body"><p>Note, I chose <code>target</code> over <code>file</code> for the glob as it felt weird to name a glob pattern parameter <code>file</code> but I can switch to <code>file</code> if that's preferred.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/samypr100">@samypr100</a> on 2025-08-26 16:05</div>
            <div class="timeline-body"><p>Sorry for the ping as you're very busy; thoughts here? ðŸ˜„</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zanieb">@zanieb</a> approved on 2025-08-26 16:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @zanieb on 2025-08-26 16:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @zanieb on 2025-08-26 16:14</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2025-08-26 16:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 17:50:00 UTC
    </footer>
</body>
</html>
