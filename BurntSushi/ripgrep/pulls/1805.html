<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compile under WASI - BurntSushi/ripgrep #1805</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Compile under WASI</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/pull/1805">#1805</a>
        opened by <a href="https://github.com/jcaesar">@jcaesar</a>
        on 2021-02-16 15:50
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jcaesar">@jcaesar</a></div>
            <div class="timeline-body"><p>Hi, and thank you for this awesome tool.</p>
<p>I'm currently playing around with porting some <a href="https://zaiste.net/posts/shell-commands-rust/">Rust Alternative Command Line Tools</a> to wasm32-wasi. For most tools, this requires some rather unsavoury code changes, but rg is a pretty exception. So I decided to see if you don't want to add support for wasi as a compilation target.</p>
<p>I did say &quot;pretty&quot;, but there are some points…</p>
<ul>
<li>memmap2 does not want to compile under anything except windows and unix (<a href="https://github.com/RazrFalcon/memmap2-rs/pull/10#issuecomment-778788586">conscious decision</a>), so it requires some macros</li>
<li>I did default <code>is_readable_stdin</code> to false on unsupported platforms (because same_file returns errors on unsupported platforms, and imp translates errors to false), but I'm not sure that is correct. Would it be better to panic, or leave the function unimplemented on unsupported platforms?</li>
<li>PCRE2 won't build since it requires(?) pthreads</li>
<li>Cross can't run tests on wasm32-wasi</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-02-18 12:03</div>
            <div class="timeline-body"><p>Thanks for the PR. Could you say why you want to do this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jcaesar">@jcaesar</a> on 2021-02-21 14:11</div>
            <div class="timeline-body"><p>Why <strong>I</strong> want to do this? I suppose I'm intrigued by the idea of system-independent binaries.</p>
<p>But if you're asking what the benefits of merging this are… admittedly rather thin. To run wasm/wasi binaries, you do need a runtime like wasmtime, wasmer, or lucet, and those aren't (yet?) easily available through distros or installed on your typical windows machine. So for now, this would be a rather niche way of using ripgrep.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-02-21 14:25</div>
            <div class="timeline-body"><p>All righty. I would like to hold off then until there is a more concrete use case for running ripgrep in this way.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2021-02-21 14:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jcaesar">@jcaesar</a> on 2021-05-25 02:39</div>
            <div class="timeline-body"><p>(It seems that mmap2 will now (v0.2.3) compile under WASI. In case this gets reconsidered, the only remaining necessary change is to <code>crates/cli/src/lib.rs </code>.)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 18:28:16 UTC
    </footer>
</body>
</html>
