<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cli: add rg-gen binary for cross-compilation doc generation - BurntSushi/ripgrep #3247</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>cli: add rg-gen binary for cross-compilation doc generation</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/pull/3247">#3247</a>
        opened by <a href="https://github.com/OctopusET">@OctopusET</a>
        on 2025-12-16 08:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/OctopusET">@OctopusET</a></div>
            <div class="timeline-body"><p>When cross-compiling ripgrep, distributions need to generate man pages and shell completions. Currently this requires running the target binary, which is not possible on the host machine.</p>
<p>For example, Gentoo&#x27;s ebuild does this at install time:
https://github.com/gentoo/gentoo/blob/master/sys-apps/ripgrep/ripgrep-15.1.0.ebuild#L105</p>
<p>This fails during cross-compilation because rg is built for target, not host:</p>
<pre><code>$(cargo_target_dir)/rg --generate man
</code></pre>
This PR adds rg-gen, a minimal binary that only generates docs:
<pre><code># Build minimal generator for host
cargo build --bin rg-gen --no-default-features

# Or use the cargo alias
cargo rg-gen
</code></pre>
<pre><code># Generate docs
./rg-gen man &gt; rg.1
./rg-gen complete-bash &gt; rg.bash
./rg-gen complete-zsh &gt; _rg
./rg-gen complete-fish &gt; rg.fish
</code></pre>
Changes
<ul>
<li>Add <code>cli</code> feature to gate CLI-only modules</li>
<li>Add <code>rg-gen</code> binary that shares code with <code>rg</code></li>
<li>Add cargo alias for convenience</li>
</ul>
Notes
<ul>
<li><code>cargo run</code> still runs <code>rg</code> by default</li>
<li>All existing tests pass</li>
<li>Output is identical to <code>rg --generate</code></li>
<li>https://github.com/OctopusET/ripgrep/tree/rg-gen-crate different approach using separate crate</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-12-16 13:54</div>
            <div class="timeline-body"><p>I&#x27;m not sure this is really something I want to maintain. In particular, it&#x27;s unclear to me what alternatives have been pursued. If you&#x27;re cross-compiling, why not just build ripgrep on the host and generate docs for it? If you absolutely must run it on the target, then you can do what ripgrep&#x27;s CI does and use qemu.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/OctopusET">@OctopusET</a> on 2025-12-16 13:57</div>
            <div class="timeline-body"><blockquote>
<p>why not just build ripgrep on the host and generate docs for it?</p>
</blockquote>
<p>It&#x27;s totally possible. But what I did is, made the ripgrep able to build with only doc and *sh completion generate parts</p>
<blockquote>
<p>If you absolutely must run it on the target, then you can do what ripgrep&#x27;s CI does and use qemu.</p>
</blockquote>
<p>It won&#x27;t run on target, it&#x27;s for the host. So we can build the docs and *sh completions</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/OctopusET">@OctopusET</a> on 2025-12-16 13:59</div>
            <div class="timeline-body"><p>I just wanted to make the host binary as small as possible when we crosscompile</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-12-16 14:10</div>
            <div class="timeline-body"><p>I don&#x27;t think this is worth the effort to maintain, sorry. I don&#x27;t want to deal with two binaries. Test two binaries. And have the conditional compilation cfgs all over.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-12-16 14:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/OctopusET">@OctopusET</a> on 2025-12-16 14:14</div>
            <div class="timeline-body"><p>no worries, thank you for reviewing</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:21 UTC
    </footer>
</body>
</html>
