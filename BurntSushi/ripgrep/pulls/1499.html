<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>add engine option to easily switch between regexp engines - BurntSushi/ripgrep #1499</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>add engine option to easily switch between regexp engines</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/pull/1499">#1499</a>
        opened by <a href="https://github.com/pierreN">@pierreN</a>
        on 2020-02-27 11:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/pierreN">@pierreN</a></div>
            <div class="timeline-body"><p>This is the commits corresponding to https://github.com/BurntSushi/ripgrep/issues/1488</p>
<p>I tried to not change any default behavior of the options.</p>
<p>If I've done things correctly, the only thing that should change is when using the &quot;auto-hybrid-regex&quot; option without pcre2 feature enabled, an additional error message stating that pcre2 is not enabled should appear.</p>
<p>Thanks !</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pierreN">@pierreN</a> on 2020-02-27 12:26</div>
            <div class="timeline-body"><p>Tests should be fine now ? Unsure if I'm missing something or.. ?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/core/app.rs</code>:1205 on 2020-02-27 12:35</div>
            <div class="timeline-body"><p>Could this be written in prose? i.e.,</p>
<blockquote>
<p>Accepted values are 'default', 'pcre2' or 'auto-hybrid'.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/core/app.rs</code>:1209 on 2020-02-27 12:35</div>
            <div class="timeline-body"><p>&quot;as look-around or backreferences&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/core/app.rs</code>:1211 on 2020-02-27 12:36</div>
            <div class="timeline-body"><p>Should be <code>'--auto-hybrid-regex'</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/core/app.rs</code>:1215 on 2020-02-27 12:36</div>
            <div class="timeline-body"><p>Also should be <code>'--auto-hybrid-regex'</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/core/app.rs</code>:1222 on 2020-02-27 12:38</div>
            <div class="timeline-body"><p>Hmm, so I think this is not quite right. I think we want this to explicitly say that it overrides the <code>--pcre2</code> and <code>--auto-hybrid-regex</code> flags. (And vice versa for them.) Otherwise, something like <code>--pcre2 --engine default</code> would still use PCRE2 instead of what it should do: use the default engine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-02-27 12:40</div>
            <div class="timeline-body"><p>Not sure what's going on with CI. Could you try deleting</p>
<p>https://github.com/BurntSushi/ripgrep/blob/ecec6147d117da638c933cf103a3ea14ce87102d/.github/workflows/ci.yml#L89-L90</p>
<p>and</p>
<p>https://github.com/BurntSushi/ripgrep/blob/ecec6147d117da638c933cf103a3ea14ce87102d/.github/workflows/ci.yml#L188-L189</p>
<p>And see if that helps.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/core/args.rs</code>:588 on 2020-02-27 12:41</div>
            <div class="timeline-body"><p>Could you create errors in a way that is consistent with the surrounding code? e.g., <code>From::from(format!(&quot;...&quot;))</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/core/args.rs</code>:623 on 2020-02-27 12:41</div>
            <div class="timeline-body"><p>Looks like this will fit on one line?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/core/args.rs</code>:658 on 2020-02-27 12:46</div>
            <div class="timeline-body"><p>It looks like this should fit on one line?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/core/args.rs</code>:588 on 2020-02-27 12:48</div>
            <div class="timeline-body"><p>Actually, now that I think about it, you should just be able to call <code>unwrap()</code> here since <code>engine</code> has a default value.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/core/args.rs</code>:660 on 2020-02-27 12:49</div>
            <div class="timeline-body"><p>Could you please squash this commit back into the pertinent commits? I try to keep ripgrep's commit history clean, readable and linear, with tests passing on all commits. I don't always succeed, but I'd like to try. There isn't too much code here, so I think it's not too big of a pain to split these changes and squash them back into appropriate commits.</p>
<p>Although, I guess now that I say this, the commit hygiene in this PR is a bit off. It probably would have been better to start by refactoring how matchers are built and have that in one commit. And then a separate commit that actually adds the new <code>--engine</code> flag, which would include all relevant changes (including completions and docs and tests).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/core/app.rs</code>:1215 on 2020-02-27 12:50</div>
            <div class="timeline-body"><p>Changes like this should always be folded back into their corresponding commits.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>.github/workflows/ci.yml</code>:189 on 2020-02-27 12:50</div>
            <div class="timeline-body"><p>It looks like this fixed CI. Not sure why, but fine to leave this as is. (And this should be in a separate commit.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> requested changes on 2020-02-27 12:51</div>
            <div class="timeline-body"><p>Thanks very much! I left a few comments. I think most of them are minor, but the most major one is probably the commit hygiene in this PR. Fixing the small problems (squashing formatting and typo commits) is probably fairly easy. Fixing the bigger problem (intermingling a refactor with a feature addition) is probably nastier. I'd be happy to do the latter since I'm trying to be strict about keeping a clean history that's easy to read. But it might take me longer to merge this PR if so.</p>
<p>Also, please add integration tests (in top-level <code>tests</code> directory) covering this new flag. Tests should also cover flags overriding each other, e.g., <code>--pcre2 --engine default</code> should use the default engine, not <code>--pcre2</code>.</p>
<p>I'll likely just deprecate the <code>--auto-hybrid-regex</code> flag in favor of <code>--engine</code>, but I'll do that separately and it shouldn't impact anything in this PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/pierreN">@pierreN</a> reviewed on 2020-02-27 12:58</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/pierreN">@pierreN</a> on <code>crates/core/args.rs</code>:660 on 2020-02-27 12:58</div>
            <div class="timeline-body"><p>Ok yes thanks, I see what you meant by &quot;commit hygiene&quot;, seeing modifications that way does make more sense.</p>
<p>Seeing all the changes needed to be done, is it OK if we just close/throw away this PR and make a new one ? Thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/pierreN">@pierreN</a> reviewed on 2020-02-27 13:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/pierreN">@pierreN</a> on <code>crates/core/args.rs</code>:660 on 2020-02-27 13:04</div>
            <div class="timeline-body"><p>Maybe throw it away, do a first PR for the CI build, then do a second PR for the refactor+engine option ?</p>
<p>I'm actually impressed by the speed of your answers ! I will wait for your confirmation before doing that though :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2020-02-27 13:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/core/args.rs</code>:660 on 2020-02-27 13:09</div>
            <div class="timeline-body"><p>Up to you. I don't have a strong opinion. I'm happy to have you force push stuff here, but if a separate PR is easier for you, then go for it.</p>
<p>As for the CI fix, sure, a separate PR seems fine for that. Thanks. :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/core/args.rs</code>:660 on 2020-02-27 13:09</div>
            <div class="timeline-body"><blockquote>
<p>I'm actually impressed by the speed of your answers</p>
</blockquote>
<p>Thanks. I'm not always this fast though. You just happened to catch me at a good time. :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2020-02-27 13:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/pierreN">@pierreN</a> on 2020-02-27 13:19</div>
            <div class="timeline-body"><p>Thanks, then yes I'll do this as a separate PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @pierreN on 2020-02-27 13:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/pierreN">@pierreN</a> on <code>crates/core/app.rs</code>:1222 on 2020-02-27 15:09</div>
            <div class="timeline-body"><p>OK, fair point.</p>
<p>While testing now I was unsure to add the <code>engine</code> override for the <code>no-pcre2</code> and <code>no-auto-hybrid-regexp</code> since intuitively the option set <code>--engine=pcre2 --no-auto-hybrid-regex</code> should enable pcre2.</p>
<p>But since <code>--pcre2 --no-auto-hybrid-regex</code> doesn't enable <code>pcre2</code> neither, I guess it's just better to keep backward compatibility with default options and add overrides everywhere.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/pierreN">@pierreN</a> reviewed on 2020-02-27 15:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2020-02-27 15:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/core/app.rs</code>:1222 on 2020-02-27 15:17</div>
            <div class="timeline-body"><p>Yeah good point. Defer to backward compatibility for now. I'll take another pass over this before the next release to make sure it all makes sense.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 18:28:12 UTC
    </footer>
</body>
</html>
