<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Improves Printer - BurntSushi/ripgrep #428</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Improves Printer</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/BurntSushi/ripgrep/pull/428">#428</a>
        opened by <a href="https://github.com/kpp">@kpp</a>
        on 2017-03-30 19:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kpp">@kpp</a></div>
            <div class="timeline-body"><p>I added coloring for columns and separators. Also I fixed some bugs, when paths in context were not colored.</p>
<p><img src="http://oi63.tinypic.com/2zixans.jpg" alt="Image of usage" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/app.rs</code>:257 on 2017-03-30 19:38</div>
            <div class="timeline-body"><p>These docs also need to be added to <code>doc/rg.1.md</code> and the <code>doc/rg.1</code> file needs to be regenerated. (If it's hard for you to install pandoc, then I can do the regeneration.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/printer.rs</code>:222 on 2017-03-30 19:39</div>
            <div class="timeline-body"><p>Why change the coding style here? I much prefer early returns.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/printer.rs</code>:223 on 2017-03-30 19:40</div>
            <div class="timeline-body"><p>The previous code called out the borrowing restriction, but you removed that comment and added a <code>clone</code>. The whole point of the previous code was to avoid the <code>clone</code>. ;-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/args.rs</code>:734 on 2017-03-30 19:41</div>
            <div class="timeline-body"><p>Please see #377, which asks for colors on column numbers. What's the use case? Similarly for separators.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/printer.rs</code>:294 on 2017-03-30 19:45</div>
            <div class="timeline-body"><p>I think the braces in your closure here are superfluous.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/printer.rs</code>:312 on 2017-03-30 19:45</div>
            <div class="timeline-body"><p>I think the braces in your closure here are superfluous.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/printer.rs</code>:363 on 2017-03-30 19:45</div>
            <div class="timeline-body"><p>I think the braces in your closure here are superfluous.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/printer.rs</code>:322 on 2017-03-30 19:45</div>
            <div class="timeline-body"><p>I think the braces in your closure here are superfluous.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/printer.rs</code>:405 on 2017-03-30 19:47</div>
            <div class="timeline-body"><p>This introduces an additional allocation that wasn't there before, probably as a result of refactoring <code>path_to_str_native</code> to return a slice of bytes. Maybe it should return a cow instead?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/printer.rs</code>:363 on 2017-03-30 19:52</div>
            <div class="timeline-body"><p>OK, this happens a lot. I'll stop picking on it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> requested changes on 2017-03-30 19:54</div>
            <div class="timeline-body"><p>I think I'm mostly in favor of the changes here, although I noted a couple places where an additional allocation was added.</p>
<p>If you think you fixed bugs in the printer, then I think we need at least one regression test for each bug.</p>
<p>Finally, I'm not totally sold on adding colors for columns and separators. It seems a bit much, although, I suppose it's not a big deal. See #377.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kpp">@kpp</a> reviewed on 2017-03-30 20:28</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/kpp">@kpp</a> on <code>src/args.rs</code>:734 on 2017-03-30 20:28</div>
            <div class="timeline-body"><p>The use case is to improve readability. Color helps humans to orient. See attached image in the description of PR</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2017-03-30 20:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/args.rs</code>:734 on 2017-03-30 20:31</div>
            <div class="timeline-body"><p>Right, but if you read #377, then I'm specifically calling into question why humans are reading column numbers, especially when the match itself is colored.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kpp">@kpp</a> reviewed on 2017-03-30 20:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/kpp">@kpp</a> on <code>src/printer.rs</code>:222 on 2017-03-30 20:33</div>
            <div class="timeline-body"><p>U r the boss.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/kpp">@kpp</a> on <code>src/args.rs</code>:734 on 2017-03-30 20:39</div>
            <div class="timeline-body"><p>I don't know =( I wanted to color everything in the output...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/kpp">@kpp</a> on <code>src/printer.rs</code>:405 on 2017-03-30 20:42</div>
            <div class="timeline-body"><p>https://doc.rust-lang.org/std/primitive.slice.html#method.to_vec</p>
<p>The above <code>let mut path = path.to_vec();</code> was that allocation. I replaced for with map. No additional allocations are made by this code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/kpp">@kpp</a> on <code>src/printer.rs</code>:225 on 2017-03-30 20:46</div>
            <div class="timeline-body"><p>I thought that possibility to color it overcomes 1 additional allocation?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kpp">@kpp</a> reviewed on 2017-03-30 20:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kpp">@kpp</a> reviewed on 2017-03-30 20:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/kpp">@kpp</a> on <code>src/app.rs</code>:257 on 2017-03-30 20:55</div>
            <div class="timeline-body"><p>I will update <code>doc/rg.1.md</code>. There is only <code>pandoc=1.16.0.2</code> in my system, so do the regeneration on your on, please.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2017-03-30 20:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/printer.rs</code>:405 on 2017-03-30 20:55</div>
            <div class="timeline-body"><p>D'oh. I missed the <code>to_vec</code> in the old code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2017-03-30 20:56</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/printer.rs</code>:225 on 2017-03-30 20:56</div>
            <div class="timeline-body"><p>I don't think those are our only choices. You should be able to add color without additional allocations. The code just might be a bit more circuitous.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2017-03-30 20:57</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/args.rs</code>:734 on 2017-03-30 20:57</div>
            <div class="timeline-body"><p>I think I'd prefer if you backed out the addition of <code>column</code> and <code>separator</code> color styles. Whether we add that or not should really be decided in #377.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kpp">@kpp</a> reviewed on 2017-03-30 21:02</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/kpp">@kpp</a> on <code>src/printer.rs</code>:225 on 2017-03-30 21:02</div>
            <div class="timeline-body"><p>Will you help me? I am a rust newbie)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kpp">@kpp</a> reviewed on 2017-03-30 21:03</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/kpp">@kpp</a> on <code>src/args.rs</code>:734 on 2017-03-30 21:03</div>
            <div class="timeline-body"><p>But... the pic... prettier... =(</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2017-03-30 21:05</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/printer.rs</code>:225 on 2017-03-30 21:05</div>
            <div class="timeline-body"><p>The problem is that <code>self.separator</code> borrows <code>self</code> mutably, so you can't also send in a reference to <code>self.context_separator</code>. There are a few ways to solve this, but the simplest is to do what the old code did: duplicate the code and inline the call to <code>separator</code> manually.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2017-03-30 21:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/args.rs</code>:734 on 2017-03-30 21:07</div>
            <div class="timeline-body"><p>More features means more code that I need to maintain. For example, if we ever added code to auto-detect the best color settings (which seems like something Windows users might appreciate), then the more color settings we have, the harder that code will be to write.</p>
<p>Features need to be decided upon carefully. Once they're added, we can essentially never remove them. Sorry.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kpp">@kpp</a> on 2017-03-30 21:28</div>
            <div class="timeline-body"><p>See how it looks without colors for column and separator:</p>
<p><img src="http://oi67.tinypic.com/2lxdxsi.jpg" alt="Image of example" /></p>
<p>It is easy to mix up column <code>:22:</code> with the text itself.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-03-30 21:38</div>
            <div class="timeline-body"><p>I'm not debating whether colors makes things easier to read. ripgrep has colors already, so I obviously see the utility. What I'm trying to ascertain is whether it's worth it to add more colors. I'm trying to do that by asking for use cases for reading column numbers. I don't understand why a human would find a column number to be useful information on a regular basis. Please see the discussion in #377.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kpp">@kpp</a> on 2017-03-30 22:23</div>
            <div class="timeline-body"><p>@BurntSushi +regressions</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kpp">@kpp</a> on 2017-03-31 18:19</div>
            <div class="timeline-body"><p>@BurntSushi is there any unresolved question about this PR?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2017-03-31 18:44</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @BurntSushi on 2017-03-31 18:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2017-03-31 18:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-03-31 18:44</div>
            <div class="timeline-body"><p>Looks good, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Improves Printer, adds ColorSpecs for column and separator" to "Improves Printer" by @kpp on 2017-03-31 19:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2017-03-31 19:52</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 18:27:49 UTC
    </footer>
</body>
</html>
