<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Use exit code 2 to indicate error - BurntSushi/ripgrep #954</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Use exit code 2 to indicate error</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/BurntSushi/ripgrep/pull/954">#954</a>
        opened by <a href="https://github.com/sirreal">@sirreal</a>
        on 2018-06-18 07:34
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sirreal">@sirreal</a></div>
            <div class="timeline-body"><p>Exit code <code>1</code> was shared to indicate both &quot;no results&quot; and &quot;error.&quot; Use status code <code>2</code> to indicate errors, similar to grep&#x27;s behavior.</p>
<p>Fixes #948</p>
<p>Adds integration tests for exit codes.
Adds test helper <code>WorkDir::assert_exit_code(&amp;self, expected_code: i32, cmd: &amp;mut process::Command)</code> to match arbitrary exit codes in tests.</p>
Testing
<pre><code>cargo test exit_code
</code></pre>
Manual testing
<p>Verify that the exit code is now <code>2</code> for error:</p>
<pre><code>$ cargo run -- &#x27;*&#x27; src/main.rs ; echo &quot;Status code: $?&quot;

    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs
     Running `target/debug/rg &#x27;*&#x27; src/main.rs`
regex parse error:
    *
    ^
error: repetition operator missing expression
Status code: 2
</code></pre>
<p>And remains <code>0</code> when matches are found:</p>
<pre><code>$ cargo run -- &#x27;main&#x27; src/main.rs ; echo &quot;Status code: $?&quot;

    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs
     Running `target/debug/rg main src/main.rs`
56:fn main() {
Status code: 0
</code></pre>
<p>And <code>1</code> for no matches:</p>
<pre><code>cargo run -- &#x27;this_does_not_match&#x27; src/main.rs ; echo &quot;Status code: $?&quot;


    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs
     Running `target/debug/rg this_does_not_match src/main.rs`
Status code: 1
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-06-18 12:51</div>
            <div class="timeline-body"><p>@sirreal What do you think about adding few tests for this? We should be able to capture your manual tests in <a href="https://github.com/BurntSushi/ripgrep/blob/master/tests/tests.rs">ripgrep&#x27;s integration tests</a>.</p>
<p>The test helpers themselves might need some additions to test this. For example, you might consider adding something similar to <a href="https://github.com/BurntSushi/ripgrep/blob/223d7d9846bff4a9aaf6ba84f5662a1ee7ffa900/tests/workdir.rs#L259-L274"><code>assert_err</code></a> that lets one specifically probe the exit status code. In that code, <code>o.status</code> is a <code>std::process::ExitStatus</code>, which means it should be easy to <a href="https://doc.rust-lang.org/std/process/struct.ExitStatus.html#method.code">retrieve the exit code</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sirreal">@sirreal</a> on 2018-06-18 14:16</div>
            <div class="timeline-body"><p>I was wondering about testing. I&#x27;m happy to look into that, I&#x27;ll investigate soon üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sirreal">@sirreal</a> on <code>tests/tests.rs</code>:2198 on 2018-06-18 19:15</div>
            <div class="timeline-body"><p>Should match any non-empty file</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sirreal">@sirreal</a> on <code>tests/tests.rs</code>:2208 on 2018-06-18 19:16</div>
            <div class="timeline-body"><p>Highly unlikely to match any file. 10 random hex digits repeated 10 times.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sirreal">@sirreal</a> on <code>tests/tests.rs</code>:2218 on 2018-06-18 19:16</div>
            <div class="timeline-body"><p>Invalid regex.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sirreal">@sirreal</a> reviewed on 2018-06-18 19:17</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sirreal">@sirreal</a> on 2018-06-18 19:17</div>
            <div class="timeline-body"><p>I&#x27;ve added some integration tests as suggested, I&#x27;d appreciate feedback.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/sirreal">@sirreal</a> on <code>tests/workdir.rs</code>:279 on 2018-06-18 20:04</div>
            <div class="timeline-body"><p>These <code>expect</code>s can just become <code>unwrap</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sirreal">@sirreal</a> reviewed on 2018-06-18 20:04</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2018-06-19 11:40</div>
            <div class="timeline-body"><p>Excellent! This is perfect as-is, thank you so much. :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-06-19 11:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-06-19 11:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2018-06-19 12:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sirreal">@sirreal</a> on 2018-06-19 12:54</div>
            <div class="timeline-body"><p>A pleasure! üôå</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:17 UTC
    </footer>
</body>
</html>
