<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avoid expensive check with --files - BurntSushi/ripgrep #603</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Avoid expensive check with --files</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/BurntSushi/ripgrep/pull/603">#603</a>
        opened by <a href="https://github.com/chrmarti">@chrmarti</a>
        on 2017-09-08 23:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chrmarti">@chrmarti</a></div>
            <div class="timeline-body"><p>Fixes #600</p>
<p>Stacktraces show that this check is the culprit. Listing all files in my test folder with 235k files on Windows now takes about 4.2 seconds. It didn't finish before I canceled before that when MsMpEng.exe kicked in.</p>
<p>The stacktrace:
<img src="https://user-images.githubusercontent.com/9205389/30234157-59e06de4-94af-11e7-8118-2acd48e53999.png" alt="image" /></p>
<p>/cc @BurntSushi @roblourens</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/roblourens">@roblourens</a> on 2017-09-08 23:20</div>
            <div class="timeline-body"><p>Excellent detective work @chrmarti! A little background @BurntSushi, with this change we will be able to use ripgrep to power quick open in VS Code as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chrmarti">@chrmarti</a> on 2017-09-11 15:33</div>
            <div class="timeline-body"><p>The Mac CI build failed with an empty log.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-09-18 12:56</div>
            <div class="timeline-body"><p>@chrmarti Nice detective work! I think my key issue here is that this only fixes the problem when using the <code>--files</code> flag, but based on your observations, it sounds like searching the files will result in a tremendous bottleneck.</p>
<p>So I'm not quite sure what to do. It seems like we should try to fix the root issue, but maybe it would be a good idea to just take this in for now?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/roblourens">@roblourens</a> on 2017-09-18 15:48</div>
            <div class="timeline-body"><p>I think Defender is doing the &quot;right thing&quot; here, and in text search, by scanning files when they are opened. It does cache results when possible, so this won't happen every time, but it will happen often. That was basically the result of our discussion with the Defender team. So I think the best thing we can do for now is to remove an unnecessary file open when using <code>--files</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-09-18 15:54</div>
            <div class="timeline-body"><p>@roblourens Hmm all right, that's good enough for me!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @BurntSushi on 2017-09-18 15:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2017-09-18 15:54</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 18:27:54 UTC
    </footer>
</body>
</html>
