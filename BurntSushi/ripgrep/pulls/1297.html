<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Additional nim filetypes [feature] - BurntSushi/ripgrep #1297</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Additional nim filetypes [feature]</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/BurntSushi/ripgrep/pull/1297">#1297</a>
        opened by <a href="https://github.com/hiteshjasani">@hiteshjasani</a>
        on 2019-06-11 02:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/hiteshjasani">@hiteshjasani</a></div>
            <div class="timeline-body"><p>Add nim build configuration (.nimble) and code filtering (.nimf) file types.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-06-11 11:43</div>
            <div class="timeline-body"><p>I don't use nim, but just to double check, are the build configuration and code filtering files actual Nim source code? For example, the <code>rust</code> file type does not search <code>Cargo.toml</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hiteshjasani">@hiteshjasani</a> on 2019-06-11 12:25</div>
            <div class="timeline-body"><p>That's a very good question.  Let me review how other filetypes are handled and I'll do another commit with changes.  At first blush, it may make sense to break out these files from the main nim source.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hiteshjasani">@hiteshjasani</a> on 2019-06-11 12:53</div>
            <div class="timeline-body"><p>Added two new categories:</p>
<ul>
<li><code>nimf</code> - contains nim templating</li>
<li><code>nimscript</code> - contains nimscript files and nimble files (which are nimscript files)</li>
</ul>
<p>Here's the thinking behind the new categorization.</p>
<ul>
<li><a href="https://nim-lang.org/docs/nims.html">Nimscript</a> files are a subset of nim language.  <code>.nimble</code> files are similar to <code>Rakefile</code> and <code>Makefile</code> in that they contain code as well as configuration.  They aren't part of the main codebase so it does make sense to break them out separately.</li>
<li>Templates in nim are called <a href="https://nim-lang.org/docs/filters.html">Source Code Filters</a> and use the <code>.nimf</code> extension.  They would be similar to <code>.jsp</code>, jinja templates or <code>.lhs</code>.  While they are most likely part of the main codebase, they also have extra cruft in them.  You want to be able to search them, but maybe only in certain cases.</li>
<li>There's a little inconsistency with how templating is handled in ripgrep.  For some languages such as Java, PHP or Haskell, template files (.jsp, .php, .lhs) are considered part of the source code files.  For Python, it's broken out into separate Jinja templates.  Personally I think breaking it out, when possible, is the better solution.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-06-11 13:08</div>
            <div class="timeline-body"><p>Thanks! Would you perhaps mind getting another Nim programmer or two to chime in and sign off on this? Once a new file type is created, I generally don't want to remove it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-06-11 13:11</div>
            <div class="timeline-body"><blockquote>
<p>They aren't part of the main codebase so it does make sense to break them out separately.</p>
</blockquote>
<p>This isn't quite the right calculus I think. We can't really use reasons like &quot;part of the main codebase&quot; because ripgrep doesn't have the context to make those decisions. For example, in the Rust world, there is a <code>build.rs</code> file which is normal Rust code, but is only used for build configuration and is arguably also not part of the main codebase. Nevertheless, using <code>-trust</code> will search that file.</p>
<p>Consistency isn't really the main goal here. I guess it's really about user expectations. If you specify <code>-tnim</code>, does the user expect Nimble files to be searched, since they are Nim source code? The same thing applies to templates. This is where I'd like to hear opinions from other Nim programmers.</p>
<p>(I'm happy to go along with whatever y'all choose makes sense for your ecosystem.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hiteshjasani">@hiteshjasani</a> on 2019-06-11 16:04</div>
            <div class="timeline-body"><p>Nim is a relatively young language -- it's quickly approaching version 1.0 -- and I haven't seen (from my humble perspective) any large codebases using it -- other than the language codebase itself.  My perspective is colored by working with different languages and large codebases over the years.  When I've searched in them, I've needed to do it in priority order to find the specific needles in the haystacks.    So my comments are more about what I've experienced in general rather than with nim specifically right now.</p>
<p>I've generally prioritized my search as follows:</p>
<ul>
<li>primary - main source code files (client and server)<ul>
<li>Refining search within the main codebase is generally easy with good directory structures</li>
</ul>
</li>
<li>secondary - ancillary files that contain some business logic or configuration (template html files, template sql files, runtime configuration)</li>
<li>tertiary - build scripts, build configuration, one off db changes, db migrations</li>
</ul>
<p>So my proposal is the following file_types:</p>
<pre><code class="language-shell"># search all *.nim files
rg -tnim foo

# search all *.nimf source code filter (template) files
rg -tnimf foo

# search all *.nims and *.nimble files
rg -tnimscript foo
</code></pre>
<p>You know I just realized the filename globbing parameter to ripgrep.  So without any changes to ripgrep, the following works and makes me happy.</p>
<pre><code class="language-shell"># search all *.nim files
rg -g*.nim foo

# search all *.nimf source code filter (template) files
rg -g*.nimf foo

# search all *.nims and *.nimble files
rg -g*.nims -g*.nimble foo

# search all nim related files
rg -g*.nim* foo
</code></pre>
<p>@araq, @dom96 do you have any preferences on nim filetypes in ripgrep?  I'll try to summarize below.</p>
<p>A quick summary of the options:</p>
<ol>
<li>Do nothing - ripgrep supports filename globbing so you can choose the specific file extensions to search.  Can also choose to just do nothing for now and see how things play out in the long run.</li>
<li>Add <code>nimf</code> and <code>nimscript</code> file_types to ripgrep - my current commit proposal.</li>
<li>Add <code>*.nims</code>, <code>*.nimble</code> and <code>*.nimf</code> to the <code>nim</code> file_type - puts all file extensions with some amount of nim source code in them under a single file type.</li>
</ol>
<p>Since learning about the filename globbing, I'm happy with any of the options including doing nothing for now and just taking a wait and see approach.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dom96">@dom96</a> on 2019-06-11 20:49</div>
            <div class="timeline-body"><blockquote>
<p>Add *.nims, *.nimble and *.nimf to the nim file_type - puts all file extensions with some amount of nim source code in them under a single file type.</p>
</blockquote>
<p>I would say this option makes the most sense, for more granularity you can always use the <code>-g</code> flag. As far as expectations are concerned, I would expect the &quot;nim&quot; type to search through all Nim-related source code files which includes .nim, .nimf, .nimble and .nims. There is also <code>.nim.cfg</code> which is an INI-like format that doesn't contain any Nim source code so we should exclude it I think.</p>
<hr />
<p>@BurntSushi By the way, would you accept a PR to add support for style insensitive search to ripgrep? That would allow finding <code>foo_bar</code> and <code>fooBar</code> using just the search term <code>fooBar</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2019-06-12 17:04</div>
            <div class="timeline-body"><p>LGTM! Thanks for chiming in @dom96!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-06-12 17:05</div>
            <div class="timeline-body"><p>@dom96</p>
<blockquote>
<p>By the way, would you accept a PR to add support for style insensitive search to ripgrep? That would allow finding foo_bar and fooBar using just the search term fooBar.</p>
</blockquote>
<p>Most likely, yes, as long as the implementation is simple. Are you envisioning a transformation on a literal? If so, I could see that working. A transformation on an arbitrary regex might be a bit trickier.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @BurntSushi on 2019-06-12 18:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2019-06-12 18:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2019-06-12 18:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dom96">@dom96</a> on 2019-06-12 20:31</div>
            <div class="timeline-body"><blockquote>
<p>Are you envisioning a transformation on a literal? If so, I could see that working.</p>
</blockquote>
<p>Yeah, I think that would be good enough and should be fairly trivial to implement. @hiteshjasani interested? :)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 18:28:08 UTC
    </footer>
</body>
</html>
