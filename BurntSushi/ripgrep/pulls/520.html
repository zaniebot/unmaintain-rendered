<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add -x/--line-regexp - BurntSushi/ripgrep #520</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add -x/--line-regexp</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/BurntSushi/ripgrep/pull/520">#520</a>
        opened by <a href="https://github.com/okdana">@okdana</a>
        on 2017-06-17 05:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/okdana">@okdana</a></div>
            <div class="timeline-body"><p>Let&#x27;s try this!</p>
<p>This PR adds <code>-x</code>/<code>--line-regexp</code>, which essentially wraps the pattern in <code>^</code>...<code>$</code> in order to make it match whole lines only. This is an option defined in the <a href="http://pubs.opengroup.org/onlinepubs/009695399/utilities/grep.html">POSIX spec</a> for <code>grep</code>, and one that i use a lot. I found it rather frustrating that <code>ag</code> didn&#x27;t have it.</p>
<p>I will add additional notes as comments on the diff.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/okdana">@okdana</a> reviewed on 2017-06-17 05:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/okdana">@okdana</a> on <code>doc/convert-to-man</code>:5 on 2017-06-17 05:29</div>
            <div class="timeline-body"><p>I found that this script didn&#x27;t run on macOS with just <code>sed -i</code>, as the BSD version of <code>sed</code> requires the back-up suffix. So i added that in a way that should be compatible with both GNU and BSD <code>sed</code>. I also added the <code>&amp;&amp;</code> to make the script bail if any part of the process fails.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/okdana">@okdana</a> reviewed on 2017-06-17 05:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/okdana">@okdana</a> on <code>src/app.rs</code>:112 on 2017-06-17 05:31</div>
            <div class="timeline-body"><p>It should actually be fine to apply both the <code>word-regexp</code> and <code>line-regexp</code> pattern transformations at once, since <code>\b</code> also matches the beginning/end of line. But i figured it&#x27;d be cleaner and more future-proof to make the one override the other.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/okdana">@okdana</a> reviewed on 2017-06-17 05:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/okdana">@okdana</a> on <code>src/args.rs</code>:486 on 2017-06-17 05:32</div>
            <div class="timeline-body"><p>This line exceeds 80 cols, and it&#x27;s becoming quite unwieldy anyway, so i think maybe i should change it. I wasn&#x27;t sure what would be the best way to do that though.</p>
<p>ETA: Maybe, given that the two options are exclusive, we should combine their respective functions into a single <code>word_or_line_pattern()</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/okdana">@okdana</a> reviewed on 2017-06-17 05:33</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/okdana">@okdana</a> on <code>src/args.rs</code>:521 on 2017-06-17 05:33</div>
            <div class="timeline-body"><p>Added non-capturing group to avoid the same problem described in #506.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/okdana">@okdana</a> on 2017-08-08 23:53</div>
            <div class="timeline-body"><p>btw @BurntSushi how do you feel about this? Does it fit with your vision for the tool&#x27;s feature set? If so, is there anything you&#x27;d need me to do (besides rebase now) to get it in?</p>
<p>If not, that&#x27;s cool too obv; i guess i&#x27;m just wondering if i should keep it tracking new changes or simply close it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>doc/convert-to-man</code>:5 on 2017-08-08 23:58</div>
            <div class="timeline-body"><blockquote>
<p>I also added the &amp;&amp; to make the script bail if any part of the process fails.</p>
</blockquote>
<p>I usually put <code>set -e</code> at the top of scripts for that. Could we do that instead? It feels a little nicer than trailing every command with <code>&amp;&amp;</code>. :-)</p>
<p>(I&#x27;m not up on my shell compatibility, but if this means switching <code>#!/bin/sh</code> to <code>#!/bin/bash</code>, then I&#x27;m fine with that.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/args.rs</code>:486 on 2017-08-09 00:01</div>
            <div class="timeline-body"><p>Yeah I&#x27;d definitely like to stick to a 79 column limit (inclusive). I&#x27;d probably just write it like this:</p>
<pre><code>let litpat = self.literal_pattern(pat.to_string());
let s = self.line_pattern(self.word_pattern(litpat));
</code></pre>
<p>But if you want to make a new method, that&#x27;s cool too!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> requested changes on 2017-08-09 00:02</div>
            <div class="timeline-body"><p>@okdana Arg, sorry, I let this one slip by me. Thanks so much for the ping. This was a pretty easy review. :-)</p>
<p>Basically, this all looks pretty good. I left a couple minor comments to iron out before merging! Thanks so much for doing this!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/okdana">@okdana</a> on 2017-08-09 00:44</div>
            <div class="timeline-body"><p>Thanks! Updated:</p>
<ul>
<li>Rebased</li>
<li>Accounted for new zsh completion function</li>
<li>Added <code>-e</code> to <code>convert-to-man</code> (it does make more sense here, and it works everywhere)</li>
<li>Changed long line in <code>args.rs</code> as suggested</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2017-08-09 00:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-08-09 10:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-08-09 10:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:16 UTC
    </footer>
</body>
</html>
