<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pkg: embed windows manifest to support long file paths if enabled - BurntSushi/ripgrep #2049</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>pkg: embed windows manifest to support long file paths if enabled</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/pull/2049">#2049</a>
        opened by <a href="https://github.com/thargor">@thargor</a>
        on 2021-11-04 12:28
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/thargor">@thargor</a></div>
            <div class="timeline-body"><p>fixes #364</p>
<p>Implementation is based on https://gal.hagever.com/posts/windows-long-paths-in-rust/ .</p>
<p>This still requires long file paths to be enabled in the windows registry.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thargor">@thargor</a> on 2021-11-04 12:35</div>
            <div class="timeline-body"><p>this is also what https://github.com/nabijaczleweli/cargo-update is using</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SimplyDanny">@SimplyDanny</a> on 2021-11-18 17:53</div>
            <div class="timeline-body"><p>Works fine for me with the registry key <code>LongPathsEnabled</code> set to 1.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/SimplyDanny">@SimplyDanny</a> on <code>build.rs</code>:9 on 2021-11-18 18:04</div>
            <div class="timeline-body"><p>This line is <a href="https://doc.rust-lang.org/nightly/edition-guide/rust-2018/path-changes.html">no longer needed</a> since Rust Edition 2018.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/SimplyDanny">@SimplyDanny</a> on <code>build.rs</code>:52 on 2021-11-18 18:06</div>
            <div class="timeline-body"><p>From what I see browsing through the code base, comments are written as sentences, i.e. they start with a capital letter and end with a period.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/SimplyDanny">@SimplyDanny</a> reviewed on 2021-11-18 18:07</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>build.rs</code>:1 on 2021-11-18 18:35</div>
            <div class="timeline-body"><p>Why was this moved? Please put it back. :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>build.rs</code>:9 on 2021-11-18 18:35</div>
            <div class="timeline-body"><p>Indeed, this should be removed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>build.rs</code>:52 on 2021-11-18 18:37</div>
            <div class="timeline-body"><p>Yeah, that's preferred. But what would be better here is more elaboration. Mostly, this comment nearly repeats what the code itself says, without adding much. I think this comment should:</p>
<ul>
<li>Say why this is being done.</li>
<li>Include instruction on how to take advantage of it. If you're someone who is reading this <code>build.rs</code> trying to understand it, and we say, &quot;this enables long file paths&quot; without saying that it also requires a registry edit, that might produce some confusion. So let's shine a light where we can.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>rg-manifest.rc</code>:2 on 2021-11-18 18:38</div>
            <div class="timeline-body"><p>I can't comment on it, but where did the <code>rg.exe.manifest</code> file come from? How was it generated?</p>
<p>Also, I think it would be better to put these files into a <code>windows</code> sub-directory, instead of polluting the root of the repo even more than it is.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>rg-manifest.rc</code>:2 on 2021-11-18 18:41</div>
            <div class="timeline-body"><p>Oh I see, GitHub falsely detects it as a binary file, but it's just plain text. Phew. That's good. Yeah, I think just move these into a new <code>windows</code> sub-directory. Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>build.rs</code>:53 on 2021-11-18 18:42</div>
            <div class="timeline-body"><p>What does this do on non-Windows targets? Even if nothing, it might be nice to gate this on <code>#[cfg(windows)]</code> to make it a bit clearer to those reading the code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>Cargo.toml</code>:64 on 2021-11-18 18:43</div>
            <div class="timeline-body"><p>I don't think this is needed for non-Windows builds right? Could you please make this a target specific dependency for windows only? Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> requested changes on 2021-11-18 18:57</div>
            <div class="timeline-body"><p>I got through most of this PR review before realizing that it's using a dependency that I will not bring in. I'm sorry. Someone tried this before in #1898. Specifically, see <a href="https://github.com/BurntSushi/ripgrep/pull/1898#issuecomment-862466605">my comment on that PR</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2021-11-18 18:59</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thargor">@thargor</a> on 2021-11-18 21:47</div>
            <div class="timeline-body"><p>@BurntSushi @SimplyDanny thank you for your feedback!</p>
<p>Would an implementation based on https://crates.io/crates/windres (which is based on https://crates.io/crates/find-winsdk ) be acceptable for ripgrep?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-11-18 21:52</div>
            <div class="timeline-body"><p>As long as there's nothing written by Jonathan Blow in the dependency tree, the licenses are compatible and the crates are decently maintained. Remember, once this gets added to ripgrep, it's forever mine to maintain, evev if the dependencies go defunct.</p>
<p>So in short: probably, but I'll still need to do a review if a PR comes in.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @BurntSushi on 2021-11-18 21:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Converted to draft by @thargor on 2021-11-18 22:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/t-rapp">@t-rapp</a> on 2022-06-09 13:58</div>
            <div class="timeline-body"><p>For anyone interested in long path support: Stumbled over this recent <a href="https://github.com/rust-lang/rust/pull/96737">pull request for rustc</a> which adds a similar manifest file to the rustc executable. It apparently works for the *-msvc target by using a build script without external libraries.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2023-07-08 14:27</div>
            <div class="timeline-body"><p>@ChrisDenton what are your thoughts on this PR? Is this the right way to support long paths on Windows?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ChrisDenton">@ChrisDenton</a> on 2023-07-08 15:17</div>
            <div class="timeline-body"><p>Yep. I'd be minded to append <code>.xml</code> to the file name to make github happy. And while an xml declaration (<code>&lt;?xml ...</code>) isn't strictly necessary, it can make other tools happy. Also linking to <a href="https://learn.microsoft.com/en-us/windows/win32/sbscs/application-manifests#longpathaware">the docs</a> would make sense.</p>
<p>My only quibble is that it's a lot of dependencies for what can be <a href="https://github.com/rust-lang/rust/blob/ce519c5945c90596cf429dc2a91c846daeb75cd1/compiler/rustc/build.rs#L23-L24">a couple of lines</a> in a build script (plus a few more lines to apply it conditionally). Though unfortunately windows-gnu does not support this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2023-07-08 17:14</div>
            <div class="timeline-body"><p>@ChrisDenton Oh yessss! Thank you for that link. I will do what you did for <code>rustc</code>. That looks much better.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rollup</span> added by @BurntSushi on 2023-07-08 17:28</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2023-07-08 22:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:44:03 UTC
    </footer>
</body>
</html>
