<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ignore/types: add automated test for sortedness - BurntSushi/ripgrep #2351</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ignore/types: add automated test for sortedness</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/BurntSushi/ripgrep/pull/2351">#2351</a>
        opened by <a href="https://github.com/arbrauns">@arbrauns</a>
        on 2022-11-14 12:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/arbrauns">@arbrauns</a></div>
            <div class="timeline-body"><p>After I accidentally mixed up the sorting in #2349 and didn't notice, I thought I'd add a test so hopefully the next time it happens to someone it can be caught before it's sent in as a PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ignore/src/default_types.rs</code>:294 on 2022-11-14 12:49</div>
            <div class="timeline-body"><p>The test should be in a <code>#[cfg(test)] mod tests { ... }</code> block. It doesn't have to be, but this is the pattern followed in this repo and clearly delineates tests from non-tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ignore/src/default_types.rs</code>:298 on 2022-11-14 13:00</div>
            <div class="timeline-body"><p>I would write this as:</p>
<pre><code class="language-rust">let first = match names.next() {
    None =&gt; return,
    Some(first) =&gt; first,
};
</code></pre>
<p>Or perhaps even better, using the <a href="https://github.com/rust-lang/rust/pull/93628/">newly stabilized <code>let else</code></a>:</p>
<pre><code class="language-rust">let Some(first) = names.next() else { return };
</code></pre>
<p>Although in order to use <code>let else</code> we need to bump MSRV to Rust 1.65. Since ripgrep tracks the latest stable release of Rust, I have no problem with that. Indeed, <a href="https://github.com/BurntSushi/ripgrep/commit/8905d54a9f25f4c1e4e3ca8331f517473e174d87">I just pushed a commit to do so</a>, so all you need to do to use <code>let else</code> is to rebase on master.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ignore/src/default_types.rs</code>:298 on 2022-11-14 13:01</div>
            <div class="timeline-body"><p>The higher level point here is to keep code linear via early returns. That way, you avoid nesting the main body here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> requested changes on 2022-11-14 13:01</div>
            <div class="timeline-body"><p>Great idea, thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/arbrauns">@arbrauns</a> on <code>crates/ignore/src/default_types.rs</code>:298 on 2022-11-14 13:18</div>
            <div class="timeline-body"><p>That's much neater. Of course the best solution would be rust-lang/rust#53485, but that seems to still be quite a while away.</p>
<p>If ripgrep uses latest stable anyway, what's the opinion on <code>edition = &quot;2021&quot;</code>? It would allow for things like implicit arguments in panic/assert format strings: https://doc.rust-lang.org/edition-guide/rust-2021/panic-macro-consistency.html.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/arbrauns">@arbrauns</a> reviewed on 2022-11-14 13:18</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2022-11-14 13:29</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/ignore/src/default_types.rs</code>:298 on 2022-11-14 13:29</div>
            <div class="timeline-body"><p>I'll very likely do the edition migration myself before the next release, whenever that is. I'm in no rush to be honest. I'll likely only do things that <code>cargo fix</code> does automatically. Converting explicit to implicit arguments by hand is a fair bit of work.</p>
<p>With respect to <code>is_sorted</code>, I actually think your approach here is better. It gives a better failure mode by providing a witness. <code>is_sorted</code> wouldn't do that. :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2022-11-14 13:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @BurntSushi on 2022-11-14 13:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2022-11-14 13:31</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 18:28:21 UTC
    </footer>
</body>
</html>
