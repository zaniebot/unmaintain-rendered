<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Completely re-work colored output and tty handling. - BurntSushi/ripgrep #240</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Completely re-work colored output and tty handling.</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/BurntSushi/ripgrep/pull/240">#240</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2016-11-20 06:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a></div>
            <div class="timeline-body"><p>This commit completely guts all of the color handling code and replaces
most of it with two new crates: wincolor and termcolor. wincolor
provides a simple API to coloring using the Windows console and
termcolor provides a platform independent coloring API tuned for
multithreaded command line programs. This required a lot more
flexibility than what the <code>term</code> crate provided, so it was dropped.
We instead switch to writing ANSI escape sequences directly and ignore
the TERMINFO database.</p>
<p>In addition to fixing several bugs, this commit also permits end users
to customize colors to a certain extent. For example, this command will
set the match color to magenta and the line number background to yellow:</p>
<pre><code>rg --colors &#x27;match:fg:magenta&#x27; --colors &#x27;line:bg:yellow&#x27; foo</code></pre>
<p>For tty handling, we&#x27;ve adopted a hack from <code>git</code> to do tty detection in
MSYS/mintty terminals. As a result, ripgrep should get both color
detection and piping correct on Windows regardless of which terminal you
use.</p>
<p>Finally, switch to line buffering. Performance doesn&#x27;t seem to be
impacted and it&#x27;s an otherwise more user friendly option.</p>
<p>Fixes #37, Fixes #51, Fixes #94, Fixes #117, Fixes #182, Fixes #231</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2016-11-20 20:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2016-11-20 20:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2016-11-20 20:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/retep998">@retep998</a> on 2016-11-22 15:47</div>
            <div class="timeline-body"><p>cc @Stebalien you may be very interested in the techniques used here to detect what sort of TTY is available on Windows.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2016-11-22 16:40</div>
            <div class="timeline-body"><p>#94 is where the goods are, including <a href="https://github.com/BurntSushi/ripgrep/issues/94#issuecomment-261761687">some code</a>. Arguably, that might belong in the <code>atty</code> crate. cc @softprops</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2016-11-22 23:26</div>
            <div class="timeline-body"><p>I filed an issue against <code>atty</code>: <a href="https://github.com/softprops/atty/issues/10">softprops/atty#10</a></p>
<p>How awesome would it be if the entire Rust ecosystem could automatically do correct tty detection on Windows? Oh boy!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:15 UTC
    </footer>
</body>
</html>
