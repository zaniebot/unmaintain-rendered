<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows eol anchor option - BurntSushi/ripgrep #929</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Windows eol anchor option</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/pull/929">#929</a>
        opened by <a href="https://github.com/BatmanAoD">@BatmanAoD</a>
        on 2018-05-28 09:37
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BatmanAoD">@BatmanAoD</a></div>
            <div class="timeline-body"><p>Potential fix for #416 via a command-line option.</p>
<p>I decided it would be a good time to implement my old suggestion of just providing a command-line argument to modify the search pattern(s) now that there is config file support.</p>
<p>I&#x27;ve tested by hand that this works as expected on Windows, and the regression test I&#x27;ve added works on Linux.</p>
<p>However, the regression test fails on Windows with no information other than that the exit-code is <code>1</code>. Is there some problem with the test framework?</p>
<p>Here&#x27;s the complete output from running the test on Windows:</p>
<pre><code>   Compiling ripgrep v0.8.1 (file:///C:/Users/kjstrand/personal-projects/ripgrep)
    Finished dev [unoptimized + debuginfo] target(s) in 7.2 secs
     Running C:\Users\kjstrand\personal-projects\ripgrep\target\debug\deps\rg-275c12485214083c.exe

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 86 filtered out

     Running C:\Users\kjstrand\personal-projects\ripgrep\target\debug\deps\integration-3d1ca51b299d90b8.exe

running 1 test
test regression_416 ... FAILED

failures:

---- regression_416 stdout ----
        thread &#x27;regression_416&#x27; panicked at &#x27;

==========
command failed but expected success!

Did your search end up with no results?

command: &quot;C:\\Users\\kjstrand\\personal-projects\\ripgrep\\target\\debug\\deps\\../rg.exe&quot; &quot;--eol-anchor-include-cr&quot; &quot;--with-filename&quot; &quot;bar$&quot;
cwd: C:\Users\kjstrand\personal-projects\ripgrep\target\debug\deps\ripgrep-tests\regression_416\0

status: exit code: 1

stdout:

stderr:

==========
&#x27;, tests\workdir.rs:243:13
note: Run with `RUST_BACKTRACE=1` for a backtrace.


failures:
    regression_416

test result: FAILED. 0 passed; 1 failed; 0 ignored; 0 measured; 157 filtered out
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BatmanAoD">@BatmanAoD</a> on 2018-05-28 09:40</div>
            <div class="timeline-body"><p>There are also some stylistic issues you will probably want to weigh in on, e.g. whether the flag name is appropriate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-05-28 12:14</div>
            <div class="timeline-body"><p>Thanks for working on this! I&#x27;m not sure when I&#x27;ll get a chance to look at this. I&#x27;m also not 100% sold on this particular approach.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BatmanAoD">@BatmanAoD</a> on 2018-05-28 15:07</div>
            <div class="timeline-body"><p>I don&#x27;t think it&#x27;s ideal, which is why I hid it behind a long feature flag. But I think it&#x27;s a lot better than nothing; the current behavior renders <code>$</code> essentially useless on Windows.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BatmanAoD">@BatmanAoD</a> on 2018-05-28 15:07</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/BatmanAoD">@BatmanAoD</a> on 2018-05-28 15:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BatmanAoD">@BatmanAoD</a> on 2018-05-28 19:24</div>
            <div class="timeline-body"><p>An alternate API would be to have something like <code>--eol-handling-mode &lt;MODE&gt;</code>, and we can introduce modes gradually. Some desirable (non-default) modes might be:</p>
<ul>
<li>This mode, since it&#x27;s simplest to implement</li>
<li>Single-byte newlines, but using some character other than <code>\n</code>, such as <code>\r</code> (it seems you were planning to do this at some point anyway since you have a single-byte <code>eol</code> member in <code>Args</code>)</li>
<li>GNU-grep style CR-stripping</li>
<li>Once there&#x27;s an opt-in flag for rust-lang/regex/issues/244, a mode that uses this option</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BatmanAoD">@BatmanAoD</a> on 2018-05-29 19:14</div>
            <div class="timeline-body"><p>It appears that on Windows, but on no other supported platform, the test framework requires one or more explicit paths to search (e.g. using <code>cmd.arg(&quot;./&quot;)</code>. So I&#x27;ve fixed the test that was failing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;(Help needed) Windows eol anchor option&quot; to &quot;Windows eol anchor option&quot; by <a href="https://github.com/BatmanAoD">@BatmanAoD</a> on 2018-05-29 19:32</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2018-06-05 17:39</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/args.rs</code>:611 on 2018-06-05 17:39</div>
            <div class="timeline-body"><p>This should be done by parsing the regex and doing a substitution at the HIR level.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BatmanAoD">@BatmanAoD</a> reviewed on 2018-06-05 21:31</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BatmanAoD">@BatmanAoD</a> on <code>src/args.rs</code>:611 on 2018-06-05 21:31</div>
            <div class="timeline-body"><p>@BurntSushi That seems sensible. Are you more amenable to the configuration-option design now, then?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/args.rs</code>:611 on 2018-06-05 21:49</div>
            <div class="timeline-body"><p>Not particularly... I just happened to see this particular issue in passing.</p>
<p>Honestly, this just isn&#x27;t a priority for me now, and it needs thought.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2018-06-05 21:49</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BatmanAoD">@BatmanAoD</a> reviewed on 2018-06-06 00:01</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BatmanAoD">@BatmanAoD</a> on <code>src/args.rs</code>:611 on 2018-06-06 00:01</div>
            <div class="timeline-body"><p>I understand it&#x27;s not a priority for you, but as I mentioned when I opened the original issue, it makes <code>$</code> essentially useless on Windows.</p>
<p>I agree that the <em>right</em> solution requires thought, and I can understand why you wouldn&#x27;t want to introduce a half-baked solution just to deprecate it later. On the other hand, my suggested solution is extremely simple to implement and, I expect, to maintain, and personally I think it is reasonable to introduce command-line options that may be deprecated in favor of a better solution with a warning that this is the case.</p>
<p>I suppose that if you&#x27;re definitely opposed to a partial solution, I can just continue to maintain my fork until there&#x27;s a better solution ready to ship, but I don&#x27;t want to publish a competing crate on Cargo or anything like that, so it&#x27;s not terribly convenient.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2018-06-06 00:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/args.rs</code>:611 on 2018-06-06 00:25</div>
            <div class="timeline-body"><p>I&#x27;ve heard you.</p>
<blockquote>
<p>but I don&#x27;t want to publish a competing crate on Cargo or anything like that, so it&#x27;s not terribly convenient</p>
</blockquote>
<p>If it&#x27;s on GitHub, <code>cargo install</code> can install straight from the git repo.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BatmanAoD">@BatmanAoD</a> on <code>src/args.rs</code>:611 on 2018-06-06 00:43</div>
            <div class="timeline-body"><p>Okay, I didn&#x27;t know that. That&#x27;s helpful; I&#x27;ll try that out. Thank you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BatmanAoD">@BatmanAoD</a> reviewed on 2018-06-06 00:43</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BatmanAoD">@BatmanAoD</a> on 2018-06-28 21:24</div>
            <div class="timeline-body"><p>Closing due to <a href="https://github.com/BurntSushi/ripgrep/issues/416#issuecomment-400084219">this comment in #416</a> indicating that this will be handled in libripgrep.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BatmanAoD">@BatmanAoD</a> on 2018-06-28 21:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2022-07-30 22:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:17 UTC
    </footer>
</body>
</html>
