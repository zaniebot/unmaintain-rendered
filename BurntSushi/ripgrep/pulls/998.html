<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tests: reduce effect of state on integration tests - BurntSushi/ripgrep #998</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>tests: reduce effect of state on integration tests</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/BurntSushi/ripgrep/pull/998">#998</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2018-07-29 14:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a></div>
            <div class="timeline-body"><p>tests: reduce reliance on state in tests</p>
<p>This commit improves the integration test setup by running tests inside
the system's temporary directory instead of within ripgrep's <code>target</code>
directory. The motivation here is to attempt to reduce the effect of
unanticipated state on ripgrep's integration tests, such as the presence
of <code>.gitignore</code> files in ripgrep's checkout directory hierarchy
(including parent directories).</p>
<p>This doesn't remove all possible state. For example, there's no
guarantee that the system's temporary directory isn't itself within a
git repository. Moreover, there may still be other ignore rules in the
directory tree that might impact test behavior. Fixing this seems
somewhat difficult. Conceptually, it seems like ripgrep should run each
test in its own <code>chroot</code>-like environment, but doing this in a
non-annoying and portable way (including Windows) doesn't appear to be
possible.</p>
<p>Another approach to take here might be to teach ripgrep itself that a
particular directory should be treated as root, and therefore, never
look at anything outside that directory. This also seems complex to
implement, but tractable. Let's see how this approach works for now.</p>
<p>Fixes #448, Fixes #996</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by @BurntSushi on 2018-07-29 14:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2018-07-29 14:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2018-07-29 14:41</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/igor-raits">@igor-raits</a> on 2018-07-29 15:44</div>
            <div class="timeline-body"><p>@BurntSushi almost!</p>
<pre><code> 	thread 'no_parent_ignore_git' panicked at 'assertion failed: `(left == right)`
  left: `&quot;sherlock:For the Doctor Watsons of this world, as opposed to the Sherlock\nsherlock:be, to a very large extent, the result of luck. Sherlock Holmes\nwatson:For the Doctor Watsons of this world, as opposed to the Sherlock\nwatson:be, to a very large extent, the result of luck. Sherlock Holmes\n&quot;`,
 right: `&quot;sherlock:For the Doctor Watsons of this world, as opposed to the Sherlock\nsherlock:be, to a very large extent, the result of luck. Sherlock Holmes\n&quot;`', tests/tests.rs:696:5
note: Run with `RUST_BACKTRACE=1` for a backtrace.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-07-29 16:47</div>
            <div class="timeline-body"><p>@ignatenkobrain If you're patching <code>tests/tests.rs</code> with this PR, then I think you also need another fix, which was included in https://github.com/BurntSushi/ripgrep/commit/e65ca21a6cebceb9ba79fcd164da24478cc01fb0#diff-475a9530a9c1e888d097445199b74c2f</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/igor-raits">@igor-raits</a> on 2018-07-29 18:28</div>
            <div class="timeline-body"><p>oh right, now everything works ;)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 18:28:03 UTC
    </footer>
</body>
</html>
