<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>feat(ignore): Allow parallel-walker to borrow data - BurntSushi/ripgrep #1432</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>feat(ignore): Allow parallel-walker to borrow data</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/pull/1432">#1432</a>
        opened by <a href="https://github.com/epage">@epage</a>
        on 2019-11-21 14:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/epage">@epage</a></div>
            <div class="timeline-body"><p>This makes it so the caller can more easily refactor from
single-threaded to multi-threaded walking. If they want to support both,
this makes it easier to do so with a single initialization code-path.</p>
<p>In a separate commit, ripgrep is updated to use this. I assume the performance difference is negligible
but it cleans up the code and provides a test case for ignores changes. I kept it as a separate commit so we can more easily validate that compatibility was not broken.</p>
<p>Closes #1410</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2019-11-28 04:08</div>
            <div class="timeline-body"><p>@BurntSushi any word on this?</p>
<p>As for the test failures, they seem unrelated to my changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-11-28 04:18</div>
            <div class="timeline-body"><p>My todo list has grown very long from a period of inactivity and this touches on some of the more complex areas that I think have not been well done, so I&#x27;ve been avoiding diving back into it. So to be honest, it could be some time before I look at this.</p>
<p>I glanced over things, and I have these concerns:</p>
<ol>
<li>I don&#x27;t really know what problem you&#x27;re trying to solve. I see your PR description, but I don&#x27;t grok it. I think an example would help.</li>
<li>An extra dependency has been added, so I&#x27;ll need to audit that and consider the trade offs there.</li>
<li>It looks like public docs have changed? It&#x27;s there a breaking change lurking?</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2019-11-28 14:06</div>
            <div class="timeline-body"><blockquote>
<p>My todo list has grown very long from a period of inactivity and this touches on some of the more complex areas that I think have not been well done, so I&#x27;ve been avoiding diving back into it. So to be honest, it could be some time before I look at this.</p>
</blockquote>
<p>I understand; I&#x27;m in the same boat. This is one of the reasons I&#x27;m intentionally focusing on the area of most concern (for me) rather than also worrying about the Visitor stuff.  This is also why I didn&#x27;t ping you earlier on the issues but waited until a PR was available so that you weren&#x27;t having to talk to someone about something theoretical that they might not get to.</p>
<blockquote>
<p>I don&#x27;t really know what problem you&#x27;re trying to solve. I see your PR description, but I don&#x27;t grok it. I think an example would help.</p>
</blockquote>
<p>The problem I&#x27;m trying to solve becomes clearer when you look at <a href="https://github.com/BurntSushi/ripgrep/pull/1432/files#diff-639fbc4ef05b315af92b4d836c31b023L129">the change to ripgrep</a> I made.</p>
<p>The reason I care is that this will help keep my code simple.  For ripgrep, parallel and non-parallel code paths are completely separate so it doesn&#x27;t make too much of a difference.  For my project, they are branches within the same function.  I don&#x27;t want to put everything into <code>Arc</code>s just because the parallel code path requires it and I don&#x27;t want to fork the code paths.</p>
<blockquote>
<p>An extra dependency has been added, so I&#x27;ll need to audit that and consider the trade offs there.</p>
</blockquote>
<p>I added <code>crossbeam_utils</code>.  It is already an indirect dependency of <code>ignore</code> through <code>crossbeam_channels</code>.</p>
<blockquote>
<p>It looks like public docs have changed? It&#x27;s there a breaking change lurking?</p>
</blockquote>
<p>I&#x27;ve reverted the change.  It was a side effect of the code&#x27;s evolution.  I started in my Visitor branch and that was the comment for the visitor entry point. My motivation for the Visitor work was to give me more concrete types to iterate through lifetime issues for better compiler messages. When I saw some inactivity from you and was concerned about prioritizing my changes, I pulled the lifetime stuff off of that branch to keep the change focused.</p>
<p>I do not expect any breaking changes from this.  All I&#x27;ve done is made the API more accepting of inputs.  A limited test case of this is that I kept my <code>ripgrep</code> change to a separate commit and am able to build old and new <code>ripgrep</code> against the new <code>ignore</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2019-11-28 14:07</div>
            <div class="timeline-body"><p>And of course, go enjoy thanksgiving :) I don&#x27;t need immediate responses back.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> approved on 2020-02-17 14:54</div>
            <div class="timeline-body"><p>Sorry about the delay, but I&#x27;ve finally found the time to move through the PR queue. I think this overall looks good! I am going to make a few small cosmetic tweaks and merge this in #1486.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/epage">@epage</a> on 2020-02-17 15:26</div>
            <div class="timeline-body"><p>Thanks!</p>
<p>Again, I can understand the delays.  Happens in my projects too :/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-02-17 15:34</div>
            <div class="timeline-body"><p>@epage Also, just to confirm, I did some light benchmarking with ripgrep before and after this change and I can&#x27;t witness any performance differences (as was expected).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rollup</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-02-17 15:53</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-02-17 22:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:18 UTC
    </footer>
</body>
</html>
