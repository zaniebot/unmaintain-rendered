<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add extended color support - BurntSushi/ripgrep #452</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add extended color support</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/pull/452">#452</a>
        opened by <a href="https://github.com/tiehuis">@tiehuis</a>
        on 2017-04-18 06:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tiehuis">@tiehuis</a></div>
            <div class="timeline-body"><p>Fixes #261.</p>
<ul>
<li>Adds support for 256 and rgb color codes. Format is simply comma separated values.</li>
<li>Mixes fine with other styles such as bold/nobold. I did write a brief thing about this in the issue but doesn't seem necessary after writing the documentation.</li>
<li>Windows falls back to white in the presence of one of these new color codes.</li>
<li>This currently uses a fixed buffer for formatting the color codes instead of the <code>format!</code> macro. Its more complicated and I'm not entirely sure the benefit but it can always be changed back if the extra allocations are favored over the more complex code.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tiehuis">@tiehuis</a> reviewed on 2017-04-18 06:46</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/tiehuis">@tiehuis</a> on <code>termcolor/src/lib.rs</code>:957 on 2017-04-18 06:46</div>
            <div class="timeline-body"><p>Some eyes on this would be good if its preferred over <code>format!</code>. I've added some test cases here but could have missed something.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tiehuis">@tiehuis</a> on 2017-04-18 10:46</div>
            <div class="timeline-body"><p>@scottchiefbaker just highlighted a problem with the color parsing (no surprises there). I've just squashed the fix into this commit and made a quick test script which can be used to check if the parsing code matches visually.</p>
<p>https://gist.github.com/tiehuis/15f6a85c1b8fe691008c10b4d325a7c3</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/scottchiefbaker">@scottchiefbaker</a> on 2017-04-18 17:08</div>
            <div class="timeline-body"><p>I can confirm that I've tested this branch and it does everything I want for this feature. Colors are accurate and simple to specify. This pull-request gets my üëç for merge. Good work @tiehuis</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/scottchiefbaker">@scottchiefbaker</a> on 2017-04-20 03:38</div>
            <div class="timeline-body"><p>@tiehuis I don't know enough (any) rust to speak the quality of this code, but I think the implementation and output are great.</p>
<p>What are your thoughts on this PR?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tiehuis">@tiehuis</a> on 2017-04-20 10:40</div>
            <div class="timeline-body"><p>I've added my notes about this in the initial post. It's up to BurntSushi whether it gets merged or not and if any changes need to be made.</p>
<p>I know he has a lot of other things to tend to as well so I usually don't want to be too overbearing. He does a great job at managing his various projects so just give him a bit of time and this'll get looked at eventually.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/scottchiefbaker">@scottchiefbaker</a> on 2017-05-01 16:22</div>
            <div class="timeline-body"><p>@BurntSushi any thoughts on this PR? It's working pretty well for me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/leafgarland">@leafgarland</a> on 2017-05-11 23:21</div>
            <div class="timeline-body"><p>I just wanted to add that the Windows 10 console has supported 256 ansi colours for a while and since Creators Update supports 24 bit RGB.
https://msdn.microsoft.com/en-us/library/windows/desktop/mt638032(v=vs.85).aspx</p>
<p>Other commonly used terminal emulators such as mintty and ConEmu also support 24 bit colours.</p>
<p>Since ripgrep already has a flag for ansi colours, please don't just disable by default on Windows. Windows users can opt in/out depending on what they are using. As an aside, ripgrep is roughly twice as fast on windows with <code>--color=ansi</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-05-11 23:37</div>
            <div class="timeline-body"><blockquote>
<p>Since ripgrep already has a flag for ansi colours, please don't just disable by default on Windows.</p>
</blockquote>
<p>@leafgarland Can you please elaborate? What does your comment have to do specifically with this PR?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-05-11 23:37</div>
            <div class="timeline-body"><p>@tiehuis Sorry I've been dragging my feet looking at this! Thanks so much for doing it! At first glance, this looks pretty good but I'll want to do a more thorough review before merging.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/leafgarland">@leafgarland</a> on 2017-05-11 23:40</div>
            <div class="timeline-body"><p>@BurntSushi I was commenting because the description mentioned that this PR was defaulting to white on Windows.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tiehuis">@tiehuis</a> on 2017-05-11 23:44</div>
            <div class="timeline-body"><p>Can't have a long conversation right now but just had a quick look and I think this should handle ansi codes correctly on windows if <code>--color=ansi</code> is specified.</p>
<p>The only thing that should be updated potentially is the <code>should_ansi</code> function in termcolor which determines if the <code>AnsiWriter</code> is used instead of the Windows one. Not sure if this does a thorough enough check for a Windows 10 terminal. I think the description in the initial message would be better described as &quot;Fall back to white on windows where ANSI is not supported (i.e. cmd.exe)&quot;.</p>
<p>Haven't tested at all on Windows however, so wanted a minimal change incorporating the functionality first. It should be simple to add support for Windows later if needed with no real trouble.</p>
<p>Would be great if you could try out the branch to confirm though!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-05-11 23:44</div>
            <div class="timeline-body"><p>@leafgarland That's only when printing using the console APIs. It looks like this PR doesn't do anything special with the ANSI codes when those are used on Windows (which seems correct to me).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/leafgarland">@leafgarland</a> on 2017-05-11 23:45</div>
            <div class="timeline-body"><p>Ok, thanks. Sorry, I should have looked at the code!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-05-11 23:45</div>
            <div class="timeline-body"><blockquote>
<p>The only thing that should be updated potentially is the should_ansi function in termcolor which determines if the AnsiWriter is used instead of the Windows one. Not sure if this does a thorough enough check for a Windows 10 terminal</p>
</blockquote>
<p>Yeah, this is potentially future work. Def out of scope for this PR. :-) AFAIK, you actually need to make an API call to enable ANSI support in Windows 10 terminals, so it requires some Windows knowledge.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/weiznich">@weiznich</a> on 2017-06-15 14:57</div>
            <div class="timeline-body"><p>What is the current state of this pull request? What needs to be done to get it merged?
(I would like to implement a feature based on this in cargo)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-06-15 15:23</div>
            <div class="timeline-body"><p>@weiznich It's waiting on me giving it a more careful review. I'll try to look soon.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/scottchiefbaker">@scottchiefbaker</a> on 2017-06-15 15:26</div>
            <div class="timeline-body"><p>@weiznich I looked at your PR for Rust, and I'm a little confused. What feature does that implement that's related to this? Or would it be a new feature for ripgrep you're waiting to implement?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/weiznich">@weiznich</a> on 2017-06-15 15:33</div>
            <div class="timeline-body"><p>@alexcrichton moved the coloring in cargo to termcolor with <a href="https://github.com/rust-lang/cargo/commit/f8fb0a022853ab3f423889d442c695511ece3692">this commit</a>. After that it is only possible to use the 8 predefined color codes. This may result in a colors that are barley readable(See my <a href="https://github.com/rust-lang/cargo/pull/3873">old PR</a> for an example).
This PR introduces two possibilities to define custom colors. Based on this it should be possible to allow configuring the colors through an environment variable as proposed in my PR to cargo.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/scottchiefbaker">@scottchiefbaker</a> on 2017-08-22 21:10</div>
            <div class="timeline-body"><p>@BurntSushi have you had a chance to review this at all?</p>
<p>I'd really like to see this landed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/scottchiefbaker">@scottchiefbaker</a> on 2018-01-08 17:39</div>
            <div class="timeline-body"><p>@BurntSushi any movement on this? I'd really like to see better colors in ripgrep.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-01-29 23:27</div>
            <div class="timeline-body"><p>Thanks @tiehuis for this! I'm going to close this PR in favor of #766, which is based on your work here. I wanted to just get this merged so I did a few fixups.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2018-01-29 23:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 18:27:50 UTC
    </footer>
</body>
</html>
