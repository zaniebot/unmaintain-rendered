<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add `Arbitrary` to `Glob` - BurntSushi/ripgrep #2720</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add <code>Arbitrary</code> to <code>Glob</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/pull/2720">#2720</a>
        opened by <a href="https://github.com/johnsonw">@johnsonw</a>
        on 2024-01-24 16:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/johnsonw">@johnsonw</a></div>
            <div class="timeline-body"><p>Derive <code>Arbitrary</code> for <code>Glob</code> struct. This feature is optional so the derive will only take place when the feature is enabled. This feature is mandatory when using Glob in fuzz testing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/globset/Cargo.toml</code>:24 on 2024-01-24 16:22</div>
            <div class="timeline-body"><p>I don&#x27;t like implicitly depending on crate names for features. Could you explicitly add an <code>arbitrary</code> feature? Example: https://github.com/rust-lang/regex/blob/0c0990399270277832fbb5b91a1fa118e6f63dba/regex-syntax/Cargo.toml#L18</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/globset/Cargo.toml</code>:24 on 2024-01-24 16:24</div>
            <div class="timeline-body"><p>Please also add docs for this feature in the crate docs, e.g., https://docs.rs/regex-syntax/latest/regex_syntax/#crate-features</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> requested changes on 2024-01-24 16:24</div>
            <div class="timeline-body"><p>Overall LGTM, with a couple changes.</p>
<p>Note that I am working on a rewrite of <code>globset</code> and it&#x27;s not obvious to me that maintaining this <code>Arbitrary</code> impl will be straight-forward. So this might get lost in a future upgrade that will probably happen this year.</p>
<p>(I also resisted adding this to <code>regex-syntax</code> pretty hard, but it turned out that this was the least bad option after a lot of discussion.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/johnsonw">@johnsonw</a> on <code>crates/globset/Cargo.toml</code>:24 on 2024-01-24 17:25</div>
            <div class="timeline-body"><p>Would you be ok with me adding a <code>fuzz</code> folder with a simple fuzz test?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/johnsonw">@johnsonw</a> reviewed on 2024-01-24 17:25</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2024-01-24 17:32</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/globset/Cargo.toml</code>:24 on 2024-01-24 17:32</div>
            <div class="timeline-body"><p>Probably fine. But it needs to be tested in CI.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Marked ready for review by <a href="https://github.com/johnsonw">@johnsonw</a> on 2024-01-24 23:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/johnsonw">@johnsonw</a> reviewed on 2024-01-24 23:47</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/johnsonw">@johnsonw</a> on <code>crates/globset/Cargo.toml</code>:24 on 2024-01-24 23:47</div>
            <div class="timeline-body"><p>Thanks @BurntSushi. I&#x27;ve setup a <code>fuzz</code> directory and added a <code>fuzz_testing</code> action to ci.yml. Let me know if you want to adjust the duration for the fuzz testing as this can be modified. I&#x27;ve also addressed the other comments above.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jgrund">@jgrund</a> reviewed on 2024-01-25 15:30</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/jgrund">@jgrund</a> on <code>crates/globset/src/lib.rs</code>:22 on 2024-01-25 15:30</div>
            <div class="timeline-body"><pre><code>This crate includes optional features that can be enabled if necessary. These features are
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/BurntSushi">@BurntSushi</a> by <a href="https://github.com/johnsonw">@johnsonw</a> on 2024-01-25 21:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/johnsonw">@johnsonw</a> on 2024-01-26 20:24</div>
            <div class="timeline-body"><p>Happy Friday @BurntSushi, I just wanted to check and see if there is anything else you would like me to address?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>.github/workflows/ci.yml</code>:230 on 2024-01-26 21:42</div>
            <div class="timeline-body"><p>Is nightly needed here? If not, please use <code>@master</code> like the rest of the jobs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>.github/workflows/ci.yml</code>:228 on 2024-01-26 21:42</div>
            <div class="timeline-body"><p>Is this necessary?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/globset/src/lib.rs</code>:22 on 2024-01-26 21:44</div>
            <div class="timeline-body"><p>Lines should be wrapped to 79 columns (inclusive).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>crates/globset/src/lib.rs</code>:20 on 2024-01-26 21:44</div>
            <div class="timeline-body"><p>Why is this added in the middle of an example? It should go at the bottom of the crate docs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>fuzz/.cargo/config.toml</code>:4 on 2024-01-26 21:45</div>
            <div class="timeline-body"><p>Please include newlines at the end of files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>fuzz/.cargo/config.toml</code>:1 on 2024-01-26 21:45</div>
            <div class="timeline-body"><p>Why does this file exist?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>fuzz/README.md</code>:5 on 2024-01-26 21:46</div>
            <div class="timeline-body"><p>This is one long line. It should be wrapped to 79 columns (inclusive).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>fuzz/README.md</code>:5 on 2024-01-26 21:46</div>
            <div class="timeline-body"><p>And the same for lines below.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>fuzz/.cargo/config.toml</code>:1 on 2024-01-26 21:47</div>
            <div class="timeline-body"><p>I don&#x27;t think this file buys enough to warrant its existence. Having aliases for <code>cargo install cargo-fuzz</code> doesn&#x27;t seem useful to me. And aliasing <code>cargo fuzz_list</code> to <code>cargo fuzz list</code> seems a little weird? Like, why?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>fuzz/fuzz_targets/fuzz_glob.rs</code>:4 on 2024-01-26 21:48</div>
            <div class="timeline-body"><p>I don&#x27;t believe you need these two lines.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>fuzz/fuzz_targets/fuzz_glob.rs</code>:8 on 2024-01-26 21:49</div>
            <div class="timeline-body"><p>This should be written like this:</p>
<pre><code>use std::str::FromStr;

use {globset::Glob, libfuzzer_sys::fuzz_target};
</code></pre>
<p>That is, imports should be grouped by: 1) things from std, 2) things from third party dependencies and 3) (none in this case) crate-internal imports.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>fuzz/fuzz_targets/fuzz_glob.rs</code>:10 on 2024-01-26 21:49</div>
            <div class="timeline-body"><p>I&#x27;d just write this as <code>libfuzzer_sys::fuzz_target!</code> and dispense with the import above.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>fuzz/rust-toolchain</code>:3 on 2024-01-26 21:50</div>
            <div class="timeline-body"><p>Why is this using nightly?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>fuzz/rust-toolchain</code>:3 on 2024-01-26 21:50</div>
            <div class="timeline-body"><p>Ideally this file wouldn&#x27;t exist at all.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>fuzz/scripts/run-all.sh</code>:9 on 2024-01-26 21:51</div>
            <div class="timeline-body"><p>Why is this smushed on to one line? Vertical space is cheap. Use it. :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>fuzz/scripts/run-all.sh</code>:1 on 2024-01-26 21:52</div>
            <div class="timeline-body"><p>The name of this script should have <code>fuzz</code> in it somewhere.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>fuzz/scripts/run-all.sh</code>:6 on 2024-01-26 21:53</div>
            <div class="timeline-body"><p>This should output some kind of message to stderr saying that it&#x27;s going to run for <code>n</code> seconds.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>fuzz/scripts/run-all.sh</code>:12 on 2024-01-26 21:53</div>
            <div class="timeline-body"><p>I think overall, I would get rid of this script. It seems a little weird to be honest. I can&#x27;t imagine it being used for anything really.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>.github/workflows/ci.yml</code>:242 on 2024-01-26 21:53</div>
            <div class="timeline-body"><p>For CI, I don&#x27;t think we need to actually run fuzzing. Let&#x27;s just make sure all of the fuzz targets build.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> requested changes on 2024-01-26 21:54</div>
            <div class="timeline-body"><p>Thanks. I normally take a long time to review things. So I wouldn&#x27;t necessarily expect a quick turn-around here. With that said, I left a number of comments. Thank you for working on this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/johnsonw">@johnsonw</a> on <code>.github/workflows/ci.yml</code>:228 on 2024-01-29 14:46</div>
            <div class="timeline-body"><p><code>libFuzzer</code> requires LLVM sanitizer support and a C++ compiler with C++ 11 support. It is required to install the fuzzer and to compile the targets. Please see https://rust-fuzz.github.io/book/cargo-fuzz/setup.html for more information.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/johnsonw">@johnsonw</a> on <code>.github/workflows/ci.yml</code>:230 on 2024-01-29 14:48</div>
            <div class="timeline-body"><p>If we are not concerned with running the fuzz tests in CI then we don&#x27;t need the nightly build. I&#x27;ll change this to match the others.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/johnsonw">@johnsonw</a> on <code>.github/workflows/ci.yml</code>:242 on 2024-01-29 15:12</div>
            <div class="timeline-body"><p>Sounds good. I&#x27;ll update this to simply run a <code>cargo check</code> in the <code>fuzz</code> directory.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/johnsonw">@johnsonw</a> on <code>crates/globset/src/lib.rs</code>:20 on 2024-01-29 16:08</div>
            <div class="timeline-body"><p>Oops, not sure how that got there :) I moved it to the bottom.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/johnsonw">@johnsonw</a> on <code>fuzz/.cargo/config.toml</code>:1 on 2024-01-29 16:11</div>
            <div class="timeline-body"><p>Removed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/johnsonw">@johnsonw</a> on <code>fuzz/README.md</code>:5 on 2024-01-29 16:17</div>
            <div class="timeline-body"><p>Updated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/johnsonw">@johnsonw</a> on <code>fuzz/fuzz_targets/fuzz_glob.rs</code>:4 on 2024-01-29 16:19</div>
            <div class="timeline-body"><p>removed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/johnsonw">@johnsonw</a> on <code>fuzz/fuzz_targets/fuzz_glob.rs</code>:8 on 2024-01-29 16:21</div>
            <div class="timeline-body"><p>Updated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/johnsonw">@johnsonw</a> on <code>fuzz/fuzz_targets/fuzz_glob.rs</code>:10 on 2024-01-29 16:23</div>
            <div class="timeline-body"><p>sure, updated.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/johnsonw">@johnsonw</a> on <code>fuzz/rust-toolchain</code>:3 on 2024-01-29 16:23</div>
            <div class="timeline-body"><p>Since it won&#x27;t run in CI there is no longer a need for it. Removed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/johnsonw">@johnsonw</a> on <code>fuzz/scripts/run-all.sh</code>:12 on 2024-01-29 16:26</div>
            <div class="timeline-body"><p>It&#x27;s mainly used when running in CI but since the fuzz tests will not be running in CI there is no need for this file. I&#x27;ll remove it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/johnsonw">@johnsonw</a> on <code>fuzz/scripts/run-all.sh</code>:6 on 2024-01-29 16:27</div>
            <div class="timeline-body"><p>Script removed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/johnsonw">@johnsonw</a> on <code>fuzz/scripts/run-all.sh</code>:1 on 2024-01-29 16:27</div>
            <div class="timeline-body"><p>Script removed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/johnsonw">@johnsonw</a> on <code>fuzz/scripts/run-all.sh</code>:9 on 2024-01-29 16:27</div>
            <div class="timeline-body"><p>Script removed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/johnsonw">@johnsonw</a> reviewed on 2024-01-29 17:19</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="event">Review requested from <a href="https://github.com/BurntSushi">@BurntSushi</a> by <a href="https://github.com/johnsonw">@johnsonw</a> on 2024-01-30 16:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/johnsonw">@johnsonw</a> on 2024-02-05 17:40</div>
            <div class="timeline-body"><p>Good afternoon, I just wanted to follow up on this. Let me know if there is anything else I need to address.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-02-05 18:27</div>
            <div class="timeline-body"><p>I normally take a long time to review things.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rollup</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-07-11 19:49</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-20 01:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:20 UTC
    </footer>
</body>
</html>
