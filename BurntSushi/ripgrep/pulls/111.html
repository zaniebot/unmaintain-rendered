<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Max depth option - BurntSushi/ripgrep #111</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Max depth option</h1>

    <div class="meta">
        <span class="state-icon state-merged"></span>
        <a href="https://github.com/BurntSushi/ripgrep/pull/111">#111</a>
        opened by <a href="https://github.com/gsquire">@gsquire</a>
        on 2016-09-27 03:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gsquire">@gsquire</a></div>
            <div class="timeline-body"><p>Closes #109</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gsquire">@gsquire</a> on 2016-09-27 05:06</div>
            <div class="timeline-body"><p>I&#x27;m not sure of how to write a unit test because I think I would just be testing <code>walkdir</code> if I did :)</p>
<p>Let me know if you are more clever than me in this regard.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/args.rs</code> on 2016-09-27 11:08</div>
            <div class="timeline-body"><p>Could you add this flag to <code>doc/rg.1.md</code> and run the convert script to create a new <code>doc/rg.1</code> file?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2016-09-27 11:08</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2016-09-27 11:09</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/args.rs</code> on 2016-09-27 11:09</div>
            <div class="timeline-body"><p>Maybe clarify that a value of <code>0</code> searches the current directory only.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2016-09-27 11:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/args.rs</code> on 2016-09-27 11:10</div>
            <div class="timeline-body"><p>I think I like this better, stylistically:</p>
<pre><code>let mut wd = WalkDir::new(path).follow_links(self.follow);
if let Some(maxdepth) = self.maxdepth {
    wd = wd.max_depth(maxdepth);
}
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2016-09-27 11:10</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/args.rs</code> on 2016-09-27 11:10</div>
            <div class="timeline-body"><p>I think we want to allow a value of <code>0</code> to mean &quot;search current directory.&quot; In this case, <code>maxdepth</code> should be an <code>Option&lt;usize&gt;</code>, which docopt will handle correctly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2016-09-27 11:11</div>
            <div class="timeline-body"><p>@gsquire Could you write an integration test please? It would be good to follow the pattern I&#x27;ve been using whenever I introduce new command line flags: https://github.com/BurntSushi/ripgrep/blob/master/tests/tests.rs#L781-L820</p>
<p>Other than that and a few nits, this looks good, thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gsquire">@gsquire</a> on 2016-09-27 17:14</div>
            <div class="timeline-body"><p>I rebased onto master and squashed. Is that the style of integration test you expected?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2016-09-27 18:16</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>tests/tests.rs</code> on 2016-09-27 18:16</div>
            <div class="timeline-body"><p>Could you add a file <code>one/foo</code> with <code>far</code> in it, and assert that you get results? That seems like a slightly better test since it makes sure search still works, but that it also respects the depth setting.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2016-09-27 18:16</div>
            <div class="timeline-body"><p>@gsquire That&#x27;s perfect! I had one last suggestion and then this is ready to go. Thanks so much!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gsquire">@gsquire</a> on 2016-09-27 18:40</div>
            <div class="timeline-body"><p>@BurntSushi Doing this causes the test to fail:</p>
<pre><code>wd.create_dir(&quot;one&quot;);
wd.create(&quot;one/foo&quot;, &quot;far&quot;);
wd.create_dir(&quot;one/too&quot;);
wd.create(&quot;one/too/many&quot;, &quot;far&quot;);

cmd.arg(&quot;--maxdepth&quot;).arg(&quot;1&quot;);

let lines: String = wd.stdout(&amp;mut cmd);
let expected = path(&quot;one/pass:far\n&quot;);

assert_eq!(lines, expected);
</code></pre>
<p>But changing the depth to 2 passes...am I misunderstanding the depth used in <code>walkdir</code>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2016-09-27 19:03</div>
            <div class="timeline-body"><p>I goofed. Looks like your initial implementation is correct. I was off by
one. Could you just make sure we are consistent with GNU find? The docs
will need to be updated too. Sorry for short response. On mobile.</p>
<p>On Sep 27, 2016 2:40 PM, &quot;Garrett Squire&quot; notifications@github.com wrote:</p>
<blockquote>
<p>@BurntSushi https://github.com/BurntSushi Doing this causes the test to
fail:</p>
<p>wd.create_dir(&quot;one&quot;);
wd.create(&quot;one/foo&quot;, &quot;far&quot;);
wd.create_dir(&quot;one/too&quot;);
wd.create(&quot;one/too/many&quot;, &quot;far&quot;);</p>
<p>cmd.arg(&quot;--maxdepth&quot;).arg(&quot;1&quot;);
let lines: String = wd.stdout(&amp;mut cmd);let expected = path(&quot;one/pass:far\n&quot;);</p>
<p>assert_eq!(lines, expected);</p>
<p>But changing the depth to 2 passes...am I misunderstanding the depth used
in walkdir?</p>
<p>â€”
You are receiving this because you were mentioned.
Reply to this email directly, view it on GitHub
<a href="https://github.com/BurntSushi/ripgrep/pull/111">BurntSushi/ripgrep#111</a>#issuecomment-249957714,
or mute the thread
https://github.com/notifications/unsubscribe-auth/AAb34tN10dEsKkF0JR2Cd86vipvZiHLBks5quWMCgaJpZM4KHO4u
.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gsquire">@gsquire</a> on 2016-09-27 19:51</div>
            <div class="timeline-body"><p>It&#x27;s okay, just wanted to verify.</p>
<p>Quoting from the <a href="http://man7.org/linux/man-pages/man1/find.1.html">GNU find man page</a>:</p>
<blockquote>
<p>Descend at most levels (a non-negative integer) levels of directories below the starting-points.
-maxdepth 0 means only apply the tests and actions to the starting-points themselves.</p>
</blockquote>
<p>So no need to update anything? I have to say, I thought having max depth of one and having a file in a directory below <code>.</code> would be found. This is why I asked you to confirm. No rush on this, I want to make sure I understand it correctly is all.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2016-09-27 20:36</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>tests/tests.rs</code> on 2016-09-27 20:36</div>
            <div class="timeline-body"><p>OK, so I think with <code>one/foo</code>, you do indeed need to set <code>maxdepth</code> to <code>2</code>. The argument, <code>.</code>, corresponds to depth <code>0</code>. <code>one</code> is depth <code>1</code> and <code>one/foo</code> is depth <code>2</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2016-09-27 20:38</div>
            <div class="timeline-body"><p>@gsquire Ah OK. Looks good. I think just updating the test to make sure it both ignores a deeper directory and gets search results from a shallower directory should be sufficient. Also, I think the docs need to be updated. Probably saying &quot;current directory&quot; is wrong and we should say &quot;starting points&quot; like <code>find</code> does. Thanks for sticking with me!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gsquire">@gsquire</a> reviewed on 2016-09-27 20:42</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/gsquire">@gsquire</a> on <code>tests/tests.rs</code> on 2016-09-27 20:42</div>
            <div class="timeline-body"><p>Interesting, I thought the count applied to directories and not their contents. I&#x27;ll update it :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2016-09-27 20:45</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>tests/tests.rs</code> on 2016-09-27 20:45</div>
            <div class="timeline-body"><p>The count applies to whether to descend into a directory or not. At depth <code>0</code>, you don&#x27;t descend ever, you just yield whatever was given. So a walkdir of <code>./</code> at depth <code>0</code> yields <code>./</code>. At depth <code>1</code>, you descend once, so that a walkdir of <code>./</code> at depth <code>1</code> yields <code>one</code>, but doesn&#x27;t descend into <code>one</code>. Finally, at depth <code>2</code>, a walkdir of <code>./</code> yields <code>./one</code> and then <code>./one/too</code> and also <code>./one/foo</code>, but doesn&#x27;t descend into <code>./one/too</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gsquire">@gsquire</a> on 2016-09-27 20:53</div>
            <div class="timeline-body"><p>Sweet, I know the phrasing is important. I updated that and the test. Hope it&#x27;s good to go!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/gsquire">@gsquire</a> reviewed on 2016-09-27 20:55</div>
            <div class="timeline-body"></div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/gsquire">@gsquire</a> on <code>tests/tests.rs</code> on 2016-09-27 20:55</div>
            <div class="timeline-body"><p>That makes sense, thanks for a detailed explanation. I suppose it&#x27;s really a &quot;tree&quot; after all.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gsquire">@gsquire</a> on 2016-09-27 23:43</div>
            <div class="timeline-body"><p>Looks like the build failure happened on master too...strange.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Merged by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2016-09-27 23:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2016-09-27 23:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2016-09-27 23:46</div>
            <div class="timeline-body"><p>Yup this looks great. The failure looks unrelated. Thanks so much for doing this and putting up with me! :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2016-09-27 23:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gsquire">@gsquire</a> on 2016-09-27 23:47</div>
            <div class="timeline-body"><p>I&#x27;m happy to be able to contribute, you&#x27;re a Rust machine :)</p>
<p>Congrats on this project!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:15 UTC
    </footer>
</body>
</html>
