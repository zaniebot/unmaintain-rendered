<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[WIP] Add --stats flag and implement basic stat tracking (closes #411) - BurntSushi/ripgrep #799</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[WIP] Add --stats flag and implement basic stat tracking (closes #411)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/pull/799">#799</a>
        opened by <a href="https://github.com/balajisivaraman">@balajisivaraman</a>
        on 2018-02-13 18:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/balajisivaraman">@balajisivaraman</a></div>
            <div class="timeline-body"><p>Creating this PR for review purposes and as a WIP thread for adding the <code>--stats</code> flag to ripgrep.</p>
<ul>
<li>Implement tracking for basic stats (no. of matches, files with matches, files searched, and time taken)</li>
<li>Ensure <code>--stats</code> is ignored when <code>--files</code>, <code>--files-with-matches</code> or <code>--files-without-match</code> are passed</li>
<li>Implement tracking of bytes searched for <code>--no-mmap</code> searches using the <code>counting_reader</code> trick. This will require changing the worker&#x27;s <code>run</code> method to return an Optional <code>bytes_searched</code> attribute along with the existing <code>match_count</code>. We also need to ensure this happens only when <code>--stats</code> is passed.</li>
</ul>
<p>Other thoughts:</p>
<ul>
<li><p>Have used the default <code>Duration</code> implementation from <code>std</code> as did not want to pull in any other dependencies such as <a href="https://crates.io/crates/time"><code>time</code></a> or <a href="https://crates.io/crates/chrono"><code>chrono</code></a>, and this served the purpose very well.</p>
</li>
<li><p>Have defaulted the time to always display in seconds since this is what <code>ag</code> does as well. <code>rg</code> also prints only 3 numbers after the decimal point, as opposed to <code>ag</code>&#x27;s 6.</p>
<p>The only reasoning behind this is that Rust only allows us to control the digits printed after the decimal point, not overall. If we run a very long search, we don&#x27;t want to print something like <code>2751.648931 seconds</code>. So have chosen the nicer option of 3 digits after the decimal point.</p>
<p>I think <code>ag</code> prints 6 digits overall, with the number of digits printed after the decimal point depending on the overall width of the string. (This is the behaviour I&#x27;ve observed; have not verified this with the code.)</p>
</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/balajisivaraman">@balajisivaraman</a> on 2018-02-20 04:26</div>
            <div class="timeline-body"><p>I&#x27;ll close this PR as the current implementation is simply wrong. When I looked at the code for this originally, I overlooked the fact that the searchers return matching line count and not the individual match count, which is what we want for the <code>--stats</code> flag. My apologies for that.</p>
<p>I&#x27;ll work on the proper implementation, which I expect to be a bit more involving than this one. In the meantime, I don&#x27;t want this clogging up the PR space here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/balajisivaraman">@balajisivaraman</a> on 2018-02-20 04:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2018-02-20 04:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/app.rs</code>:1460 on 2018-02-20 12:31</div>
            <div class="timeline-body"><p>Can you put the <code>&quot;);</code> on its own line please?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/app.rs</code>:1464 on 2018-02-20 12:31</div>
            <div class="timeline-body"><p>Remove this blank line please.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Review comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on <code>src/main.rs</code>:398 on 2018-02-20 12:35</div>
            <div class="timeline-body"><p>All lines of source code in ripgrep should be wrapped to 79 columns inclusive (excepting URLs or other things that are inconvenient to wrap). Please see examples of other function declarations for formatting tips.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a> reviewed on 2018-02-20 12:35</div>
            <div class="timeline-body"><p>@balajisivaraman Thanks for working on this! I know you closed this, but you might consider that it is possible to get this merged without much additional work. For example, if you change &quot;match count&quot; to &quot;matched line count&quot; (or similar), then that would be correct and still useful IMO. :) I defer to you! Regardless, I left some small amount of feedback.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch restored on 2018-02-20 14:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/balajisivaraman">@balajisivaraman</a> on 2018-02-20 15:06</div>
            <div class="timeline-body"><p>@BurntSushi, I wouldn&#x27;t mind getting this PR merged at all. :-)</p>
<p>The only reason why I closed this was I&#x27;m going to begin work on the full implementation of it with bytes searched and individual count, so I thought we wouldn&#x27;t want this anyway.</p>
<p>But seeing as that is more involving change with multiple moving parts, it might take some time. So it makes sense to go ahead with this partial implementation in the meanwhile.</p>
<p>I&#x27;ll update the PR to reflect your comments. Thanks! :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/balajisivaraman">@balajisivaraman</a> on 2018-02-20 15:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-03-10 16:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-03-10 16:01</div>
            <div class="timeline-body"><p>@balajisivaraman This was great work, thanks so much! I merged this in https://github.com/BurntSushi/ripgrep/commit/00520b30f5f38e543e17b1a4cc5e8417bc488ea4 with no real changes other than fixing up style (lines should be limited to 79 columns inclusive) and resolving conflicts. I also tweaked the wording of output slightly to indicate that total matches actually corresponds to the total number of matched lines. (So we leave the door open to emit another statistic that reports the total matches.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Branch deleted on 2018-03-10 16:05</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/balajisivaraman">@balajisivaraman</a> on 2018-03-10 16:07</div>
            <div class="timeline-body"><p>@BurntSushi, Thank you for merging this. And my apologies for not updating this PR. I was waiting for the other PR (<code>match_line_count</code>) to get merged so I could update it properly and completely forgot about it. Thanks again. ðŸ˜„</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-03-10 16:22</div>
            <div class="timeline-body"><p>@balajisivaraman No worries! Sometimes my work style isn&#x27;t amenable to waiting too long, and is susceptible to short bursts of maintenance activity. :-) Context switches are extremely expensive for me, so I figured that I would just amortize them by processing all of your PRs, which all were somewhat related!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:16 UTC
    </footer>
</body>
</html>
