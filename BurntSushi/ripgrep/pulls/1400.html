<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>args: Do not attempt to build glob options when not specified. - BurntSushi/ripgrep #1400</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>args: Do not attempt to build glob options when not specified.</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/pull/1400">#1400</a>
        opened by <a href="https://github.com/JesseH-">@JesseH-</a>
        on 2019-10-08 03:24
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JesseH-">@JesseH-</a></div>
            <div class="timeline-body"><p>Closes #1291</p>
<p>This is a first shot at addressing #1291, though I think some additional input is needed.</p>
<p>After reviewing and manually testing, I found that the source of the errors being raised was due to unconditionally building an <code>OverrideBuilder</code> from the globbing options. As this relies on the current working directory, it understandably fails when the cwd does not exist.</p>
<p>The immediate error can be suppressed by checking that the globbing options are actually required before attempting to handle them. This will still raise the same error when any of these options are present without an existing cwd, though perhaps a clearer error message could also be emitted as part of this change in that case.</p>
<p>On the testing front, I wasn&#x27;t able to suitably recreate the original issue in a regression test. In my experiments, I tried to set the <code>current_dir</code> of the <code>TestCommand</code> to something non-existent before running, but this seemed to result in a panic before actually entering any ripgrep code when we go to execute the command.</p>
<p>Manual testing showed that we were able to execute non-globbing ripgrep commands without failure from a non-existent cwd with this change applied.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rollup</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-02-17 02:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-02-17 02:08</div>
            <div class="timeline-body"><p>Thank you very much for this PR! I ended up going in a different direction. In particular:</p>
<ul>
<li>I created a new <code>current_dir</code> helper function. If <code>std::env::curent_dir</code> fails, then ripgrep will try to read <code>PWD</code>. If that fails, then ripgrep will print a more reasonable error message.</li>
<li>Similarish to what you did, if ripgrep does not need to build the glob matchers, then it just creates an empty <code>Override</code> matcher.</li>
</ul>
<p>While I didn&#x27;t end up using your PR, your diagnosis of the situation was super helpful. Likely saved me quite a bit of time! So thank you!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-02-17 22:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:18 UTC
    </footer>
</body>
</html>
