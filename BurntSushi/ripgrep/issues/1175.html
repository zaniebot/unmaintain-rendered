<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>simd-accel no longer works (encoding_rs's SIMD support is broken on the latest nightly) - BurntSushi/ripgrep #1175</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>simd-accel no longer works (encoding_rs's SIMD support is broken on the latest nightly)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1175">#1175</a>
        opened by <a href="https://github.com/lilydjwg">@lilydjwg</a>
        on 2019-01-24 07:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lilydjwg">@lilydjwg</a></div>
            <div class="timeline-body"><h4>What version of ripgrep are you using?</h4>
<p>N/A.</p>
<h4>How did you install ripgrep?</h4>
<p>Failed.</p>
<h4>What operating system are you using ripgrep on?</h4>
<p>I'm trying to build on Arch Linux with Intel(R) Xeon(R) CPU E5-2620 v3 and I'm going to run it on Arch Linux with Intel(R) Core(TM) i7-7700HQ.</p>
<h4>If this is a bug, what are the steps to reproduce the behavior?</h4>
<p>I'm building with:</p>
<pre><code>RUSTFLAGS=&quot;-C target-cpu=skylake&quot; cargo build --release --features 'simd-accel pcre2'
</code></pre>
<h4>If this is a bug, what is the actual behavior?</h4>
<p>I got a lot of errors like this:</p>
<pre><code>error: unrecognized platform-specific intrinsic function: `x86_mm_movemask_ps`      
  --&gt; /build/.cargo/registry/src/github.com-1ecc6299db9ec823/simd-0.2.3/src/x86/sse2.rs:10:5
(more omitted)
</code></pre>
<h4>If this is a bug, what is the expected behavior?</h4>
<p>There shouldn't be such errors.</p>
<hr />
<p>It seems that cargo is trying to build the build script with options intended for the target system.</p>
<p>rustc and cargo are nightly verions.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2019-01-24 12:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "failed to build if the build system doesn't support target features" to "encoding_rs's SIMD support is broken on the latest nightly" by @BurntSushi on 2019-01-24 12:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-01-24 12:06</div>
            <div class="timeline-body"><p>This has nothing to do with whether the build system supports the prescribed target features. The issue is that <code>encoding_rs</code>'s SIMD support is now broken on the latest release of nightly Rust. The only way it becomes unbroken is if nightly Rust reverts the change removing unstable legacy support for for platform specific intrinsics, or if <code>encoding_rs</code> migrates to the new SIMD infrastructure. The latest is, AFAIK, tracked by https://github.com/hsivonen/encoding_rs/issues/23.</p>
<p>I've updated the README in https://github.com/BurntSushi/ripgrep/commit/9a9f54d44ce45c6c3c5bfa31ad1a08fda57cdad7 to note that ripgrep's <code>simd-accel</code> feature is broken.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lilydjwg">@lilydjwg</a> on 2019-01-24 12:58</div>
            <div class="timeline-body"><p>I see, thank you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "encoding_rs's SIMD support is broken on the latest nightly" to "simd-accel no longer works (encoding_rs's SIMD support is broken on the latest nightly)" by @BurntSushi on 2019-01-24 13:24</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/hsivonen">@hsivonen</a> on 2019-02-07 19:38</div>
            <div class="timeline-body"><p>It works now if the lock file is updated with <code>cargo update</code> first. The README for <code>encoding_rs</code> has the details of the pitfalls of trying to build for 32-bit ARM targets whose first component does not have the substring <code>neon</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-02-07 22:06</div>
            <div class="timeline-body"><p>@hsivonen Awesome! Thanks so much. <code>Cargo.lock</code> and <code>README</code> have been updated!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:42:48 UTC
    </footer>
</body>
</html>
