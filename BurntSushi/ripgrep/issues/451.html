<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`--only-matching` only prints first match of matched line N times - BurntSushi/ripgrep #451</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>--only-matching</code> only prints first match of matched line N times</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/451">#451</a>
        opened by <a href="https://github.com/s3rb31">@s3rb31</a>
        on 2017-04-17 16:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/s3rb31">@s3rb31</a></div>
            <div class="timeline-body"><p>Take <a href="https://gist.githubusercontent.com/s3rb31/3eea5bb61414f37968ac1d79a554e137/raw/d8768ae3147520581cc84fb23e892fae5795804f/ripgrep%2520test%2520file">this</a> file as test data. If I do the following with good old <code>grep</code>:</p>
<p><code>grep -Po &quot;\/get\/v\/\d*&quot; fgi.txt</code></p>
<p>I get the following result:</p>
<pre><code>/get/v/19670
/get/v/19637
/get/v/19632
/get/v/19600
/get/v/19598
/get/v/19574
/get/v/19523
/get/v/19521
/get/v/19463
/get/v/19457
/get/v/19433
/get/v/19425
/get/v/19392
/get/v/19390
/get/v/19363
/get/v/19358
/get/v/19337
/get/v/19317
/get/v/19295
/get/v/19278
/get/v/19243
/get/v/19241
/get/v/19208
/get/v/19186
/get/v/19128
/get/v/19126
</code></pre>
<p>But if I try to achive the same result with rg:</p>
<p><code>rg -o &quot;/get/v/\d*&quot; fgi.txt -N</code></p>
<pre><code>/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
/get/v/19670
</code></pre>
<p>I think that behaviour ist really odd and cannot be intended. If I am not mistaken this also violates the documentation (manpage):</p>
<pre><code>-o, --only-matching
    Print only the matched (non-empty) parts of a matching line, with each such part on a separate output line.
</code></pre>
<p>But it does not print all the parts. It just prints the first match N times, where N <em>is</em> actually the correct number of matched parts.</p>
<p>I hope this can get fixed. I may create a PR myself if it is not too complicated and someone can lead me the right direction.</p>
<p>Greetings</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bmalehorn">@bmalehorn</a> on 2017-04-18 20:37</div>
            <div class="timeline-body"><p>Here&#x27;s a much simpler example:</p>
<pre><code>$ cat example.txt
1 2 3

$ grep -Po &quot;[0-9]+&quot; example.txt
1
2
3

$ rg -o &quot;[0-9]+&quot; example.txt -N
1
1
1</code></pre>
<p>@s3rb31 if you want to take a stab it, I believe the bug is here: https://github.com/BurntSushi/ripgrep/blob/master/src/printer.rs#L311 Instead of running the regex again, it should use the original match data to get the start &amp; end.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kpp">@kpp</a> on 2017-04-20 14:22</div>
            <div class="timeline-body"><p>The column is ok, while data is not:</p>
<pre><code>~/ripgrep$ cat tests/digits.txt 
1 2 3
~/ripgrep$ cargo run -- &quot;\d&quot; tests/digits.txt -o -n --column
    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs
     Running `target/debug/rg &#x27;\d&#x27; tests/digits.txt -o -n --column`
1:1:1
1:3:1
1:5:1
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kpp">@kpp</a> on 2017-04-20 15:11</div>
            <div class="timeline-body"><p>Sorry for the bug :sob:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/s3rb31">@s3rb31</a> on 2017-04-20 20:47</div>
            <div class="timeline-body"><p>Oh, this was really quick. Thanks for the fix!</p>
<p>I compiled it and it performs well and solid until now. Will report back if I encounter more bugs.</p>
<p>Thanks again!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/s3rb31">@s3rb31</a> on 2017-04-20 20:47</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:04 UTC
    </footer>
</body>
</html>
