<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>abnormal terminal behavior when piping inside a bash function - BurntSushi/ripgrep #457</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>abnormal terminal behavior when piping inside a bash function</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/457">#457</a>
        opened by <a href="https://github.com/maverickwoo">@maverickwoo</a>
        on 2017-04-21 18:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/maverickwoo">@maverickwoo</a></div>
            <div class="timeline-body"><p>My goal is to define a bash function <code>rg</code> that will run <code>less</code> automatically. However, it seems to cause strange terminal behavior described below. I am able to reproduce this in the macOS environment provided at the end of the post.</p>
<p>This is with a fresh install of ripgrep 0.5.1 as of this writing with rustc 1.6.0 toolchain. The following works as expected. I have unset all less related environment variables <code>LESS</code> and <code>LESSOPEN</code>.</p>
<pre><code>$ function rg () { command rg -Hn &quot;$@&quot; | less; }
$ echo abc | command rg a | less
abc
</code></pre>
<p>But the following results in unexpected terminal behavior:</p>
<pre><code>$ echo abc | rg a

[1]+  Stopped                 echo abc | rg a
</code></pre>
<p>I am not sure how to debug this further and would appreciate any hint. Here is the configuration I used for repro:</p>
<pre><code>Darwin [foo] 13.4.0 Darwin Kernel Version 13.4.0: Mon Jan 11 18:17:34 PST 2016; root:xnu-2422.115.15~1/RELEASE_X86_64 x86_64
GNU bash, version 4.4.12(1)-release (x86_64-apple-darwin13.4.0)
less 487 (PCRE regular expressions)
</code></pre>
<p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/maverickwoo">@maverickwoo</a> on 2017-04-23 03:29</div>
            <div class="timeline-body"><p>The bug is actually in iTerm2 shell integration. I will file the bug there when I figure it out.</p>
<p>Sorry!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/maverickwoo">@maverickwoo</a> on 2017-04-23 03:29</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:04 UTC
    </footer>
</body>
</html>
