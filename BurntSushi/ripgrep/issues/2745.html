<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ripgrep mis-parses `*[\&lt;\&gt;\:\&quot;\/\\\|\?\*]*` in `.gitignore` - BurntSushi/ripgrep #2745</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ripgrep mis-parses <code>*[\&lt;\&gt;\:\&quot;\/\\\|\?\*]*</code> in <code>.gitignore</code></h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2745">#2745</a>
        opened by <a href="https://github.com/andreamah">@andreamah</a>
        on 2024-03-01 22:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/andreamah">@andreamah</a></div>
            <div class="timeline-body"><h3>Please tick this box to confirm you have reviewed the above.</h3>
<ul>
<li>[X] I have a different issue.</li>
</ul>
<h3>What version of ripgrep are you using?</h3>
<p>ripgrep 14.1.0 (rev e50df40a19)</p>
<p>features:-simd-accel,+pcre2
simd(compile):+SSE2,-SSSE3,-AVX2
simd(runtime):+SSE2,+SSSE3,+AVX2</p>
<p>PCRE2 10.42 is available (JIT is available)</p>
<h3>How did you install ripgrep?</h3>
<p>Github release <code>ripgrep_14.1.0-1_amd64.deb</code></p>
<h3>What operating system are you using ripgrep on?</h3>
<p>WSL2: Ubuntu (Linux x64 5.10.102.1-microsoft-standard-WSL2)</p>
<h3>Describe your bug.</h3>
<p>Ripgrep doesn't interpret <code>*[\&lt;\&gt;\:\&quot;\/\\\|\?\*]*</code> in <code>.gitignore</code> in the same way that git does.</p>
<h3>What are the steps to reproduce the behavior?</h3>
<ol>
<li>Create the following file structure:</li>
</ol>
<pre><code>.
├── folder
│   └── bar.txt
└── foo.txt
└── .gitignore
</code></pre>
<p>where the gitignore contains the following:</p>
<pre><code>#-----------------------------
# INVALID FILES
# (for cross OS compatibility)
#-----------------------------
*[\&lt;\&gt;\:\&quot;\/\\\|\?\*]*
</code></pre>
<ol start="2">
<li><code>git init</code></li>
<li><code>git status</code> -&gt; notice that no files are ignored by git.</li>
<li><code>rg --files</code> -&gt; notice that only <code>foo.txt</code> is picked up, not <code>bar.txt</code>.</li>
</ol>
<h3>What is the actual behavior?</h3>
<pre><code>$ rg --files --debug
rg: DEBUG|rg::flags::parse|crates/core/flags/parse.rs:97: no extra arguments found from configuration file
rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1099: using heuristics to determine whether to read from stdin or search ./ (is_readable_stdin=false, stdin_consumed=false, mode=Files)
rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1109: heuristic chose to search ./
rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1260: found hostname for hyperlink configuration: DESKTOP-956ATPJ
rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1264: found wsl_prefix for hyperlink configuration: wsl$/Ubuntu
rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1270: hyperlink format: &quot;&quot;
rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:174: using 8 thread(s)
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;*[\\&lt;\\&gt;\\:\\\&quot;\\/\\\\\\|\\?\\*]*&quot;, re: &quot;(?-u)^[^/]*[\\\\&lt;\\\\&gt;\\\\:\\\\\&quot;\\\\/\\\\\\\\\\\\\\|\\\\\\?\\\\\\*][^/]*$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([ZeroOrMore, Class { negated: false, ranges: [('\\', '\\'), ('&lt;', '&lt;'), ('\\', '\\'), ('&gt;', '&gt;'), ('\\', '\\'), (':', ':'), ('\\', '\\'), ('&quot;', '&quot;'), ('\\', '\\'), ('/', '/'), ('\\', '\\'), ('\\', '\\'), ('\\', '\\'), ('|', '|'), ('\\', '\\'), ('?', '?'), ('\\', '\\'), ('*', '*')] }, ZeroOrMore]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:453: built glob set; 0 literals, 0 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 1 regexes
rg: DEBUG|ignore::walk|crates/ignore/src/walk.rs:1799: ignoring ./.gitignore: Ignore(IgnoreMatch(Hidden))
rg: DEBUG|ignore::walk|crates/ignore/src/walk.rs:1799: ignoring ./.git: Ignore(IgnoreMatch(Hidden))
rg: DEBUG|ignore::walk|crates/ignore/src/walk.rs:1799: ignoring ./folder/bar.txt: Ignore(IgnoreMatch(Gitignore(Glob { from: Some(&quot;./.gitignore&quot;), original: &quot;*[\\&lt;\\&gt;\\:\\\&quot;\\/\\\\\\|\\?\\*]*&quot;, actual: &quot;*[\\&lt;\\&gt;\\:\\\&quot;\\/\\\\\\|\\?\\*]*&quot;, is_whitelist: false, is_only_dir: false })))
foo.txt
</code></pre>
<h3>What is the expected behavior?</h3>
<p>ripgrep should have returned:</p>
<pre><code>folder/bar.txt
foo.txt
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @BurntSushi on 2024-03-02 01:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-03-02 01:20</div>
            <div class="timeline-body"><p>I'll call this a bug since it doesn't match what <code>git</code> does, but I'm not sure ripgrep will ever have precisely the same semantics as the globs supported by <code>git</code>.</p>
<p>I haven't investigated this one in particular. It's possible there's an easy fix. If so, patches are welcome.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gordonwwang">@gordonwwang</a> on 2024-04-10 07:11</div>
            <div class="timeline-body"><p>I thought the example you provided was interesting.
Through analysis and test, I think  &quot;* [\ &lt;, &gt; : &quot; \ / \ ? \ | \ \ <em>] * &quot; actual effect in the git ignore behavior content, can be simplified as &quot;</em>[\/]<em>&quot;. (Because of the character in [], only one character takes effect at the end.)
In fact, it is &quot;</em>[/]*&quot; , and when &quot;/&quot; appears in &quot;[]&quot;, it affects the judgment of git and rg, causing them to ignore the behavior is inconsistent.
However, when git and rg do not behave in the same way, it is not necessarily a problem with rg and we need to experiment further.</p>
<p><strong>Step 1. Create a directory as follows</strong></p>
<pre><code># tree
.
├── folder1
│   └── bar.txt
├── folder2
│   └── b.txt
├── folder3
│   └── c.txt
└── foo.txt
</code></pre>
<p><strong>Step 2. Edit .gitignore</strong></p>
<pre><code># -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -
# INVALID FILES
# -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -
folder1[/]*
folder2[/]
folder3/*
</code></pre>
<p>There are two controlled trials</p>
<ol>
<li>Compare folder1[/]* with folder2[/].</li>
<li>Compare folder2[/] and folder3/.</li>
</ol>
<p><strong>Step 3. View the result.</strong>
git tracking results:</p>
<pre><code>folder1/
folder2/
foo.txt
</code></pre>
<p>rg tracking results:</p>
<pre><code>foo.txt
folder2/b.txt
</code></pre>
<p><strong>Analysis of results:</strong>
Experiment 1: folder2 was consistent in its performance and was not ignored. folder1 is not ignored in git, it is ignored in rg. git and rg behave differently here. git's behavior should be reasonable, does rg need to fix this problem? @BurntSushi
Experiment 2: folder2[/], folder3/, according to the regular expression expansion, the theoretical logic should be the same, but here actually folder2 is not ignored in the end, folder3 is ignored. I feel that there may be a problem with git's judgment logic, and it may be necessary for someone involved in git to look at this issue.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:43:46 UTC
    </footer>
</body>
</html>
