<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>document the difference between -tmd and -g*.md - BurntSushi/ripgrep #1635</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>document the difference between -tmd and -g*.md</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1635">#1635</a>
        opened by <a href="https://github.com/lamyergeier">@lamyergeier</a>
        on 2020-07-04 18:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lamyergeier">@lamyergeier</a></div>
            <div class="timeline-body">What version of ripgrep are you using?
<p>ripgrep 12.0.1
-SIMD -AVX (compiled)
+SIMD +AVX (runtime)</p>
How did you install ripgrep?
<p>linuxbrew</p>
What operating system are you using ripgrep on?
<p>Ubuntu 20.04</p>
Describe your bug.
<p>rg does not respects <code>.gitignore</code>. See example below:</p>
What is the actual behavior?
<pre><code>Test-Glob() {
	mkdir -p Temp
	cd Temp || exit
	git init &gt; /dev/null
	cp &quot;../Data/.gitignore&quot; .
	mkdir -p a/.Commit &amp;&amp; touch a/.Commit/a.md
	touch a/a.md
	echo &quot;PWD= ${PWD}&quot;
	echo &quot;${Blue:=}------------Cat gitignore--------------------${Normal:=}&quot;
	cat .gitignore
	echo &quot;${Blue:=}------------List files not ignored--------------------${Normal:=}&quot;
	git check-ignore -v ./**/*
	echo &quot;${Blue:=}------------Find--------------------${Normal:=}&quot;
	find . -type f -name &quot;*.md&quot;
	echo &quot;${Blue:=}------------Ripgrep Glob--------------------${Normal:=}&quot;
	rg --glob &quot;*.md&quot; --files
	echo &quot;${Blue:=}------------Ripgrep--------------------${Normal:=}&quot;
	rg --files
	cd ..
	#Trash Temp &gt; /dev/null
}
</code></pre>
<pre><code>PWD= /home/nikhil/Documents/Git/Cs/Architecture/ArchitectureSrc/Hardware/MemoryUnit/Harddisk/FileSystem/File/ListSearch/AckAgRipgrep/Src/Temp
------------Cat gitignore--------------------
# Ignore everything
*

# Unignore all dirs
!*/

# Unignore
!*.md

# Ignore directory
/**/.Commit/**
------------List files not ignored--------------------
.gitignore:8:!*.md      ./a/a.md
------------Find--------------------
./a/a.md
./a/.Commit/a.md
------------Ripgrep Glob--------------------
a/a.md
a/.Commit/a.md
------------Ripgrep--------------------
a/a.md
</code></pre>
What is the expected behavior?
<p>rg should ignore <code>./a/.Commit/a.md</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;rg does not respects `.gitignore`&quot; to &quot;`rg --glob` does not respects `.gitignore`&quot; by <a href="https://github.com/lamyergeier">@lamyergeier</a> on 2020-07-04 18:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-07-05 12:52</div>
            <div class="timeline-body"><p>Thank you for the detailed bug report, but this is correct behavior. Glob overrides always have the highest precedent. So if you use <code>-g &#x27;*.md&#x27;</code> and ripgrep would otherwise descend into a directory containing a <code>.md</code> file (i.e., the directory itself wasn&#x27;t ignored), then ripgrep will search ever <code>.md</code> file in that directory.</p>
<p>Interestingly, the same is <em>not</em> true for file types. If you use <code>-tmd</code> instead for example, then <code>a/.Commit/a.md</code> is ignored.</p>
<p>This does seem like something that the docs could be more explicit about, so I&#x27;ll mark this as a doc bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-07-05 12:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">doc</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-07-05 12:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-07-05 12:52</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;`rg --glob` does not respects `.gitignore`&quot; to &quot;document the difference between -tmd and -g*.md&quot; by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-07-05 12:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lamyergeier">@lamyergeier</a> on 2020-07-05 14:24</div>
            <div class="timeline-body"><p>Hi I knew about <code>-tmd</code>, but was using <code>glob</code> only because I wanted to search for random extensions (non-standard).</p>
<p>Not complaining, but I thought rg followed the behavior of <code>.gitignore</code>, as you mentioned it here: <a href="https://github.com/BurntSushi/ripgrep/issues/689">BurntSushi/ripgrep#689</a>#issuecomment-347173094</p>
<blockquote>
<p>You said: However, if you had read the README or the blog post introducing ripgrep, then it should have been very clear that respecting gitignore by default is a fundamental design decision.</p>
</blockquote>
<p>If I am mistaken, I request you to reconsider this as by this we could support random extensions and  also respect <code>.gitigore</code></p>
<hr>
<p>Also please see the following, when I modified .gitignore (Is this consistent with your comment? I am not sure.):</p>
<pre><code>Test-Glob() {
	mkdir -p Temp
	cd Temp || exit
	git init &gt; /dev/null
	echo &#x27;/**/.Commit/**&#x27; &gt; .gitignore
	mkdir -p a/.Commit &amp;&amp; touch a/.Commit/a.md
	touch a/a.md
	echo &quot;PWD= ${PWD}&quot;
	echo &quot;${Blue:=}------------Cat gitignore--------------------${Normal:=}&quot;
	cat .gitignore
	echo &quot;${Blue:=}------------List files not ignored--------------------${Normal:=}&quot;
	git check-ignore -v ./**/*
	echo &quot;${Blue:=}------------Find--------------------${Normal:=}&quot;
	find . -type f -name &quot;*.md&quot;
	echo &quot;${Blue:=}------------Ripgrep Glob--------------------${Normal:=}&quot;
	rg --glob &quot;*.md&quot; --files
	echo &quot;${Blue:=}------------Ripgrep--------------------${Normal:=}&quot;
	rg --files
	cd ..
}
</code></pre>
<pre><code>------------Cat gitignore--------------------
/**/.Commit/**
------------List files not ignored--------------------
------------Find--------------------
./a/a.md
./a/.Commit/a.md
------------Ripgrep Glob--------------------
a/a.md
------------Ripgrep--------------------
a/a.md
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-07-05 14:49</div>
            <div class="timeline-body"><blockquote>
<p>but I thought rg followed the behavior of <code>.gitignore</code></p>
</blockquote>
<p>It does. The fact that rules in a <code>.ignore</code> override <code>.gitignore</code> does not mean ripgrep doesn&#x27;t follow the behavior of gitignore. And similarly for the <code>--glob</code> flag. ripgrep does <em>more</em> than just gitignore anyway. It also filters out hidden and binary files by default.</p>
<blockquote>
<p>I request you to reconsider this</p>
</blockquote>
<p>No, the behavior isn&#x27;t changing. It would be a breaking change that feels big enough to me that I&#x27;m not comfortable with it, and while I see that there are problems with the current behavior, there would also be problems with your proposed behavior. Ultimately, I judged that the status quo was the least bad option and went with that.</p>
<blockquote>
<p>Also please see the following, when I modified .gitignore (Is this consistent with your comment? I am not sure.):</p>
</blockquote>
<p>Yes, because <code>/**/.Commit/**</code> ends up ignoring <code>.Commit</code> itself, which means ripgrep doesn&#x27;t descend into that directory. Use the <code>--debug</code> flag to see how filtering rules are applied:</p>
<pre><code>DEBUG|ignore::walk|crates/ignore/src/walk.rs:1730: ignoring ./a/.Commit: Ignore(IgnoreMatch(Hidden))
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lamyergeier">@lamyergeier</a> on 2020-07-05 16:52</div>
            <div class="timeline-body"><p>Sorry for the confusion: I am really not sure why  <code>/**/.Commit/**</code> is ignored in second case but not in the first case?</p>
<blockquote>
<p>For the first case you said:</p>
</blockquote>
<blockquote>
<p>Glob overrides always have the highest precedent. So if you use -g &#x27;*.md&#x27; and ripgrep would otherwise descend into a directory containing a .md file (i.e., the directory itself wasn&#x27;t ignored), then ripgrep will search ever .md file in that directory.</p>
</blockquote>
<p>What i understood (from your comments): If glob finds <code>*.md</code> even in a gitignored directory, it will still print it.</p>
<p>Going by this explanation, if glob overrides always has the highest precedent,  then rg should also print <code>a/.Commit/a.md</code> in the second case. Isn&#x27;t it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-07-05 17:08</div>
            <div class="timeline-body"><p>It has to descend into the directory in the first place. Look at the <code>--debug</code> output. With your second gitignore file, ripgrep doesn&#x27;t descend into <code>a/.Commit</code> at all. So there is no opportunity for <code>*.md</code> to match it.</p>
<p>This is why I wrote, &quot;and ripgrep would otherwise descend into the directory.&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rollup</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2023-11-25 19:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2023-11-25 20:04</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:10 UTC
    </footer>
</body>
</html>
