<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Should override with last given value when incompatible options are used - BurntSushi/ripgrep #491</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Should override with last given value when incompatible options are used</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/491">#491</a>
        opened by <a href="https://github.com/ericbn">@ericbn</a>
        on 2017-05-25 22:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ericbn">@ericbn</a></div>
            <div class="timeline-body"><p>That I can think of, is does not make sense to have</p>
<ul>
<li><code>--vimgrep</code> and <code>--count</code></li>
<li><code>--vimgrep</code> and <code>--heading</code></li>
<li><code>--vimgrep</code> and <code>--pretty</code></li>
</ul>
<p>both at the same time. As vimgrep is trying to ouput</p>
<pre><code>filename:linenumber:columnnumber:text</code></pre>
<p>and the other options conflict with this. It would not make sense to have vimgrep with <code>--no-line-number</code> or <code>--no-filename</code> either, but these would just generate &quot;useless&quot; output...</p>
<p>@BurntSushi, do you agree rg should fail if conflicting arguments are passed?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ericbn">@ericbn</a> on 2017-05-25 23:18</div>
            <div class="timeline-body"><p>Other conflicting options are</p>
<ul>
<li>(<code>--heading</code> or <code>--pretty</code>) and <code>--no-heading</code></li>
<li>(<code>--line-number</code> or <code>--column</code> or <code>--pretty</code>) and (<code>--no-line-number</code> or <code>--count</code>)</li>
<li><code>--no-filename</code> and <code>--with-filename</code></li>
<li><code>--no-mmap</code> and <code>--mmap</code></li>
<li><code>--ignore-case</code> and <code>--case-sensitive</code> and <code>--smart-case</code> (an &quot;argument group&quot; here)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-05-26 10:57</div>
            <div class="timeline-body"><p>We need to tread carefully here. We can't just say &quot;these flags conflict and therefore produce an error if both are provided.&quot; A more measured strategy is required IMO. We might want to say that between <code>--foo</code> and <code>--bar</code> (for example), the one specified most recently overrides all previous uses of <code>--foo</code> and <code>--bar</code>. This is, for example, useful if someone is using an alias to setup a default set of flags. It will also become relevant if/when ripgrep gets a config file some day, since one might expect the config file to be a set of flags used by default by the user. For that to work well, flags need to be overridable.</p>
<p>I believe clap supports flags that mutually override each other, although I can't remember the precise semantics off the top of my head.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-05-26 11:00</div>
            <div class="timeline-body"><p>Your initial examples with <code>--vimgrep</code> might qualify as flags that really do conflict with each other since the mode that <code>--vimgrep</code> implies doesn't really make sense with uses of some flags. Other examples, though, like <code>--no-mmap</code> and <code>--mmap</code> seem more like &quot;one overrides the other&quot; rather than &quot;one conflicts with the other.&quot;</p>
<p>With all that said, I'm somewhat skeptical of forcing a hard error on conflict, and instead try to define sensible semantics for each combination. The former gives the end user less flexibility, and in my experience, with the number of flags that ripgrep supports, end users can be <em>intensely</em> creative in the types of flag combinations they come up with. It would be a shame to start a crusade to decrease the ability to be creative.</p>
<p>Thoughts?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ericbn">@ericbn</a> on 2017-05-26 14:52</div>
            <div class="timeline-body"><p>I haven't thought about overriding. Sure, is more flexible and gives a better user experience. This is from the <a href="https://github.com/kbknapp/clap-rs/blob/master/README.md#features">clap README</a>:</p>
<blockquote>
<p><strong>POSIX Compatible Conflicts/Overrides</strong> - In POSIX args can be conflicting, but not fail parsing because whichever arg comes last &quot;wins&quot; so to speak. This allows things such as aliases (i.e. <code>alias ls='ls -l'</code> but then using <code>ls -C</code> in your terminal which ends up passing <code>ls -l -C</code> as the final arguments. Since <code>-l</code> and <code>-C</code> aren't compatible, this effectively runs <code>ls -C</code> in clap if you choose...clap also supports hard conflicts that fail parsing).</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @BurntSushi on 2017-05-30 11:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Should fail when incompatible options are used" to "Should override with last given value when incompatible options are used" by @ericbn on 2017-06-01 00:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ericbn">@ericbn</a> on 2017-06-02 00:00</div>
            <div class="timeline-body"><p>We're not completely able to override last options with previous ones as clap does not allow that in some cases, as reported in kbknapp/clap-rs#970 and kbknapp/clap-rs#976. Some minimal changes in this direction, using what we can get from clap, are in #499.</p>
<p>I was experimenting with <a href="https://github.com/tailhook/rust-argparse">rust-argparse</a> and it looks like a much simpler, yet more flexible solution. It's API is more similar to the <a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/getopt.html">C POSIX implementation</a> in the sense that variables are set in a loop, so last assignments &quot;win&quot;. Also, no bells and whistles like <a href="https://github.com/BurntSushi/ripgrep/issues/353">color output</a>. On the other hand: <a href="https://github.com/tailhook/rust-argparse/issues/42">choices</a>, and <a href="https://github.com/tailhook/rust-argparse/issues/23">required</a> and conflicting arguments would need to be handled manually with rust-argparse.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-06-02 00:40</div>
            <div class="timeline-body"><p>@ericbn Thanks for looking into this. I've only briefly glanced at the clap issues. I will say this though: I really do not want to switch argv parsers.</p>
<p>Note that I don't particularly care that much about POSIX per se, but care more about just ironing out a decent user experience. So if there are corner cases that aren't strictly compatible with POSIX but don't have a big impact on actual uses, then I'm fine with that. (And of course, I understand that &quot;POSIX compatibility&quot; can be treated as an approximation to good UX because it is familiar.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ericbn">@ericbn</a> on 2017-06-02 01:19</div>
            <div class="timeline-body"><p>@BurntSushi, sounds good. I don't care about &quot;POSIX compatibility&quot; either, I just think the &quot;last overrides previous&quot; and other characteristics present these make sense for a good UX.</p>
<p>I'll close this and hope we can see improvements in clap and make use of them in the future...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ericbn on 2017-06-02 01:19</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ericbn">@ericbn</a> on 2017-08-04 19:42</div>
            <div class="timeline-body"><p>Just to follow up on the general argv parser discussion, <code>exa</code> implemented their own parser instead of using clap-rs, as per https://github.com/ogham/exa/issues/152#issuecomment-320224452, because &quot;clap-rs doesn't have any way to allow later arguments to override earlier ones&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-08-04 19:55</div>
            <div class="timeline-body"><p>@ericbn Thanks! That's a useful data point. ripgrep will definitely not grow its own argv parser though. :-)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:42:11 UTC
    </footer>
</body>
</html>
