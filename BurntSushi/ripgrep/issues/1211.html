<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>type-add for make in .ripgreprc doesn't seem to search added files - BurntSushi/ripgrep #1211</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>type-add for make in .ripgreprc doesn't seem to search added files</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1211">#1211</a>
        opened by <a href="https://github.com/mathomp4">@mathomp4</a>
        on 2019-03-07 12:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mathomp4">@mathomp4</a></div>
            <div class="timeline-body"><h4>What version of ripgrep are you using?</h4>
<pre><code>07:23 $ rg --version
ripgrep 0.10.0
-SIMD -AVX (compiled)
+SIMD +AVX (runtime)
</code></pre>
<h4>How did you install ripgrep?</h4>
<p>Homebrew</p>
<h4>What operating system are you using ripgrep on?</h4>
<p>macOS 10.13.6 (High Sierra)</p>
<h4>Describe your question, feature request, or bug.</h4>
<p>A model I work on uses GNU Make as a build system, but often has &quot;unique&quot; names for the makefiles including <code>GNUmakefile_openmp</code> and <code>GNUmakefile_rnin</code>. I'd like to have <code>rg -t make</code> search these files. However, it seems like it does not. To wit, in my <code>.ripgreprc</code> file I have:</p>
<pre><code>--type-add
make:GNUmakefile_openmp, GNUmakefile_r4r8, GNUmakefile_rnin
</code></pre>
<p>and <code>rg --type-list</code> seems to see it:</p>
<pre><code>07:27 $ rg --type-list | rg make
amake: *.bp, *.mk
cmake: *.cmake, CMakeLists.txt
make: *.mak, *.mk, GNUmakefile, GNUmakefile_openmp, GNUmakefile_r4r8, GNUmakefile_rnin, Gnumakefile, Makefile, gnumakefile, makefile
qmake: *.prf, *.pri, *.pro
</code></pre>
<p>Now in a directory I have a good mix:</p>
<pre><code>07:27 $ fd GNUmakefile
GNUmakefile
NCEP_bacio/GNUmakefile
NCEP_bacio/GNUmakefile_rnin
NCEP_sfcio/GNUmakefile
NCEP_sigio/GNUmakefile
NCEP_sp/GNUmakefile
NCEP_sp/GNUmakefile_rnin
NCEP_w3/GNUmakefile
NCEP_w3/GNUmakefile_rnin
</code></pre>
<p>and if I do a <code>grep -i ranlib</code> on this directory's <code>GNUmakefile*</code>:</p>
<pre><code>07:27 $ fd GNUmakefile -X grep -i ranlib {}
NCEP_sigio/GNUmakefile:	$(RANLIB) $(RANLIB_FLAGS) $(LIB)
NCEP_sfcio/GNUmakefile:	$(RANLIB) $(RANLIB_FLAGS) $(LIB)
NCEP_bacio/GNUmakefile_rnin:	$(RANLIB) $(RANLIB_FLAGS) $(LIB)
NCEP_w3/GNUmakefile_rnin:	$(RANLIB) $(RANLIB_FLAGS) $(LIB)
NCEP_sp/GNUmakefile_rnin:	$(RANLIB) $(RANLIB_FLAGS) $(LIB)
</code></pre>
<p>However, if I do <code>rg</code> in the same place:</p>
<pre><code>07:28 $ rg -i ranlib -t make
NCEP_sigio/GNUmakefile
80:	$(RANLIB) $(RANLIB_FLAGS) $(LIB)

NCEP_sfcio/GNUmakefile
81:	$(RANLIB) $(RANLIB_FLAGS) $(LIB)
</code></pre>
<h4>If this is a bug, what is the expected behavior?</h4>
<p>As <code>--type-list</code> says <code>GNUmakefile_rnin</code> is a &quot;make&quot; type file, <code>rg</code> should have found matches for RANLIB in <code>NCEP_bacio/GNUmakefile_rnin</code>, <code>NCEP_w3/GNUmakefile_rnin</code>, and <code>NCEP_sp/GNUmakefile_rnin</code>.</p>
<p>That said, it's entirely possible I didn't &quot;add&quot; things right in <code>.ripgreprc</code>. My full rc is:</p>
<pre><code>07:34 $ cat ~/.ripgreprc

# Don't let ripgrep vomit really long lines to my terminal.
--max-columns=150

--type-add
fortran:*.P90, *.cuf, *.CUF

--type-add
make:GNUmakefile_openmp, GNUmakefile_r4r8, GNUmakefile_rnin

# Because who cares about case!?
--smart-case

# Colorize
--colors=path:fg:green
#--colors=path:style:bold
--colors=line:fg:yellow
--colors=line:style:bold

#--line-number-width=5
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-03-07 13:22</div>
            <div class="timeline-body"><p>Thanks for the careful bug report! However, this isn't a bug and this doesn't have anything to do with <code>.ripgreprc</code>. Namely, please read the <a href="https://github.com/BurntSushi/ripgrep/blob/master/GUIDE.md#manual-filtering-file-types">section in the docs on type filtering</a> a bit more carefully. Your syntax isn't correct. ripgrep is treating <code>GNUmakefile_openmp, GNUmakefile_r4r8, GNUmakefile_rnin</code> as one big glob. Here is the correct way to do it:</p>
<pre><code>$ rg --files
GNUmakefile_r4r8
foo
Makefile
GNUmakefile_openmp

$ rg --files -tmake
Makefile

$ rg --files -tmake --type-add 'make:GNUmakefile_openmp'
Makefile
GNUmakefile_openmp

$ rg --files -tmake --type-add 'make:GNUmakefile_openmp' --type-add 'make:GNUmakefile_r4r8'
GNUmakefile_r4r8
Makefile
GNUmakefile_openmp

$ rg --files -tmake --type-add 'make:GNUmakefile_openmp, GNUmakefile_r4r8'
Makefile
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2019-03-07 13:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">invalid</span> added by @BurntSushi on 2019-03-07 13:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mathomp4">@mathomp4</a> on 2019-03-07 15:33</div>
            <div class="timeline-body"><p>For those who find this in search, as @BurntSushi says, this is correct for <code>.ripgreprc</code>:</p>
<pre><code>--type-add
make:GNUmakefile_openmp

--type-add
make:GNUmakefile_r4r8

--type-add
make:GNUmakefile_rnin
</code></pre>
<p>Not all one line.</p>
<p>Well, unless you have a file called <code>GNUmakefile_openmp, GNUmakefile_r4r8, GNUmakefile_rnin</code> :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-03-07 15:42</div>
            <div class="timeline-body"><p>If you did want one line, then this should work too:</p>
<pre><code>--type-add
make:{GNUmakefile_openmp,GNUmakefile_r4r8,GNUmakefile_rnin}
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:42:50 UTC
    </footer>
</body>
</html>
