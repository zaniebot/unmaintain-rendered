<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ignore]: Support absolute paths in global ignore files (via `add_ignore`).  - BurntSushi/ripgrep #2366</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ignore]: Support absolute paths in global ignore files (via <code>add_ignore</code>).</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2366">#2366</a>
        opened by <a href="https://github.com/tmccombs">@tmccombs</a>
        on 2022-12-04 07:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tmccombs">@tmccombs</a></div>
            <div class="timeline-body"><h4>Describe your feature request</h4>
<p>It is sometimes desirable to add a global ignore rule using an absolute path. Say for example I always wanted to ignore everything in /home/myuser/.cache.</p>
<p>.gitignore doesn't have a mechanism to do this, because git doesn't really care about anything outside of the git repository (at least for the context of .gitignore). However, for more general tools such as  ripgrep (and <code>fd</code>) it does make sense to want to ignore something based on an absolute path, at least for global ignore files (such as ~/.config/fd/ignore).</p>
<p>I see a couple ways of addressing this:</p>
<ol>
<li>Add some new syntax which is only supported in &quot;global&quot; ignore files (or at least not git ignore files) to indicate that a pattern should be matched against the full absolute path of the file. Maybe if the pattern starts with &quot;//&quot;?</li>
<li>If the pattern starts with a &quot;/&quot; in a global ignore file, then treat it as an absolute path pattern. This would be backwards compatible, unless there was new API for adding an ignore file that had this behavior (and maybe ripgrep wouldn't use this, or if it did used a new flag for it?).</li>
</ol>
<p>See https://github.com/sharkdp/fd/issues/1150#issuecomment-1336156334</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2022-12-04 12:22</div>
            <div class="timeline-body"><blockquote>
<p>Say for example I always wanted to ignore everything in /home/myuser/.cache.</p>
</blockquote>
<p>Could you please say why you can't use a <code>.ignore</code> file? e.g.,</p>
<pre><code>$ echo '/.cache' &gt; /home/myuser/.ignore
</code></pre>
<p>Also, ripgrep will ignore <code>.cache</code> by default because it is a hidden directory.</p>
<blockquote>
<p>If the pattern starts with a &quot;/&quot; in a global ignore file, then treat it as an absolute path pattern. This would be backwards compatible</p>
</blockquote>
<p>It is not backwards compatible. Starting a glob pattern in a gitignore file with <code>/</code> anchors the pattern to the current working directory of the search. That's true in global gitignore files just as much as any other.</p>
<p>Overall, I don't see a compelling use case here. And even if there were a good use case, it would have to be <em>very</em> compelling because this is a rather complex feature to implement in an already complex part of ripgrep. Namely, if you have an absolute glob pattern, then you also need to turn <em>every file path</em> you're searching into an absolute path. That has a non-trivial cost, which means ripgrep would want to avoid turning everything into an absolute path if it didn't have to. Which means it would have to scan gitignore files for absolute patterns before starting the search. Which is just not great.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2022-12-04 12:22</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wontfix</span> added by @BurntSushi on 2022-12-04 12:22</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tmccombs">@tmccombs</a> on 2022-12-05 08:10</div>
            <div class="timeline-body"><blockquote>
<p>Could you please say why you can't use a .ignore file? e.g.,</p>
</blockquote>
<p>I can think of a few reasons:</p>
<ol>
<li>You don't have write access to the necessary directory. Say you wanted to ignore /var/log/noisy-app, but didn't have root access on the system.</li>
<li>You want your ignore rules in a more centralized location, possibly to make it easier to check it in to a git repo or similar.</li>
<li>You don't want to clutter the parent folder with a hidden file.</li>
</ol>
<p>But these are just hypotheses. See below.</p>
<blockquote>
<p>It is not backwards compatible</p>
</blockquote>
<p>Sorry, that was a typo. I meant to say that it is backwards incompatible.Â </p>
<blockquote>
<p>Starting a glob pattern in a gitignore file with / anchors the pattern to the current working directory of the search. That's true in global gitignore files just as much as any other.</p>
</blockquote>
<p>First of all, &quot;/&quot; in gitignore usually anchors to the location of the .gitignore file. But for global gitignores it anchors to the the root of the current git repository.  The current working directory doesn't matter beyond dtermining the current git repo. Anchoring to the current directory doesn't actually seem very useful to me. If I have a rule to ignore &quot;/foo/bar&quot;, in my global ignore file, and there is a file at &quot;/a/b/foo/bar/c/d&quot;, then the current behavior is if I run <code>rg</code> in &quot;/a/b&quot; it will be ignored, but if I run it from &quot;/a&quot; or &quot;/a/b/foo/&quot;, then it won't be ignored. Maybe there are use cases for that, but that seems less useful than being able to say that I want to ignore &quot;/a/b/foo/bar&quot; regardless of where I run <code>rg</code> from. Or even have a pattern like &quot;/**/foo/bar&quot;.</p>
<p>Also, of the two, I would prefer having a distinct syntax for absolute patterns (maybe some sigil at the beginning that indicates the remander should be matched against the absolute path, I suggested &quot;//&quot; becuase that seems unlikely to appear at the beginning of an existing pattern).  I included the option of a backwards incompatible change to how pattersn starting wtih &quot;/&quot; are matched mainly for completeness.</p>
<blockquote>
<p>Namely, if you have an absolute glob pattern, then you also need to turn every file path you're searching into an absolute path. That has a non-trivial cost, which means ripgrep would want to avoid turning everything into an absolute path if it didn't have to. Which means it would have to scan gitignore files for absolute patterns before starting the search. Which is just not great.</p>
</blockquote>
<p>That's a legitimate concern.  And I don't really see a way out of increasing the complexity, and if it would significantly add to the complexity maybe it isn't worth it. But I would like to point out a few things:</p>
<ul>
<li>I am not proposing that this would be used for gitignore files. This would only be for non-git ignore files that are treated as global, such as <code>~/.config/fd/ignore</code> for <code>fd</code>, or maybe a file passed to ripgrep with <code>--ignore-file</code> (or possibly via a new flag).</li>
<li>This is primarily a request to have an API that would allow doing this with the ignore crate used as a library, even if ripgrep itself doesn't make use of it.</li>
<li>Given that it would be limited in scope mentioned above, the ignore files would need to parsed before starting the search anyway.</li>
</ul>
<p>Finally, I haven't personally run into a need for this. However, this has come up a few times for <a href="https://github.com/sharkdp/fd"><code>fd</code></a>. <a href="https://github.com/sharkdp/fd/issues/1150">Here</a> and <a href="https://github.com/sharkdp/fd/issues/851">here</a> (actually that one would impact the <code>overrides</code> API, but similar idea) and <a href="https://github.com/sharkdp/fd/issues/763">here</a>. And since <code>fd</code> uses the <code>ignore</code> crate, it would be rather difficult to support the feature there without something changing in the <code>ignore</code> crate.</p>
<p>That last one actually points out something interesting. If the starting path passed in to <code>WalkBuilder::new</code> is an absolute path, then patterns that match absolute paths <em>are</em> ignored.  And IMO at least, the fact that ignore matches ignore patterns differently depending on whether the path is passed in as &quot;.&quot; or &quot;/home/myuser&quot; is rather unexpected.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2022-12-05 12:15</div>
            <div class="timeline-body"><blockquote>
<p>And IMO at least, the fact that ignore matches ignore patterns differently depending on whether the path is passed in as &quot;.&quot; or &quot;/home/myuser&quot; is rather unexpected.</p>
</blockquote>
<p>It is consistent with how greps behave. Notice, for example, that if you use an absolute file path as an input, then ripgrep will emit absolute file paths in the search result output. Indeed, the way paths are dealt with is almost purely symbolically. This is also simultaneously the reason why absolute glob patterns don't work when one provides a relative file path.</p>
<p>Bottom line here is that I've been saying that the <code>ignore</code> crate needs to be completely rewritten for a long time now. Its current state is basically not much better than a proof of concept. I just haven't had the time or bandwidth to come back around to the project. When I do, I'll consider issues like this one, but I would say it's unlikely to happen. It's a somewhat niche concern, although I confess it would be nice if all possible sensible things would &quot;just work.&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/omentic">@omentic</a> on 2025-05-08 01:33</div>
            <div class="timeline-body"><blockquote>
<p>Starting a glob pattern in a gitignore file with / anchors the pattern to the current working directory of the search.</p>
</blockquote>
<p>Why is this the case, and how does it differ from leaving off the leading <code>/</code>?</p>
<p>I'm interested in this being fixed. I find it to be my biggest pain point when using both ripgrep and fd: I have a <em>lot</em> of directories I never want either to search (<code>~/.icons</code>, <code>/usr/share/icons</code>, etc) and especially when I'm searching through config files (and so searching hidden files) both tools always have to dump a bunch of garbage from these directories into stdout. Relative paths just don't cut it, because I commonly search from places other than <code>~</code>.</p>
<p>If there is no difference between an entry <code>foo</code> and <code>/foo</code> in an ignore file, I think changing this would give rise to enough of a UX improvement to be worth the breaking changes.</p>
<blockquote>
<p>Which means it would have to scan gitignore files for absolute patterns before starting the search.</p>
</blockquote>
<p>This seems very reasonable. Are there non-degenerate cases in which this would cause serious performance hits?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-05-08 01:40</div>
            <div class="timeline-body"><blockquote>
<p>Why is this the case</p>
</blockquote>
<p>Because that's how gitignores work. See <code>man gitignore</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tmccombs">@tmccombs</a> on 2025-05-08 15:57</div>
            <div class="timeline-body"><p>For gitignore it makes sense, because the git repository is its own container. Git operations don't do anything outside of the git repo, and  using absolute paths in a gitignore file wouldn't be portable.</p>
<p>For ripgrep or fd it makes more sense to want to use an absolute path, especially on the command line.</p>
<p>What if a pattern that started with &quot;//&quot; was treated as an absolute path? But only in command line patterns and maybe .ignore and .rgignore files. In fd we would probably want to support it in the global ignore file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-05-08 16:03</div>
            <div class="timeline-body"><p>I understand that. I'm just explaining why <code>/</code> is interpreted the way it is.</p>
<p>The main problem I have here is that gitignore is the fundamental interface through which ripgrep deals with ignore rules. ripgrep <em>meets git where it is</em>, and there's value in that. I agree that there is an impedance mismatch here because git and ripgrep are two different tools. Moreover, we <em>could</em> at minimum extend the format of <code>.ignore</code> and <code>.rgignore</code> since those aren't read by git. But still, there is a cost that comes from diverging from what git supports. Maybe we need a v2 <code>.ignore</code>/<code>.rgignore</code> format or something that has different semantics from <code>.gitignore</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/omentic">@omentic</a> on 2025-05-08 18:42</div>
            <div class="timeline-body"><blockquote>
<p>See <code>man gitignore</code>.</p>
</blockquote>
<p>Ah, I see. That's unfortunate.</p>
<p>Another approach might be to have a separate file / command line option for global ignores? This would be a little ugly but would be clear to end users if it's mentioned next to the docs for <code>--ignore-file</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-05-08 18:51</div>
            <div class="timeline-body"><p>There's a lot of different ways to do it. See my comments above for <code>ignore</code> plans.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:43:35 UTC
    </footer>
</body>
</html>
