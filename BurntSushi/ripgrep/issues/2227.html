<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ripgrep13 times out on simple search. Ripgrep12 works like a champ. - BurntSushi/ripgrep #2227</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ripgrep13 times out on simple search. Ripgrep12 works like a champ.</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2227">#2227</a>
        opened by <a href="https://github.com/firepick1">@firepick1</a>
        on 2022-06-03 13:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/firepick1">@firepick1</a></div>
            <div class="timeline-body">What version of ripgrep are you using?
<p>13.0.0</p>
<p>We are using 12.1.1 since 13.0.0 doesn&#x27;t work</p>
How did you install ripgrep?
<p>RQDVER=13.0.0
curl -LO https://github.com/BurntSushi/ripgrep/releases/download/${RQDVER}/ripgrep_${RQDVER}<em>amd64.deb<br>
sudo dpkg -i ripgrep</em>${RQDVER}_amd64.deb</p>
<p>If you installed ripgrep with snap and are getting strange file permission or
file not found errors, then please do not file a bug. Instead, use one of the
Github binary releases.</p>
What operating system are you using ripgrep on?
<p>Chromebook Pixel Linux [sudo lsb_release -a]</p>
<p>Distributor ID: Debian
Description:    Debian GNU/Linux 10 (buster)
Release:        10
Codename:       buster</p>
Describe your bug.
<p>Invoking following command from NodeJS 16 or 18 works fine on rg12.1.1 but times out on rg13.0.0</p>
<pre><code>  rg -c -e &quot;root of suffering&quot;
</code></pre>
<p>From shell command prompt, both rg12 and rg13 work as expected.</p>
<p>Invoking following command does work from any NodeJS, however:</p>
<pre><code>  rg --version
</code></pre>
What are the steps to reproduce the behavior?
<p>See https://github.com/sc-voice/rg-bug</p>
What is the actual behavior?
<p>The test times out after 5 seconds. Increasing the timeout does not affect outcome. Here is the stdout and stderr from exec():</p>
<pre><code>DEBUG|rg::config|crates/core/config.rs:40: /home/karl/pixel/ripgreprc: arguments loaded from config file: [&quot;--glob=!git/*&quot;, &quot;--glob=!local/*&quot;, &quot;--glob=!dis
t/*&quot;, &quot;--glob=!**/lib/&quot;, &quot;--glob=!*min.css&quot;, &quot;--glob=!node_modules/*&quot;, &quot;--glob=!package-lock.json&quot;]\n&#x27; +                                                               
      &#x27;DEBUG|rg::args|crates/core/args.rs:543: final argv: [&quot;rg&quot;, &quot;--glob=!git/*&quot;, &quot;--glob=!local/*&quot;, &quot;--glob=!dist/*&quot;, &quot;--glob=!**/lib/&quot;, &quot;--glob=!*min.css&quot;, &quot;--glob=!
node_modules/*&quot;, &quot;--glob=!package-lock.json&quot;, &quot;-c&quot;, &quot;--debug&quot;, &quot;-e&quot;, &quot;root of suffering&quot;]\n&#x27; +
      &#x27;DEBUG|grep_regex::literal|crates/regex/src/literal.rs:58: literal prefixes detected: Literals { lits: [Complete(root of suffering)], limit_size: 250, limit_class
: 10 }\n&#x27; +
      &#x27;DEBUG|globset|crates/globset/src/lib.rs:421: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes\n&#x27;
+          
      `DEBUG|globset|crates/globset/src/lib.rs:416: glob converted to regex: Glob { glob: &quot;git/*&quot;, re: &quot;(?-u)^git/[^/]*$&quot;, opts: GlobOptions { case_insensitive: false, 
literal_separator: true, backslash_escape: true }, tokens: Tokens([Literal(&#x27;g&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;t&#x27;), Literal(&#x27;/&#x27;), ZeroOrMore]) }\n` +
      `DEBUG|globset|crates/globset/src/lib.rs:416: glob converted to regex: Glob { glob: &quot;local/*&quot;, re: &quot;(?-u)^local/[^/]*$&quot;, opts: GlobOptions { case_insensitive: fal
se, literal_separator: true, backslash_escape: true }, tokens: Tokens([Literal(&#x27;l&#x27;), Literal(&#x27;o&#x27;), Literal(&#x27;c&#x27;), Literal(&#x27;a&#x27;), Literal(&#x27;l&#x27;), Literal(&#x27;/&#x27;), ZeroOrMore]) 
}\n` +  
      `DEBUG|globset|crates/globset/src/lib.rs:416: glob converted to regex: Glob { glob: &quot;dist/*&quot;, re: &quot;(?-u)^dist/[^/]*$&quot;, opts: GlobOptions { case_insensitive: false
, literal_separator: true, backslash_escape: true }, tokens: Tokens([Literal(&#x27;d&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;s&#x27;), Literal(&#x27;t&#x27;), Literal(&#x27;/&#x27;), ZeroOrMore]) }\n` +
      `DEBUG|globset|crates/globset/src/lib.rs:416: glob converted to regex: Glob { glob: &quot;node_modules/*&quot;, re: &quot;(?-u)^node_modules/[^/]*$&quot;, opts: GlobOptions { case_in
sensitive: false, literal_separator: true, backslash_escape: true }, tokens: Tokens([Literal(&#x27;n&#x27;), Literal(&#x27;o&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;_&#x27;), Literal(&#x27;m&#x27;),
 Literal(&#x27;o&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;u&#x27;), Literal(&#x27;l&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;s&#x27;), Literal(&#x27;/&#x27;), ZeroOrMore]) }\n` +
      &#x27;DEBUG|globset|crates/globset/src/lib.rs:421: built glob set; 0 literals, 2 basenames, 0 extensions, 0 prefixes, 0 suffixes, 1 required extensions, 4 regexes\n&#x27;
</code></pre>
What is the expected behavior?
<p>What do you think ripgrep should have done?
ripgrep 13 should work just like ripgrep 12 and return a result quickly.</p>
<p><em>&quot;Aye, the haggis is in the fire for sure.&quot; (TOS: &quot;A Taste of Armageddon&quot;)</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2022-06-03 13:31</div>
            <div class="timeline-body"><p>Thanks for the excellent reproduction. This patch fixes the issue for you:</p>
<pre><code>$ git diff
diff --git a/test/rg.js b/test/rg.js
index b799063..5a7f1e1 100644
--- a/test/rg.js
+++ b/test/rg.js
@@ -46,6 +46,7 @@
       //`--threads 1`,      // DOES NOT HELP
       //`--with-filename`,  // DOES NOT HELP
       `-e &#x27;${pattern}&#x27;`,
+      `./`,
     ].join(&#x27; &#x27;);
     var execOpts = {
         cwd,
</code></pre>
<p>Basically, the problem here is likely because Node is attaching something to ripgrep&#x27;s stdin even though there&#x27;s nothing there. Since you didn&#x27;t tell ripgrep to search anything, it has to &quot;auto detect&quot; whether to search the CWD or stdin. Since there&#x27;s something on stdin, that&#x27;s what it chooses. But since Node attaches something to stdin that has no data and is never closed, ripgrep never stops searching it. So this is really a Node problem.</p>
<p>The reason why ripgrep&#x27;s behavior changed here was because it&#x27;s a result of fixing another bug: https://github.com/BurntSushi/ripgrep/commit/020c5453a5880257c87949030550d24c596f5c8d</p>
<p>In any case, <em>many</em> people have reported this exact same bug. The issue with the biggest discussion on this problem is #1892.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2022-06-03 13:31</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/firepick1">@firepick1</a> on 2022-06-03 13:46</div>
            <div class="timeline-body"><p>Thanks, Andrew!</p>
<p>I&#x27;m blown away by how simple that was. Yay rg13!!!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/firepick1">@firepick1</a> on 2022-06-03 13:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:12 UTC
    </footer>
</body>
</html>
