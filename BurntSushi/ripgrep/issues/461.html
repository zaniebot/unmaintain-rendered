<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>feature: preserve first N lines - BurntSushi/ripgrep #461</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>feature: preserve first N lines</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/461">#461</a>
        opened by <a href="https://github.com/eminence">@eminence</a>
        on 2017-04-26 15:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/eminence">@eminence</a></div>
            <div class="timeline-body"><p>This is a new feature request.</p>
<p>Some command line utilities return data in a tabular format, with rows and columns, and often some type of header printed in the first 1 or 2 lines.  For example:</p>
<pre><code>achin@bigbox ~ $ /sbin/zpool iostat -v
               capacity     operations    bandwidth
pool        alloc   free   read  write   read  write
----------  -----  -----  -----  -----  -----  -----
storage     6.05T  7.51T     74     62  2.19M   537K
  raidz1    4.57T   885G     37     22  1.53M   160K
    sdb         -      -     15     14   793K  82.0K
    sdc         -      -     16     14   792K  82.0K
    sdh         -      -     15     14   792K  82.0K
  raidz1    1.48T  6.65T     36     39   680K   377K
    sdg         -      -     14     12   345K   253K
    sdf         -      -     14     12   348K   253K
    sde         -      -     15     12   346K   253K
----------  -----  -----  -----  -----  -----  -----
</code></pre>
<p>Grepping for something within this table is non-ideal because generally the column headers are removed, making it harder to understand the resulting data:</p>
<pre><code>achin@bigbox ~ $ /sbin/zpool iostat -v |rg sdb
    sdb         -      -     15     14   793K  82.0K
</code></pre>
<p>What about a new option that would preserve the first <code>N</code> lines of text.  In this case, I&#x27;d want to preserve the first 2 or 3 lines.   Using this proposed/hypothetical new option, the result might look like:</p>
<pre><code>achin@bigbox ~ $ /sbin/zpool iostat -v |rg --show-first=3 sdb
               capacity     operations    bandwidth
pool        alloc   free   read  write   read  write
----------  -----  -----  -----  -----  -----  -----
    sdb         -      -     15     14   793K  82.0K
</code></pre>
<p>Open questions:</p>
<ul>
<li>What would be the behavior if there were no matches at all?  Should the first <code>N</code> lines of text still be shown?   I think they should not.</li>
<li>What would be the behavior when searching multiple files?  I think:  if a file matches, show the first <code>N</code> lines, and then the match(s).  If there are no matches, print nothing.</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-04-26 15:46</div>
            <div class="timeline-body"><p>I think this is beyond the scope of ripgrep.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eminence">@eminence</a> on 2017-04-26 15:53</div>
            <div class="timeline-body"><p>To advocate very briefly for this feature request, it seems like it&#x27;s not too much of a conceptual addition beyond <code>--context</code> and the other options that make it easier for a user to understand the results of their search.   But I for sure understand that this feature request represents expanded functionality that not at the core of what ripgrep does.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-04-26 16:11</div>
            <div class="timeline-body"><p>This is a perfect example of why &quot;saying No&quot; is literally the hardest thing about maintaining an open source project. I cannot really deny that this <em>particular</em> feature is a small conceptual leap, but adding it makes things that would otherwise be large conceptual leaps become small conceptual leaps. In other words, feature creep.</p>
<p>Consider some of these things:</p>
<ol>
<li>ripgrep has a ton of options already. Even among the people that would benefit from this feature, how many of them will actually be able to learn about it? The more flags we add for niche things like this, the worse this becomes.</li>
<li>&quot;context&quot; is a well defined concept from grep and has decent mindshare. It means, &quot;the lines surrounding a match.&quot; It even has its own delimiter when printed to stdout. Does the output resulting from the <code>--show-first=3</code> flag have its own delimiter? What if it overlaps with context that would be emitted from a match in the fourth line? What is the delimiter then?</li>
<li>With this flag, other flags like <code>--show-last</code> suddenly don&#x27;t seem that far off either. And if this is being applied across multiple files, then some folks are certainly going to want this printed conditionally, perhaps, &quot;<code>--show-first=3</code> if and only if <code>pattern</code> matches in the first 2 lines&quot; or something like that. It sounds a little ridiculous right now, but I think there are actually open feature requests to do just that for the existing context options.</li>
</ol>
<p>Consider a less-than-ideal work-around if you really want this:</p>
<pre><code>$ rg -e operations -e sdb /tmp/461
1:               capacity     operations    bandwidth
6:    sdb         -      -     15     14   793K  82.0K
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eminence">@eminence</a> on 2017-04-26 16:43</div>
            <div class="timeline-body"><p>Yep, as mentioned I for sure understand.</p>
<p>I opened a feature request, you evaluated it, this is exactly how open-source development is supposed to happen, even if it&#x27;s hard :smile:</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/djczaski">@djczaski</a> on 2017-04-26 17:39</div>
            <div class="timeline-body"><p>A little clunky, but you could do something like:</p>
<pre><code>$ ps aux | tee &gt;(head -n1 &gt;&amp;2) | (sleep 0.1;rg rcuos)
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         9  0.1  0.0      0     0 ?        S    Apr22   7:06 [rcuos/0]
root        18  0.0  0.0      0     0 ?        S    Apr22   1:50 [rcuos/1]
root        25  0.0  0.0      0     0 ?        S    Apr22   1:36 [rcuos/2]
root        32  0.0  0.0      0     0 ?        S    Apr22   1:36 [rcuos/3]
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-05-08 21:31</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:04 UTC
    </footer>
</body>
</html>
