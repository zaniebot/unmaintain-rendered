<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Way to report total count of matches? - BurntSushi/ripgrep #411</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Way to report total count of matches?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/411">#411</a>
        opened by <a href="https://github.com/elirnm">@elirnm</a>
        on 2017-03-19 09:29
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/elirnm">@elirnm</a></div>
            <div class="timeline-body"><p>Is there a way to print the total count of matches? I can pipe the output to a line counter, but then I don't get the actual matches printed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-03-19 13:51</div>
            <div class="timeline-body"><p>Have you tried the -c flag? (Which is also in grep.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @BurntSushi on 2017-03-19 13:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/elirnm">@elirnm</a> on 2017-03-20 01:42</div>
            <div class="timeline-body"><p>That prints the number of matches per file (and grep -c seems to do the same). I'm interested in the total number of matches across all files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-03-20 01:55</div>
            <div class="timeline-body"><p>Okay, then I guess i don't understand why piping to wc -l doesn't work?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/elirnm">@elirnm</a> on 2017-03-20 02:00</div>
            <div class="timeline-body"><p>It works fine, I just thought I'd check if there was a built-in option just in case. The only downside to piping is that you don't get the actual matches printed, only the count, but that can be worked around by storing the results in a variable first.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-03-20 02:20</div>
            <div class="timeline-body"><p>I'm still confused. You want <em>both</em> the matches printed and the count? Could you please provide an example so that your request is more clear?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/elirnm">@elirnm</a> on 2017-03-20 02:27</div>
            <div class="timeline-body"><p>What I'm interested in is something like</p>
<pre><code>&gt; rg blah blah --total-count
match
match
match
Total matches: 3
</code></pre>
<p>Basically the current functionality but with the total count printed at the end.</p>
<p>I don't expect support for that because I don't think other tools support it either, and I can get that information by storing the results in a variable first (or by running rg twice) so it's not a big deal. I was just checking to make sure it indeed wasn't supported. Sorry for the confusion.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kale">@kale</a> on 2017-03-29 15:25</div>
            <div class="timeline-body"><p>@elirnm I believe you could just use the <code>tee</code> command?</p>
<pre><code class="language-bash">$ rg blah blah | tee &gt;(wc -l)
match
match
match
    3
</code></pre>
<p>If you want to remove that tab before the output, you can do this:</p>
<pre><code class="language-bash">$ rg blah blah | tee &gt;(wc -l | xargs echo)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/elirnm">@elirnm</a> on 2017-03-30 01:55</div>
            <div class="timeline-body"><p>@kale Not on Windows.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DoumanAsh">@DoumanAsh</a> on 2017-04-02 12:20</div>
            <div class="timeline-body"><p>Powershell ?</p>
<pre><code class="language-powershell">rg blah blah | Measure-Object -Line 
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-04-02 13:02</div>
            <div class="timeline-body"><p>Does that show the matches and the count?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DoumanAsh">@DoumanAsh</a> on 2017-04-02 13:59</div>
            <div class="timeline-body"><p><code>Measure-Object -Line </code> counts number of lines. The same as <code>wc -l</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-04-02 14:03</div>
            <div class="timeline-body"><p>@DoumanAsh Please re-read this thread. The OP is looking for a way to print <em>both</em> the matches and the count of the matches in a single command.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/DoumanAsh">@DoumanAsh</a> on 2017-04-02 15:08</div>
            <div class="timeline-body"><p>Opps, im sorry.
I can think of way to do but it will break colors  and most likely it will not be one liner :(</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-04-09 12:54</div>
            <div class="timeline-body"><p>I'm going to close this. I don't see an option like this being added to ripgrep proper. I think it's too niche and working around it is very simple by piping the output through a line counter.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2017-04-09 12:54</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kaushalmodi">@kaushalmodi</a> on 2017-04-19 15:27</div>
            <div class="timeline-body"><p>I ended up here looking for a way to doing something like <code>--stats</code> that ag does in rg too.</p>
<p>Using <code>ag foo --stats</code> returns the usual matches, <em>plus</em> puts out this at the end which is very useful:</p>
<pre><code>65 matches
26 files contained matches
1539 files searched
75669452 bytes searched
1.044798 seconds
</code></pre>
<p><code>wc -l</code> is not very elegant as I tend to view rg results with file headers enabled.. as follows:</p>
<pre><code>
textmodes/page-ext.el
244:(defcustom pages-directory-buffer-narrowing-p t
249:(defcustom pages-directory-for-adding-page-narrowing-p t
254:(defcustom pages-directory-for-adding-new-page-before-current-page-p t
268:(defcustom pages-directory-for-addresses-goto-narrowing-p t
273:(defcustom pages-directory-for-addresses-buffer-keep-windows-p t
278:(defcustom pages-directory-for-adding-addresses-narrowing-p t

textmodes/ispell.el
141:(defcustom ispell-highlight-p 'block
285:(defcustom ispell-look-p (file-exists-p ispell-look-command)
301:(defcustom ispell-use-ptys-p nil
337:(defcustom ispell-use-framepop-p nil
</code></pre>
<p>Can you please re-open this issue, and consider adding a <code>--stats</code>-like switch?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-04-19 15:31</div>
            <div class="timeline-body"><blockquote>
<p>wc -l is not very elegant as I tend to view rg results with file headers enabled.. as follows:</p>
</blockquote>
<p>Did you actually try it though? If you pipe the output of ripgrep into another command, then it should revert to the standard output format of <code>grep</code> (unless you pass the <code>--heading</code> flag explicity).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kaushalmodi">@kaushalmodi</a> on 2017-04-19 15:37</div>
            <div class="timeline-body"><p>The situation is like <em>I want to eat the cake</em> (show results with headings) <em>and have it too</em> (show the match statistics too).</p>
<p><img src="https://cloud.githubusercontent.com/assets/3578197/25188517/56516a50-24f4-11e7-9a48-cdab352c6c27.png" alt="image" /></p>
<p>With <code>rg</code> and <code>wc -l</code>, I get just:</p>
<p><img src="https://cloud.githubusercontent.com/assets/3578197/25188551/76160c42-24f4-11e7-9142-3e0b033e95d5.png" alt="image" /></p>
<p>So I would need to run once to see the result and run second time to get the match count. But that is not as informative as the <code>--stats</code> in ag I show above.. I do not get how many files matched.</p>
<hr />
<p><em>It's a different thing to investigate why the total matches are not the same when searched using ag vs rg.</em></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-04-19 15:42</div>
            <div class="timeline-body"><blockquote>
<p>The situation is like I want to eat the cake (show results with headings) and have it too (show the match statistics too).</p>
</blockquote>
<p>At what point does ripgrep have to solve every problem associated with displaying stats? It <em>should</em> be very simple for anyone to write a wrapper script that does what you want here, although the easiest path would run <code>rg</code> multiple times, which seems fine for most use cases IMO.</p>
<p>I will re-open this for now, but at a certain point, I have to be allowed to say &quot;No&quot; to new feature requests and people have to respect that reasonable people can disagree where that line is drawn.</p>
<blockquote>
<p>It's a different thing to investigate why the total matches are not the same when searched using ag vs rg.</p>
</blockquote>
<p>The silver searcher has a very very large number of bugs associated with its gitignore support. It's more surprising when the total number of results are the same.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @BurntSushi on 2017-04-19 15:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kaushalmodi">@kaushalmodi</a> on 2017-04-19 15:54</div>
            <div class="timeline-body"><p>I don't want my suggestion to rub you the wrong way. It was as I said.. just a suggestion.</p>
<p>¬†¬†¬†¬†¬†¬†¬†¬†I fully respect your project.</p>
<p>So if it's your decision to never support this, I will respect that.</p>
<p>This request came up when I had to find the total number of matches during a <a href="http://lists.gnu.org/archive/html/emacs-devel/2017-04/msg00553.html">discussion</a>, and that's where I realized that I needed to switch to ag for that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-05-08 22:27</div>
            <div class="timeline-body"><p>I think I've come around to this feature. Starting with what the silver searcher does seems reasonable:</p>
<pre><code>$ ag PM_RESUME
# results omitted
16 matches
9 files contained matches
55263 files searched
643515649 bytes searched
0.453583 seconds
</code></pre>
<p>I do have a question though: should stats be printed to stdout or to stderr? ag prints them to stdout. I think I'm fine either way, and probably lean slightly towards stdout.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by @BurntSushi on 2017-05-08 22:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-05-08 22:29</div>
            <div class="timeline-body"><p>An argument in favor of stderr is that you can do this: <code>rg foo --stats &gt; /dev/null</code> and see the statistics without worrying about a bunch of output being printed to your terminal.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kaushalmodi">@kaushalmodi</a> on 2017-05-08 22:32</div>
            <div class="timeline-body"><p>Wouldn't printing <code>--stats</code> throw off a lot of wrapper scripts?</p>
<p>I would favor STDOUT as that stats are not errors technically.</p>
<blockquote>
<p>without worrying about a bunch of output being printed to your terminal.</p>
</blockquote>
<p>In that case, may be a different switch be added to not output the matched lines at all? Probably <code>--stats=only</code> prints only the stats?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-05-08 22:55</div>
            <div class="timeline-body"><blockquote>
<p>Wouldn't printing --stats throw off a lot of wrapper scripts?</p>
</blockquote>
<p>I'm not sure I follow. If you don't want to throw off wrapper scripts, then don't use <code>--stats</code>? How else do you expect this to be implemented?</p>
<blockquote>
<p>In that case, may be a different switch be added to not output the matched lines at all? Probably --stats=only prints only the stats?</p>
</blockquote>
<p>I try to prefer composition of existing tools.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kaushalmodi">@kaushalmodi</a> on 2017-05-08 23:34</div>
            <div class="timeline-body"><blockquote>
<p>If you don't want to throw off wrapper scripts, then don't use --stats?</p>
</blockquote>
<p>I don't have such a wrapper script.. but in case one is doing</p>
<pre><code class="language-sh">set -euo pipefail # http://redsymbol.net/articles/unofficial-bash-strict-mode
foo_match_count=$(rg foo --stats | grep -Po '\d+(?=\s+matches)')
</code></pre>
<p>The script will fail even where the match is positive.</p>
<p>The STDERR output can cause confusion here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-05-08 23:54</div>
            <div class="timeline-body"><p>But in that case, the problem is immediately obvious because the stats will be dropped to stderr. And then it's easy to fix.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/elirnm">@elirnm</a> on 2017-05-09 02:37</div>
            <div class="timeline-body"><p>I'd prefer stdout because if stats are part of stderr there's no easy way to separate the stuff related to results from the stuff related to actual errors while keeping the stats with the rest of the results-related stuff.</p>
<p>If stats are printed to stderr, then <code>rg blah --stats &gt; some_file.txt</code> will still print stats to the console rather than the file, but <code>rg blah --stats &gt; some_file.txt 2&gt; some_file.txt</code> will print actual errors to the file rather than the console. So there's not an easy way to get stats and results in a file but errors to the console.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-05-09 11:01</div>
            <div class="timeline-body"><p>All right, let's do stdout.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/santagada">@santagada</a> on 2017-07-25 12:15</div>
            <div class="timeline-body"><p>I don't know if it is the correct place to ask for it, but could we have a way to print how many matches per file? I'm searching binary files so I care about matches and not lines... showing both is perfectly fine, just -c doesn't give me any meaninfull number.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-07-25 12:19</div>
            <div class="timeline-body"><p>@santagada That seems like an orthogonal issue to what this is. Could you please open a new issue? Please also explain why you think <code>-c/--count</code> doesn't give you any meaningful number. It seems meaningful to me. In fact, it seems like it does <em>exactly</em> what you want: it shows the number of matches in each file:</p>
<pre><code>$ rg -c foo
README.md:12
CHANGELOG.md:10
globset/README.md:7
tests/tests.rs:186
src/args.rs:1
src/printer.rs:4
src/app.rs:4
doc/rg.1:6
doc/rg.1.md:6
globset/src/pathutil.rs:8
globset/src/glob.rs:59
globset/src/lib.rs:16
grep/src/literals.rs:1
ignore/src/gitignore.rs:33
ignore/src/dir.rs:26
ignore/src/types.rs:18
ignore/src/overrides.rs:28
ignore/src/walk.rs:27
grep/src/data/sherlock.txt:45
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/santagada">@santagada</a> on 2017-07-27 09:37</div>
            <div class="timeline-body"><p>your example shows it, README.md has 17 occurrences of foo (on at least one line it shows 3 times). what -c is showing is how many lines matched the regex (or maybe we searched very different versions of the README.md). I will open a new issue</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/santagada">@santagada</a> on 2017-07-27 09:44</div>
            <div class="timeline-body"><p>filed a ticket for it in #566</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/balajisivaraman">@balajisivaraman</a> on 2018-02-01 16:13</div>
            <div class="timeline-body"><p>I can pick this one up next if we still want this implemented. I don't see any other PRs open for this, and it looks pretty straightforward from a specification standpoint (duplicate what <code>ag</code> does) and could be very interesting for me to work on. üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kaushalmodi">@kaushalmodi</a> on 2018-02-01 16:15</div>
            <div class="timeline-body"><p>@balajisivaraman I'd be very grateful, thank you! This is one of the two things why I need to keep <code>ag</code> installed on my system :)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-02-01 16:22</div>
            <div class="timeline-body"><p>@balajisivaraman Thanks! Let me know if you want any help coming up with how to organize this in the code. It is likely that familiarizing yourself with <a href="https://doc.rust-lang.org/std/sync/atomic/">Rust's support for atomics</a> will be helpful. As another caveat, I would like to prevent the two search modules (<code>search_stream.rs</code> and <code>search_buffer.rs</code>) from modifying any kind of shared mutable state because that will hurt later refactoring. Instead, the searchers likely need to return the stats for a particular file somehow, and then the worker should merge them with stats that it already has. And of course, this all needs to be conditional on whether a <code>--stats</code> flag is passed. We shouldn't be counting things unless told to. :-)</p>
<p>Here are some possible simplifications that you may elect to choose to do:</p>
<ul>
<li>If <code>--stats</code> is passed, then force ripgrep into single threaded mode. Then you could focus on just the single threaded worker, which might be easier. We can enable parallelism later.</li>
<li>If <code>--stats</code> is passed, do not permit memory map searching. This would let you implement stat tracking in only the <code>src/search_stream.rs</code> searcher. (It would be nicer to only do memory maps since it would be considerably simpler, but memory maps can't handle every type of search.)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/balajisivaraman">@balajisivaraman</a> on 2018-02-01 16:47</div>
            <div class="timeline-body"><p>@BurntSushi, Thanks for the pointers. I'll have an initial look this weekend and come up with a rough idea of how I want to go about it, and I'll post it here for vetting. üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-02-01 17:00</div>
            <div class="timeline-body"><p>@balajisivaraman Aye. Another idea that I might like even better is seeing if this could be done in the printer instead of the search code. That way it would work for both searchers.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/balajisivaraman">@balajisivaraman</a> on 2018-02-03 16:00</div>
            <div class="timeline-body"><p>@BurntSushi, I get the feeling we should be able to easily do this in <code>main.rs</code> itself, bypassing both the <code>searchers</code> and the <code>printer</code>, with one caveat which I get into below. (I apologise in advance if this post is a bit long and too detailed.)</p>
<p>Here's my reasoning as to why:</p>
<ul>
<li><strong>Files Searched</strong>: We already track the total number of paths searched in <code>main.rs</code> in both <code>run_one_thread</code> and <code>run_parallel</code> for outputting debug messages at the end. So we get that for free already.</li>
<li><strong>Match Count</strong>: We also already count the overall <code>match_count</code> in both the aforementioned functions since that is the value to be returned; so we also get that for free.</li>
<li><strong>Files With Matches</strong>: It should be trivial to track the files with matches if necessary by having a new counter and updating that if <code>count</code> from the current path is greater than 0.</li>
<li><strong>Time Taken</strong>: The time taken should be trivial to implement in <code>main.rs</code> as a difference between when search starts (entry into <code>run_parallel</code> or <code>run_one_thread</code>) and ends (exit from <code>run_parallel</code> or <code>run_one_thread</code>).</li>
</ul>
<p>My thought is that we should be able to do all of the above in <code>main.rs</code> without any impact on performance or current code structure. And since these are overall stats to be tracked about the current run of <code>rg</code>, it does make sense to do this in <code>main.rs</code> instead of the <code>searchers</code>, which are tracking stats for individual files.</p>
<p>The trickiest part will be tracking <strong>bytes searched</strong>. I haven't been able to come up with an easy way to do this that doesn't involve making changes to <code>search_stream.rs</code> and <code>search_buffer.rs</code>. These are the two files where the actual searching happens. From what I can see, those are the places where the input <code>Reader</code> is actually loaded into buffers and searched. So that will be the place to change if we actually want to track the overall number of bytes that were searched across individual files.</p>
<p>My current thought is that we could do two things about it:</p>
<ul>
<li>Not implement the <code>bytes searched</code> feature. The easier option. :-)</li>
<li>Make the <code>search_stream.run</code> and <code>search_buffer.run</code> return the <code>match_count</code> and an optional <code>bytes_searched</code> (will be None if <code>--stats</code> is not passed), preferably combined together in a Struct of some sort (<code>SearchStats</code> or <code>FileStats</code> or something). This way we can combine them together in <code>main.rs</code> like we do with the other stats and output it.</li>
</ul>
<p>Also, as you suggested, I had a look at seeing whether we could offload some of this to the <code>printer</code>, but I had difficulty doing it. This is because all the stats we want to output are only available in the searchers or the <code>main.rs</code> file. The best I could come up with was to have a <code>Stats</code> struct (containing atomic values for match count, files with matches and overall files) wrapped in an <code>Arc</code> as the state in <code>printer.rs</code>. This state is then updated by <code>search_stream.rs</code> by passing in the relevant values and doing atomic updates.</p>
<p>This is bad because there's shared mutable state going on. Another pain point is that we create a new <code>printer</code> for every file that is searched whereas the stats to be output are more global in nature. (This could work if we only did single threaded search.) Currently what I feel would be the ideal option is to return the stats we want as values from the searchers and combine them in <code>main.rs</code>, like we do already with the match count.</p>
<p>I also found the following quirks in <code>ag</code> that we should take a call about:</p>
<ul>
<li><p>If I cat a file and pipe it to <code>ag</code>, I get the following output. Now this is very confusing because it shows <code>17 files searched</code> when I use Stdin. We could still display other stats for Stdin, but it seems to me that the wiser option would be to negate <code>--stats</code> when we're in Stdin. Thoughts?</p>
<pre><code>balaji@hogsmeade $ cat .xmobarrc | ag --stats 'temp'
    , template          = &quot; %StdinReader% }{ %net%   %date% &quot;
1 matches
1 files contained matches
17 files searched
764 bytes searched
0.000041 seconds
</code></pre>
<p>As a result of this, should <code>rg</code> simply ignore <code>stats</code> for Stdin?</p>
</li>
<li><p>If I do <code>ag --files-without-matches 'bufwtr' .</code>, it behaves as if <code>--invert-match</code> was passed in. What that means is that the match count and matching file count displayed in the stats are inverted. But this feels weird to me because the argument asks to print only the files without matches, not to actually invert the match in the stats. Should <code>rg</code> just ignore <code>stats</code> if <code>-l</code> or <code>--files-without-matches</code> is passed in?</p>
</li>
</ul>
<p>I'll have another look to see whether there would be any other way of doing this, but that's what I came up after going through the code today.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-02-03 16:41</div>
            <div class="timeline-body"><p>@balajisivaraman Thanks for writing that up! The task of counting bytes is definitely an interesting one and I grant that it does appear to be a little tricky to do with the current code. My feeling is that the &quot;best&quot; way to do this would be as a new type that implements <code>io::Read</code>. The implementation would wrap another <code>io::Read</code> type and basically passthrough all calls unmodified, but would count the number of bytes read. I've done this in various ways before and it's pretty simple. Here's an example for a writer: https://github.com/BurntSushi/fst/blob/9a144a1c99605a210609147aaa8b09cf2776efd9/src/raw/counting_writer.rs --- You would probably want to construct this type in the worker and pass a mutable reference to the buffered searcher. Once the searcher is done, you can ask the type for the count of bytes read. For memory maps, you'll need to devise a different strategy, but we could skip that for now.</p>
<p>But yeah, we can <em>definitely</em> punt on the byte counting for now and do that at a later time. With that said, it is definitely a useful part of the stats output because it's what will let you compute a thoughput statistic (which I suppose we should also include once we do byte counting).</p>
<blockquote>
<p>If I cat a file and pipe it to ag, I get the following output. Now this is very confusing because it shows 17 files searched when I use Stdin. We could still display other stats for Stdin, but it seems to me that the wiser option would be to negate --stats when we're in Stdin. Thoughts?</p>
</blockquote>
<p>ag has a lot of bugs. I think ripgrep can probably get stats right for stdin without claiming that it searched 17 other files. :-)</p>
<blockquote>
<p>If I do ag --files-without-matches 'bufwtr' ., it behaves as if --invert-match was passed in. What that means is that the match count and matching file count displayed in the stats are inverted. But this feels weird to me because the argument asks to print only the files without matches, not to actually invert the match in the stats. Should rg just ignore stats if -l or --files-without-matches is passed in?</p>
</blockquote>
<p>You're on to something here. I think it would be fine to ignore <code>--stats</code> if <code>--files-with-matches</code> or <code>--files-without-match</code> were given.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/balajisivaraman">@balajisivaraman</a> on 2018-02-03 16:53</div>
            <div class="timeline-body"><p>@BurntSushi, Ah that's a nifty little trick. Thanks for pointing that out. I'll see whether I'd be able to cook up something similar for counting bytes here.</p>
<p>If you're OK with the rest of the suggestions in terms of tracking the existing stats and outputting them in <code>main.rs</code>, I can go ahead and begin working on the changes.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-02-03 16:59</div>
            <div class="timeline-body"><p>@balajisivaraman Oh right, I forgot to respond to that part! Yes, doing those counts in <code>main.rs</code> is great.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/balajisivaraman">@balajisivaraman</a> on 2018-02-14 18:46</div>
            <div class="timeline-body"><p>@BurntSushi, I just realised that there are some similarities between this and #566.</p>
<p>Although I have a WIP PR (#799) open for this, I realised that the <code>match_count</code> that is displayed in the current implementation is a line count instead of the actual occurrence count. As reported in the aforementioned issue, we probably want a way to keep track of the occurrence count, which I completely overlooked in my original post above. Apologies for that. üòû</p>
<p>I'll leave the pending PR open and look at ways I can work on the occurrence count issue. We should then be able to reuse that for computing stats, if that is fine.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2018-03-10 16:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adikwok">@adikwok</a> on 2018-09-20 07:28</div>
            <div class="timeline-body"><p>how to rg -c top 10 most words from a disk?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/sarendipitee">@sarendipitee</a> on 2018-09-29 06:29</div>
            <div class="timeline-body"><p>Sorry for necro'ing this thread, but just wanted to say I really appreciate the work and effort in this feature! <code>rg</code> is one of my most used and favorite tools and I was super happy to find this functionality today without having to resort to some <code>cut -d: -f2 | awk</code> trickery!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ElectricRCAircraftGuy">@ElectricRCAircraftGuy</a> on 2022-01-03 19:25</div>
            <div class="timeline-body"><h2>Count the total number of matches in ripgrep</h2>
<p>For anyone still stumbling upon this thread, the <code>--stats</code> option is now present in Ripgrep (it looks like it was added as a result of this thread), so just do <code>rg --stats 'my regex search'</code>. Done. :)</p>
<p>Example output: the line you're looking for is the one where I put <code>&lt;===</code>:</p>
<pre><code>...
[all of the match content up here]
...

156 matches          &lt;===
156 matched lines
86 files contained matches
2954 files searched
18355 bytes printed
35266829 bytes searched
0.014166 seconds spent searching
0.012024 seconds
</code></pre>
<p>If you just want just that one line, do this:</p>
<pre><code class="language-bash">rg --stats &quot;my search term&quot; | tail -n 8 | head -n 1
</code></pre>
<p>Example output:</p>
<pre><code>156 matches
</code></pre>
<p>If you just want the <code>156</code>, do this:</p>
<pre><code class="language-bash">rg --stats &quot;my search term&quot; | tail -n 8 | head -n 1 | awk '{print $1}'
</code></pre>
<p>Output:</p>
<pre><code>156
</code></pre>
<h3>Alternative hack</h3>
<p><a href="https://github.com/BurntSushi/ripgrep/issues/411#issuecomment-1024273085">As @clashman says below</a>, you can also do this hack:</p>
<pre><code class="language-bash">rg &quot;my search term&quot; | rg -c &quot;my search term&quot;
</code></pre>
<p>Sample output:</p>
<pre><code>156
</code></pre>
<h2>If you need this to run in Windows</h2>
<p>...Use the Git Bash terminal which comes with Git for Windows. See my instructions here: <a href="https://github.com/ElectricRCAircraftGuy/eRCaGuy_dotfiles/issues/27#issue-1950880578">Installing Git For Windows</a>.</p>
<p>For building software in Windows, or running the GCC or LLVM Clang compilers from the command-line, and to get other Linux tools in Windows, use the MSYS2 terminals. See my MSYS2 setup answer here: <a href="https://stackoverflow.com/a/77407282/4561887">Installing &amp; setting up MSYS2 from scratch, including adding all 7 profiles to Windows Terminal</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/clashman">@clashman</a> on 2022-01-28 14:24</div>
            <div class="timeline-body"><p>A simpler, albeit dirty solution: <code>rg FOO | rg FOO -c</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Amiralgaby">@Amiralgaby</a> on 2023-03-06 19:44</div>
            <div class="timeline-body"><p>For me the best answers is actually
<code>rg --stats &quot;&lt;regex&gt;&quot; -q | rg -e &quot;\d+ matches&quot; | cut -d&quot; &quot; -f1</code></p>
<p>for what I needed I've not the same result
The command above is better I think instead of &quot;<code>rg FOO | rg FOO -c</code>&quot;. I have not the same result between my command and yours so I trust the --stats flag and the &quot;matches&quot; result ^^</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/taariksiers">@taariksiers</a> on 2023-09-27 12:24</div>
            <div class="timeline-body"><p>what works for me</p>
<pre><code class="language-bash">rg [search term] -l | wc -l
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2023-09-27 13:18</div>
            <div class="timeline-body"><p>@taariksiers That will only report the total number of files that contain a match. The <code>-l/--files-with-matches</code> just prints one line per file path that contains at least one match of <code>[search term]</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/TeaDrinkingProgrammer">@TeaDrinkingProgrammer</a> on 2024-01-30 10:31</div>
            <div class="timeline-body"><p>Because I use Windows, I have turned to a small python script (written by ChatGPT):</p>
<pre><code class="language-python">import subprocess

# Run the command and capture the output
command = &quot;rg -c foo&quot;
output = subprocess.run(command, capture_output=True, text=True).stdout.strip()

# Extract the last number from each line and sum them up
total_count = sum(int(line.split(&quot;:&quot;)[-1].strip()) for line in output.split(&quot;\n&quot;))

# Output the modified output and the total count
print(output)
print(f&quot;Total Count: {total_count}&quot;)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ElectricRCAircraftGuy">@ElectricRCAircraftGuy</a> on 2024-01-30 16:22</div>
            <div class="timeline-body"><p>@TeaDrinkingProgrammer , FYI: all of the Bash/terminal solutions above work on Windows too. You just have to use the Git Bash Linux-like terminal that comes with <a href="https://gitforwindows.org/">Git for Windows</a>, is all. You can also use the MSYS2 terminal.</p>
<p>Here are my installation instructions for those terminals in Windows:</p>
<ol>
<li><a href="https://github.com/ElectricRCAircraftGuy/eRCaGuy_dotfiles/issues/27#issue-1950880578">Installing Git for Windows</a></li>
<li><a href="https://stackoverflow.com/a/77407282/4561887">Stack Overflow: Installing &amp; setting up MSYS2 from scratch, including adding all 7 profiles to Windows Terminal</a></li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ltrzesniewski">@ltrzesniewski</a> on 2024-01-30 16:26</div>
            <div class="timeline-body"><p>You can also use WSL:</p>
<pre><code class="language-bash">rg foo | wsl wc -l
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/drygdryg">@drygdryg</a> on 2024-02-28 13:13</div>
            <div class="timeline-body"><pre><code>rg -c 'my search term ' | awk -F: '{s+=$2} END {print s}'
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/adikwok">@adikwok</a> on 2024-02-28 14:11</div>
            <div class="timeline-body"><p>thank you, sirOn Feb 28, 2024 8:13 PM, Victor Golovanenko <em><strong>@</strong></em>.***&gt; wrote:
rg -c 'my search term' | cut -d: -f2 | awk '{s+=$1} END {print s}'</p>
<p>‚ÄîReply to this email directly, view it on GitHub, or unsubscribe.You are receiving this because you commented.Message ID: <em><strong>@</strong></em>.***&gt;</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:42:07 UTC
    </footer>
</body>
</html>
