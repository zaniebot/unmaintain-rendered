<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add switch to pay attention to .gitignore files when not in a git repo - BurntSushi/ripgrep #1414</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add switch to pay attention to .gitignore files when not in a git repo</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1414">#1414</a>
        opened by <a href="https://github.com/JohnC32">@JohnC32</a>
        on 2019-10-29 20:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/JohnC32">@JohnC32</a></div>
            <div class="timeline-body"><p>Could you add a switch e.g. --force-gitignore which would force usage of .gitignore files even when there&#x27;s no .git directory?</p>
<p>Give a large repo, it&#x27;s often convenient to archive versions of it and not save the .git directory. Currently ripgrep 11.0.2 does not pay attention to .gitignore files if there&#x27;s no .git directory. This makes it impossible to use rg on such repo&#x27;s. Another use case is when using Perforce. Perforce pays attention to .gitignore files and does not have a .git directory. A work around is to create an empty .git directory, but in our environment this causes problems because git based tools fail when there&#x27;s an empty .git directory.</p>
<p>Thanks for ripgrep - it&#x27;s really powerful!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-10-29 21:03</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-10-29 21:06</div>
            <div class="timeline-body"><p>What about adding an empty <em>file</em> called <code>.git</code> instead?</p>
<p>You could also symlink <code>.gitignore</code> to <code>.ignore</code>.</p>
<p>I&#x27;m really not too inclined to add even more flags specifically for changing when <code>.gitignore</code> is interpreted.</p>
<blockquote>
<p>Another use case is when using Perforce. Perforce pays attention to .gitignore files and does not have a .git directory.</p>
</blockquote>
<p>What is the standard way to detect a Perforce repo? If Perforce specifically recognizes gitignore files, then we could add the Perforce check in addition to the <code>.git</code> check. Although, this will likely have unacceptable performance overhead.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JohnC32">@JohnC32</a> on 2019-10-29 21:17</div>
            <div class="timeline-body"><p>An empty .git directory or empty .git file does cause git based tools to fail. Both external tools and internal tools. For example, &quot;touch .git; git status&quot; yields &quot;fatal: Invalid gitfile format: .git&quot;.</p>
<p>In Perforce, you set in their config P4IGNORE to .gitignore. You can also place P4IGNORE in the environment. Thus, detecting a Perforce repo is going to require something else. You could look for the existence of a .perforce file, but even this isn&#x27;t required.</p>
<p>We have a large repo with many hundreds of .gitignore files and developed on multiple platforms. Symlink&#x27;ing won&#x27;t work because of Windows. Adding rules to generate .ignore from .gitignore files is challenging because of the variety of different build systems we use.</p>
<p>I assume you do the .git check once, could you update it check for another file, e.g. .ripgrep-force-gitignore?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JohnC32">@JohnC32</a> on 2019-10-29 21:25</div>
            <div class="timeline-body"><p>Out of curiosity, why does ripgrep require a .git directory to pay attention to the .gitignore files? In a quick scan of the code and doc, I couldn&#x27;t find a reason.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-10-29 21:29</div>
            <div class="timeline-body"><p>See <a href="https://github.com/BurntSushi/ripgrep/issues/934">BurntSushi/ripgrep#934</a> and https://github.com/BurntSushi/ripgrep/commit/e65ca21a6cebceb9ba79fcd164da24478cc01fb0</p>
<p>I guess it seems like there isn&#x27;t much of a choice here other than to add a flag. It&#x27;s just pretty unfortunate and I&#x27;d really rather that ripgrep not grow an unbounded number of flags for every weird case. In this case, it really seems like <code>.gitignore</code> is being misused. But if this can be implemented without much complexity, then I&#x27;d be willing to accept a PR.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-10-29 21:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">help wanted</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-10-29 21:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/JohnC32">@JohnC32</a> on 2019-10-29 21:40</div>
            <div class="timeline-body"><p>Thanks - I will look into adding a switch and create a PR assuming it can be done cleanly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/akarle">@akarle</a> on 2019-10-30 18:39</div>
            <div class="timeline-body"><p>Hi @BurntSushi,</p>
<p>Firstly, thank you for ripgrep! It&#x27;s an awesome tool and I&#x27;m a long time fan/user.</p>
<p>I&#x27;m working with @JohnC32 on an implementation of this.</p>
<p>It was pretty trivial to add a switch to force reading gitignores outside a git repo (basically just an option for the Ignore class).</p>
<p>However, I stumbled across a cleaner (IMHO) way of doing it.</p>
<p>I noticed you have a &quot;custom ignore&quot; functionality baked in, which, if I understand correctly, is being used to read patterns from <code>.rgignore</code> files. As far as I can tell, there is no switch that lets the user create new custom ignores.</p>
<p>Would you be open to adding a switch which allows arbitrary files to be read as ignores (basically just passing them to <code>add_custom_ignore_filename</code>)? I believe this is slightly cleaner while still resolving our use case (we can run with <code>--ignore-file-name .gitignore</code> which will add <code>.gitignore</code> as a custom ignore name, causing it to work outside of a git repository).</p>
<p>Thank you for your time and help! I have a prototype of the <code>--ignore-file-name</code> switch, but wanted to reach out to see which solution you thought was cleaner before putting up the PR.</p>
<p>Thanks,
Alex</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-10-30 19:45</div>
            <div class="timeline-body"><p>@akarle That is an interesting approach, but it&#x27;s not quite the same. In particular, <code>.gitignore</code> has <em>lower</em> precedence that <code>.ignore</code> (and <code>.rgignore</code>). This is very much intentional, since it permits users to override <code>.gitignore</code> patterns with new patterns in <code>.ignore</code>. However, <code>add_custom_ignore_filename</code> specifically processes those files with the highest possible precedence, such that patterns in <code>.ignore</code> would no longer override it. This would be very confusing for users who would otherwise expect <code>.ignore</code> to override <code>.gitignore</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/akarle">@akarle</a> on 2019-10-30 20:11</div>
            <div class="timeline-body"><p>@BurntSushi thank you for the fast response and for the clarification!</p>
<p>Hmm I was aware that it was a higher priority, but hadn&#x27;t considered the impact of not allowing <code>.ignore</code> to override <code>.gitignore</code>.</p>
<p>I had originally assumed that <code>.ignore</code> was for a different SCM system (maybe CVS), but I now see that appears to be without merit. Under this assumption, I hadn&#x27;t considered users of <code>.gitignore</code>s to also be using <code>.ignore</code>.</p>
<p>I now see that <code>.ignore</code> is a specific file used for search tools exclusively (rather than SCM systems). This makes much more sense, and I can see why we wouldn&#x27;t want to override them with <code>--ignore-file-name .gitignore</code>.</p>
<p>I&#x27;ll look back into the original &quot;pay attention to .gitignore files outside git repos&quot; switch :)</p>
<p>Thanks again,
Alex</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-02-17 22:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Freed-Wu">@Freed-Wu</a> on 2022-05-15 03:42</div>
            <div class="timeline-body"><p>I try to compile rg and found it will test failure in no_require_git. Is it related to <code>--no-require-git</code>? Did I do something wrong?</p>
<pre><code>failures:

---- feature::f1414_no_require_git stdout ----
thread &#x27;main&#x27; panicked at &#x27;
printed outputs differ!

expected:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
bar
foo

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

got:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
bar

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
&#x27;, tests\feature.rs:738:5
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace


failures:
    feature::f1414_no_require_git

test result: FAILED. 263 passed; 1 failed; 0 ignored; 0 measured; 0 filtered out; finished in 27.38s
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Freed-Wu">@Freed-Wu</a> on 2022-05-15 03:48</div>
            <div class="timeline-body"><p>And Although I have installed <code>asciidoctor</code>, the <code>rg.1</code> still cannot be generated in OUT_DIR. What is the probable cause?</p>
<p><a href="https://github.com/msys2/MINGW-packages/issues/11657">msys2/MINGW-packages#11657</a></p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:09 UTC
    </footer>
</body>
</html>
