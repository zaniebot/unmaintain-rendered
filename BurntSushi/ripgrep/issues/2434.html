<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>too much output when `rg` command is passed to `echo` - BurntSushi/ripgrep #2434</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>too much output when <code>rg</code> command is passed to <code>echo</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2434">#2434</a>
        opened by <a href="https://github.com/lyrixx">@lyrixx</a>
        on 2023-02-28 16:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lyrixx">@lyrixx</a></div>
            <div class="timeline-body"><h4>What version of ripgrep are you using?</h4>
<pre><code>rg --version
ripgrep 13.0.0
-SIMD -AVX (compiled)
+SIMD +AVX (runtime)
</code></pre>
<h4>How did you install ripgrep?</h4>
<p>with cargo</p>
<h4>What operating system are you using ripgrep on?</h4>
<pre><code>Distributor ID: Ubuntu
Description:    Ubuntu 22.04.2 LTS
Release:        22.04
Codename:       jammy
</code></pre>
<h4>Describe your bug.</h4>
<p>RG return the list of the file, instead of what it matches in the document</p>
<h4>What are the steps to reproduce the behavior?</h4>
<p>Use the following code to reproduce:</p>
<pre><code>mkdir ripgrep
cd ripgrep

touch a b c d e
cat &gt; CHANGELOG.md &lt;&lt;'EOF'
CHANGELOG
=========

6.3
---

 * foo bar baz

6.2
---

 * something else

EOF
</code></pre>
<p>I have a more complex regex, but I have simplified it to show the bug</p>
<p>Not in a sub-shell, no trailing space ✅</p>
<pre><code>rg '6.3\n---\n\n' -U --multiline-dotall  CHANGELOG.md 
4:6.3
5:---
6:
</code></pre>
<p>Not in a sub-shell, with trailing space ✅</p>
<pre><code>&gt;/tmp/foobar/ripgrep rg '6.3\n---\n\n ' -U --multiline-dotall  CHANGELOG.md 
4:6.3
5:---
6:
7: * foo bar baz
</code></pre>
<p>In a subshell, no trailing space ✅</p>
<pre><code>echo `rg '6.3\n---\n\n' -U --multiline-dotall  CHANGELOG.md` 
6.3 ---
</code></pre>
<p>In a subshell, with trailing space ❌</p>
<pre><code>                                          #⬇ There is a trailing space here
&gt;/tmp/foobar/ripgrep echo `rg '6.3\n---\n\n ' -U --multiline-dotall  CHANGELOG.md` 
6.3 --- a b c CHANGELOG.md d e foo bar baz
</code></pre>
<hr />
<p>As you can see, there is something super strange. As soon as I put a trailing space, rg print in the middle of the output the files in the current directly!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lyrixx">@lyrixx</a> on 2023-02-28 16:12</div>
            <div class="timeline-body"><p>Ohhhh. Just understood the bug ! Sorry for the noise !</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @lyrixx on 2023-02-28 16:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2023-02-28 16:34</div>
            <div class="timeline-body"><p>If you fix your own problem, it is good practice to include the answer so that if others have the same problem, it will be more helpful. In this case, I actually get different output than you for the last example:</p>
<pre><code>$ echo `rg '6.3\n---\n\n ' -U --multiline-dotall  CHANGELOG.md`
6.3 --- * foo bar baz
</code></pre>
<p>Which looks correct to me. That trailing space matches something on the next line, and thus ripgrep prints the whole thing.</p>
<p>I don't think this has anything with running ripgrep as a sub-process. The output is just a little weird because you're passing it to <code>echo</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Issue when run in a subprocess" to "too much output when `rg` command is passed to `echo`" by @BurntSushi on 2023-02-28 16:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lyrixx">@lyrixx</a> on 2023-02-28 16:57</div>
            <div class="timeline-body"><p>Sorry for not putting my answer here :(</p>
<p>the problem was indeed about echoing something that containes <code>*</code> and so it globs...</p>
<p>I fixed the issue by surrounding it with <code>&quot;</code>:</p>
<pre><code>&gt;/tmp/foobar/ripgrep echo `rg '6.3\n---\n\n ' -U --multiline-dotall  CHANGELOG.md` 
6.3 --- a b c CHANGELOG.md d e foo bar baz
&gt;/tmp/foobar/ripgrep echo &quot;`rg '6.3\n---\n\n ' -U --multiline-dotall  CHANGELOG.md`&quot;
6.3
---

 * foo bar baz
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:43:37 UTC
    </footer>
</body>
</html>
