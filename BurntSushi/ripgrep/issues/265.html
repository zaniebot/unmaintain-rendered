<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>detect simd and avx features during runtime? - BurntSushi/ripgrep #265</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>detect simd and avx features during runtime?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/265">#265</a>
        opened by <a href="https://github.com/vladon">@vladon</a>
        on 2016-12-02 18:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/vladon">@vladon</a></div>
            <div class="timeline-body"><p>I'm building deb package (for myself) of ripgrep, and want to distribute it to machines with and without SIMD and AVX.</p>
<p>Is it possible that ripgrep will detect SIMD and AVX features at runtime and use or not use them accordingly?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2016-12-02 23:29</div>
            <div class="timeline-body"><p>Nope. Two reasons:</p>
<ol>
<li>Firstly, I'm assuming you need to compile ripgrep with stable Rust. If so, SIMD isn't supported so you couldn't enabled it even if you wanted to.</li>
<li>Rust doesn't have runtime CPU feature detection yet. We're working on a proposal to get that (and various other SIMD things) stabilized, but it will be months (or more) before it makes its way to stable Rust.</li>
</ol>
<p>I'm going to close this because it should eventually happen automatically.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2016-12-02 23:29</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/vladon">@vladon</a> on 2016-12-02 23:40</div>
            <div class="timeline-body"><p>OK, it was just a question.
In Rust, can we write CPU detection (actually running <code>cpuid</code> instruction) like in C++?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2016-12-02 23:42</div>
            <div class="timeline-body"><p>@vladon You would have to write Assembly to check the cpuid and link it into your Rust binary (Rust doesn't have an otherwise stable way of accessing <code>cpuid</code> information). Even if we did that, it's not sufficient, because you need compiler support for emitting SIMD intrinsics without telling the compiler to explicitly compile with, say, AVX2 support. (In Clang and gcc, this is the <code>__attribute__(__target__)</code> feature.) We don't have that yet either. Soon though!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:41:56 UTC
    </footer>
</body>
</html>
