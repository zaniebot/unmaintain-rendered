<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature request: case-insensitive .gitignore matching on Windows - BurntSushi/ripgrep #1164</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Feature request: case-insensitive .gitignore matching on Windows</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1164">#1164</a>
        opened by <a href="https://github.com/davidtorosyan">@davidtorosyan</a>
        on 2019-01-16 04:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/davidtorosyan">@davidtorosyan</a></div>
            <div class="timeline-body">What version of ripgrep are you using?
<p>ripgrep 0.10.0 (rev 8a7db1a918)
-SIMD -AVX (compiled)</p>
How did you install ripgrep?
<p>Downloaded ripgrep-0.10.0-i686-pc-windows-msvc.zip from the release page and installed rg.exe to a location in my path.</p>
What operating system are you using ripgrep on?
<p>Windows 10 Pro
Version 1803 (OS Build 17134.523)</p>
Describe your feature request.
<p>I&#x27;d like ripgrep to support case-insensitive .gitignore matching.</p>
<p>On Windows, the file system is case insensitive which inspired this issue #163 and the subsequent --iglob flag. However, it looks like the flag can&#x27;t be used to make exclusions from the .gitignore case insensitive.</p>
<p>Here&#x27;s an example on the Windows command line. You&#x27;ll notice that <code>git status</code> doesn&#x27;t list <code>myfile.txt</code>, but ripgrep does (of course on linux this isn&#x27;t the case, and the file is listed twice).</p>
<pre><code>&gt; mkdir rgtest
&gt; cd rgtest
&gt; git init
&gt; echo foo &gt; myfile.txt
&gt; echo MYFILE.txt &gt; .gitignore
&gt; git status -s
?? .gitignore
&gt; rg -l foo
myfile.txt
</code></pre>
<p>Sorry if I&#x27;m missing something obvious, or if this is covered by another issue. I tried searching the man page and didn&#x27;t find any configuration regarding .gitignore, and found <em>many</em> issues related to case insensitive file matching but none as far as I could tell that asked for this specific feature.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-01-16 12:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-01-16 12:01</div>
            <div class="timeline-body"><p>It&#x27;s possible I could get on board with enabling this functionality with a flag, but I think the better solution is to probably stop relying on the case insensitivity of your file system in your <code>.gitignore</code> files. However, that&#x27;s a subjective assessment on my part.</p>
<p>If case insensitive globbing is enabled across ignore files, then the performance of matching ignore rules could substantially decrease in the presence of a large number of rules.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davidtorosyan">@davidtorosyan</a> on 2019-01-16 16:15</div>
            <div class="timeline-body"><p>I agree that better .gitignore files is a nicer strategy, especially because that way the repo would become a little closer to cross-platform. This works well for repos I own and I can advocate for others to do the same.</p>
<p>That said, I often have to search across repos that I don’t own, and as long as .gitignore is case insensitive on Windows people will continue writing them in case insensitive ways.</p>
<p>Is there a way I can help find out if the performance degradation of such a flag would be bad enough to keep me from using it (to at least provide one data point)? Maybe write a command with a giant --iglob that matches the .gitignore?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-01-16 16:21</div>
            <div class="timeline-body"><p>I think the simplest way would be to just patch ripgrep to do case insensitive matching. I think if you just hacked globset to always enable case insensitivity, then I think that will do the trick.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davidtorosyan">@davidtorosyan</a> on 2019-01-16 16:23</div>
            <div class="timeline-body"><p>Alright, I’ll see if I can give that a try.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davidtorosyan">@davidtorosyan</a> on 2019-01-20 01:37</div>
            <div class="timeline-body"><p>I tried my patched version on my repos and it&#x27;s fast enough for me, but I thought I&#x27;d gather some benchmarking data. I used the benchsuite detailed <a href="https://blog.burntsushi.net/ripgrep/">here</a> but had trouble building the kernel, so I followed instructions from the <a href="https://wiki.archlinux.org/index.php/Kernel/Traditional_compilation">Arch Wiki</a> instead. I downloaded <a href="https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.20.3.tar.xz">linux-4.20.3.tar.xz</a>, turned it into a git repo, and built.</p>
<p>For the hack, I changed <a href="https://github.com/BurntSushi/ripgrep/blob/master/ignore/src/gitignore.rs#L335">this line in gitignore.rs</a> to <code>case_insensitive: true</code>.</p>
<p>Builds of ripgrep were done using <code>cargo build --release</code>. Other packages were installed from official arch repositories and AUR.</p>
<p>Setup:</p>
<pre><code>$ rg --version
ripgrep 0.10.0
-SIMD -AVX (compiled)
+SIMD +AVX (runtime)
$ sudo mv /usr/bin/rg /usr/bin/rg.bkup
</code></pre>
<p>For my first run, tired running the benchmark with the official package.</p>
<pre><code>$ sudo cp /usr/bin/rg.bkup /usr/bin/rg
$ benchsuite/benchsuite --dir ~/data/corpus --allow-missing linux_literal

linux_literal (pattern: PM_RESUME)
----------------------------------
rg (ignore)          0.444 +/- 0.012 (lines: 19)
rg (ignore) (mmap)   0.895 +/- 0.026 (lines: 19)
ag (ignore) (mmap)   0.826 +/- 0.004 (lines: 19)
pt (ignore)          1.006 +/- 0.004 (lines: 19)
git grep (ignore)    0.435 +/- 0.027 (lines: 19)
rg (whitelist)       0.483 +/- 0.060 (lines: 19)
ucg (whitelist)*     0.405 +/- 0.004 (lines: 19)*

linux_literal_casei (pattern: PM_RESUME)
----------------------------------------
rg (ignore)          0.460 +/- 0.001 (lines: 430)
rg (ignore) (mmap)   0.904 +/- 0.015 (lines: 430)
ag (ignore) (mmap)   0.873 +/- 0.061 (lines: 430)
pt (ignore)          19.943 +/- 1.453 (lines: 430)
git grep (ignore)*   0.398 +/- 0.007 (lines: 430)*
rg (whitelist)       0.416 +/- 0.006 (lines: 430)
ucg (whitelist)      0.444 +/- 0.022 (lines: 430)

linux_literal_default (pattern: PM_RESUME)
------------------------------------------
rg         0.441 +/- 0.058 (lines: 19)
ag         1.059 +/- 0.232 (lines: 19)
ucg        0.401 +/- 0.002 (lines: 19)
pt         1.014 +/- 0.004 (lines: 19)
git grep*  0.350 +/- 0.005 (lines: 19)*
</code></pre>
<p>Next up, my built copy from 7cbc535.</p>
<pre><code>$ sudo cp ~/data/ripgrep_builds/rg_built /usr/bin/rg
$ benchsuite/benchsuite --dir ~/data/corpus --allow-missing linux_literal

linux_literal (pattern: PM_RESUME)
----------------------------------
rg (ignore)          0.405 +/- 0.001 (lines: 19)
rg (ignore) (mmap)   0.902 +/- 0.050 (lines: 19)
ag (ignore) (mmap)   0.898 +/- 0.067 (lines: 19)
pt (ignore)          1.018 +/- 0.021 (lines: 19)
git grep (ignore)*   0.353 +/- 0.004 (lines: 19)*
rg (whitelist)       0.359 +/- 0.002 (lines: 19)
ucg (whitelist)      0.403 +/- 0.001 (lines: 19)

linux_literal_casei (pattern: PM_RESUME)
----------------------------------------
rg (ignore)          0.429 +/- 0.002 (lines: 430)
rg (ignore) (mmap)   0.886 +/- 0.011 (lines: 430)
ag (ignore) (mmap)   0.836 +/- 0.006 (lines: 430)
pt (ignore)          19.139 +/- 0.283 (lines: 430)
git grep (ignore)    0.402 +/- 0.006 (lines: 430)
rg (whitelist)*      0.380 +/- 0.001 (lines: 430)*
ucg (whitelist)      0.454 +/- 0.044 (lines: 430)

linux_literal_default (pattern: PM_RESUME)
------------------------------------------
rg         0.398 +/- 0.002 (lines: 19)
ag         0.841 +/- 0.019 (lines: 19)
ucg        0.405 +/- 0.002 (lines: 19)
pt         1.004 +/- 0.001 (lines: 19)
git grep*  0.352 +/- 0.009 (lines: 19)*
</code></pre>
<p>Finally, my patched copy.</p>
<pre><code>$ sudo cp ~/data/ripgrep_builds/rg_patched /usr/bin/rg
$ benchsuite/benchsuite --dir ~/data/corpus --allow-missing linux_literal

linux_literal (pattern: PM_RESUME)
----------------------------------
rg (ignore)          0.680 +/- 0.003 (lines: 19)
rg (ignore) (mmap)   1.100 +/- 0.011 (lines: 19)
ag (ignore) (mmap)   0.830 +/- 0.010 (lines: 19)
pt (ignore)          1.006 +/- 0.004 (lines: 19)
git grep (ignore)*   0.352 +/- 0.000 (lines: 19)*
rg (whitelist)       0.363 +/- 0.015 (lines: 19)
ucg (whitelist)      0.401 +/- 0.003 (lines: 19)

linux_literal_casei (pattern: PM_RESUME)
----------------------------------------
rg (ignore)          0.706 +/- 0.006 (lines: 430)
rg (ignore) (mmap)   1.150 +/- 0.073 (lines: 430)
ag (ignore) (mmap)   0.887 +/- 0.085 (lines: 430)
pt (ignore)          19.038 +/- 0.102 (lines: 430)
git grep (ignore)    0.410 +/- 0.010 (lines: 430)
rg (whitelist)*      0.380 +/- 0.001 (lines: 430)*
ucg (whitelist)      0.430 +/- 0.003 (lines: 430)

linux_literal_default (pattern: PM_RESUME)
------------------------------------------
rg         0.671 +/- 0.002 (lines: 19)
ag         0.854 +/- 0.030 (lines: 19)
ucg        0.417 +/- 0.023 (lines: 19)
pt         1.006 +/- 0.003 (lines: 19)
git grep*  0.350 +/- 0.004 (lines: 19)*
</code></pre>
<p>Overall it looks like ripgrep takes 1.5x longer with the patch. That&#x27;s a pretty big hit, but it&#x27;s already so fast that I personally wouldn&#x27;t mind it.</p>
<p>Thoughts on including this? If you&#x27;re interested I can try working on the changes myself - I haven&#x27;t worked in Rust before but I&#x27;ve been looking for a good opportunity, and just adding a flag to enable this looks like it would be a pretty minor change (famous last words).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-01-20 01:43</div>
            <div class="timeline-body"><p>Excellent analysis, thank you! Yes, I would be OK adding this behind a flag.</p>
<p>In principle, you&#x27;re right, the change is simple. There is a fair bit of plumbing though. ripgrep is split up into libraries, so features like this need to be part of the public API of a library. For example, I&#x27;d probably expect it to be a new option on a <a href="https://docs.rs/ignore/0.4.6/ignore/struct.WalkBuilder.html"><code>ignore::WalkBuilder</code></a> that in turn set <a href="https://docs.rs/ignore/0.4.6/ignore/gitignore/struct.GitignoreBuilder.html#method.case_insensitive"><code>ignore::gitignore::GitignoreBuilder::case_insensitive</code></a> appropriately.</p>
<p>If you want to give it a try, that&#x27;d be great! If you get stuck, feel free to just throw up a PR with what you&#x27;ve got and we can figure out how to go from there together.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davidtorosyan">@davidtorosyan</a> on 2019-01-20 02:20</div>
            <div class="timeline-body"><p>That makes sense, thanks for the direction. I&#x27;ll give it a shot!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-01-23 01:04</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:08 UTC
    </footer>
</body>
</html>
