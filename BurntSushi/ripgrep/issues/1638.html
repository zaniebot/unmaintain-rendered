<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOMs are not stripped consistently in --json output - BurntSushi/ripgrep #1638</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>BOMs are not stripped consistently in --json output</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1638">#1638</a>
        opened by <a href="https://github.com/acheronfail">@acheronfail</a>
        on 2020-07-08 11:54
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/acheronfail">@acheronfail</a></div>
            <div class="timeline-body">What version of ripgrep are you using?
<pre><code>ripgrep 12.0.1
-SIMD -AVX (compiled)
+SIMD +AVX (runtime)
</code></pre>
How did you install ripgrep?
<pre><code>cargo install ripgrep
</code></pre>
What operating system are you using ripgrep on?
<pre><code>Arch Linux 5.7.6
</code></pre>
Describe your bug.
<p>When using ripgrep&#x27;s <code>--json</code> flag on a file encoded as &quot;UTF 8 with BOM&quot; the BOM is not accounted for (as opposed to other encodings, such as UTF 16).</p>
What are the steps to reproduce the behavior?
<p>UTF8</p>
<pre><code># Create a UTF8 encoded file (without BOM)
printf &quot;\x66\x6f\x6f&quot; &gt; utf8
# Run ripgrep
rg foo ./utf8 --json
</code></pre>
<p>UTF8 BOM</p>
<pre><code># Create a UTF8 encoded file (with BOM)
printf &quot;\xef\xbb\xbf\x66\x6f\x6f&quot; &gt; utf8bom
# Run ripgrep
rg foo ./utf8bom --json
</code></pre>
<p>UTF16</p>
<pre><code># Create a UTF16 encoded file (has BOM)
printf &quot;\xff\xfe\x66\x00\x6f\x00\x6f\x00&quot; &gt; utf16
# Run ripgrep
rg foo ./utf16 --json
</code></pre>
What is the actual behavior?
<p>Here is the JSON output for the above three code blocks.</p>
<p>UTF8</p>
<pre><code>{&quot;type&quot;:&quot;begin&quot;,&quot;data&quot;:{&quot;path&quot;:{&quot;text&quot;:&quot;./utf8&quot;}}}
{&quot;type&quot;:&quot;match&quot;,&quot;data&quot;:{&quot;path&quot;:{&quot;text&quot;:&quot;./utf8&quot;},&quot;lines&quot;:{&quot;text&quot;:&quot;foo&quot;},&quot;line_number&quot;:1,&quot;absolute_offset&quot;:0,&quot;submatches&quot;:[{&quot;match&quot;:{&quot;text&quot;:&quot;foo&quot;},&quot;start&quot;:0,&quot;end&quot;:3}]}}
{&quot;type&quot;:&quot;end&quot;,&quot;data&quot;:{&quot;path&quot;:{&quot;text&quot;:&quot;./utf8&quot;},&quot;binary_offset&quot;:null,&quot;stats&quot;:{&quot;elapsed&quot;:{&quot;secs&quot;:0,&quot;nanos&quot;:42600,&quot;human&quot;:&quot;0.000043s&quot;},&quot;searches&quot;:1,&quot;searches_with_match&quot;:1,&quot;bytes_searched&quot;:3,&quot;bytes_printed&quot;:219,&quot;matched_lines&quot;:1,&quot;matches&quot;:1}}}
{&quot;data&quot;:{&quot;elapsed_total&quot;:{&quot;human&quot;:&quot;0.007219s&quot;,&quot;nanos&quot;:7218625,&quot;secs&quot;:0},&quot;stats&quot;:{&quot;bytes_printed&quot;:219,&quot;bytes_searched&quot;:3,&quot;elapsed&quot;:{&quot;human&quot;:&quot;0.000043s&quot;,&quot;nanos&quot;:42600,&quot;secs&quot;:0},&quot;matched_lines&quot;:1,&quot;matches&quot;:1,&quot;searches&quot;:1,&quot;searches_with_match&quot;:1}},&quot;type&quot;:&quot;summary&quot;}
</code></pre>
<p>UTF8 BOM</p>
<pre><code>{&quot;type&quot;:&quot;begin&quot;,&quot;data&quot;:{&quot;path&quot;:{&quot;text&quot;:&quot;./utf8bom&quot;}}}
{&quot;type&quot;:&quot;match&quot;,&quot;data&quot;:{&quot;path&quot;:{&quot;text&quot;:&quot;./utf8bom&quot;},&quot;lines&quot;:{&quot;text&quot;:&quot;ï»¿foo&quot;},&quot;line_number&quot;:1,&quot;absolute_offset&quot;:0,&quot;submatches&quot;:[{&quot;match&quot;:{&quot;text&quot;:&quot;foo&quot;},&quot;start&quot;:3,&quot;end&quot;:6}]}}
{&quot;type&quot;:&quot;end&quot;,&quot;data&quot;:{&quot;path&quot;:{&quot;text&quot;:&quot;./utf8bom&quot;},&quot;binary_offset&quot;:null,&quot;stats&quot;:{&quot;elapsed&quot;:{&quot;secs&quot;:0,&quot;nanos&quot;:47766,&quot;human&quot;:&quot;0.000048s&quot;},&quot;searches&quot;:1,&quot;searches_with_match&quot;:1,&quot;bytes_searched&quot;:6,&quot;bytes_printed&quot;:228,&quot;matched_lines&quot;:1,&quot;matches&quot;:1}}}
{&quot;data&quot;:{&quot;elapsed_total&quot;:{&quot;human&quot;:&quot;0.007849s&quot;,&quot;nanos&quot;:7849144,&quot;secs&quot;:0},&quot;stats&quot;:{&quot;bytes_printed&quot;:228,&quot;bytes_searched&quot;:6,&quot;elapsed&quot;:{&quot;human&quot;:&quot;0.000048s&quot;,&quot;nanos&quot;:47766,&quot;secs&quot;:0},&quot;matched_lines&quot;:1,&quot;matches&quot;:1,&quot;searches&quot;:1,&quot;searches_with_match&quot;:1}},&quot;type&quot;:&quot;summary&quot;}
</code></pre>
<p>UTF16</p>
<pre><code>{&quot;type&quot;:&quot;begin&quot;,&quot;data&quot;:{&quot;path&quot;:{&quot;text&quot;:&quot;./utf16&quot;}}}
{&quot;type&quot;:&quot;match&quot;,&quot;data&quot;:{&quot;path&quot;:{&quot;text&quot;:&quot;./utf16&quot;},&quot;lines&quot;:{&quot;text&quot;:&quot;foo&quot;},&quot;line_number&quot;:1,&quot;absolute_offset&quot;:0,&quot;submatches&quot;:[{&quot;match&quot;:{&quot;text&quot;:&quot;foo&quot;},&quot;start&quot;:0,&quot;end&quot;:3}]}}
{&quot;type&quot;:&quot;end&quot;,&quot;data&quot;:{&quot;path&quot;:{&quot;text&quot;:&quot;./utf16&quot;},&quot;binary_offset&quot;:null,&quot;stats&quot;:{&quot;elapsed&quot;:{&quot;secs&quot;:0,&quot;nanos&quot;:43947,&quot;human&quot;:&quot;0.000044s&quot;},&quot;searches&quot;:1,&quot;searches_with_match&quot;:1,&quot;bytes_searched&quot;:3,&quot;bytes_printed&quot;:221,&quot;matched_lines&quot;:1,&quot;matches&quot;:1}}}
{&quot;data&quot;:{&quot;elapsed_total&quot;:{&quot;human&quot;:&quot;0.006400s&quot;,&quot;nanos&quot;:6399559,&quot;secs&quot;:0},&quot;stats&quot;:{&quot;bytes_printed&quot;:221,&quot;bytes_searched&quot;:3,&quot;elapsed&quot;:{&quot;human&quot;:&quot;0.000044s&quot;,&quot;nanos&quot;:43947,&quot;secs&quot;:0},&quot;matched_lines&quot;:1,&quot;matches&quot;:1,&quot;searches&quot;:1,&quot;searches_with_match&quot;:1}},&quot;type&quot;:&quot;summary&quot;}
</code></pre>
What is the expected behavior?
<p>I personally expected that ripgrep would strip the UTF8 BOM from the JSON report since that&#x27;s what it does for UTF16 encodings. However, I&#x27;m not sure if this should be the case or not, considering that a UTF8 BOM is an optional file header.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-05-30 17:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rollup</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-05-30 17:02</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-06-01 01:51</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:10 UTC
    </footer>
</body>
</html>
