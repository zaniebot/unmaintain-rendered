<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>11.0.0 regression: Seemingly infinite loop on non-Unicode files - BurntSushi/ripgrep #1247</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>11.0.0 regression: Seemingly infinite loop on non-Unicode files</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1247">#1247</a>
        opened by <a href="https://github.com/Deewiant">@Deewiant</a>
        on 2019-04-16 07:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Deewiant">@Deewiant</a></div>
            <div class="timeline-body"><h4>What version of ripgrep are you using?</h4>
<pre><code>ripgrep 11.0.0 (rev d7f57d9aab)
-SIMD -AVX (compiled)
+SIMD +AVX (runtime)
</code></pre>
<p>And I'm comparing it to:</p>
<pre><code>ripgrep 0.10.0
-SIMD -AVX (compiled)
+SIMD +AVX (runtime)
</code></pre>
<h4>How did you install ripgrep?</h4>
<p>From the binary releases for <code>x86_64-unknown-linux-musl</code>:</p>
<ul>
<li>https://github.com/BurntSushi/ripgrep/releases/download/11.0.0/ripgrep-11.0.0-x86_64-unknown-linux-musl.tar.gz</li>
<li>https://github.com/BurntSushi/ripgrep/releases/download/0.10.0/ripgrep-0.10.0-x86_64-unknown-linux-musl.tar.gz</li>
</ul>
<h4>What operating system are you using ripgrep on?</h4>
<p>Arch Linux</p>
<h4>Describe your question, feature request, or bug.</h4>
<p>I've run into a crippling performance regression on certain types of queries and non-UTF-8 files between 0.10.0 and 11.0.0, which looks like it might even be an infinite loop.</p>
<h4>If this is a bug, what are the steps to reproduce the behavior?</h4>
<p>A very simple way is to create a file containing only two bytes, &quot;s√§&quot; encoded with ISO 8559-1, and search for a pattern with a short prefix that matches the &quot;s&quot; but not the rest, like <code>'\bs(?:thiswillnotmatch|norwillthis)'</code>:</p>
<pre><code>printf &quot;s\xe4&quot; &gt; test.txt
rg '\bs(?:thiswillnotmatch|norwillthis)' test.txt
</code></pre>
<p>The <code>\b</code> does seem to be required at least in this case.</p>
<p>Another example file that reproduces this is <code>sherlock.br</code> in ripgrep's own source code, using the exact same pattern.</p>
<h4>If this is a bug, what is the actual behavior?</h4>
<p>11.0.0 seems to spin forever:</p>
<pre><code>$ time rg-11.0 --debug '\bs(?:thiswillnotmatch|norwillthis)' test.txt &gt;/dev/null
DEBUG|grep_regex::literal|grep-regex/src/literal.rs:115: required literal found: &quot;s&quot;
DEBUG|globset|globset/src/lib.rs:435: built glob set; 0 literals, 0 basenames, 11 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|globset/src/lib.rs:435: built glob set; 3 literals, 0 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes

&lt;it's been 10 minutes and it's still spinning at 100% CPU&gt;
</code></pre>
<h4>If this is a bug, what is the expected behavior?</h4>
<p>0.10.0 has no problems and gives a result in a few milliseconds:</p>
<pre><code>$ time rg-0.10 --debug '\bs(?:thiswillnotmatch|norwillthis)' test.txt &gt;/dev/null
DEBUG|grep_regex::literal|grep-regex/src/literal.rs:110: required literal found: &quot;s&quot;
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|globset/src/lib.rs:429: built glob set; 3 literals, 0 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes

0.00user 0.00kernel 0.003elapsed
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @BurntSushi on 2019-04-16 12:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2019-04-16 12:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-04-16 12:35</div>
            <div class="timeline-body"><p>Thanks for reporting this bug! This was actually a regression introduced in the underlying regex engine (as a result of fixing an unrelated bug). I've published a fix for the regex engine and brought in the updated version on ripgrep master. I'll put out a new point release of ripgrep with this fix soon.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-04-16 18:37</div>
            <div class="timeline-body"><p><code>ripgrep 11.0.1</code> is out with this fix in it. Sorry about the regression!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Deewiant">@Deewiant</a> on 2019-04-16 19:03</div>
            <div class="timeline-body"><p>No problem, thanks for the quick response and fix!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:42:53 UTC
    </footer>
</body>
</html>
