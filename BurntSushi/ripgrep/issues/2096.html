<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panic on mundane-looking input - BurntSushi/ripgrep #2096</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Panic on mundane-looking input</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2096">#2096</a>
        opened by <a href="https://github.com/bgeron">@bgeron</a>
        on 2021-12-06 14:16
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/bgeron">@bgeron</a></div>
            <div class="timeline-body">What version of ripgrep are you using?
<pre><code>ripgrep 13.0.0
-SIMD -AVX (compiled)
+SIMD +AVX (runtime)</code></pre>
How did you install ripgrep?
<p>With <code>cargo install --force --features pcre2</code>, on 6 December 2021.</p>
What operating system are you using ripgrep on?
<p>macOS 12.0.1 on x64 MacBook Pro, 9th generation Intel</p>
Describe your bug.
<p>Panic on a normal-looking input.</p>
What are the steps to reproduce the behavior?
<p>In bash, run <code>echo -e &quot;four\n/a &quot; | rg -w a?</code>.</p>
<p>On my Linux machine, I cannot reproduce. On my Mac, it reproduces reliably every time.</p>
What is the actual behavior?
<pre><code>/Users/bram.geron/.config/ripgreprc: No such file or directory (os error 2)
DEBUG|grep_regex::word|/Users/bram.geron/.cargo/registry/src/github.com-1ecc6299db9ec823/grep-regex-0.1.9/src/word.rs:52: word regex: &quot;(?:(?m:^)|\\W)(a?)(?:\\W|(?m:$))&quot;
DEBUG|globset|/Users/bram.geron/.cargo/registry/src/github.com-1ecc6299db9ec823/globset-0.4.8/src/lib.rs:421: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
thread &#x27;main&#x27; panicked at &#x27;assertion failed: self.start &lt;= end&#x27;, /Users/bram.geron/.cargo/registry/src/github.com-1ecc6299db9ec823/grep-matcher-0.1.5/src/lib.rs:131:9
stack backtrace:
   0: rust_begin_unwind
             at /rustc/09c42c45858d5f3aedfa670698275303a3d19afa/library/std/src/panicking.rs:517:5
   1: core::panicking::panic_fmt
             at /rustc/09c42c45858d5f3aedfa670698275303a3d19afa/library/core/src/panicking.rs:101:14
   2: core::panicking::panic
             at /rustc/09c42c45858d5f3aedfa670698275303a3d19afa/library/core/src/panicking.rs:50:5
   3: &lt;grep_regex::word::WordMatcher as grep_matcher::Matcher&gt;::find_at
   4: &lt;grep_regex::matcher::RegexMatcher as grep_matcher::Matcher&gt;::find_at
   5: &lt;&amp;M as grep_matcher::Matcher&gt;::find_iter_at
   6: grep_printer::util::find_iter_at_in_context
   7: &lt;grep_printer::standard::StandardSink&lt;M,W&gt; as grep_searcher::sink::Sink&gt;::matched
   8: grep_searcher::searcher::core::Core&lt;M,S&gt;::match_by_line
   9: grep_searcher::searcher::glue::ReadByLine&lt;M,R,S&gt;::run
  10: grep_searcher::searcher::Searcher::search_reader
  11: rg::search::SearchWorker&lt;W&gt;::search
  12: rg::try_main
  13: rg::main
note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bgeron">@bgeron</a> on 2021-12-06 15:09</div>
            <div class="timeline-body"><p>A friend with Linux informs me that it reproduces for him. So perhaps this fails on Intel, but works on AMD.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-12-06 15:10</div>
            <div class="timeline-body"><p>Unfortunately, I cannot reproduce this issue, even on macOS and even when installing in the same manner as you. Could you try using <code>cargo build --release --features pcre2</code> in a checkout of this repo with the latest version of stable Rust? Does it still panic? I&#x27;m wondering if this is a version mismatch issue somehow.</p>
<p>Also, can you clarify whether you literally ran <code>cargo install --force --features pcre2</code> or not? Because that doesn&#x27;t work on the latest stable version of Rust, even when you&#x27;re in a checkout of this repo. You need either <code>cargo install --force --features pcre2 ripgrep</code> or <code>cargo install --force --features pcre2 --path .</code>.</p>
<p>Can you also check whether the release binaries on this repo reproduce this issue for you?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-12-06 15:16</div>
            <div class="timeline-body"><p>Ah, this is a duplicate of #1891. It will be fixed in the next release.</p>
<p>If you install from master (e.g., <code>cargo install --force --features pcre2 --path .</code>), then this should be fixed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-12-06 15:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-12-06 15:17</div>
            <div class="timeline-body"><p>I was ultimately able to reproduce this by running <code>cargo install --force --features pcre2 ripgrep</code>, which builds ripgrep using the latest versions of each of its dependencies. Since the fix for #1891 hasn&#x27;t been published yet, it doesn&#x27;t pick it up.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bgeron">@bgeron</a> on 2021-12-06 15:17</div>
            <div class="timeline-body"><p>Oops, I meant to write <code>cargo install --force --features pcre2 ripgrep</code>. I can also reproduce it on the Mac with merely the binary generated by <code>cargo install --force ripgrep</code>. In both cases, I was using Rust 1.56.0 stable.</p>
<p>The release binary reproduces it too for me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bgeron">@bgeron</a> on 2021-12-06 15:17</div>
            <div class="timeline-body"><p>Ah it&#x27;s been fixed.. thanks! For everything.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">duplicate</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-12-06 15:19</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:12 UTC
    </footer>
</body>
</html>
