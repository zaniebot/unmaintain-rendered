<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>support fancier regex features such as look-around and backreferences - BurntSushi/ripgrep #188</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>support fancier regex features such as look-around and backreferences</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/188">#188</a>
        opened by <a href="https://github.com/Mange">@Mange</a>
        on 2016-10-19 08:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Mange">@Mange</a></div>
            <div class="timeline-body"><p>One area that makes <code>ag</code> unable to be replaced by <code>ripgrep</code> is that <code>ag</code> supports negative lookahead. For example:</p>
<pre><code>ag &#x27;foo(?!.*bar)&#x27;
</code></pre>
<p>This would find all rows with &quot;foo&quot;, but not with &quot;bar&quot; somewhere after that on the same line.</p>
<p><code>ripgrep</code> gives the following error message:</p>
<pre><code>› rg &#x27;foo(?!.*bar)&#x27;
Error parsing regex near &#x27;foo(?!.*ba&#x27; at character offset 5: Unrecognized flag: &#x27;!&#x27;. (Allowed flags: i, m, s, U, u, x.)
</code></pre>
<p>I guess this is actually a problem in the <code>regex</code> crate, and I can open the same issue there if you wish.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2016-10-19 12:26</div>
            <div class="timeline-body"><blockquote>
<p>I guess this is actually a problem in the regex crate, and I can open the same issue there if you wish.</p>
</blockquote>
<p>Indeed it is, but it&#x27;s not a &quot;problem&quot; per se, it&#x27;s a conscious and explicit trade-off that I made. Notably, <a href="https://doc.rust-lang.org/regex/regex/index.html">this is the very first paragraph of the <code>regex</code> docs</a>:</p>
<blockquote>
<p>This crate provides a native implementation of regular expressions that is heavily based on RE2 both in syntax and in implementation. Notably, backreferences and arbitrary lookahead/lookbehind assertions are not provided. In return, regular expression searching provided by this package has excellent worst-case performance. The specific syntax supported is documented further down.</p>
</blockquote>
<p>If you&#x27;d like to read more about this, please consult Russ Cox&#x27;s excellent series on the matter (I&#x27;d also be happy to answer specific questions): https://swtch.com/~rsc/regexp/</p>
<blockquote>
<p>One area that makes ag unable to be replaced by ripgrep is that ag supports negative lookahead.</p>
</blockquote>
<p>Note that this isn&#x27;t an unfettered win, it&#x27;s a <em>trade off</em>. For example:</p>
<pre><code>$ cat foo
c
aaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
c
$ ag &#x27;(a*)*c&#x27; foo
1:c
$ rg &#x27;(a*)*c&#x27; foo
1:c
3:c
</code></pre>
<p>The Silver Searcher completely drops the second match because it&#x27;s using a backtracking regex engine, which is required* for supporting arbitrary lookaround.</p>
<blockquote>
<p>This would find all rows with &quot;foo&quot;, but not with &quot;bar&quot; somewhere after that on the same line.</p>
</blockquote>
<p>You can satisfy this particular use case relatively easily with <code>rg foo | rg -v &#x27;foo.*bar&#x27;</code>. However, I acknowledge that this is inconvenient for a number of reasons. I also acknowledge that there are other use cases of lookaround that aren&#x27;t so easily worked around.</p>
<p>* - Strictly speaking, there is <a href="http://laurikari.net/ville/spire2000-tnfa.ps">some theory</a> that supports it without backtracking, but I&#x27;m not aware of a practically fast implementation of it. (There is TRE and regex-tdfa, of which I have used neither, but I&#x27;ve never seen any compelling evidence that either was fast. Come to think of it, I don&#x27;t actually know if regex-tdfa supports arbitrary lookaround.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2016-10-19 12:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Mange">@Mange</a> on 2016-10-24 13:40</div>
            <div class="timeline-body"><p>Thank you for the detailed response. I&#x27;ll keep <code>ag</code> installed for these cases. :-)</p>
<p>This specific case would be pretty hard to do using pipes since I used it in my text editor.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2016-10-25 02:27</div>
            <div class="timeline-body"><p>Note that this is mentioned in the <a href="http://blog.burntsushi.net/ripgrep/#anti-pitch">anti-pitch</a>, which I should add to the README.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rsmolkin">@rsmolkin</a> on 2018-04-17 19:11</div>
            <div class="timeline-body"><p>Hi, I just heard that your project was included into the latest version of VSCode for text searching.  Just recently I was trying to do a RegEx with a negative lookbehind across our entire code base.  I could not get it to work in VSCode, but it worked for me in Sublime Text.  I&#x27;d prefer to stay in VSCode, and at first was very excited to hear that they added a better text search.  But then saw this issue where negative lookahead was discussed.  I&#x27;m not sure if my specific case could also be re-written with pipes.  I was trying to find an instance of &quot;IN&quot; or &#x27;IN&#x27; with double or single quotes, but not as in type=&quot;in&quot; cause that was the most common occurrence and not related.  I also wanted to find a way where it was followed by Indiana or India shortly after, but didn&#x27;t find a regex way to do that.  Can you maybe give some more info on how to use the pipes with some examples, or maybe add the lookahead and lookbehind options?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-04-17 21:33</div>
            <div class="timeline-body"><blockquote>
<p>Can you maybe give some more info on how to use the pipes with some examples</p>
</blockquote>
<p><code>rg -i &quot;[&#x27;\&quot;]in[&#x27;\&quot;]&quot; | rg -v &quot;type=&quot;</code></p>
<blockquote>
<p>or maybe add the lookahead and lookbehind options?</p>
</blockquote>
<p>No.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rsmolkin">@rsmolkin</a> on 2018-04-18 13:56</div>
            <div class="timeline-body"><p>Thanks, I guess that won&#x27;t work in VSCode as is just on commandline.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Negative lookahead&quot; to &quot;support fancier regex features such as look-around and backreferences&quot; by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-08-19 13:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-08-19 13:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-08-20 11:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/timotheecour">@timotheecour</a> on 2018-08-23 07:34</div>
            <div class="timeline-body"><p>@BurntSushi
how do I enable PCRE2 ?
<code>rg --pcre2</code> gives: <code>PCRE2 is not available in this build of ripgrep</code></p>
<ul>
<li><p>NOTE: I&#x27;ve installed <code>rg</code> via <code>brew install --HEAD ripgrep</code> to get the HEAD version of rg.</p>
</li>
<li><p>the ripgrep formula is here: https://github.com/Homebrew/homebrew-core/blob/master/Formula/ripgrep.rb</p>
</li>
<li><p>the relevant line is probably here: <code>system &quot;cargo&quot;, &quot;install&quot;, &quot;--root&quot;, prefix</code>
How do I change this to support <code>--pcre2</code> ?</p>
</li>
<li><p>i read this but not sure how to proceed: https://github.com/BurntSushi/ripgrep/blob/master/FAQ.md#how-do-i-use-lookaround-andor-backreferences</p>
</li>
</ul>
<blockquote>
<p>If you installed ripgrep through a different means (like your system&#x27;s package manager), then please reach out to the maintainer of that package to see whether it&#x27;s possible to enable the PCRE2 feature</p>
</blockquote>
<p>obviously the package maintainer of homebrew will have the same question as me...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-08-23 09:49</div>
            <div class="timeline-body"><p>The build instructions are in the README.</p>
<p>On Thu, Aug 23, 2018, 03:34 Timothee Cour <a href="mailto:notifications@github.com">notifications@github.com</a> wrote:</p>
<blockquote>
<p>@BurntSushi <a href="https://github.com/BurntSushi">https://github.com/BurntSushi</a>
how do I enable PCRE2 ?
rg --pcre2 gives: PCRE2 is not available in this build of ripgrep</p>
<ul>
<li></li>
</ul>
NOTE: I&#x27;ve installed rg via brew install --HEAD ripgrep to get the
HEAD version of rg.
the ripgrep formula is here:
https://github.com/Homebrew/homebrew-core/blob/master/Formula/ripgrep.rb
the relevant line is probably here: system &quot;cargo&quot;, &quot;install&quot;,
&quot;--root&quot;, prefix
How do I change this to support --pcre2 ?
<p>i read this but not sure how to proceed:
https://github.com/BurntSushi/ripgrep/blob/master/FAQ.md#how-do-i-use-lookaround-andor-backreferences</p>
<p>If you installed ripgrep through a different means (like your system&#x27;s
package manager), then please reach out to the maintainer of that package
to see whether it&#x27;s possible to enable the PCRE2 feature</p>
<p>obviously the package maintainer of homebrew will have the same question
as me...</p>
<p>—
You are receiving this because you were mentioned.
Reply to this email directly, view it on GitHub
<a href="https://github.com/BurntSushi/ripgrep/issues/188#issuecomment-415320792">BurntSushi/ripgrep#188</a>,
or mute the thread
<a href="https://github.com/notifications/unsubscribe-auth/AAb34i2UI3pwvgaw5VjAdpUUveFPkZ7Uks5uTlshgaJpZM4KashK">https://github.com/notifications/unsubscribe-auth/AAb34i2UI3pwvgaw5VjAdpUUveFPkZ7Uks5uTlshgaJpZM4KashK</a>
.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-08-23 11:54</div>
            <div class="timeline-body"><p>For Homebrew, technically, the simplest possible change is to replace this</p>
<pre><code>system &quot;cargo&quot;, &quot;install&quot;, &quot;--root&quot;, prefix
</code></pre>
<p>with this</p>
<pre><code>system &quot;cargo&quot;, &quot;install&quot;, &quot;--root&quot;, prefix, &quot;--features&quot;, &quot;pcre2&quot;
</code></pre>
<p>Which is <a href="https://github.com/BurntSushi/ripgrep#building">consistent with the build instructions in the README</a>. Note that you cannot do this with the current release, since only master has the <code>pcre2</code> feature.</p>
<p>Note that if you do this, ripgrep will, by default, attempt to link with the system version of PCRE2. So you either need to add PCRE2 itself as an optional dependency of the <code>ripgrep</code> formula, or you need to force static compilation of PCRE2. Either will work. The build instructions also tell you how to do that, which is done by setting the environment variable <code>PCRE2_SYS_STATIC=1</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/timotheecour">@timotheecour</a> on 2018-08-23 13:32</div>
            <div class="timeline-body"><p>thanks, <code>system &quot;cargo&quot;, &quot;install&quot;, &quot;--root&quot;, prefix, &quot;--features&quot;, &quot;pcre2&quot;</code> did work.</p>
<blockquote>
<p>Note that you cannot do this with the current release, since only master has the pcre2 feature</p>
</blockquote>
<p>works with <code>brew install --HEAD ripgrep</code></p>
<p>NOTE: This option mentioned in readme (<code>--features &#x27;pcre2 simd-accel avx-accel&#x27;</code>) did not work</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-08-23 13:33</div>
            <div class="timeline-body"><blockquote>
<p>NOTE: This option mentioned in readme (--features &#x27;pcre2 simd-accel avx-accel&#x27;) did not work</p>
</blockquote>
<p>That doesn&#x27;t mean anything to me. How am I supposed to diagnose &quot;did not work&quot; and help you fix it?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/timotheecour">@timotheecour</a> on 2018-08-23 13:40</div>
            <div class="timeline-body"><p>using https://github.com/timotheecour/homebrew-timutil/blob/master/ripgrep_temp.rb</p>
<p>brew tap timotheecour/timutil
brew reinstall --HEAD timotheecour/timutil/ripgrep_temp</p>
<pre><code>==&gt; Reinstalling timotheecour/timutil/ripgrep_temp
==&gt; Cloning https://github.com/BurntSushi/ripgrep.git
Cloning into &#x27;/Users/timothee/Library/Caches/Homebrew/ripgrep_temp--git&#x27;...
==&gt; Checking out branch master
Already on &#x27;master&#x27;
Your branch is up to date with &#x27;origin/master&#x27;.
==&gt; cargo install --features pcre2 avx-accel --root /Users/timothee/homebrew/Cellar/ripgrep_temp/HEAD-f1e0258
Last 15 lines from /Users/timothee/Library/Logs/Homebrew/ripgrep_temp/01.cargo:
error[E0554]: #![feature] may not be used on the stable release channel
 --&gt; .brew_home/.cargo/registry/src/github.com-1ecc6299db9ec823/simd-0.2.2/src/lib.rs:4:1
  |
4 | #![feature(cfg_target_feature, repr_simd, platform_intrinsics, const_fn)]
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

error: aborting due to previous error

For more information about this error, try `rustc --explain E0554`.
error: Could not compile `simd`.
warning: build failed, waiting for other jobs to finish...
error: failed to compile `ripgrep v0.9.0 (file:///private/tmp/ripgrep_temp-20180823-73604-1pwlm5r)`, intermediate artifacts can be found at `/private/tmp/ripgrep_temp-20180823-73604-1pwlm5r/target`

Caused by:
  build failed

If reporting this issue please do so at (not Homebrew/brew or Homebrew/core):
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-08-23 13:57</div>
            <div class="timeline-body"><p>@timotheecour Ah yes, thank you. The README says:</p>
<blockquote>
<p>If you have a Rust nightly compiler and a recent Intel CPU, then you can enable additional optional SIMD acceleration like so:</p>
</blockquote>
<p>I&#x27;ve updated the text to make it a little more clear: https://github.com/BurntSushi/ripgrep/commit/1bb8b7170f4e35da87cd73efdf1e4d3a5c3a416c</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:02 UTC
    </footer>
</body>
</html>
