<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Limiting results based on their context - BurntSushi/ripgrep #1008</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Limiting results based on their context</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1008">#1008</a>
        opened by <a href="https://github.com/thijsvandien">@thijsvandien</a>
        on 2018-08-07 19:05
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/thijsvandien">@thijsvandien</a></div>
            <div class="timeline-body"><p>Frequently when grepping through code, I am searching for rather generic names. Whether a result is relevant depends on the context. I haven&#x27;t found a good way to limit the results to those with some specific mentions in their context. Therefore I&#x27;m wondering if this kind of functionality would be a welcome addition to <code>rg</code>. Here&#x27;s a simple example:</p>
<pre><code>$ cat sherlock
For the Doctor Watsons of this world, as opposed to the Sherlock
Holmeses, success in the province of detective work must always
be, to a very large extent, the result of luck. Sherlock Holmes
can extract a clew from a wisp of straw or a flake of cigar ash;
but Doctor Watson has to have it taken out for him and dusted,
and exhibited clearly, with a label attached.

$ rg Doctor sherlock -C 1
1:For the Doctor Watsons of this world, as opposed to the Sherlock
2-Holmeses, success in the province of detective work must always
--
4-can extract a clew from a wisp of straw or a flake of cigar ash;
5:but Doctor Watson has to have it taken out for him and dusted,
6-and exhibited clearly, with a label attached.

$ rg Doctor sherlock -C 1 --in-context cigar
4-can extract a clew from a wisp of straw or a flake of cigar ash;
5:but Doctor Watson has to have it taken out for him and dusted,
6-and exhibited clearly, with a label attached.
</code></pre>
<p>Before getting into all the specifics of how it should behave under different circumstances, I&#x27;ll wait for some feedback if something like this looks interesting at all.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-08-07 19:36</div>
            <div class="timeline-body"><p>I like the idea (I believe it has been suggested before in one manner or another), and I can see how some might find it useful, but I don&#x27;t think it&#x27;s a good fit for ripgrep. <a href="https://github.com/svent/sift">sift</a> is an example of a tool that provides some support for this style of searching via its <a href="https://sift-tool.org/docs">&quot;conditions&quot; flags (scroll down a bit)</a>. You can see how the types of queries you might want to perform can get quite a bit more complicated than just &quot;find a match in the context.&quot;</p>
<p>This also introduces a host of new possibilities for output options and introduces a second way to feed patterns into ripgrep, which increases the surface area of a feature like this even more.</p>
<p>I think there is probably a lot of experimentation that needs to be done to figure out how a feature like this should work. It is not something that I believe anyone can just sit down and design, and I don&#x27;t really have the bandwidth or motivation to drive a feature like this forward.</p>
<p>Instead, I would rather that someone build a new tool that provides these types of contextual search features. This sounds like it might be hard to do, but libripgrep is getting very close to landing on ripgrep master. Once that&#x27;s done, the biggest pieces of ripgrep core will be its argv handling. I won&#x27;t say that building a ripgrep clone would be &quot;simple,&quot; but should be easier by a couple orders of magnitude compared to rolling everything on your own. I believe libripgrep is itself flexible enough to accommodate searching like this, and it can even be done without needing to roll your own support for searching and finding the contextual lines in the first place. But, that&#x27;s just instinctual. I don&#x27;t know for sure.</p>
<p>Finally, you can often achieve something similar through some clever use of shell pipelines. For example, instead of <code>rg Doctor sherlock -C 1 --in-context cigar</code>, I might do:</p>
<pre><code>$ rg Doctor sherlock -C1 | rg cigar -A2
can extract a clew from a wisp of straw or a flake of cigar ash;
but Doctor Watson has to have it taken out for him and dusted,
and exhibited clearly, with a label attached.
</code></pre>
<p>Which, yeah, isn&#x27;t great. And it&#x27;s pretty easy to hit the limits of this type of work around pretty easily compared to a dedicated tool for searching in contexts.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-08-07 19:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/leeoniya">@leeoniya</a> on 2018-08-07 23:54</div>
            <div class="timeline-body"><p>this reminds me of Altavista&#x27;s <code>NEAR</code> syntax [1]. RIP :(</p>
<p>[1] http://jkorpela.fi/altavista/</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-08-19 14:00</div>
            <div class="timeline-body"><p>I&#x27;m going to close this out since I&#x27;d rather see other folks experiment with features like this in other programs.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-08-19 14:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BatmanAoD">@BatmanAoD</a> on 2018-09-21 19:25</div>
            <div class="timeline-body"><p>Sift looks very cool; thanks for linking to it!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:07 UTC
    </footer>
</body>
</html>
