<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reading patterns from file (-f) loses last character - BurntSushi/ripgrep #1259</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Reading patterns from file (-f) loses last character</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1259">#1259</a>
        opened by <a href="https://github.com/dprobinson">@dprobinson</a>
        on 2019-04-19 10:52
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dprobinson">@dprobinson</a></div>
            <div class="timeline-body">What version of ripgrep are you using?
<p>ripgrep 11.0.1 (rev a6222939f9)
-SIMD -AVX (compiled)
+SIMD -AVX (runtime)</p>
How did you install ripgrep?
<p>Compiled from source</p>
What operating system are you using ripgrep on?
<p>Arch Linux</p>
Describe your question, feature request, or bug.
<p>When reading patterns in from a file using the &quot;-f&quot; flag, it appears that the last character is lost. Depending on the last character in the patterns file, this causes either a parsing error, or the silent use of a truncated pattern.</p>
If this is a bug, what are the steps to reproduce the behavior?
<p>Create the patterns file (patterns.txt):</p>
<pre><code>THIS
is
a
test
[broken]
</code></pre>
<p>N.B. Ensure a blank newline is not added at the end of the file by your editor (see bug #783)</p>
<p>Run the following command (you can use any file as the corpus, as we don&#x27;t get as far as loading it):</p>
<pre><code>rg -P -f patterns.txt testfile
</code></pre>
If this is a bug, what is the actual behavior?
<p>ripgrep reports that there&#x27;s a parsing error, indicating that the last char &quot;]&quot; has been lost whilst loading the patterns from the file:</p>
<pre><code>PCRE2: error compiling pattern at offset 22: missing terminating ] for character class
</code></pre>
<p>If you modify the patterns.txt file to the following, you no longer receive an error, even though the pattern is now invalid, leading me to believe that the last char is discarded:</p>
<pre><code>THIS
is
a
test
[broken]]
</code></pre>
If this is a bug, what is the expected behavior?
<p>Read the last character of the file when loading patterns using &quot;-f&quot;, omitting only a trailing newline, as per #783</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-04-19 11:04</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-04-19 11:12</div>
            <div class="timeline-body"><p>Fixed in https://github.com/BurntSushi/ripgrep/commit/e7829c05d3b9234f053e7d480f7e75028831d772</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-04-19 11:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-04-19 11:13</div>
            <div class="timeline-body"><p>Thanks for reporting this! I don&#x27;t think this was a regression in the latest release, so I don&#x27;t know whether I&#x27;ll cut a new patch release just for this or not. In the mean time, you can add a <code>\n</code> as a work-around. But this should be fixed on master now!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dprobinson">@dprobinson</a> on 2019-04-19 11:28</div>
            <div class="timeline-body"><p>Just recompiled from master, and I can confirm it appears to be fixed in https://github.com/BurntSushi/ripgrep/commit/e7829c05d3b9234f053e7d480f7e75028831d772.</p>
<p>Thanks for the ridiculously fast fix, and for writing such a great tool!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:08 UTC
    </footer>
</body>
</html>
