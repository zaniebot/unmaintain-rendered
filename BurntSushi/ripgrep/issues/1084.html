<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Correctness issue: pattern doesn't match when it should - BurntSushi/ripgrep #1084</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Correctness issue: pattern doesn&#x27;t match when it should</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1084">#1084</a>
        opened by <a href="https://github.com/khyperia">@khyperia</a>
        on 2018-10-16 16:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/khyperia">@khyperia</a></div>
            <div class="timeline-body">What version of ripgrep are you using?
<pre><code>% rg --version
ripgrep 0.10.0
-SIMD -AVX (compiled)
+SIMD +AVX (runtime)
</code></pre>
What operating system are you using ripgrep on?
<p>Arch Linux, using the Arch-official <code>ripgrep</code> package.</p>
Bug description/reproduction steps
<p>This prints out &quot;abcd&quot;.</p>
<p><code>echo &#x27;abcd&#x27; | rg &#x27;a(.*(d|ce))&#x27;</code></p>
<p>Adding a &quot;c&quot; makes it not match (i.e. it doesn&#x27;t print out anything).</p>
<p><code>echo &#x27;abcd&#x27; | rg &#x27;a(.*(cd|ce))&#x27;</code></p>
If this is a bug, what is the expected behavior?
<p>I believe that both regexes should match the input, and print out a match in both cases. Testing using <a href="https://regex101.com/">regex101</a> seems to imply this is true.</p>
Real-world discovery background (non-minimal case that made me discover the minimal repro above):
<p>I was trying to run <code>git diff --name-only master... | rg &#x27;js/src/(.*(cpp|\.h))&#x27; --replace &#x27;$1&#x27;</code>.</p>
<p><code>git diff --name-only master...</code> printed lines such as:</p>
<pre><code>js/src/frontend/BinSource.yaml
js/src/frontend/BytecodeEmitter.cpp
js/src/frontend/ParseNode.h
</code></pre>
<p>and I wanted to extract:</p>
<pre><code>frontend/BytecodeEmitter.cpp
frontend/ParseNode.h
</code></pre>
<p>(i.e. trim <code>js/src/</code> off the front, and only match <code>cpp</code> and <code>h</code> files)</p>
<p>However, adding a <code>\.</code> in front of the <code>cpp</code> made <em>nothing</em> match.</p>
<p><code>git diff --name-only master... | rg &#x27;js/src/(.*(\.cpp|\.h))&#x27; --replace &#x27;$1&#x27;</code> -- prints nothing???</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-10-16 16:27</div>
            <div class="timeline-body"><p>This is a duplicate of #1064 and #1081. It&#x27;s fixed on master.</p>
<p>From my digging, I thought that this bug wasn&#x27;t a regression, but had always been there in previous versions of ripgrep. However, we&#x27;ve had this bug filed three times since the release of ripgrep 0.10, but never before. So something seems fishy.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-10-16 16:27</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">duplicate</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-10-16 16:27</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/AntCrow">@AntCrow</a> on 2018-12-06 18:45</div>
            <div class="timeline-body"><p>FWIW, I don&#x27;t think it&#x27;s a regression. I found the same thing on 0.8.1, confirmed it on 0.10.0, and was going to report it until I found all the duplicates.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:07 UTC
    </footer>
</body>
</html>
