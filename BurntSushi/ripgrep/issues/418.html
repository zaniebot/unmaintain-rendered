<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>--files flag seems to be interpreting regex as a filename (or docs aren't completely clear?) - BurntSushi/ripgrep #418</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>--files flag seems to be interpreting regex as a filename (or docs aren't completely clear?)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/418">#418</a>
        opened by <a href="https://github.com/elirnm">@elirnm</a>
        on 2017-03-23 03:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/elirnm">@elirnm</a></div>
            <div class="timeline-body"><p>I'm on Windows 7, and running ripgrep with the --files flag seems to be treating my search regex as a filename and then throwing an error.</p>
<p>So <code>rg -w Bob</code> works properly and produces matches, but <code>rg -w Bob --files</code> produces <code>Bob: The system cannot find the file specified. (os error 2)</code> and exits. If I run --files without the actual search term, it works and prints the files to be searched. This happens in both cmd.exe and Powershell.</p>
<p>It occurs to me now that this might be expected behavior, since the search term shouldn't affect the output when rg is run with --files, but if so that should probably be documented in the help page and/or produce a more useful error. This seems implied by the synopsis in https://github.com/BurntSushi/ripgrep/blob/master/doc/rg.1.md, but that doesn't appear in the command line --help output and doesn't appear in the documentation for the --files flag.</p>
<p>Thanks for the great work on ripgrep.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "--files flag seems to be interpreting regex as a filename" to "--files flag seems to be interpreting regex as a filename (or docs aren't completely clear?)" by @elirnm on 2017-03-23 03:51</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-03-23 10:50</div>
            <div class="timeline-body"><p>@elirnm The behavior you're seeing is correct. <code>--files</code> prints file paths that <em>would</em> be searched, but doesn't actually perform the search, so specifying a pattern doesn't really make any sense. The top of the output of <code>rg -h</code>, <code>rg --help</code> and <code>man rg</code> all include this section:</p>
<pre><code>    rg [OPTIONS] &lt;pattern&gt; [&lt;path&gt; ...]
    rg [OPTIONS] [-e PATTERN | -f FILE ]... [&lt;path&gt; ...]
    rg [OPTIONS] --files [&lt;path&gt; ...]
    rg [OPTIONS] --type-list
</code></pre>
<p>Could you suggest something that would make documentation clearer? (Note the third variant above.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">doc</span> added by @BurntSushi on 2017-03-23 10:57</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @BurntSushi on 2017-03-23 10:57</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/elirnm">@elirnm</a> on 2017-03-23 17:51</div>
            <div class="timeline-body"><p>Hmm, <code>rg --help</code> doesn't look like that for me. All I get that talks about usage is</p>
<pre><code>USAGE:ripgrep [OPTIONS] &lt;pattern&gt; [--] [path]...
</code></pre>
<p>which isn't even correct because <code>ripgrep</code> doesn't trigger anything. I'm using 0.5.0.</p>
<p>Exploring a bit, I get the output you gave when I enter <code>rg</code> without any options, but when I include <code>-h</code> or <code>--help</code> I don't get that.</p>
<p><img src="https://cloud.githubusercontent.com/assets/19817004/24262200/9841ad6a-0fb6-11e7-8e15-67ab4cabecf3.PNG" alt="capture" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-03-23 17:54</div>
            <div class="timeline-body"><p>That's... interesting. I was using an older version when I responded. It looks like ripgrep's argv parser changed behavior recently? cc @kbknapp</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-03-23 21:35</div>
            <div class="timeline-body"><p>Interesting. If so it'd be a bug. I'll investigate when I get home. Do you know which version of clap got compiled with it, or if the <code>Cargo.lock</code> was removed before building?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-03-23 21:39</div>
            <div class="timeline-body"><p>@kbknapp ripgrep 0.4.0 was using clap 2.19.3 and ripgrep 0.5.0 is using 2.21.1. (There were some interesting changes I needed to make for the upgrade to work: https://github.com/BurntSushi/ripgrep/commit/95bc678403b63d98b717636e79fdfbabc8949c8a)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-03-24 00:42</div>
            <div class="timeline-body"><p>Ok I'll look into it and put out a fix, it would be a major regression to slip by all the tests! Thanks for the ping!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-03-24 03:57</div>
            <div class="timeline-body"><p>I've got a PR in to fix this and have added a regression test to ensure it doesn't pop up. Once the PR merges i'll put out v2.22.1</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kbknapp">@kbknapp</a> on 2017-03-24 16:10</div>
            <div class="timeline-body"><p>The new version is out which fixes this regression</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-03-30 16:37</div>
            <div class="timeline-body"><p>The latest version of clap sadly does not fix this issue. ripgrep uses a template in addition to a custom usage, which I don't think is accounted for in the regression test in https://github.com/kbknapp/clap-rs/pull/916.</p>
<p>See also #426</p>
<p>I'll see about fixing clap when I get chance.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-03-31 19:56</div>
            <div class="timeline-body"><p>Closed in #429</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2017-03-31 19:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:42:07 UTC
    </footer>
</body>
</html>
