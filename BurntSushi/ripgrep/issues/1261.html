<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attempting to use a newline character in pattern with the PCRE2 engine, outside multiline mode fails silently - BurntSushi/ripgrep #1261</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Attempting to use a newline character in pattern with the PCRE2 engine, outside multiline mode fails silently</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1261">#1261</a>
        opened by <a href="https://github.com/dprobinson">@dprobinson</a>
        on 2019-04-21 22:59
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dprobinson">@dprobinson</a></div>
            <div class="timeline-body"><h4>What version of ripgrep are you using?</h4>
<p>ripgrep 11.0.1 (rev e7829c05d3)
-SIMD -AVX (compiled)
+SIMD -AVX (runtime)</p>
<h4>How did you install ripgrep?</h4>
<p>Compiled from source</p>
<h4>What operating system are you using ripgrep on?</h4>
<p>Arch Linux</p>
<h4>Describe your question, feature request, or bug.</h4>
<p>Attempting to use a newline character (&quot;\n&quot;) in pattern with the PCRE2 engine (-P), outside multiline mode fails silently.</p>
<h4>If this is a bug, what are the steps to reproduce the behavior?</h4>
<p>Create the following corpus.txt:</p>
<pre><code>testing
RIP
GREP
again
</code></pre>
<p>First, try the search with Rust's engine:</p>
<pre><code>rg &quot;RIP\nGREP&quot; corpus.txt
</code></pre>
<p>Output:</p>
<pre><code>the literal '&quot;\n&quot;' is not allowed in a regex

Consider enabling multiline mode with the --multiline flag (or -U for short).
When multiline mode is enabled, new line characters can be matched.
</code></pre>
<p>As expected (from the documentation), we see an error.</p>
<p>Now try searching using the PCRE2 engine:</p>
<pre><code>rg -P &quot;RIP\nGREP&quot; corpus.txt
</code></pre>
<p>Output:</p>
<pre><code></code></pre>
<p>As we see, we've tried to use a newline char without multiline mode, but receive no error. The search fails silently.</p>
<p>N.B. Searching using the PCRE2 engine, with multiline mode (-U) works as expected:</p>
<pre><code>rg -PU &quot;RIP\nGREP&quot; corpus.txt
</code></pre>
<p>Output:</p>
<pre><code>2:RIP
3:GREP
</code></pre>
<h4>If this is a bug, what is the actual behavior?</h4>
<p>See output above</p>
<h4>If this is a bug, what is the expected behavior?</h4>
<p>I would expect ripgrep to throw an error, warning the user that newlines cannot be matched outside multiline mode (-U) when using PCRE2. This would yield the same behaviour as when Rust's engine is used (#1055)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-04-21 23:14</div>
            <div class="timeline-body"><p>This can't be fixed because PCRE doesn't expose anything to parse its syntax to detect the newline characters in the pattern. It might be possible to detect some simple cases without parsing the regex, but I don't know how far down that road I want to go.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/dprobinson">@dprobinson</a> on 2019-04-21 23:28</div>
            <div class="timeline-body"><p>That's a shame. I thought the reason might be something like that.</p>
<p>Maybe it would be worth us tweaking the documentation, to make to clear an error won't be thrown when using PCRE2?</p>
<p>Current text:</p>
<blockquote>
<p>For example, when multiline mode is not enabled (the default), then the regex \p{any} will match any Unicode codepoint other than \n. Similarly, the regex \n is explicitly forbidden, and if you try to use it, ripgrep will return an error.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @BurntSushi on 2019-04-22 11:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2019-08-01 21:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:42:53 UTC
    </footer>
</body>
</html>
