<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[ignore] GitignoreBuilder::new(&amp;path).build_global() fails to match any files if global .gitignore missing - BurntSushi/ripgrep #3150</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[ignore] GitignoreBuilder::new(&amp;path).build_global() fails to match any files if global .gitignore missing</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/3150">#3150</a>
        opened by <a href="https://github.com/Reeywhaar">@Reeywhaar</a>
        on 2025-09-20 03:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Reeywhaar">@Reeywhaar</a></div>
            <div class="timeline-body"><h3>Please tick this box to confirm you have reviewed the above.</h3>
<ul>
<li>[x] I have a different issue.</li>
</ul>
<h3>What version of ripgrep are you using?</h3>
<p>I use <code>ignore</code> package: 0.4.23</p>
<h3>How did you install ripgrep?</h3>
<p>I use <code>ignore</code> package, not ripgrep itself</p>
<h3>What operating system are you using ripgrep on?</h3>
<p>MacOs 15.6.1</p>
<h3>Describe your bug.</h3>
<p>Considering default setup:</p>
<pre><code class="language-sh">#: git config --get core.excludesFile
empty...
</code></pre>
<pre><code class="language-rust">dbg!(gitconfig_excludes_path());
</code></pre>
<pre><code class="language-sh">/Users/%user%/config/git/ignore # result of the call even though the file doesn't exist!
</code></pre>
<p>If we try to run <code>Gitignore</code> built with <code>GitignoreBuilder::new(&amp;some_repo_path).build_global()</code> in any git directory it will fail to match any file that is ignored.</p>
<p>Instead we should check manually if global gitignore file exists</p>
<pre><code class="language-sh">let mut gitignore_builder = GitignoreBuilder::new(&amp;self.path);
if let Some(gitconfig_path) = gitconfig_excludes_path() {
    if gitconfig_path.exists() {
        let err = gitignore_builder.add(gitconfig_path);
        if let Some(err) = err {
            return Err(err.into());
        }
    }
}
let err = gitignore_builder.add(self.path.join(&quot;.gitignore&quot;));
if let Some(err) = err {
    return Err(err.into());
}
let gitignore = gitignore_builder.build()?;
</code></pre>
<h3>What are the steps to reproduce the behavior?</h3>
<p>Remove global gitignore file from git settings and test <code>GitignoreBuilder::new(&amp;some_repo_path).build_global()</code> on any directory you expect to have git ignored files</p>
<h3>What is the actual behavior?</h3>
<pre><code class="language-rs">let gitignore_builder = GitignoreBuilder::new(&amp;some_repo_path);
let gitignore = gitignore_builder.build_global().unwrap()
gitignore.matched(&amp;any_ignored_file, is_dir).is_ignore(); // false
</code></pre>
<h3>What is the expected behavior?</h3>
<pre><code class="language-rs">gitignore.matched(&amp;any_ignored_file, is_dir).is_ignore(); // should be true
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "[ignore] GitignoreBuilder::new(&path).build_global() fails to find any files if global .gitignore missing" to "[ignore] GitignoreBuilder::new(&path).build_global() fails to match any files if global .gitignore missing" by @Reeywhaar on 2025-09-20 03:33</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-20 10:45</div>
            <div class="timeline-body"><p>I can't make heads or tails of this bug report. Please provide a <em>complete</em> minimal reproducible example.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Reeywhaar">@Reeywhaar</a> on 2025-09-20 19:13</div>
            <div class="timeline-body"><p>Made a repo that runs tests in docker on vanilla debian:bookworm with no predefined global gitignore.
<code>sh scripts/run_test.sh</code></p>
<p>https://github.com/Reeywhaar/ripgrep-3150</p>
<p>Main concern is that <code>case_with_global</code> fails</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-21 16:34</div>
            <div class="timeline-body"><p>As far as I can tell, you're misusing <code>Gitignore</code>. A <code>Gitignore</code> represents a <em>single</em> set of gitignore rules. But you seem to try to be using it as if it takes multiple sets of gitignore rules into account. It doesn't.</p>
<p>If you're using <code>Gitignore</code> directly, then you have to re-implement gitignore filtering precedence yourself. This is what the recursive file walker does for you. It is non-trivial.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2025-09-21 16:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">invalid</span> added by @BurntSushi on 2025-09-21 16:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Reeywhaar">@Reeywhaar</a> on 2025-09-21 16:43</div>
            <div class="timeline-body"><p>Oh, ok, thought it takes multiple <code>.gitignore</code> files and merges them. Even though you can see that slight modification of <code>GitignoreBuilder</code> init that is seemingly equal results in different behavior which is confusing. Nevermind then, thank you so much, I'll try <code>Walk</code> instead!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-21 16:47</div>
            <div class="timeline-body"><p>Yes, the API, especially the lower level bits, is extremely confusing.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:43:58 UTC
    </footer>
</body>
</html>
