<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Directory entries in `.gitignore` are not processed in the same way as in Git - BurntSushi/ripgrep #3236</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Directory entries in <code>.gitignore</code> are not processed in the same way as in Git</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/3236">#3236</a>
        opened by <a href="https://github.com/Cerber-Ursi">@Cerber-Ursi</a>
        on 2025-12-04 13:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Cerber-Ursi">@Cerber-Ursi</a></div>
            <div class="timeline-body"><h3>Please tick this box to confirm you have reviewed the above.</h3>
<ul>
<li>[x] I have a different issue.</li>
</ul>
<h3>What version of ripgrep are you using?</h3>
<p>Not a ripgrep itself, but <code>ignore v0.4.25</code>; reproduced at <a href="https://github.com/BurntSushi/ripgrep/commit/cd1f981beafaeb9b61537e47e91314cea125400b">current <code>master</code> branch</a> at the moment of writing.</p>
<h3>How did you install ripgrep?</h3>
<p>Just using <code>ignore</code> from crates.io.</p>
<h3>What operating system are you using ripgrep on?</h3>
<p>Arch, rolling release</p>
<h3>Describe your bug.</h3>
<p>When <code>.gitignore</code> file contains a literal directory reference, <code>ignore</code> still includes contents of that directory. This is in contradiction with git itself, which ignores this directory.</p>
<h3>What are the steps to reproduce the behavior?</h3>
<p>Reproduces with the following test in <code>ignore</code>:</p>
<pre><code class="language-rust">#[test]
fn gitignore_directory() {
    let td = tmpdir();
    mkdirp(td.path().join(&quot;a&quot;));
    wfile(td.path().join(&quot;.gitignore&quot;), &quot;/a&quot;);
    wfile(td.path().join(&quot;a/foo&quot;), &quot;&quot;);

    let root = td.path();
    assert_paths(&amp;root, &amp;WalkBuilder::new(&amp;root), &amp;[]);
}
</code></pre>
<p>Real-life case: repository with a single Rust project, where .gitignore file is as following:</p>
<pre><code>/target
</code></pre>
<h3>What is the actual behavior?</h3>
<p>Files in the <code>.gitignore</code>d directory are included in a walk.</p>
<h3>What is the expected behavior?</h3>
<p>Files in the <code>.gitignore</code>d directory are ignored, as they do when using git.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Cerber-Ursi">@Cerber-Ursi</a> on 2025-12-04 14:02</div>
            <div class="timeline-body"><p>Reproduced even simpler, directly in the <code>gitignore.rs</code>:</p>
<pre><code class="language-rust">ignored!(ig45, ROOT, &quot;/foo&quot;, &quot;foo/bar&quot;); // fails
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-12-04 14:03</div>
            <div class="timeline-body"><p>By default, <code>ignore</code> requires that there is an actual git repository in order to respect <code>.gitignore</code>. But that can be disabled with <a href="https://docs.rs/ignore/latest/ignore/struct.WalkBuilder.html#method.require_git"><code>WalkBuilder::require_git</code></a>. It looks like your test doesn't have a git repository in the directory?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-12-04 14:03</div>
            <div class="timeline-body"><blockquote>
<p>Reproduced even simpler, directly in the <code>gitignore.rs</code>:</p>
<p>ignored!(ig45, ROOT, &quot;/foo&quot;, &quot;foo/bar&quot;); // fails</p>
</blockquote>
<p>The <code>gitignore.rs</code> API is lower level. That test result is correct.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Cerber-Ursi">@Cerber-Ursi</a> on 2025-12-04 14:17</div>
            <div class="timeline-body"><blockquote>
<p>ignore requires that there is an actual git repository in order to respect .gitignore.</p>
</blockquote>
<p>Aha, thanks - that's something I've missed. Simplified use case is indeed a false alarm, but real use case was actually more like this:</p>
<pre><code class="language-rust">#[test]
fn gitignore_parent_ignoring_directory() {
    let td = tmpdir();
    mkdirp(td.path().join(&quot;.git&quot;));
    mkdirp(td.path().join(&quot;a/foo&quot;));
    wfile(td.path().join(&quot;.gitignore&quot;), &quot;/a&quot;);
    wfile(td.path().join(&quot;a/foo/bar&quot;), &quot;&quot;);

    let root = td.path().join(&quot;a/foo&quot;);
    assert_paths(td.path(), &amp;WalkBuilder::new(&amp;root), &amp;[]);
}
</code></pre>
<p>...that is, I'm somewhere inside the repository already, and <code>gitignore</code> excludes the path passed to <code>WalkBuilder</code>. Is this case expected to work as it does now?</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:44:00 UTC
    </footer>
</body>
</html>
