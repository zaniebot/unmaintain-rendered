<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Errors with broken symlinks appears even if --no-messages is passed - BurntSushi/ripgrep #241</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Errors with broken symlinks appears even if --no-messages is passed</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/241">#241</a>
        opened by <a href="https://github.com/ahmedelgabri">@ahmedelgabri</a>
        on 2016-11-20 19:13
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ahmedelgabri">@ahmedelgabri</a></div>
            <div class="timeline-body"><p>If you have a broken symlink somewhere in the path that you are searching in you will get this error <code>No such file or directory (os error 2)</code> on macOS. Not sure how this should be handled though, for example it seems the <code>ag</code> ignores these errors.</p>
<pre><code>$ tree
.
â”œâ”€â”€ bar
â”‚Â Â  â””â”€â”€ brokensymlink -&gt; ./moveme
â””â”€â”€ moveme.broken

1 directory, 2 files

$ rg --files --hidden --follow --glob &quot;\!.git/*&quot;
./bar/brokensymlink: No such file or directory (os error 2)
moveme.broken
</code></pre>
<p>The problem that if you try to use <code>rg</code> with another tool that depends on the output, something like <code>fzf</code> it will break or you get some weird stuff.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2016-11-20 19:27</div>
            <div class="timeline-body"><p>I think this is intended behavior. You'll get a similar error if you don't have permission to read a file or directory, for example:</p>
<pre><code>$ echo foo &gt; test1
$ echo foo &gt; test2
$ mkdir dir
$ echo foo &gt; dir/test3
$ chmod 000 test2 dir
$ rg foo
./test2: Permission denied (os error 13)
test1
1:foo
./dir: Permission denied (os error 13)
</code></pre>
<p>This matches the behavior of <code>find</code> (for directories at least, <code>find</code> doesn't need to read files so it doesn't care if it can't access them):</p>
<pre><code>$ find ./
./
./dir
find: â€˜./dirâ€™: Permission denied
./test2
./test1
</code></pre>
<p>To drive this point home, GNU grep behaves similarly:</p>
<pre><code>$ grep -r foo
grep: dir: Permission denied
grep: test2: Permission denied
test1:foo
</code></pre>
<p>Given the above evidence, I think ripgrep's current behavior is probably right.</p>
<blockquote>
<p>The problem that if you try to use rg with another tool that depends on the output, something like fzf it will break or you get some weird stuff.</p>
</blockquote>
<p>ripgrep writes all such error messages to stderr. This is common in CLI applications and it is easy to suppress such output by redirecting stderr to <code>/dev/null</code>:</p>
<pre><code>$ rg foo 2&gt; /dev/null
test1
1:foo
</code></pre>
<p>If redirection like this is inconvenient, then you can pass the <code>--no-messages</code> flag, which does the same thing it does in grep:</p>
<pre><code>$ rg --no-messages foo
./test2: Permission denied (os error 13)
test1
1:foo
</code></pre>
<p>Ah ha! A bug! I'll push a fix shortly for that. But that <code>./test2</code> permission error shouldn't appear when <code>--no-messages</code> is set.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ahmedelgabri">@ahmedelgabri</a> on 2016-11-20 19:34</div>
            <div class="timeline-body"><p>I think you are right &amp; I agree with you, because honestly I like that it reports the errors back when you have a broken symlink &amp; since there is a way to suppress this when needed then it's ok.</p>
<blockquote>
<p>Ah ha! A bug! I'll push a fix shortly for that. But that ./test2 permission error shouldn't appear when --no-messages is set.</p>
</blockquote>
<p>Will use redirection for now till this is fixed then ðŸ˜„</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @ahmedelgabri on 2016-11-20 19:34</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @BurntSushi on 2016-11-20 20:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from "Errors with broken symlinks" to "Errors with broken symlinks appears even if --no-messages is passed" by @BurntSushi on 2016-11-20 20:00</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2016-11-20 20:01</div>
            <div class="timeline-body"><p>@ahmedelgabri Great. Keeping this open to track the bug I found. :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2016-11-20 20:01</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:41:54 UTC
    </footer>
</body>
</html>
