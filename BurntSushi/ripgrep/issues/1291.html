<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>doesn't work in a nonexistent dir - BurntSushi/ripgrep #1291</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>doesn&#x27;t work in a nonexistent dir</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1291">#1291</a>
        opened by <a href="https://github.com/torkve">@torkve</a>
        on 2019-06-04 17:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/torkve">@torkve</a></div>
            <div class="timeline-body">What version of ripgrep are you using?
<pre><code>ripgrep 11.0.1
+SIMD -AVX (compiled)
+SIMD +AVX (runtime)
</code></pre>
How did you install ripgrep?
<p><code>cargo install ripgrep</code></p>
What operating system are you using ripgrep on?
<p>Ubuntu 19.04</p>
Describe your question, feature request, or bug.
<p>When the CWD is a nonexistent directory, and ripgrep is invoked, it always fails even if target is a valid absolute path. GNU grep works in this case.</p>
If this is a bug, what are the steps to reproduce the behavior?
<pre><code>0 ➜ mkdir somepath
0 ➜ cd somepath/
0 ➜ rm -rf ../somepath/
0 ➜ rg something /etc/hostname 
No such file or directory (os error 2)
2 ➜ 
</code></pre>
<p>According to strace, ripgrep invokes getcwd() at some point and fails with it.</p>
If this is a bug, what is the actual behavior?
<pre><code>0 ➜ RIPGREP_CONFIG_PATH= rg --debug something /etc/hostname 
DEBUG|grep_regex::literal|/home/torkve/.cargo/registry/src/github.com-1ecc6299db9ec823/grep-regex-0.1.3/src/literal.rs:59: literal prefixes detected: Literals { lits: [Complete(something)], limit_size: 250, limit_class: 10 }
DEBUG|globset|/home/torkve/.cargo/registry/src/github.com-1ecc6299db9ec823/globset-0.4.3/src/lib.rs:435: built glob set; 0 literals, 0 basenames, 11 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
No such file or directory (os error 2)
</code></pre>
If this is a bug, what is the expected behavior?
<p>I expect ripgrep to fail only in cases when any relative paths are used, while the only-absolute-paths command should be successfully executed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-06-04 17:56</div>
            <div class="timeline-body"><p>Could you please describe the use case for running ripgrep in a directory that doesn&#x27;t exist?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/torkve">@torkve</a> on 2019-06-04 18:03</div>
            <div class="timeline-body"><p>I just cd&#x27;ed into some temporary directory, created by my tests runner application (running somewhere in the background). And then I was doing some debugging.
When tests runner finished its work, it just removed that temporary directory, so it became nonexistent.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/torkve">@torkve</a> on 2019-06-04 18:07</div>
            <div class="timeline-body"><p>I may agree to some extent that this case is not very typical, and probably one should watch the directory they work in, and do not execute commands in some their random terminal session :)
But even with that, the error misguides because user assumes that problem is with the file, not the cwd.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-07-11 11:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/afrubin">@afrubin</a> on 2019-08-28 23:52</div>
            <div class="timeline-body"><blockquote>
<p>Could you please describe the use case for running ripgrep in a directory that doesn&#x27;t exist?</p>
</blockquote>
<p>I encountered this bug because I was in a network mounted directory but the network connection (OneDrive via rclone in this case) had been closed.</p>
<p>It did cause quite a bit of confusion until a colleague suggested I check the working directory. This had not occurred to me because I was searching a completely different part of the file system.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/yump">@yump</a> on 2019-11-03 07:33</div>
            <div class="timeline-body"><p>I encountered this because I was sitting in <code>/proc/$some_app_pid</code>, rg-ing through <code>smaps</code>. I restarted <code>some_app</code>, and thought it would suffice to rg <code>/proc/$(pgrep some_app)/smaps</code>, but instead got this confusing error, &quot;No such file or directory (os error 2)&quot;.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-02-17 22:16</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:08 UTC
    </footer>
</body>
</html>
