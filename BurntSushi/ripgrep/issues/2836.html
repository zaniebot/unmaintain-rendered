<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Some directories in .ignore aren't ignored - BurntSushi/ripgrep #2836</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Some directories in .ignore aren't ignored</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2836">#2836</a>
        opened by <a href="https://github.com/jknoos">@jknoos</a>
        on 2024-06-08 22:31
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jknoos">@jknoos</a></div>
            <div class="timeline-body"><h3>Please tick this box to confirm you have reviewed the above.</h3>
<ul>
<li>[X] I have a different issue.</li>
</ul>
<h3>What version of ripgrep are you using?</h3>
<p>ripgrep 14.1.0</p>
<h3>How did you install ripgrep?</h3>
<p>pacman</p>
<h3>What operating system are you using ripgrep on?</h3>
<p>Arch Linux</p>
<h3>Describe your bug.</h3>
<p>Some directories in ~/.ignore aren't ignored correctly.</p>
<h3>What are the steps to reproduce the behavior?</h3>
<p>Run this script <code>~/test</code> under <code>~/testdir</code>:</p>
<pre><code>#!/bin/bash

mkdir -p ~/testdir/sub/sub2
cd ~/testdir
chmod -r sub/sub2
echo 'sub/sub2' &gt;&gt; ~/.ignore
echo 'sub/sub2/' &gt;&gt; ~/.ignore
echo '/testdir/sub/sub2' &gt;&gt; ~/.ignore
echo '/testdir/sub/sub2/' &gt;&gt; ~/.ignore
rg --debug test
</code></pre>
<h3>What is the actual behavior?</h3>
<pre><code>[~/testdir]$ ~/test
rg: DEBUG|rg::flags::parse|crates/core/flags/parse.rs:97: no extra arguments found from configuration file
rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1099: using heuristics to determine whether to read from stdin or search ./ (is_readable_stdin=false, stdin_consumed=false, mode=Search(Standard))
rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1109: heuristic chose to search ./
rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1260: found hostname for hyperlink configuration: t480s
rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1270: hyperlink format: &quot;&quot;
rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:174: using 8 thread(s)
rg: DEBUG|grep_regex::config|crates/regex/src/config.rs:175: assembling HIR from 1 fixed string literals
rg: DEBUG|globset|crates/globset/src/lib.rs:453: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
rg: DEBUG|globset|crates/globset/src/lib.rs:453: built glob set; 8 literals, 0 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
rg: ./sub/sub2: Permission denied (os error 13)
rg: No files were searched, which means ripgrep probably applied a filter you didn't expect.
Running with --debug will show why files are being skipped.
[~/testdir]$ 
</code></pre>
<h3>What is the expected behavior?</h3>
<p><code>~/testdir/sub/sub2</code> should be ignored, i.e. the <code>rg: ./sub/sub2: Permission denied (os error 13)</code> error is unexpected.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-06-09 11:54</div>
            <div class="timeline-body"><p>Thanks for the bug report. I can reproduce this. Although here is something much simpler that doesn't rely on cluttering your <code>$HOME</code> directory:</p>
<pre><code>$ mkdir -p /tmp/rg2836/testdir/sub/sub2
$ chmod -r /tmp/rg2836/testdir/sub/sub2
$ echo '/testdir/sub/sub2/' &gt; /tmp/rg2836/.ignore
</code></pre>
<p>And then:</p>
<pre><code>$ cd /tmp/rg2836
$ rg --files
create
$ cd testdir/
$ rg --files
rg: ./sub/sub2: Permission denied (os error 13)
</code></pre>
<p>Moving into the sub-directory should still result in the <code>.ignore</code> file being respected. But there's probably an issue dealing with stripping the right prefix of candidate paths with respect to the directory of the <code>.ignore</code> file.</p>
<p>This may also be related to #829 and #278, although not necessarily so.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @BurntSushi on 2024-06-09 11:55</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">gitignore</span> added by @BurntSushi on 2024-06-09 11:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tmccombs">@tmccombs</a> on 2024-08-08 05:45</div>
            <div class="timeline-body"><p>I think https://github.com/sharkdp/fd/issues/1591 may be a case of this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gstokkink">@gstokkink</a> on 2024-08-20 14:16</div>
            <div class="timeline-body"><p>@BurntSushi https://github.com/BurntSushi/ripgrep/issues/2770 might also be related</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rollup</span> added by @BurntSushi on 2025-07-11 16:41</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2025-09-20 01:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:43:49 UTC
    </footer>
</body>
</html>
