<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>create a bot to bleat about long lines in pull requests - BurntSushi/ripgrep #2080</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>create a bot to bleat about long lines in pull requests</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2080">#2080</a>
        opened by <a href="https://github.com/BurntSushi">@BurntSushi</a>
        on 2021-11-22 14:47
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/BurntSushi">@BurntSushi</a></div>
            <div class="timeline-body"><p>For context that inspired this: <a href="https://github.com/BurntSushi/ripgrep/pull/2079">BurntSushi/ripgrep#2079</a>#issuecomment-975584963</p>
<p>In general, when I write code/docs, I still to 79 columns inclusive. No, it&#x27;s not because I code on punch cards. There are generally two reasons:</p>
<ol>
<li>I find that a line length limit <em>tends</em> to produce clearer code by exerting a pressure against stuffing too much into one line.</li>
<li>I like to be able to fit multiple code windows side-by-side. The extent to how well this works is a function of the quality of my eyesight, font size, distance from the monitor and the size of the monitor. Since all auto-line-wrapping I&#x27;ve seen by text editors is not that readable IMO, the smaller the line length limit the more code windows I can fit side-by-side.</li>
<li>79 columns (or 80 columns, not counting the 80th column) is reasonably small and pretty common given its legacy status. (For example, it used to be the recommended style for Python via PEP8.)</li>
</ol>
<p>Many people do not code with line length limits, or if they do, their limits are likely greater than mine. Because of this, it&#x27;s not uncommon for PRs to come in that violate the 79 column rule. Not only is detecting this without automation difficult, but it&#x27;s also kind of deflating to ask folks to reformat stuff based on line length. Often times, I&#x27;ll just do it for them.</p>
<p>In theory, it&#x27;s simple to build a tool that scans files and fails the build with the offending lines if any are over the limit. But in practice, the 79 column limit is <em>not</em> enforced strictly: a foolish consistency is the hobgoblin of small minds. Sometimes, code lines are more readable if they&#x27;re slightly longer. There may be other reasons to write a long line, such as a URL. Therefore, any such tool that errors on long lines also needs a whitelist, and now you have the problem of specifying how such a whitelist is stored and how it&#x27;s maintained. This is decidedly not simple and quite annoying.</p>
<p>@matkoniecz suggested in #2079 to build a bot that only looks at the <em>diff</em> produced by a PR. If there are lines longer than the limit, then the bot can send a message automatically asking to look into it. This neither fails the build nor does it require me to detect and bleat about these things myself.</p>
<p>So this issue is for building such a bot. I&#x27;ve never built a GitHub bot before myself. If someone else wants to do this, that would be cool, but I would ultimately need to retain exclusive control over its operation on the ripgrep repo.</p>
<p>Also, we should create a <code>CONTRIBUTING.md</code> file that includes, at minimum, the line length limit/guideline.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-11-22 14:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/matkoniecz">@matkoniecz</a> on 2021-11-22 14:54</div>
            <div class="timeline-body"><p>For bot itself - I have seen some code coverage monitor bots posting statistics how given PR changed code coverage, Visual Studio Code has some bot actions on issue tracker (automatically and triggered).</p>
<p>See <a href="https://github.com/microsoft/vscode/issues/137641">microsoft/vscode#137641</a>#issuecomment-975481667 https://github.com/microsoft/vscode-github-triage-actions</p>
<p>vscode-github-triage-actions is likely overengineered for needs here but some useful inspiration or copyable code may be there. And basic idea of running it as github actions seems like a good one?</p>
<p>https://github.com/facebook/docusaurus/issues/3521 https://github.com/noqcks/pull-request-size https://www.fullstory.com/blog/build-your-own-automated-sync-bot-via-github-actions/ may or may not be useful</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/deecewan">@deecewan</a> on 2021-11-23 01:25</div>
            <div class="timeline-body"><p>i wonder if something like <a href="https://danger.systems/">Danger</a> could be used? Although not sure you&#x27;d want the configuration for that to live inside of this codebase.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/matkoniecz">@matkoniecz</a> on 2021-12-01 09:39</div>
            <div class="timeline-body"><blockquote>
<p>Also, we should create a CONTRIBUTING.md file that includes, at minimum, the line length limit/guideline.</p>
</blockquote>
<p>Can I copy also explanation from <a href="https://github.com/BurntSushi/ripgrep/issues/2080">BurntSushi/ripgrep#2080</a>#issue-1060244354 ?</p>
<p>It would be verbose, but would not trigger &quot;No, it&#x27;s not because I code on punch cards&quot; that is triggered in me where I see some projects where it was not changed since times when monitors were 640 x 480.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-12-01 13:07</div>
            <div class="timeline-body"><p>How about something shorter with a link to that comment for more
explanation?</p>
<p>On Wed, Dec 1, 2021, 04:40 Mateusz Konieczny <em><strong>@</strong></em>.***&gt;
wrote:</p>
<blockquote>
<p>Also, we should create a CONTRIBUTING.md file that includes, at minimum,
the line length limit/guideline.</p>
<p>Can I copy also explanation from #2080 (comment)
<a href="https://github.com/BurntSushi/ripgrep/issues/2080#issue-1060244354">BurntSushi/ripgrep#2080</a> ?</p>
<p>It would be verbose, but would not trigger &quot;No, it&#x27;s not because I code on
punch cards&quot; that is triggered in me where I see some projects where it was
not changed since times when monitors were 640 x 480.</p>
<p>â€”
You are receiving this because you authored the thread.
Reply to this email directly, view it on GitHub
<a href="https://github.com/BurntSushi/ripgrep/issues/2080#issuecomment-983461301">BurntSushi/ripgrep#2080</a>,
or unsubscribe
<a href="https://github.com/notifications/unsubscribe-auth/AADPPYTRCUNLC3WRNCXL2D3UOXUPDANCNFSM5IRF5MFA">https://github.com/notifications/unsubscribe-auth/AADPPYTRCUNLC3WRNCXL2D3UOXUPDANCNFSM5IRF5MFA</a>
.
Triage notifications on the go with GitHub Mobile for iOS
<a href="https://apps.apple.com/app/apple-store/id1477376905?ct=notification-email&amp;mt=8&amp;pt=524675">https://apps.apple.com/app/apple-store/id1477376905?ct=notification-email&amp;mt=8&amp;pt=524675</a>
or Android
<a href="https://play.google.com/store/apps/details?id=com.github.android&amp;referrer=utm_campaign%3Dnotification-email%26utm_medium%3Demail%26utm_source%3Dgithub">https://play.google.com/store/apps/details?id=com.github.android&amp;referrer=utm_campaign%3Dnotification-email%26utm_medium%3Demail%26utm_source%3Dgithub</a>.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eyal0">@eyal0</a> on 2022-03-31 15:17</div>
            <div class="timeline-body"><p>How about using a warning in the GitHub Action?  The warning will attach itself to a line number.</p>
<p>Have the CI take a diff, then filter the diff just for added or modified lines.  Then look for lines that are too long.  When found, report them.</p>
<p>https://docs.github.com/en/actions/using-workflows/workflow-commands-for-github-actions#setting-a-warning-message</p>
<p>Example: <a href="https://github.com/carpentries/sandpaper/issues/50">carpentries/sandpaper#50</a></p>
<p>https://github.com/zkamvar/testme/commit/1ab80e278a57a2f038f35b74e8f2777cc3efbc62#annotation_744820416</p>
<p>https://github.com/zkamvar/testme/commit/c4589e565dd87f0181126a3a4e17811f239a5b63#</p>
<p>This will be much easier than writing a bot.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2022-03-31 15:26</div>
            <div class="timeline-body"><p>@eyal0 You&#x27;re right to question using a bot. A bot is really an implementation detail. What I want is some kind of automated process that looks at the diff in a PR, and if there is a long line, it somehow informs the PR author that they should correct it.</p>
<p>A warning in CI logs may or may not actually get that across. I would guess probably not. A bot leaving comment saying, &quot;hey please fix this&quot; seems more effective to me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eyal0">@eyal0</a> on 2022-03-31 18:50</div>
            <div class="timeline-body"><p>Depends how the warning is displayed.  Here, it seems quite prominent: https://github.com/zkamvar/testme/commit/1ab80e278a57a2f038f35b74e8f2777cc3efbc62#annotation_744820416</p>
<p>But if that isn&#x27;t prominent enough then have a CI that will check for lines and give an error when it fail.  So it would look just like this one:</p>
<p><img src="https://user-images.githubusercontent.com/109809/161127952-3c3e6306-bd20-4e53-8944-e0f423a1fc01.png" alt="image"></p>
<p>Except have another row called &quot;ci-check formatting&quot; or something like that.  It&#x27;ll give a red error &quot;x&quot; if it fails.  When you click on it it would take you to the CI output which could include the filename and line number.</p>
<p>One difficulty that I can think of is that you want this CI to not fail the entire CI.  I&#x27;m not sure how that is done but it&#x27;s likely that there is a way.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2022-03-31 19:00</div>
            <div class="timeline-body"><p>Ah I see. I don&#x27;t want to fail the build though, because <em>sometimes</em> breaking the line length is okay. See:</p>
<blockquote>
<p>In theory, it&#x27;s simple to build a tool that scans files and fails the build with the offending lines if any are over the limit. But in practice, the 79 column limit is not enforced strictly: a foolish consistency is the hobgoblin of small minds. Sometimes, code lines are more readable if they&#x27;re slightly longer. There may be other reasons to write a long line, such as a URL. Therefore, any such tool that errors on long lines also needs a whitelist, and now you have the problem of specifying how such a whitelist is stored and how it&#x27;s maintained. This is decidedly not simple and quite annoying.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2022-03-31 19:00</div>
            <div class="timeline-body"><p>Notice also that failing the build will cancel the other builds. Maybe that&#x27;s a configurable behavior, but that&#x27;s another thing I would not want to happen. (I <em>do</em> want it to happen for legit failures.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eyal0">@eyal0</a> on 2022-03-31 23:06</div>
            <div class="timeline-body"><blockquote>
<p>Notice also that failing the build will cancel the other builds. Maybe that&#x27;s a configurable behavior, but that&#x27;s another thing I would not want to happen. (I <em>do</em> want it to happen for legit failures.)</p>
</blockquote>
<p>A failing a build will cancel other builds only if you have not set <a href="https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idcontinue-on-error">continue-on-error</a>.  So what you could do is have another job that will run in GitHub Actions, in parallel to the existing CI.  It will be marked <code>continue-on-error</code>.  It will take a diff, examine for long lines, and then fail the job if a long line is found.</p>
<p>When this new job fails, it will not affect the rest of the CI.  It will, however, put that red &quot;x&quot; in the list of CI statuses.</p>
<p>This seems like a pretty good solution to me!  Is there a usability issue with it, do you think?</p>
<hr>
<p>As an aside, probably the right thing to do is use a code beautifier such as <code>rustfmt</code> and see if <code>rustfmt</code> is trying to modify any of the lines that this PR has touched.  And if so, raise an error.  And hopefully the beautifier can be configured to only care about line length.</p>
<p>The advantage to using a beautifier is that if, later on, you decide that you care about more than just line length, then you can modify the beautifier&#x27;s configuration to do that.</p>
<p>I don&#x27;t know if <code>rustfmt</code> does line length.  I didn&#x27;t find it in the <a href="https://rust-lang.github.io/rustfmt/?version=v1.4.38&amp;search=">docs</a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/eyal0">@eyal0</a> on 2022-03-31 23:07</div>
            <div class="timeline-body"><p>A red &quot;x&quot; on line length doesn&#x27;t mean that you can&#x27;t merge.  It will just draw your attention to the issue.  Then you can go examine it and see if you want to ask the author to make a correction or if you want to merge it anyway.  That&#x27;s a judgement call.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2022-04-01 02:27</div>
            <div class="timeline-body"><p>There is already CI in place to fail if rustfmt fails. The line length limit is also commonly broken on non-code files, such as in markdown files. So rustfmt is itself not sufficient.</p>
<p>What you propose is something I would be willing to try, yes. Thank you for digging into that!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:11 UTC
    </footer>
</body>
</html>
