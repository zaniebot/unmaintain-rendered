<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glob `[foo` is rejected - BurntSushi/ripgrep #3127</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Glob <code>[foo</code> is rejected</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/3127">#3127</a>
        opened by <a href="https://github.com/martinvonz">@martinvonz</a>
        on 2025-08-15 16:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/martinvonz">@martinvonz</a></div>
            <div class="timeline-body"><h3>Please tick this box to confirm you have reviewed the above.</h3>
<ul>
<li>[x] I have a different issue.</li>
</ul>
<h3>What version of ripgrep are you using?</h3>
<p>ripgrep 14.1.1</p>
<h3>How did you install ripgrep?</h3>
<p>APT</p>
<h3>What operating system are you using ripgrep on?</h3>
<p>Ubuntu</p>
<h3>Describe your bug.</h3>
<p>Glob <code>[foo</code> should be interpreted as a literal <code>[foo</code>.</p>
<h3>What are the steps to reproduce the behavior?</h3>
<ol>
<li>Run <code>rg -g '[foo' whatever</code></li>
</ol>
<h3>What is the actual behavior?</h3>
<pre><code>$ rg -g '[foo' whatever
rg: error parsing glob '[foo': unclosed character class; missing ']'
</code></pre>
<h3>What is the expected behavior?</h3>
<p>It should return matches of &quot;whatever&quot; in the file called exactly <code>[foo</code>. <code>man glob.7</code> doesn't seem to mention any invalid patterns. It seems that e.g. <code>find -name '[foo'</code> interprets it that way. Gitignores also do, apparently (this came up in https://github.com/jj-vcs/jj/issues/7259).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-08-15 17:06</div>
            <div class="timeline-body"><p><code>globset</code> doesn't conform to any known specification. And it should by default reject malformed globa like this. I reject the Unix tradition of &quot;make sense of anything.&quot; However, there should be an opt-in mode for this, if only to make <code>ignore</code> work correctly. There are 1 or 2 other bugs like this as a result of inconsistent glob implementations (like curly braces).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @BurntSushi on 2025-08-15 17:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @BurntSushi on 2025-08-15 17:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by @BurntSushi on 2025-08-15 17:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/martinvonz">@martinvonz</a> on 2025-08-15 17:18</div>
            <div class="timeline-body"><p>Thanks for the update. I don't think I myself will have time to add that mode any time soon. Hopefully someone else will. Maybe someone who's affected by it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mostafa630">@mostafa630</a> on 2025-09-11 13:25</div>
            <div class="timeline-body"><p>@BurntSushi
Hi, can I take this issue?</p>
<p>From my understanding, if the input is something like [abc, we should reject it because it represents an unclosed character class.
In this case, the characters would be treated as literals: '[', 'a', 'b'.</p>
<p>We can handle this by checking whether the remaining input contains a closing ] at start of  <code>parse_class</code> function . If not, we can return <code>ErrorKind::UnclosedClass</code> Then in the caller  when we detect that error  we could fall back to treating '[' as a literal by doing something like:</p>
<pre><code>'[' =&gt; match self.parse_class() {
    Ok(()) =&gt; {}
    Err(error) =&gt; match error.kind {
        ErrorKind::UnclosedClass =&gt; self.push_token(Token::Literal('['))?,
        _ =&gt; return Err(error),
    },
},
</code></pre>
<p>There’s a small edge case to consider: for example, if the input is [!].
Here, the class is technically closed, but its content may not be valid. We need to decide whether to treat this as an invalid class or  interpreting the characters as literals.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-11 13:30</div>
            <div class="timeline-body"><p>Sure, go for it. Remember that this should be an <em>opt-in</em> behavior though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mostafa630">@mostafa630</a> on 2025-09-12 20:22</div>
            <div class="timeline-body"><p>@BurntSushi
I’ve completed the changes for this PR: https://github.com/BurntSushi/ripgrep/pull/3145
All tests have passed. Please let me know if any further adjustments are needed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rollup</span> added by @BurntSushi on 2025-09-19 21:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2025-09-20 01:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:43:57 UTC
    </footer>
</body>
</html>
