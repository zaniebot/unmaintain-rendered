<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glob `[foo` is rejected - BurntSushi/ripgrep #3127</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Glob <code>[foo</code> is rejected</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/3127">#3127</a>
        opened by <a href="https://github.com/martinvonz">@martinvonz</a>
        on 2025-08-15 16:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/martinvonz">@martinvonz</a></div>
            <div class="timeline-body">Please tick this box to confirm you have reviewed the above.
<ul>
<li>[x] I have a different issue.</li>
</ul>
What version of ripgrep are you using?
<p>ripgrep 14.1.1</p>
How did you install ripgrep?
<p>APT</p>
What operating system are you using ripgrep on?
<p>Ubuntu</p>
Describe your bug.
<p>Glob <code>[foo</code> should be interpreted as a literal <code>[foo</code>.</p>
What are the steps to reproduce the behavior?
<ol>
<li>Run <code>rg -g &#x27;[foo&#x27; whatever</code></li>
</ol>
What is the actual behavior?
<pre><code>$ rg -g &#x27;[foo&#x27; whatever
rg: error parsing glob &#x27;[foo&#x27;: unclosed character class; missing &#x27;]&#x27;
</code></pre>
What is the expected behavior?
<p>It should return matches of &quot;whatever&quot; in the file called exactly <code>[foo</code>. <code>man glob.7</code> doesn&#x27;t seem to mention any invalid patterns. It seems that e.g. <code>find -name &#x27;[foo&#x27;</code> interprets it that way. Gitignores also do, apparently (this came up in <a href="https://github.com/jj-vcs/jj/issues/7259">jj-vcs/jj#7259</a>).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-08-15 17:06</div>
            <div class="timeline-body"><p><code>globset</code> doesn&#x27;t conform to any known specification. And it should by default reject malformed globa like this. I reject the Unix tradition of &quot;make sense of anything.&quot; However, there should be an opt-in mode for this, if only to make <code>ignore</code> work correctly. There are 1 or 2 other bugs like this as a result of inconsistent glob implementations (like curly braces).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-08-15 17:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-08-15 17:06</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">enhancement</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-08-15 17:06</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/martinvonz">@martinvonz</a> on 2025-08-15 17:18</div>
            <div class="timeline-body"><p>Thanks for the update. I don&#x27;t think I myself will have time to add that mode any time soon. Hopefully someone else will. Maybe someone who&#x27;s affected by it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mostafa630">@mostafa630</a> on 2025-09-11 13:25</div>
            <div class="timeline-body"><p>@BurntSushi
Hi, can I take this issue?</p>
<p>From my understanding, if the input is something like [abc, we should reject it because it represents an unclosed character class.
In this case, the characters would be treated as literals: &#x27;[&#x27;, &#x27;a&#x27;, &#x27;b&#x27;.</p>
<p>We can handle this by checking whether the remaining input contains a closing ] at start of  <code>parse_class</code> function . If not, we can return <code>ErrorKind::UnclosedClass</code> Then in the caller  when we detect that error  we could fall back to treating &#x27;[&#x27; as a literal by doing something like:</p>
<pre><code>&#x27;[&#x27; =&gt; match self.parse_class() {
    Ok(()) =&gt; {}
    Err(error) =&gt; match error.kind {
        ErrorKind::UnclosedClass =&gt; self.push_token(Token::Literal(&#x27;[&#x27;))?,
        _ =&gt; return Err(error),
    },
},
</code></pre>
<p>There’s a small edge case to consider: for example, if the input is [!].
Here, the class is technically closed, but its content may not be valid. We need to decide whether to treat this as an invalid class or  interpreting the characters as literals.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-11 13:30</div>
            <div class="timeline-body"><p>Sure, go for it. Remember that this should be an <em>opt-in</em> behavior though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mostafa630">@mostafa630</a> on 2025-09-12 20:22</div>
            <div class="timeline-body"><p>@BurntSushi
I’ve completed the changes for this PR: <a href="https://github.com/BurntSushi/ripgrep/pull/3145">BurntSushi/ripgrep#3145</a>
All tests have passed. Please let me know if any further adjustments are needed.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">rollup</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-19 21:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-20 01:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:14 UTC
    </footer>
</body>
</html>
