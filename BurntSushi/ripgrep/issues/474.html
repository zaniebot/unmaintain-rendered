<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ripgrep not getting all occurrences in huge file - BurntSushi/ripgrep #474</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ripgrep not getting all occurrences in huge file</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/474">#474</a>
        opened by <a href="https://github.com/grench">@grench</a>
        on 2017-05-05 11:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/grench">@grench</a></div>
            <div class="timeline-body"><p>I&#x27;m trying to get all occurrences in huge file (37GB). But it gives me not all results. How to fix it in ripgrep search?</p>
<pre><code>wc -l &lt; file_name.txt
1181551380
</code></pre>
<pre><code>rg &#x27;drive&#x27; file_name.txt  --debug -c
DEBUG:grep::search: regex ast:
Literal {
    chars: [
        &#x27;d&#x27;,
        &#x27;r&#x27;,
        &#x27;i&#x27;,
        &#x27;v&#x27;,
        &#x27;e&#x27;
    ],
    casei: false
}
DEBUG:grep::literals: literal prefixes detected: Literals { lits: [Complete(drive)], limit_size: 250, limit_class: 10 }
DEBUG:globset: built glob set; 0 literals, 1 basenames, 0 extensions, 0 prefixes, 1 suffixes, 0 required extensions, 0 regexes
5673
</code></pre>
<pre><code>grep &quot;drive&quot; file_name.txt -c
342894
</code></pre>
<p>OS: macOS 10.12.4
ripgrep 0.5.1</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-05-05 11:38</div>
            <div class="timeline-body"><p>Thanks for reporting this issue. As I said on StackOverflow, please provide enough data so that <em>others can reproduce the problem.</em> If I can&#x27;t reproduce it, then I can&#x27;t fix it. 37GB is too large, so perhaps you could shrink it down or find another file.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-05-05 11:53</div>
            <div class="timeline-body"><p>The results of searching <a href="http://opus.lingfil.uu.se/OpenSubtitles2016/mono/OpenSubtitles2016.raw.en.gz">OpenSubtitles2016.raw.en (9.3GB uncompressed)</a>:</p>
<pre><code>$ rg drive -c OpenSubtitles2016.raw.en --mmap
416327
$ rg drive -c OpenSubtitles2016.raw.en --no-mmap
416327
$ grep drive -c OpenSubtitles2016.raw.en
416327
$ sift drive -c OpenSubtitles2016.raw.en
416327
$ pt drive -c OpenSubtitles2016.raw.en
OpenSubtitles2016.raw.en:416327
$ ag drive -c OpenSubtitles2016.raw.en
475635
$ ucg drive OpenSubtitles2016.raw.en | wc -l
102088
</code></pre>
<p>Notice that <code>ag</code> and <code>ucg</code> have problems, but the rest of the tools agree.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/grench">@grench</a> on 2017-05-05 12:08</div>
            <div class="timeline-body"><p>Thanks!!! --mmap helped :) It gave correct result.  But 165 sec (sift did the same in 57 sec). I just wanted to compare.</p>
<pre><code>rg &#x27;drive&#x27; emails.txt -c --no-mmap
5673
rg &#x27;drive&#x27; emails.txt -c --mmap
342894
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-05-05 12:12</div>
            <div class="timeline-body"><p>@grench <strong>Can you please provide a file that I can search that reproduces the problem?</strong></p>
<p>The timings on a 37GB file are hard to measure. Unless you have a ton of RAM, it&#x27;s going to involve reading from disk, so you need to be very careful with your benchmarking.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/grench">@grench</a> on 2017-05-05 12:25</div>
            <div class="timeline-body"><p>Sorry ... I can-not give this file (
Physical memory: 8GB</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-05-05 12:27</div>
            <div class="timeline-body"><p>@grench I don&#x27;t need <em>that</em> file, I need <em>a</em> file the reproduces the problem. If I can&#x27;t reproduce this, then I can&#x27;t fix it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/grench">@grench</a> on 2017-05-05 12:40</div>
            <div class="timeline-body"><p>I&#x27;m using only one this big file for testing with data that I can not to upload for you to reproduce the problem (
Even if I&#x27;ll mix each line in file and zip it ... I cann&#x27;t upload so many data because of payable limited internet (</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-05-05 12:45</div>
            <div class="timeline-body"><p>I&#x27;ll try to be clearer. I don&#x27;t need the whole file. I just need something that reproduces the problem. For example, if you can find just a couple of kilobytes of this file that causes inconsistencies between ripgrep and grep, then that should be good enough. For example:</p>
<pre><code>$ head -n 1000 emails.txt &gt; emails-sample.txt
$ rg drive -c emails-sample.txt
$ grep drive -c emails-sample.txt
</code></pre>
<p>If that doesn&#x27;t reproduce the problem, then maybe try a different section of the file that has a cluster of matches found by grep. I&#x27;m asking you to be a bit creative here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/grench">@grench</a> on 2017-05-05 16:37</div>
            <div class="timeline-body"><p><code>&lt;NUL&gt;</code> in txt stop search - rg returns nothing
https://www.dropbox.com/s/b9sqgidcdr7dru9/file_name.txt?dl=0
<img alt="test" src="https://cloud.githubusercontent.com/assets/1156141/25755070/cb20edd6-31c1-11e7-8242-71f6e2f5883b.png"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-05-05 16:45</div>
            <div class="timeline-body"><p>Well, yeah, but it does for other searchers too. <code>&lt;NUL&gt;</code> causes most of these tools to detect the file as a binary file. For example:</p>
<pre><code>[andrew@Serval ~] rg com tmp/file_name.txt
[andrew@Serval ~] sift com tmp/file_name.txt 
Binary file matches: tmp/file_name.txt
[andrew@Serval ~] grep com tmp/file_name.txt 
Binary file tmp/file_name.txt matches
</code></pre>
<p>ripgrep is a bit more silent, but if you use the <code>-a</code> flag, you&#x27;ll get all your matches:</p>
<pre><code>$ rg -a com tmp/file_name.txt 
1:1234567890@gmail.com
2:1234567890@yahoo.comm
3:1234567890@yahoo.comm
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/grench">@grench</a> on 2017-05-05 19:22</div>
            <div class="timeline-body"><p>Thanks a lot!!! üëç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-05-08 21:27</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:04 UTC
    </footer>
</body>
</html>
