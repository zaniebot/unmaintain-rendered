<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excluded directories in .gitignore are ignored - BurntSushi/ripgrep #759</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Excluded directories in .gitignore are ignored</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/759">#759</a>
        opened by <a href="https://github.com/codido">@codido</a>
        on 2018-01-25 11:23
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/codido">@codido</a></div>
            <div class="timeline-body"><p>If a directory matches a pattern in .gitignore but then explicitly excluded (with &#x27;!&#x27;), its contents is still ignored by ripgrep.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-01-25 11:37</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-01-25 11:37</div>
            <div class="timeline-body"><p>@codido This bug report contains insufficient detail to be actionable. Please provide a small reproducible example. Please show all inputs, actual output and expected output. Please also include the version of ripgrep you are using.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codido">@codido</a> on 2018-01-25 11:53</div>
            <div class="timeline-body"><p>The following demonstrates the issue:</p>
<pre><code>mkdir -p test/foo
echo foobar &gt; test/foo/bar
echo &#x27;f*&#x27; &gt; test/.gitignore
echo &#x27;!foo&#x27; &gt;&gt; test/.gitignore
rg foo
</code></pre>
<p>Expected output:</p>
<pre><code>test/foo/bar
1:foobar
</code></pre>
<p>Actual output:</p>
<pre><code>No files were searched, which means ripgrep probably applied a filter you didn&#x27;t expect. Try running again with --debug.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-01-25 12:01</div>
            <div class="timeline-body"><p>This is basically a different variation of this recently reported issue: <a href="https://github.com/BurntSushi/ripgrep/issues/755">BurntSushi/ripgrep#755</a></p>
<p>The problem is that <code>f*</code> will trip on paths like <code>./test/foo/bar</code> (globs without an explicit <code>/</code> in them will permit <code>*</code> to match <code>/</code>, as per <code>man gitignore</code> semantics). In particular, your <code>!foo</code> whitelist rule works in the sense that <code>./test/foo</code> is whitelisted (you can see confirmation of this by running ripgrep with <code>--debug</code>, as indicated in the error message you got). But whitelisting <code>./test/foo</code> does not mean that <code>./test/foo/bar</code> is whitelisted.</p>
<p>You can fix this is one of two ways. In addition to the <code>!foo</code> pattern, add <code>!**/foo/**</code> (or <code>!/foo/**</code> as appropriate). This will cause your <code>test/foo/bar</code> file to get whitelisted. The other way to fix this is to make your initial ignore rule more specific. That is, use <code>**/f*</code> instead of <code>f*</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codido">@codido</a> on 2018-01-25 12:12</div>
            <div class="timeline-body"><p>@BurntSushi Thanks for elaborating on that (and of course for ripgrep :)).</p>
<p>While I can fix this in my own trees (if I ever do this), I actually ran into this in an external project. It should be noted that git is OK with these (that is, it doesn&#x27;t ignore foo/bar), as well as ag, so shouldn&#x27;t ripgrep behave the same?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-01-25 12:21</div>
            <div class="timeline-body"><p>ag should never ever be used as the gold standard for gitignore rules. If it gets this case right, it&#x27;s by accident. It gets tons of other cases wrong because it doesn&#x27;t try that hard to implement gitignore semantics correctly. (Last time I checked, it doesn&#x27;t even support glob precedence, and it just recently got minimal support for whitelisting.)</p>
<p>In order for ripgrep to &quot;behave the same,&quot; we need a specification of what <code>git</code> is actually doing. gitignore handling is <em>incredibly</em> complex, and just inventing new rules on the fly is unlikely to work well. In ripgrep&#x27;s case, we try to match the specification written in <code>man gitignore</code> precisely. If someone can manage to tweak that specification in a rigorous way that fixes a case like yours, then I might be open to exploring it further. There&#x27;s no obvious tweak that comes to mind for this case, other than something like, &quot;a higher precedent whitelist rule on a parent directory overrides a lower precedent rule on a file in that directory.&quot; But that&#x27;s trivially wrong. e.g., if you had <code>*.log</code> as a gitignore rule but <code>foo</code> as a whitelist rule, then you&#x27;d still expect <code>foo/wat.log</code> to be ignored. So there is something deeper going on here that needs to be figured out before we can fix this.</p>
<p>Note that ripgrep can never be 100% in sync with git. For example, if you have a file that is ignored but is nevertheless committed, then git will still track it but ripgrep will still ignore it.</p>
<p>In the abstract, I agree that in an ideal world, the files known to git are exactly the same as the files searched by ripgrep.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/codido">@codido</a> on 2018-01-25 12:40</div>
            <div class="timeline-body"><p>@BurntSushi Sure thing, thanks again.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-01-31 02:06</div>
            <div class="timeline-body"><p>Based on my previous comment, I&#x27;m going to close this. I&#x27;m open to alternative ideas here, but they likely need to be well researched.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-01-31 02:06</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:05 UTC
    </footer>
</body>
</html>
