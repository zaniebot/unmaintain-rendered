<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>completion/fish: Options are not completed after the first non-option argument - BurntSushi/ripgrep #1970</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>completion/fish: Options are not completed after the first non-option argument</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1970">#1970</a>
        opened by <a href="https://github.com/zx8">@zx8</a>
        on 2021-08-11 10:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/zx8">@zx8</a></div>
            <div class="timeline-body"><h4>What version of ripgrep are you using?</h4>
<p>v13.0.0</p>
<h4>How did you install ripgrep?</h4>
<p>Homebrew</p>
<h4>What operating system are you using ripgrep on?</h4>
<p>macOS</p>
<h4>Describe your bug.</h4>
<p>When using <code>fish</code>, completions cease to work after the first argument which doesn't start with a <code>-</code></p>
<h4>What are the steps to reproduce the behavior?</h4>
<pre><code class="language-sh">$ rg --&lt;TAB&gt;
# observe that options are completed

$ rg foo --&lt;TAB&gt;
# observe that options are NOT completed
</code></pre>
<h4>What is the expected behavior?</h4>
<p>Options after the first non-option argument should still be completed, since ripgrep accepts options in any order (except after an explicit <code>--</code> argument to signal the end of option arguments, of course)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-08-11 11:45</div>
            <div class="timeline-body"><p>Unfortunately I'm going to mark this as <code>wontfix</code>.</p>
<p>The problem here is that Fish auto-completions are auto-generated by ripgrep's arg parser, clap. The only manually maintained shell completions are for zsh, and it shows. They are excellent and the rest... not so much. In retrospect, I somewhat regret including auto-generated shell completions in the release, because I don't control them.</p>
<p>With respect to this particular issue, I'm going to close it, because I don't have any plan for working on it. However, I think there are two avenues for fixing this:</p>
<ol>
<li>Write a simple Rust program that reproduces the issue and file it against the Clap arg parser project. And try to get it fixed there. ripgrep will automatically benefit the next time it upgrades to the latest release of Clap.</li>
<li>Get rid of the auto-generated completions and hand-maintain them. This is what we do for zsh. I am not particularly excited about this option, but if it has the same kind of infrastructure support as the zsh completions do (excellent docs <em>and</em> testing), then I think I'd be willing to take it on.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2021-08-11 11:45</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wontfix</span> added by @BurntSushi on 2021-08-11 11:45</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zx8">@zx8</a> on 2021-08-11 13:31</div>
            <div class="timeline-body"><p>Aha... While trying to debug the cause of the issue, I found a PR that actually addresses it already (https://github.com/clap-rs/clap/pull/2359) but it seems ripgrep hasn't updated yet.</p>
<p>I'll just be patient. Thanks! üòâ</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-08-11 13:34</div>
            <div class="timeline-body"><p>Unfortunately, for the past few years, clap has been working on a v3. I don't actually even know whether that PR was merged into the v2 version or not. Either way, it doesn't matter, because there hasn't been a release of clap in almost a year: https://crates.io/crates/clap/versions --- So ripgrep can't update. The whole thing has been pretty confusing to me to be honest.</p>
<p>In any case, once clap 3 is out, I plan to migrate as long as there are no blocking issues discovered.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/zx8">@zx8</a> on 2021-08-11 13:55</div>
            <div class="timeline-body"><p>Oh wow, I wasn't aware of the release cadence situation... and the whole v2 ‚Üí v3 things sounds like the Python saga all over again. üòÅ</p>
<p>I'll patch my local completions for now while waiting for Clap to get things sorted out on the release side of things.</p>
<p>Thanks a lot for all your hard work on <code>ripgrep</code> ‚Äì my daily routine wouldn't be the same without it. üòç</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-08-11 14:03</div>
            <div class="timeline-body"><p>No it's definitely nowhere near the Python saga in terms of scale or impact. :-) The v2/v3 thing itself isn't an issue. It's just that it has been in a state of limbo for a very long time. I have zero problems doing a migration with a bunch of breaking changes. That's easy. And I don't have to live with v2 and v3 compatibility in ripgrep simultaneously. The Python saga made both of those things (migration and compatibility) very very difficult.</p>
<p>And aye, good luck with the local patching!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:43:25 UTC
    </footer>
</body>
</html>
