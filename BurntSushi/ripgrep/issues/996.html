<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latest release of globset/regex/ignore break ripgrep - BurntSushi/ripgrep #996</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Latest release of globset/regex/ignore break ripgrep</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/996">#996</a>
        opened by <a href="https://github.com/igor-raits">@igor-raits</a>
        on 2018-07-29 06:21
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/igor-raits">@igor-raits</a></div>
            <div class="timeline-body"><p>While updating crates in Fedora I noticed that ripgrep regression tests are now failing.</p>
<pre><code>---- ignore_git stdout ----
	thread &#x27;ignore_git&#x27; panicked at &#x27;
===== &quot;/builddir/build/BUILD/ripgrep-0.8.1/target/release/deps/../rg&quot; &quot;Sherlock&quot; &quot;.&quot; =====
command succeeded but expected failure!
cwd: /builddir/build/BUILD/ripgrep-0.8.1/target/release/deps/ripgrep-tests/ignore_git/70
status: exit code: 0
stdout: sherlock:For the Doctor Watsons of this world, as opposed to the Sherlock
sherlock:be, to a very large extent, the result of luck. Sherlock Holmes
stderr: 
=====
&#x27;, tests/workdir.rs:264:13
note: Run with `RUST_BACKTRACE=1` for a backtrace.
---- no_parent_ignore_git stdout ----
	thread &#x27;no_parent_ignore_git&#x27; panicked at &#x27;assertion failed: `(left == right)`
  left: `&quot;sherlock:For the Doctor Watsons of this world, as opposed to the Sherlock\nsherlock:be, to a very large extent, the result of luck. Sherlock Holmes\nwatson:For the Doctor Watsons of this world, as opposed to the Sherlock\nwatson:be, to a very large extent, the result of luck. Sherlock Holmes\n&quot;`,
 right: `&quot;sherlock:For the Doctor Watsons of this world, as opposed to the Sherlock\nsherlock:be, to a very large extent, the result of luck. Sherlock Holmes\n&quot;`&#x27;, tests/tests.rs:695:5
---- regression_127 stdout ----
	thread &#x27;regression_127&#x27; panicked at &#x27;assertion failed: `(left == right)`
  left: `&quot;foo/sherlock:For the Doctor Watsons of this world, as opposed to the Sherlock\nfoo/sherlock:be, to a very large extent, the result of luck. Sherlock Holmes\nfoo/watson:For the Doctor Watsons of this world, as opposed to the Sherlock\nfoo/watson:be, to a very large extent, the result of luck. Sherlock Holmes\n&quot;`,
 right: `&quot;foo/watson:For the Doctor Watsons of this world, as opposed to the Sherlock\nfoo/watson:be, to a very large extent, the result of luck. Sherlock Holmes\n&quot;`&#x27;, tests/tests.rs:934:5
---- regression_131 stdout ----
	thread &#x27;regression_131&#x27; panicked at &#x27;
===== &quot;/builddir/build/BUILD/ripgrep-0.8.1/target/release/deps/../rg&quot; &quot;test&quot; &quot;.&quot; =====
command succeeded but expected failure!
cwd: /builddir/build/BUILD/ripgrep-0.8.1/target/release/deps/ripgrep-tests/regression_131/96
status: exit code: 0
stdout: Top√ëapa:test
stderr: 
=====
&#x27;, tests/workdir.rs:264:13
---- regression_16 stdout ----
	thread &#x27;regression_16&#x27; panicked at &#x27;
===== &quot;/builddir/build/BUILD/ripgrep-0.8.1/target/release/deps/../rg&quot; &quot;xyz&quot; &quot;.&quot; =====
command succeeded but expected failure!
cwd: /builddir/build/BUILD/ripgrep-0.8.1/target/release/deps/ripgrep-tests/regression_16/100
status: exit code: 0
stdout: ghi/toplevel.txt:xyz
def/ghi/subdir.txt:xyz
stderr: 
=====
&#x27;, tests/workdir.rs:264:13
---- regression_65 stdout ----
	thread &#x27;regression_65&#x27; panicked at &#x27;
===== &quot;/builddir/build/BUILD/ripgrep-0.8.1/target/release/deps/../rg&quot; &quot;xyz&quot; &quot;.&quot; =====
command succeeded but expected failure!
cwd: /builddir/build/BUILD/ripgrep-0.8.1/target/release/deps/ripgrep-tests/regression_65/131
status: exit code: 0
stdout: a/bar:xyz
a/foo:xyz
stderr: 
=====
&#x27;, tests/workdir.rs:264:13
---- regression_807 stdout ----
	thread &#x27;regression_807&#x27; panicked at &#x27;assertion failed: `(left == right)`
  left: `&quot;.a/b/file:test\n.a/c/file:test\n&quot;`,
 right: `&quot;.a/c/file:test\n&quot;`&#x27;, tests/tests.rs:1246:5
---- regression_67 stdout ----
	thread &#x27;regression_67&#x27; panicked at &#x27;assertion failed: `(left == right)`
  left: `&quot;foo/bar:test\ndir/bar:test\n&quot;`,
 right: `&quot;dir/bar:test\n&quot;`&#x27;, tests/tests.rs:852:5
---- regression_87 stdout ----
	thread &#x27;regression_87&#x27; panicked at &#x27;
===== &quot;/builddir/build/BUILD/ripgrep-0.8.1/target/release/deps/../rg&quot; &quot;test&quot; &quot;.&quot; =====
command succeeded but expected failure!
cwd: /builddir/build/BUILD/ripgrep-0.8.1/target/release/deps/ripgrep-tests/regression_87/135
status: exit code: 0
stdout: foo:test
stderr: ./.gitignore: line 2: error parsing glob &#x27;**no-vcs**&#x27;: invalid use of **; must be one path component
=====
&#x27;, tests/workdir.rs:264:13
---- regression_90 stdout ----
	thread &#x27;regression_90&#x27; panicked at &#x27;
==========
command failed but expected success!
command: &quot;/builddir/build/BUILD/ripgrep-0.8.1/target/release/deps/../rg&quot; &quot;test&quot; &quot;.&quot;
cwd: /builddir/build/BUILD/ripgrep-0.8.1/target/release/deps/ripgrep-tests/regression_90/137
status: exit code: 1
stdout: 
stderr: No files were searched, which means ripgrep probably applied a filter you didn&#x27;t expect. Try running again with --debug.
==========
&#x27;, tests/workdir.rs:243:13
failures:
    ignore_git
    no_parent_ignore_git
    regression_127
    regression_131
    regression_16
    regression_65
    regression_67
    regression_807
    regression_87
    regression_90
test result: FAILED. 145 passed; 10 failed; 0 ignored; 0 measured; 0 filtered out
error: test failed, to rerun pass &#x27;--test integration&#x27;
error: Bad exit status from /var/tmp/rpm-tmp.enf08C (%check)
</code></pre>
<p>https://kojipkgs.fedoraproject.org/work/tasks/1980/28681980/build.log</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/igor-raits">@igor-raits</a> on 2018-07-29 06:22</div>
            <div class="timeline-body"><p>Just more specifically, there were following changes in buildroot for ripgrep: https://apps.fedoraproject.org/koschei/build/5071357</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-07-29 13:13</div>
            <div class="timeline-body"><p>Oof. This is #448 I think, biting me hard. One of the bug fixes in the <code>ignore</code> crate is that it no longer respects <code>.gitignore</code> when outside a git repository. Some of the tests (<code>ignore_git</code> is an easy one to inspect) don&#x27;t actually setup a <code>.git</code> repository and just create a <code>.gitignore</code>. But, since I run ripgrep&#x27;s test suite from within a git repository (and, presumably, in CI as well), the tests naturally succeed.</p>
<p>I&#x27;m going to see if I can try to make inroads on #448. Solving it perfectly might be difficult, but it occurs to me that one approach might be to create each test&#x27;s working directory in <code>/tmp</code>, which should prevent some obvious forms of state from infecting the test suite.</p>
<p>@ignatenkobrain Does that sound like a reasonable path?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/igor-raits">@igor-raits</a> on 2018-07-29 13:17</div>
            <div class="timeline-body"><p>For now I can just do git init from place I run tests.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-07-29 14:25</div>
            <div class="timeline-body"><p>@ignatenkobrain My hope is that #998 will help fix this. I don&#x27;t think this will be available to you until the next release of ripgrep (unless you want to patch in the integration test updates, yuck).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-07-29 14:41</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:07 UTC
    </footer>
</body>
</html>
