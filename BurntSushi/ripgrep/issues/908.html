<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>echo shell variable, ripgrep quit in the middle - BurntSushi/ripgrep #908</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>echo shell variable, ripgrep quit in the middle</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/908">#908</a>
        opened by <a href="https://github.com/ncaq">@ncaq</a>
        on 2018-05-03 10:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ncaq">@ncaq</a></div>
            <div class="timeline-body"><h4>What version of ripgrep are you using?</h4>
<ul>
<li>ripgrep 0.8.1 -SIMD -AVX</li>
<li>ripgrep 0.8.1 (rev 6ffb4b7466) -SIMD -AVX</li>
</ul>
<p>I checkd in both version.</p>
<h4>How did you install ripgrep?</h4>
<ul>
<li>emerge ripgrep</li>
<li>cargo build --release</li>
</ul>
<h4>What operating system are you using ripgrep on?</h4>
<p>Gentoo GNU/Linux</p>
<h4>If this is a bug, what are the steps to reproduce the behavior?</h4>
<pre><code class="language-txt">2018-05-03T19:18:02 ncaq@strawberry/pts/6(0) ~/Downloads
% ps aux &gt; ps-aux.txt
2018-05-03T19:18:07 ncaq@strawberry/pts/6(0) ~/Downloads
% rg root ps-aux.txt|wc -l
347
2018-05-03T19:18:12 ncaq@strawberry/pts/6(0) ~/Downloads
% ps_result=$(cat ps-aux.txt)
2018-05-03T19:18:20 ncaq@strawberry/pts/6(0) ~/Downloads
% echo $ps_result|rg root|wc -l
203
2018-05-03T19:18:52 ncaq@strawberry/pts/6(0) ~/Downloads
% echo $ps_result|ag root|wc -l
347
</code></pre>
<p><a href="https://github.com/BurntSushi/ripgrep/files/1970488/ps-aux.txt">ps-aux.txt</a></p>
<h4>If this is a bug, what is the actual behavior?</h4>
<pre><code class="language-txt">echo $ps_result|rg root|wc -l
</code></pre>
<pre><code class="language-txt">203
</code></pre>
<h4>If this is a bug, what is the expected behavior?</h4>
<pre><code class="language-txt">echo $ps_result|rg root|wc -l
</code></pre>
<pre><code class="language-txt">347
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-05-03 10:58</div>
            <div class="timeline-body"><p>This is a very strange bug report, and I don't really understand what it is you're doing. In any case, I can't reproduce this:</p>
<pre><code>$ rg root ps-aux.txt | wc -l
347
$ ag root ps-aux.txt | wc -l
347
$ grep root ps-aux.txt | wc -l
347
</code></pre>
<pre><code>$ ps_result=$(cat ps-aux.txt)
$ echo $ps_result | rg root | wc -l
1
$ echo $ps_result | ag root | wc -l
1
$ echo $ps_result | grep root | wc -l
1
</code></pre>
<p>Please provide more details on how to reproduce this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ncaq">@ncaq</a> on 2018-05-03 11:55</div>
            <div class="timeline-body"><p>Oh, I use zsh.</p>
<pre><code class="language-txt">% zsh --version
zsh 5.5.1 (x86_64-pc-linux-gnu)
</code></pre>
<p>I use bash, <code>wc -l</code> result to be 1.</p>
<p>I will little research this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ncaq">@ncaq</a> on 2018-05-03 12:15</div>
            <div class="timeline-body"><p>change result case of shell echo or /bin/echo.</p>
<pre><code>2018-05-03T21:08:26 ncaq@strawberry/pts/9(0) ~/Downloads
% echo $ps_result|rg root|wc -l
203
2018-05-03T21:08:56 ncaq@strawberry/pts/9(0) ~/Downloads
% /bin/echo $ps_result|rg root|wc -l
347
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-05-03 12:18</div>
            <div class="timeline-body"><p>I am able to reproduce this in zsh, and this isn't a problem with ripgrep. Here's the giveaway:</p>
<pre><code>[\u@\h \W] echo $ps_result | grep root
Binary file (standard input) matches
</code></pre>
<p>I narrowed it down to this by running <code>echo $ps_result | xxd</code> and looking for <code>NUL</code> bytes (which trip the binary file detection in both grep and ripgrep):</p>
<pre><code>$ echo &quot;/sbin/agetty -o -p -- \u --noclear tty1 linux&quot; | grep linux
Binary file (standard input) matches
</code></pre>
<p>Changing <code>\u</code> to <code>\</code> causes this to work:</p>
<pre><code>$ echo &quot;/sbin/agetty -o -p -- u --noclear tty1 linux&quot; | grep linux
/sbin/agetty -o -p -- u --noclear tty1 linux
</code></pre>
<p>I don't know anything about zsh, but from the looks of it, it's interpreting <code>\u</code> as an escape sequence of some sort and writing out a <code>NUL</code> byte.</p>
<p>According to <code>man zshbuiltins</code>, <code>\u</code> is used to insert a Unicode codepoint. <code>echo</code>'s <code>-E</code> flag can be used to disable escape sequences:</p>
<pre><code>$ echo -E &quot;/sbin/agetty -o -p -- \u --noclear tty1 linux&quot; | grep linux
/sbin/agetty -o -p -- \u --noclear tty1 linux
</code></pre>
<p>You can try other things, e.g.,</p>
<pre><code>$ echo &quot;linux \u&quot; | xxd
00000000: 6c69 6e75 7820 000a                      linux ..
</code></pre>
<p>This very clearly shows that <code>zsh</code> is replacing <code>\u</code> with <code>NUL</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2018-05-03 12:18</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-05-03 12:18</div>
            <div class="timeline-body"><p>Note that in general, the silver searcher should not be used as an oracle. It has oodles of bugs. Use grep instead. In this case, ag doesn't do binary detection.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:42:32 UTC
    </footer>
</body>
</html>
