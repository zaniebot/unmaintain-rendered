<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[Question] Can rg search a symlink to a directory that is explicitly ignored by a different name? - BurntSushi/ripgrep #1484</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>[Question] Can rg search a symlink to a directory that is explicitly ignored by a different name?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1484">#1484</a>
        opened by <a href="https://github.com/danemacmillan">@danemacmillan</a>
        on 2020-02-14 17:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/danemacmillan">@danemacmillan</a></div>
            <div class="timeline-body"><p>Hi,</p>
<h4>What version of ripgrep are you using?</h4>
<pre><code>ripgrep 11.0.2
-SIMD -AVX (compiled)
+SIMD +AVX (runtime)
</code></pre>
<h4>How did you install ripgrep?</h4>
<p>brew</p>
<h4>What operating system are you using ripgrep on?</h4>
<p>MacOS Catalina 10.15.3 (19D76)</p>
<h4>Describe your question, feature request, or bug.</h4>
<p>I have the following directory structure:</p>
<pre><code>project/releases/{dated-release-1,dated-release-2,dated-release-n}
project/current -&gt; (symlink to ./releases/dated-release-n)
</code></pre>
<p>The <code>current</code> symlink is a sibling of the <code>releases</code> directory. <code>current</code> is a symlink to one of the dated release directories contained within <code>releases</code>. Each dated release directory is just a more up to date snapshot of a codebase.</p>
<p>Given that each dated release directory is almost the same, it would be nice for <code>rg</code> to ignore them. In fact, ignore all of them. The only dated release directory I'm interested in is the one symlinked to <code>current</code>.</p>
<p>The problem I'm having is that specifying an ignore rule for the <code>releases</code> directory also prevents the <code>current</code> symlink and its contents from being searched. I think I understand why this would happen.</p>
<p>Is it possible to search under the <code>current</code> symlink while ignoring all the <code>releases</code>'s dated release directories? I realize this is a paradox of sorts, so I'm asking in the off chance I overlooked this in the documentation.</p>
<p>To be clear, <code>rg</code> is being invoked with the ability to follow symlinks, and does work when the ignore rule is removed.</p>
<p>Thanks!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-02-14 18:13</div>
            <div class="timeline-body"><p>In the future, could you please include more details in your bug report? In particular, please <strong>show</strong> your problem rather than just describing it. e.g., Instead of &quot;The problem I'm having is that specifying an ignore rule for the releases directory also prevents the current symlink and its contents from being searched.&quot;, please show exactly what you tried.</p>
<p>For example:</p>
<pre><code>$ mkdir /tmp/ripgrep-1484
$ cd /tmp/ripgrep-1484
$ mkdir -p project/releases/{dated-release-1,dated-release-2,dated-release-n}
$ ln -s project/releases/dated-release-n current
$ touch project/releases/dated-release-{1,2,n}/test
$ tree
.
├── current -&gt; project/releases/dated-release-n
└── project
    └── releases
        ├── dated-release-1
        │   └── test
        ├── dated-release-2
        │   └── test
        └── dated-release-n
            └── test

6 directories, 3 files

$ rg --files
project/releases/dated-release-2/test
project/releases/dated-release-1/test
project/releases/dated-release-n/test

$ rg --files -L
current/test
project/releases/dated-release-n/test
project/releases/dated-release-1/test
project/releases/dated-release-2/test

$ echo '/project/releases' &gt; .ignore

$ rg --files -L
current/test
</code></pre>
<p>Which seems to do exactly what you want.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @BurntSushi on 2020-02-14 18:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/danemacmillan">@danemacmillan</a> on 2020-02-14 20:23</div>
            <div class="timeline-body"><p>Will do--I'll keep that in mind for the future.</p>
<p>After noticing your example worked, I dug deeper. While my custom ignore file was being overlooked, the <code>.ignore</code> file in the example directory at <code>/project/releases/.ignore</code> was working. My custom ignore file contained the same content, though, so it should have gotten ignored at that point, instead of getting detected by the inline <code>.ignore</code> file.</p>
<p>I have a <code>RIPGREP_CONFIG_PATH</code> environment variable set; its contents were:</p>
<pre><code>--hidden
--search-zip
--smart-case
--ignore-vcs
--ignore-file=$XDG_CONFIG_HOME/ripgrep/ignore
</code></pre>
<p>The contents of the <code>$XDG_CONFIG_HOME/ripgrep/ignore</code> file are:</p>
<pre><code>releases
</code></pre>
<p>I would then run the following command on the example structure:</p>
<pre><code>rg --files -L
</code></pre>
<p>The output would still list:</p>
<pre><code>current/test
project/releases/dated-release-n/test
project/releases/dated-release-1/test
project/releases/dated-release-2/test
</code></pre>
<p>I then tried differing paths for the <code>--ignore-file</code> option, one at a time:</p>
<pre><code>--ignore-file=~/.config/ripgrep/ignore
--ignore-file=&quot;$HOME/.config/ripgrep/ignore&quot;
</code></pre>
<p>I then tried passing the option to <code>rg</code> directly:</p>
<pre><code>rg --files -L --ignore-file=$XDG_CONFIG_HOME/ripgrep/ignore
</code></pre>
<p>That worked. The <code>releases</code> directory was ignored, while the <code>current</code> symlink content was being shown. Great.</p>
<p>That got me thinking about environment variables, so I tried an absolute path in the config—<em>and it worked</em>:</p>
<pre><code>--ignore-file=/Users/danemacmillan/.config/ripgrep/ignore
</code></pre>
<p>My takeaway from this is that environment variables are not understood when used in the <code>RIPGREP_CONFIG_PATH</code> config file. Is that right?</p>
<p>I don't know if this is something you'd want to support, but I'll propose it for your consideration.</p>
<p>Thanks a bunch for helping me through this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-02-14 20:39</div>
            <div class="timeline-body"><blockquote>
<p>My takeaway from this is that environment variables are not understood when used in the RIPGREP_CONFIG_PATH config file. Is that right?</p>
</blockquote>
<p>Correct. In particular, from the <a href="https://github.com/BurntSushi/ripgrep/blob/master/GUIDE.md#configuration-file">section on config files in the GUIDE</a>:</p>
<blockquote>
<p>In particular, there is no escaping. Each line is given to ripgrep as a single command line argument verbatim.</p>
</blockquote>
<p>The config format is deliberately simplistic. While it does prevent some conveniences like environment variables, it makes the file very easy to read with no additional layer of escaping. e.g., If environment variables were supported then there would need to be some sort of escaping mechanism to permit literals of the form <code>$var</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2020-02-14 20:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @BurntSushi on 2020-02-14 20:39</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">invalid</span> added by @BurntSushi on 2020-02-14 20:39</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:43:05 UTC
    </footer>
</body>
</html>
