<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automatically ignore other git worktrees? - BurntSushi/ripgrep #2492</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Automatically ignore other git worktrees?</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2492">#2492</a>
        opened by <a href="https://github.com/jeanas">@jeanas</a>
        on 2023-04-17 20:36
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jeanas">@jeanas</a></div>
            <div class="timeline-body">Describe your feature request
<p>When ran inside a Git repository, I would appreciate if ripgrep could only reports results from that worktree, but not from other worktrees that may be inside it. This is the behavior of <code>git grep</code>:</p>
<pre><code>~/repos/lilypond $ git grep &quot;parse_embedded_scheme&quot;
lily/include/parse-scm.hh:31:SCM parse_embedded_scheme (const Input &amp;start, Lily_parser *parser,
lily/lexer.ll:364:      SCM sval = parse_embedded_scheme (start, parser_, &amp;parsed);
lily/lexer.ll:413:      SCM sval = parse_embedded_scheme (hi, parser_, &amp;parsed);
lily/lexer.ll:429:      SCM sval = parse_embedded_scheme (hi, parser_, &amp;parsed);
lily/parse-scm.cc:214:internal_parse_embedded_scheme (void *p)
lily/parse-scm.cc:268:parse_embedded_scheme (const Input &amp;start, Lily_parser *parser,
lily/parse-scm.cc:274:  SCM result = scm_c_catch (SCM_BOOL_T, internal_parse_embedded_scheme, &amp;ps,
~/repos/lilypond $ rg &quot;parse_embedded_scheme&quot;
lily/parse-scm.cc
214:internal_parse_embedded_scheme (void *p)
268:parse_embedded_scheme (const Input &amp;start, Lily_parser *parser,
274:  SCM result = scm_c_catch (SCM_BOOL_T, internal_parse_embedded_scheme, &amp;ps,

lily/include/parse-scm.hh
31:SCM parse_embedded_scheme (const Input &amp;start, Lily_parser *parser,

master/lily/lexer.ll
364:	SCM sval = parse_embedded_scheme (start, parser_, &amp;parsed);
413:	SCM sval = parse_embedded_scheme (hi, parser_, &amp;parsed);
429:	SCM sval = parse_embedded_scheme (hi, parser_, &amp;parsed);

lily/lexer.ll
364:	SCM sval = parse_embedded_scheme (start, parser_, &amp;parsed);
413:	SCM sval = parse_embedded_scheme (hi, parser_, &amp;parsed);
429:	SCM sval = parse_embedded_scheme (hi, parser_, &amp;parsed);

master/lily/include/parse-scm.hh
31:SCM parse_embedded_scheme (const Input &amp;start, Lily_parser *parser,

master/lily/parse-scm.cc
214:internal_parse_embedded_scheme (void *p)
268:parse_embedded_scheme (const Input &amp;start, Lily_parser *parser,
274:  SCM result = scm_c_catch (SCM_BOOL_T, internal_parse_embedded_scheme, &amp;ps,
</code></pre>
<p>I frequently use worktrees for things like performance comparisons of a feature branch to the master/main branch. When I use <code>rg</code>, I just want to search the code base (under the version I&#x27;m working on), but not get duplicated search results from other (a bit different) copies of the same source code.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2023-04-17 20:46</div>
            <div class="timeline-body"><p>Please provide a way to reproduce the behavior today that you don&#x27;t want, and then please show the behavior that you do want. Someone else (i.e., me) should be able to run the same commands.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jeanas">@jeanas</a> on 2023-04-17 20:59</div>
            <div class="timeline-body"><p>Here you go:</p>
<pre><code>$ mkdir git-repo
$ cd git-repo
$ echo &quot;abcdef&quot; &gt; file.txt
$ git init
[...]
$ git add file.txt
$ git commit -m &quot;Commit&quot;
[...]
$ git worktree add new-branch
[...]
$ git grep &quot;abc&quot;
file.txt:1:abcdef
$ rg &quot;abc&quot;
new-branch/file.txt
1:abcdef

file.txt
1:abcdef
</code></pre>
<p>Actual behavior: <code>rg &quot;abc&quot;</code> lists matches from <code>file.txt</code> and <code>new-branch/file.txt</code>. Desired behavior: <code>rg &quot;abc&quot;</code> only matches <code>file.txt</code>, like <code>git grep</code>, since <code>new-branch/file.txt</code> is from a different worktree.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2023-04-17 21:09</div>
            <div class="timeline-body"><p>Thank you, that makes it much clearer. I&#x27;m not sure automatically ignoring these is the right approach. It seems somewhat surprising to do so, especially since the worktree might have different contents than its &quot;primary&quot; checkout.</p>
<p>I think I&#x27;d rather see you use <code>.rgignore</code> to specifically and explicitly ignore these worktrees.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jeanas">@jeanas</a> on 2023-04-17 21:32</div>
            <div class="timeline-body"><p>Personally, I view the worktree as a totally different mental space — that&#x27;s why I&#x27;m rather surprised that ripgrep does <em>not</em> automatically ignore it.</p>
<p>I could as well have put that worktree outside of my main work directory for practical reasons. Do you see what I mean? It&#x27;s hard to explain why something feels &quot;intuitively&quot; bizarre, but this is really the feeling I have. It&#x27;s like files ignored by Git — when I do <code>rg pat</code>, I expect to see occurrences of <code>pat</code> in the code base I&#x27;m working on, as if I were using a graphical code search tool, but without noise from either build files or parallel versions of the code.</p>
<p>Also, it would match <code>git grep</code> better.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2023-11-22 01:11</div>
            <div class="timeline-body"><p>I thought about this and I think the juice isn&#x27;t worth the squeeze.</p>
<p>Firstly, it&#x27;s not totally obvious to me that the default behavior <em>ought</em> to be to not search these sub-directories. ripgrep already searches git repos within git repos (a common setup when <code>$HOME</code> is a git checkout). I admit that reasonable people could disagree, and in theory a flag could be added for folks to opt into this.</p>
<p>But secondly, I think it should be pretty straight-forward to &quot;work around&quot; this instead of adding a flag to ripgrep. This is what things like <code>.rgignore</code> are for.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2023-11-22 01:11</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wontfix</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2023-11-22 01:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:13 UTC
    </footer>
</body>
</html>
