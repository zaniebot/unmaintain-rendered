<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>stdin is not searched if it is a directory - BurntSushi/ripgrep #2906</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>stdin is not searched if it is a directory</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2906">#2906</a>
        opened by <a href="https://github.com/lolbinarycat">@lolbinarycat</a>
        on 2024-09-30 03:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lolbinarycat">@lolbinarycat</a></div>
            <div class="timeline-body">Please tick this box to confirm you have reviewed the above.
<ul>
<li>[X] I have a different issue.</li>
</ul>
What version of ripgrep are you using?
<p>ripgrep 13.0.0
-SIMD -AVX (compiled)
+SIMD -AVX (runtime)</p>
How did you install ripgrep?
<p>nix-inst ripgrep</p>
<p>https://codeberg.org/binarycat/nix-inst</p>
What operating system are you using ripgrep on?
<p>NixOS 24.05 (Uakari)</p>
Describe your bug.
<p>if stdin is a directory, ripgrep acts like it is a terminal</p>
What are the steps to reproduce the behavior?
<p>rg a &lt; some_dir</p>
What is the actual behavior?
<p>if stdin is a directory, ripgrep acts like it is a terminal</p>
What is the expected behavior?
<p>ripgrep recurses into stdin</p>
<p>yes this is kinda a weird request, but it&#x27;s useful for quick scripts that wrap rg, with no way to pass file arguments to rg.</p>
<p>filing this as a bug because although i can&#x27;t find any docs that say &quot;ripgrep searches stdin unless it is a terminal&quot;, they probably should exist.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lolbinarycat">@lolbinarycat</a> on 2024-09-30 03:12</div>
            <div class="timeline-body"><p>if this is too niche to spend your time fixing, i am a rust developer and would be willing to fix this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">doc</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-09-30 03:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-09-30 03:25</div>
            <div class="timeline-body"><p>I don&#x27;t understand the use case. You mention quick wrapper scripts, but I don&#x27;t really get it. I write lots of wrapper scripts, and it&#x27;s easy to forward arguments from the wrapper script to a command run by that wrapper script.</p>
<p>You don&#x27;t mention the expected behavior here. I guess you&#x27;re expecting ripgrep to search it as if it were just a directory provided as an argument? Do other Unix commands do this? I&#x27;ve never seen this usage pattern before.</p>
<p>The way ripgrep works is that it looks for something resembling a file on stdin to search. And if it can&#x27;t find a file (which it can&#x27;t in this case), it searches the current working directory. This is actually a heuristic and this heuristic has caused lots of problems because it&#x27;s common for things to pass something that looks like a file on stdin even when it&#x27;s not really intended. So I&#x27;m very hesitant to change that heuristic. And your suggesting here would add a third case to that heuristic.</p>
<p>I think at best the docs can be improved. The man page already mentions this behavior, although I suppose it could be slightly more precise to cover this case. But I&#x27;m not even sure this is worth doing because this seems so idiosyncratic to me. Maybe you can elaborate more.</p>
<blockquote>
<p>if this is too niche to spend your time fixing, i am a rust developer and would be willing to fix this.</p>
</blockquote>
<p>Note that it&#x27;s not just the initial effort here. It&#x27;s also the ongoing maintenance burden that stuff like this adds. Especially to what is already a finicky heuristic.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lolbinarycat">@lolbinarycat</a> on 2024-09-30 04:15</div>
            <div class="timeline-body"><blockquote>
<p>I don&#x27;t understand the use case. You mention quick wrapper scripts, but I don&#x27;t really get it. I write lots of wrapper scripts, and it&#x27;s easy to forward arguments from the wrapper script to a command run by that wrapper script.</p>
</blockquote>
<p>yes, unless all those arguments are already used for something (eg. constructing the regex to search with)</p>
<blockquote>
<p>You don&#x27;t mention the expected behavior here. I guess you&#x27;re expecting ripgrep to search it as if it were just a directory provided as an argument?</p>
</blockquote>
<p>yes, that&#x27;s what &quot;recurses into&quot; means</p>
<blockquote>
<p>Do other Unix commands do this? I&#x27;ve never seen this usage pattern before.</p>
</blockquote>
<p>unix commands don&#x27;t typically change behavior based on the type of stdin.  they sometime do for stdout, but usually just for terminal colors or automatically invoking a pager.</p>
<p>usually they just crash if any stdio is a directory, not silently ignore it.</p>
<blockquote>
<p>The way ripgrep works is that it looks for something resembling a file on stdin to search. And if it can&#x27;t find a file (which it can&#x27;t in this case), it searches the current working directory. This is actually a heuristic and this heuristic has caused lots of problems because it&#x27;s common for things to pass something that looks like a file on stdin even when it&#x27;s not really intended. So I&#x27;m very hesitant to change that heuristic. And your suggesting here would add a third case to that heuristic.</p>
</blockquote>
<p>I was under the impression it just checked if stdin was a pty, and if not, treats it like it was passed as an argument.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-09-30 11:38</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-09-30 11:38</div>
            <div class="timeline-body"><blockquote>
<p>yes, that&#x27;s what &quot;recurses into&quot; means</p>
</blockquote>
<p>Ah sorry I missed this.</p>
<blockquote>
<p>unix commands don&#x27;t typically change behavior based on the type of stdin. they sometime do for stdout, but usually just for terminal colors or automatically invoking a pager.</p>
<p>usually they just crash if any stdio is a directory, not silently ignore it.</p>
</blockquote>
<p>ripgrep isn&#x27;t without precedent here, but yes, one of the downsides of messing around with stdin like this is that there are indeed some cases where ripgrep will ignore what&#x27;s on stdin and search the current working directory. This is why in ripgrep 14, I introduced some logging messages (that appear when you pass <code>--debug</code>) that give a little more insight into what&#x27;s happening.</p>
<blockquote>
<p>I was under the impression it just checked if stdin was a pty, and if not, treats it like it was passed as an argument.</p>
</blockquote>
<p>No, it&#x27;s more complicated than that. Whether it&#x27;s a pty or not is a minimum criteria:</p>
<p>https://github.com/BurntSushi/ripgrep/blob/bf63fe8f258afc09bae6caa48f0ae35eaf115005/crates/cli/src/lib.rs#L170-L250</p>
<p>I&#x27;ve pushed a wording change to the man page to cover this case.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:14 UTC
    </footer>
</body>
</html>
