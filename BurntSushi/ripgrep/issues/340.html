<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Do not ignore hidden files that are tracked by git. - BurntSushi/ripgrep #340</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Do not ignore hidden files that are tracked by git.</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/340">#340</a>
        opened by <a href="https://github.com/anntzer">@anntzer</a>
        on 2017-01-23 05:58
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/anntzer">@anntzer</a></div>
            <div class="timeline-body"><p>It looks like neither of <code>-u</code>, <code>-uu</code>, and <code>-uuu</code> allow &quot;search exactly the files that git is tracking, including the hidden ones&quot; (i.e., <code>git grep</code>).  If this is correct, could you consider adding this possibility?
Thanks in advance.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-01-23 10:33</div>
            <div class="timeline-body"><p>Could you please provide a test case and describe expected output versus actual output?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/anntzer">@anntzer</a> on 2017-01-23 17:32</div>
            <div class="timeline-body"><pre><code>#!/bin/sh
git init /tmp/tmprepo
cd /tmp/tmprepo
echo ignoredfile &gt;.gitignore
echo foo &gt;normalfile
echo foo &gt;.hiddenfile
echo foo &gt;ignoredfile

echo &#x27;rg -l:&#x27;
rg -l foo

echo &#x27;rg -l -u:&#x27;
rg -l -u foo

echo &#x27;rg -l -uu:&#x27;
rg -l -uu foo

echo &#x27;rg -l -uuu:&#x27;
rg -l -uuu foo
</code></pre>
<p>outputs</p>
<pre><code>rg -l:
normalfile
rg -l -u:
ignoredfile
normalfile
rg -l -uu:
ignoredfile
.hiddenfile
normalfile
rg -l -uuu:
ignoredfile
.hiddenfile
normalfile
</code></pre>
<p>so, as far as I can see, there is no way to have normalfile and .hiddenfile but not ignoredfile.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-01-23 18:08</div>
            <div class="timeline-body"><p>I don&#x27;t see your <strong>expected</strong> output anywhere. What do you expect to see?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-01-23 18:08</div>
            <div class="timeline-body"><blockquote>
<p>so, as far as I can see, there is no way to have normalfile and .hiddenfile but not ignoredfile.</p>
</blockquote>
<p>I don&#x27;t understand. Why doesn&#x27;t <code>rg foo --hidden</code> work for you? It prints <code>.hiddenfile</code> and <code>normalfile</code> for me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/anntzer">@anntzer</a> on 2017-01-23 18:14</div>
            <div class="timeline-body"><p>My expected output was some flag that would return <code>.hiddenfile</code> and <code>normalfile</code>, but as you mention, <code>--hidden</code> is indeed the correct flag -- my bad.
I would suggest adding a mention of this option next to <code>-u</code>, especially as <code>-u</code> is listed in the &quot;COMMON OPTIONS&quot; section of the man page but not <code>--hidden</code>.
Feel free to close this.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">doc</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-01-23 18:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-01-23 18:15</div>
            <div class="timeline-body"><p>Docs can definitely be clearer. I&#x27;ll mark this as a doc bug. Thank you. :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/anntzer">@anntzer</a> on 2017-01-24 07:24</div>
            <div class="timeline-body"><p>Ah, but I noticed that <code>--hidden</code> includes <code>.git</code> in the search:</p>
<pre><code>#!/bin/sh
git init /tmp/tmprepo
cd /tmp/tmprepo
rg --hidden Unnamed
</code></pre>
<p>outputs</p>
<pre><code>Initialized empty Git repository in /tmp/tmprepo/.git/
.git/description
1:Unnamed repository; edit this file &#x27;description&#x27; to name the repository.

.git/hooks/update.sample
55:&quot;Unnamed repository&quot;* | &quot;&quot;)
</code></pre>
<p>but the contents of <code>.git</code> should probably be ignored unless some number of <code>-u</code> is passed?  (Not sure what makes the most sense here.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-01-24 10:41</div>
            <div class="timeline-body"><p>It&#x27;s working as intended. --hidden removes the hidden filter and therefore
shows the .git directory. If you want to ignore it, then add it to an
.ignore file.</p>
<p>On Jan 24, 2017 2:24 AM, &quot;Antony Lee&quot; <a href="mailto:notifications@github.com">notifications@github.com</a> wrote:</p>
<blockquote>
<p>Ah, but I noticed that --hidden includes .git in the search:</p>
<p>#!/bin/sh
git init /tmp/tmprepo
cd /tmp/tmprepo
rg --hidden Unnamed</p>
<p>outputs</p>
<p>Initialized empty Git repository in /tmp/tmprepo/.git/
.git/description
1:Unnamed repository; edit this file &#x27;description&#x27; to name the repository.</p>
<p>.git/hooks/update.sample
55:&quot;Unnamed repository&quot;* | &quot;&quot;)</p>
<p>but the contents of .git should probably be ignored unless some number of
-u is passed? (Not sure what makes the most sense here.)</p>
<p>â€”
You are receiving this because you commented.
Reply to this email directly, view it on GitHub
<a href="https://github.com/BurntSushi/ripgrep/issues/340#issuecomment-274728726">BurntSushi/ripgrep#340</a>,
or mute the thread
<a href="https://github.com/notifications/unsubscribe-auth/AAb34mvqwuqRjT-lyKKYEc8BdvfJ2LMuks5rVac4gaJpZM4Lqr_f">https://github.com/notifications/unsubscribe-auth/AAb34mvqwuqRjT-lyKKYEc8BdvfJ2LMuks5rVac4gaJpZM4Lqr_f</a>
.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/anntzer">@anntzer</a> on 2017-01-24 11:11</div>
            <div class="timeline-body"><p>Obviously <code>rg --hidden</code> can have whatever semantics <em>you</em> decide, but it seems a bit strange that (when in a git repo) it would mean &quot;search all nonbinary files that <em>either</em> are tracked by git (including hidden ones), <em>or</em> are in .git/&quot;.  It would seem more reasonable to have</p>
<p>no flag: search all nonbinary, nonhidden files that are tracked by git
--hidden: search all nonbinary files that are tracked by git
-u: search all nonbinary, nonhidden files, without caring about git (so including .git/)
-u --hidden: search all nonbinary files, without caring about git (so including .git/)</p>
<p>-uu seems equivalent to -u --hidden, by the way.  I don&#x27;t know how much you care about backcompat, but if you want the flags to be orthogonal to each other perhaps you can remove -uuu and let the new -uu correspond to the old -uuu (as the old -uu is covered by -u --hidden).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-01-24 12:06</div>
            <div class="timeline-body"><blockquote>
<p>it would mean &quot;search all nonbinary files that either are tracked by git (including hidden ones), or are in .git/&quot;</p>
</blockquote>
<p>But that&#x27;s not what it means. <code>--hidden</code> simply means &quot;search hidden files.&quot; The <code>--hidden</code> flag is orthogonal to whether a file is tracked by <code>git</code> or not.</p>
<blockquote>
<p>-uu seems equivalent to -u --hidden, by the way.</p>
</blockquote>
<p>Yes. The <code>-u</code> flags are aliases. <code>-u</code> is <code>--no-ignore</code>, <code>-uu</code> is <code>--no-ignore --hidden</code> and <code>-uuu</code> is <code>--no-ignore --hidden -a</code>.</p>
<blockquote>
<p>no flag: search all nonbinary, nonhidden files that are tracked by git</p>
</blockquote>
<p>This seems to be the core of your suggestion. Unfortunately, ripgrep doesn&#x27;t operate based on what&#x27;s tracked in git, but rather, what&#x27;s in your gitignore files. Therefore, it is inherently imperfect.</p>
<p>The intended solution here is to either whitelist specific hidden files that you want searched, or to pass <code>--hidden</code> and blacklist files you don&#x27;t want searched. That&#x27;s the point of <code>.ignore</code> files: it provides a way to override default behavior if the default behavior is undesirable.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/anntzer">@anntzer</a> on 2017-01-24 16:00</div>
            <div class="timeline-body"><p>Ah, I see, rg operates in a world where there is no knowledge of git, but there just happens to be already written .ignore files that are called &quot;.gitignore&quot;.  I guess that&#x27;s fine (especially as I can .ignore .git/ from my $HOME as you suggest), just a bit... unexpected, at least for me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bdarfler">@bdarfler</a> on 2017-02-18 18:13</div>
            <div class="timeline-body"><p>I came across this exact issue while trying to come up with a solid set of flags to use with <code>ctrlp</code> in vim. I ended up settling on <code>rg --hidden --glob &#x27;!.git&#x27;</code> which does what I want and, since it lives in my <code>.vimrc</code>, I don&#x27;t mind the verbosity. I do think it&#x27;s surprising to find <code>rg</code> searching through the <code>.git</code> directory but I can also understand the mental model of <code>rg</code> not wanting to be &quot;git aware&quot; or any other VCS for that matter.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-02-18 18:56</div>
            <div class="timeline-body"><p>@bdarfler <code>rg</code> <em>is</em> git aware though. It knows how to read <code>.gitignore</code> files and implements the rules described in <code>man gitignore</code>, including knowing to read your <code>$HOME/.gitconfig</code>. The problem here is that you&#x27;re passing the <code>--hidden</code> flag, which says, &quot;search hidden files and directories.&quot; That includes <code>.git</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bdarfler">@bdarfler</a> on 2017-02-18 19:05</div>
            <div class="timeline-body"><p>Thanks, I wasn&#x27;t being as clear as I could have been. I just wanted to point out that this seems to be a common use case and it might be nice to have a flag for it. However, there is an easy enough workaround. Thanks for the awesome tool!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-02-18 19:14</div>
            <div class="timeline-body"><p>@bdarfler Fair enough. There are two other possibilities. One is to create an alias, e.g., <code>alias rg=&quot;rg --hidden -g &#x27;!.git&#x27;&quot;</code>. Another is to encode the rules into an <code>.ignore</code> file. e.g.,</p>
<pre><code>$ cat $HOME/.config/ripgrep/ignore
!.*
.git
</code></pre>
<p>and then use <code>rg --ignore-file $HOME/.config/ripgrep/ignore</code> (and perhaps create an alias).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/bdarfler">@bdarfler</a> on 2017-02-18 19:17</div>
            <div class="timeline-body"><p>Cool! My primary use case is for <code>ctrlp</code> fuzzy finding in vim so I just tuck the <code>rg --hidden -g &#x27;!.git&#x27;</code> away in my <code>.vimrc</code> and that is sufficient for me.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-03-13 00:25</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tombh">@tombh</a> on 2017-04-18 02:00</div>
            <div class="timeline-body"><p>Sorry to bring this back up, but just to add that I&#x27;m in the <code>ctrlp</code> situation as well and also using @bdarfler&#x27;s fix (thanks). Maybe this reinforces the idea that expecting <code>--hidden</code> to also ignore <code>.git/</code> is a very specific use case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-04-19 12:10</div>
            <div class="timeline-body"><p>@tombh Right. Especially if this is a config knob inside of some vim plugin somewhere. Having to use <code>--hidden -g&#x27;!.git&#x27;</code> seems fine in that case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mgeisler">@mgeisler</a> on 2017-09-18 15:37</div>
            <div class="timeline-body"><p>Let me just add that I had exactly the same expectation as @anntzer: I expected <code>rg</code> to keep ignoring files ignored by Git (and thus not recurse into <code>.git/</code>) when <code>--hidden</code> is used.</p>
<p>That <code>rg --hidden</code> includes files inside <code>.git/</code> is technically correct since <code>.git/</code> isn&#x27;t mentioned in any of my <code>.gitignore</code> files. The reason is of course that Git knows to ignore the directory by default :smiley:</p>
<p>I solved it by creating a <code>~/.ignore</code> file with the following:</p>
<pre><code>.git/
.hg/
.svn/
</code></pre>
<p>That makes <code>--hidden</code> work the way I had expected it to work in the first place.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mshkrebtan">@mshkrebtan</a> on 2019-08-07 16:17</div>
            <div class="timeline-body"><p>So, I came up with the following configuration in my <code>.vimrc</code>:</p>
<pre><code>if executable(&#x27;rg&#x27;)
  let g:ctrlp_use_caching = 0
  let g:ctrlp_user_command = &#x27;rg --files --no-ignore --ignore-file ~/.config/ripgrep/ignore --hidden %s&#x27;
  let g:ackprg = &#x27;rg --vimgrep --no-ignore --ignore-file ~/.config/ripgrep/ignore --hidden&#x27;
endif
</code></pre>
<p>This allows me to open and search through hidden files, even if they are in <code>.gitignore</code>.</p>
<p>But then I set an ignore file which has <code>**/.git/*</code>, <code>**/.terraform/*</code>, <code>[._]*.sw[a-p]</code> and so on, so that I do not see a <code>.filename.swp</code> in my CtrlP list and ack.vim does not perform search in <code>.terraform</code> directories.</p>
<p>Works like a charm! Thank you, @BurntSushi!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:03 UTC
    </footer>
</body>
</html>
