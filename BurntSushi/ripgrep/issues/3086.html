<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>When using the `--replace` option, add a way to display the pre-replacement text but in a different colour. - BurntSushi/ripgrep #3086</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>When using the <code>--replace</code> option, add a way to display the pre-replacement text but in a different colour.</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/3086">#3086</a>
        opened by <a href="https://github.com/IsaacOscar">@IsaacOscar</a>
        on 2025-07-04 07:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/IsaacOscar">@IsaacOscar</a></div>
            <div class="timeline-body"><p>Consider the following example file:</p>
<pre><code>$ cat file
hello
world
</code></pre>
<p>And the following ripgrep command:</p>
<pre><code>$rg --colors match:fg:green --multiline  --replace $&#x27;O\nW&#x27;  $&#x27;o\nw&#x27;  file
1:hellO
2:World
</code></pre>
<p>Basically it capitalises the &#x27;o&#x27; and the end of hello and the &#x27;W&#x27; at the start of &#x27;World&#x27;, and highlights them in <em>green</em>. (I&#x27;m using multiline search and replacement strings as colouring them nicely isn&#x27;t easy)</p>
<p>What I want is to also show the original match but highlight it in a different colour. For example, something like this:</p>
<pre><code>$  rg --multiline  --replace $&#x27;O\nW&#x27; $&#x27;o\nw&#x27; file | git diff --color-words=. file -
diff --git a/file b/-
index 94954ab..0000000 100644
--- a/file
+++ b/-
@@ -1,2 +1,2 @@
hello
wO
World
</code></pre>
<p>Where the lowercase &#x27;o and w&#x27; are <em>red</em>, and the uppercase O and W are <em>green</em>.
(Obviously I don&#x27;t want ripgrep to output all the diff format stuff like &#x27;diff - ... and index&#x27;)</p>
<p>I found a hacky way to do this with a bash function <code>colour</code>, where instead of <code>--replace &lt;replacement&gt;</code> you use <code>--replace &quot;$(colour &lt;replacement&gt;)&quot;</code>:</p>
<pre><code>$ function colour {
	NL=$&#x27;\n&#x27;
	GREEN=$&#x27;\e[32m&#x27;
	NORM=$&#x27;\e[m&#x27;

	# In the following, the \$0 will output the entire match (prior to replacement)
	# the $GREEN ensures the first line of the displayed replacement text is green
	# and the ${1//$NL/$NL$GREEN} outputs the replacement text, but ensuring that each newline is also green
	# finally, $NORM restores the colour
	printf &quot;\$0$GREEN${1//$NL/$NL$GREEN}$NORM&quot;
}
$ rg  --multiline --replace &quot;$(colour $&#x27;O\nW&#x27;)&quot; $&#x27;o\nw&#x27; file
1:hello
2:wO
3:World
</code></pre>
<p>Where the lowercase &#x27;o and w&#x27; are <em>red</em>, and the uppercase O and W are <em>green</em>.</p>
<p>So perhaps <code>--colors</code> can be extended to support something like <code>--colors=original:fg:red</code> that does the same thing? (and if you don&#x27;t provide a <code>original:</code> format it doesn&#x27;t output the original text at all).</p>
<p>It would probably better display the output in two lines like this:</p>
<pre><code>1:helloO
3:wWorld
</code></pre>
<p>But I don&#x27;t think I can do that using a bash function.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wontfix</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-07-04 10:07</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-07-04 10:07</div>
            <div class="timeline-body"><p>I don&#x27;t think this is a good fit for ripgrep. Its replacement functionality is meant to be simple and stay simple. I have resisted extending it with more options, and this is the kind of thing that is likely to want more configurability.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-07-04 10:07</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:14 UTC
    </footer>
</body>
</html>
