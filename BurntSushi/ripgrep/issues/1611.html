<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ripgrep doesn't apply .gitignore when following a symlink to a subdirectory of a git repo - BurntSushi/ripgrep #1611</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ripgrep doesn&#x27;t apply .gitignore when following a symlink to a subdirectory of a git repo</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1611">#1611</a>
        opened by <a href="https://github.com/tavianator">@tavianator</a>
        on 2020-06-09 19:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/tavianator">@tavianator</a></div>
            <div class="timeline-body">What version of ripgrep are you using?
<pre><code>$ rg --version
ripgrep 12.1.1
-SIMD -AVX (compiled)
+SIMD +AVX (runtime)
</code></pre>
How did you install ripgrep?
<pre><code># pacman -S ripgrep
</code></pre>
What operating system are you using ripgrep on?
<p>Arch Linux.</p>
Describe your bug.
<p>I&#x27;m not sure if it should be expected to, but if ripgrep follows a symlink to a <code>git/repo/subdirectory</code>, it doesn&#x27;t apply any of the rules from <code>git/repo/.gitignore</code>.</p>
What are the steps to reproduce the behavior?
<pre><code>$ mkdir repo
$ cd repo
$ git init
Initialized empty Git repository in /home/tavianator/foo/repo/.git/
$ echo &#x27;*.o&#x27; &gt;.gitignore
$ mkdir dir
$ echo hello &gt;dir/not_ignored.o
$ git status
On branch master

No commits yet

Untracked files:
  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)
        .gitignore

nothing added to commit but untracked files present (use &quot;git add&quot; to track)
$ cd ..
$ ln -s repo/dir link
$ rg -L .
link/not_ignored.o
1:hello
</code></pre>
What is the actual behavior?
<pre><code>$ rg --debug -L .
DEBUG|globset|crates/globset/src/lib.rs:431: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|crates/globset/src/lib.rs:431: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|crates/globset/src/lib.rs:431: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|crates/globset/src/lib.rs:431: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUGlink/not_ignored.o
1:hello
|globset|crates/globset/src/lib.rs:431: built glob set; 0 literals, 0 basenames, 1 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|crates/globset/src/lib.rs:431: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|ignore::walk|crates/ignore/src/walk.rs:1730: ignoring ./repo/.git: Ignore(IgnoreMatch(Hidden))
DEBUG|ignore::walk|crates/ignore/src/walk.rs:1730: ignoring ./repo/.gitignore: Ignore(IgnoreMatch(Hidden))
DEBUG|ignore::walk|crates/ignore/src/walk.rs:1730: ignoring ./repo/dir/not_ignored.o: Ignore(IgnoreMatch(Gitignore(Glob { from: Some(&quot;./repo/.gitignore&quot;), original: &quot;*.o&quot;, actual: &quot;**/*.o&quot;, is_whitelist: false, is_only_dir: false })))
DEBUG|globset|crates/globset/src/lib.rs:431: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|crates/globset/src/lib.rs:431: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|crates/globset/src/lib.rs:431: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|crates/globset/src/lib.rs:431: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|crates/globset/src/lib.rs:431: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|crates/globset/src/lib.rs:431: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|crates/globset/src/lib.rs:431: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|crates/globset/src/lib.rs:431: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
</code></pre>
What is the expected behavior?
<p>Maybe when ripgrep descends into a symlink to a directory, it should re-check the chain of parents to see if it is inside a git repo.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-06-09 19:40</div>
            <div class="timeline-body"><p>This is correct behavior. For the purposes of gitignore filtering, symlinks are filtered on the basis of the link, not on the thing it points to. Your link exists outside the git repository, so there is no expectation that <code>.gitignore</code> files inside that repo will apply to that link itself. If you need this kind of filtering, you&#x27;ll need to add <code>.ignore</code> or <code>.rgignore</code> files in appropriate places.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-06-09 19:40</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wontfix</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-06-09 19:40</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/tavianator">@tavianator</a> on 2020-06-09 20:14</div>
            <div class="timeline-body"><p>I&#x27;m not expecting the link to be filtered, rather the things underneath that link.  If you did <code>cd link &amp;&amp; rg .</code>, the file would get ignored.  So I thought maybe <code>rg -L .</code> should also ignore it.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-06-09 20:37</div>
            <div class="timeline-body"><p>Yeah, I see what you mean, but everything I said still pretty much applies. Even if I agreed that this was a bug, fixing it wouldn&#x27;t be feasible. It would require resolving the symlink to its real absolute path and doing some crazy shenanigans to figure out how to correctly apply any pertinent <code>.gitignore</code> rules. The code is so complicated already, that fixing this just isn&#x27;t something I&#x27;m capable of doing.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:10 UTC
    </footer>
</body>
</html>
