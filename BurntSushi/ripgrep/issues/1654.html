<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Negation pattern in .gitignore not implemented properly - BurntSushi/ripgrep #1654</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Negation pattern in .gitignore not implemented properly</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1654">#1654</a>
        opened by <a href="https://github.com/yshui">@yshui</a>
        on 2020-08-14 15:56
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/yshui">@yshui</a></div>
            <div class="timeline-body">What version of ripgrep are you using?
<p>ripgrep 12.1.1
-SIMD -AVX (compiled)
+SIMD +AVX (runtime)</p>
How did you install ripgrep?
<p>Arch Linux repo</p>
What operating system are you using ripgrep on?
<p>See above</p>
Describe your bug.
<p>When a directory is matched to a rejection pattern in .gitignore, it is ignored entirely without been descended into - even though its contents could match a negation pattern.</p>
What are the steps to reproduce the behavior?
<p>gitignore:</p>
<pre><code>*
!*.c
</code></pre>
<p>directory tree:</p>
<pre><code>root
   └── a
       └── a.c
</code></pre>
<p>run <code>rg</code> in <code>root</code></p>
What is the actual behavior?
<p><code>a.c</code> is ignored</p>
What is the expected behavior?
<p><code>a.c</code> shouldn&#x27;t be ignored</p>
Additional information
<p>debug output of <code>rg</code>:</p>
<pre><code>DEBUG|ignore::walk|crates/ignore/src/walk.rs:1730: ignoring ./.git: Ignore(IgnoreMatch(Gitignore(Glob { from: Some(&quot;./.gitignore&quot;), original: &quot;*&quot;, actual: &quot;**/*&quot;, is_whitelist: false, is_only_dir: false })))
DEBUG|ignore::walk|crates/ignore/src/walk.rs:1730: ignoring ./a: Ignore(IgnoreMatch(Gitignore(Glob { from: Some(&quot;./.gitignore&quot;), original: &quot;*&quot;, actual: &quot;**/*&quot;, is_whitelist: false, is_only_dir: false })))
DEBUG|ignore::walk|crates/ignore/src/walk.rs:1730: ignoring ./.gitignore: Ignore(IgnoreMatch(Gitignore(Glob { from: Some(&quot;./.gitignore&quot;), original: &quot;*&quot;, actual: &quot;**/*&quot;, is_whitelist: false, is_only_dir: false })))

</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/yshui">@yshui</a> on 2020-08-14 15:59</div>
            <div class="timeline-body"><p>Basically when negation pattern exists, <code>rg</code> cannot skip directories. Instead, it has to decide whether to skip on file granularity.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/yshui">@yshui</a> on 2020-08-14 16:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/yshui">@yshui</a> on 2020-08-14 16:02</div>
            <div class="timeline-body"><p>Upon re-reading the gitignore documentation, I realized I was wrong.</p>
<p>Relevant part of the doc:</p>
<blockquote>
<p>It is not possible to re-include a file if a parent directory of that file is excluded. Git doesn’t list excluded directories for performance reasons, so any patterns on contained files have no effect, no matter where they are defined.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">invalid</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-08-14 16:10</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Nadrieril">@Nadrieril</a> on 2024-02-07 16:03</div>
            <div class="timeline-body"><blockquote>
<p>It is not possible to re-include a file if a parent directory of that file is excluded. Git doesn’t list excluded directories for performance reasons, so any patterns on contained files have no effect, no matter where they are defined.</p>
</blockquote>
<p>This is more subtle than it appears; in rustc we have the following gitignore:</p>
<pre><code>build/
!/compiler/rustc_mir_build/src/build/
</code></pre>
<p>Files in <code>compiler/rustc_mir_build/src/build/</code> are correctly detected by git, but are ignored by ripgrep.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-02-07 16:20</div>
            <div class="timeline-body"><p>@Nadrieril I don&#x27;t think your example fits in this issue. Yours doesn&#x27;t seem to be about a parent directory being excluded and wanting some child directory to be re-included. There is <em>probably</em> an issue filed for your specific case, but they are difficult to find (even for me). I&#x27;d recommend filing a new bug report with a complete reproduction.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Nadrieril">@Nadrieril</a> on 2024-02-07 16:44</div>
            <div class="timeline-body"><p>ok, thank you!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:10 UTC
    </footer>
</body>
</html>
