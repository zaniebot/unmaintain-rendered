<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>escape codes instead of color - BurntSushi/ripgrep #1123</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>escape codes instead of color</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1123">#1123</a>
        opened by <a href="https://github.com/thorstenkampe">@thorstenkampe</a>
        on 2018-11-27 17:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/thorstenkampe">@thorstenkampe</a></div>
            <div class="timeline-body">What version of ripgrep are you using?
<pre><code>ripgrep 0.10.0 (rev 8a7db1a918)
-SIMD -AVX (compiled)
+SIMD +AVX (runtime)
</code></pre>
How did you install ripgrep?
<p>Not installed just downloaded</p>
What operating system are you using ripgrep on?
<p>Windows 10</p>
Describe your question, feature request, or bug.
<p>ripgrep outputs escape sequences that are not interpreted as color codes by the terminal.</p>
If this is a bug, what are the steps to reproduce the behavior?
<ol>
<li>Use any winpty based terminal (Visual Studio Code, PyCharm or ConEmu with winpty)</li>
<li>Start PowerShell</li>
<li>pipe the output to ripgrep</li>
</ol>
If this is a bug, what is the actual behavior?
<pre><code>pwsh&gt; ps | rg --debug cron
DEBUG|grep_regex::literal|grep-regex\src\literal.rs:58: literal prefixes detected: Literals { lits: [Complete(cron)], limit_size: 250, limit_class: 10 }
DEBUG|globset|globset\src\lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
     1784       1    1784       1784  ?         197609   Nov 24 /usr/sbin/?[0m?[1m?[31mcron?[0m
</code></pre>
If this is a bug, what is the expected behavior?
<p>Output color codes that the terminal understands</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thorstenkampe">@thorstenkampe</a> on 2018-11-27 18:02</div>
            <div class="timeline-body"><p>Showing the issue in VS Code: ag and pt work fine rg (and sift) don&#x27;t show colors.
(Using <code>.exe</code> to show the commands are not aliased)
<img src="https://user-images.githubusercontent.com/475462/49101651-06910f00-f277-11e8-9586-6fc5286f4bc7.png" alt="grafik"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-11-27 18:12</div>
            <div class="timeline-body"><p>This seems like a bug in the console you&#x27;re using, not ripgrep. Can you reproduce this in a standard Windows console?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/okdana">@okdana</a> on 2018-11-27 18:16</div>
            <div class="timeline-body"><p>Something to do with this?</p>
<p>https://github.com/rprichard/winpty/issues/140</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thorstenkampe">@thorstenkampe</a> on 2018-11-27 18:17</div>
            <div class="timeline-body"><p>Yes, the issue is only when using the winpty wrapper</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thorstenkampe">@thorstenkampe</a> on 2018-11-27 18:26</div>
            <div class="timeline-body"><p>On the other hand, these &quot;interactions&quot; work (not sure how the winpty wrapper would not interfere here but in the above case):
<img src="https://user-images.githubusercontent.com/475462/49102849-2c6be300-f27a-11e8-9191-96f316e62930.png" alt="grafik"></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-11-28 00:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-11-28 00:54</div>
            <div class="timeline-body"><p>This does indeed look like a bug in winpty in that it simply cannot handle ANSI escape sequences. ripgrep uses them in this context because, on Windows, it will attempt to enable VT emulation, which is what makes ANSI escapes work in Windows 10. If enabling VT emulation is successful, then ripgrep will use ANSI escape sequences instead of using the normal Windows console APIs for colors.</p>
<p>One possible work-around for this would be to expose an option of some kind to forcefully disable the use of VT emulation. Unfortunately, the plumbing to do this is probably non-trivial. Therefore, whether we add the work-around or not really depends on the severity of this bug. It&#x27;s hard for me to estimate how severe this is.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/thorstenkampe">@thorstenkampe</a> on 2018-11-28 08:02</div>
            <div class="timeline-body"><p>I&#x27;m not really able to qualify the severity. As you can see from above screenshots, piping a Windows applications output (<code>es.exe</code>) to rg works fine. Same with cat from a file. I can&#x27;t tell what&#x27;s special about <code>ps</code>.</p>
<p>Maybe it would make sense to see why pt and ag don&#x27;t exhibit the problem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-11-28 10:21</div>
            <div class="timeline-body"><blockquote>
<p>Maybe it would make sense to see why pt and ag don&#x27;t exhibit the problem.</p>
</blockquote>
<p>I hinted at this with my work around above. My guess is that neither of those programs know how to use ANSI escape sequences on Windows and instead always interact with the Windows console APIs.</p>
<p>I would suggest lobbying the winpty developers to get their thoughts on the nature of this bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-01-24 14:37</div>
            <div class="timeline-body"><p>I&#x27;m going to close this under the assumption that this is a bug in winpty.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-01-24 14:37</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:07 UTC
    </footer>
</body>
</html>
