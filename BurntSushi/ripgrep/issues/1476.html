<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add flags for searching only in test code and excluding test code - BurntSushi/ripgrep #1476</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add flags for searching only in test code and excluding test code</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1476">#1476</a>
        opened by <a href="https://github.com/thanasis2028">@thanasis2028</a>
        on 2020-02-02 12:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/thanasis2028">@thanasis2028</a></div>
            <div class="timeline-body"><h4>What version of ripgrep are you using?</h4>
<p>ripgrep 11.0.2 (rev 32057b3883)
-SIMD -AVX (compiled)
+SIMD +AVX (runtime)</p>
<h4>How did you install ripgrep?</h4>
<p>Compiled from latest master</p>
<h4>What operating system are you using ripgrep on?</h4>
<p>Debian 9 (stretch)</p>
<h4>Describe your question, feature request, or bug.</h4>
<p>I was thinking that it would be useful to be able to search for text in rust code files, while being able to distinguish whether the found text is in a <code>#[test]</code> section, and filter it out.</p>
<p>For example, one might want to search for uses of the <code>println!</code> macro and replace it with something else in production, but doesn't care about println uses in tests.</p>
<p>Similarly, one might want to find and eliminate assertions in non-test sections.</p>
<p>So, I implemented 2 new flags <code>--excludetests</code> and <code>--testsonly</code> that do that (https://github.com/thanasis2028/ripgrep). If there is interest in this feature, I could create a PR.</p>
<p>4 new test cases have been implemented and pass, along with all current test cases.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-02-02 13:12</div>
            <div class="timeline-body"><p>It's a cool feature, but I've rejected features like this in the past. For the most part, ripgrep just isn't quite the right tool for this. I grant that it works in your specific case, but if the implementation isn't correct, then this becomes a vector for bug reports and potentially significant maintenance burden going forwards.</p>
<p>Examples of concrete problems with your current implementation:</p>
<ul>
<li>It is primarily implemented inside of <code>grep-regex</code>, which means users of PCRE2 will not get this feature.</li>
<li>Test detection is based on a simple textual test, but 100% correct test detection needs more than that. There could be other cfg knobs, as a simple example.</li>
<li>The requirement that multiline mode be enabled is fairly severe. It either requires memory maps to be used or requires reading the entire file into memory. I'd rather not add new features to ripgrep that require this mode.</li>
</ul>
<p>I would encourage you to maintain your patch though, if you find it useful!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2020-02-02 13:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @BurntSushi on 2020-02-02 13:12</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:43:05 UTC
    </footer>
</body>
</html>
