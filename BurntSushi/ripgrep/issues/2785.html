<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON indexing off - BurntSushi/ripgrep #2785</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>JSON indexing off</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2785">#2785</a>
        opened by <a href="https://github.com/kochbj">@kochbj</a>
        on 2024-04-21 22:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/kochbj">@kochbj</a></div>
            <div class="timeline-body">Please tick this box to confirm you have reviewed the above.
<ul>
<li>[X] I have a different issue.</li>
</ul>
What version of ripgrep are you using?
<p>ripgrep 14.0.3 (rev 3f2fe0afee)</p>
<p>features:-simd-accel,-pcre2
simd(compile):+SSE2,-SSSE3,-AVX2
simd(runtime):+SSE2,+SSSE3,+AVX2</p>
<p>PCRE2 is not available in this build of ripgrep.</p>
How did you install ripgrep?
<p>Compiled myself.</p>
What operating system are you using ripgrep on?
<p>Red Hat Enterprise Linux Server 7.9 (Maipo)</p>
Describe your bug.
<p>Running rg with json output sometimes produces an indexing error for the <code>start</code> and <code>end</code> indices by 2-5 characters.</p>
What are the steps to reproduce the behavior?
<p>rg --json &quot;monoclonal antibody&quot; <a href="https://github.com/BurntSushi/ripgrep/files/15055142/PMC1395485.txt">PMC1395485.txt</a></p>
What is the actual behavior?
<p>{&quot;type&quot;:&quot;begin&quot;,&quot;data&quot;:{&quot;path&quot;:{&quot;text&quot;:&quot;PMC1395485.txt&quot;}}}
{&quot;type&quot;:&quot;match&quot;,&quot;data&quot;:{&quot;path&quot;:{&quot;text&quot;:&quot;PMC1395485.txt&quot;},&quot;lines&quot;:{&quot;text&quot;:&quot;Reagents—The αIIbβ3 antagonist lotrafiban was supplied by GlaxoSmithKline (King of Prussia, PA). The anti-Rac (23A8) monoclonal antibody was purchased from Upstate Biotechnology (TCS Biologicals, Bucks, UK). Anti-Rac2 polyclonal antibody and anti-Rac3 polyclonal antibody were generously provided from Gary Bokoch (Scripps Institute, La Jolla, CA) and Ivan de Curtis (San Rafaele Scientific Institute, Milan, Italy), respectively. The cDNA for the GST-CRIB domain of PAK1 prepared as described previously (21) and the active form of Rac (L61Rac) were the kind gifts from Dr. Doreen Cantrell (Imperial Cancer Research Fund, London, UK). D-Phenyl-alanyl-1-prolyl-1 arginine chloromethyl ketone was purchased from Calbiochem. Fibrinogen depleted of plasminogen, VWF, and fibronectin was from Kordia Laboratory Supplies, Leiden, Netherlands. VWF was a generous gift from Michael C. Berndt (Monash University, Clayton, Australia). All other reagents were from Sigma or previously named sources (22, 23).\n&quot;},&quot;line_number&quot;:52,&quot;absolute_offset&quot;:7544,&quot;submatches&quot;:[{&quot;match&quot;:{&quot;text&quot;:&quot;monoclonal antibody&quot;},<strong>&quot;start&quot;:121,&quot;end&quot;:140</strong>}]}}
....
{&quot;type&quot;:&quot;end&quot;,&quot;data&quot;:{&quot;path&quot;:{&quot;text&quot;:&quot;PMC1395485.txt&quot;},&quot;binary_offset&quot;:null,&quot;stats&quot;:{&quot;elapsed&quot;:{&quot;secs&quot;:0,&quot;nanos&quot;:525009,&quot;human&quot;:&quot;0.000525s&quot;},&quot;searches&quot;:1,&quot;searches_with_match&quot;:1,&quot;bytes_searched&quot;:72115,&quot;bytes_printed&quot;:2828,&quot;matched_lines&quot;:2,&quot;matches&quot;:2}}}
{&quot;data&quot;:{&quot;elapsed_total&quot;:{&quot;human&quot;:&quot;0.002775s&quot;,&quot;nanos&quot;:2774501,&quot;secs&quot;:0},&quot;stats&quot;:{&quot;bytes_printed&quot;:2828,&quot;bytes_searched&quot;:72115,&quot;elapsed&quot;:{&quot;human&quot;:&quot;0.000525s&quot;,&quot;nanos&quot;:525009,&quot;secs&quot;:0},&quot;matched_lines&quot;:2,&quot;matches&quot;:2,&quot;searches&quot;:1,&quot;searches_with_match&quot;:1}},&quot;type&quot;:&quot;summary&quot;}</p>
What is the expected behavior?
<p>{&quot;type&quot;:&quot;match&quot;,&quot;data&quot;:{&quot;path&quot;:{&quot;text&quot;:&quot;/kellogg/proj/dashun/PMC_open_access_subset/20231215/manuscript/txt/PMC001xxxxxx/PMC1395485.txt&quot;},&quot;lines&quot;:{&quot;text&quot;:&quot;Reagents—The αIIbβ3 antagonist lotrafiban was supplied by GlaxoSmithKline (King of Prussia, PA). The anti-Rac (23A8) monoclonal antibody was purchased from Upstate Biotechnology (TCS Biologicals, Bucks, UK). Anti-Rac2 polyclonal antibody and anti-Rac3 polyclonal antibody were generously provided from Gary Bokoch (Scripps Institute, La Jolla, CA) and Ivan de Curtis (San Rafaele Scientific Institute, Milan, Italy), respectively. The cDNA for the GST-CRIB domain of PAK1 prepared as described previously (21) and the active form of Rac (L61Rac) were the kind gifts from Dr. Doreen Cantrell (Imperial Cancer Research Fund, London, UK). D-Phenyl-alanyl-1-prolyl-1 arginine chloromethyl ketone was purchased from Calbiochem. Fibrinogen depleted of plasminogen, VWF, and fibronectin was from Kordia Laboratory Supplies, Leiden, Netherlands. VWF was a generous gift from Michael C. Berndt (Monash University, Clayton, Australia). All other reagents were from Sigma or previously named sources (22, 23).\n&quot;},&quot;line_number&quot;:52,&quot;absolute_offset&quot;:7544,&quot;submatches&quot;:[{&quot;match&quot;:{&quot;text&quot;:&quot;monoclonal antibody&quot;},<strong>&quot;start&quot;:117,&quot;end&quot;:136</strong>}]}}</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kochbj">@kochbj</a> on 2024-04-21 22:23</div>
            <div class="timeline-body"><p>Hi,</p>
<p>Thanks as always for such a great tool. I have noticed inconsistencies in the indexing of matches when using json mode. Sometimes the indexing is as expected, but sometimes the characters are a few characters off from the start of the line when the <code>text</code> field is loaded as a string in python. If this isn&#x27;t a bug and there&#x27;s a reason for the discrepancy, please let me know!</p>
<p>All best,
B</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ltrzesniewski">@ltrzesniewski</a> on 2024-04-21 22:43</div>
            <div class="timeline-body"><p>The <code>start</code> and <code>end</code> fields represent <em>byte offsets</em> (see the <a href="https://docs.rs/grep-printer/latest/grep_printer/struct.JSON.html">format doc</a>), and that particular line starts with &quot;Reagents—The αIIbβ3&quot;, which contains 3 characters that are encoded on more than 1 byte: &quot;—&quot; takes 3 bytes, &quot;α&quot; and &quot;β&quot; take 2, which use 4 more bytes than if they were encoded on a single byte each, hence the difference you see.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-04-21 22:49</div>
            <div class="timeline-body"><p>The output you&#x27;ve shown is correct. Here is a verification:</p>
<pre><code>$ rg --json &quot;monoclonal antibody&quot; PMC1395485.txt | rg &#x27;&quot;type&quot;:&quot;match&quot;&#x27; | jq &#x27;.data.line_number, .data.submatches[].start, .data.submatches[].end&#x27;
52
121
140
152
611
630

$ head -n52 PMC1395485.txt | tail -n1 | dd ibs=1 skip=121 count=19 2&gt; /dev/null
monoclonal antibody%

$ head -n152 PMC1395485.txt | tail -n1 | dd ibs=1 skip=611 count=19 2&gt; /dev/null
monoclonal antibody%
</code></pre>
<p>Please read the JSON format docs closely: https://docs.rs/grep-printer/latest/grep_printer/struct.JSON.html</p>
<p>You&#x27;ll note that the offsets are very specifically defined as <em>byte offsets</em>.</p>
<p>So when you use those offsets in some context, you need to make sure they are being interpreted as byte offsets. They may not be. <em>Hint</em>: Since you didn&#x27;t provide any code and I thus cannot be sure, offsets for Python strings are <em>codepoint offsets</em>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/kochbj">@kochbj</a> on 2024-04-22 01:22</div>
            <div class="timeline-body"><p>Wonderful. thanks guys. When in doubt, RTFM. Sorry for opening an issue!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/kochbj">@kochbj</a> on 2024-04-22 01:22</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:13 UTC
    </footer>
</body>
</html>
