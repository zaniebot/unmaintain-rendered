<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>--line-number-width doesn't work well with --no-heading - BurntSushi/ripgrep #795</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>--line-number-width doesn't work well with --no-heading</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/795">#795</a>
        opened by <a href="https://github.com/timotheecour">@timotheecour</a>
        on 2018-02-13 09:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/timotheecour">@timotheecour</a></div>
            <div class="timeline-body"><h4>What version of ripgrep are you using?</h4>
<p>ripgrep 0.8.0 (rev )
-SIMD -AVX</p>
<h4>What operating system are you using ripgrep on?</h4>
<p>osx</p>
<h3>what i'm observing:</h3>
<p>rg --no-heading --line-number-width=10 packages</p>
<pre><code>source/dubregistry/dbcontroller.d:       289:           m_packages.update([&quot;_id&quot;: packId], [&quot;$set&quot;: [&quot;stats&quot;: stats]]);
source/dubregistry/dbcontroller.d:       345:                   auto res = m_packages.aggregate([&quot;$group&quot;: group], [&quot;$project&quot;: project]);
source/dubregistry/dbcontroller.d:       371:           foreach( bp; m_packages.find() ){
source/dubregistry/dbcontroller.d:       380:                           m_packages.update([&quot;_id&quot;: p._id], [&quot;$set&quot;: [&quot;versions&quot;: newversions]]);
source/dubregistry/web.d:        46:            DbPackage[] m_packages;
source/dubregistry/web.d:        66:                    Package[] packages;
source/dubregistry/web.d:        77:            DbPackage[] packages;
</code></pre>
<h3>what i'd expect</h3>
<p>that the line numbers would align WRT left margin (ie that they'd all lign up), not that they'd align WRT rightmost character of path (which has variable position due to different path lengths)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-02-13 12:12</div>
            <div class="timeline-body"><p>Sorry, but this will never work. The whole point of <code>--line-number-width</code> is to specify a fixed padding. There is no intelligent &quot;alignment&quot; going on. We can either let this bug stand or mark <code>--no-heading</code> as a conflicting flag with <code>--line-number-width</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @BurntSushi on 2018-02-13 12:12</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wontfix</span> added by @BurntSushi on 2018-02-13 12:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/erikrw">@erikrw</a> on 2018-02-13 12:15</div>
            <div class="timeline-body"><p>Perhaps I'm overlooking something, but could the padded line number be
printed before the file path on each line?</p>
<p>On Tue, Feb 13, 2018 at 1:12 PM, Andrew Gallant <a href="mailto:notifications@github.com">notifications@github.com</a>
wrote:</p>
<blockquote>
<p>Sorry, but this will never work. The whole point of --line-number-width
is to specify a fixed padding. There is no intelligent &quot;alignment&quot; going
on. We can either let this bug stand or mark --no-heading as a
conflicting flag with --line-number-width.</p>
<p>—
You are receiving this because you are subscribed to this thread.
Reply to this email directly, view it on GitHub
<a href="https://github.com/BurntSushi/ripgrep/issues/795#issuecomment-365249322">https://github.com/BurntSushi/ripgrep/issues/795#issuecomment-365249322</a>,
or mute the thread
<a href="https://github.com/notifications/unsubscribe-auth/ABwFepYMXPeSewHv2OI-lpDFByyT27zGks5tUXxDgaJpZM4SDeeA">https://github.com/notifications/unsubscribe-auth/ABwFepYMXPeSewHv2OI-lpDFByyT27zGks5tUXxDgaJpZM4SDeeA</a>
.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-02-13 12:22</div>
            <div class="timeline-body"><p>@erikrw It could, but it won't happen. That's not the standard grep output format.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-02-13 12:24</div>
            <div class="timeline-body"><p>I'm regretting ever adding this flag. I wish I considered this output format, because if I had, I would have never let this flag be a thing.</p>
<p>This is absolutely not something that ripgrep will ever fix because we are not going to get into the business of &quot;aligning&quot; output. I thought we could get away with something simple, but I didn't think carefully about the interaction with <code>--no-heading</code>. So this flag is either going to get removed in the next release or the flags get marked as conflicting (resulting in a ripgrep error). <em>sigh</em> But the <code>--no-heading</code> format is automatically enabled when ripgrep has its output redirected. This is a mess.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/timotheecour">@timotheecour</a> on 2018-02-13 20:31</div>
            <div class="timeline-body"><p>i can live without this but what would be controversial about the following:</p>
<p>(requires monospace font, the | are aligned)</p>
<pre><code>source/dubregistry/dbcontroller.d:371: | foreach( bp; m_packages.find() ){
source/dubregistry/dbcontroller.d:380: |   m_packages.update([&quot;_id&quot;: p._id], newversions]]);
source/dubregistry/web.d:46:           | DbPackage[] m_packages;
</code></pre>
<p>NOTE: user specifies minimum distance between | and left margin, same as using printf padding:
<code>printf(&quot;|%-10s|&quot;, &quot;filename+line+col&quot;);</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-02-13 21:26</div>
            <div class="timeline-body"><p>@timotheecour That doesn't align the line numbers, which I thought was the point of <code>--line-number-width</code>. Moreover, file paths are variable length, so what happens if you have a path like <code>x/y</code> in your case?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/timotheecour">@timotheecour</a> on 2018-02-13 21:51</div>
            <div class="timeline-body"><blockquote>
<p>That doesn't align the line numbers, which I thought was the point of --line-number-width.</p>
</blockquote>
<p>well maybe the flag could be renamed to something more general, like <code>--location-width</code> which would work with both just heading and no heading cases.</p>
<p>The intent i had in mind is to have aligned output in essentially 2 columns: one with file/line/col, the other with the data</p>
<blockquote>
<p>Moreover, file paths are variable length, so what happens if you have a path like x/y in your case?</p>
</blockquote>
<p>not sure I understand that 2nd point, but the point is to align in 2 columns (analog to how sql output is aligned in columns, eg
https://cloud.google.com/bigquery/docs/reference/standard-sql/query-syntax)</p>
<pre><code>&lt; -------------------------------------&gt; #specified (minimum) width in --location-width
source/dubregistry/dbcontroller.d:371: | foreach( bp; m_packages.find() ){
source/dubregistry/dbcontroller.d:380: |   m_packages.update([&quot;_id&quot;: p._id], newversions]]);
source/dubregistry/web.d:46:           | DbPackage[] m_packages;
x/y:46:                                | DbPackage[] m_packages;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-02-13 21:58</div>
            <div class="timeline-body"><p>What value do you give to <code>--location-width</code> to get that output? What happens when the output includes a shorter file name? Or a longer one?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/timotheecour">@timotheecour</a> on 2018-02-13 22:36</div>
            <div class="timeline-body"><blockquote>
<p>What happens when the output includes a shorter file name? Or a longer one?</p>
</blockquote>
<p>the location of each <code>|</code> will be at max(left_hand_side.length, locationWidth) so results in rg default behavior when locationWidth=0
(where left_hand_side could contain file, line, column depending on options)</p>
<blockquote>
<p>What value do you give to --location-width to get that output?</p>
</blockquote>
<p>user responsability to give a big enough one; if too small, not a big deal (see above point).</p>
<p>Unless <code>rg</code> has an option where it stores all results in memory before printing to stdout, in which case it could compute locationWidth to be the max of all left_hand_side. Note, this would be also useful for sorting outputs before dumping to stdout. very useful in the common case where number of generated output lines is small enough to fit well in memory (could always have a --max-stored-lines to avoid consuming too much memory)</p>
<p>Again, that's just an option...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-02-13 23:23</div>
            <div class="timeline-body"><p>@timotheecour Thanks for explaining! But yeah basically ripgrep isn't in the business of aligning things since it won't buffer all output into memory.</p>
<p>I basically am now of the opinion that these flags are too error prone and don't fit well into ripgrep.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/timotheecour">@timotheecour</a> on 2018-02-14 00:29</div>
            <div class="timeline-body"><p>sure. I'm really curious though (and sorry if it was already explained, if it is, thanks for the link) but what is downside of buffering output as an option? (orthogonal to this issue)
eg:</p>
<pre><code>rg --max-stored-lines=1000 options...
</code></pre>
<p>each thread would collect output into its own thread local buffer (up to max-stored-lines/num_threads, and maybe optionally dump to stdout if it exceeds buffer size)
then main thread merges each TLS buffer, does final processing (eg sort or align or whatever depending on other options) and dumps to stdout.</p>
<p>For all the queries I've ever done, output size is always fits in memory (and if it exceeds passed in buffer size it can just output to stdout)</p>
<p>enabling use cases:</p>
<ul>
<li>--sort-files with parallelism enabled</li>
<li>--location-width (as discussed)</li>
<li>multiline search (for simple cases at least) (cf https://github.com/BurntSushi/ripgrep/issues/360)</li>
</ul>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-02-14 00:34</div>
            <div class="timeline-body"><blockquote>
<p>but what is downside of buffering output as an option?</p>
</blockquote>
<p>Because I don't think every possible thing should be an option. I care about UX and maintainability, and part of that is managing the number of flags ripgrep supports.</p>
<p>It needs to be OK for me to say No to some things. If you care about output format this much, then it would be better to parse the results and re-display them in a format of your liking. That way, you can make the trade offs that make sense for your specific usage. (There is a ticket for enabling ripgrep to output results in a more structured format.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/timotheecour">@timotheecour</a> on 2018-02-14 00:37</div>
            <div class="timeline-body"><blockquote>
<p>There is a ticket for enabling ripgrep to output results in a more structured format.</p>
</blockquote>
<p>sructured output format would indeed solve all the use cases, ok thx (https://github.com/BurntSushi/ripgrep/issues/359  + other i guess)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-02-14 01:04</div>
            <div class="timeline-body"><p>Yes, that's the one!</p>
<p>On Feb 13, 2018 7:37 PM, &quot;Timothee Cour&quot; <a href="mailto:notifications@github.com">notifications@github.com</a> wrote:</p>
<blockquote>
<p>There is a ticket for enabling ripgrep to output results in a more
structured format.</p>
<p>sructured output format would indeed solve all the use cases, ok thx (
#244 <a href="https://github.com/BurntSushi/ripgrep/issues/244">https://github.com/BurntSushi/ripgrep/issues/244</a> ?)</p>
<p>—
You are receiving this because you commented.
Reply to this email directly, view it on GitHub
<a href="https://github.com/BurntSushi/ripgrep/issues/795#issuecomment-365455102">https://github.com/BurntSushi/ripgrep/issues/795#issuecomment-365455102</a>,
or mute the thread
<a href="https://github.com/notifications/unsubscribe-auth/AAb34kmQI6b2xhap7AzUo27Fk-xMEKpbks5tUirggaJpZM4SDeeA">https://github.com/notifications/unsubscribe-auth/AAb34kmQI6b2xhap7AzUo27Fk-xMEKpbks5tUirggaJpZM4SDeeA</a>
.</p>
</blockquote>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2018-04-23 23:57</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:42:26 UTC
    </footer>
</body>
</html>
