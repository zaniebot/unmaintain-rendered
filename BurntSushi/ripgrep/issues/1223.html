<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rg prints text &quot;&lt;stdin&gt;&quot; when input is given via stdin - BurntSushi/ripgrep #1223</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>rg prints text &quot;<stdin>&quot; when input is given via stdin</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1223">#1223</a>
        opened by <a href="https://github.com/arunvelsriram">@arunvelsriram</a>
        on 2019-03-18 13:48
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/arunvelsriram">@arunvelsriram</a></div>
            <div class="timeline-body"><h4>What version of ripgrep are you using?</h4>
<pre><code>$ rg --version
ripgrep 0.10.0
-SIMD -AVX (compiled)
+SIMD +AVX (runtime)
</code></pre>
<h4>How did you install ripgrep?</h4>
<p><code>brew install rg</code></p>
<h4>What operating system are you using ripgrep on?</h4>
<p><code>OS X High Sierra</code></p>
<h4>Describe your question, feature request, or bug.</h4>
<p>When I do <code>rg</code> over content passed through <code>stdin</code>, the output contains the text &quot;&lt;stdin&gt;&quot; along with the matches. It started to happen recently after I updated some of my <code>bash</code> configs and those are not related to <code>rg</code>. Does anyone know why this is happening?</p>
<pre><code>$ ls | rg test
&lt;stdin&gt;
test.json
test.txt
test.yaml
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-03-18 13:51</div>
            <div class="timeline-body"><p>Please follow the issue template and include the <code>--debug</code> output. Please also include <code>--trace</code> output.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/arunvelsriram">@arunvelsriram</a> on 2019-03-18 14:01</div>
            <div class="timeline-body"><p>Sorry missed that.</p>
<pre><code>$ ls | rg --debug test
DEBUG|grep_regex::literal|grep-regex/src/literal.rs:58: literal prefixes detected: Literals { lits: [Complete(test)], limit_size: 250, limit_class: 10 }
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
&lt;stdin&gt;
test.json
test.txt
test.yaml
</code></pre>
<pre><code>$ ls | rg --trace test
DEBUG|grep_regex::literal|grep-regex/src/literal.rs:58: literal prefixes detected: Literals { lits: [Complete(test)], limit_size: 250, limit_class: 10 }
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
&lt;stdin&gt;
test.json
test.txt
test.yaml
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-03-18 14:28</div>
            <div class="timeline-body"><p>My <em>guess</em> is that this is a user error somewhere. I cannot reproduce it. I was hoping the debug output would show the argv, but it looks like that isn't quite working as I'd like. Do you have an <code>rg</code> alias somewhere? Run <code>alias rg</code> or <code>command -V rg</code> to see. For example, this is how things could be messed up:</p>
<pre><code>$ alias rg=&quot;rg --with-filename&quot;
$ ls | rg test
&lt;stdin&gt;
test.py
</code></pre>
<p>More concretely, try</p>
<pre><code>$ ls | \rg test
test.py
</code></pre>
<p>to force that you aren't using an alias.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/arunvelsriram">@arunvelsriram</a> on 2019-03-18 17:04</div>
            <div class="timeline-body"><p>It's not aliased as far as I checked.</p>
<pre><code>$ alias rg
-bash: alias: rg: not found
</code></pre>
<pre><code>$ command -V rg
rg is /usr/local/bin/rg
</code></pre>
<pre><code>ls | \rg test
&lt;stdin&gt;
test.json
test.txt
test.yaml
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-03-18 17:09</div>
            <div class="timeline-body"><p>Then I don't know. You'll likely need to debug this yourself since I cannot reproduce it and I can't quite figure out how this could be happening. The first step here would be to just compile master and see if the bug has been fixed already. If not, you'll want to debug this code:</p>
<p>https://github.com/BurntSushi/ripgrep/blob/09139721047b1cda6ad88dbf89dc5fa74c66a3a2/src/args.rs#L1471-L1482</p>
<p>Namely, it seems like that's returning true for you, but I don't know why.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/arunvelsriram">@arunvelsriram</a> on 2019-03-18 19:12</div>
            <div class="timeline-body"><p>Thanks for the input.</p>
<p>I noticed one more thing. Its happening only in my home directory. It feels like a user error to me as well. I will debug this further and update here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-04-08 12:29</div>
            <div class="timeline-body"><p>I'm going to close this out since I can't reproduce it. Please feel free to comment again if you have more details!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2019-04-08 12:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">invalid</span> added by @BurntSushi on 2019-04-08 12:29</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @BurntSushi on 2019-04-08 12:30</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/iiey">@iiey</a> on 2019-05-28 13:04</div>
            <div class="timeline-body"><p>please reopen this issue as a bug because I have the same problem:</p>
<pre><code>16.04.1-Ubuntu

ripgrep 0.10.0 (rev 8a7db1a918)
-SIMD -AVX (compiled)
+SIMD +AVX (runtime)
</code></pre>
<pre><code>$ ls | rg --trace a
DEBUG|grep_regex::literal|grep-regex/src/literal.rs:58: literal prefixes detected: Literals { lits: [Complete(A), Complete(a)], limit_size: 250, limit_class: 10 }
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|globset/src/lib.rs:424: glob converted to regex: Glob { glob: &quot;**/build*&quot;, re: &quot;(?-u)^(?:/?|.*/)build.*$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: false, backslash_escape: true }, tokens: Tokens([RecursivePrefix, Literal('b'), Literal('u'), Literal('i'), Literal('l'), Literal('d'), ZeroOrMore]) }
DEBUG|globset|globset/src/lib.rs:429: built glob set; 1 literals, 3 basenames, 6 extensions, 0 prefixes, 1 suffixes, 0 required extensions, 1 regexes
TRACE|grep_searcher::searcher|grep-searcher/src/searcher/mod.rs:685: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|grep-searcher/src/searcher/core.rs:61: searcher core: will use fast line searcher
&lt;stdin&gt;:a
</code></pre>
<pre><code>$ ls | rg --debug a
DEBUG|grep_regex::literal|grep-regex/src/literal.rs:58: literal prefixes detected: Literals { lits: [Complete(A), Complete(a)], limit_size: 250, limit_class: 10 }
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|globset/src/lib.rs:424: glob converted to regex: Glob { glob: &quot;**/build*&quot;, re: &quot;(?-u)^(?:/?|.*/)build.*$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: false, backslash_escape: true }, tokens: Tokens([RecursivePrefix, Literal('b'), Literal('u'), Literal('i'), Literal('l'), Literal('d'), ZeroOrMore]) }
DEBUG|globset|globset/src/lib.rs:429: built glob set; 1 literals, 3 basenames, 6 extensions, 0 prefixes, 1 suffixes, 0 required extensions, 1 regexes
&lt;stdin&gt;:a
</code></pre>
<p><strong>Step to reproduce it</strong> :</p>
<ol>
<li>Create a folder with some subdirs:</li>
</ol>
<pre><code>mkdir a b c
ls | rg a
a
</code></pre>
<ol start="2">
<li>Create a folder with minus symbol &quot;-&quot;</li>
</ol>
<pre><code>mkdir -
ls | rg a
&lt;stdin&gt;:a
</code></pre>
<p><em>Edit</em>: it yields same problem when I'm under folder contained '-' directory regardless what we grep:</p>
<pre><code>$ cat text.txt | rg abc
&lt;stdin&gt;:abc def
&lt;stdin&gt;:def abc
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-05-28 13:10</div>
            <div class="timeline-body"><p>@arunvelsriram Could you confirm whether this is the same underlying issue? i.e., Does the output of <code>ls</code> include a <code>-</code> file/directory somewhere?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/arunvelsriram">@arunvelsriram</a> on 2019-05-28 18:44</div>
            <div class="timeline-body"><p>@BurntSushi Actually, I changed my machine recently and didn't face the issue after that. However, I tried the steps provided by @iiey and am able to replicate the issue.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/arunvelsriram">@arunvelsriram</a> on 2019-05-28 18:45</div>
            <div class="timeline-body"><p>Sorry, am not sure if my old machine listed a <code>-</code> on <code>ls</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jpninanjohn">@jpninanjohn</a> on 2019-05-31 11:13</div>
            <div class="timeline-body"><p>I had a look into the suggested part of the code and tried to debug this.</p>
<p>https://github.com/BurntSushi/ripgrep/blob/09139721047b1cda6ad88dbf89dc5fa74c66a3a2/src/args.rs#L1188-L1204</p>
<p>When paths are empty, a default path is given which is what is got by <code>paths.get(0)</code>. This default path is also <code>-</code>.</p>
<p>Most cases when there is no directory with the name &quot;-&quot;,  <code>paths.get(0).map_or(false, |p| p.is_dir())</code> will return <code>false</code>, in the case there is such a directory called &quot;-&quot;, it will return <code>true</code>.</p>
<blockquote>
<p>Then I don't know. You'll likely need to debug this yourself since I cannot reproduce it and I can't quite figure out how this could be happening. The first step here would be to just compile maste
r and see if the bug has been fixed already. If not, you'll want to debug this code:</p>
<p>https://github.com/BurntSushi/ripgrep/blob/09139721047b1cda6ad88dbf89dc5fa74c66a3a2/src/args.rs#L1471-L1482</p>
<p>Namely, it seems like that's returning true for you, but I don't know why.</p>
</blockquote>
<p>The solution I am thinking is to skip the check if its a directory, if the path is the default one. I'm not sure if this is correct though.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jpninanjohn">@jpninanjohn</a> on 2019-06-03 08:50</div>
            <div class="timeline-body"><p>@BurntSushi</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-06-03 09:19</div>
            <div class="timeline-body"><p>I don't need to be pinged. Either someone can investigate and fix this issue, or I'll do it myself when I get a chance. This is not a high priority bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Reopened by @BurntSushi on 2019-08-01 21:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2019-08-01 21:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:42:51 UTC
    </footer>
</body>
</html>
