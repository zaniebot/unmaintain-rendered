<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Obvious match missing from results when using group: a(.*c) does not match abc - BurntSushi/ripgrep #1064</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Obvious match missing from results when using group: a(.*c) does not match abc</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1064">#1064</a>
        opened by <a href="https://github.com/phiresky">@phiresky</a>
        on 2018-09-24 18:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/phiresky">@phiresky</a></div>
            <div class="timeline-body"><h4>What version of ripgrep are you using?</h4>
<p>ripgrep 0.10.0
-SIMD -AVX (compiled)
+SIMD +AVX (runtime)</p>
<h4>Bug</h4>
<p>Example:</p>
<p><code>echo abc | rg --debug 'a(.*c)'</code></p>
<pre><code>DEBUG|grep_regex::literal|grep-regex/src/literal.rs:110: required literal found: &quot;ac&quot;
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
</code></pre>
<p>doesn't find any results. The following all work:</p>
<p><code>echo ac | rg 'a(.*c)'</code></p>
<p><code>echo abc | rg 'a.*c'</code></p>
<p><code>echo abc | ag 'a(.*c)'</code></p>
<p><code>echo abc | grep 'a\(.*c\)'</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lespea">@lespea</a> on 2018-09-24 20:11</div>
            <div class="timeline-body"><p>Interestingly enough this also fails: <code>echo abc | rg --debug 'a(?:.*c)'</code> but this works: <code>echo abc | rg --debug 'a(.*)c'</code></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-09-24 20:17</div>
            <div class="timeline-body"><p>Ug. This looks like a bug in ripgrep's inner literal extractor. It thinks <code>ac</code> is a literal that must appear in every match, but this is obviously wrong. The regex engine prefix/suffix detection is correct:</p>
<pre><code>[andrew@Cheetah ~]$ regex-debug prefixes 'a(.*c)'
Cut(a)
[andrew@Cheetah ~]$ regex-debug suffixes 'a(.*c)'
Cut(c)
</code></pre>
<p>I diagnosed this from the <code>--debug</code> output. Cutting out the irrelevant stuff, you can see the problem here:</p>
<pre><code>[andrew@Cheetah ~]$ echo abc | rg 'a(.*c)' --debug
DEBUG|grep_regex::literal|grep-regex/src/literal.rs:110: required literal found: &quot;ac&quot;
[andrew@Cheetah ~]$ echo abc | rg 'a.*c' --debug
DEBUG|grep_regex::literal|grep-regex/src/literal.rs:110: required literal found: &quot;a&quot;
</code></pre>
<p>I would have thought this was a regression since I touched this code as part of libripgrep work, but 0.9.0 exhibits the same bug.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @BurntSushi on 2018-09-24 20:17</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/phiresky">@phiresky</a> on 2018-09-24 20:19</div>
            <div class="timeline-body"><p>checking out ripgrep 0.0.1 (with <code>regex = &quot;0.1.75&quot;</code>) has the same bug</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2018-09-25 20:56</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:42:41 UTC
    </footer>
</body>
</html>
