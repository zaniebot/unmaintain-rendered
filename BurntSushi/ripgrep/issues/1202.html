<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>--glob doesn't work if given path is file - BurntSushi/ripgrep #1202</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>--glob doesn't work if given path is file</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1202">#1202</a>
        opened by <a href="https://github.com/mars90226">@mars90226</a>
        on 2019-02-22 03:14
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mars90226">@mars90226</a></div>
            <div class="timeline-body"><h4>What version of ripgrep are you using?</h4>
<p>ripgrep 0.10.0
-SIMD -AVX (compiled)
+SIMD +AVX (runtime)</p>
<h4>How did you install ripgrep?</h4>
<p>Use <code>cargo install ripgrep</code>.</p>
<h4>What operating system are you using ripgrep on?</h4>
<p>Distributor ID: Ubuntu
Description:    Ubuntu 18.04.2 LTS
Release:        18.04
Codename:       bionic</p>
<h4>Describe your question, feature request, or bug.</h4>
<p>rg --glob option should apply even when path is a file.</p>
<h4>If this is a bug, what are the steps to reproduce the behavior?</h4>
<p>Create a simple file
<code>$ echo 123 &gt; test.txt</code></p>
<p>Searching the file content with glob that excluding the file</p>
<pre><code>$ rg --glob '!test.txt' 123 test.txt
1:123
</code></pre>
<h4>If this is a bug, what is the actual behavior?</h4>
<p><code> $ rg --debug --glob '!test.txt' 123 test.txt</code></p>
<pre><code>DEBUG|grep_regex::literal|/root/.cargo/registry/src/github.com-1ecc6299db9ec823/grep-regex-0.1.1/src/literal.rs:58: literal prefixes detected: Literals { lits: [Complete(123)], limit_size: 250, limit_class: 10 }
DEBUG|globset|/root/.cargo/registry/src/github.com-1ecc6299db9ec823/globset-0.4.2/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|/root/.cargo/registry/src/github.com-1ecc6299db9ec823/globset-0.4.2/src/lib.rs:429: built glob set; 0 literals, 1 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|/root/.cargo/registry/src/github.com-1ecc6299db9ec823/globset-0.4.2/src/lib.rs:424: glob converted to regex: Glob { glob: &quot;**/.syntastic_*_config&quot;, re: &quot;(?-u)^(?:/?|.*/)\\.syntastic_.*_config$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: false, backslash_escape: true }, tokens: Tokens([RecursivePrefix, Literal('.'), Literal('s'), Literal('y'), Literal('n'), Literal('t'), Literal('a'), Literal('s'), Literal('t'), Literal('i'), Literal('c'), Literal('_'), ZeroOrMore, Literal('_'), Literal('c'), Literal('o'), Literal('n'), Literal('f'), Literal('i'), Literal('g')]) }
DEBUG|globset|/root/.cargo/registry/src/github.com-1ecc6299db9ec823/globset-0.4.2/src/lib.rs:424: glob converted to regex: Glob { glob: &quot;**/.eslintrc.*&quot;, re: &quot;(?-u)^(?:/?|.*/)\\.eslintrc\\..*$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: false, backslash_escape: true }, tokens: Tokens([RecursivePrefix, Literal('.'), Literal('e'), Literal('s'), Literal('l'), Literal('i'), Literal('n'), Literal('t'), Literal('r'), Literal('c'), Literal('.'), ZeroOrMore]) }
DEBUG|globset|/root/.cargo/registry/src/github.com-1ecc6299db9ec823/globset-0.4.2/src/lib.rs:429: built glob set; 0 literals, 23 basenames, 1 extensions, 0 prefixes, 1 suffixes, 0 required extensions, 2 regexes
1:123
</code></pre>
<h4>If this is a bug, what is the expected behavior?</h4>
<p><code>ripgrep</code> should output nothing, because the glob excludes the file.</p>
<p>I've tested the behavior of <code>grep</code>. Here's the result:
<code>$ grep --include '!test.txt' 123 test.txt</code>
outputs nothing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/okdana">@okdana</a> on 2019-02-22 03:29</div>
            <div class="timeline-body"><p>The manual says:</p>
<blockquote>
<p>Paths specified explicitly on the command line override glob and ignore rules.</p>
</blockquote>
<p>I'm just guessing, but did this come up because you're trying to make ripgrep ignore some of the results of a shell glob expansion? If so, you might be able to just use multiple <code>-g</code> patterns (in place of the shell globs). Alternatively, your shell might be able to do something for you; for example, in zsh (with extended globbing enabled) you can do <code>rg mypattern foo*~foobar</code> to search all files starting with <code>foo</code> except <code>foobar</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mars90226">@mars90226</a> on 2019-02-22 06:36</div>
            <div class="timeline-body"><p>I'm trying to use the following snippet from <a href="https://stackoverflow.com/questions/42771468/git-grep-on-files-from-last-commit-only?rq=1">here</a>. But I want to use <code>ripgrep</code> instead of <code>grep</code>.</p>
<pre><code>git diff-tree -z --no-commit-id --name-only -r HEAD \
   | xargs -0 grep --include 'pattern' -- &quot;regex&quot;
</code></pre>
<p>I know it can be done by piping the filenames to <code>ripgrep</code> to grep the filename before searching file content like the following snippet. But it will need much more typing and is more difficult to remember.</p>
<pre><code>git diff-tree -z --no-commit-id --name-only -r HEAD \
   | rg --null-data 'pattern' \
   | xargs -0 rg -- &quot;regex&quot;
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-02-22 10:44</div>
            <div class="timeline-body"><p>This is intended behavior. Sorry.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2019-02-22 10:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mars90226">@mars90226</a> on 2019-02-23 03:43</div>
            <div class="timeline-body"><p>Ok, thanks for you response.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:42:50 UTC
    </footer>
</body>
</html>
