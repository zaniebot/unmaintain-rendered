<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Directory paths are ignored even if negative-ignore exists for files underneath it - BurntSushi/ripgrep #1050</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Directory paths are ignored even if negative-ignore exists for files underneath it</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1050">#1050</a>
        opened by <a href="https://github.com/infinity0">@infinity0</a>
        on 2018-09-13 07:42
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/infinity0">@infinity0</a></div>
            <div class="timeline-body"><p>Running over https://salsa.debian.org/rust-team/debcargo-conf/:</p>
<pre><code>$ cat .gitignore
/build
/src/*/*
!/src/*/debian

$ rg -q copyright 
$ rg -q copyright src
No files were searched, which means ripgrep probably applied a filter you didn&#x27;t expect. Try running again with --debug.
1
$ rg -q copyright src/*

$ git grep -q copyright 
$ git grep -q copyright src
$ git grep -q copyright src/*
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-09-13 10:56</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-09-13 11:01</div>
            <div class="timeline-body"><p>Yeah, this is one of the cases where it&#x27;s tough for ripgrep to behave the same as git here. I think there have been bugs reported on this issue in the past, but I can&#x27;t find them.</p>
<p>The fundamental issue is that <code>/src/*/*</code> matches <code>src/atty</code> (for example), and therefore, that directory is ignored and ripgrep doesn&#x27;t descend into it. So the <code>!/src/*/debian</code> whitelist rule isn&#x27;t even applied.</p>
<p>Two thoughts:</p>
<ol>
<li>Should <code>src/atty</code> actually match <code>/src/*/*</code>? There might be some special handling going on with the trailing slash that allows it to match. Not sure.</li>
<li>Maybe ripgrep either needs to get smarter, or it cannot implement the optimization of avoiding to descend into directories that have been ignored.</li>
</ol>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/infinity0">@infinity0</a> on 2018-09-15 16:41</div>
            <div class="timeline-body"><blockquote>
<p>Should src/atty actually match /src/<em>/</em>?</p>
</blockquote>
<p>No, */* is pretty explicit about only matching 2 levels down. I think this would take it further away from the behaviour of git.</p>
<blockquote>
<p>Maybe ripgrep either needs to get smarter, or it cannot implement the optimization of avoiding to descend into directories that have been ignored.</p>
</blockquote>
<p>I think this would be the correct approach, how about not implementing the optimisation if there exists a ! whitelist rule matching potentially anything below that directory?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-09-15 16:47</div>
            <div class="timeline-body"><blockquote>
<p>how about not implementing the optimisation if there exists a ! whitelist rule matching potentially anything below that directory?</p>
</blockquote>
<p>Yes, that&#x27;s what I mean by &quot;smarter.&quot; There&#x27;s no infrastructure for that kind of analysis yet.</p>
<p>But it sounds like we should at least try to understand why <code>src/atty</code> is matching <code>src/*/*</code> and fix that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">gitignore</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-05-08 11:39</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ssbarnea">@ssbarnea</a> on 2024-12-16 14:46</div>
            <div class="timeline-body"><p>In fact the ignore-file implementation seems to be quite broken, I just discovered that an entry like <code>.pre-commit/</code> caused the ignore of all files in all folders named <code>.pre-commit-config.yaml</code>, which is clearly not what I was looking for.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-12-16 14:48</div>
            <div class="timeline-body"><blockquote>
<p>In fact the ignore-file implementation seems to be quite broken, I just discovered that an entry like <code>.pre-commit/</code> caused the ignore of all files in all folders named <code>.pre-commit-config.yaml</code>, which is clearly not what I was looking for.</p>
</blockquote>
<p>That is entirely separate from this issue. Please open a new issue with an MRE.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:07 UTC
    </footer>
</body>
</html>
