<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>leading forward slash needs to be escaped for unknown reason - BurntSushi/ripgrep #1277</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>leading forward slash needs to be escaped for unknown reason</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1277">#1277</a>
        opened by <a href="https://github.com/jspashett">@jspashett</a>
        on 2019-05-09 07:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/jspashett">@jspashett</a></div>
            <div class="timeline-body">What version of ripgrep are you using?
<p>C:\opt\bin&gt;rg --version
ripgrep 11.0.1
-SIMD -AVX (compiled)
+SIMD -AVX (runtime)</p>
How did you install ripgrep?
<p>cargo install ripgrep</p>
What operating system are you using ripgrep on?
<p>Microsoft Windows [Version 10.0.17134.590]</p>
Describe your question, feature request, or bug.
<p>executing rg &quot;/exchangecommshub&quot;
against any files where a url component is /exchangecommshub does not match for reasons unknown. I assume ripgrep things its a path? This is in contrast to grep, and is surprising.</p>
<p>The leading path separator must be &quot;escaped&quot;:
rg &quot;[/]exchangecommshub&quot;</p>
If this is a bug, what are the steps to reproduce the behavior?
<p>Corpus line:
https://redacted.com/redacted/redacted/v1/004022555784/exchangecommshub
Rg:
rg &quot;/exchangecommshub&quot;</p>
If this is a bug, what is the actual behavior?
<pre><code>your
output
goes
here
</code></pre>
If this is a bug, what is the expected behavior?
<p>It should have found all files and lines within which contain the literal &quot;/exchangecommshub&quot; in the same way that grep behaves, or it should say why it is/will surprisingly differ from the grep output</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alexeyten">@alexeyten</a> on 2019-05-09 08:43</div>
            <div class="timeline-body"><p>In DOS/Windows forward slash always was a start of command parameter, e.g. <code>dir /w</code></p>
<p>Not sure if it’s related to the question…</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jspashett">@jspashett</a> on 2019-05-09 08:56</div>
            <div class="timeline-body"><p>Yes, that&#x27;s may be the reason. Although ripgrep on windows accepts &quot;-&quot; as option specifiers, too, so perhaps it should not accept / it&#x27;s hard to say. It appears that all the powershell stuff now uses the dash format inplace of the slashes.</p>
<p>The thing is too, that an argument of &quot;/exchangecommshub&quot; generates no error, and you get no results, so it&#x27;s <em>not at all obvous</em> that you get no results for that reason.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-05-09 10:46</div>
            <div class="timeline-body"><p>Thanks for the bug report! This does indeed sound strange. It &quot;smells&quot; like a shell issue on Windows, but there isn&#x27;t enough data for this bug report to be actionable unfortunately. My <em>guess</em> is that you&#x27;re using cygwin, which will (I think) automatically do path translation on arguments. I&#x27;ve requested more details below:</p>
<p>Your link is broken. I get a 404: https://redacted.com/redacted/redacted/v1/004022555784/exchangecommshub</p>
<p>Please provide some input that can be searched that reproduces your problem.</p>
<p>Please also show the <em>actual</em> output of the command that you ran.</p>
<p>Please also show the equivalent grep commands and its output.</p>
<p>Please also state which shell on Windows you&#x27;re using and confirm that you&#x27;re using the same shell for both ripgrep and grep.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-05-09 10:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jspashett">@jspashett</a> on 2019-05-09 11:50</div>
            <div class="timeline-body"><p>I think I have identified the problem. The problem exists when running rg in a msys2 shell. And it appears that becuase rg.exe is installed ourside of the msys installation, it converts paths by adding a prefix.</p>
<p>First, The package was installed via cargo install ripgrep in a windows shell. (cargo install ripgrep)</p>
<p><strong>msys2 shell</strong></p>
<pre><code>DESKTOP-2GTA575+user@DESKTOP-2GTA575 MINGW64 /c/temp
$ cat test.txt
anystringhere/findthis/example

DESKTOP-2GTA575+user@DESKTOP-2GTA575 MINGW64 /c/temp
$ rg &quot;/example&quot; test.txt
</code></pre>
<p>The process command line here was:
`C:\opt\bin\rg.exe C:/msys64/example</p>
<p><strong>Windows Shell</strong></p>
<pre><code>C:\temp&gt;rg &quot;/example&quot; test.txt
1:anystringhere/findthis/example
</code></pre>
<p>The procces command line here was:
<code>rg  &quot;/example&quot;</code></p>
<p>rg works correctly in the Windows subsystem shell, thereforce it appears to be the msys shell remapping mechanism that is causing the problem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-05-09 11:53</div>
            <div class="timeline-body"><p>Please show the output of <code>rg --trace &quot;/example&quot; test.txt</code> in both shells.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-05-09 11:55</div>
            <div class="timeline-body"><p>In particular, there should be a line in the trace output that contains <code>final regex: &quot;...&quot;</code> which shows the actual regex being used to search.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jspashett">@jspashett</a> on 2019-05-09 13:03</div>
            <div class="timeline-body"><p><strong>Msys2 shell:</strong>
&quot;DESKTOP-2GTA575+user@DESKTOP-2GTA575 MINGW64 /c/temp
$ rg --trace &quot;/example&quot; test.txt
DEBUG|grep_regex::literal|C:\Users\user.cargo\registry\src\github.com-1ecc6299db9ec823\grep-regex-0.1.3\src\literal.rs:59: literal prefixes detected: Literals { lits: [Complete(C:/msys64/example)], limit_size: 250, limit_class: 10 }
TRACE|grep_regex::matcher|C:\Users\user.cargo\registry\src\github.com-1ecc6299db9ec823\grep-regex-0.1.3\src\matcher.rs:56: final regex: &quot;C:/msys64/example&quot;
DEBUG|globset|C:\Users\user.cargo\registry\src\github.com-1ecc6299db9ec823\globset-0.4.3\src\lib.rs:435: built glob set; 0 literals, 0 basenames, 11 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
TRACE|grep_searcher::searcher|C:\Users\user.cargo\registry\src\github.com-1ecc6299db9ec823\grep-searcher-0.1.4\src\searcher\mod.rs:663: Some(&quot;test.txt&quot;): searching via memory map
TRACE|grep_searcher::searcher|C:\Users\user.cargo\registry\src\github.com-1ecc6299db9ec823\grep-searcher-0.1.4\src\searcher\mod.rs:753: slice reader: searching via slice-by-line strategy
TRACE|grep_searcher::searcher::core|C:\Users\user.cargo\registry\src\github.com-1ecc6299db9ec823\grep-searcher-0.1.4\src\searcher\core.rs:61: searcher core: will use fast line searcher&quot;</p>
<p><strong>Windows (CMD) shell</strong>
&quot;C:\temp&gt;rg --trace &quot;/example&quot; test.txt
DEBUG|grep_regex::literal|C:\Users\user.cargo\registry\src\github.com-1ecc6299db9ec823\grep-regex-0.1.3\src\literal.rs:59: literal prefixes detected: Literals { lits: [Complete(/example)], limit_size: 250, limit_class: 10 }
TRACE|grep_regex::matcher|C:\Users\user.cargo\registry\src\github.com-1ecc6299db9ec823\grep-regex-0.1.3\src\matcher.rs:56: final regex: &quot;/example&quot;
DEBUG|globset|C:\Users\user.cargo\registry\src\github.com-1ecc6299db9ec823\globset-0.4.3\src\lib.rs:435: built glob set; 0 literals, 0 basenames, 11 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
TRACE|grep_searcher::searcher|C:\Users\user.cargo\registry\src\github.com-1ecc6299db9ec823\grep-searcher-0.1.4\src\searcher\mod.rs:663: Some(&quot;test.txt&quot;): searching via memory map
TRACE|grep_searcher::searcher|C:\Users\user.cargo\registry\src\github.com-1ecc6299db9ec823\grep-searcher-0.1.4\src\searcher\mod.rs:753: slice reader: searching via slice-by-line strategy
TRACE|grep_searcher::searcher::core|C:\Users\user.cargo\registry\src\github.com-1ecc6299db9ec823\grep-searcher-0.1.4\src\searcher\core.rs:61: searcher core: will use fast line searcher
1:anystringhere/findthis/example&quot;</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-05-09 13:20</div>
            <div class="timeline-body"><p>Yeah, you can see that when you run in the MSYS shell, that the <em>actual</em> regex that ripgrep searches is <code>C:/msys64/example</code>, despite the fact that you typed in <code>/example</code>.</p>
<p>As far as I&#x27;m concerned, this is just crazy behavior from MSYS in assuming that any argument given to a command line program is a file path, and I don&#x27;t see any reasonable way for ripgrep to fix this.</p>
<p>It is interesting to me that grep doesn&#x27;t exhibit the same behavior, but your version of grep is likely bundled with MSYS in a way that makes it play nice with this automatic path translation behavior. I don&#x27;t see an easy way for ripgrep to play along here.</p>
<p>Unfortunate, but this is a <code>wontfix</code>. As a workaround, I believe you can use <code>//example</code> as a way to &quot;escape&quot; the slash.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-05-09 13:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-05-09 13:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-05-09 13:20</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wontfix</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-05-09 13:20</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/jspashett">@jspashett</a> on 2019-05-09 14:02</div>
            <div class="timeline-body"><p>I agree. I can see why msys does this, so that it can correctly mapp it&#x27;s view of the current directory for external programs. msys guessing that the parameter is a path from a leading slash is dubious, but perhaps there isn&#x27;t another solution, if there is one I may propose a change to msys. I used [/] at the begining of the regex to get around this problem.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Pyker">@Pyker</a> on 2020-09-12 09:41</div>
            <div class="timeline-body"><p>I just ran across this issue, and just want to add Git for Windows&#x27;s explanation and workarounds on this (https://github.com/git-for-windows/build-extra/blob/main/ReleaseNotes.md#known-issues):</p>
<blockquote>
<p>If you specify command-line options starting with a slash, POSIX-to-Windows path conversion will kick in converting e.g. &quot;<code>/usr/bin/bash.exe</code>&quot; to &quot;<code>C:\Program Files\Git\usr\bin\bash.exe</code>&quot;. When that is not desired -- e.g. &quot;<code>--upload-pack=/opt/git/bin/git-upload-pack</code>&quot; or &quot;<code>-L/regex/</code>&quot; -- you need to set the environment variable <code>MSYS_NO_PATHCONV</code> temporarily, like so:</p>
<blockquote>
<p><code>MSYS_NO_PATHCONV=1 git blame -L/pathconv/ msys2_path_conv.cc</code></p>
</blockquote>
<p>Alternatively, you can double the first slash to avoid POSIX-to-Windows path conversion, e.g. &quot;<code>//usr/bin/bash.exe</code>&quot;.</p>
</blockquote>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:08 UTC
    </footer>
</body>
</html>
