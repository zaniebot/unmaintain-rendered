<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Since nightly-2024-02-06 , could not compile with --features 'simd-accel' - BurntSushi/ripgrep #2748</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Since nightly-2024-02-06 , could not compile with --features &#x27;simd-accel&#x27;</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2748">#2748</a>
        opened by <a href="https://github.com/PierreAntoineGuillaume">@PierreAntoineGuillaume</a>
        on 2024-03-07 13:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/PierreAntoineGuillaume">@PierreAntoineGuillaume</a></div>
            <div class="timeline-body">Please tick this box to confirm you have reviewed the above.
<ul>
<li>[X] I have a different issue.</li>
</ul>
What version of ripgrep are you using?
<p>6ebebb2 (current master HEAD, few commits after 14.1.0)</p>
How did you install ripgrep?
<p>Trying to compiling it from source</p>
What operating system are you using ripgrep on?
<p>Ubuntu 20.04.6 LTS</p>
Describe your bug.
<p>Cannot compile</p>
What are the steps to reproduce the behavior?
<p>RUSTUP_TOOLCHAIN=nightly-2024-02-06 cargo build --features &#x27;simd-accel&#x27; fails
RUSTUP_TOOLCHAIN=nightly-2024-02-05 cargo build --features &#x27;simd-accel&#x27; works</p>
<p>Because:</p>
<pre><code>   --&gt; ~/.cargo/registry/src/index.crates.io-6f17d22bba15001f/packed_simd-0.3.9/src/lib.rs:218:5
    |
218 |     platform_intrinsics,
    |     ^^^^^^^^^^^^^^^^^^^ feature has been removed
    |
    = note: SIMD intrinsics use the regular intrinsics ABI now
</code></pre>
<p>Then in later nightly version :</p>
<pre><code>invalid ABI: found `platform-intrinsic`
</code></pre>
<p>related: https://github.com/rust-lang/rust/commit/ea37e8091fe87ae0a7e204c034e7d55061e56790
<a href="https://github.com/rust-lang/rust/pull/117372">rust-lang/rust#117372</a></p>
<p>I don&#x27;t know if this is actually a bug.</p>
What is the actual behavior?
<p>Cannot compile</p>
What is the expected behavior?
<p>Can compile</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/PierreAntoineGuillaume">@PierreAntoineGuillaume</a> on 2024-03-07 13:45</div>
            <div class="timeline-body"><p>This is more a report and a reference than a real bug, and I will be trying to make a pull request but anything simd-related is way above my knowledge.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-03-07 14:24</div>
            <div class="timeline-body"><p>As documented in the README, <code>simd-accel</code> requires a Rust nightly compiler because it relies on unstable features. As also documented in the README, the <em>only</em> thing it helps is UTF-16 decoding. So you might want to re-evaluate why you&#x27;re enabling it in the first place.</p>
<p>I am considering just removing the <code>simd-accel</code> feature because I am absolutely tired of the fact that <code>encoding_rs</code> refuses to use stable APIs for its SIMD features. All of ripgrep&#x27;s SIMD optimizations for search do not require it. They use stable but platform specific APIs.</p>
<p>In any case, I&#x27;m not tracking this issue here. There&#x27;s an issue for it at the source: <a href="https://github.com/rust-lang/packed_simd/issues/359">rust-lang/packed_simd#359</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-03-07 14:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-03-07 14:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-03-07 14:48</div>
            <div class="timeline-body"><p>I ended up just removing <code>simd-accel</code> altogether because I&#x27;m tired of dealing with it. See <a href="https://github.com/BurntSushi/ripgrep/pull/2749">BurntSushi/ripgrep#2749</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/PierreAntoineGuillaume">@PierreAntoineGuillaume</a> on 2024-03-07 15:13</div>
            <div class="timeline-body"><p>Really nice !</p>
<p>Thanks for your time, and for your tools too.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:13 UTC
    </footer>
</body>
</html>
