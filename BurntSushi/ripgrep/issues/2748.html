<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Since nightly-2024-02-06 , could not compile with --features 'simd-accel' - BurntSushi/ripgrep #2748</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Since nightly-2024-02-06 , could not compile with --features 'simd-accel'</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2748">#2748</a>
        opened by <a href="https://github.com/PierreAntoineGuillaume">@PierreAntoineGuillaume</a>
        on 2024-03-07 13:44
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/PierreAntoineGuillaume">@PierreAntoineGuillaume</a></div>
            <div class="timeline-body"><h3>Please tick this box to confirm you have reviewed the above.</h3>
<ul>
<li>[X] I have a different issue.</li>
</ul>
<h3>What version of ripgrep are you using?</h3>
<p>6ebebb2 (current master HEAD, few commits after 14.1.0)</p>
<h3>How did you install ripgrep?</h3>
<p>Trying to compiling it from source</p>
<h3>What operating system are you using ripgrep on?</h3>
<p>Ubuntu 20.04.6 LTS</p>
<h3>Describe your bug.</h3>
<p>Cannot compile</p>
<h3>What are the steps to reproduce the behavior?</h3>
<p>RUSTUP_TOOLCHAIN=nightly-2024-02-06 cargo build --features 'simd-accel' fails
RUSTUP_TOOLCHAIN=nightly-2024-02-05 cargo build --features 'simd-accel' works</p>
<p>Because:</p>
<pre><code class="language-shell">   --&gt; ~/.cargo/registry/src/index.crates.io-6f17d22bba15001f/packed_simd-0.3.9/src/lib.rs:218:5
    |
218 |     platform_intrinsics,
    |     ^^^^^^^^^^^^^^^^^^^ feature has been removed
    |
    = note: SIMD intrinsics use the regular intrinsics ABI now
</code></pre>
<p>Then in later nightly version :</p>
<pre><code>invalid ABI: found `platform-intrinsic`
</code></pre>
<p>related: https://github.com/rust-lang/rust/commit/ea37e8091fe87ae0a7e204c034e7d55061e56790
https://github.com/rust-lang/rust/pull/117372</p>
<p>I don't know if this is actually a bug.</p>
<h3>What is the actual behavior?</h3>
<p>Cannot compile</p>
<h3>What is the expected behavior?</h3>
<p>Can compile</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/PierreAntoineGuillaume">@PierreAntoineGuillaume</a> on 2024-03-07 13:45</div>
            <div class="timeline-body"><p>This is more a report and a reference than a real bug, and I will be trying to make a pull request but anything simd-related is way above my knowledge.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-03-07 14:24</div>
            <div class="timeline-body"><p>As documented in the README, <code>simd-accel</code> requires a Rust nightly compiler because it relies on unstable features. As also documented in the README, the <em>only</em> thing it helps is UTF-16 decoding. So you might want to re-evaluate why you're enabling it in the first place.</p>
<p>I am considering just removing the <code>simd-accel</code> feature because I am absolutely tired of the fact that <code>encoding_rs</code> refuses to use stable APIs for its SIMD features. All of ripgrep's SIMD optimizations for search do not require it. They use stable but platform specific APIs.</p>
<p>In any case, I'm not tracking this issue here. There's an issue for it at the source: https://github.com/rust-lang/packed_simd/issues/359</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2024-03-07 14:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2024-03-07 14:47</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-03-07 14:48</div>
            <div class="timeline-body"><p>I ended up just removing <code>simd-accel</code> altogether because I'm tired of dealing with it. See https://github.com/BurntSushi/ripgrep/pull/2749</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/PierreAntoineGuillaume">@PierreAntoineGuillaume</a> on 2024-03-07 15:13</div>
            <div class="timeline-body"><p>Really nice !</p>
<p>Thanks for your time, and for your tools too.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:43:46 UTC
    </footer>
</body>
</html>
