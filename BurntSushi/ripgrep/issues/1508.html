<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>globset: Access violation when built with lto = &quot;thin&quot; on Windows - BurntSushi/ripgrep #1508</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>globset: Access violation when built with lto = &quot;thin&quot; on Windows</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1508">#1508</a>
        opened by <a href="https://github.com/forbjok">@forbjok</a>
        on 2020-03-04 23:00
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/forbjok">@forbjok</a></div>
            <div class="timeline-body"><p>Version: globset v0.4.4
OS: Windows 10 Pro x64 v1909</p>
<p>Calling globset.is_match(...) causes the program to crash with an access violation if built with <code>lto = &quot;thin&quot;</code> under certain circumstances.</p>
<p>The circumstances being (as far as I can tell):</p>
<ul>
<li>OS = Windows (tested on Arch Linux and could not reproduce it there)</li>
<li>Target = x86_64-pc-windows-msvc (I haven&#x27;t tested every other target, but it does not happen with i686-pc-windows-msvc)</li>
</ul>
<p>I don&#x27;t know if this is actually an error in globset, or if it&#x27;s some obscure compiler error that just happens to be triggered by globset.</p>
<p>It happens both with stable and nightly Rust.</p>
<p>Error message:
<img src="https://user-images.githubusercontent.com/4687674/75930152-4f6c4600-5e72-11ea-92ec-4750f271240d.png" alt="ConEmu64_WJEnWXAnNJ"></p>
<p>Minimal reproduction project:
<a href="https://github.com/BurntSushi/ripgrep/files/4289999/lto-thin-repro.zip">lto-thin-repro.zip</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-03-04 23:15</div>
            <div class="timeline-body"><p>Thanks for the bug report, but yeah, this doesn&#x27;t look like it belongs here. This looks more like a compiler bug I guess? You might want to file it on rust-lang/rust, although this might be hard to diagnose without a smaller reproduction (i.e., that doesn&#x27;t use a fairly big crate like globset).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-03-04 23:15</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lespea">@lespea</a> on 2020-03-04 23:27</div>
            <div class="timeline-body"><p>Do you have ryzen by chance?  <a href="https://github.com/rust-lang/rust/issues/63959">rust-lang/rust#63959</a></p>
<p>Should be fixed on stable soon.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/forbjok">@forbjok</a> on 2020-03-04 23:30</div>
            <div class="timeline-body"><blockquote>
<p>Do you have ryzen by chance? <a href="https://github.com/rust-lang/rust/issues/63959">rust-lang/rust#63959</a></p>
<p>Should be fixed on stable soon.</p>
</blockquote>
<p>Nope, it&#x27;s an Intel Core i9-9900K CPU on Intel Z390 chipset.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lespea">@lespea</a> on 2020-03-04 23:34</div>
            <div class="timeline-body"><p>Interesting.  Does it panic on nightly as well?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/forbjok">@forbjok</a> on 2020-03-05 11:27</div>
            <div class="timeline-body"><p>Yep, same error in both stable and nightly. I also tested on an older machine (Intel Core i7-6700, Intel Z170 chipset), and I get it there as well.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/forbjok">@forbjok</a> on 2020-03-05 17:03</div>
            <div class="timeline-body"><p>I remembered I had configured cargo to use the LLVM linker, because it&#x27;s faster. Turns out the problem is also restricted to the LLVM linker, but still only the 64-bit target.
Seems pretty likely that it&#x27;s actually an LLVM linker bug.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:09 UTC
    </footer>
</body>
</html>
