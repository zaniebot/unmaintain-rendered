<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ripgrep 0.2.8 is slower than 0.1.17 - BurntSushi/ripgrep #226</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>ripgrep 0.2.8 is slower than 0.1.17</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/226">#226</a>
        opened by <a href="https://github.com/danbst">@danbst</a>
        on 2016-11-08 19:09
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/danbst">@danbst</a></div>
            <div class="timeline-body"><p>I&#x27;ve built two version of <code>ripgrep</code> with Nix and tried to process several large log-files:</p>
<pre><code>cat &gt; /tmp/part1 &lt;&lt;EOF
Sep  1 00:00:54 flare poe-wp    actions.log     5       16      id=329968       a=us    sid=7406d&amp;L=6756&amp;nc=354 , US_99fc0
Sep  1 00:00:54 flare poe-wp    actions.log     3       16      id=159925       a=us    sid=4d9f4&amp;L=6658&amp;nc=47  , US_42019
Sep  1 00:00:54 flare poe-wp    actions.log     5       16      id=256192       a=us    sid=97c33&amp;L=9761&amp;nc=825 , US_945fb
Sep  1 00:00:54 flare poe-wp    actions.log     4       16      id=318102       a=us    L=3810&amp;nc=15
Sep  1 00:00:54 flare poe-wp    actions.log     2       16      id=344030       a=us    sid=9db0f&amp;L=4536&amp;nc=1171
Sep  1 00:00:55 flare poe-wp    actions.log     5       1015    id=258449       a=agi   aid=656&amp;L=1981&amp;nc=178
Sep  1 00:00:55 flare poe-wp    actions.log     7       1       id=96809        a=co    bid=416145&amp;dr=169834180,165794832,117081222,685&amp;L=3191&amp;nc=126
Sep  1 00:00:55 flare poe-wp    actions.log     16      25      id=217040       a=us    sid=9ecca&amp;L=2709&amp;nc=172  RF c37443 Resources: gold:5 595  wood: 295   2001:3 , US_5fdfc
Sep  1 00:00:55 flare poe-wp    actions.log     2       95      id=359662       a=us    L=3148&amp;nc=389
Sep  1 00:00:55 flare poe-wp    actions.log     6       1       id=323959       a=co    bid=12ecdd3&amp;dr=159447,1235597,1867293,587&amp;L=0625&amp;nc=6576
EOF

cat /tmp/part1 | perl -0777pe &#x27;$_=$_ x 600000&#x27; &gt; /tmp/largefile
for n in 1 2 3 4 5; do cp /tmp/largefile /tmp/largefile$n; done

for tool in grep \
            /nix/store/0ckbrgryjgmbzh8132w540nrkxih55kq-ripgrep-0.1.17/bin/rg \
            /nix/store/38ljsyz7y5a9w2bw738jcmymy2zla1sq-ripgrep-0.2.8/bin/rg \
           ; do
    time $tool id=25 /tmp/largefile*  | wc -l
done
</code></pre>
<p>Here is a result:</p>
<pre><code>7200000

real    0m5.020s
user    0m3.800s
sys     0m1.190s
7200000

real    0m2.209s
user    0m4.020s
sys     0m1.270s
7200000

real    0m4.044s
user    0m3.452s
sys     0m0.557s
</code></pre>
<p>Clearly, the new ripgrep is slower then 0.1.17</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2016-11-09 21:52</div>
            <div class="timeline-body"><p>Thanks so much for the easily reproducible bug report. ^_^</p>
<p>This is interesting though. Looks like this happened between <code>0.2.6</code> and <code>0.2.8</code>, which means it&#x27;s probably related to the changes I made to the parallel iterator. Some more data points (note that single threaded performance has not regressed):</p>
<pre><code>[andrew@Cheetah ripgrep-226] time rg-0.2.6 id=25 ./largefile* | wc -l
7200000

real    0m1.151s
user    0m3.297s
sys     0m2.203s
[andrew@Cheetah ripgrep-226] time rg id=25 ./largefile* | wc -l
7200000

real    0m3.183s
user    0m2.507s
sys     0m1.000s
[andrew@Cheetah ripgrep-226] time rg-0.2.6 -j1 id=25 ./largefile* | wc -l
7200000

real    0m2.822s
user    0m2.520s
sys     0m0.873s
[andrew@Cheetah ripgrep-226] time rg -j1 id=25 ./largefile* | wc -l
7200000

real    0m2.846s
user    0m2.563s
sys     0m0.907s
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2016-11-09 21:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2016-11-09 22:01</div>
            <div class="timeline-body"><p>Welp. I&#x27;m a dufus. While the iterator is parallel, it doesn&#x27;t process <em>explicit</em> file paths in parallel.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2016-11-09 22:19</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:02 UTC
    </footer>
</body>
</html>
