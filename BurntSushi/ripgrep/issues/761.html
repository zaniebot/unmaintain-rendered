<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Behavior of ignoring files/folders in .gitignore does not align with git - BurntSushi/ripgrep #761</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Behavior of ignoring files/folders in .gitignore does not align with git</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/761">#761</a>
        opened by <a href="https://github.com/Goblinlordx">@Goblinlordx</a>
        on 2018-01-27 01:39
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/Goblinlordx">@Goblinlordx</a></div>
            <div class="timeline-body"><p>This issue originally arose when using VS Code's search feature which actually uses <code>ripgrep</code>.  For specific details, you can see this issue:
https://github.com/Microsoft/vscode/issues/42174</p>
<p>The issue seems to be, <code>ripgrep</code> is not ignoring the same files and folders as <code>git</code>.  If this is intended behavior, it isn't really stated as the documentation simply states it will be &quot;respecting your gitignore rules.&quot;  Currently, if I have a structure as the following:</p>
<pre><code>- path1/
  - file_to_exclude_1
  - file_to_exclude_2
  - file_to_exclude_3
- path2/
  - file_to_include_1
  - path1/
    - file_to_include_2
</code></pre>
<p>If I also have a <code>.gitignore</code> which has the following entry:</p>
<pre><code>path1/*
</code></pre>
<p><code>git</code> will only ignore <code>./path1</code> in the Root of the project and not <code>./path2/path1</code>.  <code>ripgrep</code> seems to be ignoring both <code>./path1</code> and <code>./path2/path1</code> which is inconsistent with what <code>git</code> ignores when using these rules.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/Goblinlordx">@Goblinlordx</a> on 2018-01-27 01:52</div>
            <div class="timeline-body"><p>As a note, this rule seems to be explicitly stated on the <code>git</code> documentation page:
https://git-scm.com/docs/gitignore</p>
<blockquote>
<p>If the pattern does not contain a slash /, Git treats it as a shell glob pattern and checks for a match against the pathname relative to the location of the .gitignore file (relative to the toplevel of the work tree if not from a .gitignore file).</p>
</blockquote>
<blockquote>
<p>Otherwise, Git treats the pattern as a shell glob suitable for consumption by fnmatch(3) with the FNM_PATHNAME flag: wildcards in the pattern will not match a / in the pathname. For example, &quot;Documentation/*.html&quot; matches &quot;Documentation/git.html&quot; but not &quot;Documentation/ppc/ppc.html&quot; or &quot;tools/perf/Documentation/perf.html&quot;.</p>
</blockquote>
<p>In this case, it &quot;contains a /&quot; and so will ignore <code>./path1/some_file_or_folder</code> but not <code>./path2/path1/some_file_or_folder</code>.  I also found this exact same statement in the <code>man gitignore</code> pages on my git version:</p>
<pre><code>git version 2.14.0
hub version 2.2.9
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/okdana">@okdana</a> on 2018-01-27 03:11</div>
            <div class="timeline-body"><blockquote>
<p>For example, &quot;Documentation/*.html&quot; matches &quot;Documentation/git.html&quot; but not &quot;Documentation/ppc/ppc.html&quot; or &quot;tools/perf/Documentation/perf.html&quot;.</p>
</blockquote>
<p>If i'm looking at it right, it seems like the <code>ignore</code> crate deliberately rejects this — there is a test asserting that <code>src/*.rs</code> should ignore <code>src/grep/src/main.rs</code>, which contradicts both the quoted text and git's actual behaviour:</p>
<pre><code>% echo 'path1/*.rs' &gt; .gitignore
% touch path1/foo.rs path2/path1/foo.rs
% git check-ignore -v path1/foo.rs; echo $?
.gitignore:1:path1/*.rs	path1/foo.rs
0
% git check-ignore -v path2/path1/foo.rs; echo $?
1
</code></pre>
<p>What causes this behaviour (and the issue with <code>path1/*</code>) is the implicit prepending of <code>**/</code> to a rule even when it contains a <code>/</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2018-01-29 19:11</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:42:25 UTC
    </footer>
</body>
</html>
