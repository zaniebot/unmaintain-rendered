<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature: Display control characters using caret notation - BurntSushi/ripgrep #379</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Feature: Display control characters using caret notation</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/379">#379</a>
        opened by <a href="https://github.com/casey">@casey</a>
        on 2017-02-24 00:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/casey">@casey</a></div>
            <div class="timeline-body"><p>I was using <code>rg</code> today and it started printing results from a binary file.</p>
<p>The file in question starts with a bunch of text, but ends with an inline zip file, which I think confused ripgrep's binary file type detection.</p>
<p>The results included a lot of control characters, which hosed my terminal.</p>
<p>Would it be possible to print control characters in the output using caret notation? In the general case, I'm not sure that non-printable control characters are useful in results, so it might be worth it to turn this on by default, but it could also live behind a flag.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-02-24 00:44</div>
            <div class="timeline-body"><p>Do other tools do this? e.g., grep? If grep detects your file as binary, then I'd like to learn how ripgrep can make its detection better.</p>
<p>I'm pretty hesitant to go down the path of completely rewriting output results, but I agree that messing up your terminal is not a pleasant experience.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @BurntSushi on 2017-02-24 00:44</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/casey">@casey</a> on 2017-02-24 01:00</div>
            <div class="timeline-body"><p>Grep does indeed detect it as binary.</p>
<p>Using <code>grep -r pattern .</code> I get <code>Binary file ./weird-file matches</code></p>
<p>How does ripgrep's binary file type detection currently work?</p>
<p>The issue is that this particular file starts with a bunch of plain test, so any heuristic that uses the beginning of the file will fail here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/casey">@casey</a> on 2017-02-24 01:02</div>
            <div class="timeline-body"><p>The file utility seems to notice that it contains binary:</p>
<pre><code>$ file wierd-file
wierd-file: Bourne-Again shell script executable (binary data)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-02-24 01:43</div>
            <div class="timeline-body"><p>@casey Binary detection is basically &quot;find a <code>NUL</code> byte.&quot; ripgrep had a bug (that's fixed on master) where it only looked at the first 1KB or so for a <code>NUL</code> byte. Unfortunately, that bug is only fixed when buffered reading is used. If ripgrep decides to use memory maps, then I think it only examines the first 10KB.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/casey">@casey</a> on 2017-02-24 05:28</div>
            <div class="timeline-body"><p>Hmmm, in that case I think there is always a risk that it will misdetect the type of a file.</p>
<p>Although it sounds weird, I think this situation comes up more often than one might expect. In this case, the file is a self-extracting python binary. The file is a shell script followed by a zip archive, where the shell script extracts the zip archive.</p>
<p>This gets a lot of use at both facebook and google (I'm a current facebook employee and ex google employee), and seems to be used in chromeos: https://chromium.googlesource.com/chromiumos/platform/factory/+/stabilize-4068.0.B/py/tools/make_par.py (not sure for what though)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">icebox</span> added by @BurntSushi on 2017-04-09 13:12</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-01-31 02:55</div>
            <div class="timeline-body"><p>I'm going to close this. My feeling is that this isn't ripgrep's responsibility, and that it should be possible to pipe output of ripgrep into another program that does this sanitization for you. One might argue that this limits the utility of such a feature since you generally don't know whether your terminal is going to get hit with a bunch of control sequences. But this would be true if we did it in ripgrep as well. In particular, there is no way we could enable such a filter by default because of the performance impact that would have. So it would need to be opt-in.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2018-01-31 02:55</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:42:05 UTC
    </footer>
</body>
</html>
