<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>`ignore` doesn't respect .gitignore - BurntSushi/ripgrep #2454</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1><code>ignore</code> doesn't respect .gitignore</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2454">#2454</a>
        opened by <a href="https://github.com/SK83RJOSH">@SK83RJOSH</a>
        on 2023-03-14 20:08
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/SK83RJOSH">@SK83RJOSH</a></div>
            <div class="timeline-body"><h4>What version of ignore are you using?</h4>
<p>0.4.20</p>
<h4>What operating system are you using ignore on?</h4>
<p>Windows</p>
<h4>Describe your bug.</h4>
<p>This one is a bit of an edge case, but this pattern is used by Unreal and I suspect is valid. When excluding <em>all</em> files, but <em>not</em> directories, and subsequently whitelisting specific file types, ignored folders seem to be traversed and files which should be otherwise ignored, are not.</p>
<p>I'm building a tool to automate robocopying Unreal's source between git and perforce; and while <code>ignore</code> seems to have largely correct output (better than any other library I've tried in any language), this particular bug is blocking me at the moment.</p>
<h4>What are the steps to reproduce the behavior?</h4>
<p>If I have a directory containing a <code>.gitignore</code> like this:</p>
<pre><code># Ignore all files by default, but scan all directories
*
!*/

# Text files
!*.txt

# Ignore logs
/Logs/
</code></pre>
<p>And the following structure:</p>
<pre><code>A.txt
B.txt
C.txt
Logs\A.txt
Logs\B.txt
Logs\C.txt
Logs\Subfolder\A.txt
Logs\Subfolder\B.txt
Logs\Subfolder\C.txt
</code></pre>
<h4>What is the actual behavior?</h4>
<p><code>ignore</code> will include all <code>*.txt</code> files within <code>/Logs/</code> when it should not.</p>
<h4>What is the expected behavior?</h4>
<p><code>ignore</code> should not include all <code>*.txt</code> files within <code>/Logs/</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2023-03-14 20:14</div>
            <div class="timeline-body"><p>If you're using the library directly, then you <em>must</em> provide a program that reproduces the problem. Otherwise, how can I fix it? For example, using ripgrep, your example works just as I would expect:</p>
<pre><code>$ tree
.
â”œâ”€â”€ A.txt
â”œâ”€â”€ B.txt
â”œâ”€â”€ C.txt
â””â”€â”€ Logs
    â”œâ”€â”€ A.txt
    â”œâ”€â”€ B.txt
    â”œâ”€â”€ C.txt
    â””â”€â”€ Subfolder
        â”œâ”€â”€ A.txt
        â”œâ”€â”€ B.txt
        â””â”€â”€ C.txt
$ cat .gitignore
# Ignore all files by default, but scan all directories
*
!*/

# Text files
!*.txt

# Ignore logs
/Logs/
$ rg --files
A.txt
B.txt
C.txt
</code></pre>
<p>Which is what looks correct to me. Your ignore file whitelists all <code>*.txt</code> files, so that explains the <code>{A,B,C}.txt</code> in the results. But ignores <code>/Logs/</code>, which is correctly ignored here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SK83RJOSH">@SK83RJOSH</a> on 2023-03-14 20:26</div>
            <div class="timeline-body"><blockquote>
<p>If you're using the library directly, then you <em>must</em> provide a program that reproduces the problem.</p>
</blockquote>
<p>My apologies, the issue template didn't mention that, and I didn't want to cut down my program if I didn't have to (I thought this may be reproducible with ripgrep - and unfortunately I didn't think to test it - since it isn't I suspect it's PEBKAC but let's see). ðŸ™‚</p>
<p><a href="https://github.com/BurntSushi/ripgrep/files/10973472/gitignore-repro.zip">gitignore-repro.zip</a></p>
<p>You can simply do cargo run and check the directory for added.txt/removed.txt</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/SK83RJOSH">@SK83RJOSH</a> on 2023-03-14 20:50</div>
            <div class="timeline-body"><p>Ah okay, I see now that that <code>add_ignore</code> doesn't set the root path of <code>GitignoreBuilder</code> using the existing <code>WalkBuilder</code> root. Which makes sense since as it's intended for global ignores which totally flew over my head for whatever reason. This may be out of scope for the library then, I naively assumed this worked something like filters, and would let me use a given <code>.gitignore</code> as if it was already in a given directory.</p>
<p>My apologies! I'll close this for now, and use a <code>.gitignore</code> in both source and output instead. I think this would be a rather interesting feature though, as I've seen a few people using <code>filters</code> to this effect - but since those act like a &quot;.gitallow&quot; I can't use them here without modifying the source ignore files.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @SK83RJOSH on 2023-03-14 20:50</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:43:38 UTC
    </footer>
</body>
</html>
