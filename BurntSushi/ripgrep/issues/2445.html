<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>--replace breaks when concatenating placeholder and string (input provided) - BurntSushi/ripgrep #2445</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>--replace breaks when concatenating placeholder and string (input provided)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2445">#2445</a>
        opened by <a href="https://github.com/ink-splatters">@ink-splatters</a>
        on 2023-03-06 10:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ink-splatters">@ink-splatters</a></div>
            <div class="timeline-body">What version of ripgrep are you using?
<pre><code>ripgrep 13.0.0
-SIMD -AVX (compiled)
</code></pre>
How did you install ripgrep?
<p>using nix</p>
<p><code>nix-env -iA nixpkgs.ripgrep</code></p>
What operating system are you using ripgrep on?
<pre><code>ProductName:            macOS
ProductVersion:         13.2.1
BuildVersion:           22D68
</code></pre>
Describe your bug.
<p><code>--replace</code> breaks in a strange way when <strong>a placeholder is concatenated with a string and  not vice versa: concatenating a string on the left side with placeholder on the right side - works</strong></p>
Context
<p>Given:</p>
<pre><code>ic@airstation ~ % which rg
/nix/var/nix/profiles/default/bin/rg
</code></pre>
<p>I want to replace <code>bin/rg</code> with <code>Applications</code>.</p>
Working example
<p>I came up with regex which does give correct output</p>
<pre><code>ic@airstation ~ % which rg | rg &#x27;(default/).+&#x27;
/nix/var/nix/profiles/default/bin/rg
</code></pre>
<hr>
Bug
<p>Things break when <code>--replace</code> argument is added to the call. As you see, the placeholder is postfixed with a string, which is important.</p>
<pre><code>ic@airstation ~ % which rg | rg &#x27;(default/).+&#x27; --replace &#x27;$1Applications&#x27;
/nix/var/nix/profiles/
</code></pre>
Expected output
<p><code>/nix/var/nix/profiles/default/Applications</code></p>
More examples
<p>lets call things like that:</p>
<ul>
<li><code>$1</code> is <em>placeholder</em></li>
<li><code>Applications</code> is <em>string</em></li>
</ul>
<p>swap placeholder and string, <strong>works</strong>:</p>
<pre><code>ic@airstation ~ % which rg | rg &#x27;(default/).+&#x27; --replace &#x27;Applications $1&#x27;
/nix/var/nix/profiles/Applications default/
</code></pre>
<p><strong>works</strong> even w/o space in between:</p>
<pre><code>ic@airstation ~ % which rg | rg &#x27;(default/).+&#x27; --replace &#x27;Applications$1&#x27;
/nix/var/nix/profiles/Applicationsdefault/
</code></pre>
<p>swap placeholder and 1-st string&#x27;s character, <strong>broken</strong>:</p>
<pre><code>ic@airstation ~ % which rg | rg &#x27;(default/).+&#x27; --replace &#x27;A$1pplications&#x27;
/nix/var/nix/profiles/A
</code></pre>
<p>added one more capture group, <strong>works</strong>:</p>
<pre><code>ic@airstation ~ % which rg | rg &#x27;(default/)(.+)&#x27; --replace &#x27;$1$2&#x27;
/nix/var/nix/profiles/default/bin/rg
</code></pre>
<p>added one more capture group, squeeze string in between, <strong>broken</strong>:</p>
<pre><code>ic@airstation ~ % which rg | rg &#x27;(default/)(.+)&#x27; --replace &#x27;$1Applications$2&#x27;
/nix/var/nix/profiles/bin/rg
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;--replace breaks when concatenating placeholder and string and not vice versa (input provided)&quot; to &quot;--replace breaks when concatenating placeholder and string (input provided)&quot; by <a href="https://github.com/ink-splatters">@ink-splatters</a> on 2023-03-06 10:46</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2023-03-06 12:24</div>
            <div class="timeline-body"><p>The behavior is correct, but the docs are poor. #2108 tracks updating the docs. The docs basically need to pull in the docs from the regex crate capture expansion API, as that is what is used: https://docs.rs/regex/latest/regex/struct.Captures.html#method.expand</p>
<p>For your case, you should be using <code>${1}Applications</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2023-03-06 12:24</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">duplicate</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2023-03-06 12:24</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:12 UTC
    </footer>
</body>
</html>
