<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Using `--max-count` and `--context` together does not correctly display syntax highlighting for matched characters - BurntSushi/ripgrep #2843</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Using <code>--max-count</code> and <code>--context</code> together does not correctly display syntax highlighting for matched characters</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2843">#2843</a>
        opened by <a href="https://github.com/5HT2">@5HT2</a>
        on 2024-06-24 22:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/5HT2">@5HT2</a></div>
            <div class="timeline-body"><h3>Please tick this box to confirm you have reviewed the above.</h3>
<ul>
<li>[X] I have a different issue.</li>
</ul>
<h3>What version of ripgrep are you using?</h3>
<pre><code>ripgrep 14.1.0

features:-simd-accel,+pcre2
simd(compile):+NEON
simd(runtime):+NEON

PCRE2 10.42 is available (JIT is available)
</code></pre>
<h3>How did you install ripgrep?</h3>
<p>Homebrew</p>
<h3>What operating system are you using ripgrep on?</h3>
<pre><code>$ sw_vers
ProductName:		macOS
ProductVersion:		14.2.1
BuildVersion:		23C71
$ uname -r
23.2.0
</code></pre>
<h3>Describe your bug.</h3>
<p>Using both of these flags together produces the expected output, for example, 2 lines of context with 1 match, but still highlights other matches that were not included due to <code>--max-count</code>.</p>
<p><em>Because</em> these matches are only being included because of <code>--context</code>, it's unintuitive and confusing to the user to also highlight the text for the matches that weren't actually included.</p>
<p>Related: https://github.com/BurntSushi/ripgrep/issues/1380</p>
<h3>What are the steps to reproduce the behavior?</h3>
<p>Run <code>rg Pro -m 1 -C 2 therapeutic.txt</code>, you can find this file here:
https://github.com/5HT2C/doses-logger/blob/master/therapeutic.txt</p>
<p>It's also fairly easy to produce a less specific test case yourself on any type of sorted data (where you are just matching the beginning and have context enabled).</p>
<h3>What is the actual behavior?</h3>
<p>Notice how the lines are also suffixed with <code>:</code> before the line number instead of <code>-</code>.</p>
<img width="794" alt="image" src="https://github.com/BurntSushi/ripgrep/assets/17222512/1c0bd437-4fe9-4193-87ac-8f2d11382f7f">

<h3>What is the expected behavior?</h3>
<p>I feel like this would be much more intuitive:</p>
<p><img src="https://github.com/BurntSushi/ripgrep/assets/17222512/9895108f-38c1-4c4b-bf7d-ca08ba0d887a" alt="image" /></p>
<p>I do understand that there is an argument against the behavior I am proposing, wherein a user might be confused by non-highlighted matches, but I feel like that would be encountered less often than the current behavior, and in the proposed case the issue would lie in &quot;user has forgotten they set the <code>--max-context</code> flag&quot; rather than the program's behavior being inconsistent / confusing.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2025-09-23 02:13</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-09-23 02:15</div>
            <div class="timeline-body"><p>I appreciate the request here, but I think the existing behavior is the most reasonable. If I abided your request, there would now be cases where ripgrep could emit a match that isn't actually treated it as a match. I find that stranger than emitting a larger number of matches than <code>--max-count</code> specifies.</p>
<p>The tipping point for me here is that extra contextual lines are specifically requested. Those contextual lines could contain additional matches beyond the limit, regardless of whether ripgrep recognizes them as such. For ripgrep to <em>not</em> recognize them as a match is, IMO, being misleading about what ripgrep actually found.</p>
<p>I added a note about this to the docs of <code>-m/--max-count</code>.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:43:49 UTC
    </footer>
</body>
</html>
