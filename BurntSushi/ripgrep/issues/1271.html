<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Change in behavior of double star in glob - BurntSushi/ripgrep #1271</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Change in behavior of double star in glob</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1271">#1271</a>
        opened by <a href="https://github.com/danadam">@danadam</a>
        on 2019-04-26 18:33
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/danadam">@danadam</a></div>
            <div class="timeline-body"><p>Up until rg 0.7.1, with the following file structure:</p>
<pre><code>mkdir -p foo/test/bar foo/prod/bar
echo &quot;hello&quot; &gt; foo/test/bar/hello.txt
cp foo/test/bar/hello.txt foo/prod/bar/
</code></pre>
<p>If I wanted to match (or exclude) specific dir anywhere in the file path I did:</p>
<pre><code>]$ rg -g&#x27;test/**&#x27; hello
foo/test/bar/hello.txt
1:hello

]$ rg -g&#x27;!test/**&#x27; hello
foo/prod/bar/hello.txt
1:hello
</code></pre>
<p>Using double star at the front worked only with negation:</p>
<pre><code>$ rg -g&#x27;**/test/&#x27; hello
No files were searched, which means ripgrep probably applied a filter you didn&#x27;t expect. Try running again with --debug.

]$ rg -g&#x27;!**/test/&#x27; hello
foo/prod/bar/hello.txt
1:hello
</code></pre>
<p>In rg 0.8.1 this changed. Double star at the end doesn&#x27;t work:</p>
<pre><code>]$ rg -g&#x27;test/**&#x27; hello
No files were searched, which means ripgrep probably applied a filter you didn&#x27;t expect. Try running again with --debug.

]$ rg -g&#x27;!test/**&#x27; hello
foo/test/bar/hello.txt
1:hello

foo/prod/bar/hello.txt
1:hello
</code></pre>
<p>Behavior of double star at the front didn&#x27;t change.</p>
<p>Using double star on both sides, i.e., <code>**/test/**</code> works as expected in both versions.</p>
<p>Is that a bug? Or is <code>**/test/**</code> really the minimal correct pattern that can be simply negated with <code>!</code> and work as expected?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-04-26 19:23</div>
            <div class="timeline-body"><p>Yup, this is indeed correct. I&#x27;m not going to dig around for the specific change that caused this, but <code>test/**</code> should match <code>test/foo</code> but not <code>bar/test/foo</code>. It might make sense to add <code>--include-dir</code> or <code>--exclude-dir</code> flags as part of #809, but that isn&#x27;t much shorter.</p>
<blockquote>
<p>Or is <code>**/test/**</code> really the minimal correct pattern that can be simply negated with ! and work as expected?</p>
</blockquote>
<p>I&#x27;m less sure about this. My thinking is that <code>-g &#x27;*test*&#x27;</code> should also work <em>in this case</em>, but it doesn&#x27;t. However, this matches strictly more things than <code>**/test/**</code>. (<code>*test*</code> should match <code>foo/atestb/bar</code> where as <code>**/test/**</code> shouldn&#x27;t.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-04-26 19:23</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-04-26 19:23</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:08 UTC
    </footer>
</body>
</html>
