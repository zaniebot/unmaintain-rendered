<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allow to pass additional parameters do decompressor - BurntSushi/ripgrep #1916</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Allow to pass additional parameters do decompressor</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1916">#1916</a>
        opened by <a href="https://github.com/marcin-github">@marcin-github</a>
        on 2021-06-28 18:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/marcin-github">@marcin-github</a></div>
            <div class="timeline-body"><p>Hello!
I noticed I can't use ripgrep with files compressed using high compression levels of zstd.</p>
<pre><code>$ rg -z &quot;fooo&quot; bigfile.json.zst
bigfile.json.zst:
-------------------------------------------------------------------------------
bigfile.json.zst : Decoding error (36) : Frame requires too much memory for decoding
bigfile.json.zst : Window size larger than maximum : 268435456 &gt; 134217728
bigfile.json.zst : Use --long=28 or --memory=256MB
-------------------------------------------------------------------------------
</code></pre>
<p>Now I have to pipe file from <code>zstd -dc</code> to <code>rg</code> . It would be nice to have possibility to add &quot;--long=foo&quot; to decompresor. I can't do this using env variables because zstd doesn't support changing this setting via env.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-06-29 10:54</div>
            <div class="timeline-body"><p>@marcin-github Can you use the <code>--pre</code> flag (perhaps in concert with <code>--pre-glob</code>) to work-around this?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by @BurntSushi on 2021-06-29 10:55</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/marcin-github">@marcin-github</a> on 2021-06-30 13:11</div>
            <div class="timeline-body"><p>I read documentation about <code>--pre</code> option. It looks it can be workarround not convenient but makes rg usable:) Thanks.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-06-30 13:31</div>
            <div class="timeline-body"><p>All right, I'm going to close this then. The <code>-z/--search-zip</code> flag is more of a convenience option, and I'm not keen on adding more complexity to that. The <code>--pre</code> flag is really the right choice here, since it's one small entry point into ripgrep that permits a lot of flexibility over how to read data from disk. Consider, for example, what it would take to satisfy your feature request as stated. You can't just say, <code>--decompressor-args &quot;--long=foo&quot;</code> because there are multiple decompressors. So then do you do something like <code>--decompressor-zstd-args</code>? And create one such flag for each decompressor? Or perhaps create a mini-little DSL like how file types work, e.g., <code>--decompressor-args &quot;zstd='--long=foo',gz='...'&quot;</code> and so on. It's a UX nightmare.</p>
<p>Another possibility here is to just bump up the amount of memory we're wiling to let <code>zstd</code> use by default. I would potentially be open to a PR that made such a change, although I'd want to see some analysis on what the downsides are.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2021-06-30 13:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> removed by @BurntSushi on 2021-06-30 13:31</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wontfix</span> added by @BurntSushi on 2021-06-30 13:31</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:43:24 UTC
    </footer>
</body>
</html>
