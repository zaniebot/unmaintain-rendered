<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suggest --auto-fixed-strings for automatically switch to fixed-string mode - BurntSushi/ripgrep #769</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Suggest --auto-fixed-strings for automatically switch to fixed-string mode</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/769">#769</a>
        opened by <a href="https://github.com/wsdjeg">@wsdjeg</a>
        on 2018-02-01 14:27
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/wsdjeg">@wsdjeg</a></div>
            <div class="timeline-body"><p>when using this project as a backgroud tools, I hope there is an option for auto fix string. that means using the pattern as expression all the time. when it contains errors, treat it as a fixed string.</p>
<p>Edit: sorry for long title.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-02-01 14:50</div>
            <div class="timeline-body"><p>This feels very similar to how &quot;smart&quot; case works. Smart case works by looking at the pattern, and if it contains all lowercase letters, then it enables case insensitive search. If there are any uppercase letters though, then case sensitive search is used. The silver searcher enables this by default. ripgrep has it, but is not enabled by default.</p>
<p>It kind of feels like a <code>--smart-fixed-strings</code> flag would be consistent with how <code>--smart-case</code> works.</p>
<p>With that said, I&#x27;m not sure what the use case is here. It doesn&#x27;t really seem like you&#x27;d want this enabled by default, which means you&#x27;d need to selectively enable it. At that point, you might as well just use the <code>-F</code> flag. This feels different from <code>--smart-case</code> in that I imagine the folks that use it probably embed it into an alias. But I don&#x27;t think that&#x27;s the case for <code>--smart-fixed-strings</code>?</p>
<p>Could you elaborate more on the use case here? I know you posted a gif in the other thread and talked about building a tool, but that doesn&#x27;t really tell me much. Why do you specifically need an &quot;auto&quot; or &quot;smart&quot; variant of <code>--fixed-strings</code>? Why doesn&#x27;t just using <code>--fixed-strings</code> work as is?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-02-01 14:50</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wsdjeg">@wsdjeg</a> on 2018-02-03 12:55</div>
            <div class="timeline-body"><p>@BurntSushi in my plugin flygrep.vim, I use a while loop to run <code>rg</code> commend with the input from user. here is the main logic:</p>
<pre><code>let pattern = &#x27;&#x27;

while 1
   let pattern .= nr2char(getchar())
   call jobstart([&#x27;rg&#x27;, &#x27;--hidden&#x27;, &#x27;--no-heading&#x27;, &#x27;--vimgrep&#x27;, &#x27;-S&#x27;, pattern])
endwhile
</code></pre>
<p>I call this kind of plugin is fly on grep, that means it will update result when user input a char.</p>
<p>but when the pattern is not a expression, it will cause error. so I hope there is an option.
then I can use <code>call jobstart([&#x27;rg&#x27;, &#x27;--hidden&#x27;, &#x27;--no-heading&#x27;, &#x27;--vimgrep&#x27;, &#x27;-S&#x27;,  &#x27;--auto-fixed-strings&#x27;, pattern])</code>, if the pattern is not a expression, just treat it as a fixed string, otherwise use it as expression.</p>
<p>and another error is, if the pattern is just same as an option of rg, for example if the patten is <code>--hidden</code>, then this comman also run failed. maybe I should use
<code>call jobstart([&#x27;rg&#x27;, &#x27;--hidden&#x27;, &#x27;--no-heading&#x27;, &#x27;--vimgrep&#x27;, &#x27;-S&#x27;, &#x27;--&#x27;, pattern])</code>, just add an separator before pattern.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-02-03 14:04</div>
            <div class="timeline-body"><blockquote>
<p>and another error is, if the pattern is just same as an option of rg, for example if the patten is --hidden, then this comman also run failed</p>
</blockquote>
<p>To get the easy one out of the way, yes, using <code>--</code> is what you need to do. Alternatively, you can use the <code>-e/--regexp</code> flag followed by the pattern. This is documented in the output of <code>rg --help</code>.</p>
<blockquote>
<p>I call this kind of plugin is fly on grep, that means it will update result when user input a char.</p>
</blockquote>
<p>Oh OK, I understand now. You want to use ripgrep in a context where it is very responsive to user input and don&#x27;t want ripgrep to fail if the pattern the user has typed is incomplete.</p>
<p>Unfortunately, I&#x27;m not sure I agree with your proposed fix. For example, consider the following sequence of characters that I type. Each additional input is labeled with a number so that I refer to it later:</p>
<pre><code>1: a
2: a+
3: a+(
4: a+(z
5: a+(z)
</code></pre>
<p>If ripgrep is invoked with each of these inputs using a hypothetical <code>--auto-fixed-strings</code> or <code>--smart-fixed-strings</code> flag, then there are definitely user visible inconsistencies here that I think I would consider disorienting. For example, (2) would show matches consisting of one or more <code>a</code> characters, but (3) would show matches consisting only of the literal string <code>a+(</code>. Similarly for (4). Once the user hits (5), then you revert back to one or more <code>a</code> characters followed by a single <code>z</code> character.</p>
<p>The result is that these search queries are very different and will lead to very different results, which IMO would make the incremental search quite disorienting!</p>
<p>Honestly, I think that you, as the author of flygrep, need to handle this case yourself in a way that is not disorienting to end users. Of course, I agree that showing an error instead of results because of an incomplete pattern isn&#x27;t great. You might instead consider that if ripgrep reports a syntax error, then flygrep shouldn&#x27;t update the result window and instead keep the previous results. You will also need to handle the case when the user has completed the pattern but committed a real syntax error. I&#x27;m not sure how to handle that, but perhaps a timeout of some sort or some other user feedback (like highlighting the pattern in red or something) would be appropriate.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/wsdjeg">@wsdjeg</a> on 2018-02-03 15:14</div>
            <div class="timeline-body"><p>Thank you for your very detailed answer. I think I have found the solution.</p>
<blockquote>
<p>would make the incremental search quite disorienting!</p>
</blockquote>
<p>and yes,  the number of searching results would look just like electrocardiography.  :) , and I agree with you, this should not be what the user want.</p>
<p>I will use a <code>timer</code> to run rg command, and the result will be shown 200ms after user input. that means if user quick input, this command will not run until the user stop input.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/wsdjeg">@wsdjeg</a> on 2018-02-03 15:14</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/devlinzed">@devlinzed</a> on 2018-02-28 15:41</div>
            <div class="timeline-body"><p>What about using fixed strings when the string is purely alphanumeric?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-02-28 15:48</div>
            <div class="timeline-body"><p>@devlinzed ... why?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-02-28 15:49</div>
            <div class="timeline-body"><p>There is <strong>exactly one</strong> purpose for <code>-F/--fixed-strings</code>: to avoid needing to escape regex meta characters. If you don&#x27;t need to escape meta characters, then there is no need to enable <code>-F/--fixed-strings</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/devlinzed">@devlinzed</a> on 2018-02-28 15:59</div>
            <div class="timeline-body"><p>Sorry, that&#x27;s not the case with grep and I didn&#x27;t consider ripgrep or the regex library might already optimize that case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-02-28 16:16</div>
            <div class="timeline-body"><p>@devlinzed For GNU grep, it certainly is the case as well. It has the same type of optimization as ripgrep. BSD grep might be a different story.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:05 UTC
    </footer>
</body>
</html>
