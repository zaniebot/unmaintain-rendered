<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support decompression flags / smart use of zstd --long - BurntSushi/ripgrep #2781</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Support decompression flags / smart use of zstd --long</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2781">#2781</a>
        opened by <a href="https://github.com/catleeball">@catleeball</a>
        on 2024-04-17 18:19
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/catleeball">@catleeball</a></div>
            <div class="timeline-body"><h3>Issue</h3>
<p>When uzing <code>rg --search-zip</code> to search <code>.zst</code> files, if the file was compressed with special settings like <code>--long</code>, trying to decompress will fail[1] unless you use the corresponding <code>--long</code> flag when decompressing[2].</p>
<h3>Feature request</h3>
<p>It would be nice if either:</p>
<ol>
<li>rg would allow me to pass the compression tool some flags, or</li>
<li>rg could somehow detect if a flag like --long was needed and apply it on decompression</li>
</ol>
<p>Pursing 1 might also be useful for things like passing a dictionary to zstd.</p>
<p>I also opened <a href="https://github.com/facebook/zstd/issues/4028">a bug</a> in the zstd repo to see if they can do some nicer auto-detection. It seems like there could be other useful use-cases for this feature in ripgrep though.</p>
<p>I know this might be niche! But I figured I would raise the issue for people like me who are trying to search corpora that have been aggressively compressed. Then I can just rg the corpora directory like usual without doing some fiddly shell scripting to decompress things properly. :)</p>
<p>Thank you!</p>
<h3>Footnotes</h3>
<p>[1] Example error:</p>
<pre><code>-------------------------------------------------------------------------------                                                                                                               
./submissions/RS_2018-01.zst:                                                                                                                                                                 
-------------------------------------------------------------------------------                                                                                                               
sions/RS_2018-01.zst : Decoding error (36) : Frame requires too much memory for decoding                                                                                                      
sions/RS_2018-01.zst : Window size larger than maximum : 2147483648 &gt; 134217728                                                                                                               
sions/RS_2018-01.zst : Use --long=31 or --memory=2048MB                                                                                                                                       
-------------------------------------------------------------------------------
</code></pre>
<p>[2] In this case, like the error message suggests, I can decompress these files if I use the <code>--long=31</code> flag.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-04-17 20:59</div>
            <div class="timeline-body"><p>This seems like something <code>zstd</code> should be doing. And even if it can't or won't, you can use the <code>--pre</code> flag to handle this case.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2024-04-17 20:59</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:43:47 UTC
    </footer>
</body>
</html>
