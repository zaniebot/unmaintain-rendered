<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature - Add a flag to return the intersection of results if multiple patterns are given  - BurntSushi/ripgrep #2043</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Feature - Add a flag to return the intersection of results if multiple patterns are given</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2043">#2043</a>
        opened by <a href="https://github.com/ctittel">@ctittel</a>
        on 2021-10-26 18:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ctittel">@ctittel</a></div>
            <div class="timeline-body"><p>The flag <code>-e</code> / <code>--regexp</code> allows one to search multiple patterns.</p>
<p>Currently, a search <code>rg -e pattern1 -e pattern2</code> returns the union of the results that would be returned by the two searches <code>rg -e pattern1</code> and <code>rg -e pattern2</code>.
The files returned by <code>rg -e pattern1 -e pattern2</code> are the files that contain at least one of [<code>pattern1</code>, <code>pattern2</code>].</p>
<p>My request is to add a flag (e.g. <code>--conjunction</code>) where files have to contain all the given patterns to be a match.
So the command <code>rg -e pattern1 -e pattern2 --conjunction</code> would return the files that contain both <code>pattern1&#x27;</code> and <code>pattern2</code></p>
<p>Another thing that has to be taken into account here is whether multiline search is performed or not.
If multiline search is performed, the patterns could be allowed to be on different lines, if multiline search is not performed the patterns could be required to all be on the same line.</p>
<p>I currently use this command to iteratively filter the files to get the files where all given patterns are present:</p>
<pre><code>for QUERY in $TERMS; do
   FILES=$(echo &quot;$FILES&quot; | xargs -d $&#x27;\n&#x27; rg -L -H --multiline --multiline-dotall --files-with-matches $QUERY)
done
</code></pre>
<p>Simply constructing a regex like <code>pattern1 .* pattern2</code> is not an option here, because the patterns should be allowed to appear in any order.
For two patterns you would have to search for <code>pattern1 .* pattern2</code> and <code>pattern2 .* pattern1</code>.
For three patterns, there would of course be 6 different orders in which the patterns could appear, etc.</p>
<p>So the flag would not strictly be required in the multiline-search case (as I have demonstrated), but it would be much more elegant.
In the single-line search case however (where you want all patterns in the same line, in any order) such a flag would be required, because the only other way would be to construct a very long and complicated regular expression.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-10-26 19:42</div>
            <div class="timeline-body"><p>Dupe of <a href="https://github.com/BurntSushi/ripgrep/issues/875">BurntSushi/ripgrep#875</a></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-10-26 19:42</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">duplicate</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-10-26 19:42</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/davideuler">@davideuler</a> on 2025-05-26 13:21</div>
            <div class="timeline-body"><p>In case you need the multiple keyword match to implement an AND logic. I&#x27;ve implemented a version to support the feature.</p>
<p>https://github.com/davideuler/ripgrep</p>
<p>Sometimes you need to find lines that contain several specific words, but the order or exact positioning of these words doesn&#x27;t matter. The <code>--and</code> flag is designed for this purpose. It allows you to specify a set of space-separated keywords, and only lines containing <em>all</em> of those keywords will be matched.</p>
<p><strong>Syntax:</strong></p>
<pre><code>rg --and &quot;keyword1 keyword2 keyword3&quot; [path...]
</code></pre>
<p>or with a primary pattern:</p>
<pre><code>rg --and keyword1 --and keyword2 --and keyword3 [path...]
</code></pre>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:11 UTC
    </footer>
</body>
</html>
