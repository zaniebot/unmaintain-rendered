<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rg coloring is disabled in &quot;sh&quot; on embedded Linux(armhf) - BurntSushi/ripgrep #577</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>rg coloring is disabled in &quot;sh&quot; on embedded Linux(armhf)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/577">#577</a>
        opened by <a href="https://github.com/lilianmoraru">@lilianmoraru</a>
        on 2017-08-18 13:30
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lilianmoraru">@lilianmoraru</a></div>
            <div class="timeline-body"><p>I want to note that I tested on another embedded Linux device with &quot;sh&quot;(another system - different projects) and the <code>rg</code> coloring <strong>is working</strong>.
For some reason, on this device it doesn't.</p>
<p>Does <code>rg</code> use different backends for coloring?
<code>clap</code>'s coloring is working correctly, while <code>rg</code>'s coloring is disabled.
Same issue is visible with <code>exa</code>, on the same Linux system.</p>
<p><img src="https://user-images.githubusercontent.com/621738/29460229-d243767c-842f-11e7-957c-a652baae552d.png" alt="image" /></p>
<p><code>ls --color=auto</code> also correctly uses colors on this device.</p>
<p>I understand that there is not enough info to rely on, so I am willing to run commands and test different things to identify the problem.</p>
<p>Side note(maybe says something): The target that <em>does not support</em> coloring has 0 Available space on root <code>/</code> where its home is <code>/root</code>. <code>/root</code> doesn't have any files and also, because of that, you don't have things like reverse history search(<code>Ctrl + R</code>).
On the target that <em>does support</em> coloring: it has free space on root, has reverse search, ...</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-08-18 13:42</div>
            <div class="timeline-body"><p>What does <code>rg --debug</code> say? What is the output of <code>echo $TERM</code>? The color determination rule is pretty simple when printing to a tty: https://github.com/BurntSushi/ripgrep/blob/3d9acdab189006880e9d4ccdbe9ae42b164901ec/termcolor/src/lib.rs#L136-L145</p>
<p>The tty logic is here: https://github.com/BurntSushi/ripgrep/blob/3d9acdab189006880e9d4ccdbe9ae42b164901ec/src/args.rs#L681-L699</p>
<p>Does <code>grep --color=auto -r test</code> show colors?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lilianmoraru">@lilianmoraru</a> on 2017-08-18 23:04</div>
            <div class="timeline-body"><p>I'll try to come with a response next week(I can test this only at work).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lilianmoraru">@lilianmoraru</a> on 2017-08-23 15:34</div>
            <div class="timeline-body"><p><code>rg test --debug</code>:</p>
<pre><code>DEBUG:grep::search: regex ast:
Literal {
    chars: [
        't',
        'e',
        's',
        't'
    ],
    casei: false
}
DEBUG:grep::literals: literal prefixes detected: Literals { lits: [Complete(test)], limit_size: 250, limit_class: 10 }
test.txt
1:test
</code></pre>
<p><code>echo $TERM</code> does not display anything(it is not set)
<code>test -z &quot;${TERM}&quot; &amp;&amp; echo true || echo false</code>: <code>true</code></p>
<p><code>grep --color=auto</code> does not work because it's from <code>busybox</code> and it doesn't support that flag.
Without <code>--color=auto</code>, it does not display red, as it usually does(might be that the <code>busybox</code> version doesn't do that in general, but I am not sure about that - I would expect the busybox version to not do any coloring).</p>
<p>At the same time, <code>ls</code> is also from <code>busybox</code> and if I pass <code>ls --color=auto</code>, it does display colors.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-08-23 15:38</div>
            <div class="timeline-body"><blockquote>
<p><code>echo $TERM</code> does not display anything(it is not set)</p>
</blockquote>
<p>That's your problem. You need to have <code>TERM</code> set to a value that isn't <code>dumb</code>. AFAIK, that's what GNU grep does. I'm not particularly inclined to change it without very strong motivation.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wontfix</span> added by @BurntSushi on 2017-10-22 01:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-10-22 01:02</div>
            <div class="timeline-body"><p>Closing this because I think it's acceptable to require <code>TERM</code> to be set. More generally, I specifically designed ripgrep's coloring to basically do what GNU grep does, and I think it requires strong motivation to diverge from that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2017-10-22 01:02</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:42:15 UTC
    </footer>
</body>
</html>
