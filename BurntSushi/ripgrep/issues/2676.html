<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Failure Inside PowerShell Session - BurntSushi/ripgrep #2676</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Search Failure Inside PowerShell Session</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2676">#2676</a>
        opened by <a href="https://github.com/mattcargile">@mattcargile</a>
        on 2023-12-05 18:57
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mattcargile">@mattcargile</a></div>
            <div class="timeline-body">Please tick this box to confirm you have reviewed the above.
<ul>
<li>[X] I have a different issue.</li>
</ul>
What version of ripgrep are you using?
<pre><code>ripgrep 13.0.0 (rev af6b6c543b)
-SIMD -AVX (compiled)
+SIMD +AVX (runtime)
</code></pre>
How did you install ripgrep?
<pre><code>choco install ripgrep
</code></pre>
What operating system are you using ripgrep on?
<p><em>Microsoft Windows Server 2019 Standard</em></p>
Describe your bug.
<p><em>ripgrep</em> won&#x27;t return matches inside of a PowerShell WinRM ( e.g. WSMAN ) Session. It fails with error code 1.</p>
What are the steps to reproduce the behavior?
<pre><code>Enter-PSSession remoteserver
new-item -itemtype directory rgtemp | cd
new-item t.txt -value &#x27;hello world&#x27;
rg hello
# Check work with
ls *txt | select-string hello
</code></pre>
What is the actual behavior?
<p><em>ripgrep</em> doesn&#x27;t return any results.</p>
<pre><code>[remoteserver]: PS C:\users\user\Documents\rgtemp\&gt; rg --debug hello
DEBUG|grep_regex::literal|crates\regex\src\literal.rs:58: literal prefixes detected: Literals { lits: [Complete(hello)], limit_size: 250, limit_class: 10 }
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:482: gzip: could not find executable in PATH
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:482: gzip: could not find executable in PATH
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:482: bzip2: could not find executable in PATH
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:482: bzip2: could not find executable in PATH
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:482: xz: could not find executable in PATH
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:482: xz: could not find executable in PATH
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:482: lz4: could not find executable in PATH
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:482: xz: could not find executable in PATH
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:482: brotli: could not find executable in PATH
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:482: zstd: could not find executable in PATH
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:482: zstd: could not find executable in PATH
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:482: uncompress: could not find executable in PATH
</code></pre>
What is the expected behavior?
<p><em>ripgrep</em> should return a match for <code>hello</code>. <code>rg</code> does work on the server when I use <code>ssh user@remoteserver</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2023-12-05 19:25</div>
            <div class="timeline-body"><p>I can&#x27;t easily attempt to reproduce this because I can&#x27;t seem to get Powershell to install on my Linux system. (And even then, it&#x27;s not clear it would have the same behavior as on a Windows machine.) I don&#x27;t have an easily available Windows machine to test with.</p>
<p>Usually these types of things are environment or user errors. My first instinct would be to suggest that you have some ignore rules being applied here, but if your <code>--debug</code> output is complete, that  doesn&#x27;t seem to be the case.</p>
<p>Please upgrade to ripgrep 14 and try again, but with <code>--trace</code> instead of <code>--debug</code>. Please post the <em>entire</em> output here.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-01-06 19:08</div>
            <div class="timeline-body"><p>Closing due to inactivity and the likely fact that this is an environment or user error of some kind.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-01-06 19:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">invalid</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-01-06 19:08</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mattcargile">@mattcargile</a> on 2024-01-08 15:36</div>
            <div class="timeline-body"><p>Here is the <code>rg --trace hello</code> output for what it is worth. It still won&#x27;t find the text and doesn&#x27;t output the expected <code>hello</code> text. Even doing <code>Enter-PSSession localhost</code> won&#x27;t work for <em>PowerShell</em> v7.</p>
<pre><code>DEBUG|rg::flags::parse|crates/core\flags\parse.rs:97: no extra arguments found from configuration file
DEBUG|rg::flags::hiargs|crates/core\flags\hiargs.rs:1099: using heuristics to determine whether to read from stdin or search ./ (is_readable_stdin=true, stdin_consumed=false, mode=Search(Standard))
DEBUG|rg::flags::hiargs|crates/core\flags\hiargs.rs:1112: heuristic chose to search stdin
DEBUG|rg::flags::hiargs|crates/core\flags\hiargs.rs:1260: found hostname for hyperlink configuration: RemoteServer
DEBUG|rg::flags::hiargs|crates/core\flags\hiargs.rs:1270: hyperlink format: &quot;&quot;
DEBUG|rg::flags::hiargs|crates/core\flags\hiargs.rs:174: using 1 thread(s)
DEBUG|grep_regex::config|crates\regex\src\config.rs:175: assembling HIR from 1 fixed string literals
TRACE|grep_regex::matcher|crates\regex\src\matcher.rs:66: final regex: &quot;(?:hello)&quot;
TRACE|grep_regex::literal|crates\regex\src\literal.rs:75: skipping inner literal extraction, existing regex is believed to already be accelerated
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:502: gzip: could not find executable in PATH
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:502: gzip: could not find executable in PATH
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:502: bzip2: could not find executable in PATH
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:502: bzip2: could not find executable in PATH
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:502: xz: could not find executable in PATH
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:502: xz: could not find executable in PATH
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:502: lz4: could not find executable in PATH
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:502: xz: could not find executable in PATH
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:502: brotli: could not find executable in PATH
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:502: zstd: could not find executable in PATH
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:502: zstd: could not find executable in PATH
DEBUG|grep_cli::decompress|crates\cli\src\decompress.rs:502: uncompress: could not find executable in PATH
TRACE|rg::search|crates/core\search.rs:254: &lt;stdin&gt;: binary detection: BinaryDetection(Convert(0))
TRACE|grep_searcher::searcher|crates\searcher\src\searcher\mod.rs:743: generic reader: searching via roll buffer strategy
TRACE|grep_searcher::searcher::core|crates\searcher\src\searcher\core.rs:65: searcher core: will use fast line searcher
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-01-08 15:43</div>
            <div class="timeline-body"><p>The answer appears to be right there in the 2nd and 3rd log lines:</p>
<pre><code>DEBUG|rg::flags::hiargs|crates/core\flags\hiargs.rs:1099: using heuristics to determine whether to read from stdin or search ./ (is_readable_stdin=true, stdin_consumed=false, mode=Search(Standard))
DEBUG|rg::flags::hiargs|crates/core\flags\hiargs.rs:1112: heuristic chose to search stdin
</code></pre>
<p>I have no clue what a &quot;PowerShell WinRM ( e.g. WSMAN ) Session&quot; is, but whatever it is, it appears to be making it look like there is something on stdin. So ripgrep searches that.</p>
<p>Your chosen environment likely means you cannot rely on ripgrep&#x27;s automatic detection of stdin. So you&#x27;ll need to pass an a directory to search. So for example, <code>rg hello .</code> and not <code>rg hello</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mattcargile">@mattcargile</a> on 2024-01-08 15:54</div>
            <div class="timeline-body"><p>No kidding! Yeah that did fix it.</p>
<p>I&#x27;m surprised someone hasn&#x27;t hit this before. <em>PowerShell WinRM</em> is <em>Microsoft&#x27;s</em> iteration of an &quot;ssh-like&quot; remoting tech based on <em>SOAP</em> and <em>HTTP</em>. It is the primary way to interface with remote <em>Windows</em> machines from a <em>Windows</em> client ( though that is changing ).</p>
<p>Not wanting to explore how the heuristic is working in this config, I suppose?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-01-08 16:01</div>
            <div class="timeline-body"><p>In theory if there&#x27;s a way to adjust the heuristic such that it has no regressions, then I&#x27;d be okay with it. But, there is a very very very high barrier to me accepting such a change. For several reasons:</p>
<ol>
<li>It is basically impossible for me to test. There are lots of different environments and I don&#x27;t even know about all of them. And I don&#x27;t have an easy way to test on Windows right now.</li>
<li>I have changed this heuristic in the past, and it breaks people. This leads to pain and frustration. In some cases, the break was intentional because there is literally no way to do it correctly in all cases.</li>
<li>From what I can tell, your <em>environment</em> is what should be fixed. Not ripgrep. This might sound crazy, but it&#x27;s actually pretty common in my experience for environments to senselessly try to attach something on stdin even though nothing is there. This almost certainly breaks things other than ripgrep. Even projects like neovim <a href="https://github.com/neovim/neovim/pull/14812">alter or make available new functionality to fix such things</a>.</li>
</ol>
<p>If you&#x27;re curious, this is where the implementation of the heuristic lives:</p>
<p>https://github.com/BurntSushi/ripgrep/blob/648a65f1976cc3b7eb66425024649d71d5befe1e/crates/cli/src/lib.rs#L152-L201</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:13 UTC
    </footer>
</body>
</html>
