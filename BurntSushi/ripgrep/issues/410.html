<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Different behavior when spawned on windows vs MacOS - BurntSushi/ripgrep #410</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Different behavior when spawned on windows vs MacOS</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/410">#410</a>
        opened by <a href="https://github.com/roblourens">@roblourens</a>
        on 2017-03-16 02:49
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/roblourens">@roblourens</a></div>
            <div class="timeline-body"><p>Basically, when I spawn a ripgrep process, i.e. run it not in a TTY, on Windows, there is no output. It&#x27;s probably trying to search stdin. On MacOS, it searches the <code>cwd</code>, which I think is what I&#x27;d expect.</p>
<p>Probably a simpler way to demonstrate the issue, but run this in node.js and observe the difference in Windows vs Mac.</p>
<pre><code>const cp = require(&#x27;child_process&#x27;);

let p = cp.spawn(&#x27;rg&#x27;, [&#x27;foo&#x27;], { cwd: &#x27;&lt;some path&gt;&#x27;})
p.stdout.on(&#x27;data&#x27;, data =&gt; {
    console.log(&#x27;stdout: &#x27; + data.toString());
});

p.stderr.on(&#x27;data&#x27;, data =&gt; {
    console.log(&#x27;stderr: &#x27; + data.toString());
});

p.on(&#x27;close&#x27;, code =&gt; {
    console.log(&#x27;closed: &#x27; + code);
});
</code></pre>
<p>I can easily work around it by adding <code>-- &lt;path to search&gt;</code> to the args list, so it&#x27;s not blocking anything.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-03-16 11:21</div>
            <div class="timeline-body"><p>OK, so a lot of blood, sweat and tears have gone into fixing bugs like this on Windows. :-) I&#x27;ll lay out the decision procedure for you on Windows. If ripgrep is called with no file paths, then it must either decide to search the CWD or to search stdin. It will search the CWD if and only if there is a console attached to stdin (<a href="https://github.com/softprops/atty/blob/db8d55f88eabfcc22cde39533c2b1d688d1cdfc6/src/lib.rs#L51">as determined by GetConsoleMode</a>). I think that since you&#x27;re calling it as a process, then no console is detected, and therefore ripgrep assumes something is on stdin.</p>
<p>Now, on Unix, there&#x27;s an extra step here. Namely, even if there is no tty/console present, ripgrep will look to see <a href="https://github.com/BurntSushi/ripgrep/blob/95bc678403b63d98b717636e79fdfbabc8949c8a/src/args.rs#L948">if stdin is <em>readable</em></a>, which is done by checking that stdin is either a proper file or a fifo. If stdin isn&#x27;t readable, then ripgrep will search the CWD.</p>
<p>This extra logic on Windows doesn&#x27;t exist mostly because I don&#x27;t know how to do it. Paging @retep998 :-)</p>
<blockquote>
<p>I can easily work around it by adding --  to the args list, so it&#x27;s not blocking anything.</p>
</blockquote>
<p>For the best results, I think you probably want to set your CWD to <code>&lt;path to search&gt;</code> and then use <code>./</code> as the path. (This will let you work around #278, which is probably unlikely to come up anyway.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-03-16 11:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/roblourens">@roblourens</a> on 2017-03-16 14:55</div>
            <div class="timeline-body"><p>I see, thanks for the tip!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-10-22 01:52</div>
            <div class="timeline-body"><p>I am going to close this because it seems like ripgrep is working as intended.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-10-22 01:52</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-10-23 11:08</div>
            <div class="timeline-body"><p>I wonder if this might actually be a duplicate of #643. I wrote up my thoughts here: <a href="https://github.com/BurntSushi/ripgrep/issues/643">BurntSushi/ripgrep#643</a>#issuecomment-338624955</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/gugahoa">@gugahoa</a> on 2019-04-01 05:25</div>
            <div class="timeline-body"><p>I believe I&#x27;m facing this same issue, but I can&#x27;t seem to work out any of the solutions so far.
This code is being run on Linux, 5.0.2:
https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=65f9f17d796fc8ed4c080109d577baf4</p>
<p>What could be the reason?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-04-01 11:19</div>
            <div class="timeline-body"><p>@gugahoa You&#x27;re not running into the same issue. Your command is incorrect. Try this instead: https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=0a8438a96ed5641f5be1c0161265689d</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:03 UTC
    </footer>
</body>
</html>
