<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certain ignore patterns are affecting whether others are respected - BurntSushi/ripgrep #1210</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Certain ignore patterns are affecting whether others are respected</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1210">#1210</a>
        opened by <a href="https://github.com/dpatti">@dpatti</a>
        on 2019-03-06 16:18
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dpatti">@dpatti</a></div>
            <div class="timeline-body">What version of ripgrep are you using?
<pre><code>$ rg --version
ripgrep 0.10.0 (rev 8a7db1a918)
-SIMD -AVX (compiled)
+SIMD +AVX (runtime)
</code></pre>
How did you install ripgrep?
<p>This is the distributed 0.10.0 release for <code>x86_64-unknown-linux-musl</code></p>
What operating system are you using ripgrep on?
<p>CentOS Linux 7.6.1810</p>
If this is a bug, what are the steps to reproduce the behavior?
<p>This will reproduce the issue on my machine:</p>
<pre><code>$ echo foo &gt; foo.bc.js
$ rg -g &#x27;!*.bc.js&#x27; --no-ignore foo
$ rg -g &#x27;!*.bc.js&#x27; -g &#x27;!*.build_info.c&#x27; --no-ignore foo
$ rg -g &#x27;!*.build_info.c&#x27; -g &#x27;!*.bc.js&#x27; --no-ignore foo
foo.bc.js
1:foo
$ rg -g &#x27;!*.bald_info.c&#x27; -g &#x27;!*.bc.js&#x27; --no-ignore foo
$
</code></pre>
<p>This was originally discovered with <code>.ignore</code> files, but it looks like it extends to <code>-g</code> flags as well. What is happening here is: I would expect the <code>foo.bc.js</code> file we created to be ignored like it is in most of these invocations. However specifically the third one where we specify <code>!*.build_info.c</code> first, it is <em>not</em> ignored. It seems like certain strings will trigger this, and some will not, as the fourth invocation demonstrates.</p>
<p>Here&#x27;s the debug output from the failing command:</p>
<pre><code>$ rg -g &#x27;!*.build_info.c&#x27; -g &#x27;!*.bc.js&#x27; --no-ignore foo --debug
DEBUG|grep_regex::literal|grep-regex/src/literal.rs:58: literal prefixes detected: Literals { lits: [Complete(FOO), Complete(fOO), Complete(FoO), Complete(foO), Complete(FOo), Complete(fOo), Complete(Foo), Complete(foo)], limit_size: 250, limit_class: 10 }
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 0 extensions, 0 prefixes, 2 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG|globset|globset/src/lib.rs:429: built glob set; 0 literals, 0 basenames, 8 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
foo.bc.js
1:foo
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-03-06 16:46</div>
            <div class="timeline-body"><p>This appears to be fixed on master. My guess is that this was due to a literal matching bug in the regex engine (which powers globs), but I&#x27;m not certain. Others are welcome to do a bisect to find the exact place where this was fixed. :-)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-03-06 16:46</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-03-06 16:46</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:08 UTC
    </footer>
</body>
</html>
