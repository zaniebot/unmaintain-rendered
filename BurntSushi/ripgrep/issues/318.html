<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Many file skipped for unknown reasons - BurntSushi/ripgrep #318</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Many file skipped for unknown reasons</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/318">#318</a>
        opened by <a href="https://github.com/lzybkr">@lzybkr</a>
        on 2017-01-13 21:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/lzybkr">@lzybkr</a></div>
            <div class="timeline-body"><p>On Windows 10, I&#x27;m seeing fewer results than expected, plus fewer matches when ignoring case.</p>
<pre><code>C:\Windows&gt;cd %SYSTEMROOT%\System32\WindowsPowerShell\v1.0\Modules

C:\Windows\System32\WindowsPowerShell\v1.0\Modules&gt;rg Copyright
AssignedAccess\AssignedAccess.psd1
7:Copyright = &#x27;(c) Microsoft Corporation. All rights reserved.&#x27;

AppBackgroundTask\AppBackgroundTask.psd1
5:    Copyright = &#x27;
C:\Windows\System32\WindowsPowerShell\v1.0\Modules&gt;rg -i Copyright
AppBackgroundTask\AppBackgroundTask.psd1
5:    Copyright = &#x27;
C:\Windows\System32\WindowsPowerShell\v1.0\Modules&gt;findstr /S Copyright *.psd1
AppBackgroundTask\AppBackgroundTask.psd1:    Copyright = &#x27;⌐ Microsoft Corporation. All rights reserved.&#x27;
AppvClient\AppvClient.psd1:Copyright = &#x27;⌐ Microsoft Corporation. All rights reserved.&#x27;
Appx\Appx.psd1:    Copyright = &quot;┬⌐ Microsoft Corporation. All rights reserved.&quot;
AssignedAccess\AssignedAccess.psd1:Copyright = &#x27;(c) Microsoft Corporation. All rights reserved.&#x27;
BranchCache\BranchCache.psd1:    Copyright=&quot;⌐ Microsoft Corporation. All rights reserved.&quot;
ConfigCI\ConfigCI.psd1:Copyright=&quot;⌐ Microsoft Corporation. All rights reserved.&quot;
Containers\1.0.0.0\Containers.psd1:# Copyright statement for this module
Containers\1.0.0.0\Containers.psd1:Copyright = &#x27;(c) 2015 Microsoft Corporation. All rights reserved.&#x27;
Defender\Defender.psd1:    Copyright=&quot;⌐ Microsoft Corporation. All rights reserved.&quot;
...
</code></pre>
<p>Notice 2 matches from the case sensitive search, 1 from the case-insensitive search, and many matches using findstr (with many omitted.)</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-01-13 21:43</div>
            <div class="timeline-body"><p>Can you run <code>rg</code> with the <code>--debug</code> flag and show the output here?</p>
<p>Also, what version of ripgrep are you running? See <code>rg --version</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lzybkr">@lzybkr</a> on 2017-01-13 21:46</div>
            <div class="timeline-body"><p>Sure:</p>
<pre><code>#5 PS&gt; rg --debug Copyright
DEBUG:grep::search: regex ast:
Literal {
    chars: [
        &#x27;C&#x27;,
        &#x27;o&#x27;,
        &#x27;p&#x27;,
        &#x27;y&#x27;,
        &#x27;r&#x27;,
        &#x27;i&#x27;,
        &#x27;g&#x27;,
        &#x27;h&#x27;,
        &#x27;t&#x27;
    ],
    casei: false
}
DEBUG:grep::literals: literal prefixes detected: Literals { lits: [Complete(Copyright)], limit_size: 250, limit_class: 10 }
AssignedAccess\AssignedAccess.psd1
7:Copyright = &#x27;(c) Microsoft Corporation. All rights reserved.&#x27;

AppBackgroundTask\AppBackgroundTask.psd1
5:    Copyright = &#x27;
@ C:\Windows\System32\WindowsPowerShell\v1.0\Modules
#6 PS&gt; rg --debug -i Copyright
DEBUG:grep::search: regex ast:
Literal {
    chars: [
        &#x27;C&#x27;,
        &#x27;o&#x27;,
        &#x27;p&#x27;,
        &#x27;y&#x27;,
        &#x27;r&#x27;,
        &#x27;i&#x27;,
        &#x27;g&#x27;,
        &#x27;h&#x27;,
        &#x27;t&#x27;
    ],
    casei: true
}
DEBUG:grep::literals: required literals found: [Cut(COPYR), Cut(cOPYR), Cut(CoPYR), Cut(coPYR), Cut(COpYR), Cut(cOpYR), Cut(CopYR), Cut(copYR), Cut(COPyR), Cut(cOPyR), Cut(CoPyR), Cut(coPyR), Cut(COpyR), Cut(cOpyR), Cut(CopyR), Cut(copyR), Cut(COPYr), Cut(cOPYr), Cut(CoPYr), Cut(coPYr), Cut(COpYr), Cut(cOpYr), Cut(CopYr), Cut(copYr), Cut(COPyr), Cut(cOPyr), Cut(CoPyr), Cut(coPyr), Cut(COpyr), Cut(cOpyr), Cut(Copyr), Cut(copyr)]
AssignedAccess\AssignedAccess.psd1
7:Copyright = &#x27;(c) Microsoft Corporation. All rights reserved.&#x27;

AppBackgroundTask\AppBackgroundTask.psd1
5:    Copyright = &#x27;
@ C:\Windows\System32\WindowsPowerShell\v1.0\Modules
#7 PS&gt; rg --version
ripgrep 0.3.2
</code></pre>
<p>This is the latest release (I think) - I also tested with something I built after from my PR which I think is newer than this release, but saw the same results.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-01-13 22:48</div>
            <div class="timeline-body"><p>Interestingly, <code>rg -i Copyright</code> in your second comment has different output than <code>rg -i Copyright</code> in your first comment. Are the results changing from run to run?</p>
<p>Is there anyway you can reproduce this on a public repo of code so I can try?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lzybkr">@lzybkr</a> on 2017-01-13 23:52</div>
            <div class="timeline-body"><p>Try exactly what I posted in my first message - you should see similar results on most Windows machines - I used the latest supported Windows 10 release, but I would expect similar results in earlier versions of Windows.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-01-14 00:07</div>
            <div class="timeline-body"><p>Hmm, your directory has a lot more stuff in it than my Windows 7 VM. Let me boot up my Windows 10 laptop.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-01-14 00:28</div>
            <div class="timeline-body"><p>Did you compile ripgrep from source? Or did you download a <a href="https://github.com/BurntSushi/ripgrep/releases">release</a>?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-01-14 01:52</div>
            <div class="timeline-body"><p>I think I&#x27;ve figured out the problem here. If you do this: <code>rg Copyright &gt; output</code> and then look at the contents of <code>output</code>, do you see the results you expect?</p>
<p>If so, then I think the problem here is that some of the files you&#x27;re searching contain invalid UTF-8, and Rust&#x27;s standard library by default returns an error if you try to write invalid UTF-8 to the console. (The reason why is because UTF-8 needs to be transcoded to UTF-16 to write to the console.) I think the right answer here is to lossily decode the UTF-8 before sending it to <code>stdout</code>.</p>
<p>This UTF-8 check doesn&#x27;t happen if you write to a file, which is why redirecting to stdout should produce the expected output.</p>
<p>The reason why no error is printed is because ripgrep isn&#x27;t checking an error when writing to stdout, which is bug #200.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-01-14 02:21</div>
            <div class="timeline-body"><p>In PowerShell, if I do <code>rg foo | echo</code>, then I get the correct output.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-01-14 04:00</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-01-14 04:21</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/lzybkr">@lzybkr</a> on 2017-01-18 03:21</div>
            <div class="timeline-body"><p>Much better now, thanks.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:03 UTC
    </footer>
</body>
</html>
