<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Running ripgrep in a Docker build requires [PATH] to be specified - BurntSushi/ripgrep #2934</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Running ripgrep in a Docker build requires [PATH] to be specified</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2934">#2934</a>
        opened by <a href="https://github.com/dvdksn">@dvdksn</a>
        on 2024-11-15 16:03
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/dvdksn">@dvdksn</a></div>
            <div class="timeline-body">Please tick this box to confirm you have reviewed the above.
<ul>
<li>[X] I have a different issue.</li>
</ul>
What version of ripgrep are you using?
<p>Tested with:
ripgrep 13.0.0 (Debian)
ripgrep 14.1.0 (Alpine Linux)</p>
How did you install ripgrep?
<p><code>apk add ripgrep</code>
<code>apt install ripgrep</code></p>
What operating system are you using ripgrep on?
<p>Debian 12, Alpine Linux 3.20.3 (both in Docker)</p>
Describe your bug.
<p><code>rg</code> runs fine without a path argument if you do it interactively. But for some reason, when I try to run <code>rg</code> in a Docker build, it would always error out unless I specify the positional argument for <code>[PATH]</code>.</p>
<p>The following interactive use case works fine:</p>
<ol>
<li>Start an interactive <code>alpine</code> container (with workdir <code>/etc</code> in this case)</li>
</ol>
<pre><code>$ docker run -it -w /etc alpine
</code></pre>
<ol>
<li>Install ripgrep in the container:</li>
</ol>
<pre><code>/etc # apk add ripgrep
fetch https://dl-cdn.alpinelinux.org/alpine/v3.20/main/aarch64/APKINDEX.tar.gz
fetch https://dl-cdn.alpinelinux.org/alpine/v3.20/community/aarch64/APKINDEX.tar.gz
(1/3) Installing libgcc (13.2.1_git20240309-r0)
(2/3) Installing pcre2 (10.43-r0)
(3/3) Installing ripgrep (14.1.0-r0)
Executing busybox-1.36.1-r29.trigger
OK: 13 MiB in 17 packages
</code></pre>
<ol>
<li>Execute:</li>
</ol>
<pre><code>/etc # rg alpinelinux.org
motd
5:See &lt;https://wiki.alpinelinux.org/&gt;.

os-release
5:HOME_URL=&quot;https://alpinelinux.org/&quot;
6:BUG_REPORT_URL=&quot;https://gitlab.alpinelinux.org/alpine/aports/-/issues&quot;

modprobe.d/blacklist.conf
83:# https://gitlab.alpinelinux.org/alpine/aports/-/issues/12999

secfixes.d/alpine
1:https://secdb.alpinelinux.org/v3.20/main.json
2:https://secdb.alpinelinux.org/v3.20/community.json

apk/repositories
1:https://dl-cdn.alpinelinux.org/alpine/v3.20/main
2:https://dl-cdn.alpinelinux.org/alpine/v3.20/community
</code></pre>
What are the steps to reproduce the behavior?
<p>Run the same steps as above but via a Dockerfile, you&#x27;ll get an error.</p>
<pre><code>$ docker build -&lt;&lt;EOF
FROM alpine
WORKDIR /etc
RUN apk add ripgrep
RUN rg alpinelinux.org
EOF
</code></pre>
<pre><code>[+] Building 0.2s (8/8) FINISHED                                                            docker:desktop-linux
 =&gt; [internal] connecting to local controller                                                               0.0s
 =&gt; [internal] load build definition from Dockerfile                                                        0.0s
 =&gt; =&gt; transferring dockerfile: 105B                                                                        0.0s
 =&gt; [internal] load metadata for docker.io/library/alpine:latest                                            0.0s
 =&gt; [internal] load .dockerignore                                                                           0.0s
 =&gt; =&gt; transferring context: 2B                                                                             0.0s
 =&gt; [1/4] FROM docker.io/library/alpine:latest@sha256:1e42bbe2508154c9126d48c2b8a75420c3544343bf86fd041fb7  0.0s
 =&gt; =&gt; resolve docker.io/library/alpine:latest@sha256:1e42bbe2508154c9126d48c2b8a75420c3544343bf86fd041fb7  0.0s
 =&gt; CACHED [2/4] WORKDIR /etc                                                                               0.0s
 =&gt; CACHED [3/4] RUN apk add ripgrep                                                                        0.0s
 =&gt; ERROR [4/4] RUN rg alpinelinux.org                                                                      0.1s
------
 &gt; [4/4] RUN rg alpinelinux.org:
------
Dockerfile:4
--------------------
   2 |     WORKDIR /etc
   3 |     RUN apk add ripgrep
   4 | &gt;&gt;&gt; RUN rg alpinelinux.org
   5 |     
--------------------
ERROR: process &quot;/bin/sh -c rg alpinelinux.org&quot; did not complete successfully: exit code: 1
</code></pre>
What is the actual behavior?
<pre><code>$ docker build --no-cache --progress=plain -&lt;&lt;EOF
FROM alpine
WORKDIR /etc
RUN apk add ripgrep
RUN rg --debug alpinelinux.org
EOF
</code></pre>
<pre><code>#0 building with &quot;desktop-linux&quot; instance using docker driver

#1 [internal] connecting to local controller
#1 DONE 0.0s

#2 [internal] load build definition from Dockerfile
#2 transferring dockerfile: 113B done
#2 DONE 0.0s

#3 [internal] load metadata for docker.io/library/alpine:latest
#3 DONE 0.0s

#4 [internal] load .dockerignore
#4 transferring context: 2B done
#4 DONE 0.0s

#5 [1/4] FROM docker.io/library/alpine:latest@sha256:1e42bbe2508154c9126d48c2b8a75420c3544343bf86fd041fb7527e017a4b4a
#5 resolve docker.io/library/alpine:latest@sha256:1e42bbe2508154c9126d48c2b8a75420c3544343bf86fd041fb7527e017a4b4a done
#5 DONE 0.0s

#6 [2/4] WORKDIR /etc
#6 CACHED

#7 [3/4] RUN apk add ripgrep
#7 0.076 fetch https://dl-cdn.alpinelinux.org/alpine/v3.20/main/aarch64/APKINDEX.tar.gz
#7 0.196 fetch https://dl-cdn.alpinelinux.org/alpine/v3.20/community/aarch64/APKINDEX.tar.gz
#7 0.396 (1/3) Installing libgcc (13.2.1_git20240309-r0)
#7 0.407 (2/3) Installing pcre2 (10.43-r0)
#7 0.502 (3/3) Installing ripgrep (14.1.0-r0)
#7 0.543 Executing busybox-1.36.1-r29.trigger
#7 0.547 OK: 13 MiB in 17 packages
#7 DONE 0.6s

#8 [4/4] RUN rg --debug alpinelinux.org
#8 0.099 rg: DEBUG|rg::flags::parse|crates/core/flags/parse.rs:97: no extra arguments found from configuration file
#8 0.099 rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1099: using heuristics to determine whether to read from stdin or search ./ (is_readable_stdin=true, stdin_consumed=false, mode=Search(Standard))
#8 0.099 rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1112: heuristic chose to search stdin
#8 0.099 rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1260: found hostname for hyperlink configuration: buildkitsandbox
#8 0.099 rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1270: hyperlink format: &quot;&quot;
#8 0.099 rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:174: using 1 thread(s)
#8 0.100 rg: DEBUG|globset|crates/globset/src/lib.rs:453: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
#8 ERROR: process &quot;/bin/sh -c rg --debug alpinelinux.org&quot; did not complete successfully: exit code: 1
------
 &gt; [4/4] RUN rg --debug alpinelinux.org:
0.099 rg: DEBUG|rg::flags::parse|crates/core/flags/parse.rs:97: no extra arguments found from configuration file
0.099 rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1099: using heuristics to determine whether to read from stdin or search ./ (is_readable_stdin=true, stdin_consumed=false, mode=Search(Standard))
0.099 rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1112: heuristic chose to search stdin
0.099 rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1260: found hostname for hyperlink configuration: buildkitsandbox
0.099 rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1270: hyperlink format: &quot;&quot;
0.099 rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:174: using 1 thread(s)
0.100 rg: DEBUG|globset|crates/globset/src/lib.rs:453: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
------
Dockerfile:4
--------------------
   2 |     WORKDIR /etc
   3 |     RUN apk add ripgrep
   4 | &gt;&gt;&gt; RUN rg --debug alpinelinux.org
   5 |     
--------------------
ERROR: process &quot;/bin/sh -c rg --debug alpinelinux.org&quot; did not complete successfully: exit code: 1
</code></pre>
What is the expected behavior?
<p>I didn&#x27;t expect the <code>[PATH]</code> argument to be necessary if I want to query the CWD.</p>
<p>Running the same <code>docker build</code> but with a path argument (<code>.</code>) results in no error.</p>
<pre><code>$ docker build --no-cache -&lt;&lt;EOF
FROM alpine
WORKDIR /etc
RUN apk add ripgrep
RUN rg alpinelinux.org .
EOF
[+] Building 1.5s (9/9) FINISHED                                                            docker:desktop-linux
 =&gt; [internal] connecting to local controller                                                               0.0s
 =&gt; [internal] load build definition from Dockerfile                                                        0.0s
 =&gt; =&gt; transferring dockerfile: 107B                                                                        0.0s
 =&gt; [internal] load metadata for docker.io/library/alpine:latest                                            0.0s
 =&gt; [internal] load .dockerignore                                                                           0.0s
 =&gt; =&gt; transferring context: 2B                                                                             0.0s
 =&gt; [1/4] FROM docker.io/library/alpine:latest@sha256:1e42bbe2508154c9126d48c2b8a75420c3544343bf86fd041fb7  0.0s
 =&gt; =&gt; resolve docker.io/library/alpine:latest@sha256:1e42bbe2508154c9126d48c2b8a75420c3544343bf86fd041fb7  0.0s
 =&gt; CACHED [2/4] WORKDIR /etc                                                                               0.0s
 =&gt; [3/4] RUN apk add ripgrep                                                                               0.5s
 =&gt; [4/4] RUN rg alpinelinux.org .                                                                          0.1s
 =&gt; exporting to image                                                                                      0.2s
 =&gt; =&gt; exporting layers                                                                                     0.2s 
 =&gt; =&gt; exporting manifest sha256:7d99046d509ea55010ab077d45972f0091082ab94301ed0ab203cc33bd503d4b           0.0s 
 =&gt; =&gt; exporting config sha256:d902690c8d0622c14a76bb0dda908579850b504d9fa3281e89deaf5c4e3250f1             0.0s 
 =&gt; =&gt; exporting attestation manifest sha256:25a938de608a651b20953ac654bad26bac4feaaa515d3a98d6d520d1d4911  0.0s
 =&gt; =&gt; exporting manifest list sha256:290ad615981b729f42de884bac44ca06ff52c08c45cd7059bd5ccb3d141c8817      0.0s
 =&gt; =&gt; naming to moby-dangling@sha256:290ad615981b729f42de884bac44ca06ff52c08c45cd7059bd5ccb3d141c8817      0.0s
 =&gt; =&gt; unpacking to moby-dangling@sha256:290ad615981b729f42de884bac44ca06ff52c08c45cd7059bd5ccb3d141c8817   0.0s
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-11-15 16:09</div>
            <div class="timeline-body"><p>It&#x27;s likely because whatever is responsible for running ripgrep is advertising a readable stdin. You should be able to clearly see this given the <code>--debug</code> messages you&#x27;re getting:</p>
<pre><code>#8 0.099 rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1099: using heuristics to determine whether to read from stdin or search ./ (is_readable_stdin=true, stdin_consumed=false, mode=Search(Standard))
#8 0.099 rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1112: heuristic chose to search stdin
</code></pre>
<p>And also from the man page:</p>
<pre><code>       ripgrep  will  automatically  detect  if stdin exists and search
       stdin for a regex pattern, e.g. ls | rg foo.  In  some  environ‐
       ments,  stdin may exist when it shouldn&#x27;t. To turn off stdin de‐
       tection, one can explicitly specify  the  directory  to  search,
       e.g. rg foo ./.
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-11-15 16:09</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wontfix</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2024-11-15 16:09</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/alexyao2015">@alexyao2015</a> on 2025-07-11 16:45</div>
            <div class="timeline-body"><p>I recently ran into this same issue and debugged it for quite sometime. It seems like this would be worth noting in the readme.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:14 UTC
    </footer>
</body>
</html>
