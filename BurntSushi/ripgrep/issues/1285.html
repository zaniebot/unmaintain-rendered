<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color not switching back correctly after interrupt - BurntSushi/ripgrep #1285</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Color not switching back correctly after interrupt</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1285">#1285</a>
        opened by <a href="https://github.com/sturdevant">@sturdevant</a>
        on 2019-05-25 05:10
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/sturdevant">@sturdevant</a></div>
            <div class="timeline-body"><h4>What version of ripgrep are you using?</h4>
<p>ripgrep 11.0.1</p>
<h4>How did you install ripgrep?</h4>
<p>installed with Cargo install</p>
<h4>What operating system are you using ripgrep on?</h4>
<p>Ubuntu 19.04</p>
<h4>Describe your question, feature request, or bug.</h4>
<p>Minor cosmetic bug, when I Ctrl-C (or Ctrl-\) in the middle of ripgrep while it's printing text in red (likely other colors too, but I've only been able to reliably reproduce it in red), the terminal that I ran ripgrep in will only print text in red from then on (unless I close the terminal or run <code>reset</code>). I suspect that before ripgrep outputs text in red, it's changing some environment variable to change the font color to red, then it prints everything that it would print in red, then it sets the color back, etc. It seems to handle things properly when the process is left to terminate on its own, but when it terminates prematurely, say from a SIGINT or SIGQUIT, it isn't being handled correctly, so there should be some cleanup code in the SIGINT and SIGQUIT handlers that resets the color back to what it originally was before running ripgrep.</p>
<h4>If this is a bug, what are the steps to reproduce the behavior?</h4>
<p>If you run something like:</p>
<p><code>ripgrep -r &quot;blah&quot; .</code></p>
<p>from a directory that has a lot of files / subdirectories with a lot of files that ripgrep won't skip over (in my case, from my home directory which is about 50GB in size when including size of all subdirectories, would likely work with a smaller size too, but it at least has to be big enough so ripgrep doesn't finish too fast), then while it's printing a bunch of red text, try to time the Ctrl-C to be sent in the middle of it printing a line in red (as in, if it were left to keep running w/o the SIGINT, it would have continued to print more in red). The timing can be tricky, since if it's not in the middle of it printing in red (as in the color has been reset after a line is printed), then the bug won't appear. I've found it's very easy to reproduce if you change &quot;blah&quot; to a veeeeerrryyy ridiculously long string, so feel free to try that if it helps. (somewhat amusing note, I found this bug by trying to use ripgrep like it was grep, but I didn't realize the '-r' option was for replacing the text of matches rather than recursive search, so at first I was very confused why I had <strong>so</strong> many files that seemed to match, and thought there was a more serious bug, but then I decided to actually run with '--help', and when I read the description for what '-r' actually does, everything made a <em>lot</em> more sense, lol, <em>everything</em> matched because <em><strong>I told it to</strong></em>).</p>
<h4>If this is a bug, what is the actual behavior?</h4>
<p>Everything is in red text, I don't think the actual contents are so much important so kind of N/A, so I haven't included a full printout, but if you're curious, it's a lot of red blah's, then a red &quot;^C&quot;, then red prompt, then red everything, there's just soooo much RED everywhere!!! I thought my terminal was bleeding.</p>
<h4>If this is a bug, what is the expected behavior?</h4>
<p>To have the terminal's text color reset to what it originally was before running ripgrep after ripgrep receives a signal.</p>
<p>What do you think ripgrep should have done?
Handle SIGINT (and SIGQUIT, SIGTERM, and SIGTSTP, might be others, but I didn't test any of the more obscure ones like SIGHUP or any ones that you obviously can't do anything about like SIGKILL) by resetting back to the terminal's default text color before exiting (in the case for my terminal, black text).</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2019-05-25 08:08</div>
            <div class="timeline-body"><p>This is a duplicate. See: https://github.com/BurntSushi/ripgrep/blob/master/FAQ.md#how-do-i-stop-ripgrep-from-messing-up-colors-when-i-kill-it</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2019-05-25 08:08</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">duplicate</span> added by @BurntSushi on 2019-05-29 17:38</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wontfix</span> added by @BurntSushi on 2019-05-29 17:38</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:42:55 UTC
    </footer>
</body>
</html>
