<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carriage return at end of results in Vim quickfix list - BurntSushi/ripgrep #869</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Carriage return at end of results in Vim quickfix list</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/869">#869</a>
        opened by <a href="https://github.com/shyun3">@shyun3</a>
        on 2018-03-26 23:15
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/shyun3">@shyun3</a></div>
            <div class="timeline-body">What version of ripgrep are you using?
<p>ripgrep 0.8.1
-SIMD -AVX</p>
What operating system are you using ripgrep on?
<p>macOS High Sierra Version 10.13.3</p>
Describe your question, feature request, or bug.
<p>I am using ripgrep as my grep tool in MacVim and I am noticing that after a search in files using the DOS line endings (<code>fileformat</code> is set to <code>dos</code>), all the results in the quickfix list have a carriage return character (^M) appended at the end. This is just a cosmetic thing, but would it be possible to get rid of these? I was previously using ack as my Vim grep tool and it did not include those characters at the end.</p>
If this is a bug, what are the steps to reproduce the behavior?
<ol>
<li>Test file for searching can be generated by running <code>echo test &gt; test.txt</code> in a terminal.</li>
<li>Open this file using Vim by running the following command: <code>vim -u NONE -N test.txt</code>. This ensures that no plugins get loaded.</li>
<li>Set the file to use DOS line endings and save:<pre><code>:set ff=dos
:w
</code></pre>
</li>
<li>Run the following Ex commands to set the grep program:<pre><code>:set grepprg=rg\ --vimgrep
:set grepformat=%f:%l:%c:%m
</code></pre>
</li>
<li>Execute a grep command: <code>:grep es</code>. Press enter repeatedly until you are back in the Vim view of the file.</li>
<li>Open the quickfix window: <code>:copen</code>. Notice that search result displays as <code>test^M</code>.</li>
</ol>
If this is a bug, what is the actual behavior?
<p>Output of <code>rg --vimgrep --debug es</code>:</p>
<pre><code>DEBUG/grep::search/grep/src/search.rs:195: regex ast:
Literal {
    chars: [
        &#x27;e&#x27;,
        &#x27;s&#x27;
    ],
    casei: false
}
DEBUG/grep::literals/grep/src/literals.rs:38: literal prefixes detected: Literals { lits: [Complete(es)], limit_size: 250, limit_class: 10 }
DEBUG/globset/globset/src/lib.rs:401: built glob set; 0 literals, 6 basenames, 0 extensions, 0 prefixes, 1 suffixes, 0 required extensions, 0 regexes
DEBUG/ignore::walk/ignore/src/walk.rs:1428: ignoring ./.DS_Store: Ignore(IgnoreMatch(Gitignore(Glob { from: Some(&quot;/Users/mhyun/.gitignore_global&quot;), original: &quot;.DS_Store&quot;, actual: &quot;**/.DS_Store&quot;, is_whitelist: false, is_only_dir: false })))
test.txt:1:2:test
</code></pre>
If this is a bug, what is the expected behavior?
<p>It would be nice if the result in the quickfix window displays as <code>test</code> regardless of the format of the file being searched.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-03-26 23:17</div>
            <div class="timeline-body"><p>This isn&#x27;t an actionable bug report. Please fill out the issue template as requested. In particular, please include the command you&#x27;re running, the actual output and the expected output.</p>
<p>My suspicion is that this is a duplicate of #416, but you haven&#x27;t provided enough information, so I can&#x27;t know for sure.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/shyun3">@shyun3</a> on 2018-03-26 23:54</div>
            <div class="timeline-body"><p>Sorry for not following the template. I&#x27;ve updated my original comment that should hopefully be conforming.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-03-27 00:03</div>
            <div class="timeline-body"><p>Oh I see. That is a much better bug report, thank you so much for filling in all the details. :-)</p>
<p>So yeah I don&#x27;t think this is a bug in ripgrep. ripgrep probably should not be in the business of silently truncating characters from your search results. It would be pretty simple, I think, to run a script that post-processes the output to normalize line endings to whatever you desire, and I think that would be my preferred route.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/shyun3">@shyun3</a> on 2018-03-27 00:05</div>
            <div class="timeline-body"><p>Ok, thank you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/shyun3">@shyun3</a> on 2018-03-27 00:05</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:06 UTC
    </footer>
</body>
</html>
