<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Please allow a list of files and directories to search via file or pipe - BurntSushi/ripgrep #2199</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Please allow a list of files and directories to search via file or pipe</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2199">#2199</a>
        opened by <a href="https://github.com/setharnold">@setharnold</a>
        on 2022-05-02 19:55
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/setharnold">@setharnold</a></div>
            <div class="timeline-body"><p>Hello, I often use ripgrep to search a few hundred million files that rarely change. Getting the list of files to search is a very expensive operation in my environment and the <code>plocate</code> tool lets me amortize that cost to overnight index generation.</p>
<p>The problem is that I want to run a command like the following:</p>
<p><code>rg foo $(locate srv pool ubuntu dsc)</code></p>
<p>This builds a command line that is far too long for my operating system or execution environment:</p>
<pre><code>$ rg &#x27;debian.*changelog&#x27; $(locate  .dsc srv mirror ubuntu pool)
-bash: /home/sarnold/bin/rg: Argument list too long
</code></pre>
<p>This is a small number of files and the <code>locate</code> command executes very quickly:</p>
<pre><code>$ time locate .dsc srv mirror ubuntu pool | wc -l
142375

real	0m0.578s
user	0m0.322s
sys	0m0.278s
</code></pre>
<p>Running a very similar ripgrep command, it&#x27;s been executing for ten minutes now and has only reported a hundred or so candidate files to search:</p>
<pre><code> $ ps auxw | head -1 ; ps auwx | grep &quot;rg -uu&quot;
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
sarnold   1695  0.0  0.0  14436  1092 pts/1    S+   12:26   0:00 grep --color=auto rg -uu
sarnold   4185  125  1.6 2467468 2151536 pts/0 Sl+  12:18   9:55 rg -uu -g **/*.dsc --files /fst/trees/ubuntu/ /srv/mirror/ubuntu/
</code></pre>
<p>So, I&#x27;d like some way to avoid this costly part of my search directly in ripgrep. I want to give a path to a file or a socket that will provide the filenames or directory names to search. (Accepting an fd with the filenames might also work, and could save mandatory trips to the filesystem, but working with non-stdin filedescriptors at the shell is a bit annoying. I&#x27;m only familiar with <code>gpg</code> using this for password inputs.) (Accepting a command to run to generate the list of filenames might also work, but it&#x27;s an odd inversion of typical Unix control flow.)</p>
<p>My current work-around is to use xargs, which feels non-optimal:</p>
<ul>
<li>I can&#x27;t start searching until the entire list is generated, which leaves some of my disks idle longer than necessary</li>
<li>Repeated execution of rg with very large argvs is going to be less efficient than one execution of rg with a very short argv</li>
<li>At the end of each xargs-spawned rg run, there&#x27;s going to be some moments when the process will be searching exactly one file</li>
<li>Manual management of the list of files or directories to search is ever so slightly tedious</li>
</ul>
<p>I don&#x27;t have good suggestions for a command line parameter name. I&#x27;ve thought of the following:</p>
<ul>
<li><code>--paths-to-search &lt;filename&gt;</code></li>
<li><code>--files-to-search &lt;filename&gt;</code></li>
<li><code>--files-and-directories-to-search &lt;filename&gt;</code></li>
<li><code>--files-to-search-from-file &lt;filename&gt;</code></li>
<li><code>--files-and-directories-to-search-from-file &lt;filename&gt;</code></li>
<li><code>--files--to-search-from-fd &lt;fd&gt;</code></li>
<li><code>--files-to-search-from-command &lt;command&gt;</code></li>
<li>...</li>
</ul>
<p>Thanks</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2022-05-02 21:58</div>
            <div class="timeline-body"><p>Duplicate of #273.</p>
<p>Note also that this comment seems relevant to your use case: <a href="https://github.com/BurntSushi/ripgrep/issues/273">BurntSushi/ripgrep#273</a>#issuecomment-724140485</p>
<p>Namely, I&#x27;m not sure how difficult it is to refactor ripgrep to start searching before it knows the full set of paths. It could be very gnarly.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2022-05-02 21:58</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">duplicate</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2022-05-02 21:58</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/setharnold">@setharnold</a> on 2022-05-03 02:00</div>
            <div class="timeline-body"><p>Aha, sorry I didn&#x27;t spot #273. Bummer it&#x27;s not straightforward. Thanks! :D</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:12 UTC
    </footer>
</body>
</html>
