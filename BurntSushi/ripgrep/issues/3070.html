<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Commands that use glob filters with absolute paths behave differently depending on cwd - BurntSushi/ripgrep #3070</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Commands that use glob filters with absolute paths behave differently depending on cwd</h1>

    <div class="meta">
        <span class="state-icon state-open"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/3070">#3070</a>
        opened by <a href="https://github.com/mattalxndr">@mattalxndr</a>
        on 2025-06-20 00:46
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mattalxndr">@mattalxndr</a></div>
            <div class="timeline-body">Please tick this box to confirm you have reviewed the above.
<ul>
<li>[x] I have a different issue.</li>
</ul>
What version of ripgrep are you using?
<pre><code>ripgrep 14.1.1

features:+pcre2
simd(compile):+SSE2,-SSSE3,-AVX2
simd(runtime):+SSE2,+SSSE3,+AVX2

PCRE2 10.43 is available (JIT is available)
</code></pre>
How did you install ripgrep?
<p>pacman</p>
What operating system are you using ripgrep on?
<p>Arch Linux, rolling release</p>
Describe your bug.
<p>Commands that use glob filters with absolute paths behave differently depending on current working directory.</p>
What are the steps to reproduce the behavior?
<pre><code> ~ % mkdir /tmp/rg
 ~ % echo 1 &gt; /tmp/rg/one.txt
 ~ % echo 2 &gt; /tmp/rg/two.txt
 ~ % unset RIPGREP_CONFIG_PATH
 ~ % cd /
 / % rg --glob=&#x27;!/tmp/rg/two.txt&#x27; . /tmp/rg/
/tmp/rg/one.txt
1:1
 / % cd /tmp/rg
 /tmp/rg % rg --glob=&#x27;!/tmp/rg/two.txt&#x27; . /tmp/rg/
/tmp/rg/one.txt
1:1

/tmp/rg/two.txt
1:2
</code></pre>
What is the actual behavior?
<p>Here&#x27;re those last two commands again, with <code>--debug</code>:</p>
<pre><code> / % rg --debug --glob=&#x27;!/tmp/rg/two.txt&#x27; . /tmp/rg/
rg: DEBUG|rg::flags::parse|crates/core/flags/parse.rs:97: no extra arguments found from configuration file
rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1083: number of paths given to search: 1
rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1094: is_one_file? false
rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1269: found hostname for hyperlink configuration: m
rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1279: hyperlink format: &quot;&quot;
rg: DEBUG|globset|crates/globset/src/lib.rs:453: built glob set; 1 literals, 0 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:174: using 8 thread(s)
rg: DEBUG|globset|crates/globset/src/lib.rs:453: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
rg: DEBUG|ignore::gitignore|crates/ignore/src/gitignore.rs:393: opened gitignore file: /home/matt/.config/git/ignore
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/[._]*.s[a-v][a-z]&quot;, re: &quot;(?-u)^(?:/?|.*/)[\\._][^/]*\\.s[a-v][a-z]$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, Class { negated: false, ranges: [(&#x27;.&#x27;, &#x27;.&#x27;), (&#x27;_&#x27;, &#x27;_&#x27;)] }, ZeroOrMore, Literal(&#x27;.&#x27;), Literal(&#x27;s&#x27;), Class { negated: false, ranges: [(&#x27;a&#x27;, &#x27;v&#x27;)] }, Class { negated: false, ranges: [(&#x27;a&#x27;, &#x27;z&#x27;)] }]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/[._]*.sw[a-p]&quot;, re: &quot;(?-u)^(?:/?|.*/)[\\._][^/]*\\.sw[a-p]$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, Class { negated: false, ranges: [(&#x27;.&#x27;, &#x27;.&#x27;), (&#x27;_&#x27;, &#x27;_&#x27;)] }, ZeroOrMore, Literal(&#x27;.&#x27;), Literal(&#x27;s&#x27;), Literal(&#x27;w&#x27;), Class { negated: false, ranges: [(&#x27;a&#x27;, &#x27;p&#x27;)] }]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/[._]s[a-rt-v][a-z]&quot;, re: &quot;(?-u)^(?:/?|.*/)[\\._]s[a-rt-v][a-z]$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, Class { negated: false, ranges: [(&#x27;.&#x27;, &#x27;.&#x27;), (&#x27;_&#x27;, &#x27;_&#x27;)] }, Literal(&#x27;s&#x27;), Class { negated: false, ranges: [(&#x27;a&#x27;, &#x27;r&#x27;), (&#x27;t&#x27;, &#x27;v&#x27;)] }, Class { negated: false, ranges: [(&#x27;a&#x27;, &#x27;z&#x27;)] }]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/[._]ss[a-gi-z]&quot;, re: &quot;(?-u)^(?:/?|.*/)[\\._]ss[a-gi-z]$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, Class { negated: false, ranges: [(&#x27;.&#x27;, &#x27;.&#x27;), (&#x27;_&#x27;, &#x27;_&#x27;)] }, Literal(&#x27;s&#x27;), Literal(&#x27;s&#x27;), Class { negated: false, ranges: [(&#x27;a&#x27;, &#x27;g&#x27;), (&#x27;i&#x27;, &#x27;z&#x27;)] }]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/[._]sw[a-p]&quot;, re: &quot;(?-u)^(?:/?|.*/)[\\._]sw[a-p]$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, Class { negated: false, ranges: [(&#x27;.&#x27;, &#x27;.&#x27;), (&#x27;_&#x27;, &#x27;_&#x27;)] }, Literal(&#x27;s&#x27;), Literal(&#x27;w&#x27;), Class { negated: false, ranges: [(&#x27;a&#x27;, &#x27;p&#x27;)] }]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/*~&quot;, re: &quot;(?-u)^(?:/?|.*/)[^/]*\\~$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, ZeroOrMore, Literal(&#x27;~&#x27;)]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;.idea/**/dictionaries&quot;, re: &quot;(?-u)^\\.idea(?:/|/.*/)dictionaries$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([Literal(&#x27;.&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;a&#x27;), RecursiveZeroOrMore, Literal(&#x27;d&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;c&#x27;), Literal(&#x27;t&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;o&#x27;), Literal(&#x27;n&#x27;), Literal(&#x27;a&#x27;), Literal(&#x27;r&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;s&#x27;)]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;.idea/**/shelf&quot;, re: &quot;(?-u)^\\.idea(?:/|/.*/)shelf$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([Literal(&#x27;.&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;a&#x27;), RecursiveZeroOrMore, Literal(&#x27;s&#x27;), Literal(&#x27;h&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;l&#x27;), Literal(&#x27;f&#x27;)]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;.idea/**/dataSources&quot;, re: &quot;(?-u)^\\.idea(?:/|/.*/)dataSources$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([Literal(&#x27;.&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;a&#x27;), RecursiveZeroOrMore, Literal(&#x27;d&#x27;), Literal(&#x27;a&#x27;), Literal(&#x27;t&#x27;), Literal(&#x27;a&#x27;), Literal(&#x27;S&#x27;), Literal(&#x27;o&#x27;), Literal(&#x27;u&#x27;), Literal(&#x27;r&#x27;), Literal(&#x27;c&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;s&#x27;)]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;.idea/**/libraries&quot;, re: &quot;(?-u)^\\.idea(?:/|/.*/)libraries$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([Literal(&#x27;.&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;a&#x27;), RecursiveZeroOrMore, Literal(&#x27;l&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;b&#x27;), Literal(&#x27;r&#x27;), Literal(&#x27;a&#x27;), Literal(&#x27;r&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;s&#x27;)]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/cmake-build-*&quot;, re: &quot;(?-u)^(?:/?|.*/)cmake\\-build\\-[^/]*$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, Literal(&#x27;c&#x27;), Literal(&#x27;m&#x27;), Literal(&#x27;a&#x27;), Literal(&#x27;k&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;-&#x27;), Literal(&#x27;b&#x27;), Literal(&#x27;u&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;l&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;-&#x27;), ZeroOrMore]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;.vscode/*&quot;, re: &quot;(?-u)^\\.vscode/[^/]*$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([Literal(&#x27;.&#x27;), Literal(&#x27;v&#x27;), Literal(&#x27;s&#x27;), Literal(&#x27;c&#x27;), Literal(&#x27;o&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;/&#x27;), ZeroOrMore]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/*~&quot;, re: &quot;(?-u)^(?:/?|.*/)[^/]*\\~$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, ZeroOrMore, Literal(&#x27;~&#x27;)]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/.fuse_hidden*&quot;, re: &quot;(?-u)^(?:/?|.*/)\\.fuse_hidden[^/]*$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, Literal(&#x27;.&#x27;), Literal(&#x27;f&#x27;), Literal(&#x27;u&#x27;), Literal(&#x27;s&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;_&#x27;), Literal(&#x27;h&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;n&#x27;), ZeroOrMore]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/.Trash-*&quot;, re: &quot;(?-u)^(?:/?|.*/)\\.Trash\\-[^/]*$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, Literal(&#x27;.&#x27;), Literal(&#x27;T&#x27;), Literal(&#x27;r&#x27;), Literal(&#x27;a&#x27;), Literal(&#x27;s&#x27;), Literal(&#x27;h&#x27;), Literal(&#x27;-&#x27;), ZeroOrMore]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/.nfs*&quot;, re: &quot;(?-u)^(?:/?|.*/)\\.nfs[^/]*$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, Literal(&#x27;.&#x27;), Literal(&#x27;n&#x27;), Literal(&#x27;f&#x27;), Literal(&#x27;s&#x27;), ZeroOrMore]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/._*&quot;, re: &quot;(?-u)^(?:/?|.*/)\\._[^/]*$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, Literal(&#x27;.&#x27;), Literal(&#x27;_&#x27;), ZeroOrMore]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/*zcompdump*&quot;, re: &quot;(?-u)^(?:/?|.*/)[^/]*zcompdump[^/]*$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, ZeroOrMore, Literal(&#x27;z&#x27;), Literal(&#x27;c&#x27;), Literal(&#x27;o&#x27;), Literal(&#x27;m&#x27;), Literal(&#x27;p&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;u&#x27;), Literal(&#x27;m&#x27;), Literal(&#x27;p&#x27;), ZeroOrMore]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;tests/_output/*&quot;, re: &quot;(?-u)^tests/_output/[^/]*$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([Literal(&#x27;t&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;s&#x27;), Literal(&#x27;t&#x27;), Literal(&#x27;s&#x27;), Literal(&#x27;/&#x27;), Literal(&#x27;_&#x27;), Literal(&#x27;o&#x27;), Literal(&#x27;u&#x27;), Literal(&#x27;t&#x27;), Literal(&#x27;p&#x27;), Literal(&#x27;u&#x27;), Literal(&#x27;t&#x27;), Literal(&#x27;/&#x27;), ZeroOrMore]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:453: built glob set; 10 literals, 41 basenames, 11 extensions, 0 prefixes, 0 suffixes, 6 required extensions, 19 regexes
rg: DEBUG|ignore::walk|crates/ignore/src/walk.rs:1799: ignoring /tmp/rg/two.txt: Ignore(IgnoreMatch(Override(Glob(Matched(Glob { from: None, original: &quot;!/tmp/rg/two.txt&quot;, actual: &quot;tmp/rg/two.txt&quot;, is_whitelist: true, is_only_dir: false })))))
/tmp/rg/one.txt
1:1
 / % cd /tmp/rg
 /tmp/rg % rg --debug --glob=&#x27;!/tmp/rg/two.txt&#x27; . /tmp/rg/
rg: DEBUG|rg::flags::parse|crates/core/flags/parse.rs:97: no extra arguments found from configuration file
rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1083: number of paths given to search: 1
rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1094: is_one_file? false
rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1269: found hostname for hyperlink configuration: m
rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:1279: hyperlink format: &quot;&quot;
rg: DEBUG|globset|crates/globset/src/lib.rs:453: built glob set; 1 literals, 0 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
rg: DEBUG|rg::flags::hiargs|crates/core/flags/hiargs.rs:174: using 8 thread(s)
rg: DEBUG|globset|crates/globset/src/lib.rs:453: built glob set; 0 literals, 0 basenames, 12 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
rg: DEBUG|ignore::gitignore|crates/ignore/src/gitignore.rs:393: opened gitignore file: /home/matt/.config/git/ignore
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/[._]*.s[a-v][a-z]&quot;, re: &quot;(?-u)^(?:/?|.*/)[\\._][^/]*\\.s[a-v][a-z]$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, Class { negated: false, ranges: [(&#x27;.&#x27;, &#x27;.&#x27;), (&#x27;_&#x27;, &#x27;_&#x27;)] }, ZeroOrMore, Literal(&#x27;.&#x27;), Literal(&#x27;s&#x27;), Class { negated: false, ranges: [(&#x27;a&#x27;, &#x27;v&#x27;)] }, Class { negated: false, ranges: [(&#x27;a&#x27;, &#x27;z&#x27;)] }]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/[._]*.sw[a-p]&quot;, re: &quot;(?-u)^(?:/?|.*/)[\\._][^/]*\\.sw[a-p]$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, Class { negated: false, ranges: [(&#x27;.&#x27;, &#x27;.&#x27;), (&#x27;_&#x27;, &#x27;_&#x27;)] }, ZeroOrMore, Literal(&#x27;.&#x27;), Literal(&#x27;s&#x27;), Literal(&#x27;w&#x27;), Class { negated: false, ranges: [(&#x27;a&#x27;, &#x27;p&#x27;)] }]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/[._]s[a-rt-v][a-z]&quot;, re: &quot;(?-u)^(?:/?|.*/)[\\._]s[a-rt-v][a-z]$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, Class { negated: false, ranges: [(&#x27;.&#x27;, &#x27;.&#x27;), (&#x27;_&#x27;, &#x27;_&#x27;)] }, Literal(&#x27;s&#x27;), Class { negated: false, ranges: [(&#x27;a&#x27;, &#x27;r&#x27;), (&#x27;t&#x27;, &#x27;v&#x27;)] }, Class { negated: false, ranges: [(&#x27;a&#x27;, &#x27;z&#x27;)] }]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/[._]ss[a-gi-z]&quot;, re: &quot;(?-u)^(?:/?|.*/)[\\._]ss[a-gi-z]$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, Class { negated: false, ranges: [(&#x27;.&#x27;, &#x27;.&#x27;), (&#x27;_&#x27;, &#x27;_&#x27;)] }, Literal(&#x27;s&#x27;), Literal(&#x27;s&#x27;), Class { negated: false, ranges: [(&#x27;a&#x27;, &#x27;g&#x27;), (&#x27;i&#x27;, &#x27;z&#x27;)] }]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/[._]sw[a-p]&quot;, re: &quot;(?-u)^(?:/?|.*/)[\\._]sw[a-p]$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, Class { negated: false, ranges: [(&#x27;.&#x27;, &#x27;.&#x27;), (&#x27;_&#x27;, &#x27;_&#x27;)] }, Literal(&#x27;s&#x27;), Literal(&#x27;w&#x27;), Class { negated: false, ranges: [(&#x27;a&#x27;, &#x27;p&#x27;)] }]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/*~&quot;, re: &quot;(?-u)^(?:/?|.*/)[^/]*\\~$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, ZeroOrMore, Literal(&#x27;~&#x27;)]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;.idea/**/dictionaries&quot;, re: &quot;(?-u)^\\.idea(?:/|/.*/)dictionaries$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([Literal(&#x27;.&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;a&#x27;), RecursiveZeroOrMore, Literal(&#x27;d&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;c&#x27;), Literal(&#x27;t&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;o&#x27;), Literal(&#x27;n&#x27;), Literal(&#x27;a&#x27;), Literal(&#x27;r&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;s&#x27;)]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;.idea/**/shelf&quot;, re: &quot;(?-u)^\\.idea(?:/|/.*/)shelf$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([Literal(&#x27;.&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;a&#x27;), RecursiveZeroOrMore, Literal(&#x27;s&#x27;), Literal(&#x27;h&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;l&#x27;), Literal(&#x27;f&#x27;)]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;.idea/**/dataSources&quot;, re: &quot;(?-u)^\\.idea(?:/|/.*/)dataSources$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([Literal(&#x27;.&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;a&#x27;), RecursiveZeroOrMore, Literal(&#x27;d&#x27;), Literal(&#x27;a&#x27;), Literal(&#x27;t&#x27;), Literal(&#x27;a&#x27;), Literal(&#x27;S&#x27;), Literal(&#x27;o&#x27;), Literal(&#x27;u&#x27;), Literal(&#x27;r&#x27;), Literal(&#x27;c&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;s&#x27;)]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;.idea/**/libraries&quot;, re: &quot;(?-u)^\\.idea(?:/|/.*/)libraries$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([Literal(&#x27;.&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;a&#x27;), RecursiveZeroOrMore, Literal(&#x27;l&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;b&#x27;), Literal(&#x27;r&#x27;), Literal(&#x27;a&#x27;), Literal(&#x27;r&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;s&#x27;)]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/cmake-build-*&quot;, re: &quot;(?-u)^(?:/?|.*/)cmake\\-build\\-[^/]*$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, Literal(&#x27;c&#x27;), Literal(&#x27;m&#x27;), Literal(&#x27;a&#x27;), Literal(&#x27;k&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;-&#x27;), Literal(&#x27;b&#x27;), Literal(&#x27;u&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;l&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;-&#x27;), ZeroOrMore]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;.vscode/*&quot;, re: &quot;(?-u)^\\.vscode/[^/]*$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([Literal(&#x27;.&#x27;), Literal(&#x27;v&#x27;), Literal(&#x27;s&#x27;), Literal(&#x27;c&#x27;), Literal(&#x27;o&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;/&#x27;), ZeroOrMore]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/*~&quot;, re: &quot;(?-u)^(?:/?|.*/)[^/]*\\~$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, ZeroOrMore, Literal(&#x27;~&#x27;)]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/.fuse_hidden*&quot;, re: &quot;(?-u)^(?:/?|.*/)\\.fuse_hidden[^/]*$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, Literal(&#x27;.&#x27;), Literal(&#x27;f&#x27;), Literal(&#x27;u&#x27;), Literal(&#x27;s&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;_&#x27;), Literal(&#x27;h&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;n&#x27;), ZeroOrMore]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/.Trash-*&quot;, re: &quot;(?-u)^(?:/?|.*/)\\.Trash\\-[^/]*$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, Literal(&#x27;.&#x27;), Literal(&#x27;T&#x27;), Literal(&#x27;r&#x27;), Literal(&#x27;a&#x27;), Literal(&#x27;s&#x27;), Literal(&#x27;h&#x27;), Literal(&#x27;-&#x27;), ZeroOrMore]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/.nfs*&quot;, re: &quot;(?-u)^(?:/?|.*/)\\.nfs[^/]*$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, Literal(&#x27;.&#x27;), Literal(&#x27;n&#x27;), Literal(&#x27;f&#x27;), Literal(&#x27;s&#x27;), ZeroOrMore]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/._*&quot;, re: &quot;(?-u)^(?:/?|.*/)\\._[^/]*$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, Literal(&#x27;.&#x27;), Literal(&#x27;_&#x27;), ZeroOrMore]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;**/*zcompdump*&quot;, re: &quot;(?-u)^(?:/?|.*/)[^/]*zcompdump[^/]*$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([RecursivePrefix, ZeroOrMore, Literal(&#x27;z&#x27;), Literal(&#x27;c&#x27;), Literal(&#x27;o&#x27;), Literal(&#x27;m&#x27;), Literal(&#x27;p&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;u&#x27;), Literal(&#x27;m&#x27;), Literal(&#x27;p&#x27;), ZeroOrMore]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:448: glob converted to regex: Glob { glob: &quot;tests/_output/*&quot;, re: &quot;(?-u)^tests/_output/[^/]*$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true, empty_alternates: false }, tokens: Tokens([Literal(&#x27;t&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;s&#x27;), Literal(&#x27;t&#x27;), Literal(&#x27;s&#x27;), Literal(&#x27;/&#x27;), Literal(&#x27;_&#x27;), Literal(&#x27;o&#x27;), Literal(&#x27;u&#x27;), Literal(&#x27;t&#x27;), Literal(&#x27;p&#x27;), Literal(&#x27;u&#x27;), Literal(&#x27;t&#x27;), Literal(&#x27;/&#x27;), ZeroOrMore]) }
rg: DEBUG|globset|crates/globset/src/lib.rs:453: built glob set; 10 literals, 41 basenames, 11 extensions, 0 prefixes, 0 suffixes, 6 required extensions, 19 regexes
/tmp/rg/one.txt
1:1

/tmp/rg/two.txt
1:2

</code></pre>
What is the expected behavior?
<p>I would expect the output of the second <code>rg</code> command to match the first, since all that&#x27;s different is the current working directory.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-06-20 00:51</div>
            <div class="timeline-body"><p>ripgrep doesn&#x27;t really have a way to filter based on absolute paths. It&#x27;s a limitation of the gitignore paradigm, and the <code>-g/--glob</code> is specifically documented to behave like gitignore.</p>
<p>So this is working as intended, although I agree it is counter-intuitive and ripgrep probably should have a better way to approach the problem you&#x27;re trying to solve.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/mattalxndr">@mattalxndr</a> on 2025-06-20 00:54</div>
            <div class="timeline-body"><p>Perhaps a wrapper script to absolute-ize the paths, pushd to /, run <code>rg</code>, then popd? Nah.. ðŸ˜†</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-10-16 01:28</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2025-10-16 01:38</div>
            <div class="timeline-body"><p>I looked into this to see if there was an easy fix in ripgrep. I figured out the problem, but the fix is hard.</p>
<p>Basically, the <code>ignore</code> crate handles most-to-all of ripgrep&#x27;s filtering. When I built it, I didn&#x27;t carefully consider how filtering was impacted based on how gitignore patterns were matched relative to:</p>
<ul>
<li>The current working directory.</li>
<li>The actual path to search as written by a user. e.g., <code>./</code> vs <code>/tmp/rg</code>.</li>
</ul>
<p>The <code>ignore</code> crate generally considers gitignore patterns to match relative to where the gitignore <em>file</em> that defines those patterns lives. To that end, before matching a file path against a pattern, the file path has a prefix equivalent to the directory containing that gitignore file stripped. That permits things like <code>/foo</code> to match correctly regardless of where ripgrep is searching or how you get there. That part of ripgrep works decently well.</p>
<p>But some gitignore patterns don&#x27;t come from gitignore files in a directory tree like that. Some come from a global git configuration, or ripgrep&#x27;s <code>--ignore-file</code> flag, or indeed, ripgrep&#x27;s <code>-g/--glob</code> flags. In that case, I had mistakenly designed <code>ignore</code> around the assumption that those globs should be matched relative to <em>ripgrep&#x27;s current working directory</em>. (And even then, I didn&#x27;t get that completely right until recently. See the fix for #3179.) But that&#x27;s actually very wrong, even though it works in a lot of cases.</p>
<p>After fixing #3179, I had believed that the correct approach here is that globs should be matched <em>relative to the directory paths given to ripgrep</em>. So if you search <code>/tmp/rg</code>, then <code>/tmp/rg</code> should be stripped from the file path before matching. But that actually won&#x27;t fix this particular bug. Because here, the stripping is the problem. When you <code>cd</code> into <code>/tmp/rg</code>, that becomes ripgrep&#x27;s CWD and that&#x27;s the prefix that gets stripped when matching on <code>/tmp/rg/two.txt</code>. So you end up matching the glob <code>/tmp/rg/two.txt</code> against <code>two.txt</code>, which doesn&#x27;t match.</p>
<p>In any case, pretty much all of <code>ignore</code> assumes that the &quot;root&quot; of a gitignore pattern is invariant throughout its lifetime. I suspect the &quot;root&quot; needs to be able to change, and that is a massive refactoring.</p>
<p>So unfortunately, this bug likely will remain unfixed until I have a chance to rebuild the <code>ignore</code> crate from first principles. (I&#x27;ve been talking about doing that for years already, so it probably won&#x27;t happen any time soon.)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:14 UTC
    </footer>
</body>
</html>
