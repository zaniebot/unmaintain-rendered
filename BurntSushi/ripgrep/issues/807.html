<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>--hidden + .ignore showing ignored files inside hidden directories - BurntSushi/ripgrep #807</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>--hidden + .ignore showing ignored files inside hidden directories</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/807">#807</a>
        opened by <a href="https://github.com/cpixl">@cpixl</a>
        on 2018-02-14 19:45
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/cpixl">@cpixl</a></div>
            <div class="timeline-body"><h4>What version of ripgrep are you using?</h4>
<p>ripgrep 0.8.0
-SIMD -AVX</p>
<h4>What operating system are you using ripgrep on?</h4>
<p>Arch Linux</p>
<h4>Describe your question, feature request, or bug.</h4>
<p>The <code>--hidden</code> and <code>.ignore</code> file combination is not working well for ignored files inside hidden directories e.g. a <code>.a/b/c</code> file shouldn't appear if <code>.ignore</code> contains <code>.a/b</code>.</p>
<h4>If this is a bug, what are the steps to reproduce the behavior?</h4>
<pre><code class="language-bash">mkdir -p .a/b .a/c
touch .a/b/file .a/c/file
echo .a/b &gt; .ignore
ln -rsf .ignore .gitignore
rg --debug --hidden --files .
</code></pre>
<h4>If this is a bug, what is the actual behavior?</h4>
<p>This is the current output:</p>
<pre><code>DEBUG/rg::config/src/config.rs:42: /home/user/.config/ripgrep/ripgreprc: arguments loaded from config file: [&quot;--smart-case&quot;, &quot;--follow&quot;]
DEBUG/rg::args/src/args.rs:143: final argv: [&quot;rg&quot;, &quot;--smart-case&quot;, &quot;--follow&quot;, &quot;--debug&quot;, &quot;--hidden&quot;, &quot;--files&quot;, &quot;.&quot;]
DEBUG/grep::search/grep/src/search.rs:195: regex ast:
Repeat {
    e: Literal {
        chars: [
            'z'
        ],
        casei: true
    },
    r: Range {
        min: 0,
        max: Some(
            0
        )
    },
    greedy: true
}
DEBUG/globset/globset/src/lib.rs:396: glob converted to regex: Glob { glob: &quot;.local/share/nvim/{bundle,undo,swap}&quot;, re: &quot;(?-u)^\\.local/share/nvim/(swap|undo|bundle)$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true }, tokens: Tokens([Literal('.'), Literal('l'), Literal('o'), Literal('c'), Literal('a'), Literal('l'), Literal('/'), Literal('s'), Literal('h'), Literal('a'), Literal('r'), Literal('e'), Literal('/'), Literal('n'), Literal('v'), Literal('i'), Literal('m'), Literal('/'), Alternates([Tokens([Literal('s'), Literal('w'), Literal('a'), Literal('p')]), Tokens([Literal('u'), Literal('n'), Literal('d'), Literal('o')]), Tokens([Literal('b'), Literal('u'), Literal('n'), Literal('d'), Literal('l'), Literal('e')])])]) }
DEBUG/globset/globset/src/lib.rs:401: built glob set; 4 literals, 1 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 1 regexes
DEBUG/globset/globset/src/lib.rs:401: built glob set; 1 literals, 0 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
DEBUG/globset/globset/src/lib.rs:401: built glob set; 1 literals, 0 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 0 regexes
.ignore
.gitignore
.a/c/file
.a/b/file
</code></pre>
<h4>If this is a bug, what is the expected behavior?</h4>
<p>The same files shown by <code>git status</code> (after a <code>git init &amp;&amp; git add .</code>):</p>
<pre><code>On branch master

No commits yet

Changes to be committed:
  (use &quot;git rm --cached &lt;file&gt;...&quot; to unstage)

	new file:   .a/c/file
	new file:   .gitignore
	new file:   .ignore

</code></pre>
<p>As you can see, the <code>.a/b/file</code> was ommited by Git, but not by ripgrep.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/okdana">@okdana</a> on 2018-02-14 19:55</div>
            <div class="timeline-body"><p>FYI, the problem doesn't occur if you do <code>rg --files --hidden</code> or <code>rg --files --hidden $PWD</code> or even <code>rg --files --hidden ./</code> — you explicitly need to use <code>.</code> for the path</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/cpixl">@cpixl</a> on 2018-02-14 19:56</div>
            <div class="timeline-body"><p><a href="https://github.com/sharkdp/fd"><code>fd</code></a> is showing a similar behavior with <code>fd --hidden --type file</code>, which makes me believe it may be related to <a href="https://docs.rs/ignore"><code>ignore</code></a>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @BurntSushi on 2018-02-14 20:54</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2018-02-14 23:16</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2018-02-14 23:17</div>
            <div class="timeline-body"><p>@okdana's observation was spot-on and led me to exactly the place where this needed to be fixed. Thanks @dan-santana for the awesome bug report!</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:42:26 UTC
    </footer>
</body>
</html>
