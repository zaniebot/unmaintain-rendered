<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zero length matches don't colourise properly - BurntSushi/ripgrep #366</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Zero length matches don't colourise properly</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/366">#366</a>
        opened by <a href="https://github.com/filterfish">@filterfish</a>
        on 2017-02-17 08:07
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/filterfish">@filterfish</a></div>
            <div class="timeline-body"><p>I use this little grep command to highlight keywords, in for example, logs (or in this case packages):</p>
<pre><code class="language-bash">apt-cache search cudf | grep -E --colour '^|cudf'
</code></pre>
<p>When I use <code>rg '^|cudf'</code> it doesn't colourise the matches that match <code>^cudf</code> which is incorrect.</p>
<p>Anyway I've attached two screenshots to show the difference (I couldn't work out how to set the colours in Markdown!). Note the difference in brightness  is simply due to my compositor settings and nothing to do do with this issue.</p>
<p>grep:
<img src="https://cloud.githubusercontent.com/assets/12899/23057368/f3f594c4-f543-11e6-8b18-b599ee312276.png" alt="colours-grep" /></p>
<p>rg:</p>
<p><img src="https://cloud.githubusercontent.com/assets/12899/23057376/029fe128-f544-11e6-9630-ae38289a1610.png" alt="colours-rg" /></p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-02-17 12:01</div>
            <div class="timeline-body"><p>Interesting. This is an artifact of the regex engine and I'm not sure there's much that can be done. In particular, the regex engine has <em>leftmost first</em> matching semantics (which means that the first branch in an alternation that matches is used), which tends to match the behavior that most folks expect because they are the default matching semantics of backtracking engines. Most finite automata based engines provide <em>leftmost longest</em> matching semantics (which means that the branch in an alternation that matches the most text is used), including the one inside of GNU grep. For example, while you get your desired results with <code>grep -E</code>, if you try <code>grep -P</code> (which uses PCRE), you will see the same behavior as ripgrep.</p>
<p>I think the only work-around available to you is to encode the match priority you want. For example, instead of <code>rg '^|cudf</code> use <code>rg 'cudf|^'</code>, which does what you want.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2017-02-17 12:01</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wontfix</span> added by @BurntSushi on 2017-02-17 12:01</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/filterfish">@filterfish</a> on 2017-02-19 08:07</div>
            <div class="timeline-body"><p>Blimey. And there was me thinking I had an OK understanding of regexes. Clearly I was way of the mark!
Thanks for the in-depth reason as to why and the workaround; I hadn't thought of that.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2017-02-19 13:24</div>
            <div class="timeline-body"><p>Yeah, match priority in alternations is tricky business. It is occasionally useful though. :-)</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:42:04 UTC
    </footer>
</body>
</html>
