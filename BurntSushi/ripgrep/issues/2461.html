<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check for special case option error `-heading` and `-hidden` and print a warning in addition to displaying help. - BurntSushi/ripgrep #2461</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Check for special case option error <code>-heading</code> and <code>-hidden</code> and print a warning in addition to displaying help.</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2461">#2461</a>
        opened by <a href="https://github.com/rljacobson">@rljacobson</a>
        on 2023-03-17 13:41
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/rljacobson">@rljacobson</a></div>
            <div class="timeline-body"><h4>Describe your feature request</h4>
<p>Suppose some bonehead were to accidentally leave off a dash from either the <code>heading</code> or the <code>hidden</code> options:</p>
<pre><code class="language-bash">$ rg -heading myneedle .
</code></pre>
<p>ripgrep correctly interprets the <code>-h</code> and dutifully prints the help message. This probably wouldn't throw a normal person, but imagine a bonehead getting this result. Since ripgrep usually prints an error in the case of invalid invocation, that bonehead might even think there is a bug in ripgrep!</p>
<p>Obviously ripgrep <em>should</em> continue to behave correctly, but maybe it could also print a warning in the special cases of the two options that start with an <code>&quot;h&quot;</code>? This is a somewhat obscure error case, but it's also presumably trivial to implement. ðŸ¤·</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2023-03-17 13:53</div>
            <div class="timeline-body"><p>It's not trivial to implement because AFAIK Clap doesn't expose the requisite APIs to handle this. You could look at the raw args instead, but then you need to be careful not to trigger a false positive if <code>-heading</code> comes after a <code>--</code>. And probably in other cases too, such as <code>-e -heading</code> and <code>--regexp -heading</code>.</p>
<p>Interestingly, it's not really Clap's fault either. Even if ripgrep switched to a lower level library for CLI arg parsing (like <code>lexopt</code>, which I am considering doing), implementing this in concert with <code>lexopt</code> would be no less challenging.</p>
<p>See, the thing is, CLI arg parsers---even low level ones---go out of their way to present an <em>abstraction</em> of CLI arguments and flags and values. The way in which all of those things is actually provided by the end user varies in a lot of respects, and those things are generally encapsulated by the parser. For example, when you use an arg parser, the caller is generally blissfully unaware of whether <code>-a5</code> or <code>-a 5</code> was given. (In the case of Clap, I believe you're also unaware of whether the longer variant <code>--a-long-option 5</code> was given or whether you got a short flag.) You're also unaware of whether it was combined with other short flags, e.g., <code>-fba 5</code> is the same to the caller as <code>-f -b -a 5</code>.</p>
<p>So basically, in order to implement the sort of warning you're talking about, you specifically have to reach around the abstraction that the CLI arg parser has carefully presented to you. And if you reach around the abstraction, you better be damn sure that you're doing it in a way that is consistent with the abstraction itself.</p>
<p>This is a classic example of how abstraction can help in many ways, but also can hurt you.</p>
<p>Even putting aside the implementation difficulties, I'm not sure this is worth fixing anyway. It seems like a pretty obscure case I think.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2023-03-17 13:53</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rljacobson">@rljacobson</a> on 2023-03-17 15:36</div>
            <div class="timeline-body"><p>Yeah, that actually makes a lot of sense. Argument parsing is a huge pain in the ass. I use a library for anything that isn't completely trivial.</p>
<p>In the presence of <code>-h</code> (or equivalent), other options are ignored. If you could detect the presence of <em>any</em> other options, you could warn the user under the assumption that the user expected the other option(s) to do something. Given the subtleties you point out, I don't know if Clap makes this possible or easy, nor am I confident that it's the right thing to do. ðŸ˜„</p>
<p>What is interesting to me is how there is a category of things that we teach students to do that are actually <em>bad</em> practices. Almost every book and tutorial I've seen does argument parsing by hand. Granted the arguments being parsed are usually simple, but as you point out even simple cases can require complicated implementations if one wants to follow standard conventions. So books and tutorials just don't follow standard conventions!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2023-03-17 15:47</div>
            <div class="timeline-body"><blockquote>
<p>In the presence of <code>-h</code> (or equivalent), other options are ignored. If you could detect the presence of <em>any</em> other options, you could warn the user under the assumption that the user expected the other option(s) to do something. Given the subtleties you point out, I don't know if Clap makes this possible or easy, nor am I confident that it's the right thing to do. smile</p>
</blockquote>
<p>I actually wouldn't want to do this anyway, because I consider it valid to tack on a <code>-h</code> or <code>--help</code> at the end of a command and reliably get the <code>--help</code> output. A warning could in theory be okay there, but it's a valid use case to me and so not something I want to warn about I don't think.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/rljacobson">@rljacobson</a> on 2023-03-17 15:51</div>
            <div class="timeline-body"><p>That's why it's a warning and not an error. But choosing not to warn is not unreasonable either. I can't think of another program that warns the user in this case.</p>
<p>Thanks for the exchange.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:43:38 UTC
    </footer>
</body>
</html>
