<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature Request: Add support for removal of adjacent lines with invert match mode. - BurntSushi/ripgrep #1678</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Feature Request: Add support for removal of adjacent lines with invert match mode.</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1678">#1678</a>
        opened by <a href="https://github.com/mingwandroid">@mingwandroid</a>
        on 2020-09-10 19:26
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/mingwandroid">@mingwandroid</a></div>
            <div class="timeline-body"><p>When building boost, it emits a huge log mostly full of lines like:</p>
<pre><code>common.copy C:\opt\conda\conda-bld\bst-1.73.0_18\_h_env\Library\include\boost\metaparse\v1\repeated_reject_incomplete.hpp
C:\opt\conda\conda-bld\bst-1.73.0_18\work\boost\metaparse\v1\repeated_reject_incomplete.hpp
        1 file(s) copied.
</code></pre>
<p>I&#x27;d like to elide all 3 of these lines (via using rg in a pipe) with a single rg command if possible. Does this sound sensible and/or possible?</p>
<p>Many thanks for ripgrep.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-09-13 13:01</div>
            <div class="timeline-body"><p>I don&#x27;t really understand, sorry. This is what shell pipelines are for: <code>rg ... | rg -v copied | rg -v common.copy</code> or whatever.</p>
<p>When making feature requests, <em>please</em> include the desired command you want to run, along with inputs and the desired output.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">question</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-09-13 13:02</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/MagicMuscleMan">@MagicMuscleMan</a> on 2021-06-07 01:57</div>
            <div class="timeline-body"><p>I am not exactly sure if this is what @mingwandroid  wants, but it sounds like what I wanted to request, so I put it here. If you, @mingwandroid , wanted something else, please tell me, then I&#x27;ll create a new issue.</p>
<p>It should be possible to search for one string but exclude another string in one rg call. Reasons:</p>
<ol>
<li>If you are in a large loop creating two processes for each iteration step is slower.</li>
<li>More advanced shell calls tend to use <code>xargs</code> calls a lot (often with parallel execution), where the syntax of piping is very cumbersome (an extra shell needs to be opened explicitly)</li>
<li>If you combine both issues, i.e. have xargs calls in a loop, this makes performance worse</li>
</ol>
<p>Assume you want to search for <code>a</code> but exclude matches of <code>b</code>, then the following possible future calls come to my mind</p>
<pre><code>echo &#x27;ab
         a
         ac
         c&#x27; | rg -e a -v -e b
</code></pre>
<p>All regexp parameters after <code>-v</code> would be inverted, but all before <code>-v</code> would not be inverted. This feels most familiar, but might be problematic due to backwards compatibility (with older versions and with grep). This problem can be seen with the current implementation, which returns <code>c</code> instead of <code>a</code> and <code>ac</code> as the <code>-v</code> somehow non-intuitively is also used for the regular expression coming before `-v&#x27;.</p>
<pre><code>echo &#x27;ab
         a
         ac
         c&#x27; | rg -e a -V -e b
</code></pre>
<p>Using <code>-V</code> might be an alternative to avoid the compatibility problem. Note that currently  <code>-V</code> prints the version (not documented in the man page, but in the <code>--help</code> output). This could be changed in such a way that the version is only printed if it&#x27;s the only argument given in the call to ripgrep. If this seems ugly, another letter could be used, of course, but <code>-V</code> has a nice analogy to the well-known <code>-v</code> from in<strong>v</strong>ert.</p>
<pre><code>echo &#x27;ab
         a
         ac
         c&#x27; | rg -e a -V b
</code></pre>
<p>This might be even simpler to type, to read and to implement, as <code>-V</code> would not change the interpretation of all future regexp parameters but would only invert the now following regexp parameter (acting like a single inverted <code>-e</code> parameter). This would preserve order-independence and therefore <code>rg -V b -e a</code> would have identical output. Of course, <code>-V</code> could be again exchanged by another letter, if seen necessary.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-06-07 04:08</div>
            <div class="timeline-body"><p>Dupe of #875</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-06-07 04:08</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:10 UTC
    </footer>
</body>
</html>
