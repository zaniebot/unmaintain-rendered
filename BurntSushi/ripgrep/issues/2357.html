<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add blank line between files, as in `ag --column --nogroup --noheading` - BurntSushi/ripgrep #2357</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Add blank line between files, as in <code>ag --column --nogroup --noheading</code></h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2357">#2357</a>
        opened by <a href="https://github.com/chiphogg">@chiphogg</a>
        on 2022-11-20 20:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/chiphogg">@chiphogg</a></div>
            <div class="timeline-body"><h4>Describe your feature request</h4>
<p>I want to use ripgrep instead of ag for most or all of my vim use cases.  However, I can't find a way to reproduce the default behaviour I get from the <code>ag.vim</code> plugin.</p>
<p>With <code>:Ag</code>, the output in the quickfix window is grouped by file, and separate files' results are separated by <code>||</code>, which is skipped over.  I've traced the terminal command being run to <code>ag --column --nogroup --noheading</code>.  In this mode, results are separated by <em>blank lines</em>.  The blank lines in the raw tool output get converted to <code>||</code> in the quickfix list, because <code>|</code> is the separator.</p>
<p>The point is that I could get the behaviour I want if there were a way to get output that looked like <code>file:line:column:contents</code>, with different files separated by blank lines, e.g.,</p>
<pre><code>a.cc:3:2:#include &lt;iostream&gt;
a.cc:4:2:#include &lt;utility&gt;

b.cc:3:2:#include &lt;algorithm&gt;
</code></pre>
<p>etc.  (Note the blank third line.)</p>
<p>I've tried getting used to not having the blank lines, but it turns out to be very useful to be able to see at a glance how many matches are in each file.  The visual structure conveys a lot of information!</p>
<p>In ripgrep, the closest I've come is <code>rg --column --heading</code>, but this prints the filename as a heading and omits it on the individual lines.  If I could get this mode, but with the filename omitted <em>as heading</em> and instead placed inline, that would be great!</p>
<p>Perhaps the syntax could be <code>--separate-files blank</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2022-11-20 22:26</div>
            <div class="timeline-body"><p>It is a non-goal for ripgrep's output to be arbitrarily flexible, and I do not see an obvious way to support this without adding a new flag. And I do not want to add a flag for such a thing. ripgrep has way too many flags as it is, and if I added a flag for every little niche case like this, it would have way more than too many flags.</p>
<blockquote>
<p>The visual structure conveys a lot of information!</p>
</blockquote>
<p>Yes, this is why <code>--heading</code> is the default when printing to a tty. You have not made it clear why you aren't just using <code>--heading</code>. You mention that you don't want it, but don't say why. My guess is that the output is being used for dual purposes: one to feed to vim and one for you to read. I would suggest solving that problem in a different way.</p>
<p>It also looks like <code>ag</code>'s behavior, that you're relying on, is inconsistent with its docs:</p>
<pre><code>     --[no]group          Same as --[no]break --[no]heading
</code></pre>
<p>and</p>
<pre><code>     --[no]break          Print newlines between matches in different files
                          (Enabled by default)
</code></pre>
<p>So it would seem that you should only use <code>--noheading</code> (and indeed that works). <code>--nogroup</code> appears to be, as documented, exactly what you don't want. But it doesn't appear to remove the blank newline. ¯\_(ツ)_/¯</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2022-11-20 22:26</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">wontfix</span> added by @BurntSushi on 2022-11-20 22:26</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chiphogg">@chiphogg</a> on 2022-11-21 03:12</div>
            <div class="timeline-body"><p>Thanks for your prompt, and clear, response.  I'll add some responses inline for posterity, in case it helps other people who have this same use case.</p>
<blockquote>
<p>It is a non-goal for ripgrep's output to be arbitrarily flexible, and I do not see an obvious way to support this without adding a new flag. And I do not want to add a flag for such a thing. ripgrep has way too many flags as it is, and if I added a flag for every little niche case like this, it would have way more than too many flags.</p>
</blockquote>
<p>Fair enough.  :+1:</p>
<blockquote>
<blockquote>
<p>The visual structure conveys a lot of information!</p>
</blockquote>
<p>Yes, this is why <code>--heading</code> is the default when printing to a tty. You have not made it clear why you aren't just using <code>--heading</code>. You mention that you don't want it, but don't say why. My guess is that the output is being used for dual purposes: one to feed to vim and one for you to read. I would suggest solving that problem in a different way.</p>
</blockquote>
<p>Let me clarify, then.  It's not being used for dual purposes, but for the single purpose of feeding to vim.  (The existing options are perfectly sufficient for human readability.)</p>
<p>The reason I'm not using <code>--heading</code> is because vim needs each line to contain complete information: file, line, and column.  Using <code>--heading</code> optimizes for human readers, and omits the filename from individual result lines.  Thus, simply put, it doesn't work.</p>
<p>Following your suggestion, I found an alternative solution.  I wrote this bash script which forwards its arguments to ripgrep, and then adds a blank line whenever we enter a new flie:</p>
<pre><code class="language-bash">#!/usr/bin/bash

rg --vimgrep $@ | while IFS= read -r LINE; do
  FILE=&quot;${LINE%%:*}&quot;
  if [ &quot;$FILE&quot; != &quot;$LAST_FILE&quot; ]; then
    [ ! -z &quot;$LAST_FILE&quot; ] &amp;&amp; echo ''
    LAST_FILE=&quot;$FILE&quot;
  fi
  echo &quot;${LINE}&quot;
done
</code></pre>
<p>I'm not a bash expert, so perhaps this could be improved or cleaned up, but it seemed to work.</p>
<p>Thanks for the advice!  I'm glad we found a solution with no delay for me, and no extra work or scope creep for you.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2022-11-21 03:15</div>
            <div class="timeline-body"><p>If it's just about feeding it to vim, why is the blank line needed at all? The <code>--vimgrep</code> flag is what the ripgrep vim plugins use as far as I know. (And <code>ag</code> also has a <code>--vimgrep</code> flag.)</p>
<p>But otherwise, glad you found something that works and thank you very much for sharing it!</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/chiphogg">@chiphogg</a> on 2022-11-21 03:30</div>
            <div class="timeline-body"><p>The blank line isn't <em>needed</em>, but I found that it makes the quickfix window more readable, because it creates a visual separation between the results for separate files.  I got used to being able to see at a glance which files have lots of results, and which ones have few results.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2022-11-21 03:54</div>
            <div class="timeline-body"><p>Ah gotya. That's what I thought at first and is what I meant by dual purpose: both for feeding to vim and for viewing.</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:43:35 UTC
    </footer>
</body>
</html>
