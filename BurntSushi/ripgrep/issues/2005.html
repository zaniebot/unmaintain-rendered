<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ripgrep should ignore all the `--glob !{paths}` defined in the `$RIPGREP_CONFIG_PATH`. - BurntSushi/ripgrep #2005</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Ripgrep should ignore all the <code>--glob !{paths}</code> defined in the <code>$RIPGREP_CONFIG_PATH</code>.</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2005">#2005</a>
        opened by <a href="https://github.com/ericbn">@ericbn</a>
        on 2021-09-24 16:35
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/ericbn">@ericbn</a></div>
            <div class="timeline-body">What version of ripgrep are you using?
<pre><code>ripgrep 13.0.0
-SIMD -AVX (compiled)
+SIMD +AVX (runtime)
</code></pre>
How did you install ripgrep?
<pre><code>brew install --formula ripgrep
</code></pre>
What operating system are you using ripgrep on?
<p>macOS 11.6</p>
Describe your bug.
<p>Ripgrep is not ignoring the <code>--glob !{paths}</code> defined in the <code>$RIPGREP_CONFIG_PATH</code>.</p>
What are the steps to reproduce the behavior?
<p>In a clean temporary directory:</p>
<pre><code>‚ùØ cat &lt;&lt; EOF &gt; /Users/me/.ripgreprc
--smart-case
--no-ignore
--hidden
--glob
!{.direnv,.git,.idea,.svn,cdk.out,/System/Volumes,/Volumes}
--max-columns
512
EOF
‚ùØ export RIPGREP_CONFIG_PATH=/Users/me/.ripgreprc
‚ùØ git clone https://github.com/zimfw/utility.git
‚ùØ rg --debug --files
</code></pre>
What is the actual behavior?
<p>Ripgrep is not ignoring the <code>.git</code> path as expected. This is the output with debug enabled:</p>
<pre><code>DEBUG|rg::config|crates/core/config.rs:40: /Users/me/.ripgreprc: arguments loaded from config file: [&quot;--smart-case&quot;, &quot;--no-ignore&quot;, &quot;--hidden&quot;, &quot;--glob&quot;, &quot;!{.direnv,.git,.idea,.svn,cdk.out,/System/Volumes,/Volumes}&quot;, &quot;--max-columns&quot;, &quot;512&quot;]
DEBUG|rg::args|crates/core/args.rs:543: final argv: [&quot;rg&quot;, &quot;--smart-case&quot;, &quot;--no-ignore&quot;, &quot;--hidden&quot;, &quot;--glob&quot;, &quot;!{.direnv,.git,.idea,.svn,cdk.out,/System/Volumes,/Volumes}&quot;, &quot;--max-columns&quot;, &quot;512&quot;, &quot;--debug&quot;, &quot;--files&quot;]
DEBUG|globset|crates/globset/src/lib.rs:416: glob converted to regex: Glob { glob: &quot;{.direnv,.git,.idea,.svn,cdk.out,/System/Volumes,/Volumes}&quot;, re: &quot;(?-u)^(/Volumes|/System/Volumes|cdk\\.out|\\.svn|\\.idea|\\.git|\\.direnv)$&quot;, opts: GlobOptions { case_insensitive: false, literal_separator: true, backslash_escape: true }, tokens: Tokens([Alternates([Tokens([Literal(&#x27;/&#x27;), Literal(&#x27;V&#x27;), Literal(&#x27;o&#x27;), Literal(&#x27;l&#x27;), Literal(&#x27;u&#x27;), Literal(&#x27;m&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;s&#x27;)]), Tokens([Literal(&#x27;/&#x27;), Literal(&#x27;S&#x27;), Literal(&#x27;y&#x27;), Literal(&#x27;s&#x27;), Literal(&#x27;t&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;m&#x27;), Literal(&#x27;/&#x27;), Literal(&#x27;V&#x27;), Literal(&#x27;o&#x27;), Literal(&#x27;l&#x27;), Literal(&#x27;u&#x27;), Literal(&#x27;m&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;s&#x27;)]), Tokens([Literal(&#x27;c&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;k&#x27;), Literal(&#x27;.&#x27;), Literal(&#x27;o&#x27;), Literal(&#x27;u&#x27;), Literal(&#x27;t&#x27;)]), Tokens([Literal(&#x27;.&#x27;), Literal(&#x27;s&#x27;), Literal(&#x27;v&#x27;), Literal(&#x27;n&#x27;)]), Tokens([Literal(&#x27;.&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;a&#x27;)]), Tokens([Literal(&#x27;.&#x27;), Literal(&#x27;g&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;t&#x27;)]), Tokens([Literal(&#x27;.&#x27;), Literal(&#x27;d&#x27;), Literal(&#x27;i&#x27;), Literal(&#x27;r&#x27;), Literal(&#x27;e&#x27;), Literal(&#x27;n&#x27;), Literal(&#x27;v&#x27;)])])]) }
DEBUG|globset|crates/globset/src/lib.rs:421: built glob set; 0 literals, 0 basenames, 0 extensions, 0 prefixes, 0 suffixes, 0 required extensions, 1 regexes
utility/.git/packed-refs
utility/.git/index
utility/.git/refs/remotes/origin/HEAD
utility/.git/refs/heads/master
utility/.git/hooks/push-to-checkout.sample
utility/.git/hooks/update.sample
utility/.git/hooks/pre-push.sample
utility/.git/hooks/pre-applypatch.sample
utility/.git/hooks/pre-merge-commit.sample
utility/.git/hooks/post-update.sample
utility/.git/hooks/prepare-commit-msg.sample
utility/.git/hooks/pre-receive.sample
utility/.git/hooks/fsmonitor-watchman.sample
utility/.git/hooks/applypatch-msg.sample
utility/.git/hooks/pre-commit.sample
utility/.git/hooks/pre-rebase.sample
utility/.git/hooks/commit-msg.sample
utility/.git/description
utility/.git/logs/refs/remotes/origin/HEAD
utility/.git/logs/refs/heads/master
utility/.git/logs/HEAD
utility/.git/info/exclude
utility/.git/HEAD
utility/.git/objects/pack/pack-d8be03228476b6d44a25ce74da3c45ca2bd200b2.idx
utility/.git/objects/pack/pack-d8be03228476b6d44a25ce74da3c45ca2bd200b2.pack
utility/.git/config
utility/functions/mkpw
utility/functions/mkcd
utility/init.zsh
utility/.gitignore
utility/README.md
utility/LICENSE
</code></pre>
What is the expected behavior?
<p>Ripgrep should have ignored all the <code>--glob !{paths}</code> defined in the <code>$RIPGREP_CONFIG_PATH</code>.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Renamed from &quot;Ripgrep should ignored all the `--glob !{paths}` defined in the `$RIPGREP_CONFIG_PATH`.&quot; to &quot;Ripgrep should ignore all the `--glob !{paths}` defined in the `$RIPGREP_CONFIG_PATH`.&quot; by <a href="https://github.com/ericbn">@ericbn</a> on 2021-09-24 16:35</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-09-24 17:03</div>
            <div class="timeline-body"><p>I can&#x27;t reproduce your problem. Please provide an actual reproduction. I should be able to run precisely your commands on some precise input and get an output that matches yours. Otherwise, from what I can see, <code>--glob !{paths}</code> is working just fine:</p>
<pre><code>$ tree -a
.
‚îú‚îÄ‚îÄ .git
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ foo
‚îú‚îÄ‚îÄ test1
‚îú‚îÄ‚îÄ .test2
‚îî‚îÄ‚îÄ .test3
    ‚îî‚îÄ‚îÄ foo

2 directories, 4 files

$ RIPGREP_CONFIG_PATH=/tmp/ripgreprc-i2005 rg --files
.test2
.test3/foo
test1

$ RIPGREP_CONFIG_PATH=/tmp/ripgreprc-i2005 rg --files -g &#x27;!.test2&#x27;
.test3/foo
test1

$ RIPGREP_CONFIG_PATH=/tmp/ripgreprc-i2005 rg --files -g &#x27;!{.test2,.test3}&#x27;
test1

$ RIPGREP_CONFIG_PATH=/tmp/ripgreprc-i2005 rg --files
.test2
.test3/foo
test1

$ cat /tmp/ripgreprc-i2005
--smart-case
--no-ignore
--hidden
--glob
!{.direnv,.git,.idea,.svn,cdk.out,/System/Volumes,/Volumes}
--max-columns
512

$ vim /tmp/ripgreprc-i2005

$ cat /tmp/ripgreprc-i2005
--smart-case
--no-ignore
--hidden
--glob
!{.direnv,.git,.idea,.svn,cdk.out,/System/Volumes,/Volumes}
--max-columns
512
--glob
!{.test2,.test3}

$ RIPGREP_CONFIG_PATH=/tmp/ripgreprc-i2005 rg --files
test1
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ericbn">@ericbn</a> on 2021-09-24 17:21</div>
            <div class="timeline-body"><p>Hi @BurntSushi. I&#x27;ve updated the steps to reproduce. I can reproduce it with the files from <code>git clone https://github.com/zimfw/utility.git</code> for example.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ericbn">@ericbn</a> on 2021-09-24 17:28</div>
            <div class="timeline-body"><p>Looks like the issue happens when the matched globs are more than one level deep on the tree:</p>
<pre><code>$ exa -Ta
.
‚îú‚îÄ‚îÄ .git
‚îÇ  ‚îî‚îÄ‚îÄ foo
‚îú‚îÄ‚îÄ .test2
‚îú‚îÄ‚îÄ .test3
‚îÇ  ‚îî‚îÄ‚îÄ foo
‚îú‚îÄ‚îÄ test1
‚îî‚îÄ‚îÄ test4
   ‚îî‚îÄ‚îÄ .git
      ‚îî‚îÄ‚îÄ foo
$ rg --files
test4/.git/foo
test1
.test2
.test3/foo
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-09-24 17:33</div>
            <div class="timeline-body"><p>It&#x27;s not that. It&#x27;s actually a semantic of gitignore here that I myself forgot about. Basically, if you have a glob that contains a <code>/</code>, then the glob has to match from the beginning of the path:</p>
<pre><code>// If there is a literal slash, then this is a glob that must match the
// entire path name. Otherwise, we should let it match anywhere, so use
// a **/ prefix.
if !is_absolute &amp;&amp; !line.chars().any(|c| c == &#x27;/&#x27;) {
    // ... but only if we don&#x27;t already have a **/ prefix.
    if !glob.has_doublestar_prefix() {
        glob.actual = format!(&quot;**/{}&quot;, glob.actual);
    }
}
</code></pre>
<p>You can see this in action when you split the <code>{...}</code> part into separate globs:</p>
<pre><code>$ rg --files --hidden -g &#x27;!{.git,/quux}&#x27;
.test2
utility/LICENSE
utility/.gitignore
utility/.git/objects/pack/pack-d8be03228476b6d44a25ce74da3c45ca2bd200b2.idx
utility/.git/objects/pack/pack-d8be03228476b6d44a25ce74da3c45ca2bd200b2.pack
utility/.git/description
utility/.git/refs/remotes/origin/HEAD
utility/.git/refs/heads/master
utility/.git/packed-refs
utility/.git/logs/refs/remotes/origin/HEAD
utility/.git/logs/HEAD
utility/.git/logs/refs/heads/master
utility/.git/config
utility/.git/HEAD
utility/.git/hooks/pre-commit.sample
utility/.git/hooks/fsmonitor-watchman.sample
utility/.git/info/exclude
utility/.git/hooks/post-update.sample
utility/.git/hooks/pre-rebase.sample
utility/.git/hooks/pre-merge-commit.sample
utility/.git/hooks/update.sample
utility/.git/hooks/pre-push.sample
utility/.git/hooks/prepare-commit-msg.sample
utility/.git/hooks/pre-receive.sample
utility/.git/hooks/applypatch-msg.sample
utility/.git/hooks/commit-msg.sample
utility/.git/hooks/push-to-checkout.sample
utility/.git/hooks/pre-applypatch.sample
utility/.git/index
utility/README.md
utility/init.zsh
test1
.test3/foo
.test3/.git/foo
utility/functions/mkpw
utility/functions/mkcd

$ rg --files --hidden -g &#x27;!.git&#x27; -g &#x27;!/quux&#x27;
.test2
utility/LICENSE
utility/.gitignore
utility/functions/mkcd
utility/functions/mkpw
utility/README.md
utility/init.zsh
.test3/foo
test1
</code></pre>
<p>So you just need to split your glob into things that contain a <code>/</code> and things that don&#x27;t.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-09-24 17:33</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">invalid</span> added by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-09-24 17:36</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/ericbn">@ericbn</a> on 2021-09-24 18:11</div>
            <div class="timeline-body"><p>Oh, got it! Thanks for the details! Gitignore globs are tricky... üòÑ</p>
</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:11 UTC
    </footer>
</body>
</html>
