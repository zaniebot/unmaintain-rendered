<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cannot compile master on nightly compiler with simd-accel - BurntSushi/ripgrep #2073</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Cannot compile master on nightly compiler with simd-accel</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/2073">#2073</a>
        opened by <a href="https://github.com/RobinVdBroeck">@RobinVdBroeck</a>
        on 2021-11-16 15:51
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/RobinVdBroeck">@RobinVdBroeck</a></div>
            <div class="timeline-body">What version of ripgrep are you using?
<p>Master branch at 7e05cde008c25940fb777ab1ae0c26c181692764</p>
What operating system are you using ripgrep on?
<p>Ubuntu 20.04 with <code>cargo 1.58.0-nightly (2e2a16e98 2021-11-08)</code> and <code>rustc 1.58.0-nightly (891ca5f63 2021-11-15)</code></p>
Describe your bug.
<p>When you compile with <code>--features &#x27;simd-accel&#x27;</code></p>
What are the steps to reproduce the behavior?
<p>Run <code>cargo build --features &#x27;simd-accel&#x27;</code></p>
What is the actual behavior?
<pre><code>&gt; cargo +nightly build --features &#x27;simd-accel&#x27;
   Compiling memchr v2.4.0
   Compiling cfg-if v1.0.0
   Compiling lazy_static v1.4.0
   Compiling libc v0.2.97
   Compiling proc-macro2 v1.0.27
   Compiling log v0.4.14
   Compiling unicode-xid v0.2.2
   Compiling libm v0.1.4
   Compiling regex-automata v0.1.10
   Compiling packed_simd_2 v0.3.5
   Compiling syn v1.0.73
   Compiling cfg-if v0.1.10
   Compiling encoding_rs v0.8.28
   Compiling serde_derive v1.0.126
   Compiling regex-syntax v0.6.25
   Compiling ryu v1.0.5
   Compiling serde v1.0.126
   Compiling bitflags v1.2.1
   Compiling unicode-width v0.1.8
   Compiling fnv v1.0.7
   Compiling same-file v1.0.6
   Compiling serde_json v1.0.64
   Compiling once_cell v1.7.2
   Compiling itoa v0.4.7
   Compiling strsim v0.8.0
   Compiling bytecount v0.6.2
   Compiling crossbeam-utils v0.8.5
   Compiling termcolor v1.1.2
   Compiling base64 v0.13.0
   Compiling textwrap v0.11.0
   Compiling walkdir v2.3.2
   Compiling thread_local v1.1.3
   Compiling clap v2.33.3
   Compiling bstr v0.2.16
   Compiling aho-corasick v0.7.18
   Compiling grep-matcher v0.1.5 (/home/robin/repos/ripgrep/crates/matcher)
   Compiling quote v1.0.9
error[E0557]: feature has been removed
   --&gt; /home/robin/.cargo/registry/src/github.com-1ecc6299db9ec823/packed_simd_2-0.3.5/src/lib.rs:215:5
    |
215 |     const_generics,
    |     ^^^^^^^^^^^^^^ feature has been removed
    |
    = note: removed in favor of `#![feature(adt_const_params)]` and `#![feature(generic_const_exprs)]`

   Compiling memmap2 v0.3.0
   Compiling atty v0.2.14
   Compiling num_cpus v1.13.0
   Compiling regex v1.5.4
error: type parameters must be declared prior to const parameters
  --&gt; /home/robin/.cargo/registry/src/github.com-1ecc6299db9ec823/packed_simd_2-0.3.5/src/codegen/llvm.rs:20:54
   |
20 | pub unsafe fn __shuffle_vector2&lt;const IDX: [u32; 2], T, U&gt;(x: T, y: T) -&gt; U
   |                                ----------------------^--^- help: reorder the parameters: lifetimes, then types, then consts: `&lt;T, U, const IDX: [u32; 2]&gt;`

error: type parameters must be declared prior to const parameters
  --&gt; /home/robin/.cargo/registry/src/github.com-1ecc6299db9ec823/packed_simd_2-0.3.5/src/codegen/llvm.rs:30:54
   |
30 | pub unsafe fn __shuffle_vector4&lt;const IDX: [u32; 4], T, U&gt;(x: T, y: T) -&gt; U
   |                                ----------------------^--^- help: reorder the parameters: lifetimes, then types, then consts: `&lt;T, U, const IDX: [u32; 4]&gt;`

error: type parameters must be declared prior to const parameters
  --&gt; /home/robin/.cargo/registry/src/github.com-1ecc6299db9ec823/packed_simd_2-0.3.5/src/codegen/llvm.rs:40:54
   |
40 | pub unsafe fn __shuffle_vector8&lt;const IDX: [u32; 8], T, U&gt;(x: T, y: T) -&gt; U
   |                                ----------------------^--^- help: reorder the parameters: lifetimes, then types, then consts: `&lt;T, U, const IDX: [u32; 8]&gt;`

error: type parameters must be declared prior to const parameters
  --&gt; /home/robin/.cargo/registry/src/github.com-1ecc6299db9ec823/packed_simd_2-0.3.5/src/codegen/llvm.rs:50:56
   |
50 | pub unsafe fn __shuffle_vector16&lt;const IDX: [u32; 16], T, U&gt;(x: T, y: T) -&gt; U
   |                                 -----------------------^--^- help: reorder the parameters: lifetimes, then types, then consts: `&lt;T, U, const IDX: [u32; 16]&gt;`

error: type parameters must be declared prior to const parameters
  --&gt; /home/robin/.cargo/registry/src/github.com-1ecc6299db9ec823/packed_simd_2-0.3.5/src/codegen/llvm.rs:60:56
   |
60 | pub unsafe fn __shuffle_vector32&lt;const IDX: [u32; 32], T, U&gt;(x: T, y: T) -&gt; U
   |                                 -----------------------^--^- help: reorder the parameters: lifetimes, then types, then consts: `&lt;T, U, const IDX: [u32; 32]&gt;`

error: type parameters must be declared prior to const parameters
  --&gt; /home/robin/.cargo/registry/src/github.com-1ecc6299db9ec823/packed_simd_2-0.3.5/src/codegen/llvm.rs:70:56
   |
70 | pub unsafe fn __shuffle_vector64&lt;const IDX: [u32; 64], T, U&gt;(x: T, y: T) -&gt; U
   |                                 -----------------------^--^- help: reorder the parameters: lifetimes, then types, then consts: `&lt;T, U, const IDX: [u32; 64]&gt;`

   Compiling globset v0.4.8 (/home/robin/repos/ripgrep/crates/globset)
   Compiling grep-regex v0.1.9 (/home/robin/repos/ripgrep/crates/regex)
   Compiling grep-cli v0.1.6 (/home/robin/repos/ripgrep/crates/cli)
   Compiling ignore v0.4.18 (/home/robin/repos/ripgrep/crates/ignore)
warning: field is never read: `which`
   --&gt; crates/ignore/src/types.rs:126:9
    |
126 |         which: usize,
    |         ^^^^^^^^^^^^
    |
    = note: `#[warn(dead_code)]` on by default

warning: field is never read: `negated`
   --&gt; crates/ignore/src/types.rs:128:9
    |
128 |         negated: bool,
    |         ^^^^^^^^^^^^^

error: `[u32; 2]` is forbidden as the type of a const generic parameter
  --&gt; /home/robin/.cargo/registry/src/github.com-1ecc6299db9ec823/packed_simd_2-0.3.5/src/codegen/llvm.rs:20:44
   |
20 | pub unsafe fn __shuffle_vector2&lt;const IDX: [u32; 2], T, U&gt;(x: T, y: T) -&gt; U
   |                                            ^^^^^^^^
   |
   = note: the only supported types are integers, `bool` and `char`
   = help: more complex types are supported with `#![feature(adt_const_params)]`

error: `[u32; 4]` is forbidden as the type of a const generic parameter
  --&gt; /home/robin/.cargo/registry/src/github.com-1ecc6299db9ec823/packed_simd_2-0.3.5/src/codegen/llvm.rs:30:44
   |
30 | pub unsafe fn __shuffle_vector4&lt;const IDX: [u32; 4], T, U&gt;(x: T, y: T) -&gt; U
   |                                            ^^^^^^^^
   |
   = note: the only supported types are integers, `bool` and `char`
   = help: more complex types are supported with `#![feature(adt_const_params)]`

error: `[u32; 8]` is forbidden as the type of a const generic parameter
  --&gt; /home/robin/.cargo/registry/src/github.com-1ecc6299db9ec823/packed_simd_2-0.3.5/src/codegen/llvm.rs:40:44
   |
40 | pub unsafe fn __shuffle_vector8&lt;const IDX: [u32; 8], T, U&gt;(x: T, y: T) -&gt; U
   |                                            ^^^^^^^^
   |
   = note: the only supported types are integers, `bool` and `char`
   = help: more complex types are supported with `#![feature(adt_const_params)]`

error: `[u32; 16]` is forbidden as the type of a const generic parameter
  --&gt; /home/robin/.cargo/registry/src/github.com-1ecc6299db9ec823/packed_simd_2-0.3.5/src/codegen/llvm.rs:50:45
   |
50 | pub unsafe fn __shuffle_vector16&lt;const IDX: [u32; 16], T, U&gt;(x: T, y: T) -&gt; U
   |                                             ^^^^^^^^^
   |
   = note: the only supported types are integers, `bool` and `char`
   = help: more complex types are supported with `#![feature(adt_const_params)]`

error: `[u32; 32]` is forbidden as the type of a const generic parameter
  --&gt; /home/robin/.cargo/registry/src/github.com-1ecc6299db9ec823/packed_simd_2-0.3.5/src/codegen/llvm.rs:60:45
   |
60 | pub unsafe fn __shuffle_vector32&lt;const IDX: [u32; 32], T, U&gt;(x: T, y: T) -&gt; U
   |                                             ^^^^^^^^^
   |
   = note: the only supported types are integers, `bool` and `char`
   = help: more complex types are supported with `#![feature(adt_const_params)]`

error: `[u32; 64]` is forbidden as the type of a const generic parameter
  --&gt; /home/robin/.cargo/registry/src/github.com-1ecc6299db9ec823/packed_simd_2-0.3.5/src/codegen/llvm.rs:70:45
   |
70 | pub unsafe fn __shuffle_vector64&lt;const IDX: [u32; 64], T, U&gt;(x: T, y: T) -&gt; U
   |                                             ^^^^^^^^^
   |
   = note: the only supported types are integers, `bool` and `char`
   = help: more complex types are supported with `#![feature(adt_const_params)]`

   Compiling ripgrep v13.0.0 (/home/robin/repos/ripgrep)
warning: `ignore` (lib) generated 2 warnings
For more information about this error, try `rustc --explain E0557`.
error: could not compile `packed_simd_2` due to 13 previous errors
warning: build failed, waiting for other jobs to finish...
error: build failed
</code></pre>
What is the expected behavior?
<p>It should compile</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-11-16 15:53</div>
            <div class="timeline-body"><p>This isn&#x27;t a ripgrep problem, it&#x27;s a problem with <code>packed_simd_2</code>. I would encourage you to report it there: https://github.com/rust-lang/packed_simd</p>
<p>Also, remember that <code>simd-accel</code> doesn&#x27;t give you much. Unless you&#x27;re specifically hurting from the time it takes for ripgrep to do UTF-16 transcoding, there is no other benefit.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-11-16 15:53</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-20 18:48:11 UTC
    </footer>
</body>
</html>
