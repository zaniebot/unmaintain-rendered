<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whitelisting via .gitignore does not handle dot prefix (&quot;!./fname&quot;) - BurntSushi/ripgrep #1374</title>
    <link rel="stylesheet" href="../../../style.css">
</head>
<body>
    <div class="back-link">
        <a href="../../../index.html">Back to index</a>
    </div>

    <h1>Whitelisting via .gitignore does not handle dot prefix (&quot;!./fname&quot;)</h1>

    <div class="meta">
        <span class="state-icon state-closed"></span>
        <a href="https://github.com/BurntSushi/ripgrep/issues/1374">#1374</a>
        opened by <a href="https://github.com/blueyed">@blueyed</a>
        on 2019-09-12 12:38
    </div>

    <div class="timeline">
        <div class="timeline-entry">
            <div class="timeline-header"><a href="https://github.com/blueyed">@blueyed</a></div>
            <div class="timeline-body"><p>Given a <code>.gitignore</code> file:</p>
<pre><code>*
!./PKGBUILD
</code></pre>
<p><code>rg</code> will skip the <code>PKGBUILD</code> file:</p>
<blockquote>
<p>DEBUG|ignore::walk|ignore/src/walk.rs:1639: ignoring ./PKGBUILD: Ignore(IgnoreMatch(Gitignore(Glob { from: Some(&quot;./.gitignore&quot;), original: &quot;<em>&quot;, actual: &quot;**/</em>&quot;, is_whitelist: false, is_only_dir: false })))</p>
</blockquote>
<p>This appears to be due to the leading dot there.
Git handles this as expected.</p>
<p>Removing the dot (using <code>!/PKGBUILD</code>) whitelists it then:</p>
<blockquote>
<p>DEBUG|ignore::walk|ignore/src/walk.rs:1642: whitelisting ./PKGBUILD: Whitelist(IgnoreMatch(Gitignore(Glob { from: Some(&quot;./.gitignore&quot;), original: &quot;!/PKGBUILD&quot;, actual: &quot;PKGBUILD&quot;, is_whitelist: true, is_only_dir: false })))</p>
</blockquote>
<h4>What version of ripgrep are you using?</h4>
<p>ripgrep 11.0.2</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> added by @BurntSushi on 2019-09-12 12:44</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">gitignore</span> added by @BurntSushi on 2020-05-08 11:34</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/goto-engineering">@goto-engineering</a> on 2020-12-05 01:42</div>
            <div class="timeline-body"><p>I just tried this, and my <code>git</code> (2.25.1) seems to show the same behavior:</p>
<pre><code>*
!./test
</code></pre>
<p>does not show the <code>test</code> file under <code>git status</code>, whereas</p>
<pre><code>*
!test
</code></pre>
<p>does show it.</p>
<p><code>ripgrep</code> has the exact same behavior.</p>
<p>Even when my .gitignore simply contains:</p>
<pre><code>./test
</code></pre>
<p>the test file is NOT being git-ignored. Are we sure that the <code>./</code> syntax is supported by gitignore?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2020-12-05 01:57</div>
            <div class="timeline-body"><p>@blueyed Can you clarify what you meant by &quot;git handles this as expected&quot; in your initial bug report here?</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/czarnota">@czarnota</a> on 2021-03-18 20:46</div>
            <div class="timeline-body"><p>IMHO this is the expected behavior</p>
<p>https://git-scm.com/docs/gitignore</p>
<blockquote>
<p>An optional prefix &quot;!&quot; which negates the pattern; any matching file excluded by a previous pattern will become included again. <strong>It is not possible to re-include a file if a parent directory of that file is excluded.</strong> Git doesn’t list excluded directories for performance reasons, so any patterns on contained files have no effect, no matter where they are defined.</p>
</blockquote>
<p>the dot <code>.</code> is a synonym for the parent directory of <code>.gitignore</code>, so in the case of</p>
<pre><code>!./PKGBUILD
</code></pre>
<p>&quot;It is not possible to re-include a file if a parent directory (in this case <code>.</code>) of that file is excluded.&quot;</p>
<p><strong>Furthermore:</strong></p>
<p>If you specify this .gitignore</p>
<pre><code>*
!foo/bar
</code></pre>
<pre><code class="language-console">$ tree -a
.
├── foo
│   └── bar
└── .gitignore
</code></pre>
<p>Then <code>git status</code> also gives you nothing</p>
<pre><code class="language-console">$ git status
On branch master

No commits yet

nothing to commit (create/copy files and use &quot;git add&quot; to track)
</code></pre>
</div>
        </div>
        <div class="timeline-entry">
            <div class="timeline-header">Comment by <a href="https://github.com/BurntSushi">@BurntSushi</a> on 2021-05-29 13:32</div>
            <div class="timeline-body"><p>Closing as not a bug. Happy to revisit with more compelling data.</p>
</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Closed by @BurntSushi on 2021-05-29 13:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">bug</span> removed by @BurntSushi on 2021-05-29 13:32</div>
        </div>
        <div class="timeline-entry">
            <div class="event">Label <span class="label">invalid</span> added by @BurntSushi on 2021-05-29 13:32</div>
        </div>
    </div>

    <footer>
        Synced at 2026-01-12 16:43:00 UTC
    </footer>
</body>
</html>
